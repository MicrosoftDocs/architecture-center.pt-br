---
title: Arquitetura de aplicativos do Azure para resiliência e disponibilidade
description: Criar resiliência e disponibilidade em um aplicativo do Azure
author: MikeWasson
ms.date: 04/10/2019
ms.topic: article
ms.service: architecture-center
ms.subservice: cloud-design-principles
ms.openlocfilehash: ee4bb5b4a85e48fe0ff017297c31823c93a48f04
ms.sourcegitcommit: 579c39ff4b776704ead17a006bf24cd4cdc65edd
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/17/2019
ms.locfileid: "59646482"
---
# <a name="architecting-azure-applications-for-resiliency-and-availability"></a><span data-ttu-id="23774-103">Arquitetura de aplicativos do Azure para resiliência e disponibilidade</span><span class="sxs-lookup"><span data-stu-id="23774-103">Architecting Azure applications for resiliency and availability</span></span>

<span data-ttu-id="23774-104">Depois de desenvolver os requisitos para o seu aplicativo, a próxima etapa é criar a disponibilidade e resiliência para ele.</span><span class="sxs-lookup"><span data-stu-id="23774-104">After you've developed the requirements for your application, the next step is to build resiliency and availability into it.</span></span> <span data-ttu-id="23774-105">Essas qualidades não podem ser adicionadas ao final &mdash; você deve criá-las na arquitetura.</span><span class="sxs-lookup"><span data-stu-id="23774-105">These qualities can't be added at the end &mdash; you must design them into the architecture.</span></span>

## <a name="conduct-a-failure-mode-analysis"></a><span data-ttu-id="23774-106">Conduzir uma análise do modo de falha</span><span class="sxs-lookup"><span data-stu-id="23774-106">Conduct a failure mode analysis</span></span>

<span data-ttu-id="23774-107">*Análise do modo de falha* (FMA) compila resiliência em um sistema, identificando possíveis pontos de falha e definir como o aplicativo responde a essas falhas.</span><span class="sxs-lookup"><span data-stu-id="23774-107">*Failure mode analysis* (FMA) builds resiliency into a system by identifying possible failure points and defining how the application responds to those failures.</span></span> <span data-ttu-id="23774-108">A FMA deve ser parte das fases de arquitetura e design, portanto, a recuperação de falhas é interna no sistema desde o início.</span><span class="sxs-lookup"><span data-stu-id="23774-108">The FMA should be part of the architecture and design phases, so failure recovery is built into the system from the beginning.</span></span> <span data-ttu-id="23774-109">Os objetivos de uma FMA são:</span><span class="sxs-lookup"><span data-stu-id="23774-109">The goals of an FMA are to:</span></span>

- <span data-ttu-id="23774-110">Determine quais tipos de falhas de um aplicativo pode enfrentar e como o aplicativo detecta essas falhas.</span><span class="sxs-lookup"><span data-stu-id="23774-110">Determine what types of failures an application might experience and how the application detects those failures.</span></span>
- <span data-ttu-id="23774-111">Capturar os possíveis efeitos de cada tipo de falha e determinar como o aplicativo responde.</span><span class="sxs-lookup"><span data-stu-id="23774-111">Capture the potential effects of each type of failure and determine how the app responds.</span></span>
- <span data-ttu-id="23774-112">Planejar para registro em log e monitoramento da falha e identificar estratégias de recuperação.</span><span class="sxs-lookup"><span data-stu-id="23774-112">Plan for logging and monitoring the failure and identify recovery strategies.</span></span>

<span data-ttu-id="23774-113">Aqui estão alguns exemplos de modos de falha e estratégias de detecção para um ponto de falha específico &mdash; uma chamada para um serviço web externo:</span><span class="sxs-lookup"><span data-stu-id="23774-113">Here are some examples of failure modes and detection strategies for a specific failure point &mdash; a call to an external web service:</span></span>

| <span data-ttu-id="23774-114">Modo de falha</span><span class="sxs-lookup"><span data-stu-id="23774-114">Failure mode</span></span>           | <span data-ttu-id="23774-115">Estratégia de detecção</span><span class="sxs-lookup"><span data-stu-id="23774-115">Detection strategy</span></span>           |
|------------------------|------------------------------|
| <span data-ttu-id="23774-116">O serviço está indisponível</span><span class="sxs-lookup"><span data-stu-id="23774-116">Service is unavailable</span></span> | <span data-ttu-id="23774-117">HTTP 5xx</span><span class="sxs-lookup"><span data-stu-id="23774-117">HTTP 5xx</span></span>                     |
| <span data-ttu-id="23774-118">Limitação</span><span class="sxs-lookup"><span data-stu-id="23774-118">Throttling</span></span>             | <span data-ttu-id="23774-119">HTTP 429 (Número Excessivo de Solicitações)</span><span class="sxs-lookup"><span data-stu-id="23774-119">HTTP 429 (Too Many Requests)</span></span> |
| <span data-ttu-id="23774-120">Autenticação</span><span class="sxs-lookup"><span data-stu-id="23774-120">Authentication</span></span>         | <span data-ttu-id="23774-121">HTTP 401 (Não Autorizado)</span><span class="sxs-lookup"><span data-stu-id="23774-121">HTTP 401 (Unauthorized)</span></span>      |
| <span data-ttu-id="23774-122">Resposta lenta</span><span class="sxs-lookup"><span data-stu-id="23774-122">Slow response</span></span>          | <span data-ttu-id="23774-123">Tempo limite da solicitação atingido</span><span class="sxs-lookup"><span data-stu-id="23774-123">Request times out</span></span>            |

<span data-ttu-id="23774-124">Para obter mais informações sobre o processo FMA, com as recomendações específicas para o Azure, consulte [análise do modo de falha](../resiliency/failure-mode-analysis.md).</span><span class="sxs-lookup"><span data-stu-id="23774-124">For more information about the FMA process, with specific recommendations for Azure, see [Failure mode analysis](../resiliency/failure-mode-analysis.md).</span></span>

## <a name="plan-for-redundancy"></a><span data-ttu-id="23774-125">Plano para redundância</span><span class="sxs-lookup"><span data-stu-id="23774-125">Plan for redundancy</span></span>

<span data-ttu-id="23774-126">Falhas variam no escopo do impacto.</span><span class="sxs-lookup"><span data-stu-id="23774-126">Failures vary in scope of impact.</span></span> <span data-ttu-id="23774-127">Algumas falhas de hardware, como um disco com falha, afetam um único computador host.</span><span class="sxs-lookup"><span data-stu-id="23774-127">Some hardware failures, such as a failed disk, affect a single host machine.</span></span> <span data-ttu-id="23774-128">Um comutador de rede com falha pode afetar um rack de servidores inteiro.</span><span class="sxs-lookup"><span data-stu-id="23774-128">A failed network switch could affect an entire server rack.</span></span> <span data-ttu-id="23774-129">Falhas menos comuns, como perda de energia, interrompem um datacenter inteiro.</span><span class="sxs-lookup"><span data-stu-id="23774-129">Less common failures, such as loss of power, disrupt a whole datacenter.</span></span> <span data-ttu-id="23774-130">Raramente, toda a região fica indisponível.</span><span class="sxs-lookup"><span data-stu-id="23774-130">Rarely, an entire region becomes unavailable.</span></span>

<span data-ttu-id="23774-131">A redundância é uma maneira de se tornar um aplicativo resiliente.</span><span class="sxs-lookup"><span data-stu-id="23774-131">Redundancy is one way to make an application resilient.</span></span> <span data-ttu-id="23774-132">O nível de redundância depende de seus requisitos de negócios &mdash; nem todos os aplicativos precisam de redundância entre regiões para se proteger contra uma interrupção regional.</span><span class="sxs-lookup"><span data-stu-id="23774-132">The level of redundancy depends on your business requirements &mdash; not every application needs redundancy across regions to guard against a regional outage.</span></span> <span data-ttu-id="23774-133">Em geral, há um equilíbrio entre mais redundância e confiabilidade em comparação com maior complexidade e os custos.</span><span class="sxs-lookup"><span data-stu-id="23774-133">In general, there's a tradeoff between greater redundancy and reliability versus higher costs and complexity.</span></span>

### <a name="review-azure-redundancy-features"></a><span data-ttu-id="23774-134">Analise os recursos de redundância do Azure</span><span class="sxs-lookup"><span data-stu-id="23774-134">Review Azure redundancy features</span></span>

<span data-ttu-id="23774-135">O Azure tem um número de recursos de redundância em todos os níveis de falha de uma máquina virtual (VM) individual em uma região inteira.</span><span class="sxs-lookup"><span data-stu-id="23774-135">Azure has a number of redundancy features at every level of failure, from an individual virtual machine (VM) to an entire region.</span></span>

- <span data-ttu-id="23774-136">**As VMs únicas** tem um [contrato de nível de serviço (SLA) do tempo de atividade](https://azure.microsoft.com/support/legal/sla/virtual-machines) fornecida pelo Azure.</span><span class="sxs-lookup"><span data-stu-id="23774-136">**Single VMs** have an [uptime service level agreement (SLA)](https://azure.microsoft.com/support/legal/sla/virtual-machines) provided by Azure.</span></span> <span data-ttu-id="23774-137">(A VM deve usar o armazenamento premium para todos os discos do sistema operacional e discos de dados). Embora você possa obter um SLA mais alto executando duas ou mais VMs, uma única VM pode ser suficientemente confiável para algumas cargas de trabalho.</span><span class="sxs-lookup"><span data-stu-id="23774-137">(The VM must use premium storage for all operating system disks and data disks.) Although you can get a higher SLA by running two or more VMs, a single VM may be reliable enough for some workloads.</span></span> <span data-ttu-id="23774-138">No entanto, para cargas de trabalho de produção, é recomendável usar duas ou mais máquinas virtuais para redundância.</span><span class="sxs-lookup"><span data-stu-id="23774-138">For production workloads, however, we recommend using two or more VMs for redundancy.</span></span>
- <span data-ttu-id="23774-139">**Conjuntos de disponibilidade** proteger contra falhas de hardware localizadas, como um disco ou com falha do comutador de rede.</span><span class="sxs-lookup"><span data-stu-id="23774-139">**Availability sets** protect against localized hardware failures, such as a disk or network switch failing.</span></span> <span data-ttu-id="23774-140">As VMs no conjunto de disponibilidade são distribuídas entre até três *domínios de falha*.</span><span class="sxs-lookup"><span data-stu-id="23774-140">VMs in an availability set are distributed across up to three *fault domains*.</span></span> <span data-ttu-id="23774-141">Um domínios de falha define um grupo de VMs que compartilham um comutador de rede e fonte de energia comuns.</span><span class="sxs-lookup"><span data-stu-id="23774-141">A fault domains defines a group of VMs that share a common power source and network switch.</span></span> <span data-ttu-id="23774-142">Se uma falha de hardware afeta um domínio de falha, o tráfego de rede é roteado para VMs em outros domínios de falha.</span><span class="sxs-lookup"><span data-stu-id="23774-142">If a hardware failure affects one fault domain, network traffic is routed to VMs in the other fault domains.</span></span> <span data-ttu-id="23774-143">Para obter mais informações sobre conjuntos de disponibilidade, consulte [gerenciar a disponibilidade das máquinas de virtuais do Windows no Azure](/azure/virtual-machines/windows/manage-availability).</span><span class="sxs-lookup"><span data-stu-id="23774-143">For more information about availability sets, see [Manage the availability of Windows virtual machines in Azure](/azure/virtual-machines/windows/manage-availability).</span></span>
- <span data-ttu-id="23774-144">**As zonas de disponibilidade** são regiões fisicamente separadas dentro de uma região do Azure.</span><span class="sxs-lookup"><span data-stu-id="23774-144">**Availability Zones** are physically separate zones within an Azure region.</span></span> <span data-ttu-id="23774-145">Cada zona de disponibilidade tem uma rede, resfriamento e fonte de energia distintos.</span><span class="sxs-lookup"><span data-stu-id="23774-145">Each Availability Zone has a distinct power source, network, and cooling.</span></span> <span data-ttu-id="23774-146">Implantação de VMs entre zonas de disponibilidade ajuda a proteger um aplicativo contra falhas de todo o datacenter.</span><span class="sxs-lookup"><span data-stu-id="23774-146">Deploying VMs across Availability Zones helps to protect an application against datacenter-wide failures.</span></span> <span data-ttu-id="23774-147">Nem todas as regiões oferecem suporte às Zonas de Disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="23774-147">Not all regions support Availability Zones.</span></span> <span data-ttu-id="23774-148">Para obter uma lista de regiões com suporte e serviços, confira [O que são Zonas de Disponibilidade no Azure?](/azure/availability-zones/az-overview).</span><span class="sxs-lookup"><span data-stu-id="23774-148">For a list of supported regions and services, see [What are Availability Zones in Azure?](/azure/availability-zones/az-overview).</span></span>

    <span data-ttu-id="23774-149">Se você planeja usar as zonas de disponibilidade em sua implantação, primeiro valide que a arquitetura do aplicativo e a base de suporte para essa configuração.</span><span class="sxs-lookup"><span data-stu-id="23774-149">If you plan to use Availability Zones in your deployment, first validate that your application architecture and codebase support this configuration.</span></span> <span data-ttu-id="23774-150">Se você implantar o software comercial, consulte o fornecedor de software e testar adequadamente antes de implantar na produção.</span><span class="sxs-lookup"><span data-stu-id="23774-150">If you deploy commercial software, consult with the software vendor and test adequately before deploying into production.</span></span> <span data-ttu-id="23774-151">Um aplicativo deve manter o estado e evitar a perda de dados durante uma interrupção dentro da zona configurada.</span><span class="sxs-lookup"><span data-stu-id="23774-151">An application must maintain state and prevent loss of data during an outage within the configured zone.</span></span> <span data-ttu-id="23774-152">O aplicativo deve oferecer suporte à execução em uma infraestrutura elástica e distribuída com nenhum componente de infraestrutura embutido em código.</span><span class="sxs-lookup"><span data-stu-id="23774-152">The application must support running in an elastic and distributed infrastructure with no hard-coded infrastructure components.</span></span>
- <span data-ttu-id="23774-153">**O Azure Site Recovery** precisa de máquinas virtuais do Azure para outra região do Azure para continuidade de negócios (BC) e recuperação de desastres (DR) é replicada.</span><span class="sxs-lookup"><span data-stu-id="23774-153">**Azure Site Recovery** replicates Azure Virtual Machines to another Azure region for business continuity (BC) and disaster recovery (DR) needs.</span></span> <span data-ttu-id="23774-154">Você pode realizar análises de recuperação de desastres periódicos para verificar se você atende as necessidades de conformidade.</span><span class="sxs-lookup"><span data-stu-id="23774-154">You can conduct periodic DR drills to ensure that you meet the compliance needs.</span></span> <span data-ttu-id="23774-155">A VM é replicada com as configurações especificadas para a região selecionada para que possa recuperar seus aplicativos em caso de paralisações na região de origem.</span><span class="sxs-lookup"><span data-stu-id="23774-155">The VM is replicated with the specified settings to the selected region so you can recover your applications in the event of outages in the source region.</span></span> <span data-ttu-id="23774-156">Para obter mais informações, consulte [configurar a recuperação de desastre para uma região secundária do Azure para uma VM do Azure](/azure/site-recovery/azure-to-azure-quickstart/).</span><span class="sxs-lookup"><span data-stu-id="23774-156">For more information, see [Set up disaster recovery to a secondary Azure region for an Azure VM](/azure/site-recovery/azure-to-azure-quickstart/).</span></span>

    <span data-ttu-id="23774-157">Durante o teste, verifique se o *objetivo de tempo de recuperação* (RTO) e *objetivo de ponto de recuperação* (RPO) atender às suas necessidades.</span><span class="sxs-lookup"><span data-stu-id="23774-157">During testing, verify that the *recovery time objective* (RTO) and *recovery point objective* (RPO) meet your needs.</span></span> <span data-ttu-id="23774-158">O RTO é o tempo máximo que um aplicativo não está disponível após um incidente e o RPO é a duração máxima de perda de dados durante um desastre.</span><span class="sxs-lookup"><span data-stu-id="23774-158">RTO is the maximum time an application is unavailable after an incident, and RPO is the maximum duration of data loss during a disaster.</span></span>
- <span data-ttu-id="23774-159">**Regiões emparelhadas** são criados usando o Gerenciador de tráfego do Azure para distribuir o tráfego da Internet para diferentes regiões, proteger um aplicativo contra uma interrupção regional.</span><span class="sxs-lookup"><span data-stu-id="23774-159">**Paired regions** are created using Azure Traffic Manager to distribute Internet traffic to different regions, protecting an application against a regional outage.</span></span> <span data-ttu-id="23774-160">Cada região do Azure é emparelhada com outra.</span><span class="sxs-lookup"><span data-stu-id="23774-160">Each Azure region is paired with another region.</span></span> <span data-ttu-id="23774-161">Juntas, essas regiões formam um [ *par regional*](/azure/best-practices-availability-paired-regions).</span><span class="sxs-lookup"><span data-stu-id="23774-161">Together, these regions form a [*regional pair*](/azure/best-practices-availability-paired-regions).</span></span> <span data-ttu-id="23774-162">Para atender aos requisitos de residência de dados para fins de jurisdição de imposição fiscal e legal, pares regionais estão localizados na mesma região geográfica (com exceção do Sul do Brasil).</span><span class="sxs-lookup"><span data-stu-id="23774-162">To meet data residency requirements for tax and law enforcement jurisdiction purposes, regional pairs are located within the same geography (with the exception of Brazil South).</span></span>

    <span data-ttu-id="23774-163">Para melhorar a resiliência do aplicativo, o Azure serializa as atualizações de plataforma (manutenção planejada) entre cada par de região, para que apenas uma região emparelhada é atualizado a cada vez.</span><span class="sxs-lookup"><span data-stu-id="23774-163">To improve application resiliency, Azure serializes platform updates (planned maintenance) across each region pair, so only one paired region is updated at a time.</span></span>
- <span data-ttu-id="23774-164">Quando você criar um aplicativo multiregion, leve em consideração que a latência de rede entre regiões é maior do que em uma região.</span><span class="sxs-lookup"><span data-stu-id="23774-164">When you design a multiregion application, take into account that network latency across regions is higher than within a region.</span></span> <span data-ttu-id="23774-165">Por exemplo, se você replicar um banco de dados para habilitar o failover, use a replicação síncrona de dados dentro de uma região, mas a replicação de dados assíncrona entre regiões.</span><span class="sxs-lookup"><span data-stu-id="23774-165">For example, if you replicate a database to enable failover, use synchronous data replication within a region but asynchronous data replication across regions.</span></span>

<span data-ttu-id="23774-166">A tabela a seguir compara os fatores de redundância entre várias estratégias de resiliência:</span><span class="sxs-lookup"><span data-stu-id="23774-166">The following table compares the redundancy factors across several resiliency strategies:</span></span>

| &nbsp; | <span data-ttu-id="23774-167">Conjunto de disponibilidade</span><span class="sxs-lookup"><span data-stu-id="23774-167">Availability set</span></span> | <span data-ttu-id="23774-168">Zona de disponibilidade</span><span class="sxs-lookup"><span data-stu-id="23774-168">Availability Zone</span></span> | <span data-ttu-id="23774-169">Azure Site Recovery/Região emparelhada</span><span class="sxs-lookup"><span data-stu-id="23774-169">Azure Site Recovery/Paired region</span></span> |
|--------|------------------|-------------------|-----------------------------------|
| <span data-ttu-id="23774-170">Escopo da falha</span><span class="sxs-lookup"><span data-stu-id="23774-170">Scope of failure</span></span> | <span data-ttu-id="23774-171">Rack</span><span class="sxs-lookup"><span data-stu-id="23774-171">Rack</span></span>                  | <span data-ttu-id="23774-172">Datacenter</span><span class="sxs-lookup"><span data-stu-id="23774-172">Datacenter</span></span>               | <span data-ttu-id="23774-173">Região</span><span class="sxs-lookup"><span data-stu-id="23774-173">Region</span></span>                               |
| <span data-ttu-id="23774-174">Roteamento de solicitação</span><span class="sxs-lookup"><span data-stu-id="23774-174">Request routing</span></span>  | <span data-ttu-id="23774-175">Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="23774-175">Azure Load Balancer</span></span>   | <span data-ttu-id="23774-176">Load Balancer entre zonas</span><span class="sxs-lookup"><span data-stu-id="23774-176">Cross-zone Load Balancer</span></span> | <span data-ttu-id="23774-177">Gerenciador de Tráfego do Azure</span><span class="sxs-lookup"><span data-stu-id="23774-177">Azure Traffic Manager</span></span>                |
| <span data-ttu-id="23774-178">Latência da rede</span><span class="sxs-lookup"><span data-stu-id="23774-178">Network latency</span></span>  | <span data-ttu-id="23774-179">Muito baixa</span><span class="sxs-lookup"><span data-stu-id="23774-179">Very low</span></span>              | <span data-ttu-id="23774-180">Baixo</span><span class="sxs-lookup"><span data-stu-id="23774-180">Low</span></span>                      | <span data-ttu-id="23774-181">Média a alta</span><span class="sxs-lookup"><span data-stu-id="23774-181">Mid to high</span></span>                          |
| <span data-ttu-id="23774-182">Rede virtual</span><span class="sxs-lookup"><span data-stu-id="23774-182">Virtual network</span></span>  | <span data-ttu-id="23774-183">Rede Virtual do Azure</span><span class="sxs-lookup"><span data-stu-id="23774-183">Azure Virtual Network</span></span> | <span data-ttu-id="23774-184">Rede Virtual do Azure</span><span class="sxs-lookup"><span data-stu-id="23774-184">Azure Virtual Network</span></span>          | <span data-ttu-id="23774-185">Emparelhamento de rede Virtual entre regiões</span><span class="sxs-lookup"><span data-stu-id="23774-185">Cross-region Virtual Network peering</span></span> |

### <a name="complete-azure-redundancy-tasks"></a><span data-ttu-id="23774-186">Tarefas de redundância do Azure completa</span><span class="sxs-lookup"><span data-stu-id="23774-186">Complete Azure redundancy tasks</span></span>

<span data-ttu-id="23774-187">Use as seguintes tarefas para atender aos requisitos de redundância:</span><span class="sxs-lookup"><span data-stu-id="23774-187">Use the following tasks to meet redundancy requirements:</span></span>

- <span data-ttu-id="23774-188">**Implante várias instâncias de serviços.**</span><span class="sxs-lookup"><span data-stu-id="23774-188">**Deploy multiple instances of services.**</span></span> <span data-ttu-id="23774-189">Se seu aplicativo depender de uma única instância de um serviço, ele criará um único ponto de falha.</span><span class="sxs-lookup"><span data-stu-id="23774-189">If your application depends on a single instance of a service, it creates a single point of failure.</span></span> <span data-ttu-id="23774-190">O provisionamento de várias instâncias melhora a resiliência e a escalabilidade.</span><span class="sxs-lookup"><span data-stu-id="23774-190">Provisioning multiple instances improves both resiliency and scalability.</span></span> <span data-ttu-id="23774-191">Para o [Serviço de Aplicativo do Azure](/azure/app-service/app-service-value-prop-what-is/), selecione um [Plano do Serviço de Aplicativo](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/) que ofereça várias instâncias.</span><span class="sxs-lookup"><span data-stu-id="23774-191">For [Azure App Service](/azure/app-service/app-service-value-prop-what-is/), select an [App Service plan](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/) that offers multiple instances.</span></span> <span data-ttu-id="23774-192">Para [máquinas virtuais do Azure](/azure/virtual-machines/virtual-machines-windows-about/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json), certifique-se de que a arquitetura tem mais de uma VM e se cada VM está incluída em uma [conjunto de disponibilidade](/azure/virtual-machines/virtual-machines-windows-manage-availability/).</span><span class="sxs-lookup"><span data-stu-id="23774-192">For [Azure Virtual Machines](/azure/virtual-machines/virtual-machines-windows-about/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json), ensure that your architecture has more than one VM and that each VM is included in an [availability set](/azure/virtual-machines/virtual-machines-windows-manage-availability/).</span></span>

- <span data-ttu-id="23774-193">**Replique VMs usando o Azure Site Recovery.**</span><span class="sxs-lookup"><span data-stu-id="23774-193">**Replicate VMs using Azure Site Recovery.**</span></span> <span data-ttu-id="23774-194">Quando você replicar VMs do Azure usando [recuperação de Site](/azure/site-recovery/), todos os discos VM são replicados continuamente para a região de destino assincronamente.</span><span class="sxs-lookup"><span data-stu-id="23774-194">When you replicate Azure VMs using [Site Recovery](/azure/site-recovery/), all the VM disks are continuously replicated to the target region asynchronously.</span></span> <span data-ttu-id="23774-195">Os pontos de recuperação são criados cada poucos minutos, oferecendo um RPO na ordem de minutos.</span><span class="sxs-lookup"><span data-stu-id="23774-195">The recovery points are created every few minutes, giving an RPO on the order of minutes.</span></span>

- <span data-ttu-id="23774-196">**Considere implantar o aplicativo entre várias regiões.**</span><span class="sxs-lookup"><span data-stu-id="23774-196">**Consider deploying your application across multiple regions.**</span></span> <span data-ttu-id="23774-197">Se seu aplicativo for implantado em uma única região e a região ficar indisponível, o aplicativo também estará disponível.</span><span class="sxs-lookup"><span data-stu-id="23774-197">If your application is deployed to a single region, and the region becomes unavailable, your application will also be unavailable.</span></span> <span data-ttu-id="23774-198">Isso pode ser inaceitável segundo os termos do SLA do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="23774-198">This may be unacceptable under the terms of your application's SLA.</span></span> <span data-ttu-id="23774-199">Nesse caso, considere implantar o aplicativo e os respectivos serviços entre várias regiões.</span><span class="sxs-lookup"><span data-stu-id="23774-199">If so, consider deploying your application and its services across multiple regions.</span></span> <span data-ttu-id="23774-200">Uma implantação multiregion pode usar um *ativo-ativo* ou *ativo-passivo* configuração.</span><span class="sxs-lookup"><span data-stu-id="23774-200">A multiregion deployment can use an *active-active* or *active-passive* configuration.</span></span> <span data-ttu-id="23774-201">Uma configuração ativo-ativo distribui solicitações entre várias regiões ativas.</span><span class="sxs-lookup"><span data-stu-id="23774-201">An active-active configuration distributes requests across multiple active regions.</span></span> <span data-ttu-id="23774-202">Uma configuração ativa-passiva mantém instâncias passivos na região secundária, mas não envia o tráfego lá, a menos que a região principal falhar.</span><span class="sxs-lookup"><span data-stu-id="23774-202">An active-passive configuration keeps warm instances in the secondary region, but doesn't send traffic there unless the primary region fails.</span></span> <span data-ttu-id="23774-203">Para implantações multiregion, é recomendável implantar em regiões emparelhadas, descritas acima.</span><span class="sxs-lookup"><span data-stu-id="23774-203">For multiregion deployments, we recommend deploying to paired regions, described above.</span></span> <span data-ttu-id="23774-204">Para saber mais, confira [Continuidade dos negócios e recuperação de desastres (BCDR): Regiões Combinadas do Azure](/azure/best-practices-availability-paired-regions).</span><span class="sxs-lookup"><span data-stu-id="23774-204">For more information, see [Business continuity and disaster recovery (BCDR): Azure Paired Regions](/azure/best-practices-availability-paired-regions).</span></span>

- <span data-ttu-id="23774-205">**Use o Gerenciador de Tráfego do Azure para rotear o tráfego do seu aplicativo para regiões diferentes.**</span><span class="sxs-lookup"><span data-stu-id="23774-205">**Use Azure Traffic Manager to route your application's traffic to different regions.**</span></span> <span data-ttu-id="23774-206">[O Gerenciador de tráfego do Azure](/azure/traffic-manager/traffic-manager-overview/) executa o balanceamento de carga no nível do DNS e encaminha o tráfego para regiões diferentes com base em de [roteamento de tráfego](/azure/traffic-manager/traffic-manager-routing-methods/) método e a integridade dos pontos de extremidade do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="23774-206">[Azure Traffic Manager](/azure/traffic-manager/traffic-manager-overview/) performs load-balancing at the DNS level and routes traffic to different regions based on the [traffic routing](/azure/traffic-manager/traffic-manager-routing-methods/) method and the health of your application's endpoints.</span></span> <span data-ttu-id="23774-207">Sem o Gerenciador de tráfego, você está limitado a uma única região para sua implantação, que restringe a escala, aumenta a latência para alguns usuários e faz com que o tempo de inatividade do aplicativo, no caso de uma interrupção do serviço de toda a região.</span><span class="sxs-lookup"><span data-stu-id="23774-207">Without Traffic Manager, you are limited to a single region for your deployment, which constrains scale, increases latency for some users, and causes application downtime, in the case of a region-wide service disruption.</span></span>

- <span data-ttu-id="23774-208">**Configure o Gateway de aplicativo do Azure para usar várias instâncias.**</span><span class="sxs-lookup"><span data-stu-id="23774-208">**Configure Azure Application Gateway to use multiple instances.**</span></span> <span data-ttu-id="23774-209">Dependendo dos requisitos do seu aplicativo, um [Gateway de Aplicativo do Azure](/azure/application-gateway/application-gateway-introduction/) pode ser mais conveniente para distribuir solicitações para os serviços do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="23774-209">Depending on your application's requirements, an [Azure Application Gateway](/azure/application-gateway/application-gateway-introduction/) may be better suited to distributing requests to your application's services.</span></span> <span data-ttu-id="23774-210">No entanto, instâncias únicas do serviço de Gateway de aplicativo não garantidas por um SLA, portanto, é possível que seu aplicativo poderá falhar se a instância do Gateway de aplicativo falhar.</span><span class="sxs-lookup"><span data-stu-id="23774-210">However, single instances of the Application Gateway service are not guaranteed by an SLA, so it's possible that your application could fail if the Application Gateway instance fails.</span></span> <span data-ttu-id="23774-211">Provisione mais de uma instância de médias ou maior para garantir a disponibilidade do serviço sob os termos do [SLA de Gateway de aplicativo](https://azure.microsoft.com/support/legal/sla/application-gateway/).</span><span class="sxs-lookup"><span data-stu-id="23774-211">Provision more than one medium or larger instance to guarantee availability of the service under the terms of the [Application Gateway SLA](https://azure.microsoft.com/support/legal/sla/application-gateway/).</span></span>

## <a name="design-for-scalability"></a><span data-ttu-id="23774-212">Design para escalabilidade</span><span class="sxs-lookup"><span data-stu-id="23774-212">Design for scalability</span></span>

<span data-ttu-id="23774-213">*Escalabilidade* é a capacidade de um sistema de lidar com aumentos de carga e é um dos [pilares da qualidade do software](../guide/pillars.md).</span><span class="sxs-lookup"><span data-stu-id="23774-213">*Scalability* is the ability of a system to handle increased load and is one of the [pillars of software quality](../guide/pillars.md).</span></span> <span data-ttu-id="23774-214">Tarefas de escalabilidade durante a fase de arquitetura incluem:</span><span class="sxs-lookup"><span data-stu-id="23774-214">Scalability tasks during the architecting phase include:</span></span>

- <span data-ttu-id="23774-215">**Cargas de trabalho de partição.**</span><span class="sxs-lookup"><span data-stu-id="23774-215">**Partition workloads.**</span></span> <span data-ttu-id="23774-216">Crie partes do processo para serem decompostas e distintas.</span><span class="sxs-lookup"><span data-stu-id="23774-216">Design parts of the process to be discrete and decomposable.</span></span> <span data-ttu-id="23774-217">Minimize o tamanho de cada parte.</span><span class="sxs-lookup"><span data-stu-id="23774-217">Minimize the size of each part.</span></span> <span data-ttu-id="23774-218">Isso permite que os componentes sejam distribuídos de forma a maximiza o uso de cada unidade de computação.</span><span class="sxs-lookup"><span data-stu-id="23774-218">This allows the component parts to be distributed in a way that maximizes use of each compute unit.</span></span> <span data-ttu-id="23774-219">Isso também facilita o dimensionamento do aplicativo ao adicionar instâncias de recursos específicos.</span><span class="sxs-lookup"><span data-stu-id="23774-219">It also makes it easier to scale the application by adding instances of specific resources.</span></span> <span data-ttu-id="23774-220">Para domínios complexos, considere a possibilidade de adotar uma [arquitetura de microsserviços](../guide/architecture-styles/microservices.md).</span><span class="sxs-lookup"><span data-stu-id="23774-220">For complex domains, consider adopting a [microservices architecture](../guide/architecture-styles/microservices.md).</span></span>
- <span data-ttu-id="23774-221">**Projete o dimensionamento.**</span><span class="sxs-lookup"><span data-stu-id="23774-221">**Design for scaling.**</span></span> <span data-ttu-id="23774-222">Dimensionamento permite que aplicativos reajam à carga variável, aumentando e diminuindo o número de instâncias de funções, filas e outros serviços.</span><span class="sxs-lookup"><span data-stu-id="23774-222">Scaling allows applications to react to variable load by increasing and decreasing the number of instances of roles, queues, and other services.</span></span> <span data-ttu-id="23774-223">No entanto, o aplicativo deve ser projetado com isso em mente.</span><span class="sxs-lookup"><span data-stu-id="23774-223">However, the application must be designed with this in mind.</span></span> <span data-ttu-id="23774-224">Por exemplo, o aplicativo e os serviços que ele usa devem ser sem monitoração de estado para permitir que as solicitações sejam roteadas para qualquer instância.</span><span class="sxs-lookup"><span data-stu-id="23774-224">For example, the application and the services it uses must be stateless to allow requests to be routed to any instance.</span></span> <span data-ttu-id="23774-225">Serviços sem monitoração de estado também significa que a adição ou remoção de uma instância não afeta negativamente os usuários atuais.</span><span class="sxs-lookup"><span data-stu-id="23774-225">Having stateless services also means that adding or removing an instance does not adversely impact current users.</span></span>
- <span data-ttu-id="23774-226">**Planeje o crescimento com unidades de escala.**</span><span class="sxs-lookup"><span data-stu-id="23774-226">**Plan for growth with scale units.**</span></span> <span data-ttu-id="23774-227">Para cada recurso, saber os limites de dimensionamento superiores e use a fragmentação ou Decomposição para ir além desses limites.</span><span class="sxs-lookup"><span data-stu-id="23774-227">For each resource, know the upper scaling limits, and use sharding or decomposition to go beyond those limits.</span></span> <span data-ttu-id="23774-228">Crie o aplicativo para que ele seja facilmente dimensionado com a adição de uma ou mais unidades de escala.</span><span class="sxs-lookup"><span data-stu-id="23774-228">Design the application so that it's easily scaled by adding one or more scale units.</span></span> <span data-ttu-id="23774-229">Determine as unidades de escala para o sistema em termos de conjuntos bem definidos de recursos.</span><span class="sxs-lookup"><span data-stu-id="23774-229">Determine the scale units for the system in terms of well-defined sets of resources.</span></span> <span data-ttu-id="23774-230">Isso torna aplicando operações de escala horizontal mais fácil e menos propensa a um impacto negativo causado por falta de recursos em alguma parte do sistema geral.</span><span class="sxs-lookup"><span data-stu-id="23774-230">This makes applying scale-out operations easier and less prone to negative impact caused by a lack of resources in some part of the overall system.</span></span> <span data-ttu-id="23774-231">Por exemplo, adicionando *X* número de VMs de front-end pode exigir *Y* número de filas adicionais e *Z* número de contas de armazenamento para lidar com a carga de trabalho adicional.</span><span class="sxs-lookup"><span data-stu-id="23774-231">For example, adding *X* number of front-end VMs might require *Y* number of additional queues and *Z* number of storage accounts to handle the additional workload.</span></span> <span data-ttu-id="23774-232">Portanto, uma unidade de escala poderia consistir *X* instâncias de VM *Y* filas, e *Z* contas de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="23774-232">So a scale unit could consist of *X* VM instances, *Y* queues, and *Z* storage accounts.</span></span>
- <span data-ttu-id="23774-233">**Evite a afinidade do cliente.**</span><span class="sxs-lookup"><span data-stu-id="23774-233">**Avoid client affinity.**</span></span> <span data-ttu-id="23774-234">Sempre que possível, certifique-se de que o aplicativo não requer afinidade.</span><span class="sxs-lookup"><span data-stu-id="23774-234">Where possible, ensure that the application doesn't require affinity.</span></span> <span data-ttu-id="23774-235">As solicitações, em seguida, podem ser roteadas para qualquer instância e o número de instâncias é irrelevante.</span><span class="sxs-lookup"><span data-stu-id="23774-235">Requests can then be routed to any instance, and the number of instances is irrelevant.</span></span> <span data-ttu-id="23774-236">Isso também evita a sobrecarga de armazenamento, de recuperação e de manutenção de informações de estado para cada usuário.</span><span class="sxs-lookup"><span data-stu-id="23774-236">This also avoids the overhead of storing, retrieving, and maintaining state information for each user.</span></span>
- <span data-ttu-id="23774-237">**Tirar proveito dos recursos de dimensionamento automático de plataforma.**</span><span class="sxs-lookup"><span data-stu-id="23774-237">**Take advantage of platform autoscaling features.**</span></span> <span data-ttu-id="23774-238">Usar recursos de dimensionamento automático internos quando possível, em vez de mecanismos de terceiros ou personalizados.</span><span class="sxs-lookup"><span data-stu-id="23774-238">Use built-in autoscaling features when possible, rather than custom or third-party mechanisms.</span></span> <span data-ttu-id="23774-239">Regras de dimensionamento de uso agendado, sempre que possível, para garantir que recursos estão disponíveis sem um atraso de inicialização, mas adicionar o dimensionamento automático reativo às regras, quando apropriado, para lidar com alterações inesperadas na demanda.</span><span class="sxs-lookup"><span data-stu-id="23774-239">Use scheduled scaling rules, where possible, to ensure that resources are available without a startup delay, but add reactive autoscaling to the rules, where appropriate, to cope with unexpected changes in demand.</span></span> <span data-ttu-id="23774-240">Para obter mais informações, consulte [diretrizes de dimensionamento automático](../best-practices/auto-scaling.md).</span><span class="sxs-lookup"><span data-stu-id="23774-240">For more information, see [Autoscaling guidance](../best-practices/auto-scaling.md).</span></span>  

  <span data-ttu-id="23774-241">Se seu aplicativo não estiver configurado para expandir automaticamente conforme a carga aumenta, é possível que os serviços do aplicativo falhará se ficarem saturados com solicitações de usuário.</span><span class="sxs-lookup"><span data-stu-id="23774-241">If your application isn't configured to scale out automatically as load increases, it's possible that your application's services will fail if they become saturated with user requests.</span></span> <span data-ttu-id="23774-242">Para obter mais informações, consulte os seguintes artigos:</span><span class="sxs-lookup"><span data-stu-id="23774-242">For more information, see the following articles:</span></span>

  - <span data-ttu-id="23774-243">Geral: [Lista de verificação de escalabilidade](../checklist/scalability.md)</span><span class="sxs-lookup"><span data-stu-id="23774-243">General: [Scalability checklist](../checklist/scalability.md)</span></span>
  - <span data-ttu-id="23774-244">Serviço de Aplicativo do Azure: [Escalonar a contagem de instâncias manualmente ou automaticamente](/azure/monitoring-and-diagnostics/insights-how-to-scale/)</span><span class="sxs-lookup"><span data-stu-id="23774-244">Azure App Service: [Scale instance count manually or automatically](/azure/monitoring-and-diagnostics/insights-how-to-scale/)</span></span>
  - <span data-ttu-id="23774-245">Serviços de Nuvem: [Como fazer o dimensionamento automático de um serviço de nuvem](/azure/cloud-services/cloud-services-how-to-scale/)</span><span class="sxs-lookup"><span data-stu-id="23774-245">Cloud Services: [How to autoscale a Cloud Service](/azure/cloud-services/cloud-services-how-to-scale/)</span></span>
  - <span data-ttu-id="23774-246">Máquinas virtuais: [Conjuntos de dimensionamento de dimensionamento automático e máquina virtual](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-autoscale-overview/)</span><span class="sxs-lookup"><span data-stu-id="23774-246">Virtual machines: [Automatic scaling and virtual machine scale sets](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-autoscale-overview/)</span></span>

- <span data-ttu-id="23774-247">**Descarregue tarefas intensivas de CPU/es como tarefas em segundo plano.**</span><span class="sxs-lookup"><span data-stu-id="23774-247">**Offload intensive CPU/IO tasks as background tasks.**</span></span> <span data-ttu-id="23774-248">Se uma solicitação para um serviço deve levar muito tempo para ser executado ou pode absorva recursos consideráveis, descarregar o processamento de uma tarefa separada.</span><span class="sxs-lookup"><span data-stu-id="23774-248">If a request to a service is expected to take a long time to run or may absorb considerable resources, offload the processing to a separate task.</span></span> <span data-ttu-id="23774-249">Use trabalhos em segundo plano para executar essas tarefas.</span><span class="sxs-lookup"><span data-stu-id="23774-249">Use background jobs to execute these tasks.</span></span> <span data-ttu-id="23774-250">Essa estratégia permite que o serviço para continuar a receber outras solicitações e permaneça responsivo.</span><span class="sxs-lookup"><span data-stu-id="23774-250">This strategy enables the service to continue receiving further requests and to remain responsive.</span></span> <span data-ttu-id="23774-251">Para saber mais, consulte [Diretrizes de trabalhos em segundo plano](../best-practices/background-jobs.md).</span><span class="sxs-lookup"><span data-stu-id="23774-251">For more information, see [Background jobs guidance](../best-practices/background-jobs.md).</span></span>
- <span data-ttu-id="23774-252">**Distribua a carga de trabalho para tarefas em segundo plano.**</span><span class="sxs-lookup"><span data-stu-id="23774-252">**Distribute the workload for background tasks.**</span></span> <span data-ttu-id="23774-253">Se houver muitas tarefas em segundo plano ou se as tarefas exigem tempo ou recursos consideráveis, distribua o trabalho entre várias unidades de computação.</span><span class="sxs-lookup"><span data-stu-id="23774-253">If there are many background tasks or if the tasks require considerable time or resources, spread the work across multiple compute units.</span></span> <span data-ttu-id="23774-254">Para ver uma solução possível, confira [Padrão de clientes concorrentes](../patterns/competing-consumers.md).</span><span class="sxs-lookup"><span data-stu-id="23774-254">For one possible solution, see the [Competing Consumers pattern](../patterns/competing-consumers.md).</span></span>
- <span data-ttu-id="23774-255">**Considere mudar para um *nada compartilhado* arquitetura.**</span><span class="sxs-lookup"><span data-stu-id="23774-255">**Consider moving toward a *shared-nothing* architecture.**</span></span> <span data-ttu-id="23774-256">Essa arquitetura usa nós independentes e autossuficientes com nenhum ponto único de contenção (como serviços compartilhados ou armazenamento).</span><span class="sxs-lookup"><span data-stu-id="23774-256">This architecture uses independent, self-sufficient nodes that have no single point of contention (such as shared services or storage).</span></span> <span data-ttu-id="23774-257">Em tese, esse sistema pode ser dimensionado quase indefinidamente.</span><span class="sxs-lookup"><span data-stu-id="23774-257">In theory, such a system can scale almost indefinitely.</span></span> <span data-ttu-id="23774-258">Embora uma abordagem completa de nada compartilhado geralmente não é prática, ele pode fornecer oportunidades de projetar uma escalabilidade melhor.</span><span class="sxs-lookup"><span data-stu-id="23774-258">Although a fully shared-nothing approach is usually not practical, it may provide opportunities to design for better scalability.</span></span> <span data-ttu-id="23774-259">Bons exemplos de uma arquitetura de nada compartilhado na direção incluem o particionamento de dados e evitar o uso de afinidade de cliente e o estado de sessão do lado do servidor.</span><span class="sxs-lookup"><span data-stu-id="23774-259">Good examples of moving toward a shared-nothing architecture include partitioning data and avoiding the use of server-side session state and client affinity.</span></span>
- <span data-ttu-id="23774-260">**Projete os requisitos de armazenamento do seu aplicativo para ficarem dentro das metas de desempenho e escalabilidade do armazenamento do Azure.**</span><span class="sxs-lookup"><span data-stu-id="23774-260">**Design your application's storage requirements to fall within Azure Storage scalability and performance targets.**</span></span> <span data-ttu-id="23774-261">O armazenamento do Azure foi projetado para funcionar dentro dos destinos de escalabilidade e desempenho predefinidos, portanto, projete seu aplicativo para usar o armazenamento dentro dessas metas.</span><span class="sxs-lookup"><span data-stu-id="23774-261">Azure Storage is designed to function within predefined scalability and performance targets, so design your application to use storage within those targets.</span></span> <span data-ttu-id="23774-262">Se você exceder essas metas, seu aplicativo sofrerá uma limitação de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="23774-262">If you exceed these targets, your application will experience storage throttling.</span></span> <span data-ttu-id="23774-263">Para evitar a limitação, provisione contas de armazenamento adicionais.</span><span class="sxs-lookup"><span data-stu-id="23774-263">To avoid throttling, provision additional storage accounts.</span></span> <span data-ttu-id="23774-264">Se você atingir o limite de conta de armazenamento, provisionar assinaturas adicionais do Azure e, em seguida, há contas de armazenamento adicionais.</span><span class="sxs-lookup"><span data-stu-id="23774-264">If you run up against the storage account limit, provision additional Azure subscriptions and then provision additional storage accounts there.</span></span> <span data-ttu-id="23774-265">Para saber mais, confira [Metas de desempenho e escalabilidade do Armazenamento do Azure](/azure/storage/storage-scalability-targets/).</span><span class="sxs-lookup"><span data-stu-id="23774-265">For more information, see [Azure Storage scalability and performance targets](/azure/storage/storage-scalability-targets/).</span></span>
- <span data-ttu-id="23774-266">**Selecione o tamanho de VM certo para o aplicativo.**</span><span class="sxs-lookup"><span data-stu-id="23774-266">**Select the right VM size for your application.**</span></span> <span data-ttu-id="23774-267">Medir a CPU, memória, disco e e/s de suas VMs em produção real e verifique se o tamanho da VM que você selecionou é suficiente.</span><span class="sxs-lookup"><span data-stu-id="23774-267">Measure the actual CPU, memory, disk, and I/O of your VMs in production, and verify that the VM size you've selected is sufficient.</span></span> <span data-ttu-id="23774-268">Se não é, seu aplicativo pode apresentar problemas de capacidade, tais como VMs se aproximarem de seus limites.</span><span class="sxs-lookup"><span data-stu-id="23774-268">If not, your application may experience capacity issues as the VMs approach their limits.</span></span> <span data-ttu-id="23774-269">Tamanhos de VM são descritos em detalhes em [Tamanhos de máquinas virtuais no Azure](/azure/virtual-machines/virtual-machines-windows-sizes/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="23774-269">VM sizes are described in detail in [Sizes for virtual machines in Azure](/azure/virtual-machines/virtual-machines-windows-sizes/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span>

## <a name="determine-subscription-and-service-requirements"></a><span data-ttu-id="23774-270">Determinar os requisitos de serviço e assinatura</span><span class="sxs-lookup"><span data-stu-id="23774-270">Determine subscription and service requirements</span></span>

<span data-ttu-id="23774-271">Escolha a assinatura correta e recursos de serviço para seu aplicativo, apresentando estas tarefas:</span><span class="sxs-lookup"><span data-stu-id="23774-271">Choose the right subscription and service features for your app by working through these tasks:</span></span>

- <span data-ttu-id="23774-272">**Avaliar os requisitos em relação aos [assinatura do Azure e limites de serviço](/azure/azure-subscription-service-limits/).**</span><span class="sxs-lookup"><span data-stu-id="23774-272">**Evaluate requirements against [Azure subscription and service limits](/azure/azure-subscription-service-limits/).**</span></span> <span data-ttu-id="23774-273">*As assinaturas do Azure* têm limites em determinados tipos de recurso, como o número de grupos de recursos, núcleos e contas de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="23774-273">*Azure subscriptions* have limits on certain resource types, such as number of resource groups, cores, and storage accounts.</span></span> <span data-ttu-id="23774-274">Se seus requisitos de aplicativo excedem os limites de assinatura do Azure, crie outra assinatura do Azure e provisione recursos suficientes nela.</span><span class="sxs-lookup"><span data-stu-id="23774-274">If your application requirements exceed Azure subscription limits, create another Azure subscription and provision sufficient resources there.</span></span> <span data-ttu-id="23774-275">Os serviços do Azure individuais têm limites de consumo &mdash; por exemplo, limites para armazenamento, taxa de transferência, número de conexões, solicitações por segundo e outras métricas.</span><span class="sxs-lookup"><span data-stu-id="23774-275">Individual Azure services have consumption limits &mdash; for example, limits on storage, throughput, number of connections, requests per second, and other metrics.</span></span> <span data-ttu-id="23774-276">O aplicativo falhará se ele tentar usar recursos além desses limites, resultando em serviço limitação e possível tempo de inatividade para os usuários afetados.</span><span class="sxs-lookup"><span data-stu-id="23774-276">Your application will fail if it attempts to use resources beyond these limits, resulting in service throttling and possible downtime for affected users.</span></span> <span data-ttu-id="23774-277">Dependendo do serviço específico e seus requisitos de aplicativo, você geralmente pode evitar esses limites, escalar verticalmente (por exemplo, escolher outro tipo de preço) ou a expansão (como adicionar novas instâncias).</span><span class="sxs-lookup"><span data-stu-id="23774-277">Depending on the specific service and your application requirements, you can often avoid these limits by scaling up (for example, choosing another pricing tier) or scaling out (such as adding new instances).</span></span>
- <span data-ttu-id="23774-278">**Determine quantas contas de armazenamento que você precisa.**</span><span class="sxs-lookup"><span data-stu-id="23774-278">**Determine how many storage accounts you need.**</span></span> <span data-ttu-id="23774-279">Azure permite que um número específico de contas de armazenamento por assinatura.</span><span class="sxs-lookup"><span data-stu-id="23774-279">Azure allows a specific number of storage accounts per subscription.</span></span> <span data-ttu-id="23774-280">Para saber mais, confira [Assinatura e limites de serviço, cotas e restrições do Azure](/azure/azure-subscription-service-limits/#storage-limits).</span><span class="sxs-lookup"><span data-stu-id="23774-280">For more information, see [Azure subscription and service limits, quotas, and constraints](/azure/azure-subscription-service-limits/#storage-limits).</span></span>
- <span data-ttu-id="23774-281">**Selecione a camada de serviço certa para o Banco de Dados SQL do Azure.**</span><span class="sxs-lookup"><span data-stu-id="23774-281">**Select the right service tier for Azure SQL Database.**</span></span> <span data-ttu-id="23774-282">Se seu aplicativo usa o banco de dados SQL, selecione a camada de serviço apropriado.</span><span class="sxs-lookup"><span data-stu-id="23774-282">If your application uses Azure SQL Database, select the appropriate service tier.</span></span> <span data-ttu-id="23774-283">Se a camada não pode lidar com requisitos de DTU (unidade) de transação de banco de dados do seu aplicativo, o uso de dados será limitado.</span><span class="sxs-lookup"><span data-stu-id="23774-283">If the tier cannot handle your application's database transaction unit (DTU) requirements, your data use will be throttled.</span></span> <span data-ttu-id="23774-284">Para obter mais informações sobre como selecionar o plano de serviço correto, veja [Opções e desempenho de Banco de Dados SQL: Entenda o que está disponível em cada camada de serviço](/azure/sql-database/sql-database-service-tiers/).</span><span class="sxs-lookup"><span data-stu-id="23774-284">For more information on selecting the correct service plan, see [SQL Database options and performance: Understand what's available in each service tier](/azure/sql-database/sql-database-service-tiers/).</span></span>
- <span data-ttu-id="23774-285">**Provisionar unidades de solicitação (RUs) suficientes no Azure Cosmos DB**.</span><span class="sxs-lookup"><span data-stu-id="23774-285">**Provision sufficient request units (RUs) in Azure Cosmos DB**.</span></span> <span data-ttu-id="23774-286">Com o Azure Cosmos DB, você paga pela taxa de transferência provisionada e pelo armazenamento que consome por hora.</span><span class="sxs-lookup"><span data-stu-id="23774-286">With Azure Cosmos DB, you pay for the throughput you provision and the storage you consume on an hourly basis.</span></span> <span data-ttu-id="23774-287">O custo de todas as operações de banco de dados é normalizado como RUs, que abstrai os recursos do sistema, como CPU, memória e IOPS.</span><span class="sxs-lookup"><span data-stu-id="23774-287">The cost of all database operations is normalized as RUs, which abstracts the system resources such as CPU, IOPS, and memory.</span></span> <span data-ttu-id="23774-288">Para obter mais informações, consulte [Unidades de Solicitação no Azure Cosmos DB](/azure/cosmos-db/request-units).</span><span class="sxs-lookup"><span data-stu-id="23774-288">For more information, see [Request Units in Azure Cosmos DB](/azure/cosmos-db/request-units).</span></span>

## <a name="load-balance-as-needed"></a><span data-ttu-id="23774-289">Conforme a necessidade de balanceamento de carga</span><span class="sxs-lookup"><span data-stu-id="23774-289">Load-balance as needed</span></span>

<span data-ttu-id="23774-290">Balanceamento de carga adequado, permite que você para atender aos requisitos de disponibilidade e para minimizar os custos associados à disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="23774-290">Proper load-balancing allows you to meet availability requirements and to minimize costs associated with availability.</span></span>

- <span data-ttu-id="23774-291">**Use o balanceamento de carga para distribuir solicitações.**</span><span class="sxs-lookup"><span data-stu-id="23774-291">**Use load-balancing to distribute requests.**</span></span> <span data-ttu-id="23774-292">Balanceamento de carga distribui as solicitações do seu aplicativo para instâncias de serviço íntegras Removendo instâncias não íntegras da rotação.</span><span class="sxs-lookup"><span data-stu-id="23774-292">Load-balancing distributes your application's requests to healthy service instances by removing unhealthy instances from rotation.</span></span> <span data-ttu-id="23774-293">Se o serviço usar o serviço de aplicativo do Azure ou serviços de nuvem do Azure, ele já está com balanceamento de carga para você.</span><span class="sxs-lookup"><span data-stu-id="23774-293">If your service uses Azure App Service or Azure Cloud Services, it's already load-balanced for you.</span></span> <span data-ttu-id="23774-294">No entanto, se seu aplicativo usa VMs do Azure, você precisará provisionar um balanceador de carga.</span><span class="sxs-lookup"><span data-stu-id="23774-294">However, if your application uses Azure VMs, you need to provision a load-balancer.</span></span> <span data-ttu-id="23774-295">Para obter mais informações, consulte [o que é o balanceador de carga do Azure?](/azure/load-balancer/load-balancer-overview/)</span><span class="sxs-lookup"><span data-stu-id="23774-295">For more information, see [What is Azure Load Balancer?](/azure/load-balancer/load-balancer-overview/)</span></span>

  <span data-ttu-id="23774-296">Use o Azure Load Balancer para:</span><span class="sxs-lookup"><span data-stu-id="23774-296">You can use Azure Load Balancer to:</span></span>

  - <span data-ttu-id="23774-297">O balanceamento de carga o tráfego da Internet em suas VMs.</span><span class="sxs-lookup"><span data-stu-id="23774-297">Load-balance incoming Internet traffic to your VMs.</span></span> <span data-ttu-id="23774-298">Essa configuração é conhecida como uma [ *balanceador de carga público*](/azure/load-balancer/load-balancer-overview#publicloadbalancer).</span><span class="sxs-lookup"><span data-stu-id="23774-298">This configuration is known as a [*public Load Balancer*](/azure/load-balancer/load-balancer-overview#publicloadbalancer).</span></span>
  - <span data-ttu-id="23774-299">Balancear a carga do tráfego entre VMs dentro de uma rede virtual.</span><span class="sxs-lookup"><span data-stu-id="23774-299">Load-balance traffic across VMs inside a virtual network.</span></span> <span data-ttu-id="23774-300">Também é possível acessar o front-end de um Load Balancer de uma rede local em um cenário híbrido.</span><span class="sxs-lookup"><span data-stu-id="23774-300">You can also reach a Load Balancer front end from an on-premises network in a hybrid scenario.</span></span> <span data-ttu-id="23774-301">Ambos os cenários usam uma configuração que é conhecida como um [ *balanceador de carga interno*](/azure/load-balancer/load-balancer-overview#internalloadbalancer).</span><span class="sxs-lookup"><span data-stu-id="23774-301">Both scenarios use a configuration that is known as an [*internal Load Balancer*](/azure/load-balancer/load-balancer-overview#internalloadbalancer).</span></span>
  - <span data-ttu-id="23774-302">Tráfego de encaminhamento de porta para uma porta discriminada em VMs específicas com regras NAT (conversão) de endereço de rede de entrada.</span><span class="sxs-lookup"><span data-stu-id="23774-302">Port forward traffic to an itemized port on specific VMs with inbound network address translation (NAT) rules.</span></span>
  - <span data-ttu-id="23774-303">Forneça [conectividade de saída](/azure/load-balancer/load-balancer-outbound-connections) para VMs dentro de sua rede virtual usando um Load Balancer público.</span><span class="sxs-lookup"><span data-stu-id="23774-303">Provide [outbound connectivity](/azure/load-balancer/load-balancer-outbound-connections) for VMs inside your virtual network by using a public Load Balancer.</span></span>

- <span data-ttu-id="23774-304">**Distribua cargas pelos regiões com um Gerenciador de tráfego, como o Gerenciador de tráfego do Azure.**</span><span class="sxs-lookup"><span data-stu-id="23774-304">**Balance loads across regions with a traffic manager, such as Azure Traffic Manager.**</span></span> <span data-ttu-id="23774-305">Balancear a carga de tráfego entre regiões requer uma solução de gerenciamento de tráfego e o Azure fornece [Gerenciador de tráfego](https://azure.microsoft.com/services/traffic-manager/).</span><span class="sxs-lookup"><span data-stu-id="23774-305">To load-balance traffic across regions requires a traffic management solution, and Azure provides [Traffic Manager](https://azure.microsoft.com/services/traffic-manager/).</span></span> <span data-ttu-id="23774-306">Você também pode tirar proveito dos serviços de terceiros que oferecem recursos semelhantes de gerenciamento de tráfego.</span><span class="sxs-lookup"><span data-stu-id="23774-306">You can also take advantage of third-party services that provide similar traffic-management capabilities.</span></span>

## <a name="implement-resiliency-strategies"></a><span data-ttu-id="23774-307">Implementar estratégias de resiliência</span><span class="sxs-lookup"><span data-stu-id="23774-307">Implement resiliency strategies</span></span>

<span data-ttu-id="23774-308">Esta seção descreve algumas estratégias comuns de resiliência.</span><span class="sxs-lookup"><span data-stu-id="23774-308">This section describes some common resiliency strategies.</span></span> <span data-ttu-id="23774-309">A maioria dessas estratégias não está limitada a uma tecnologia específica.</span><span class="sxs-lookup"><span data-stu-id="23774-309">Most of these strategies are not limited to a particular technology.</span></span> <span data-ttu-id="23774-310">As descrições resumem a ideia geral por trás de cada técnica e incluem links para leitura adicional.</span><span class="sxs-lookup"><span data-stu-id="23774-310">The descriptions summarize the general idea behind each technique and include links to further reading.</span></span>

- <span data-ttu-id="23774-311">**Implementar padrões de resiliência** para operações remotas, quando apropriado.</span><span class="sxs-lookup"><span data-stu-id="23774-311">**Implement resiliency patterns** for remote operations, where appropriate.</span></span> <span data-ttu-id="23774-312">Se seu aplicativo depende da comunicação entre serviços remotos, siga [padrões de design](../patterns/category/resiliency.md) para lidar com falhas transitórias.</span><span class="sxs-lookup"><span data-stu-id="23774-312">If your application depends on communication between remote services, follow [design patterns](../patterns/category/resiliency.md) for dealing with transient failures.</span></span>

- <span data-ttu-id="23774-313">**Repetição de falhas transitórias.**</span><span class="sxs-lookup"><span data-stu-id="23774-313">**Retry transient failures.**</span></span> <span data-ttu-id="23774-314">Isso pode ser provocado por perda momentânea de conectividade de rede, uma conexão de banco de dados descartados ou um tempo limite quando um serviço está ocupado.</span><span class="sxs-lookup"><span data-stu-id="23774-314">These can be caused by momentary loss of network connectivity, a dropped database connection, or a timeout when a service is busy.</span></span> <span data-ttu-id="23774-315">Muitas vezes, uma falha temporária pode ser resolvida repetindo-se a solicitação.</span><span class="sxs-lookup"><span data-stu-id="23774-315">Often, a transient failure can be resolved by retrying the request.</span></span>

  - <span data-ttu-id="23774-316">Para muitos serviços do Azure, o kit de desenvolvimento de software (SDK) cliente implementa novas tentativas automáticas de forma transparente para o chamador.</span><span class="sxs-lookup"><span data-stu-id="23774-316">For many Azure services, the client software development kit (SDK) implements automatic retries in a way that is transparent to the caller.</span></span> <span data-ttu-id="23774-317">Ver [diretrizes de repetição para serviços específicos](../best-practices/retry-service-specific.md).</span><span class="sxs-lookup"><span data-stu-id="23774-317">See [Retry guidance for specific services](../best-practices/retry-service-specific.md).</span></span>
  - <span data-ttu-id="23774-318">Ou implementar o [padrão de repetição](../patterns/retry.md) para ajudar a lidar com falhas previstas e temporárias transparente quando ele tenta se conectar a um serviço ou recurso de rede do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="23774-318">Or implement the [Retry pattern](../patterns/retry.md) to help the application handle anticipated, temporary failures transparently when it tries to connect to a service or network resource.</span></span>

- <span data-ttu-id="23774-319">**Usar um disjuntor** para lidar com falhas que possam consumir uma quantidade variável de tempo para serem corrigidos.</span><span class="sxs-lookup"><span data-stu-id="23774-319">**Use a circuit breaker** to handle faults that might take a variable amount of time to fix.</span></span> <span data-ttu-id="23774-320">O [padrão de disjuntor](../patterns/circuit-breaker.md) pode impedir que um aplicativo tentar repetidamente uma operação que provavelmente falhará.</span><span class="sxs-lookup"><span data-stu-id="23774-320">The [Circuit Breaker pattern](../patterns/circuit-breaker.md) can prevent an application from repeatedly trying an operation that is likely to fail.</span></span> <span data-ttu-id="23774-321">O disjuntor encapsula as chamadas em um serviço e controla o número de falhas recentes.</span><span class="sxs-lookup"><span data-stu-id="23774-321">The circuit breaker wraps calls to a service and tracks the number of recent failures.</span></span> <span data-ttu-id="23774-322">Se a contagem de falhas exceder um limite, o disjuntor será iniciado retornando um código de erro sem chamar o serviço.</span><span class="sxs-lookup"><span data-stu-id="23774-322">If the failure count exceeds a threshold, the circuit breaker starts returning an error code without calling the service.</span></span> <span data-ttu-id="23774-323">Isso fornece o tempo de serviço de recuperação e ajuda a evitar falhas em cascata.</span><span class="sxs-lookup"><span data-stu-id="23774-323">This gives the service time to recover and helps avoid cascading failures.</span></span>
- <span data-ttu-id="23774-324">**Isole recursos críticos.**</span><span class="sxs-lookup"><span data-stu-id="23774-324">**Isolate critical resources.**</span></span> <span data-ttu-id="23774-325">Falhas em um subsistema podem, às vezes, em cascata, resultando em falhas em outras partes do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="23774-325">Failures in one subsystem can sometimes cascade, resulting in failures in other parts of the application.</span></span> <span data-ttu-id="23774-326">Isso pode acontecer se uma falha impede que recursos como threads ou soquetes seja liberado, levando a exaustão de recursos.</span><span class="sxs-lookup"><span data-stu-id="23774-326">This can happen if a failure prevents resources such as threads or sockets from being freed, leading to resource exhaustion.</span></span> <span data-ttu-id="23774-327">Para evitar isso, você pode particionar um sistema em grupos isolados, de modo que uma falha em uma partição não coloca todo o sistema inoperante.</span><span class="sxs-lookup"><span data-stu-id="23774-327">To avoid this, you can partition a system into isolated groups so that a failure in one partition does not bring down the entire system.</span></span>

    <span data-ttu-id="23774-328">Aqui estão alguns exemplos dessa técnica, que é chamado, às vezes, o [padrão de Bulkhead](../patterns/bulkhead.md):</span><span class="sxs-lookup"><span data-stu-id="23774-328">Here are some examples of this technique, which is sometimes called the [Bulkhead pattern](../patterns/bulkhead.md):</span></span>

  - <span data-ttu-id="23774-329">Particionar um banco de dados (por exemplo, por Locatário) e atribua um pool separado de instâncias do servidor web para cada partição.</span><span class="sxs-lookup"><span data-stu-id="23774-329">Partition a database (for example, by tenant), and assign a separate pool of web server instances for each partition.</span></span>
  - <span data-ttu-id="23774-330">Usar pools de threads separados, para isolar as chamadas para diferentes serviços.</span><span class="sxs-lookup"><span data-stu-id="23774-330">Use separate thread pools to isolate calls to different services.</span></span> <span data-ttu-id="23774-331">Isso ajuda a evitar falhas em cascata, se houver falha em um dos serviços.</span><span class="sxs-lookup"><span data-stu-id="23774-331">This helps to prevent cascading failures if one of the services fails.</span></span> <span data-ttu-id="23774-332">Por exemplo, consulte o Netflix [biblioteca Hystrix](https://medium.com/netflix-techblog/introducing-hystrix-for-resiliency-engineering-13531c1ab362).</span><span class="sxs-lookup"><span data-stu-id="23774-332">For an example, see the Netflix [Hystrix library](https://medium.com/netflix-techblog/introducing-hystrix-for-resiliency-engineering-13531c1ab362).</span></span>
  - <span data-ttu-id="23774-333">Use [contêineres](https://en.wikipedia.org/wiki/Operating-system-level_virtualization) para limitar os recursos disponíveis para um determinado subsistema.</span><span class="sxs-lookup"><span data-stu-id="23774-333">Use [containers](https://en.wikipedia.org/wiki/Operating-system-level_virtualization) to limit the resources available to a particular subsystem.</span></span>

      ![Diagrama do padrão de Bulkhead](_images/bulkhead.png)

- <span data-ttu-id="23774-335">**Aplique [ *transações de compensação*](../patterns/compensating-transaction.md)**.</span><span class="sxs-lookup"><span data-stu-id="23774-335">**Apply [*compensating transactions*](../patterns/compensating-transaction.md)**.</span></span> <span data-ttu-id="23774-336">Uma transação de compensação é uma operação que desfaz os efeitos de outra transação concluída.</span><span class="sxs-lookup"><span data-stu-id="23774-336">A compensating transaction is a transaction that undoes the effects of another completed transaction.</span></span> <span data-ttu-id="23774-337">Em um sistema distribuído, pode ser difícil de obter consistência transacional sólida.</span><span class="sxs-lookup"><span data-stu-id="23774-337">In a distributed system, it can be difficult to achieve strong transactional consistency.</span></span> <span data-ttu-id="23774-338">Transações de compensação ajudam a obter consistência usando uma série de transações individuais menores, que podem ser desfeitas em cada etapa.</span><span class="sxs-lookup"><span data-stu-id="23774-338">Compensating transactions help to achieve consistency by using a series of smaller, individual transactions that can be undone at each step.</span></span> <span data-ttu-id="23774-339">Por exemplo, para fazer uma viagem, um cliente pode precisar reservar um voo, acomodações de hotel e um carro.</span><span class="sxs-lookup"><span data-stu-id="23774-339">For example, to book a trip, a customer might reserve a car, a hotel room, and a flight.</span></span> <span data-ttu-id="23774-340">Se uma destas etapas falhar, toda a operação falhará.</span><span class="sxs-lookup"><span data-stu-id="23774-340">If one of these steps fails, the entire operation fails.</span></span> <span data-ttu-id="23774-341">Em vez de tentar usar uma única transação distribuída em toda a operação, você pode definir uma transação de compensação para cada etapa.</span><span class="sxs-lookup"><span data-stu-id="23774-341">Instead of trying to use a single distributed transaction for the entire operation, you can define a compensating transaction for each step.</span></span>
- <span data-ttu-id="23774-342">**Implementar operações assíncronas, sempre que possível.**</span><span class="sxs-lookup"><span data-stu-id="23774-342">**Implement asynchronous operations, whenever possible.**</span></span> <span data-ttu-id="23774-343">Operações síncronas podem monopolizar os recursos e bloquear outras operações enquanto o chamador aguarda a conclusão do processo.</span><span class="sxs-lookup"><span data-stu-id="23774-343">Synchronous operations can monopolize resources and block other operations while the caller waits for the process to complete.</span></span> <span data-ttu-id="23774-344">Crie cada parte do seu aplicativo para permitir operações assíncronas, sempre que possível.</span><span class="sxs-lookup"><span data-stu-id="23774-344">Design each part of your application to allow for asynchronous operations, whenever possible.</span></span> <span data-ttu-id="23774-345">Para obter mais informações sobre como implementar a programação assíncrona em C\#, consulte [programação assíncrona](/dotnet/articles/csharp/async).</span><span class="sxs-lookup"><span data-stu-id="23774-345">For more information on how to implement asynchronous programming in C\#, see [Asynchronous Programming](/dotnet/articles/csharp/async).</span></span>

## <a name="ensure-that-availability-meets-slas"></a><span data-ttu-id="23774-346">Certifique-se de que a disponibilidade atenda aos SLAs</span><span class="sxs-lookup"><span data-stu-id="23774-346">Ensure that availability meets SLAs</span></span>

<span data-ttu-id="23774-347">*Disponibilidade* é a proporção de tempo que um sistema está funcionando, e é um dos [pilares da qualidade do software](../guide/pillars.md).</span><span class="sxs-lookup"><span data-stu-id="23774-347">*Availability* is the proportion of time that a system is functional and working, and it is one of the [pillars of software quality](../guide/pillars.md).</span></span> <span data-ttu-id="23774-348">Use as tarefas nesta seção para examinar a arquitetura de aplicativo de um ponto de vista de disponibilidade para certificar-se de que sua disponibilidade atende aos seus SLAs.</span><span class="sxs-lookup"><span data-stu-id="23774-348">Use the tasks in this section to review your application architecture from an availability standpoint to make sure that your availability meets your SLAs.</span></span>

- <span data-ttu-id="23774-349">**Evite quaisquer pontos únicos de falha.**</span><span class="sxs-lookup"><span data-stu-id="23774-349">**Avoid any single point of failure.**</span></span> <span data-ttu-id="23774-350"> Todos os componentes, serviços, recursos e instâncias de computação devem ser implantados como várias instâncias para impedir que um ponto único de falha afete a disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="23774-350">All components, services, resources, and compute instances should be deployed as multiple instances to prevent a single point of failure from affecting availability.</span></span> <span data-ttu-id="23774-351">Mecanismos de autenticação também podem ser um ponto único de falha.</span><span class="sxs-lookup"><span data-stu-id="23774-351">Authentication mechanisms can also be a single point of failure.</span></span> <span data-ttu-id="23774-352">O design do aplicativo para ser configurável para usar várias instâncias e para detectar falhas e redirecionar as solicitações para instâncias sem falha, se a plataforma não faz isso automaticamente.</span><span class="sxs-lookup"><span data-stu-id="23774-352">Design the application to be configurable to use multiple instances and to automatically detect failures and redirect requests to non-failed instances, if the platform doesn't do this automatically.</span></span>
- <span data-ttu-id="23774-353">**Decompor as cargas de trabalho por objetivo de nível de serviço.**</span><span class="sxs-lookup"><span data-stu-id="23774-353">**Decompose workloads by service-level objective.**</span></span> <span data-ttu-id="23774-354"> Se um serviço for composto por cargas de trabalho críticas e outras menos críticas, gerencie-as de maneira diferente e especifique os recursos de serviço e o número de instâncias para atender aos requisitos de disponibilidade dessas cargas de trabalho.</span><span class="sxs-lookup"><span data-stu-id="23774-354">If a service is composed of critical and less-critical workloads, manage them differently and specify the service features and number of instances to meet their availability requirements.</span></span>
- <span data-ttu-id="23774-355">**Minimize e entenda as dependências de serviço.**</span><span class="sxs-lookup"><span data-stu-id="23774-355">**Minimize and understand service dependencies.**</span></span> <span data-ttu-id="23774-356">Minimize o número de serviços diferentes usados, sempre que possível.</span><span class="sxs-lookup"><span data-stu-id="23774-356">Minimize the number of different services used, where possible.</span></span> <span data-ttu-id="23774-357">Certifique-se de que você compreenda todas as dependências de recurso e o serviço existem no sistema.</span><span class="sxs-lookup"><span data-stu-id="23774-357">Ensure that you understand all the feature and service dependencies that exist in the system.</span></span> <span data-ttu-id="23774-358">Em particular, compreenda o impacto geral de falha ou redução do desempenho em cada dependência.</span><span class="sxs-lookup"><span data-stu-id="23774-358">In particular, understand the overall impact of failure or reduced performance in each dependency.</span></span>
- <span data-ttu-id="23774-359">**Crie tarefas e as mensagens sejam *idempotente*, sempre que possível.**</span><span class="sxs-lookup"><span data-stu-id="23774-359">**Design tasks and messages to be *idempotent*, where possible.**</span></span> <span data-ttu-id="23774-360">Uma operação é idempotente caso possa ser repetida várias vezes e produzir o mesmo resultado.</span><span class="sxs-lookup"><span data-stu-id="23774-360">An operation is idempotent if it can be repeated multiple times and produce the same result.</span></span> <span data-ttu-id="23774-361">Isso pode garantir que solicitações duplicadas não causem problemas.</span><span class="sxs-lookup"><span data-stu-id="23774-361">This can ensure that duplicated requests don't cause problems.</span></span> <span data-ttu-id="23774-362">Consumidores de mensagens e as operações que eles realizam devem ser idempotentes de modo que repetir uma operação executada anteriormente não torne os resultados inválidos.</span><span class="sxs-lookup"><span data-stu-id="23774-362">Message consumers and the operations they carry out should be idempotent so that repeating a previously executed operation does not render the results invalid.</span></span> <span data-ttu-id="23774-363">Isso pode significar detecção duplicada de mensagens ou garantir a consistência usando uma abordagem otimista para tratar dos conflitos.</span><span class="sxs-lookup"><span data-stu-id="23774-363">This may mean detecting duplicated messages or ensuring consistency by using an optimistic approach to handling conflicts.</span></span>
- <span data-ttu-id="23774-364">**Configure o tempo limite de solicitações.**</span><span class="sxs-lookup"><span data-stu-id="23774-364">**Configure request timeouts.**</span></span> <span data-ttu-id="23774-365">Serviços e recursos podem tornar-se indisponíveis, fazendo com que determinadas solicitações falhem.</span><span class="sxs-lookup"><span data-stu-id="23774-365">Services and resources may become unavailable, causing requests to fail.</span></span> <span data-ttu-id="23774-366">Certifique-se de que os tempos limite aplicados são apropriados para cada serviço ou recurso e para o cliente que está acessando-os.</span><span class="sxs-lookup"><span data-stu-id="23774-366">Ensure that the timeouts you apply are appropriate for each service or resource and for the client that is accessing them.</span></span> <span data-ttu-id="23774-367">Em alguns casos, você pode permitir um tempo limite maior para uma instância específica de um cliente, dependendo do contexto e de outras ações que o cliente esteja realizando.</span><span class="sxs-lookup"><span data-stu-id="23774-367">In some cases, you might allow a longer timeout for a particular instance of a client, depending on the context and other actions that the client is performing.</span></span> <span data-ttu-id="23774-368">Tempos limite curto pode causar operações excessivas de repetição para serviços e recursos que têm uma latência considerável.</span><span class="sxs-lookup"><span data-stu-id="23774-368">Short timeouts may cause excessive retry operations for services and resources that have considerable latency.</span></span> <span data-ttu-id="23774-369">Tempos limite longo pode causar o bloqueio, se um grande número de solicitações é enfileirado, aguardando um serviço ou recurso para responder.</span><span class="sxs-lookup"><span data-stu-id="23774-369">Long timeouts can cause blocking, if a large number of requests are queued, waiting for a service or resource to respond.</span></span>
- <span data-ttu-id="23774-370">**Use um agente de mensagem que implemente alta disponibilidade para transações críticas.**</span><span class="sxs-lookup"><span data-stu-id="23774-370">**Use a message broker that implements high availability for critical transactions.**</span></span> <span data-ttu-id="23774-371">Muitos aplicativos de nuvem usam a mensagem para disparar tarefas assíncronas.</span><span class="sxs-lookup"><span data-stu-id="23774-371">Many cloud applications use messaging to trigger asynchronous tasks.</span></span> <span data-ttu-id="23774-372">Para garantir a entrega de mensagens, o sistema de mensagens deve oferecer alta disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="23774-372">To guarantee delivery of messages, the messaging system should provide high availability.</span></span> <span data-ttu-id="23774-373">[Mensagens de barramento de serviço do Azure](/azure/service-bus-messaging) implementa *pelo menos uma vez* semântica, o que significa que uma mensagem é garantida para ser entregue pelo menos uma vez.</span><span class="sxs-lookup"><span data-stu-id="23774-373">[Azure Service Bus messaging](/azure/service-bus-messaging) implements *at least once* semantics, which means that a message is guaranteed to be delivered at least once.</span></span> <span data-ttu-id="23774-374">Podem ser entregue mensagens duplicadas em determinadas circunstâncias.</span><span class="sxs-lookup"><span data-stu-id="23774-374">Duplicate messages may be delivered under certain circumstances.</span></span> <span data-ttu-id="23774-375">Se o processamento de mensagens for idempotente (consulte o item anterior), a repetição na entrega não deverá ser um problema.</span><span class="sxs-lookup"><span data-stu-id="23774-375">If message processing is idempotent (see the previous item), repeated delivery should not be a problem.</span></span>
- <span data-ttu-id="23774-376">**Limite os usuários de alto volume.**</span><span class="sxs-lookup"><span data-stu-id="23774-376">**Throttle high-volume users.**</span></span> <span data-ttu-id="23774-377">Às vezes, um pequeno número de usuários cria carga excessiva.</span><span class="sxs-lookup"><span data-stu-id="23774-377">Sometimes, a small number of users creates excessive load.</span></span> <span data-ttu-id="23774-378">Isso pode ter um impacto em outros usuários e pode reduzir a disponibilidade geral do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="23774-378">This can have an impact on other users and can reduce the overall availability of your application.</span></span> <span data-ttu-id="23774-379">Quando um único cliente faz um número excessivo de solicitações, o aplicativo pode limitá-lo por um determinado período.</span><span class="sxs-lookup"><span data-stu-id="23774-379">When a single client makes an excessive number of requests, the application might throttle the client for a certain period.</span></span> <span data-ttu-id="23774-380">Durante o período de limitação, o aplicativo recusa algumas ou todas as solicitações desse cliente.</span><span class="sxs-lookup"><span data-stu-id="23774-380">During the throttling period, the application refuses some or all of the requests from that client.</span></span> <span data-ttu-id="23774-381">O limite de limitação geralmente depende da camada de serviço do cliente.</span><span class="sxs-lookup"><span data-stu-id="23774-381">The threshold for throttling often depends on the customer's service tier.</span></span> <span data-ttu-id="23774-382">Para obter mais informações, consulte [padrão de limitação](../patterns/throttling.md).</span><span class="sxs-lookup"><span data-stu-id="23774-382">For more information, see [Throttling pattern](../patterns/throttling.md).</span></span>

    <span data-ttu-id="23774-383">A limitação não significa que o cliente necessariamente estava agindo maliciosamente &mdash; apenas que ele excedeu sua cota de serviço.</span><span class="sxs-lookup"><span data-stu-id="23774-383">Throttling does not imply that the client was necessarily acting maliciously &mdash; only that it exceeded its service quota.</span></span> <span data-ttu-id="23774-384">Pode acontecer que o consumidor exceda sua cota frequentemente, ou que seu comportamento seja, de alguma forma, incorreto.</span><span class="sxs-lookup"><span data-stu-id="23774-384">In some cases, a consumer might consistently exceed their quota or otherwise behave badly.</span></span> <span data-ttu-id="23774-385">Nesse caso, você pode ser mais enérgico e bloquear esse usuário.</span><span class="sxs-lookup"><span data-stu-id="23774-385">In that case, you might go further and block the user.</span></span> <span data-ttu-id="23774-386">Normalmente, isso é feito bloqueando-se uma chave de API ou um intervalo de endereços IP.</span><span class="sxs-lookup"><span data-stu-id="23774-386">Typically, this is done by blocking an API key or an IP address range.</span></span>
- <span data-ttu-id="23774-387">**Criar aplicativos que degradem normalmente.**</span><span class="sxs-lookup"><span data-stu-id="23774-387">**Design applications to gracefully degrade.**</span></span> <span data-ttu-id="23774-388">A carga em um aplicativo pode exceder a capacidade de uma ou mais partes, causando disponibilidade reduzida e conexões com falha.</span><span class="sxs-lookup"><span data-stu-id="23774-388">The load on an application may exceed the capacity of one or more parts, causing reduced availability and failed connections.</span></span> <span data-ttu-id="23774-389">Dimensionamento pode atenuar esse problema, mas ele pode atingir um limite imposto por outros fatores, como disponibilidade de recursos ou custo.</span><span class="sxs-lookup"><span data-stu-id="23774-389">Scaling can mitigate this problem, but it may reach a limit imposed by other factors, such as resource availability or cost.</span></span> <span data-ttu-id="23774-390">Quando um aplicativo atinge o limite de um recurso, ele deve tomar uma ação apropriada para minimizar o impacto para o usuário.</span><span class="sxs-lookup"><span data-stu-id="23774-390">When an application reaches a resource limit, it should take appropriate action to minimize the impact for the user.</span></span> <span data-ttu-id="23774-391">Por exemplo, em um sistema de comércio eletrônico, se o subsistema de processamento de pedidos estiver sobrecarregado ou falhar, ele pode ser desabilitado temporariamente, permitindo que outras funcionalidades, como procurar o catálogo de produtos.</span><span class="sxs-lookup"><span data-stu-id="23774-391">For example, in an e-commerce system, if the order-processing subsystem is under strain or fails, it can be temporarily disabled while allowing other functionality, such as browsing the product catalog.</span></span> <span data-ttu-id="23774-392">Pode ser apropriado adiar solicitações a um subsistema com falha &mdash; por exemplo, permitindo que os clientes enviem pedidos, mas salvando-os para processamento posterior, quando o subsistema de pedidos estiver disponível novamente.</span><span class="sxs-lookup"><span data-stu-id="23774-392">It might be appropriate to postpone requests to a failing subsystem &mdash; for example, still enabling customers to submit orders but saving them for later processing, when the orders subsystem is available again.</span></span>
- <span data-ttu-id="23774-393">**Tratar eventos rápidos de intermitência normalmente.**</span><span class="sxs-lookup"><span data-stu-id="23774-393">**Gracefully handle rapid burst events.**</span></span> <span data-ttu-id="23774-394">A maioria dos aplicativos precisa lidar com cargas de trabalho que variam ao longo do tempo.</span><span class="sxs-lookup"><span data-stu-id="23774-394">Most applications need to handle varying workloads over time.</span></span> <span data-ttu-id="23774-395">Dimensionamento automático pode ajudar a lidar com a carga, mas pode levar algum tempo para instâncias adicionais ficarem online e lidar com solicitações.</span><span class="sxs-lookup"><span data-stu-id="23774-395">Autoscaling can help to handle the load, but it may take some time for additional instances to come online and handle requests.</span></span> <span data-ttu-id="23774-396">Para evitar picos de atividade sobrecarreguem o aplicativo, o design para enfileirar solicitações para os serviços que usa e degradar normalmente quando as filas estiverem próximos da capacidade.</span><span class="sxs-lookup"><span data-stu-id="23774-396">To prevent bursts of activity from overwhelming the application, design it to queue requests to the services it uses and to degrade gracefully when queues are near capacity.</span></span> <span data-ttu-id="23774-397">Verifique se há desempenho e capacidade suficientes disponíveis sob condições sem intermitência para esvaziar as filas e tratar de solicitações pendentes.</span><span class="sxs-lookup"><span data-stu-id="23774-397">Ensure there is sufficient performance and capacity available under non-burst conditions to drain the queues and handle outstanding requests.</span></span> <span data-ttu-id="23774-398">Para saber mais, confira [Padrão de nivelamento de carga baseado em fila](../patterns/queue-based-load-leveling.md).</span><span class="sxs-lookup"><span data-stu-id="23774-398">For more information, see the [Queue-Based Load Leveling pattern](../patterns/queue-based-load-leveling.md).</span></span>
- <span data-ttu-id="23774-399">**Compor ou executar failback para vários componentes.**</span><span class="sxs-lookup"><span data-stu-id="23774-399">**Compose or fail back to multiple components.**</span></span> <span data-ttu-id="23774-400">Crie aplicativos para usar múltiplas instâncias sem afetar a operação e as conexões existentes, sempre que possível.</span><span class="sxs-lookup"><span data-stu-id="23774-400">Design applications to use multiple instances without affecting operation and existing connections, where possible.</span></span> <span data-ttu-id="23774-401">Para maximizar a disponibilidade, use várias instâncias e distribuir solicitações entre elas e detectar e evitar o envio de solicitações para instâncias com falha.</span><span class="sxs-lookup"><span data-stu-id="23774-401">To maximize availability, use multiple instances and distribute requests between them, and detect and avoid sending requests to failed instances.</span></span>
- <span data-ttu-id="23774-402">**Executar failback para um fluxo de trabalho ou um serviço diferente.**</span><span class="sxs-lookup"><span data-stu-id="23774-402">**Fail back to a different service or workflow.**</span></span> <span data-ttu-id="23774-403">Por exemplo, se a gravação no banco de dados SQL falhar, temporariamente armazene dados no armazenamento de BLOBs ou Cache Redis.</span><span class="sxs-lookup"><span data-stu-id="23774-403">For example, if writing to SQL Database fails, temporarily store data in Blob storage or Redis Cache.</span></span> <span data-ttu-id="23774-404">Forneça uma forma para repetir as gravações no Banco de Dados SQL quando o serviço ficar disponível.</span><span class="sxs-lookup"><span data-stu-id="23774-404">Provide a way to replay the writes to SQL Database when the service becomes available.</span></span> <span data-ttu-id="23774-405">Em alguns casos, uma operação com falha pode ter uma ação alternativa que permite que o aplicativo continue a funcionar, mesmo quando um componente ou serviço falha.</span><span class="sxs-lookup"><span data-stu-id="23774-405">In some cases, a failed operation may have an alternative action that allows the application to continue to work, even when a component or service fails.</span></span> <span data-ttu-id="23774-406">Se possível, detectar falhas e redirecionar as solicitações para outros serviços, enquanto o serviço primário estiver offline.</span><span class="sxs-lookup"><span data-stu-id="23774-406">If possible, detect failures and redirect requests to other services while the primary service is offline.</span></span>
- <span data-ttu-id="23774-407">**Use o nivelamento de carga para suavizar picos no tráfego.**</span><span class="sxs-lookup"><span data-stu-id="23774-407">**Use load leveling to smooth out spikes in traffic.**</span></span> <span data-ttu-id="23774-408">Aplicativos podem enfrentar picos repentinos no tráfego e sobrecarregar o serviços de back-end.</span><span class="sxs-lookup"><span data-stu-id="23774-408">Applications may experience sudden spikes in traffic, which can overwhelm services on the back end.</span></span> <span data-ttu-id="23774-409">Se um serviço de back-end não pode responder a solicitações rápido o suficiente, as solicitações pendentes podem se acumular ou o serviço pode restringir o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="23774-409">If a back-end service cannot respond to requests quickly enough, the pending requests may accumulate or the service may throttle the application.</span></span> <span data-ttu-id="23774-410">Para evitar isso, você pode usar uma fila como buffer.</span><span class="sxs-lookup"><span data-stu-id="23774-410">To avoid this, you can use a queue as a buffer.</span></span> <span data-ttu-id="23774-411">Quando há um novo item de trabalho, em vez de chamar o serviço de back-end imediatamente, o aplicativo enfileira um item de trabalho para ser executado de forma assíncrona.</span><span class="sxs-lookup"><span data-stu-id="23774-411">When there is a new work item, instead of calling the back-end service immediately, the application queues a work item to run asynchronously.</span></span> <span data-ttu-id="23774-412">A fila atua como buffer e diminui os picos na carga.</span><span class="sxs-lookup"><span data-stu-id="23774-412">The queue acts as a buffer that smooths out peaks in the load.</span></span> <span data-ttu-id="23774-413">Para obter mais informações, consulte [padrão de nivelamento de carga baseado em fila](../patterns/queue-based-load-leveling.md).</span><span class="sxs-lookup"><span data-stu-id="23774-413">For more information, see [Queue-Based Load Leveling pattern](../patterns/queue-based-load-leveling.md).</span></span>

## <a name="manage-your-data"></a><span data-ttu-id="23774-414">Gerenciar seus dados</span><span class="sxs-lookup"><span data-stu-id="23774-414">Manage your data</span></span>

<span data-ttu-id="23774-415">Como gerenciar seus dados é reproduzido diretamente para a disponibilidade do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="23774-415">How you manage your data plays directly into the availability of your application.</span></span> <span data-ttu-id="23774-416">As tarefas nesta seção podem ajudá-lo a criar um plano de gerenciamento para ajudar a garantir a disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="23774-416">The tasks in this section can help you create a management plan to help ensure availability.</span></span>

- <span data-ttu-id="23774-417">**Replicar os dados e entender os métodos de replicação para armazenamentos de dados do seu aplicativo.**</span><span class="sxs-lookup"><span data-stu-id="23774-417">**Replicate data and understand the replication methods for your application's data stores.**</span></span> <span data-ttu-id="23774-418">A replicação de dados é uma estratégia geral para manipular falhas não transitórias em um armazenamento de dados.</span><span class="sxs-lookup"><span data-stu-id="23774-418">Replicating data is a general strategy for handling non-transient failures in a data store.</span></span> <span data-ttu-id="23774-419">Considere os caminhos de leitura e gravação.</span><span class="sxs-lookup"><span data-stu-id="23774-419">Consider both the read and write paths.</span></span> <span data-ttu-id="23774-420">Dependendo da tecnologia de armazenamento, você pode ter várias réplicas graváveis, ou você pode ter uma única réplica gravável e várias réplicas de somente leitura.</span><span class="sxs-lookup"><span data-stu-id="23774-420">Depending on the storage technology, you might have multiple writable replicas or you might have a single writable replica and multiple read-only replicas.</span></span> <span data-ttu-id="23774-421">Para maximizar a disponibilidade, as réplicas podem ser colocadas em várias regiões.</span><span class="sxs-lookup"><span data-stu-id="23774-421">To maximize availability, replicas can be placed in multiple regions.</span></span> <span data-ttu-id="23774-422">No entanto, essa abordagem aumenta a latência na replicação de dados.</span><span class="sxs-lookup"><span data-stu-id="23774-422">However, this approach increases the latency when replicating the data.</span></span> <span data-ttu-id="23774-423">Normalmente, a replicação entre regiões é feita de forma assíncrona, o que implica um modelo de consistência eventual e a possível perda de dados, se uma réplica falhar.</span><span class="sxs-lookup"><span data-stu-id="23774-423">Typically, replicating across regions is done asynchronously, which implies an eventual consistency model and potential data loss if a replica fails.</span></span>  

  <span data-ttu-id="23774-424">Você pode usar [Azure Site Recovery](/azure/site-recovery/azure-to-azure-quickstart/) para replicar máquinas virtuais do Azure de uma região para outra.</span><span class="sxs-lookup"><span data-stu-id="23774-424">You can use [Azure Site Recovery](/azure/site-recovery/azure-to-azure-quickstart/) to replicate Azure Virtual Machines from one region to another.</span></span> <span data-ttu-id="23774-425">O Site Recovery replica os dados continuamente para a região de destino.</span><span class="sxs-lookup"><span data-stu-id="23774-425">Site Recovery replicates data continuously to the target region.</span></span> <span data-ttu-id="23774-426">Quando ocorrer uma interrupção no seu site primário, você realiza o failover para um local secundário.</span><span class="sxs-lookup"><span data-stu-id="23774-426">When an outage occurs at your primary site, you fail over to a secondary location.</span></span>

- <span data-ttu-id="23774-427">**Assegure que nenhuma conta de usuário individual tenha acesso aos dados de backup e de produção.**</span><span class="sxs-lookup"><span data-stu-id="23774-427">**Ensure that no single user account has access to both production and backup data.**</span></span> <span data-ttu-id="23774-428">Os backups de dados são comprometidos se uma única conta de usuário tem permissão para gravar tanto para origens de gravação quanto de backup.</span><span class="sxs-lookup"><span data-stu-id="23774-428">Your data backups are compromised if one single user account has permission to write to both production and backup sources.</span></span> <span data-ttu-id="23774-429">Um usuário mal-intencionado pode excluir propositadamente todos os seus dados e um usuário normal pode excluí-los acidentalmente.</span><span class="sxs-lookup"><span data-stu-id="23774-429">A malicious user could purposely delete all your data, and a regular user could accidentally delete it.</span></span> <span data-ttu-id="23774-430">Projete seu aplicativo para limitar as permissões de cada conta de usuário.</span><span class="sxs-lookup"><span data-stu-id="23774-430">Design your application to limit the permissions of each user account.</span></span> <span data-ttu-id="23774-431">Somente conceder acesso de gravação a usuários que precisam dele e conceder acesso a produção ou backup, mas não ambos.</span><span class="sxs-lookup"><span data-stu-id="23774-431">Only grant write access to users who require it, and grant access to either production or backup, but not both.</span></span>
- <span data-ttu-id="23774-432">**Documente e teste o processo de failover e failback de repositório de dados.**</span><span class="sxs-lookup"><span data-stu-id="23774-432">**Document and test your data store failover and failback process.**</span></span> <span data-ttu-id="23774-433">Se um repositório de dados falhe de modo catastrófico, um operador humano siga um conjunto de instruções documentadas para fazer failover para um novo repositório de dados.</span><span class="sxs-lookup"><span data-stu-id="23774-433">If a data store fails catastrophically, a human operator must follow a set of documented instructions to fail over to a new data store.</span></span> <span data-ttu-id="23774-434">Se as etapas documentadas tiverem erros, um operador não será possível com êxito, segui-las e fazer failover do recurso.</span><span class="sxs-lookup"><span data-stu-id="23774-434">If the documented steps have errors, an operator won't be able to successfully follow them and to fail over the resource.</span></span> <span data-ttu-id="23774-435">Teste regularmente as etapas de instrução para verificar se um operador que segue a documentação com êxito pode fazer failover e failback.</span><span class="sxs-lookup"><span data-stu-id="23774-435">Regularly test the instruction steps to verify that an operator who follows the documentation can successfully fail over and fail back.</span></span>
- <span data-ttu-id="23774-436">**Fazer backup dos dados e validar os backups de dados.**</span><span class="sxs-lookup"><span data-stu-id="23774-436">**Back up your data and validate your data backups.**</span></span> <span data-ttu-id="23774-437">Executar regularmente um script para validar a integridade dos dados, esquema e consultas para garantir que os dados de backup são o esperado.</span><span class="sxs-lookup"><span data-stu-id="23774-437">Regularly run a script to validate data integrity, schema, and queries to ensure that backup data is what you expect.</span></span> <span data-ttu-id="23774-438">Registre em log e relate as inconsistências de modo que o serviço de backup possa ser reparado.</span><span class="sxs-lookup"><span data-stu-id="23774-438">Log and report any inconsistencies so the backup service can be repaired.</span></span>
- <span data-ttu-id="23774-439">**Use backup periódico e restauração point-in-time.**</span><span class="sxs-lookup"><span data-stu-id="23774-439">**Use periodic backup and point-in-time restore.**</span></span> <span data-ttu-id="23774-440">Regularmente e automaticamente fazer backup de dados que não são preservados em outro lugar.</span><span class="sxs-lookup"><span data-stu-id="23774-440">Regularly and automatically back up data that is not preserved elsewhere.</span></span> <span data-ttu-id="23774-441">Verifique se que você pode restaurar de modo confiável os dados e o próprio aplicativo se ocorrer falha.</span><span class="sxs-lookup"><span data-stu-id="23774-441">Verify that you can reliably restore both the data and the application itself if failure occurs.</span></span> <span data-ttu-id="23774-442">Certifique-se de que os backups de atender ao RPO.</span><span class="sxs-lookup"><span data-stu-id="23774-442">Ensure that backups meet your RPO.</span></span> <span data-ttu-id="23774-443">Replicação de dados não é um recurso de backup porque o erro humano ou operações maliciosas podem corromper dados em todas as réplicas.</span><span class="sxs-lookup"><span data-stu-id="23774-443">Data replication isn't a backup feature, because human error or malicious operations can corrupt data across all the replicas.</span></span> <span data-ttu-id="23774-444">O processo de backup deve ser seguro, para proteger os dados em trânsito e em armazenamento.</span><span class="sxs-lookup"><span data-stu-id="23774-444">The backup process must be secure to protect the data in transit and in storage.</span></span> <span data-ttu-id="23774-445">Bancos de dados geralmente podem ser recuperados para um ponto anterior no tempo usando os logs de transação.</span><span class="sxs-lookup"><span data-stu-id="23774-445">Databases can usually be recovered to a previous point in time by using transaction logs.</span></span> <span data-ttu-id="23774-446">Para obter mais informações, consulte [recuperação de dados corrompidos ou exclusão acidental](../resiliency/recovery-data-corruption.md).</span><span class="sxs-lookup"><span data-stu-id="23774-446">For more information, see [Recover from data corruption or accidental deletion](../resiliency/recovery-data-corruption.md).</span></span>
- <span data-ttu-id="23774-447">**Considere o uso de uma conta de armazenamento com redundância geográfica.**</span><span class="sxs-lookup"><span data-stu-id="23774-447">**Consider using a geo-redundant storage account.**</span></span> <span data-ttu-id="23774-448">Dados armazenados em uma Conta de Armazenamento do Azure são sempre replicados localmente.</span><span class="sxs-lookup"><span data-stu-id="23774-448">Data stored in an Azure Storage account is always replicated locally.</span></span> <span data-ttu-id="23774-449">No entanto, há várias estratégias de replicação para escolher quando uma conta de armazenamento é provisionada.</span><span class="sxs-lookup"><span data-stu-id="23774-449">However, there are multiple replication strategies to choose from when a storage account is provisioned.</span></span> <span data-ttu-id="23774-450">Para proteger os dados do aplicativo no caso raro quando uma região inteira fica indisponível, marque [armazenamento com redundância geográfica do Azure acesso de leitura (RA-GRS)](/azure/storage/storage-redundancy/#read-access-geo-redundant-storage).</span><span class="sxs-lookup"><span data-stu-id="23774-450">To protect your application data against the rare case when an entire region becomes unavailable, select [Azure Read-Access Geo-Redundant Storage (RA-GRS)](/azure/storage/storage-redundancy/#read-access-geo-redundant-storage).</span></span>  

    > [!NOTE]
    > <span data-ttu-id="23774-451">Para VMs, não dependa da replicação de RA-GRS para restaurar os discos de VM (arquivos VHD).</span><span class="sxs-lookup"><span data-stu-id="23774-451">For VMs, do not rely on RA-GRS replication to restore the VM disks (VHD files).</span></span> <span data-ttu-id="23774-452">Em vez disso, use o [Backup do Azure](/azure/backup).</span><span class="sxs-lookup"><span data-stu-id="23774-452">Instead, use [Azure Backup](/azure/backup).</span></span>

- <span data-ttu-id="23774-453">**Considere a implantação de dados de referência para várias regiões.**</span><span class="sxs-lookup"><span data-stu-id="23774-453">**Consider deploying reference data to multiple regions.**</span></span> <span data-ttu-id="23774-454">Os dados de referência são somente leitura e compatíveis com a funcionalidade do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="23774-454">Reference data is read-only data that supports application functionality.</span></span> <span data-ttu-id="23774-455">Ele normalmente não muda com frequência.</span><span class="sxs-lookup"><span data-stu-id="23774-455">It typically doesn't change often.</span></span> <span data-ttu-id="23774-456">Embora a restauração do backup é uma maneira de lidar com interrupções de serviço em toda a região, o RTO é relativamente longo.</span><span class="sxs-lookup"><span data-stu-id="23774-456">Although restoring from backup is one way to handle region-wide service disruptions, the RTO is relatively long.</span></span> <span data-ttu-id="23774-457">Quando você implanta o aplicativo em uma região secundária, algumas estratégias podem melhorar o RTO para dados de referência.</span><span class="sxs-lookup"><span data-stu-id="23774-457">When you deploy the application to a secondary region, some strategies can improve the RTO for reference data.</span></span>

    <span data-ttu-id="23774-458">Porque as alterações de dados de referência com pouca frequência, você pode melhorar o RTO mantendo uma cópia permanente na região secundária.</span><span class="sxs-lookup"><span data-stu-id="23774-458">Because reference data changes infrequently, you can improve the RTO by maintaining a permanent copy in the secondary region.</span></span> <span data-ttu-id="23774-459">Isso elimina o tempo necessário para restaurar backups após um desastre.</span><span class="sxs-lookup"><span data-stu-id="23774-459">This eliminates the time required to restore backups after a disaster.</span></span> <span data-ttu-id="23774-460">Para atender aos requisitos de recuperação de desastre em várias regiões, você deve implantar o aplicativo e os dados de referência juntos em várias regiões.</span><span class="sxs-lookup"><span data-stu-id="23774-460">To meet the multiple-region disaster recovery requirements, you must deploy the application and the reference data together in multiple regions.</span></span>

- <span data-ttu-id="23774-461">**Use a simultaneidade otimista e consistência eventual.**</span><span class="sxs-lookup"><span data-stu-id="23774-461">**Use optimistic concurrency and eventual consistency.**</span></span> <span data-ttu-id="23774-462">As transações que bloqueiam o acesso aos recursos por meio de bloqueio (*simultaneidade pessimista*) pode causar baixo desempenho e reduzir a disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="23774-462">Transactions that block access to resources through locking (*pessimistic concurrency*) can cause poor performance and reduce availability.</span></span> <span data-ttu-id="23774-463">Esses problemas podem se tornar especialmente críticos em sistemas distribuídos.</span><span class="sxs-lookup"><span data-stu-id="23774-463">These problems can become especially acute in distributed systems.</span></span> <span data-ttu-id="23774-464">Em muitos casos, o design cuidadoso e técnicas, como particionamento, podem minimizar a possibilidade de ocorrência de atualizações conflitantes.</span><span class="sxs-lookup"><span data-stu-id="23774-464">In many cases, careful design and techniques, such as partitioning, can minimize the chances of conflicting updates occurring.</span></span> <span data-ttu-id="23774-465">Se os dados são replicados ou ler de um repositório atualizado separadamente, os dados só serão eventualmente consistentes.</span><span class="sxs-lookup"><span data-stu-id="23774-465">If data is replicated or read from a separately updated store, the data will only be eventually consistent.</span></span> <span data-ttu-id="23774-466">Mas as vantagens normalmente superam o impacto na disponibilidade do uso de transações para garantir consistência imediata.</span><span class="sxs-lookup"><span data-stu-id="23774-466">But the advantages usually outweigh the impact on availability of using transactions to ensure immediate consistency.</span></span>
- <span data-ttu-id="23774-467">**Use a replicação geográfica ativa para banco de dados SQL para replicar as alterações para um banco de dados secundário.**</span><span class="sxs-lookup"><span data-stu-id="23774-467">**Use active geo-replication for SQL Database to replicate changes to a secondary database.**</span></span> <span data-ttu-id="23774-468">A replicação geográfica ativa para banco de dados SQL replica automaticamente alterações de banco de dados para bancos de dados secundários na mesma região ou uma região diferente.</span><span class="sxs-lookup"><span data-stu-id="23774-468">Active geo-replication for SQL Database automatically replicates database changes to secondary databases in the same region or a different region.</span></span> <span data-ttu-id="23774-469">Para obter mais informações, consulte [criando e usando a replicação geográfica ativa](/azure/sql-database/sql-database-active-geo-replication).</span><span class="sxs-lookup"><span data-stu-id="23774-469">For more information, see [Creating and using active geo-replication](/azure/sql-database/sql-database-active-geo-replication).</span></span>

  <span data-ttu-id="23774-470">Como alternativa, você pode adotar uma abordagem mais manual usando o **cópia de banco de dados** comando para criar uma cópia de backup do banco de dados com consistência transacional.</span><span class="sxs-lookup"><span data-stu-id="23774-470">Alternatively, you can take a more manual approach by using the **DATABASE COPY** command to create a backup copy of the database with transactional consistency.</span></span> <span data-ttu-id="23774-471">Você também pode usar o serviço de importação/exportação do Banco de Dados SQL do Azure, que oferece suporte à exportação de bancos de dados para arquivos BACPAC (arquivos compactados contendo o esquema de banco de dados e dados associados) que são armazenados no armazenamento de Blobs do Azure.</span><span class="sxs-lookup"><span data-stu-id="23774-471">You can also use the import/export service of Azure SQL Database, which supports exporting databases to BACPAC files (compressed files containing your database schema and associated data) that are stored in Azure Blob storage.</span></span> <span data-ttu-id="23774-472">O armazenamento do Azure cria duas réplicas do arquivo de backup na mesma região.</span><span class="sxs-lookup"><span data-stu-id="23774-472">Azure Storage creates two replicas of the backup file in the same region.</span></span> <span data-ttu-id="23774-473">No entanto, a frequência do processo de backup determina o RPO, que é a quantidade de dados que você pode perder em cenários de desastre.</span><span class="sxs-lookup"><span data-stu-id="23774-473">However, the frequency of the backup process determines your RPO, which is the amount of data you might lose in disaster scenarios.</span></span> <span data-ttu-id="23774-474">Por exemplo, se você fazer backup de dados a cada hora e um desastre ocorre dois minutos antes do backup, você perderá 58 minutos de dados.</span><span class="sxs-lookup"><span data-stu-id="23774-474">For example, if you back up data every hour, and a disaster occurs two minutes before the backup, you will lose 58 minutes of data.</span></span> <span data-ttu-id="23774-475">Além disso, para se proteger de uma interrupção do serviço de toda a região, você deve copiar os arquivos BACPAC para uma região alternativa.</span><span class="sxs-lookup"><span data-stu-id="23774-475">Also, to protect against a region-wide service disruption, you should copy the BACPAC files to an alternate region.</span></span> <span data-ttu-id="23774-476">Para obter mais informações, consulte [visão geral da continuidade dos negócios com o banco de dados do Azure SQL](/azure/sql-database/sql-database-business-continuity).</span><span class="sxs-lookup"><span data-stu-id="23774-476">For more information, see [Overview of business continuity with Azure SQL Database](/azure/sql-database/sql-database-business-continuity).</span></span>

- <span data-ttu-id="23774-477">**Use backups geográficos do SQL Data Warehouse.**</span><span class="sxs-lookup"><span data-stu-id="23774-477">**Use geo-backups for SQL Data Warehouse.**</span></span> <span data-ttu-id="23774-478">Para o SQL Data Warehouse, use [backups geográficos](/azure/sql-data-warehouse/backup-and-restore) para restaurar uma região emparelhada para recuperação de desastre.</span><span class="sxs-lookup"><span data-stu-id="23774-478">For SQL Data Warehouse, use [geo-backups](/azure/sql-data-warehouse/backup-and-restore) to restore to a paired region for disaster recovery.</span></span> <span data-ttu-id="23774-479">Esses backups são realizados a cada 24 horas e podem ser restaurados em 20 minutos na região emparelhada.</span><span class="sxs-lookup"><span data-stu-id="23774-479">These backups are taken every 24 hours and can be restored within 20 minutes in the paired region.</span></span> <span data-ttu-id="23774-480">Esse recurso está ativado por padrão para todas as instâncias do SQL Data Warehouse.</span><span class="sxs-lookup"><span data-stu-id="23774-480">This feature is on by default for all SQL Data Warehouse instances.</span></span> <span data-ttu-id="23774-481">Para obter mais informações sobre como restaurar seu data warehouse, consulte [restaurar a partir de uma região geográfica do Azure usando o PowerShell.](/azure/sql-data-warehouse/sql-data-warehouse-restore)</span><span class="sxs-lookup"><span data-stu-id="23774-481">For more information on how to restore your data warehouse, see [Restore from an Azure geographical region using PowerShell.](/azure/sql-data-warehouse/sql-data-warehouse-restore)</span></span>

- <span data-ttu-id="23774-482">**Replique discos de VMs usando o Azure Site Recovery.**</span><span class="sxs-lookup"><span data-stu-id="23774-482">**Replicate VM disks using Azure Site Recovery.**</span></span> <span data-ttu-id="23774-483">Quando você replicar VMs do Azure usando [recuperação de Site](/azure/site-recovery/), todos os discos VM são replicados continuamente para a região de destino assincronamente.</span><span class="sxs-lookup"><span data-stu-id="23774-483">When you replicate Azure VMs using [Site Recovery](/azure/site-recovery/), all the VM disks are continuously replicated to the target region asynchronously.</span></span> <span data-ttu-id="23774-484">Os pontos de replicação são criados a cada poucos minutos.</span><span class="sxs-lookup"><span data-stu-id="23774-484">The recovery points are created every few minutes.</span></span> <span data-ttu-id="23774-485">Isso lhe dá um RPO na ordem de minutos.</span><span class="sxs-lookup"><span data-stu-id="23774-485">This gives you an RPO on the order of minutes.</span></span>
- <span data-ttu-id="23774-486">**Fazer backup do SQL Server em execução em VMs ou configure uma sessão de envio de logs.**</span><span class="sxs-lookup"><span data-stu-id="23774-486">**Back up SQL Server running on VMs or configure a log-shipping session.**</span></span> <span data-ttu-id="23774-487">Para o SQL Server em execução em VMs, há duas opções: backups tradicionais e envio de logs.</span><span class="sxs-lookup"><span data-stu-id="23774-487">For SQL Server running on VMs, there are two options: traditional backups and log shipping.</span></span> <span data-ttu-id="23774-488">Backups tradicionais permitem que você restaurar para um ponto específico no tempo, mas o processo de recuperação é lento.</span><span class="sxs-lookup"><span data-stu-id="23774-488">Traditional backups enable you to restore to a specific point in time, but the recovery process is slow.</span></span> <span data-ttu-id="23774-489">Restauração de backups tradicionais exige que você comece com um backup completo inicial e, em seguida, aplique quaisquer backups feitos depois que.</span><span class="sxs-lookup"><span data-stu-id="23774-489">Restoring traditional backups requires that you start with an initial full backup and then apply any backups taken after that.</span></span> <span data-ttu-id="23774-490">A segunda opção é configurar uma sessão de envio de logs para atrasar a restauração de backups de log (por exemplo, por duas horas).</span><span class="sxs-lookup"><span data-stu-id="23774-490">The second option is to configure a log-shipping session to delay the restore of log backups (for example, by two hours).</span></span> <span data-ttu-id="23774-491">Isso fornece uma janela para recuperação de erros feitos no primário.</span><span class="sxs-lookup"><span data-stu-id="23774-491">This provides a window to recover from errors made on the primary.</span></span>
- <span data-ttu-id="23774-492">**Use uma ferramenta de terceiros ou de processo personalizado para o backup do armazenamento do Azure.**</span><span class="sxs-lookup"><span data-stu-id="23774-492">**Use a custom process or third-party tool for Azure Storage backup.**</span></span> <span data-ttu-id="23774-493">Armazenamento do Azure, você pode desenvolver um processo de backup personalizado ou usar uma ferramenta de backup de terceiros.</span><span class="sxs-lookup"><span data-stu-id="23774-493">For Azure Storage, you can develop a custom backup process or use a third-party backup tool.</span></span> <span data-ttu-id="23774-494">A maioria dos designs de aplicativo tem complexidades adicionais, no qual armazenamento recursos referenciam uns aos outros.</span><span class="sxs-lookup"><span data-stu-id="23774-494">Most application designs have additional complexities, in which storage resources reference each other.</span></span> <span data-ttu-id="23774-495">Por exemplo, considere um banco de dados SQL com uma coluna que se vincula a um blob no armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="23774-495">For example, consider a SQL database with a column that links to a blob in Azure Storage.</span></span> <span data-ttu-id="23774-496">Se os backups não acontecerem simultaneamente, o banco de dados poderá ter um ponteiro voltado a um blob do qual não foi feito backup antes da falha.</span><span class="sxs-lookup"><span data-stu-id="23774-496">If the backups do not happen simultaneously, the database might have a pointer to a blob that was not backed up before the failure.</span></span> <span data-ttu-id="23774-497">O plano de recuperação de desastre ou aplicativo deve implementar processos para tratar dessa inconsistência após uma recuperação.</span><span class="sxs-lookup"><span data-stu-id="23774-497">The application or disaster recovery plan must implement processes to handle this inconsistency after a recovery.</span></span>
- <span data-ttu-id="23774-498">**Use os recursos de instantâneo ou replicação nativa para outras plataformas de dados hospedadas em máquinas virtuais.**</span><span class="sxs-lookup"><span data-stu-id="23774-498">**Use the native replication or snapshot capabilities for other data platforms hosted on VMs.**</span></span> <span data-ttu-id="23774-499">Outras plataformas de dados, como Elasticsearch ou MongoDB, têm seus próprios recursos e considerações ao criar um backup integrado e o processo de restauração.</span><span class="sxs-lookup"><span data-stu-id="23774-499">Other data platforms, such as Elasticsearch or MongoDB, have their own capabilities and considerations when creating an integrated backup and restore process.</span></span> <span data-ttu-id="23774-500">Para essas plataformas de dados, a recomendação geral é usar os recursos de instantâneo ou de qualquer replicação baseada em integração nativa ou disponível.</span><span class="sxs-lookup"><span data-stu-id="23774-500">For these data platforms, the general recommendation is to use any native or available integration-based replication or snapshot capabilities.</span></span> <span data-ttu-id="23774-501">Se esses recursos não existem ou não são adequados, considere o uso de instantâneos de disco ou Backup do Azure para criar uma cópia de point-in-time de dados do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="23774-501">If those capabilities don't exist or aren't suitable, consider using Azure Backup or disk snapshots to create a point-in-time copy of application data.</span></span> <span data-ttu-id="23774-502">Em todos os casos, é importante determinar como realizar backups consistentes, especialmente quando os dados de aplicativo se estende por vários sistemas de arquivos ou várias unidades são combinadas em um único sistema de arquivos.</span><span class="sxs-lookup"><span data-stu-id="23774-502">In all cases, it's important to determine how to achieve consistent backups, especially when application data spans multiple files systems or multiple drives are combined into a single file system.</span></span>
- <span data-ttu-id="23774-503">**Entenda os métodos de replicação para as fontes de dados do aplicativo.**</span><span class="sxs-lookup"><span data-stu-id="23774-503">**Understand the replication methods for your application's data sources.**</span></span> <span data-ttu-id="23774-504">Os dados do aplicativo serão armazenados em diferentes fontes de dados e serão variaram com requisitos de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="23774-504">Your application data will be stored in different data sources and will have varied availability requirements.</span></span> <span data-ttu-id="23774-505">Avaliar os métodos de replicação para cada tipo de armazenamento de dados no Azure, incluindo [redundância do armazenamento do Azure](/azure/storage/storage-redundancy/) e [banco de dados SQL a replicação geográfica ativa](/azure/sql-database/sql-database-geo-replication-overview/) para garantir que seu aplicativo dados requisitos forem atendidos.</span><span class="sxs-lookup"><span data-stu-id="23774-505">Evaluate the replication methods for each type of data storage in Azure, including [Azure Storage redundancy](/azure/storage/storage-redundancy/) and [SQL Database active geo-replication](/azure/sql-database/sql-database-geo-replication-overview/) to ensure that your application's data requirements are satisfied.</span></span> <span data-ttu-id="23774-506">Se você replicar VMs do Azure usando [recuperação de Site](/azure/site-recovery/), todos os discos VM são replicados continuamente para a região de destino assincronamente.</span><span class="sxs-lookup"><span data-stu-id="23774-506">If you replicate Azure VMs using [Site Recovery](/azure/site-recovery/), all the VM disks are continuously replicated to the target region asynchronously.</span></span> <span data-ttu-id="23774-507">Os pontos de replicação são criados a cada poucos minutos.</span><span class="sxs-lookup"><span data-stu-id="23774-507">The recovery points are created every few minutes.</span></span>
- <span data-ttu-id="23774-508">**Estabeleça estratégias de dados para recuperação de desastres.**</span><span class="sxs-lookup"><span data-stu-id="23774-508">**Establish data strategies for disaster recovery.**</span></span> <span data-ttu-id="23774-509">Tratamento adequado dos dados é um aspecto desafiador de qualquer plano de recuperação de desastres.</span><span class="sxs-lookup"><span data-stu-id="23774-509">Proper data handling is a challenging aspect of any disaster recovery plan.</span></span> <span data-ttu-id="23774-510">Durante o processo de recuperação, a restauração de dados geralmente leva mais tempo.</span><span class="sxs-lookup"><span data-stu-id="23774-510">During the recovery process, data restoration typically takes the most time.</span></span> <span data-ttu-id="23774-511">Opções diferentes para reduzir a funcionalidade resultam em desafios difíceis para recuperação de dados e consistência.</span><span class="sxs-lookup"><span data-stu-id="23774-511">Different choices for reducing functionality result in difficult challenges for data recovery and consistency.</span></span>

## <a name="next-steps"></a><span data-ttu-id="23774-512">Próximos passos</span><span class="sxs-lookup"><span data-stu-id="23774-512">Next steps</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="23774-513">Testar a resiliência e disponibilidade</span><span class="sxs-lookup"><span data-stu-id="23774-513">Test for resiliency and availability</span></span>](./testing.md)
