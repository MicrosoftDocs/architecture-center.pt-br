---
title: Arquitetura orientada a eventos
description: "Descreve os benefícios, os desafios e as práticas recomendadas para eventos e arquiteturas de IoT no Azure"
author: MikeWasson
ms.openlocfilehash: ff7f936ceabefe7079a1ebbfa717ff4095bf133b
ms.sourcegitcommit: b0482d49aab0526be386837702e7724c61232c60
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/14/2017
---
# <a name="event-driven-architecture-style"></a><span data-ttu-id="efe31-103">Arquitetura orientada a eventos</span><span class="sxs-lookup"><span data-stu-id="efe31-103">Event-driven architecture style</span></span>

<span data-ttu-id="efe31-104">Consiste em uma arquitetura orientada a eventos de **produtores de eventos** que geram um fluxo de eventos, e **consumidores dos eventos** que escutam eventos.</span><span class="sxs-lookup"><span data-stu-id="efe31-104">An event-driven architecture consists of **event producers** that generate a stream of events, and **event consumers** that listen for the events.</span></span> 

![](./images/event-driven.svg)

<span data-ttu-id="efe31-105">Os eventos são entregues quase em tempo real, para que os consumidores possam responder imediatamente conforme os eventos ocorrem.</span><span class="sxs-lookup"><span data-stu-id="efe31-105">Events are delivered in near real time, so consumers can respond immediately to events as they occur.</span></span> <span data-ttu-id="efe31-106">Os produtores são separados dos consumidores &mdash;. Um produtor não sabe quais consumidores estão ouvindo.</span><span class="sxs-lookup"><span data-stu-id="efe31-106">Producers are decoupled from consumers &mdash; a producer doesn't know which consumers are listening.</span></span> <span data-ttu-id="efe31-107">Os consumidores também são separados uns dos outros; e cada consumidor vê todos os eventos.</span><span class="sxs-lookup"><span data-stu-id="efe31-107">Consumers are also decoupled from each other, and every consumer sees all of the events.</span></span> <span data-ttu-id="efe31-108">Isso difere do padrão de [Consumidores Concorrentes][competing-consumers], onde os consumidores removem mensagens de uma fila, e uma mensagem é processada apenas uma vez (presumindo que não haja erros).</span><span class="sxs-lookup"><span data-stu-id="efe31-108">This differs from a [Competing Consumers][competing-consumers] pattern, where consumers pull messages from a queue and a message is processed just once (assuming no errors).</span></span> <span data-ttu-id="efe31-109">Em alguns sistemas, como IoT, os eventos devem ser incluídos em volumes muito altos.</span><span class="sxs-lookup"><span data-stu-id="efe31-109">In some systems, such as IoT, events must be ingested at very high volumes.</span></span>

<span data-ttu-id="efe31-110">Um evento controlado por arquitetura pode usar um modelo de pub/sub ou um modelo de fluxo de evento.</span><span class="sxs-lookup"><span data-stu-id="efe31-110">An event driven architecture can use a pub/sub model or an event stream model.</span></span> 

- <span data-ttu-id="efe31-111">**Pub/sub**: a infraestrutura de mensagens acompanha o controle de assinaturas.</span><span class="sxs-lookup"><span data-stu-id="efe31-111">**Pub/sub**: The messaging infrastructure keeps track of subscriptions.</span></span> <span data-ttu-id="efe31-112">Quando um evento é publicado, ele envia o evento para cada assinante.</span><span class="sxs-lookup"><span data-stu-id="efe31-112">When an event is published, it sends the event to each subscriber.</span></span> <span data-ttu-id="efe31-113">Depois que um evento é recebido, ele não pode ser reproduzido e não será exibido para assinantes novos.</span><span class="sxs-lookup"><span data-stu-id="efe31-113">After an event is received, it cannot be replayed, and new subscribers do not see the event.</span></span> 

- <span data-ttu-id="efe31-114">**Streaming de eventos**: eventos são gravados em um registro.</span><span class="sxs-lookup"><span data-stu-id="efe31-114">**Event streaming**: Events are written to a log.</span></span> <span data-ttu-id="efe31-115">Os eventos são estritamente ordenados (dentro de uma partição) e duráveis.</span><span class="sxs-lookup"><span data-stu-id="efe31-115">Events are strictly ordered (within a partition) and durable.</span></span> <span data-ttu-id="efe31-116">Os clientes não assinam o fluxo, em vez disso, um cliente pode ler a partir de qualquer parte do fluxo.</span><span class="sxs-lookup"><span data-stu-id="efe31-116">Clients don't subscribe to the stream, instead a client can read from any part of the stream.</span></span> <span data-ttu-id="efe31-117">O cliente é responsável por avançar a sua posição no fluxo.</span><span class="sxs-lookup"><span data-stu-id="efe31-117">The client is responsible for advancing its position in the stream.</span></span> <span data-ttu-id="efe31-118">Isso significa que um cliente pode participar a qualquer momento e pode reproduzir eventos.</span><span class="sxs-lookup"><span data-stu-id="efe31-118">That means a client can join at any time, and can replay events.</span></span>

<span data-ttu-id="efe31-119">No lado do consumidor, há algumas variações comuns:</span><span class="sxs-lookup"><span data-stu-id="efe31-119">On the consumer side, there are some common variations:</span></span>

- <span data-ttu-id="efe31-120">**Processamento de eventos simples**.</span><span class="sxs-lookup"><span data-stu-id="efe31-120">**Simple event processing**.</span></span> <span data-ttu-id="efe31-121">Um evento dispara imediatamente uma ação no consumidor.</span><span class="sxs-lookup"><span data-stu-id="efe31-121">An event immediately triggers an action in the consumer.</span></span> <span data-ttu-id="efe31-122">Por exemplo, você pode usar as Azure Functions com um gatilho de Barramento de Serviço para que uma função seja executada sempre que uma mensagem é publicada em um tópico do Barramento de Serviço.</span><span class="sxs-lookup"><span data-stu-id="efe31-122">For example, you could use Azure Functions with a Service Bus trigger, so that a function executes whenever a message is published to a Service Bus topic.</span></span>

- <span data-ttu-id="efe31-123">**Processamento de eventos complexos**.</span><span class="sxs-lookup"><span data-stu-id="efe31-123">**Complex event processing**.</span></span> <span data-ttu-id="efe31-124">Um consumidor processa uma série de eventos, procurando padrões nos dados de eventos usando uma tecnologia, como o Azure Stream Analytics ou o Apache Storm.</span><span class="sxs-lookup"><span data-stu-id="efe31-124">A consumer processes a series of events, looking for patterns in the event data, using a technology such as Azure Stream Analytics or Apache Storm.</span></span> <span data-ttu-id="efe31-125">Por exemplo, você pode agregar as leituras de um dispositivo incorporado em uma janela de tempo e gerar uma notificação se a média móvel ultrapassar um certo limite.</span><span class="sxs-lookup"><span data-stu-id="efe31-125">For example, you could aggregate readings from an embedded device over a time window, and generate a notification if the moving average crosses a certain threshold.</span></span> 

- <span data-ttu-id="efe31-126">**Processamento de fluxo de eventos**.</span><span class="sxs-lookup"><span data-stu-id="efe31-126">**Event stream processing**.</span></span> <span data-ttu-id="efe31-127">Use uma plataforma de fluxo de dados, como o Hub IoT do Azure ou o Apache Kafka, como um pipeline para ingestão de eventos e os encaminhe para os processadores de fluxo.</span><span class="sxs-lookup"><span data-stu-id="efe31-127">Use a data streaming platform, such as Azure IoT Hub or Apache Kafka, as a pipeline to ingest events and feed them to stream processors.</span></span> <span data-ttu-id="efe31-128">Os processadores de fluxo agem para processar ou transformar o fluxo.</span><span class="sxs-lookup"><span data-stu-id="efe31-128">The stream processors act to process or transform the stream.</span></span> <span data-ttu-id="efe31-129">Pode haver vários processadores de fluxo para subsistemas diferentes do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="efe31-129">There may be multiple stream processors for different subsystems of the application.</span></span> <span data-ttu-id="efe31-130">Esta abordagem é uma boa opção para cargas de trabalho de IoT.</span><span class="sxs-lookup"><span data-stu-id="efe31-130">This approach is a good fit for IoT workloads.</span></span>

<span data-ttu-id="efe31-131">A fonte dos eventos pode ser externa ao sistema, como dispositivos físicos em uma solução de IoT.</span><span class="sxs-lookup"><span data-stu-id="efe31-131">The source of the events may be external to the system, such as physical devices in an IoT solution.</span></span> <span data-ttu-id="efe31-132">Nesse caso, o sistema deve ser capaz de receber os dados no volume e taxa de transferência necessários para a fonte de dados.</span><span class="sxs-lookup"><span data-stu-id="efe31-132">In that case, the system must be able to ingest the data at the volume and throughput that is required by the data source.</span></span>

<span data-ttu-id="efe31-133">No diagrama lógico acima, cada tipo de consumidor é mostrado como uma única caixa.</span><span class="sxs-lookup"><span data-stu-id="efe31-133">In the logical diagram above, each type of consumer is shown as a single box.</span></span> <span data-ttu-id="efe31-134">Na prática, é comum ter várias instâncias de um consumidor para evitar que o consumidor se torne um ponto único de falha no sistema.</span><span class="sxs-lookup"><span data-stu-id="efe31-134">In practice, it's common to have multiple instances of a consumer, to avoid having the consumer become a single point of failure in system.</span></span> <span data-ttu-id="efe31-135">Também pode ser necessário ter várias instâncias para lidar com o volume e a frequência de eventos.</span><span class="sxs-lookup"><span data-stu-id="efe31-135">Multiple instances might also be necessary to handle the volume and frequency of events.</span></span> <span data-ttu-id="efe31-136">Além disso, um único consumidor pode processar eventos em vários threads.</span><span class="sxs-lookup"><span data-stu-id="efe31-136">Also, a single consumer might process events on multiple threads.</span></span> <span data-ttu-id="efe31-137">Isso pode criar desafios se os eventos tiverem que ser processados em ordem, ou se solicitarem semânticas exatamente uma vez.</span><span class="sxs-lookup"><span data-stu-id="efe31-137">This can create challenges if events must be processed in order, or require exactly-once semantics.</span></span> <span data-ttu-id="efe31-138">Confira [Minimizar Coordenação][minimize-coordination].</span><span class="sxs-lookup"><span data-stu-id="efe31-138">See [Minimize Coordination][minimize-coordination].</span></span> 

## <a name="when-to-use-this-architecture"></a><span data-ttu-id="efe31-139">Quando usar essa arquitetura</span><span class="sxs-lookup"><span data-stu-id="efe31-139">When to use this architecture</span></span>

- <span data-ttu-id="efe31-140">Vários subsistemas devem processar os mesmos eventos.</span><span class="sxs-lookup"><span data-stu-id="efe31-140">Multiple subsystems must process the same events.</span></span> 
- <span data-ttu-id="efe31-141">Processamento em tempo real com retardo mínimo de tempo.</span><span class="sxs-lookup"><span data-stu-id="efe31-141">Real-time processing with minimum time lag.</span></span>
- <span data-ttu-id="efe31-142">O processamento de eventos complexos, como a correspondência de padrões ou agregação em janelas de tempo.</span><span class="sxs-lookup"><span data-stu-id="efe31-142">Complex event processing, such as pattern matching or aggregation over time windows.</span></span>
- <span data-ttu-id="efe31-143">Alto volume e alta velocidade de dados, como IoT.</span><span class="sxs-lookup"><span data-stu-id="efe31-143">High volume and high velocity of data, such as IoT.</span></span>

## <a name="benefits"></a><span data-ttu-id="efe31-144">Benefícios</span><span class="sxs-lookup"><span data-stu-id="efe31-144">Benefits</span></span>

- <span data-ttu-id="efe31-145">Produtores e consumidores são separados.</span><span class="sxs-lookup"><span data-stu-id="efe31-145">Producers and consumers are decoupled.</span></span>
- <span data-ttu-id="efe31-146">Nenhuma integração de ponta a ponta.</span><span class="sxs-lookup"><span data-stu-id="efe31-146">No point-to point-integrations.</span></span> <span data-ttu-id="efe31-147">É fácil adicionar novos consumidores ao sistema.</span><span class="sxs-lookup"><span data-stu-id="efe31-147">It's easy to add new consumers to the system.</span></span>
- <span data-ttu-id="efe31-148">Os consumidores podem responder aos eventos imediatamente assim que chegarem.</span><span class="sxs-lookup"><span data-stu-id="efe31-148">Consumers can respond to events immediately as they arrive.</span></span> 
- <span data-ttu-id="efe31-149">Altamente escalonável e distribuído.</span><span class="sxs-lookup"><span data-stu-id="efe31-149">Highly scalable and distributed.</span></span> 
- <span data-ttu-id="efe31-150">Os subsistemas têm exibições independentes do fluxo de evento.</span><span class="sxs-lookup"><span data-stu-id="efe31-150">Subsystems have independent views of the event stream.</span></span>

## <a name="challenges"></a><span data-ttu-id="efe31-151">Desafios</span><span class="sxs-lookup"><span data-stu-id="efe31-151">Challenges</span></span>

- <span data-ttu-id="efe31-152">Entrega garantida.</span><span class="sxs-lookup"><span data-stu-id="efe31-152">Guaranteed delivery.</span></span> <span data-ttu-id="efe31-153">Em alguns sistemas, especialmente em situações de IoT, é crucial garantir que os eventos sejam entregues.</span><span class="sxs-lookup"><span data-stu-id="efe31-153">In some systems, especially in IoT scenarios, it's crucial to guarantee that events are delivered.</span></span>
- <span data-ttu-id="efe31-154">Eventos processados em ordem ou exatamente uma vez.</span><span class="sxs-lookup"><span data-stu-id="efe31-154">Processing events in order or exactly once.</span></span> <span data-ttu-id="efe31-155">Normalmente, cada tipo de consumidor é executado em várias instâncias de resiliência e escalabilidade.</span><span class="sxs-lookup"><span data-stu-id="efe31-155">Each consumer type typically runs in multiple instances, for resiliency and scalability.</span></span> <span data-ttu-id="efe31-156">Isso pode criar um desafio se os eventos devem ser processados em ordem (dentro de um tipo de consumidor), ou se a lógica de processamento não for idempotente.</span><span class="sxs-lookup"><span data-stu-id="efe31-156">This can create a challenge if the events must be processed in order (within a consumer type), or if the processing logic is not idempotent.</span></span>

## <a name="iot-architecture"></a><span data-ttu-id="efe31-157">Arquitetura do IoT</span><span class="sxs-lookup"><span data-stu-id="efe31-157">IoT architecture</span></span>

<span data-ttu-id="efe31-158">Arquiteturas orientadas por eventos são essenciais para soluções de IoT.</span><span class="sxs-lookup"><span data-stu-id="efe31-158">Event-driven architectures are central to IoT solutions.</span></span> <span data-ttu-id="efe31-159">O diagrama a seguir mostra uma possível arquitetura lógica de IoT.</span><span class="sxs-lookup"><span data-stu-id="efe31-159">The following diagram shows a possible logical architecture for IoT.</span></span> <span data-ttu-id="efe31-160">O diagrama enfatiza os componentes da arquitetura do streaming de eventos.</span><span class="sxs-lookup"><span data-stu-id="efe31-160">The diagram emphasizes the event-streaming components of the architecture.</span></span>

![](./images/iot.png)

<span data-ttu-id="efe31-161">O **gateway de nuvem** consome eventos de dispositivo no limite da nuvem, usando um sistema de mensagens de latência baixa e confiável.</span><span class="sxs-lookup"><span data-stu-id="efe31-161">The **cloud gateway** ingests device events at the cloud boundary, using a reliable, low latency messaging system.</span></span>

<span data-ttu-id="efe31-162">Os dispositivos podem enviar eventos diretamente para o gateway de nuvem, ou por meio de um **gateway de campo**.</span><span class="sxs-lookup"><span data-stu-id="efe31-162">Devices might send events directly to the cloud gateway, or through a **field gateway**.</span></span> <span data-ttu-id="efe31-163">Um gateway de campo é um software ou dispositivo especializado, geralmente colocado com dispositivos, que recebe eventos e os encaminha para o gateway de nuvem.</span><span class="sxs-lookup"><span data-stu-id="efe31-163">A field gateway is a specialized device or software, usually colocated with the devices, that receives events and forwards them to the cloud gateway.</span></span> <span data-ttu-id="efe31-164">O gateway de campo também pode pré-processar os eventos de dispositivo brutos executando funções, como filtragem, agregação ou transformação de protocolo.</span><span class="sxs-lookup"><span data-stu-id="efe31-164">The field gateway might also preprocess the raw device events, performing functions such as filtering, aggregation, or protocol transformation.</span></span>

<span data-ttu-id="efe31-165">Após a ingestão, os eventos passam por um ou mais **processadores de fluxo** que podem encaminhar os dados (por exemplo, para armazenamento) ou executar análise e outros tipos de processamento.</span><span class="sxs-lookup"><span data-stu-id="efe31-165">After ingestion, events go through one or more **stream processors** that can route the data (for example, to storage) or perform analytics and other processing.</span></span>

<span data-ttu-id="efe31-166">A seguir estão alguns tipos comuns de processamento.</span><span class="sxs-lookup"><span data-stu-id="efe31-166">The following are some common types of processing.</span></span> <span data-ttu-id="efe31-167">(Esta lista certamente não é exaustiva.)</span><span class="sxs-lookup"><span data-stu-id="efe31-167">(This list is certainly not exhaustive.)</span></span>

- <span data-ttu-id="efe31-168">Gravando os dados de evento para armazenamento menos acessado, para arquivamento ou análise de processo em lote.</span><span class="sxs-lookup"><span data-stu-id="efe31-168">Writing event data to cold storage, for archiving or batch analytics.</span></span>

- <span data-ttu-id="efe31-169">Análise de caminho mais acessado, analisando o fluxo de eventos (quase) em tempo real, para detectar anomalias, reconhecer padrões em janelas de tempo ou disparar alertas quando ocorre uma condição específica no fluxo.</span><span class="sxs-lookup"><span data-stu-id="efe31-169">Hot path analytics, analyzing the event stream in (near) real time, to detect anomalies, recognize patterns over rolling time windows, or trigger alerts when a specific condition occurs in the stream.</span></span> 

- <span data-ttu-id="efe31-170">Tratamento de tipos especiais de mensagens que não são de telemetria de dispositivos, como notificações e alarmes.</span><span class="sxs-lookup"><span data-stu-id="efe31-170">Handling special types of non-telemetry messages from devices, such as notifications and alarms.</span></span> 

- <span data-ttu-id="efe31-171">Machine Learning.</span><span class="sxs-lookup"><span data-stu-id="efe31-171">Machine learning.</span></span>

<span data-ttu-id="efe31-172">As caixas destacadas em cinza mostram os componentes de um sistema de IoT que não estão diretamente relacionadas ao streaming de evento, mas são incluídos aqui para fins de integridade.</span><span class="sxs-lookup"><span data-stu-id="efe31-172">The boxes that are shaded gray show components of an IoT system that are not directly related to event streaming, but are included here for completeness.</span></span>

- <span data-ttu-id="efe31-173">O **registro do dispositivo** é um banco de dados dos dispositivos provisionados, incluindo os IDs de dispositivo e metadados do dispositivo, como localização.</span><span class="sxs-lookup"><span data-stu-id="efe31-173">The **device registry** is a database of the provisioned devices, including the device IDs and usually device metadata, such as location.</span></span>

- <span data-ttu-id="efe31-174">A **API de provisionamento** é uma interface externa comum para provisionar e registrar dispositivos novos.</span><span class="sxs-lookup"><span data-stu-id="efe31-174">The **provisioning API** is a common external interface for provisioning and registering new devices.</span></span>

- <span data-ttu-id="efe31-175">Algumas soluções IoT permitem que **mensagens de comando e controle** sejam enviadas aos dispositivos.</span><span class="sxs-lookup"><span data-stu-id="efe31-175">Some IoT solutions allow **command and control messages** to be sent to devices.</span></span>

> <span data-ttu-id="efe31-176">Esta seção apresentou uma exibição de altíssimo nível do IoT e há muitas sutilezas e desafios a serem considerados.</span><span class="sxs-lookup"><span data-stu-id="efe31-176">This section has presented a very high-level view of IoT, and there are many subtleties and challenges to consider.</span></span> <span data-ttu-id="efe31-177">Para obter mais detalhes e discussões sobre a arquitetura de referência, confira [Arquitetura de Referência do Microsoft Azure IoT][iot-ref-arch] (download do PDF).</span><span class="sxs-lookup"><span data-stu-id="efe31-177">For a more detailed reference architecture and discussion, see the [Microsoft Azure IoT Reference Architecture][iot-ref-arch] (PDF download).</span></span>

 <!-- links -->

[competing-consumers]: ../../patterns/competing-consumers.md
[iot-ref-arch]: https://azure.microsoft.com/en-us/updates/microsoft-azure-iot-reference-architecture-available/
[minimize-coordination]: ../design-principles/minimize-coordination.md


