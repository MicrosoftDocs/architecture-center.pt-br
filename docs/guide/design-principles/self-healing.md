---
title: Design de autorrecuperação
titleSuffix: Azure Application Architecture Guide
description: Aplicativos resilientes podem recuperar-se de falhas sem intervenção manual.
author: MikeWasson
ms.date: 08/30/2018
ms.custom: seojan19
ms.openlocfilehash: a7aaf50b4cb1d844637c89da8e977b694481f18d
ms.sourcegitcommit: 1f4cdb08fe73b1956e164ad692f792f9f635b409
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2019
ms.locfileid: "54113509"
---
# <a name="design-for-self-healing"></a><span data-ttu-id="16655-103">Design de autorrecuperação</span><span class="sxs-lookup"><span data-stu-id="16655-103">Design for self healing</span></span>

## <a name="design-your-application-to-be-self-healing-when-failures-occur"></a><span data-ttu-id="16655-104">Desenvolva seu aplicativo para realizar autorrecuperação quando houver falhas</span><span class="sxs-lookup"><span data-stu-id="16655-104">Design your application to be self healing when failures occur</span></span>

<span data-ttu-id="16655-105">Em um sistema distribuído, falhas de acontecem.</span><span class="sxs-lookup"><span data-stu-id="16655-105">In a distributed system, failures happen.</span></span> <span data-ttu-id="16655-106">O hardware pode falhar.</span><span class="sxs-lookup"><span data-stu-id="16655-106">Hardware can fail.</span></span> <span data-ttu-id="16655-107">A rede pode ter falhas transitórias.</span><span class="sxs-lookup"><span data-stu-id="16655-107">The network can have transient failures.</span></span> <span data-ttu-id="16655-108">Raramente, um serviço ou uma região inteira pode sofrer uma interrupção. Mesmo assim, devemos estar preparados para isso.</span><span class="sxs-lookup"><span data-stu-id="16655-108">Rarely, an entire service or region may experience a disruption, but even those must be planned for.</span></span>

<span data-ttu-id="16655-109">Portanto, desenvolva um aplicativo para realizar autorrecuperação quando houver falhas.</span><span class="sxs-lookup"><span data-stu-id="16655-109">Therefore, design an application to be self healing when failures occur.</span></span> <span data-ttu-id="16655-110">Isso requer uma abordagem em três fases:</span><span class="sxs-lookup"><span data-stu-id="16655-110">This requires a three-pronged approach:</span></span>

- <span data-ttu-id="16655-111">Detectar falhas.</span><span class="sxs-lookup"><span data-stu-id="16655-111">Detect failures.</span></span>
- <span data-ttu-id="16655-112">Responder a falhas normalmente.</span><span class="sxs-lookup"><span data-stu-id="16655-112">Respond to failures gracefully.</span></span>
- <span data-ttu-id="16655-113">Registrar em log e monitorar falhas para fornecer insights operacionais.</span><span class="sxs-lookup"><span data-stu-id="16655-113">Log and monitor failures, to give operational insight.</span></span>

<span data-ttu-id="16655-114">Como você responde a um determinado tipo de falha pode depender dos requisitos de disponibilidade do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="16655-114">How you respond to a particular type of failure may depend on your application's availability requirements.</span></span> <span data-ttu-id="16655-115">Por exemplo, se você precisar de disponibilidade muito alta, poderá automaticamente fazer failover para uma região secundária durante uma interrupção regional.</span><span class="sxs-lookup"><span data-stu-id="16655-115">For example, if you require very high availability, you might automatically fail over to a secondary region during a regional outage.</span></span> <span data-ttu-id="16655-116">No entanto, isso acarretará um custo maior do que uma implantação de região única.</span><span class="sxs-lookup"><span data-stu-id="16655-116">However, that will incur a higher cost than a single-region deployment.</span></span>

<span data-ttu-id="16655-117">Além disso, não considere apenas grandes eventos, como interrupções regionais, que costumam ser raros.</span><span class="sxs-lookup"><span data-stu-id="16655-117">Also, don't just consider big events like regional outages, which are generally rare.</span></span> <span data-ttu-id="16655-118">Você deve focar tanto ou mais no tratamento de falhas locais de curta duração, como falhas de conectividade de rede ou falhas em conexões com o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="16655-118">You should focus as much, if not more, on handling local, short-lived failures, such as network connectivity failures or failed database connections.</span></span>

## <a name="recommendations"></a><span data-ttu-id="16655-119">Recomendações</span><span class="sxs-lookup"><span data-stu-id="16655-119">Recommendations</span></span>

<span data-ttu-id="16655-120">**Repita as operações com falha**.</span><span class="sxs-lookup"><span data-stu-id="16655-120">**Retry failed operations**.</span></span> <span data-ttu-id="16655-121">As falhas transitórias podem ocorrer por perda momentânea de conectividade de rede, interrupção na conexão de banco de dados ou tempo limite atingido quando um serviço está ocupado.</span><span class="sxs-lookup"><span data-stu-id="16655-121">Transient failures may occur due to momentary loss of network connectivity, a dropped database connection, or a timeout when a service is busy.</span></span> <span data-ttu-id="16655-122">Crie lógica de novas tentativas em seu aplicativo para lidar com falhas transitórias.</span><span class="sxs-lookup"><span data-stu-id="16655-122">Build retry logic into your application to handle transient failures.</span></span> <span data-ttu-id="16655-123">Para muitos serviços do Azure, o SDK do cliente implementa novas tentativas automáticas.</span><span class="sxs-lookup"><span data-stu-id="16655-123">For many Azure services, the client SDK implements automatic retries.</span></span> <span data-ttu-id="16655-124">Para saber mais, confira [Transient fault handling][transient-fault-handling] (Tratamento de falha transitória) e [Retry pattern][retry] (Padrão de nova tentativa).</span><span class="sxs-lookup"><span data-stu-id="16655-124">For more information, see [Transient fault handling][transient-fault-handling] and the [Retry pattern][retry].</span></span>

<span data-ttu-id="16655-125">**Proteger os serviços remotos com falha (interruptor de circuito)**.</span><span class="sxs-lookup"><span data-stu-id="16655-125">**Protect failing remote services (Circuit Breaker)**.</span></span> <span data-ttu-id="16655-126">É bom tentar novamente após uma falha temporária, mas se a falha persistir, você poderá acabar com muitos chamadores insistindo em um serviço com falha.</span><span class="sxs-lookup"><span data-stu-id="16655-126">It's good to retry after a transient failure, but if the failure persists, you can end up with too many callers hammering a failing service.</span></span> <span data-ttu-id="16655-127">Isso pode levar a falhas em cascata, conforme as solicitações se acumulam.</span><span class="sxs-lookup"><span data-stu-id="16655-127">This can lead to cascading failures, as requests back up.</span></span> <span data-ttu-id="16655-128">Use o [Padrão de Interruptor de Circuito][circuit-breaker] para falhar rapidamente (sem fazer a chamada remota) quando uma operação provavelmente for falhar.</span><span class="sxs-lookup"><span data-stu-id="16655-128">Use the [Circuit Breaker pattern][circuit-breaker] to fail fast (without making the remote call) when an operation is likely to fail.</span></span>

<span data-ttu-id="16655-129">**Isolar recursos críticos (bulkhead)**.</span><span class="sxs-lookup"><span data-stu-id="16655-129">**Isolate critical resources (Bulkhead)**.</span></span> <span data-ttu-id="16655-130">Falhas em um subsistema às vezes podem formar uma cascata.</span><span class="sxs-lookup"><span data-stu-id="16655-130">Failures in one subsystem can sometimes cascade.</span></span> <span data-ttu-id="16655-131">Isso pode acontecer se uma falha impedir que alguns recursos, como threads ou soquetes, sejam liberados em tempo hábil, exaurindo recursos.</span><span class="sxs-lookup"><span data-stu-id="16655-131">This can happen if a failure causes some resources, such as threads or sockets, not to get freed in a timely manner, leading to resource exhaustion.</span></span> <span data-ttu-id="16655-132">Para evitar isso, particione um sistema em grupos isolados para que a falha em uma partição não deixe todo o sistema inoperante.</span><span class="sxs-lookup"><span data-stu-id="16655-132">To avoid this, partition a system into isolated groups, so that a failure in one partition does not bring down the entire system.</span></span>

<span data-ttu-id="16655-133">**Executar o nivelamento de carga**.</span><span class="sxs-lookup"><span data-stu-id="16655-133">**Perform load leveling**.</span></span> <span data-ttu-id="16655-134">Os aplicativos podem enfrentar picos repentinos no tráfego, que podem sobrecarregar o serviços no back-end.</span><span class="sxs-lookup"><span data-stu-id="16655-134">Applications may experience sudden spikes in traffic that can overwhelm services on the backend.</span></span> <span data-ttu-id="16655-135">Para evitar isso, use o [Padrão de Nivelamento de Carga Baseado em Fila][load-level] para enfileirar itens de trabalho para que sejam executados de maneira assíncrona.</span><span class="sxs-lookup"><span data-stu-id="16655-135">To avoid this, use the [Queue-Based Load Leveling pattern][load-level] to queue work items to run asynchronously.</span></span> <span data-ttu-id="16655-136">A fila atua como buffer e diminui os picos na carga.</span><span class="sxs-lookup"><span data-stu-id="16655-136">The queue acts as a buffer that smooths out peaks in the load.</span></span>

<span data-ttu-id="16655-137">**Failover**.</span><span class="sxs-lookup"><span data-stu-id="16655-137">**Fail over**.</span></span> <span data-ttu-id="16655-138">Se não for possível alcançar uma instância, faça o failover para outra instância.</span><span class="sxs-lookup"><span data-stu-id="16655-138">If an instance can't be reached, fail over to another instance.</span></span> <span data-ttu-id="16655-139">Para elementos sem estado, como um servidor Web, coloque várias instâncias atrás de um balanceador de carga ou gerenciador de tráfego.</span><span class="sxs-lookup"><span data-stu-id="16655-139">For things that are stateless, like a web server, put several instances behind a load balancer or traffic manager.</span></span> <span data-ttu-id="16655-140">Para elementos que armazenam estado, como um banco de dados, use réplicas e failover.</span><span class="sxs-lookup"><span data-stu-id="16655-140">For things that store state, like a database, use replicas and fail over.</span></span> <span data-ttu-id="16655-141">Dependendo do armazenamento de dados e como ele replica, isso pode exigir que o aplicativo lide com possível consistência.</span><span class="sxs-lookup"><span data-stu-id="16655-141">Depending on the data store and how it replicates, this may require the application to deal with eventual consistency.</span></span>

<span data-ttu-id="16655-142">**Compensar transações com falha**.</span><span class="sxs-lookup"><span data-stu-id="16655-142">**Compensate failed transactions**.</span></span> <span data-ttu-id="16655-143">Em geral, evite transações distribuídas, pois elas exigem a coordenação entre serviços e recursos.</span><span class="sxs-lookup"><span data-stu-id="16655-143">In general, avoid distributed transactions, as they require coordination across services and resources.</span></span> <span data-ttu-id="16655-144">Em vez disso, componha uma operação usando transações individuais menores.</span><span class="sxs-lookup"><span data-stu-id="16655-144">Instead, compose an operation from smaller individual transactions.</span></span> <span data-ttu-id="16655-145">Se a operação falhar no meio, use [Como compensar transações][compensating-transactions] para desfazer qualquer etapa já concluída.</span><span class="sxs-lookup"><span data-stu-id="16655-145">If the operation fails midway through, use [Compensating Transactions][compensating-transactions] to undo any step that already completed.</span></span>

<span data-ttu-id="16655-146">**Executar ponto de verificação de transações de execução longa**.</span><span class="sxs-lookup"><span data-stu-id="16655-146">**Checkpoint long-running transactions**.</span></span> <span data-ttu-id="16655-147">Pontos de verificação podem oferecer resiliência quando uma operação de execução longa falha.</span><span class="sxs-lookup"><span data-stu-id="16655-147">Checkpoints can provide resiliency if a long-running operation fails.</span></span> <span data-ttu-id="16655-148">Quando a operação é reiniciada (por exemplo, é capturada por outra VM), ela pode ser retomada do último ponto de verificação.</span><span class="sxs-lookup"><span data-stu-id="16655-148">When the operation restarts (for example, it is picked up by another VM), it can be resumed from the last checkpoint.</span></span>

<span data-ttu-id="16655-149">**Degradar normalmente**.</span><span class="sxs-lookup"><span data-stu-id="16655-149">**Degrade gracefully**.</span></span> <span data-ttu-id="16655-150">Às vezes, você não pode solucionar um problema, mas pode fornecer funcionalidade reduzida que ainda seja útil.</span><span class="sxs-lookup"><span data-stu-id="16655-150">Sometimes you can't work around a problem, but you can provide reduced functionality that is still useful.</span></span> <span data-ttu-id="16655-151">Considere um aplicativo que mostra um catálogo de livros.</span><span class="sxs-lookup"><span data-stu-id="16655-151">Consider an application that shows a catalog of books.</span></span> <span data-ttu-id="16655-152">Se o aplicativo não puder recuperar a imagem em miniatura da capa, poderá mostrar uma imagem de espaço reservado.</span><span class="sxs-lookup"><span data-stu-id="16655-152">If the application can't retrieve the thumbnail image for the cover, it might show a placeholder image.</span></span> <span data-ttu-id="16655-153">Subsistemas inteiros podem não ser críticos para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="16655-153">Entire subsystems might be noncritical for the application.</span></span> <span data-ttu-id="16655-154">Por exemplo, em um site de comércio eletrônico, mostrar as recomendações de produto é provavelmente menos crítico que processar pedidos.</span><span class="sxs-lookup"><span data-stu-id="16655-154">For example, in an e-commerce site, showing product recommendations is probably less critical than processing orders.</span></span>

<span data-ttu-id="16655-155">**Limitar os clientes**.</span><span class="sxs-lookup"><span data-stu-id="16655-155">**Throttle clients**.</span></span> <span data-ttu-id="16655-156">Às vezes, um pequeno número de usuários cria carga excessiva, o que pode reduzir a disponibilidade do aplicativo para outros usuários.</span><span class="sxs-lookup"><span data-stu-id="16655-156">Sometimes a small number of users create excessive load, which can reduce your application's availability for other users.</span></span> <span data-ttu-id="16655-157">Nessa situação, limite o cliente a um determinado período.</span><span class="sxs-lookup"><span data-stu-id="16655-157">In this situation, throttle the client for a certain period of time.</span></span> <span data-ttu-id="16655-158">Confira o [Padrão de limitação][throttle].</span><span class="sxs-lookup"><span data-stu-id="16655-158">See the [Throttling pattern][throttle].</span></span>

<span data-ttu-id="16655-159">**Bloquear atores ruins**.</span><span class="sxs-lookup"><span data-stu-id="16655-159">**Block bad actors**.</span></span> <span data-ttu-id="16655-160">Só porque você limita um cliente, isso não significa cliente estava agindo maliciosamente.</span><span class="sxs-lookup"><span data-stu-id="16655-160">Just because you throttle a client, it doesn't mean client was acting maliciously.</span></span> <span data-ttu-id="16655-161">Significa apenas que o cliente excedeu sua cota de serviço.</span><span class="sxs-lookup"><span data-stu-id="16655-161">It just means the client exceeded their service quota.</span></span> <span data-ttu-id="16655-162">Porém, se um cliente consistentemente exceder sua cota ou comporta-se incorretamente de outra maneira, você poderá bloqueá-lo.</span><span class="sxs-lookup"><span data-stu-id="16655-162">But if a client consistently exceeds their quota or otherwise behaves badly, you might block them.</span></span> <span data-ttu-id="16655-163">Defina um processo fora de banda para o usuário solicitar seu desbloqueio.</span><span class="sxs-lookup"><span data-stu-id="16655-163">Define an out-of-band process for user to request getting unblocked.</span></span>

<span data-ttu-id="16655-164">**Usar eleição de líder**.</span><span class="sxs-lookup"><span data-stu-id="16655-164">**Use leader election**.</span></span> <span data-ttu-id="16655-165">Quando você precisar coordenar uma tarefa, use [Eleição de Líder][leader-election] para selecionar um coordenador.</span><span class="sxs-lookup"><span data-stu-id="16655-165">When you need to coordinate a task, use [Leader Election][leader-election] to select a coordinator.</span></span> <span data-ttu-id="16655-166">Dessa forma, o coordenador não será um ponto único de falha.</span><span class="sxs-lookup"><span data-stu-id="16655-166">That way, the coordinator is not a single point of failure.</span></span> <span data-ttu-id="16655-167">Se o coordenador falhar, um novo será selecionado.</span><span class="sxs-lookup"><span data-stu-id="16655-167">If the coordinator fails, a new one is selected.</span></span> <span data-ttu-id="16655-168">Em vez de implementar um algoritmo de eleição líder do zero, considere uma solução comercial, como Zookeeper.</span><span class="sxs-lookup"><span data-stu-id="16655-168">Rather than implement a leader election algorithm from scratch, consider an off-the-shelf solution such as Zookeeper.</span></span>

<span data-ttu-id="16655-169">**Teste com injeção de falha**.</span><span class="sxs-lookup"><span data-stu-id="16655-169">**Test with fault injection**.</span></span> <span data-ttu-id="16655-170">Com muita frequência, o caminho de sucesso é bem testado, mas não o caminho de falha.</span><span class="sxs-lookup"><span data-stu-id="16655-170">All too often, the success path is well tested but not the failure path.</span></span> <span data-ttu-id="16655-171">Um sistema pode executar em produção por um longo tempo antes que um caminho de falha seja utilizado.</span><span class="sxs-lookup"><span data-stu-id="16655-171">A system could run in production for a long time before a failure path is exercised.</span></span> <span data-ttu-id="16655-172">Use a injeção de teste para testar a resiliência do sistema a falhas, seja disparando falhas reais ou simulando-as.</span><span class="sxs-lookup"><span data-stu-id="16655-172">Use fault injection to test the resiliency of the system to failures, either by triggering actual failures or by simulating them.</span></span>

<span data-ttu-id="16655-173">**Adotar a engenharia caos**.</span><span class="sxs-lookup"><span data-stu-id="16655-173">**Embrace chaos engineering**.</span></span> <span data-ttu-id="16655-174">A engenharia do caos estende a noção de injeção de falha injetando aleatoriamente falhas ou condições anormais em instâncias de produção.</span><span class="sxs-lookup"><span data-stu-id="16655-174">Chaos engineering extends the notion of fault injection, by randomly injecting failures or abnormal conditions into production instances.</span></span>

<span data-ttu-id="16655-175">Para uma abordagem estruturada para tornar seus aplicativos aptos a realizar autorrecuperação, consulte [Desenvolvimento de aplicativos resilientes para o Azure][resiliency-overview].</span><span class="sxs-lookup"><span data-stu-id="16655-175">For a structured approach to making your applications self healing, see [Design resilient applications for Azure][resiliency-overview].</span></span>

<!-- links -->

[circuit-breaker]: ../../patterns/circuit-breaker.md
[compensating-transactions]: ../../patterns/compensating-transaction.md
[leader-election]: ../../patterns/leader-election.md
[load-level]: ../../patterns/queue-based-load-leveling.md
[resiliency-overview]: ../../resiliency/index.md
[retry]: ../../patterns/retry.md
[throttle]: ../../patterns/throttling.md
[transient-fault-handling]: ../../best-practices/transient-faults.md
