---
title: Pipeline de CI/CD para cargas de trabalho baseados em contêiner
description: Cenário comprovado para a criação de um pipeline DevOps para um aplicativo Web Node.js que usa Jenkins, Registro de Contêiner do Azure, Serviço de Kubernetes do Azure, Cosmos DB e Grafana.
author: iainfoulds
ms.date: 07/05/2018
ms.openlocfilehash: d9f6571234a0c3e67a233cfda1a37f6fb32929a3
ms.sourcegitcommit: 71cbef121c40ef36e2d6e3a088cb85c4260599b9
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/14/2018
ms.locfileid: "39060754"
---
# <a name="cicd-pipeline-for-container-based-workloads"></a><span data-ttu-id="0a4f8-103">Pipeline de CI/CD para cargas de trabalho baseados em contêiner</span><span class="sxs-lookup"><span data-stu-id="0a4f8-103">CI/CD pipeline for container-based workloads</span></span>

<span data-ttu-id="0a4f8-104">Este cenário de exemplo é aplicável a empresas que desejam modernizar o desenvolvimento de aplicativos usando contêineres e fluxos de trabalho de DevOps.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-104">This example scenario is applicable to businesses that want to modernize application development by using containers and DevOps workflows.</span></span> <span data-ttu-id="0a4f8-105">Neste cenário, um aplicativo Web do Node.js é criado e implantado pelo Jenkins em um Registro de Contêiner do Azure e no Serviço de Kubernetes do Azure.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-105">In this scenario, a Node.js web app is built and deployed by Jenkins into an Azure Container Registry and Azure Kubernetes Service.</span></span> <span data-ttu-id="0a4f8-106">O Azure Cosmos DB é usado para oferecer uma camada de banco de dados distribuído globalmente.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-106">For a globally distributed database tier, Azure Cosmos DB is used.</span></span> <span data-ttu-id="0a4f8-107">Para monitorar e solucionar problemas de desempenho do aplicativo, o Azure Monitor integra-se a uma instância e um painel do Grafana.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-107">To monitor and troubleshoot application performance, Azure Monitor integrates with a Grafana instance and dashboard.</span></span>

<span data-ttu-id="0a4f8-108">Entre os cenários de uso de exemplo estão o fornecimento de um ambiente de desenvolvimento automatizado, a validação de novas confirmações de código e o envio por push de novas implantações em ambientes de preparo ou produção.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-108">Example application scenarios include providing an automated development environment, validating new code commits, and pushing new deployments into staging or production environments.</span></span> <span data-ttu-id="0a4f8-109">Tradicionalmente, as empresas tinham que criar e compilar aplicativos e atualizações e manter uma base de código grande e monolítica.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-109">Traditionally, businesses had to manually build and compile applications and updates, and maintain a large, monolithic code base.</span></span> <span data-ttu-id="0a4f8-110">Com uma abordagem moderna para o desenvolvimento de aplicativos que usa CI (integração contínua) e CD (implantação contínua), você pode criar, testar e implantar serviços mais rapidamente.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-110">With a modern approach to application development that uses continuous integration (CI) and continuous deployment (CD), you can more quickly build, test, and deploy services.</span></span> <span data-ttu-id="0a4f8-111">Essa abordagem moderna permite liberar aplicativos e atualizações para seus clientes mais rapidamente e responder às mudanças nas demandas dos negócios de forma mais ágil.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-111">This modern approach lets you release applications and updates to your customers faster, and respond to changing business demands in a more agile manner.</span></span>

<span data-ttu-id="0a4f8-112">Usando serviços do Azure, como o Serviço de Kubernetes do Azure, o Registro de Contêiner e o Cosmos DB, as empresas podem usar o que há de mais recente em ferramentas e técnicas de desenvolvimento de aplicativos para simplificar o processo de implementação de alta disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-112">By using Azure services such as Azure Kubernetes Service, Container Registry, and Cosmos DB, companies can use the latest in application development techniques and tools to simplify the process of implementing high availability.</span></span>

## <a name="related-use-cases"></a><span data-ttu-id="0a4f8-113">Casos de uso relacionados</span><span class="sxs-lookup"><span data-stu-id="0a4f8-113">Related use cases</span></span>

<span data-ttu-id="0a4f8-114">Considere este cenário para os casos de uso a seguir:</span><span class="sxs-lookup"><span data-stu-id="0a4f8-114">Consider this scenario for the following use cases:</span></span>

* <span data-ttu-id="0a4f8-115">Modernizar práticas de desenvolvimento de aplicativos para uma abordagem de microsserviços baseada em contêiner.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-115">Modernizing application development practices to a microservices, container-based approach.</span></span>
* <span data-ttu-id="0a4f8-116">Acelerar o desenvolvimento de aplicativos e ciclos de vida de implantação.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-116">Speeding up application development and deployment lifecycles.</span></span>
* <span data-ttu-id="0a4f8-117">Automatizar implantações de teste ou ambientes de aceitação para validação.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-117">Automating deployments to test or acceptance environments for validation.</span></span>

## <a name="architecture"></a><span data-ttu-id="0a4f8-118">Arquitetura</span><span class="sxs-lookup"><span data-stu-id="0a4f8-118">Architecture</span></span>

![Visão geral de arquitetura dos componentes do Azure envolvidos em um cenário de DevOps usando o Jenkins, o Registro de Contêiner do Azure e o Serviço de Kubernetes do Azure][architecture]

<span data-ttu-id="0a4f8-120">Este cenário trata de um pipeline DevOps para um aplicativo Web do Node.js e um back-end de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-120">This scenario covers a DevOps pipeline for a Node.js web application and database backend.</span></span> <span data-ttu-id="0a4f8-121">O fluxo de dados neste cenário ocorre da seguinte forma:</span><span class="sxs-lookup"><span data-stu-id="0a4f8-121">The data flows through the scenario as follows:</span></span>

1. <span data-ttu-id="0a4f8-122">Um desenvolvedor faz alterações no código-fonte do aplicativo Web Node.js.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-122">A developer makes changes to the Node.js web application source code.</span></span>
2. <span data-ttu-id="0a4f8-123">A alteração de código é confirmada em um repositório de controle do código-fonte, como o GitHub.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-123">The code change is committed to a source control respository, such as GitHub.</span></span>
3. <span data-ttu-id="0a4f8-124">Para iniciar o processo de CI (integração contínua), um webhook do GitHub dispara uma compilação de projeto Jenkins.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-124">To start the continuous integration (CI) process, a GitHub webhook triggers a Jenkins project build.</span></span>
4. <span data-ttu-id="0a4f8-125">O trabalho de compilação do Jenkins usa um agente de build dinâmico no Serviço de Kubernetes do Azure para executar um processo de compilação do contêiner.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-125">The Jenkins build job uses a dynamic build agent in Azure Kubernetes Service to perform a container build process.</span></span>
5. <span data-ttu-id="0a4f8-126">Uma imagem de contêiner é criada a partir do código no controle do código-fonte e, em seguida, é enviada por push para um Registro de Contêiner do Azure.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-126">A container image is created from the code in source control, and is then pushed to an Azure Container Registry.</span></span>
6. <span data-ttu-id="0a4f8-127">Por meio da CD (implantação contínua), o Jenkins implanta essa imagem de contêiner atualizada no cluster Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-127">Through continuous deployment (CD), Jenkins deploys this updated container image to the Kubernetes cluster.</span></span>
7. <span data-ttu-id="0a4f8-128">O aplicativo Web Node.js usa o Azure Cosmos DB como seu back-end.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-128">The Node.js web application uses Azure Cosmos DB as it's backend.</span></span> <span data-ttu-id="0a4f8-129">Tanto o Cosmos DB quanto o Serviço de Kubernetes do Azure enviam métricas para o Azure Monitor.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-129">Both Cosmos DB and Azure Kubernetes Service report metrics to Azure Monitor.</span></span>
8. <span data-ttu-id="0a4f8-130">Uma instância do Grafana fornece painéis visuais sobre o desempenho do aplicativo com base nos dados do Azure Monitor.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-130">A Grafana instance provides visual dashboards of the application performance based on the data from Azure Monitor.</span></span>

### <a name="components"></a><span data-ttu-id="0a4f8-131">Componentes</span><span class="sxs-lookup"><span data-stu-id="0a4f8-131">Components</span></span>

* <span data-ttu-id="0a4f8-132">O [Jenkins] [ jenkins] é um servidor de automação de software livre que pode se integrar aos serviços do Azure para habilitar a CI (integração contínua) e a CD (implantação contínua).</span><span class="sxs-lookup"><span data-stu-id="0a4f8-132">[Jenkins][jenkins] is an open-source automation server that can integrate with Azure services to enable continuous integration (CI) and continuous deployment (CD).</span></span> <span data-ttu-id="0a4f8-133">Neste cenário, o Jenkins orquestra a criação de novas imagens de contêiner com base nas confirmações no controle do código-fonte, envia por push essas imagens para o Registro de Contêiner do Azure e atualiza as instâncias do aplicativo no Serviço de Kubernetes do Azure.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-133">In this scenario, Jenkins orchestrates the creation of new container images based on commits to source control, pushes those images to Azure Container Registry, then updates application instances in Azure Kubernetes Service.</span></span>
* <span data-ttu-id="0a4f8-134">As [Máquinas Virtuais Linux do Azure] [ azurevm-docs] são usadas para executar as instâncias do Jenkins e do Grafana.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-134">[Azure Linux Virtual Machines][azurevm-docs] are used to run the Jenkins and Grafana instances.</span></span>
* <span data-ttu-id="0a4f8-135">O [Registro de Contêiner do Azure] [ azureacr-docs] armazena e gerencia imagens de contêiner que são usadas pelo cluster do Serviço de Kubernetes do Azure.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-135">[Azure Container Registry][azureacr-docs] stores and manages container images that are used by the Azure Kubernetes Service cluster.</span></span> <span data-ttu-id="0a4f8-136">As imagens são armazenadas com segurança e podem ser replicadas em outras regiões pela plataforma do Azure para acelerar os tempos de implantação.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-136">Images are securely stored, and can replicated to other regions by the Azure platform to speed up deployment times.</span></span>
* <span data-ttu-id="0a4f8-137">O [Serviço de Kubernetes do Azure] [ azureaks-docs] é uma plataforma Kubernetes gerenciada que permite implantar e gerenciar aplicativos em contêineres sem conhecimento de orquestração de contêiner.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-137">[Azure Kubernetes Service][azureaks-docs] is a managed Kubernetes platform that lets you deploy and manage containerized applications without container orchestration expertise.</span></span> <span data-ttu-id="0a4f8-138">Como um serviço Kubernetes hospedado, o Azure lida com as tarefas críticas para você, como o monitoramento da integridade e a manutenção.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-138">As a hosted Kubernetes service, Azure handles critical tasks like health monitoring and maintenance for you.</span></span>
* <span data-ttu-id="0a4f8-139">O [Azure Cosmos DB] [ azurecosmosdb-docs] é um banco de dados multimodelo distribuído globalmente que permite que você escolha entre vários modelos de banco de dados e de consistência para atender às suas necessidades.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-139">[Azure Cosmos DB][azurecosmosdb-docs] is a globally distributed, multi-model database that allows you to choose from various database and consistency models to suit your needs.</span></span> <span data-ttu-id="0a4f8-140">Com o Cosmos DB, os dados podem ser replicados globalmente e não há a necessidade de implantação ou configuração de nenhum cluster de gerenciamento ou replicação.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-140">With Cosmos DB, your data can be globally replicated, and there is no cluster management or replication components to deploy and configure.</span></span>
* <span data-ttu-id="0a4f8-141">O [Azure Monitor][azuremonitor-docs] ajuda-o a rastrear o desempenho, manter a segurança e identificar tendências.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-141">[Azure Monitor][azuremonitor-docs] helps you track performance, maintain security, and identify trends.</span></span> <span data-ttu-id="0a4f8-142">As métricas obtidas pelo Monitor podem ser usadas por outros recursos e ferramentas, como o Grafana.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-142">Metrics obtained by Monitor can be used by other resources and tools, such as Grafana.</span></span>
* <span data-ttu-id="0a4f8-143">O [Grafana] [ grafana] é uma solução de software livre para consultar, visualizar, alertar e entender métricas.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-143">[Grafana][grafana] is an open-source solution to query, visualize, alert, and understand metrics.</span></span> <span data-ttu-id="0a4f8-144">Um plug-in da fonte de dados para o Azure Monitor permite que o Grafana crie painéis visuais para monitorar o desempenho de seus aplicativos em execução no Serviço de Kubernetes do Azure que usam o Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-144">A data source plugin for Azure Monitor allows Grafana to create visual dashboards to monitor the performance of your applications running in Azure Kubernetes Service and using Cosmos DB.</span></span>

### <a name="alternatives"></a><span data-ttu-id="0a4f8-145">Alternativas</span><span class="sxs-lookup"><span data-stu-id="0a4f8-145">Alternatives</span></span>

* <span data-ttu-id="0a4f8-146">O [Visual Studio Team Services] [ vsts] e o Team Foundation Server ajudam a implementar um pipeline de CI (integração contínua), teste e implantação (CD) em qualquer aplicativo.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-146">[Visual Studio Team Services][vsts] and Team Foundation Server help you implement a continuous integration (CI), test, and deployment (CD) pipeline for any app.</span></span>
* <span data-ttu-id="0a4f8-147">O [Kubernetes] [ kubernetes] pode ser executado diretamente em VMs do Azure em vez de usar um serviço gerenciado, se você quiser mais controle sobre o cluster.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-147">[Kubernetes][kubernetes] can be run directly on Azure VMs instead of via a managed service if you would like more control over the cluster.</span></span>
* <span data-ttu-id="0a4f8-148">O [Service Fabric] [ service-fabric] é outro orquestrador de contêiner alternativo que pode substituir o AKS.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-148">[Service Fabric][service-fabric] is another alternate container orchestrator that can replace AKS.</span></span>

## <a name="considerations"></a><span data-ttu-id="0a4f8-149">Considerações</span><span class="sxs-lookup"><span data-stu-id="0a4f8-149">Considerations</span></span>

### <a name="availability"></a><span data-ttu-id="0a4f8-150">Disponibilidade</span><span class="sxs-lookup"><span data-stu-id="0a4f8-150">Availability</span></span>

<span data-ttu-id="0a4f8-151">Para monitorar o desempenho do aplicativo e relatar problemas, esse cenário combina o Azure Monitor com o Grafana para oferecer painéis visuais.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-151">To monitor your application performance and report on issues, this scenario combines Azure Monitor with Grafana for visual dashboards.</span></span> <span data-ttu-id="0a4f8-152">Essas ferramentas permitem monitorar e solucionar problemas de desempenho que podem exigir atualizações de código, e podem todas ser implantadas com o pipeline de CI/CD.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-152">These tools let you monitor and troubleshoot performance issues that may require code updates, which can all then be deployed with the CI/CD pipeline.</span></span>

<span data-ttu-id="0a4f8-153">Como parte do cluster do Serviço de Kubernetes do Azure, um balanceador de carga distribui o tráfego do aplicativo para um ou mais contêineres (pods) que executam o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-153">As part of the Azure Kubernetes Service cluster, a load balancer distributes application traffic to one or more containers (pods) that run your application.</span></span> <span data-ttu-id="0a4f8-154">Essa abordagem à execução de aplicativos em contêineres no Kubernetes oferece uma infraestrutura altamente disponível para seus clientes.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-154">This approach to running containerized applications in Kubernetes provides a highly-available infrastructure for your customers.</span></span>

<span data-ttu-id="0a4f8-155">Para outros tópicos de disponibilidade, confira a [lista de verificação de disponibilidade][availability] disponível no Architecture Center.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-155">For other availability topics, see the [availability checklist][availability] available in the architecure center.</span></span>

### <a name="scalability"></a><span data-ttu-id="0a4f8-156">Escalabilidade</span><span class="sxs-lookup"><span data-stu-id="0a4f8-156">Scalability</span></span>

<span data-ttu-id="0a4f8-157">O Serviço de Kubernetes do Azure permite que você dimensione o número de nós de cluster para atender às demandas dos aplicativos.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-157">Azure Kubernetes Service lets you scale the number of cluster nodes to meet the demands of your applications.</span></span> <span data-ttu-id="0a4f8-158">À medida que seu aplicativo aumenta, você pode escalar horizontalmente o número de nós de Kubernetes que executa o serviço.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-158">As your application increases, you can scale out the number of Kubernetes nodes that run your service.</span></span>

<span data-ttu-id="0a4f8-159">Os dados do aplicativo são armazenados no Azure Cosmos DB, um banco de dados multimodelo distribuído globalmente que pode ser dimensionado globalmente.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-159">Application data is stored in Azure Cosmos DB, a globally distributed, multi-model database that can scale globally.</span></span> <span data-ttu-id="0a4f8-160">O cosmos DB abstrai a necessidade de dimensionar sua infraestrutura, como é feito com os componentes de banco de dados tradicional, e você pode optar por replicar o Cosmos DB globalmente para atender às demandas de seus clientes.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-160">Cosmos DB abstracts the need to scale your  infrastructure as with traditional database components, and you can choose to replicate your Cosmos DB globally to meet the demands of your customers.</span></span>

<span data-ttu-id="0a4f8-161">Para outros tópicos de escalabilidade, confira a [lista de verificação de escalabilidade] [ scalability] disponível no Architecture Center.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-161">For other scalability topics, see the [scalability checklist][scalability] available in the architecure center.</span></span>

### <a name="security"></a><span data-ttu-id="0a4f8-162">Segurança</span><span class="sxs-lookup"><span data-stu-id="0a4f8-162">Security</span></span>

<span data-ttu-id="0a4f8-163">Para minimizar a superfície de ataque, esses cenários não expõem a instância da VM Jenkins em HTTP.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-163">To minimize the attack footprint, this scenarios does not expose the Jenkins VM instance over HTTP.</span></span> <span data-ttu-id="0a4f8-164">Para as tarefas de gerenciamento que exigem a interação com o Jenkins, você deve criar uma conexão remota segura usando um túnel SSH em seu computador local.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-164">For any management tasks that require you to interact with Jenkins, you create a secure remote connection using an SSH tunnel from your local machine.</span></span> <span data-ttu-id="0a4f8-165">Somente a autenticação de chave pública SSH é permitida para as instâncias de VM Grafana e Jenkins.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-165">Only SSH public key authentication is allowed for the Jenkins and Grafana VM instances.</span></span> <span data-ttu-id="0a4f8-166">Os logons com base em senha são desabilitados.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-166">Password-based logins are disabled.</span></span> <span data-ttu-id="0a4f8-167">Para obter mais informações, confira [Executar um servidor Jenkins no Azure](../../reference-architectures/jenkins/index.md).</span><span class="sxs-lookup"><span data-stu-id="0a4f8-167">For more information, see [Run a Jenkins server on Azure](../../reference-architectures/jenkins/index.md).</span></span>

<span data-ttu-id="0a4f8-168">Para separar credenciais e permissões, este cenário usa uma entidade de serviço dedicada do Azure AD (Active Directory).</span><span class="sxs-lookup"><span data-stu-id="0a4f8-168">For separation of credentials and permissions, this scenario uses a dedicated Azure Active Directory (AD) service principal.</span></span> <span data-ttu-id="0a4f8-169">As credenciais para essa entidade de serviço são armazenadas como um objeto de credencial segura no Jenkins para não serem diretamente expostas e ficarem visíveis dentro de scripts ou no pipeline de compilação.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-169">The credentials for this service principal are stored as a secure credential object in Jenkins so that they are not directly exposed and visible within scripts or the build pipeline.</span></span>

<span data-ttu-id="0a4f8-170">Para obter orientação geral sobre como criar soluções seguras, confira a [Documentação de segurança do Azure][security].</span><span class="sxs-lookup"><span data-stu-id="0a4f8-170">For general guidance on designing secure solutions, see the [Azure Security Documentation][security].</span></span>

### <a name="resiliency"></a><span data-ttu-id="0a4f8-171">Resiliência</span><span class="sxs-lookup"><span data-stu-id="0a4f8-171">Resiliency</span></span>

<span data-ttu-id="0a4f8-172">Este cenário usa o Serviço de Kubernetes do Azure para seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-172">This scenario uses Azure Kubernetes Service for your application.</span></span> <span data-ttu-id="0a4f8-173">O Kubernetes tem componentes de resiliência embutidos que monitoram e reiniciam os contêineres (pods) em caso de problema.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-173">Built into Kubernetes are resiliency components that monitor and restart the containers (pods) if there is an issue.</span></span> <span data-ttu-id="0a4f8-174">Combinado com vários nós do Kubernetes em execução, seu aplicativo pode tolerar a indisponibilidade de um pod ou nó.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-174">Combined with running multiple Kubernetes nodes, your application can tolerate a pod or node being unavailable.</span></span>

<span data-ttu-id="0a4f8-175">Para obter diretrizes gerais sobre como criar soluções resilientes, confira [Projetando aplicativos resilientes para o Azure][resiliency].</span><span class="sxs-lookup"><span data-stu-id="0a4f8-175">For general guidance on designing resilient solutions, see [Designing resilient applications for Azure][resiliency].</span></span>

## <a name="deploy-the-scenario"></a><span data-ttu-id="0a4f8-176">Implantar o cenário</span><span class="sxs-lookup"><span data-stu-id="0a4f8-176">Deploy the scenario</span></span>

<span data-ttu-id="0a4f8-177">**Pré-requisitos.**</span><span class="sxs-lookup"><span data-stu-id="0a4f8-177">**Prerequisites.**</span></span>

* <span data-ttu-id="0a4f8-178">Você deve ter uma conta do Azure já criada.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-178">You must have an existing Azure account.</span></span> <span data-ttu-id="0a4f8-179">Se você não tiver uma assinatura do Azure, crie uma [conta gratuita](https://azure.microsoft.com/free/?WT.mc_id=A261C142F) antes de começar.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-179">If you don't have an Azure subscription, create a [free account](https://azure.microsoft.com/free/?WT.mc_id=A261C142F) before you begin.</span></span>
* <span data-ttu-id="0a4f8-180">Você precisa de um par de chaves públicas SSH.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-180">You need an SSH public key pair.</span></span> <span data-ttu-id="0a4f8-181">Para obter etapas sobre como criar um par de chaves públicas, confira [Criar e usar um par de chaves SSH para VMs Linux][sshkeydocs].</span><span class="sxs-lookup"><span data-stu-id="0a4f8-181">For steps on how to create a public key pair, see [Create and use an SSH key pair for Linux VMs][sshkeydocs].</span></span>
* <span data-ttu-id="0a4f8-182">Você precisa de uma entidade de serviço do Azure AD (Active Directory) para a autenticação de serviço e recursos.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-182">You need an Azure Active Directory (AD) service principal for the authentication of service and resources.</span></span> <span data-ttu-id="0a4f8-183">Se necessário, crie uma entidade de serviço com [az ad sp create-for-rbac][createsp]</span><span class="sxs-lookup"><span data-stu-id="0a4f8-183">If needed, you can create a service principal with [az ad sp create-for-rbac][createsp]</span></span>

    ```azurecli-interactive
    az ad sp create-for-rbac --name myDevOpsScenario
    ```

    <span data-ttu-id="0a4f8-184">Anote o *appId* e a *senha* na saída desse comando.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-184">Make a note of the *appId* and *password* in the output from this command.</span></span> <span data-ttu-id="0a4f8-185">Forneça esses valores ao modelo quando implantar o cenário.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-185">You provide these values to the template when you deploy the scenario.</span></span>

<span data-ttu-id="0a4f8-186">Para implantar esse cenário com um modelo do Azure Resource Manager, execute as etapas a seguir.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-186">To deploy this scenario with an Azure Resource Manager template, perform the following steps.</span></span>

1. <span data-ttu-id="0a4f8-187">Clique no botão **Implantar no Azure**:</span><span class="sxs-lookup"><span data-stu-id="0a4f8-187">Click the **Deploy to Azure** button:</span></span><br><a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fmspnp%2Fsolution-architectures%2Fmaster%2Fapps%2Fdevops-with-aks%2Fazuredeploy.json" target="_blank"><img src="https://azuredeploy.net/deploybutton.png"/></a>
2. <span data-ttu-id="0a4f8-188">Aguarde até que a implantação de modelo seja aberta no portal do Azure e conclua as seguintes etapas:</span><span class="sxs-lookup"><span data-stu-id="0a4f8-188">Wait for the template deployment to open in the Azure portal, then complete the following steps:</span></span>
   * <span data-ttu-id="0a4f8-189">Escolha **Criar novo** recurso de grupo e insira um nome como *myAKSDevOpsScenario* na caixa de texto.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-189">Choose to **Create new** resource group, then provide a name such as *myAKSDevOpsScenario* in the text box.</span></span>
   * <span data-ttu-id="0a4f8-190">Selecione uma região na caixa suspensa **Local**.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-190">Select a region from the **Location** drop-down box.</span></span>
   * <span data-ttu-id="0a4f8-191">Insira sua ID de entidade de segurança de aplicativo de serviço e a senha no comando `az ad sp create-for-rbac`.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-191">Enter your service principal app ID and password from the `az ad sp create-for-rbac` command.</span></span>
   * <span data-ttu-id="0a4f8-192">Forneça um nome de usuário e uma senha segura para a instância do Jenkins e o console do Grafana.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-192">Provide a username and secure password for the Jenkins instance and Grafana console.</span></span>
   * <span data-ttu-id="0a4f8-193">Forneça uma chave SSH para proteger logons nas VMs Linux.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-193">Provide an SSH key to secure logins to the Linux VMs.</span></span>
   * <span data-ttu-id="0a4f8-194">Analise os termos e condições e marque a opção **Concordo com os termos e condições declarados acima**.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-194">Review the terms and conditions, then check **I agree to the terms and conditions stated above**.</span></span>
   * <span data-ttu-id="0a4f8-195">Selecione o botão **Comprar**.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-195">Select the **Purchase** button.</span></span>

<span data-ttu-id="0a4f8-196">Pode levar 15 a 20 minutos para a implantação ser concluída.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-196">It can take 15-20 minutes for the deployment to complete.</span></span>

## <a name="pricing"></a><span data-ttu-id="0a4f8-197">Preços</span><span class="sxs-lookup"><span data-stu-id="0a4f8-197">Pricing</span></span>

<span data-ttu-id="0a4f8-198">Para explorar o custo de executar esse cenário, todos os serviços são pré-configurados na calculadora de custos.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-198">To explore the cost of running this scenario, all of the services are pre-configured in the cost calculator.</span></span> <span data-ttu-id="0a4f8-199">Para ver como o preço seria alterado em seu caso de uso específico, altere as variáveis apropriadas de acordo com o tráfego esperado.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-199">To see how the pricing would change for your particular use case, change the appropriate variables to match your expected traffic.</span></span> <span data-ttu-id="0a4f8-200">corresponde ao tráfego esperado.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-200">match your expected traffic.</span></span>

<span data-ttu-id="0a4f8-201">Nós fornecemos três perfis de custo de exemplo com base no número de imagens de contêiner a serem armazenados e nós de Kubernetes para executar seus aplicativos.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-201">We have provided three sample cost profiles based on the number of container images to store and Kubernetes nodes to run your applications.</span></span>

* <span data-ttu-id="0a4f8-202">[Pequeno][small-pricing]: referente a mil compilações de contêiner por mês.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-202">[Small][small-pricing]: this correlates to 1000 container builds per month.</span></span>
* <span data-ttu-id="0a4f8-203">[Pequeno][medium-pricing]: referente a 100 mil compilações de contêiner por mês.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-203">[Medium][medium-pricing]: this correlates to 100,000 container builds per month.</span></span>
* <span data-ttu-id="0a4f8-204">[Pequeno][large-pricing]: referente a um milhão de compilações de contêiner por mês.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-204">[Large][large-pricing]: this correlates to 1,000,000 container builds per month.</span></span>

## <a name="related-resources"></a><span data-ttu-id="0a4f8-205">Recursos relacionados</span><span class="sxs-lookup"><span data-stu-id="0a4f8-205">Related Resources</span></span>

<span data-ttu-id="0a4f8-206">Este cenário usou o Registro de Contêiner do Azure e o Serviço de Kubernetes do Azure para armazenar e executar seus aplicativos baseados em contêiner.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-206">This scenario used Azure Container Registry and Azure Kubernetes Service to store and run your container-based applications.</span></span> <span data-ttu-id="0a4f8-207">As Instâncias de Contêiner do Azure também podem ser usadas para executar aplicativos baseados em contêiner, sem precisar provisionar componentes de orquestração.</span><span class="sxs-lookup"><span data-stu-id="0a4f8-207">Azure Container Instances can also be used to run container-based applications, without having to provision any orchestration components.</span></span> <span data-ttu-id="0a4f8-208">Para obter mais informações, confira [Visão geral das Instâncias de Contêiner do Azure][azureaci-docs].</span><span class="sxs-lookup"><span data-stu-id="0a4f8-208">For more information, see [Azure Container Instances overview][azureaci-docs].</span></span>

<!-- links -->
[architecture]: ./media/devops-with-aks/architecture-devops-with-aks.png
[autoscaling]: ../../best-practices/auto-scaling.md
[availability]: ../../checklist/availability.md
[azureaci-docs]: /azure/container-instances/container-instances-overview
[azureacr-docs]: /azure/container-registry/container-registry-intro
[azurecosmosdb-docs]: /azure/cosmos-db/introduction
[azureaks-docs]: /azure/aks/intro-kubernetes
[azuremonitor-docs]: /azure/monitoring-and-diagnostics/monitoring-overview
[azurevm-docs]: /azure/virtual-machines/linux/overview
[createsp]: /cli/azure/ad/sp#az-ad-sp-create
[grafana]: https://grafana.com/
[jenkins]: https://jenkins.io/
[resiliency]: ../../resiliency/index.md
[resource-groups]: /azure/azure-resource-manager/resource-group-overview
[security]: /azure/security/
[scalability]: ../../checklist/scalability.md
[sshkeydocs]: /azure/virtual-machines/linux/mac-create-ssh-keys
[vsts]: /vsts/?view=vsts
[kubernetes]: https://kubernetes.io/
[service-fabric]: /azure/service-fabric/

[small-pricing]: https://azure.com/e/841f0a75b1ea4802ba1ac8f7918a71e7
[medium-pricing]: https://azure.com/e/eea0e6d79b4e45618a96d33383ec77ba
[large-pricing]: https://azure.com/e/3faab662c54c473da55a1e93a27e0e64