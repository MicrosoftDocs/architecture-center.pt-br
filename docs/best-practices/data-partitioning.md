---
title: Diretrizes de particionamento de dados
titleSuffix: Best practices for cloud applications
description: Instruções de como separar partições a serem gerenciadas e acessadas separadamente.
author: dragon119
ms.date: 11/04/2018
ms.topic: best-practice
ms.service: architecture-center
ms.subservice: cloud-fundamentals
ms.custom: seodec18
ms.openlocfilehash: 561fe6e47a4cd64aa545349dde4c76260d76e78e
ms.sourcegitcommit: c053e6edb429299a0ad9b327888d596c48859d4a
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/20/2019
ms.locfileid: "58248951"
---
# <a name="horizontal-vertical-and-functional-data-partitioning"></a><span data-ttu-id="64bde-103">Particionamento horizontal, vertical e funcional de dados</span><span class="sxs-lookup"><span data-stu-id="64bde-103">Horizontal, vertical, and functional data partitioning</span></span>

<span data-ttu-id="64bde-104">Em muitas soluções de grande escala, os dados são divididos em *partições* que podem ser gerenciadas e acessadas separadamente.</span><span class="sxs-lookup"><span data-stu-id="64bde-104">In many large-scale solutions, data is divided into *partitions* that can be managed and accessed separately.</span></span> <span data-ttu-id="64bde-105">O particionamento pode aprimorar a escalabilidade, reduzir a contenção e otimizar o desempenho.</span><span class="sxs-lookup"><span data-stu-id="64bde-105">Partitioning can improve scalability, reduce contention, and optimize performance.</span></span> <span data-ttu-id="64bde-106">Ele também pode fornecer um mecanismo para dividir os dados pelo padrão de uso.</span><span class="sxs-lookup"><span data-stu-id="64bde-106">It can also provide a mechanism for dividing data by usage pattern.</span></span> <span data-ttu-id="64bde-107">Por exemplo, você pode arquivar dados antigos em armazenamento de dados mais barato.</span><span class="sxs-lookup"><span data-stu-id="64bde-107">For example, you can archive older data in cheaper data storage.</span></span>

<span data-ttu-id="64bde-108">Porém, a estratégia de particionamento deve ser cuidadosamente escolhida para maximizar os benefícios, ao mesmo tempo que minimiza os efeitos adversos.</span><span class="sxs-lookup"><span data-stu-id="64bde-108">However, the partitioning strategy must be chosen carefully to maximize the benefits while minimizing adverse effects.</span></span>

> [!NOTE]
> <span data-ttu-id="64bde-109">Neste artigo, o termo *particionamento* significa o processo de dividir fisicamente os dados em armazenamentos de dados separados.</span><span class="sxs-lookup"><span data-stu-id="64bde-109">In this article, the term *partitioning* means the process of physically dividing data into separate data stores.</span></span> <span data-ttu-id="64bde-110">Não é igual ao particionamento de tabela do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="64bde-110">It is not the same as SQL Server table partitioning.</span></span>

<!-- markdownlint-disable MD026 -->

## <a name="why-partition-data"></a><span data-ttu-id="64bde-111">Por que particionar os dados?</span><span class="sxs-lookup"><span data-stu-id="64bde-111">Why partition data?</span></span>

<!-- markdownlint-enable MD026 -->

- <span data-ttu-id="64bde-112">**Melhorar a escalabilidade**.</span><span class="sxs-lookup"><span data-stu-id="64bde-112">**Improve scalability**.</span></span> <span data-ttu-id="64bde-113">Quando você escala verticalmente um sistema de banco de dados individual, em algum momento ele atingirá um limite de hardware físico.</span><span class="sxs-lookup"><span data-stu-id="64bde-113">When you scale up a single database system, it will eventually reach a physical hardware limit.</span></span> <span data-ttu-id="64bde-114">Se você dividir os dados entre várias partições, cada uma hospedada em um servidor separado, será possível escalar o sistema de forma horizontal quase que indefinidamente.</span><span class="sxs-lookup"><span data-stu-id="64bde-114">If you divide data across multiple partitions, each hosted on a separate server, you can scale out the system almost indefinitely.</span></span>

- <span data-ttu-id="64bde-115">**Melhorar o desempenho**.</span><span class="sxs-lookup"><span data-stu-id="64bde-115">**Improve performance**.</span></span> <span data-ttu-id="64bde-116">As operações de acesso a dados em cada partição ocorrem em um volume de dados menor.</span><span class="sxs-lookup"><span data-stu-id="64bde-116">Data access operations on each partition take place over a smaller volume of data.</span></span> <span data-ttu-id="64bde-117">Feito corretamente, o particionamento pode tornar seu sistema mais eficiente.</span><span class="sxs-lookup"><span data-stu-id="64bde-117">Correctly done, partitioning can make your system more efficient.</span></span> <span data-ttu-id="64bde-118">As operações que afetam mais de uma partição podem ser executadas paralelamente.</span><span class="sxs-lookup"><span data-stu-id="64bde-118">Operations that affect more than one partition can run in parallel.</span></span>

- <span data-ttu-id="64bde-119">**Melhorar a segurança**.</span><span class="sxs-lookup"><span data-stu-id="64bde-119">**Improve security**.</span></span> <span data-ttu-id="64bde-120">Em alguns casos, você pode separar dados confidenciais e não confidenciais em partições diferentes e aplicar controles de segurança diferentes aos dados confidenciais.</span><span class="sxs-lookup"><span data-stu-id="64bde-120">In some cases, you can separate sensitive and non-sensitive data into different partitions and apply different security controls to the sensitive data.</span></span>

- <span data-ttu-id="64bde-121">**Fornecer flexibilidade operacional**.</span><span class="sxs-lookup"><span data-stu-id="64bde-121">**Provide operational flexibility**.</span></span> <span data-ttu-id="64bde-122">O particionamento oferece várias oportunidades para o ajuste das operações, maximizando a eficiência administrativa e minimizando os custos.</span><span class="sxs-lookup"><span data-stu-id="64bde-122">Partitioning offers many opportunities for fine tuning operations, maximizing administrative efficiency, and minimizing cost.</span></span> <span data-ttu-id="64bde-123">Por exemplo, você pode definir diferentes estratégias para gerenciamento, monitoramento, backup, restauração e outras tarefas administrativas baseadas na importância dos dados em cada partição.</span><span class="sxs-lookup"><span data-stu-id="64bde-123">For example, you can define different strategies for management, monitoring, backup and restore, and other administrative tasks based on the importance of the data in each partition.</span></span>

- <span data-ttu-id="64bde-124">**Fazer a correspondência do repositório de dados ao padrão de uso**.</span><span class="sxs-lookup"><span data-stu-id="64bde-124">**Match the data store to the pattern of use**.</span></span> <span data-ttu-id="64bde-125">O particionamento permite que cada partição seja implantada em um tipo diferente de repositório de dados, com base no custo e nos recursos internos que o repositório de dados oferece.</span><span class="sxs-lookup"><span data-stu-id="64bde-125">Partitioning allows each partition to be deployed on a different type of data store, based on cost and the built-in features that data store offers.</span></span> <span data-ttu-id="64bde-126">Por exemplo, dados binários grandes podem ser armazenados em um armazenamento de blob, enquanto dados mais estruturados podem ser mantidos em um banco de dados de documentos.</span><span class="sxs-lookup"><span data-stu-id="64bde-126">For example, large binary data can be stored in blob storage, while more structured data can be held in a document database.</span></span> <span data-ttu-id="64bde-127">Confira [Escolher o armazenamento de dados correto](../guide/technology-choices/data-store-overview.md).</span><span class="sxs-lookup"><span data-stu-id="64bde-127">See [Choose the right data store](../guide/technology-choices/data-store-overview.md).</span></span>

- <span data-ttu-id="64bde-128">**Melhorar a disponibilidade**.</span><span class="sxs-lookup"><span data-stu-id="64bde-128">**Improve availability**.</span></span> <span data-ttu-id="64bde-129">Separar dados em vários servidores evita um ponto único de falha.</span><span class="sxs-lookup"><span data-stu-id="64bde-129">Separating data across multiple servers avoids a single point of failure.</span></span> <span data-ttu-id="64bde-130">Se uma instância falhar, somente os dados nessa partição não estão disponíveis.</span><span class="sxs-lookup"><span data-stu-id="64bde-130">If one instance fails, only the data in that partition is unavailable.</span></span> <span data-ttu-id="64bde-131">As operações em outras partições podem continuar.</span><span class="sxs-lookup"><span data-stu-id="64bde-131">Operations on other partitions can continue.</span></span> <span data-ttu-id="64bde-132">Para armazenamentos de dados de PaaS gerenciados, essa consideração é menos relevante porque esses serviços são projetados com redundância interna.</span><span class="sxs-lookup"><span data-stu-id="64bde-132">For managed PaaS data stores, this consideration is less relevant, because these services are designed with built-in redundancy.</span></span>

## <a name="designing-partitions"></a><span data-ttu-id="64bde-133">Criando partições</span><span class="sxs-lookup"><span data-stu-id="64bde-133">Designing partitions</span></span>

<span data-ttu-id="64bde-134">Há três estratégias típicas para o particionamento dos dados:</span><span class="sxs-lookup"><span data-stu-id="64bde-134">There are three typical strategies for partitioning data:</span></span>

- <span data-ttu-id="64bde-135">**Particionamento horizontal** (geralmente denominado *fragmentação*).</span><span class="sxs-lookup"><span data-stu-id="64bde-135">**Horizontal partitioning** (often called *sharding*).</span></span> <span data-ttu-id="64bde-136">Nessa estratégia, cada partição é um armazenamento de dados separado, mas todas as partições têm o mesmo esquema.</span><span class="sxs-lookup"><span data-stu-id="64bde-136">In this strategy, each partition is a separate data store, but all partitions have the same schema.</span></span> <span data-ttu-id="64bde-137">Cada partição é conhecida como um *fragmento* e contém um subconjunto específico de dados, como todos os pedidos de um conjunto específico de clientes.</span><span class="sxs-lookup"><span data-stu-id="64bde-137">Each partition is known as a *shard* and holds a specific subset of the data, such as all the orders for a specific set of customers.</span></span>

- <span data-ttu-id="64bde-138">**Particionamento vertical**.</span><span class="sxs-lookup"><span data-stu-id="64bde-138">**Vertical partitioning**.</span></span> <span data-ttu-id="64bde-139">Nessa estratégia, cada partição contém um subconjunto dos campos de itens no repositório de dados.</span><span class="sxs-lookup"><span data-stu-id="64bde-139">In this strategy, each partition holds a subset of the fields for items in the data store.</span></span> <span data-ttu-id="64bde-140">Os campos são divididos de acordo com seu padrão de uso.</span><span class="sxs-lookup"><span data-stu-id="64bde-140">The fields are divided according to their pattern of use.</span></span> <span data-ttu-id="64bde-141">Por exemplo, os campos acessados com frequência podem ser colocados em uma partição vertical e os campos acessados com menos frequência em outra.</span><span class="sxs-lookup"><span data-stu-id="64bde-141">For example, frequently accessed fields might be placed in one vertical partition and less frequently accessed fields in another.</span></span>

- <span data-ttu-id="64bde-142">**Particionamento funcional**.</span><span class="sxs-lookup"><span data-stu-id="64bde-142">**Functional partitioning**.</span></span> <span data-ttu-id="64bde-143">Nessa estratégia, os dados são agregados de acordo com o modo como são usados por cada contexto vinculado no sistema.</span><span class="sxs-lookup"><span data-stu-id="64bde-143">In this strategy, data is aggregated according to how it is used by each bounded context in the system.</span></span> <span data-ttu-id="64bde-144">Por exemplo, um sistema de comércio eletrônico pode armazenar os dados da fatura em uma partição e os dados de inventário dos produtos em outra.</span><span class="sxs-lookup"><span data-stu-id="64bde-144">For example, an e-commerce system might store invoice data in one partition and product inventory data in another.</span></span>

<span data-ttu-id="64bde-145">Essas estratégias podem ser combinadas, e é recomendável levá-las em consideração ao projetar um esquema de particionamento.</span><span class="sxs-lookup"><span data-stu-id="64bde-145">These strategies can be combined, and we recommend that you consider them all when you design a partitioning scheme.</span></span> <span data-ttu-id="64bde-146">Por exemplo, você poderia dividir os dados em fragmentos e então usar o particionamento vertical para subdividir ainda mais os dados em cada fragmento.</span><span class="sxs-lookup"><span data-stu-id="64bde-146">For example, you might divide data into shards and then use vertical partitioning to further subdivide the data in each shard.</span></span>

### <a name="horizontal-partitioning-sharding"></a><span data-ttu-id="64bde-147">Particionamento horizontal (fragmentação)</span><span class="sxs-lookup"><span data-stu-id="64bde-147">Horizontal partitioning (sharding)</span></span>

<span data-ttu-id="64bde-148">A Figura 1 mostra um particionamento horizontal ou fragmentação.</span><span class="sxs-lookup"><span data-stu-id="64bde-148">Figure 1 shows horizontal partitioning or sharding.</span></span> <span data-ttu-id="64bde-149">Neste exemplo, os dados do inventário de produtos são divididos em fragmentos com base na chave do produto (Product Key).</span><span class="sxs-lookup"><span data-stu-id="64bde-149">In this example, product inventory data is divided into shards based on the product key.</span></span> <span data-ttu-id="64bde-150">Cada fragmento contém os dados para um intervalo contíguo de chaves de fragmento (A-G e H-Z), organizadas em ordem alfabética.</span><span class="sxs-lookup"><span data-stu-id="64bde-150">Each shard holds the data for a contiguous range of shard keys (A-G and H-Z), organized alphabetically.</span></span> <span data-ttu-id="64bde-151">A fragmentação distribui a carga em um número maior de computadores, o que reduz a contenção e melhora o desempenho.</span><span class="sxs-lookup"><span data-stu-id="64bde-151">Sharding spreads the load over more computers, which reduces contention and improves performance.</span></span>

![Particionamento horizontal (fragmentação) de dados com base em uma chave de partição](./images/data-partitioning/DataPartitioning01.png)

<span data-ttu-id="64bde-153">*Figura 1. Particionamento horizontal (fragmentação) de dados com base em uma chave de partição.*</span><span class="sxs-lookup"><span data-stu-id="64bde-153">*Figure 1. Horizontally partitioning (sharding) data based on a partition key.*</span></span>

<span data-ttu-id="64bde-154">O fator mais importante é a escolha de uma chave de fragmentação.</span><span class="sxs-lookup"><span data-stu-id="64bde-154">The most important factor is the choice of a sharding key.</span></span> <span data-ttu-id="64bde-155">Pode ser difícil alterar a chave depois que o sistema estiver em operação.</span><span class="sxs-lookup"><span data-stu-id="64bde-155">It can be difficult to change the key after the system is in operation.</span></span> <span data-ttu-id="64bde-156">A chave deve garantir que os dados sejam particionados para distribuir a carga de trabalho da maneira mais uniforme possível entre os fragmentos.</span><span class="sxs-lookup"><span data-stu-id="64bde-156">The key must ensure that data is partitioned to spread the workload as evenly as possible across the shards.</span></span>

<span data-ttu-id="64bde-157">Os fragmentos não precisam ser do mesmo tamanho.</span><span class="sxs-lookup"><span data-stu-id="64bde-157">The shards don't have to be the same size.</span></span> <span data-ttu-id="64bde-158">É mais importante equilibrar a quantidade de solicitações.</span><span class="sxs-lookup"><span data-stu-id="64bde-158">It's more important to balance the number of requests.</span></span> <span data-ttu-id="64bde-159">Alguns fragmentos podem ser muito grandes, mas cada item tem uma quantidade baixa de operações de acesso.</span><span class="sxs-lookup"><span data-stu-id="64bde-159">Some shards might be very large, but each item has a low number of access operations.</span></span> <span data-ttu-id="64bde-160">Outros fragmentos podem ser menores, mas cada item é acessado com muito mais frequência.</span><span class="sxs-lookup"><span data-stu-id="64bde-160">Other shards might be smaller, but each item is accessed much more frequently.</span></span> <span data-ttu-id="64bde-161">Também é importante garantir que um único fragmento não exceda os limites de escala (em termos de capacidade e recursos de processamento) do armazenamento de dados.</span><span class="sxs-lookup"><span data-stu-id="64bde-161">It's also important to ensure that a single shard does not exceed the scale limits (in terms of capacity and processing resources) of the data store.</span></span>

<span data-ttu-id="64bde-162">Evite criar partições frequentes que possam afetar o desempenho e a disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="64bde-162">Avoid creating "hot" partitions that can affect performance and availability.</span></span> <span data-ttu-id="64bde-163">Por exemplo, usar a primeira letra do nome de um cliente gera uma distribuição desbalanceada, pois algumas letras são mais comuns. Em vez disso, use um hash de um identificador de cliente para distribuir os dados mais uniformemente entre as partições.</span><span class="sxs-lookup"><span data-stu-id="64bde-163">For example, using the first letter of a customer’s name causes an unbalanced distribution, because some letters are more common Instead, use a hash of a customer identifier to distribute data more evenly across partitions.</span></span>

<span data-ttu-id="64bde-164">Escolha uma chave de fragmentação que minimize os requisitos futuros de divisão de grandes fragmentos, agrupamento de pequenos fragmentos em partições maiores ou alteração do esquema.</span><span class="sxs-lookup"><span data-stu-id="64bde-164">Choose a sharding key that minimizes any future requirements to split large shards, coalesce small shards into larger partitions, or change the schema.</span></span> <span data-ttu-id="64bde-165">Essas operações podem ser muito demoradas e podem exigir que você deixe um ou mais fragmentos offline enquanto elas são executadas.</span><span class="sxs-lookup"><span data-stu-id="64bde-165">These operations can be very time consuming, and might require taking one or more shards offline while they are performed.</span></span>

<span data-ttu-id="64bde-166">Se os fragmentos forem replicados, será possível manter algumas das réplicas online enquanto as outras são divididas, mescladas ou reconfiguradas.</span><span class="sxs-lookup"><span data-stu-id="64bde-166">If shards are replicated, it might be possible to keep some of the replicas online while others are split, merged, or reconfigured.</span></span> <span data-ttu-id="64bde-167">No entanto, talvez o sistema precise limitar as operações que podem ser realizadas durante a reconfiguração.</span><span class="sxs-lookup"><span data-stu-id="64bde-167">However, the system might need to limit the operations that can be performed during the reconfiguration.</span></span> <span data-ttu-id="64bde-168">Por exemplo, os dados nas réplicas podem ser marcados como somente leitura para evitar inconsistências de dados.</span><span class="sxs-lookup"><span data-stu-id="64bde-168">For example, the data in the replicas might be marked as read-only to prevent data inconsistences.</span></span>

<span data-ttu-id="64bde-169">Para saber mais sobre o particionamento horizontal, confira [Padrão de fragmentação].</span><span class="sxs-lookup"><span data-stu-id="64bde-169">For more information about horizontal partitioning, see [Sharding pattern].</span></span>

### <a name="vertical-partitioning"></a><span data-ttu-id="64bde-170">Particionamento vertical</span><span class="sxs-lookup"><span data-stu-id="64bde-170">Vertical partitioning</span></span>

<span data-ttu-id="64bde-171">O uso mais comum do particionamento vertical é reduzir a E/S e os custos de desempenho associados à busca de itens que são acessados frequentemente.</span><span class="sxs-lookup"><span data-stu-id="64bde-171">The most common use for vertical partitioning is to reduce the I/O and performance costs associated with fetching items that are frequently accessed.</span></span> <span data-ttu-id="64bde-172">A Figura 2 mostra um exemplo de particionamento vertical.</span><span class="sxs-lookup"><span data-stu-id="64bde-172">Figure 2 shows an example of vertical partitioning.</span></span> <span data-ttu-id="64bde-173">Nesse exemplo, as diferentes propriedades de um item são armazenadas em diferentes partições.</span><span class="sxs-lookup"><span data-stu-id="64bde-173">In this example, different properties of an item are stored in different partitions.</span></span> <span data-ttu-id="64bde-174">Uma partição mantém dados que são acessados mais frequentemente, incluindo o nome, a descrição e o preço do produto.</span><span class="sxs-lookup"><span data-stu-id="64bde-174">One partition holds data that is accessed more frequently, including product name, description, and price.</span></span> <span data-ttu-id="64bde-175">Outra partição mantém os dados de inventário: a contagem de estoque e a data do último pedido.</span><span class="sxs-lookup"><span data-stu-id="64bde-175">Another partition holds inventory data: the stock count and last-ordered date.</span></span>

![Particionamento vertical de dados por seu padrão de uso](./images/data-partitioning/DataPartitioning02.png)

<span data-ttu-id="64bde-177">*Figura 2. Particionamento vertical de dados por seu padrão de uso.*</span><span class="sxs-lookup"><span data-stu-id="64bde-177">*Figure 2. Vertically partitioning data by its pattern of use.*</span></span>

<span data-ttu-id="64bde-178">Neste exemplo, o aplicativo regularmente consulta o nome, a descrição e o preço do produto ao exibir os detalhes do produto para os clientes.</span><span class="sxs-lookup"><span data-stu-id="64bde-178">In this example, the application regularly queries the product name, description, and price when displaying the product details to customers.</span></span> <span data-ttu-id="64bde-179">A contagem de estoque e a data do último pedido são mantidas em uma partição separada porque, geralmente, esses dois itens são usados juntos.</span><span class="sxs-lookup"><span data-stu-id="64bde-179">Stock count and last- ordered date are held in a separate partition because these two items are commonly used together.</span></span>

<span data-ttu-id="64bde-180">Outras vantagens do particionamento vertical:</span><span class="sxs-lookup"><span data-stu-id="64bde-180">Other advantages of vertical partitioning:</span></span>

- <span data-ttu-id="64bde-181">Os dados relativamente lentos (nome do produto, descrição e preço) podem ser separados dos dados mais dinâmicos (nível de estoque e data do último pedido).</span><span class="sxs-lookup"><span data-stu-id="64bde-181">Relatively slow-moving data (product name, description, and price) can be separated from the more dynamic data (stock level and last ordered date).</span></span> <span data-ttu-id="64bde-182">Os dados lentos são bons candidatos para o armazenamento em cache de um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="64bde-182">Slow moving data is a good candidate for an application to cache in memory.</span></span>

- <span data-ttu-id="64bde-183">Os dados confidenciais podem ser armazenados em uma partição separada com controles de segurança adicionais.</span><span class="sxs-lookup"><span data-stu-id="64bde-183">Sensitive data can be stored in a separate partition with additional security controls.</span></span>

- <span data-ttu-id="64bde-184">O particionamento vertical pode reduzir a quantidade de acesso simultâneo necessária.</span><span class="sxs-lookup"><span data-stu-id="64bde-184">Vertical partitioning can reduce the amount of concurrent access that's needed.</span></span>

<span data-ttu-id="64bde-185">O particionamento vertical funciona no nível da entidade em um armazenamento de dados, parcialmente normalizando uma entidade para dividir um item *grande* em um conjunto de itens *pequenos*.</span><span class="sxs-lookup"><span data-stu-id="64bde-185">Vertical partitioning operates at the entity level within a data store, partially normalizing an entity to break it down from a *wide* item to a set of *narrow* items.</span></span> <span data-ttu-id="64bde-186">Ele é ideal para repositórios de dados orientados a colunas, como o HBase e Cassandra.</span><span class="sxs-lookup"><span data-stu-id="64bde-186">It is ideally suited for column-oriented data stores such as HBase and Cassandra.</span></span> <span data-ttu-id="64bde-187">Se for improvável que os dados em uma coleção de colunas serão alterados, você também poderá considerar o uso de repositórios de colunas no SQL Server.</span><span class="sxs-lookup"><span data-stu-id="64bde-187">If the data in a collection of columns is unlikely to change, you can also consider using column stores in SQL Server.</span></span>

### <a name="functional-partitioning"></a><span data-ttu-id="64bde-188">Particionamento funcional</span><span class="sxs-lookup"><span data-stu-id="64bde-188">Functional partitioning</span></span>

<span data-ttu-id="64bde-189">Quando for possível identificar um contexto vinculado para cada área comercial distinta em um aplicativo, o particionamento funcional é uma forma de melhorar o isolamento e o desempenho de acesso a dados.</span><span class="sxs-lookup"><span data-stu-id="64bde-189">When it's possible to identify a bounded context for each distinct business area in an application, functional partitioning is a way to improve isolation and data access performance.</span></span> <span data-ttu-id="64bde-190">Outro uso comum do particionamento funcional é separar dados de leitura/gravação de dados somente leitura.</span><span class="sxs-lookup"><span data-stu-id="64bde-190">Another common use for functional partitioning is to separate read-write data from read-only data.</span></span> <span data-ttu-id="64bde-191">A Figura 3 mostra uma visão geral de particionamento funcional em que os dados do inventário são separados dos dados do cliente.</span><span class="sxs-lookup"><span data-stu-id="64bde-191">Figure 3 shows an overview of functional partitioning where inventory data is separated from customer data.</span></span>

![Particionamento funcional de dados por contexto ou subdomínio vinculado](./images/data-partitioning/DataPartitioning03.png)

<span data-ttu-id="64bde-193">*Figura 3. Particionamento funcional de dados por contexto ou subdomínio vinculado.*</span><span class="sxs-lookup"><span data-stu-id="64bde-193">*Figure 3. Functionally partitioning data by bounded context or subdomain.*</span></span>

<span data-ttu-id="64bde-194">Essa estratégia de particionamento pode ajudar a reduzir a contenção do acesso a dados em diferentes partes de um sistema.</span><span class="sxs-lookup"><span data-stu-id="64bde-194">This partitioning strategy can help reduce data access contention across different parts of a system.</span></span>

## <a name="designing-partitions-for-scalability"></a><span data-ttu-id="64bde-195">Criando partições para a escalabilidade</span><span class="sxs-lookup"><span data-stu-id="64bde-195">Designing partitions for scalability</span></span>

<span data-ttu-id="64bde-196">É fundamental considerar o tamanho e a carga de trabalho de cada partição e balanceá-los para que os dados sejam distribuídos para obtenção da máxima escalabilidade.</span><span class="sxs-lookup"><span data-stu-id="64bde-196">It's vital to consider size and workload for each partition and balance them so that data is distributed to achieve maximum scalability.</span></span> <span data-ttu-id="64bde-197">No entanto, você também deve particionar os dados para que eles não excedam os limites de dimensionamento de um único repositório de partição.</span><span class="sxs-lookup"><span data-stu-id="64bde-197">However, you must also partition the data so that it does not exceed the scaling limits of a single partition store.</span></span>

<span data-ttu-id="64bde-198">Siga estas etapas ao criar partições para escalabilidade:</span><span class="sxs-lookup"><span data-stu-id="64bde-198">Follow these steps when designing partitions for scalability:</span></span>

1. <span data-ttu-id="64bde-199">Analise o aplicativo para entender os padrões de acesso a dados, como o tamanho do conjunto de resultados retornado por cada consulta, a frequência de acesso, a latência inerente e os requisitos de processamento de computação do lado do servidor.</span><span class="sxs-lookup"><span data-stu-id="64bde-199">Analyze the application to understand the data access patterns, such as the size of the result set returned by each query, the frequency of access, the inherent latency, and the server-side compute processing requirements.</span></span> <span data-ttu-id="64bde-200">Em muitos casos, algumas entidades principais exigirão a maior parte dos recursos de processamento.</span><span class="sxs-lookup"><span data-stu-id="64bde-200">In many cases, a few major entities will demand most of the processing resources.</span></span>
2. <span data-ttu-id="64bde-201">Use essa análise para determinar as metas de escalabilidade atuais e futuras, como o tamanho dos dados e carga de trabalho.</span><span class="sxs-lookup"><span data-stu-id="64bde-201">Use this analysis to determine the current and future scalability targets, such as data size and workload.</span></span> <span data-ttu-id="64bde-202">Em seguida, distribua os dados nas partições para atender à meta de escalabilidade.</span><span class="sxs-lookup"><span data-stu-id="64bde-202">Then distribute the data across the partitions to meet the scalability target.</span></span> <span data-ttu-id="64bde-203">Para o particionamento horizontal, é importante escolher a chave de fragmento certa para garantir que a distribuição seja uniforme.</span><span class="sxs-lookup"><span data-stu-id="64bde-203">For horizontal partitioning, choosing the right shard key is important to make sure distribution is even.</span></span> <span data-ttu-id="64bde-204">Para saber mais, confira [Padrão de fragmentação].</span><span class="sxs-lookup"><span data-stu-id="64bde-204">For more information, see the [Sharding pattern].</span></span>
3. <span data-ttu-id="64bde-205">Verifique se cada partição tem recursos suficientes para lidar com os requisitos de escalabilidade em termos de tamanho de dados e taxa de transferência.</span><span class="sxs-lookup"><span data-stu-id="64bde-205">Make sure each partition has enough resources to handle the scalability requirements, in terms of data size and throughput.</span></span> <span data-ttu-id="64bde-206">Dependendo do armazenamento de dados, pode haver um limite na quantidade de espaço de armazenamento, capacidade de processamento ou largura de banda de rede por partição.</span><span class="sxs-lookup"><span data-stu-id="64bde-206">Depending on the data store, there might be a limit on the amount of storage space, processing power, or network bandwidth per partition.</span></span> <span data-ttu-id="64bde-207">Se os requisitos tiverem a probabilidade de exceder esses limites, poderá ser preciso refinar sua estratégia de particionamento ou dividir ainda mais os dados, possivelmente combinando duas ou mais estratégias.</span><span class="sxs-lookup"><span data-stu-id="64bde-207">If the requirements are likely to exceed these limits, you may need to refine your partitioning strategy or split data out further, possibly combining two or more strategies.</span></span>
4. <span data-ttu-id="64bde-208">Monitore o sistema para verificar se os dados são distribuídos conforme o esperado e se as partições podem manipular a carga.</span><span class="sxs-lookup"><span data-stu-id="64bde-208">Monitor the system to verify that data is distributed as expected and that the partitions can handle the load.</span></span> <span data-ttu-id="64bde-209">O uso real nem sempre corresponde à previsão de uma análise.</span><span class="sxs-lookup"><span data-stu-id="64bde-209">Actual usage does not always match what an analysis predicts.</span></span> <span data-ttu-id="64bde-210">Nesse caso, pode ser possível rebalancear as partições ou mesmo reprojetar algumas partes do sistema para obter o balanceamento necessário.</span><span class="sxs-lookup"><span data-stu-id="64bde-210">If so, it might be possible to rebalance the partitions, or else redesign some parts of the system to gain the required balance.</span></span>

<span data-ttu-id="64bde-211">Alguns ambientes de nuvem alocam recursos em termos de limites de infraestrutura.</span><span class="sxs-lookup"><span data-stu-id="64bde-211">Some cloud environments allocate resources in terms of infrastructure boundaries.</span></span> <span data-ttu-id="64bde-212">Garanta que os limites de seu limite selecionado forneçam espaço suficiente para qualquer aumento previsto no volume de dados, em termos de armazenamento de dados, capacidade de processamento e largura de banda.</span><span class="sxs-lookup"><span data-stu-id="64bde-212">Ensure that the limits of your selected boundary provide enough room for any anticipated growth in the volume of data, in terms of data storage, processing power, and bandwidth.</span></span>

<span data-ttu-id="64bde-213">Por exemplo, caso você use o armazenamento de tabelas do Azure, há um limite para o volume de solicitações que podem ser administradas por uma única partição em um determinado período de tempo.</span><span class="sxs-lookup"><span data-stu-id="64bde-213">For example, if you use Azure table storage, there is a limit to the volume of requests that can be handled by a single partition in a particular period of time.</span></span> <span data-ttu-id="64bde-214">(Confira [Metas de desempenho e escalabilidade do armazenamento do Azure].) Um fragmento ocupado pode exigir mais recursos do que uma única partição pode administrar.</span><span class="sxs-lookup"><span data-stu-id="64bde-214">(See [Azure storage scalability and performance targets].) A busy shard might require more resources than a single partition can handle.</span></span> <span data-ttu-id="64bde-215">Nesse caso, o fragmento pode precisar ser reparticionado para distribuir a carga.</span><span class="sxs-lookup"><span data-stu-id="64bde-215">If so, the shard might need to be repartitioned to spread the load.</span></span> <span data-ttu-id="64bde-216">Se o tamanho total ou a taxa de transferência dessas tabelas exceder a capacidade de uma conta de armazenamento, pode ser necessário criar mais contas de armazenamento e distribuir as tabelas entre essas contas.</span><span class="sxs-lookup"><span data-stu-id="64bde-216">If the total size or throughput of these tables exceeds the capacity of a storage account, you might need to create additional storage accounts and spread the tables across these accounts.</span></span>

## <a name="designing-partitions-for-query-performance"></a><span data-ttu-id="64bde-217">Criando partições para o desempenho da consulta</span><span class="sxs-lookup"><span data-stu-id="64bde-217">Designing partitions for query performance</span></span>

<span data-ttu-id="64bde-218">Muitas vezes, o desempenho da consulta pode ser impulsionado pelo uso de conjuntos de dados menores e pela execução de consultas paralelas.</span><span class="sxs-lookup"><span data-stu-id="64bde-218">Query performance can often be boosted by using smaller data sets and by running parallel queries.</span></span> <span data-ttu-id="64bde-219">Cada partição deve conter uma pequena proporção do conjunto de dados inteiro.</span><span class="sxs-lookup"><span data-stu-id="64bde-219">Each partition should contain a small proportion of the entire data set.</span></span> <span data-ttu-id="64bde-220">Essa redução no volume pode melhorar o desempenho das consultas.</span><span class="sxs-lookup"><span data-stu-id="64bde-220">This reduction in volume can improve the performance of queries.</span></span> <span data-ttu-id="64bde-221">No entanto, o particionamento não é uma alternativa para a criação e configuração adequadas de um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="64bde-221">However, partitioning is not an alternative for designing and configuring a database appropriately.</span></span> <span data-ttu-id="64bde-222">Por exemplo, verifique se os índices necessários estão em vigor.</span><span class="sxs-lookup"><span data-stu-id="64bde-222">For example, make sure that you have the necessary indexes in place.</span></span>

<span data-ttu-id="64bde-223">Siga estas etapas ao criar partições para desempenho de consulta:</span><span class="sxs-lookup"><span data-stu-id="64bde-223">Follow these steps when designing partitions for query performance:</span></span>

1. <span data-ttu-id="64bde-224">Examine os requisitos e o desempenho do aplicativo:</span><span class="sxs-lookup"><span data-stu-id="64bde-224">Examine the application requirements and performance:</span></span>

   - <span data-ttu-id="64bde-225">Use os requisitos de negócios para determinar as consultas críticas que devem sempre ser executadas rapidamente.</span><span class="sxs-lookup"><span data-stu-id="64bde-225">Use business requirements to determine the critical queries that must always perform quickly.</span></span>
   - <span data-ttu-id="64bde-226">Monitore o sistema para identificar todas as consultas que são executadas lentamente.</span><span class="sxs-lookup"><span data-stu-id="64bde-226">Monitor the system to identify any queries that perform slowly.</span></span>
   - <span data-ttu-id="64bde-227">Descubra quais consultas são executadas mais frequentemente.</span><span class="sxs-lookup"><span data-stu-id="64bde-227">Find which queries are performed most frequently.</span></span> <span data-ttu-id="64bde-228">Mesmo se uma única consulta tiver um custo mínimo, o consumo de recursos cumulativo poderia ser significativo.</span><span class="sxs-lookup"><span data-stu-id="64bde-228">Even if a single query has a minimal cost, the cumulative resource consumption could be significant.</span></span>

2. <span data-ttu-id="64bde-229">Particione os dados que estejam causando lentidão no desempenho:</span><span class="sxs-lookup"><span data-stu-id="64bde-229">Partition the data that is causing slow performance:</span></span>
   - <span data-ttu-id="64bde-230">Limitar o tamanho de cada partição para que o tempo de resposta da consulta esteja dentro da meta.</span><span class="sxs-lookup"><span data-stu-id="64bde-230">Limit the size of each partition so that the query response time is within target.</span></span>
   - <span data-ttu-id="64bde-231">Se você usar o particionamento horizontal, projete a chave compartilhada de modo que o aplicativo possa selecionar facilmente a partição correta.</span><span class="sxs-lookup"><span data-stu-id="64bde-231">If you use horizontal partitioning, design the shard key so that the application can easily select the right partition.</span></span> <span data-ttu-id="64bde-232">Isso impede que a consulta tenha que verificar cada partição.</span><span class="sxs-lookup"><span data-stu-id="64bde-232">This prevents the query from having to scan through every partition.</span></span>
   - <span data-ttu-id="64bde-233">Considere o local de uma partição.</span><span class="sxs-lookup"><span data-stu-id="64bde-233">Consider the location of a partition.</span></span> <span data-ttu-id="64bde-234">Se possível, tente manter os dados nas partições que estão geograficamente próximas aos aplicativos e aos usuários que os acessam.</span><span class="sxs-lookup"><span data-stu-id="64bde-234">If possible, try to keep data in partitions that are geographically close to the applications and users that access it.</span></span>

3. <span data-ttu-id="64bde-235">Se uma entidade tiver requisitos de desempenho da consulta e de taxa de transferência, use o particionamento funcional com base nessa entidade.</span><span class="sxs-lookup"><span data-stu-id="64bde-235">If an entity has throughput and query performance requirements, use functional partitioning based on that entity.</span></span> <span data-ttu-id="64bde-236">Se isso ainda não atender aos requisitos, aplique também o particionamento horizontal.</span><span class="sxs-lookup"><span data-stu-id="64bde-236">If this still doesn't satisfy the requirements, apply horizontal partitioning as well.</span></span> <span data-ttu-id="64bde-237">Na maioria dos casos, uma única estratégia de particionamento será suficiente, mas em alguns casos, é mais eficiente combinar as duas estratégias.</span><span class="sxs-lookup"><span data-stu-id="64bde-237">In most cases a single partitioning strategy will suffice, but in some cases it is more efficient to combine both strategies.</span></span>

4. <span data-ttu-id="64bde-238">Cogite executar consultas paralelamente nas partições para melhorar o desempenho.</span><span class="sxs-lookup"><span data-stu-id="64bde-238">Consider running queries in parallel across partitions to improve performance.</span></span>

## <a name="designing-partitions-for-availability"></a><span data-ttu-id="64bde-239">Criando partições para a disponibilidade</span><span class="sxs-lookup"><span data-stu-id="64bde-239">Designing partitions for availability</span></span>

<span data-ttu-id="64bde-240">O particionamento de dados pode melhorar a disponibilidade de aplicativos, garantindo que todo o conjunto de dados não constitua um ponto único de falha e que subconjuntos individuais do conjunto de dados possam ser gerenciados independentemente.</span><span class="sxs-lookup"><span data-stu-id="64bde-240">Partitioning data can improve the availability of applications by ensuring that the entire dataset does not constitute a single point of failure and that individual subsets of the dataset can be managed independently.</span></span>

<span data-ttu-id="64bde-241">Leve os fatores a seguir em consideração, os quais afetam a disponibilidade:</span><span class="sxs-lookup"><span data-stu-id="64bde-241">Consider the following factors that affect availability:</span></span>

<span data-ttu-id="64bde-242">**O quanto os dados são fundamentais para as operações de negócios**.</span><span class="sxs-lookup"><span data-stu-id="64bde-242">**How critical the data is to business operations**.</span></span> <span data-ttu-id="64bde-243">Identifique quais dados são informações de negócios críticas, como transações, e quais são dados operacionais menos críticos, como arquivos de log.</span><span class="sxs-lookup"><span data-stu-id="64bde-243">Identify which data is critical business information, such as transactions, and which data is less critical operational data, such as log files.</span></span>

- <span data-ttu-id="64bde-244">Cogite armazenar os dados críticos em partições altamente disponíveis com um plano de backup adequado.</span><span class="sxs-lookup"><span data-stu-id="64bde-244">Consider storing critical data in highly-available partitions with an appropriate backup plan.</span></span>

- <span data-ttu-id="64bde-245">Estabeleça procedimentos de gerenciamento e monitoramento separados para conjunto de dados diferentes.</span><span class="sxs-lookup"><span data-stu-id="64bde-245">Establish separate management and monitoring procedures for the different datasets.</span></span>

- <span data-ttu-id="64bde-246">Colocar os dados com o mesmo nível de importância na mesma partição para que eles possam ser armazenados juntos em backup com uma frequência adequada.</span><span class="sxs-lookup"><span data-stu-id="64bde-246">Place data that has the same level of criticality in the same partition so that it can be backed up together at an appropriate frequency.</span></span> <span data-ttu-id="64bde-247">Por exemplo, as partições que contêm dados de transações podem precisar de backup com mais frequência do que as partições que contêm informações de rastreamento ou registro em log.</span><span class="sxs-lookup"><span data-stu-id="64bde-247">For example, partitions that hold transaction data might need to be backed up more frequently than partitions that hold logging or trace information.</span></span>

<span data-ttu-id="64bde-248">**Como as partições individuais podem ser gerenciadas**.</span><span class="sxs-lookup"><span data-stu-id="64bde-248">**How individual partitions can be managed**.</span></span> <span data-ttu-id="64bde-249">Criar partições para dar suporte ao gerenciamento e manutenção independentes oferece várias vantagens.</span><span class="sxs-lookup"><span data-stu-id="64bde-249">Designing partitions to support independent management and maintenance provides several advantages.</span></span> <span data-ttu-id="64bde-250">Por exemplo: </span><span class="sxs-lookup"><span data-stu-id="64bde-250">For example:</span></span>

- <span data-ttu-id="64bde-251">Se uma partição falhar, ela pode ser recuperada independentemente sem aplicativos que acessem dados em outras partições.</span><span class="sxs-lookup"><span data-stu-id="64bde-251">If a partition fails, it can be recovered independently without applications that access data in other partitions.</span></span>

- <span data-ttu-id="64bde-252">O particionamento de dados por área geográfica permite que as tarefas de manutenção agendadas ocorram fora dos horários de pico de cada local.</span><span class="sxs-lookup"><span data-stu-id="64bde-252">Partitioning data by geographical area allows scheduled maintenance tasks to occur at off-peak hours for each location.</span></span> <span data-ttu-id="64bde-253">Verifique se as partições não são muito grandes para evitar a conclusão de qualquer manutenção planejada durante esse período.</span><span class="sxs-lookup"><span data-stu-id="64bde-253">Ensure that partitions are not too big to prevent any planned maintenance from being completed during this period.</span></span>

<span data-ttu-id="64bde-254">**A possibilidade de replica dados críticos entre partições**.</span><span class="sxs-lookup"><span data-stu-id="64bde-254">**Whether to replicate critical data across partitions**.</span></span> <span data-ttu-id="64bde-255">Essa estratégia pode melhorar a disponibilidade e o desempenho, mas também pode apresentar problemas de consistência.</span><span class="sxs-lookup"><span data-stu-id="64bde-255">This strategy can improve availability and performance, but can also introduce consistency issues.</span></span> <span data-ttu-id="64bde-256">A sincronização das alterações com cada réplica é demorada.</span><span class="sxs-lookup"><span data-stu-id="64bde-256">It takes time to synchronize changes with every replica.</span></span> <span data-ttu-id="64bde-257">Durante esse período, diferentes partições conterão valores de dados diferentes.</span><span class="sxs-lookup"><span data-stu-id="64bde-257">During this period, different partitions will contain different data values.</span></span>

## <a name="application-design-considerations"></a><span data-ttu-id="64bde-258">Considerações sobre o design de aplicativo</span><span class="sxs-lookup"><span data-stu-id="64bde-258">Application design considerations</span></span>

<span data-ttu-id="64bde-259">O particionamento acrescenta complexidade ao design e desenvolvimento do sistema.</span><span class="sxs-lookup"><span data-stu-id="64bde-259">Partitioning adds complexity to the design and development of your system.</span></span> <span data-ttu-id="64bde-260">Considere o particionamento como uma parte fundamental do design do sistema, mesmo que inicialmente o sistema contenha apenas uma única partição.</span><span class="sxs-lookup"><span data-stu-id="64bde-260">Consider partitioning as a fundamental part of system design even if the system initially only contains a single partition.</span></span> <span data-ttu-id="64bde-261">Se você pensar no particionamento como uma consideração posterior, o desafio será maior, porque você já tem um sistema em tempo real para manter:</span><span class="sxs-lookup"><span data-stu-id="64bde-261">If you address partitioning as an afterthought, it will be more challenging because you already have a live system to maintain:</span></span>

- <span data-ttu-id="64bde-262">A lógica de acesso a dados precisa ser modificada.</span><span class="sxs-lookup"><span data-stu-id="64bde-262">Data access logic will need to be modified.</span></span>
- <span data-ttu-id="64bde-263">Pode ser que grandes quantidades de dados existentes precisem ser migradas para distribuí-las por partições</span><span class="sxs-lookup"><span data-stu-id="64bde-263">Large quantities of existing data may need to be migrated, to distribute it across partitions</span></span>
- <span data-ttu-id="64bde-264">Os usuários esperam poder continuar usando o sistema durante a migração.</span><span class="sxs-lookup"><span data-stu-id="64bde-264">Users expect to be able to continue using the system during the migration.</span></span>

<span data-ttu-id="64bde-265">Em alguns casos, o particionamento não é considerado importante, pois o conjunto de dados inicial é pequeno e pode ser facilmente manipulado por um único servidor.</span><span class="sxs-lookup"><span data-stu-id="64bde-265">In some cases, partitioning is not considered important because the initial dataset is small and can be easily handled by a single server.</span></span> <span data-ttu-id="64bde-266">Isso pode ocorrer em algumas cargas de trabalho, mas muitos sistemas comerciais precisam ser expandidos conforme o número de usuários aumenta.</span><span class="sxs-lookup"><span data-stu-id="64bde-266">This might be true for some workloads, but many commercial systems need to expand as the number of users increases.</span></span>

<span data-ttu-id="64bde-267">Além disso, não são apenas os grandes armazenamentos de dados que se beneficiam do particionamento.</span><span class="sxs-lookup"><span data-stu-id="64bde-267">Moreover, it's not only large data stores that benefit from partitioning.</span></span> <span data-ttu-id="64bde-268">Por exemplo, um repositório de dados pequeno pode ser muito acessado por centenas de clientes simultâneos.</span><span class="sxs-lookup"><span data-stu-id="64bde-268">For example, a small data store might be heavily accessed by hundreds of concurrent clients.</span></span> <span data-ttu-id="64bde-269">Particionar os dados nessa situação pode ajudar a reduzir a contenção e melhorar a taxa de transferência.</span><span class="sxs-lookup"><span data-stu-id="64bde-269">Partitioning the data in this situation can help to reduce contention and improve throughput.</span></span>

<span data-ttu-id="64bde-270">Considere os seguintes pontos ao criar um esquema de particionamento de dados:</span><span class="sxs-lookup"><span data-stu-id="64bde-270">Consider the following points when you design a data partitioning scheme:</span></span>

<span data-ttu-id="64bde-271">**Minimize as operações de acesso de dados entre partições**.</span><span class="sxs-lookup"><span data-stu-id="64bde-271">**Minimize cross-partition data access operations**.</span></span> <span data-ttu-id="64bde-272">Sempre que possível, mantenha os dados para as operações mais comuns do banco de dados juntos em cada partição para minimizar as operações de acesso a dados entre partições.</span><span class="sxs-lookup"><span data-stu-id="64bde-272">Where possible, keep data for the most common database operations together in each partition to minimize cross-partition data access operations.</span></span> <span data-ttu-id="64bde-273">Consultar entre partições pode ser mais demorado do que consultar uma única partição; porém, otimizar as partições para um conjunto de consultas pode afetar outros conjuntos de consultas.</span><span class="sxs-lookup"><span data-stu-id="64bde-273">Querying across partitions can be more time-consuming than querying within a single partition, but optimizing partitions for one set of queries might adversely affect other sets of queries.</span></span> <span data-ttu-id="64bde-274">Se for preciso fazer consulta entre partições, minimize o tempo de consulta executando consultas paralelas e agregando os resultados no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="64bde-274">If you must query across partitions, minimize query time by running parallel queries and aggregating the results within the application.</span></span> <span data-ttu-id="64bde-275">(Talvez essa abordagem não seja possível em alguns casos, por exemplo, quando o resultado de uma consulta é usado na próxima consulta.)</span><span class="sxs-lookup"><span data-stu-id="64bde-275">(This approach might not be possible in some cases, such as when the result from one query is used in the next query.)</span></span>

<span data-ttu-id="64bde-276">**Cogite replicar dados de referência estáticos.**</span><span class="sxs-lookup"><span data-stu-id="64bde-276">**Consider replicating static reference data.**</span></span> <span data-ttu-id="64bde-277">Se as consultas usarem dados de referência relativamente estáticos, como tabelas de CEP ou listas de produtos, considere replicar esses dados em todas as partições para reduzir as operações de pesquisa separadas em outras partições.</span><span class="sxs-lookup"><span data-stu-id="64bde-277">If queries use relatively static reference data, such as postal code tables or product lists, consider replicating this data in all of the partitions to reduce separate lookup operations in different partitions.</span></span> <span data-ttu-id="64bde-278">Essa abordagem também pode reduzir a probabilidade de que os dados de referência se tornem um conjunto de dados “frequente”, com tráfego pesado de todo o sistema.</span><span class="sxs-lookup"><span data-stu-id="64bde-278">This approach can also reduce the likelihood of the reference data becoming a "hot" dataset, with heavy traffic from across the entire system.</span></span> <span data-ttu-id="64bde-279">No entanto, há um custo adicional associado à sincronização de quaisquer alterações dos dados de referência.</span><span class="sxs-lookup"><span data-stu-id="64bde-279">However, there is an additional cost associated with synchronizing any changes to the reference data.</span></span>

<span data-ttu-id="64bde-280">**Minimize as junções entre partições.**</span><span class="sxs-lookup"><span data-stu-id="64bde-280">**Minimize cross-partition joins.**</span></span> <span data-ttu-id="64bde-281">Sempre que possível, minimize os requisitos de integridade referencial entre partições verticais e funcionais.</span><span class="sxs-lookup"><span data-stu-id="64bde-281">Where possible, minimize requirements for referential integrity across vertical and functional partitions.</span></span> <span data-ttu-id="64bde-282">Nesses esquemas, o aplicativo é responsável por manter a integridade referencial entre partições.</span><span class="sxs-lookup"><span data-stu-id="64bde-282">In these schemes, the application is responsible for maintaining referential integrity across partitions.</span></span> <span data-ttu-id="64bde-283">As consultas que unem os dados em várias partições são ineficientes porque o aplicativo normalmente precisa executar consultas consecutivas com base em uma chave e em uma chave estrangeira.</span><span class="sxs-lookup"><span data-stu-id="64bde-283">Queries that join data across multiple partitions are inefficient because the application typically needs to perform consecutive queries based on a key and then a foreign key.</span></span> <span data-ttu-id="64bde-284">Em vez disso, considere replicar ou cancelar a normalização dos dados relevantes.</span><span class="sxs-lookup"><span data-stu-id="64bde-284">Instead, consider replicating or de-normalizing the relevant data.</span></span> <span data-ttu-id="64bde-285">Se as uniões entre partições forem necessárias, execute consultas paralelas nas partições e reúna os dados no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="64bde-285">If cross-partition joins are necessary, run parallel queries over the partitions and join the data within the application.</span></span>

<span data-ttu-id="64bde-286">**Adote a consistência eventual**.</span><span class="sxs-lookup"><span data-stu-id="64bde-286">**Embrace eventual consistency**.</span></span> <span data-ttu-id="64bde-287"> Avalie se a coerência forte é realmente um requisito.</span><span class="sxs-lookup"><span data-stu-id="64bde-287">Evaluate whether strong consistency is actually a requirement.</span></span> <span data-ttu-id="64bde-288">Uma abordagem comum em sistemas distribuídos é implementar a consistência eventual.</span><span class="sxs-lookup"><span data-stu-id="64bde-288">A common approach in distributed systems is to implement eventual consistency.</span></span> <span data-ttu-id="64bde-289">Os dados em cada partição são atualizados separadamente, e a lógica de aplicativo garante que a atualizações sejam concluídas com êxito.</span><span class="sxs-lookup"><span data-stu-id="64bde-289">The data in each partition is updated separately, and the application logic ensures that the updates are all completed successfully.</span></span> <span data-ttu-id="64bde-290">Ela também trata das inconsistências que podem surgir da consulta de dados enquanto uma operação finalmente consistente está em execução.</span><span class="sxs-lookup"><span data-stu-id="64bde-290">It also handles the inconsistencies that can arise from querying data while an eventually consistent operation is running.</span></span>

<span data-ttu-id="64bde-291">**Considere como as consultas localizam a partição correta**.</span><span class="sxs-lookup"><span data-stu-id="64bde-291">**Consider how queries locate the correct partition**.</span></span> <span data-ttu-id="64bde-292">Se uma consulta precisar verificar todas as partições para localizar os dados necessários, haverá um impacto significativo no desempenho, mesmo quando várias consultas paralelas estiverem em execução.</span><span class="sxs-lookup"><span data-stu-id="64bde-292">If a query must scan all partitions to locate the required data, there is a significant impact on performance, even when multiple parallel queries are running.</span></span> <span data-ttu-id="64bde-293">Com o particionamento vertical e funcional, as consultas podem especificar as partições naturalmente.</span><span class="sxs-lookup"><span data-stu-id="64bde-293">With vertical and functional partitioning, queries can naturally specify the partition.</span></span> <span data-ttu-id="64bde-294">O particionamento horizontal, por outro lado, pode dificultar a localização de um item, pois cada fragmento tem o mesmo esquema.</span><span class="sxs-lookup"><span data-stu-id="64bde-294">Horizontal partitioning, on the other hand, can make locating an item difficult, because every shard has the same schema.</span></span> <span data-ttu-id="64bde-295">Uma solução típica para manter um mapa que é usado para procurar a localização do fragmento para itens específicos.</span><span class="sxs-lookup"><span data-stu-id="64bde-295">A typical solution to maintain a map that is used to look up the shard location for specific items.</span></span> <span data-ttu-id="64bde-296">Esse mapa pode ser implementado na lógica de fragmentação do aplicativo ou mantido pelo repositório de dados se a fragmentação transparente for permitida.</span><span class="sxs-lookup"><span data-stu-id="64bde-296">This map can be implemented in the sharding logic of the application, or maintained by the data store if it supports transparent sharding.</span></span>

<span data-ttu-id="64bde-297">**Considere o rebalanceamento periódico de fragmentos**.</span><span class="sxs-lookup"><span data-stu-id="64bde-297">**Consider periodically rebalancing shards**.</span></span> <span data-ttu-id="64bde-298">Com o particionamento horizontal o rebalanceamento de fragmentos pode ajudar a distribuir os dados uniformemente por tamanho e carga de trabalho para minimizar os pontos de acesso, maximizar o desempenho da consulta e contornar as limitações de armazenamento físico.</span><span class="sxs-lookup"><span data-stu-id="64bde-298">With horizontal partitioning, rebalancing shards can help distribute the data evenly by size and by workload to minimize hotspots, maximize query performance, and work around physical storage limitations.</span></span> <span data-ttu-id="64bde-299">No entanto, isso é uma tarefa complexa que geralmente requer o uso de uma ferramenta ou um processo personalizado.</span><span class="sxs-lookup"><span data-stu-id="64bde-299">However, this is a complex task that often requires the use of a custom tool or process.</span></span>

<span data-ttu-id="64bde-300">**Replique partições.**</span><span class="sxs-lookup"><span data-stu-id="64bde-300">**Replicate partitions.**</span></span> <span data-ttu-id="64bde-301">Se você replicar cada partição, ela fornecerá proteção adicional contra falhas.</span><span class="sxs-lookup"><span data-stu-id="64bde-301">If you replicate each partition, it provides additional protection against failure.</span></span> <span data-ttu-id="64bde-302">Se uma única réplica falhar, as consultas podem ser direcionadas a uma cópia funcional.</span><span class="sxs-lookup"><span data-stu-id="64bde-302">If a single replica fails, queries can be directed towards a working copy.</span></span>

<span data-ttu-id="64bde-303">**Se você atingir os limites físicos de uma estratégia de particionamento, talvez seja necessário estender a escalabilidade para um nível diferente**.</span><span class="sxs-lookup"><span data-stu-id="64bde-303">**If you reach the physical limits of a partitioning strategy, you might need to extend the scalability to a different level**.</span></span> <span data-ttu-id="64bde-304">Por exemplo, se o particionamento estiver no nível do banco de dados, você poderá precisar localizar ou replicar partições em vários bancos de dados.</span><span class="sxs-lookup"><span data-stu-id="64bde-304">For example, if partitioning is at the database level, you might need to locate or replicate partitions in multiple databases.</span></span> <span data-ttu-id="64bde-305">Se o particionamento já estiver no nível do banco de dados e as limitações físicas forem um problema, isso pode significar que você precisa localizar ou replicar partições em várias contas de hospedagem.</span><span class="sxs-lookup"><span data-stu-id="64bde-305">If partitioning is already at the database level, and physical limitations are an issue, it might mean that you need to locate or replicate partitions in multiple hosting accounts.</span></span>

<span data-ttu-id="64bde-306">**Evite as transações que acessam os dados em várias partições**.</span><span class="sxs-lookup"><span data-stu-id="64bde-306">**Avoid transactions that access data in multiple partitions**.</span></span> <span data-ttu-id="64bde-307">Alguns repositórios de dados implementam consistência e integridade transacionais para operações que modificam dados, mas somente quando os dados estão localizados em uma única partição.</span><span class="sxs-lookup"><span data-stu-id="64bde-307">Some data stores implement transactional consistency and integrity for operations that modify data, but only when the data is located in a single partition.</span></span> <span data-ttu-id="64bde-308">Se precisar de suporte transacional em várias partições, você provavelmente precisará implementá-lo como parte da lógica do aplicativo, pois a maioria dos sistemas de particionamento não dão suporte nativo.</span><span class="sxs-lookup"><span data-stu-id="64bde-308">If you need transactional support across multiple partitions, you will probably need to implement this as part of your application logic because most partitioning systems do not provide native support.</span></span>

<span data-ttu-id="64bde-309">Todos os repositórios de dados exigem algumas atividades operacionais de gerenciamento e monitoramento.</span><span class="sxs-lookup"><span data-stu-id="64bde-309">All data stores require some operational management and monitoring activity.</span></span> <span data-ttu-id="64bde-310">As tarefas podem variar de carregamento de dados, backup e restauração de dados a reorganização de dados, além de garantir que o sistema esteja funcionando correta e eficientemente.</span><span class="sxs-lookup"><span data-stu-id="64bde-310">The tasks can range from loading data, backing up and restoring data, reorganizing data, and ensuring that the system is performing correctly and efficiently.</span></span>

<span data-ttu-id="64bde-311">Considere os seguintes fatores que afetam o gerenciamento operacional:</span><span class="sxs-lookup"><span data-stu-id="64bde-311">Consider the following factors that affect operational management:</span></span>

- <span data-ttu-id="64bde-312">**Como implementar tarefas apropriadas de gerenciamento e operacionais quando os dados são particionados**.</span><span class="sxs-lookup"><span data-stu-id="64bde-312">**How to implement appropriate management and operational tasks when the data is partitioned**.</span></span> <span data-ttu-id="64bde-313">Essas tarefas podem incluir backup e restauração, arquivamento de dados, monitoramento do sistema e outras tarefas administrativas.</span><span class="sxs-lookup"><span data-stu-id="64bde-313">These tasks might include backup and restore, archiving data, monitoring the system, and other administrative tasks.</span></span> <span data-ttu-id="64bde-314">Por exemplo, manter a consistência lógica durante as operações de backup e restauração pode ser um desafio.</span><span class="sxs-lookup"><span data-stu-id="64bde-314">For example, maintaining logical consistency during backup and restore operations can be a challenge.</span></span>

- <span data-ttu-id="64bde-315">**Como carregar os dados em várias partições e adicionar novos dados que estão chegando de outras fontes**.</span><span class="sxs-lookup"><span data-stu-id="64bde-315">**How to load the data into multiple partitions and add new data that's arriving from other sources**.</span></span> <span data-ttu-id="64bde-316">Alguns utilitários e ferramentas podem não permitir operações de dados fragmentadas, como carregamento de dados na partição correta.</span><span class="sxs-lookup"><span data-stu-id="64bde-316">Some tools and utilities might not support sharded data operations such as loading data into the correct partition.</span></span>

- <span data-ttu-id="64bde-317">**Como arquivar e excluir os dados regularmente**.</span><span class="sxs-lookup"><span data-stu-id="64bde-317">**How to archive and delete the data on a regular basis**.</span></span> <span data-ttu-id="64bde-318">Para impedir o aumento excessivo de partições, você precisa arquivar e excluir dados regularmente (talvez mensalmente).</span><span class="sxs-lookup"><span data-stu-id="64bde-318">To prevent the excessive growth of partitions, you need to archive and delete data on a regular basis (perhaps monthly).</span></span> <span data-ttu-id="64bde-319">Pode ser necessário transformar os dados para correspondência com um esquema diferente de arquivamento.</span><span class="sxs-lookup"><span data-stu-id="64bde-319">It might be necessary to transform the data to match a different archive schema.</span></span>

- <span data-ttu-id="64bde-320">**Como localizar problemas de integridade de dados**.</span><span class="sxs-lookup"><span data-stu-id="64bde-320">**How to locate data integrity issues**.</span></span> <span data-ttu-id="64bde-321">Considere a execução de um processo periódico para localizar quaisquer problemas de integridade de dados, como os dados em uma partição que fazem referência a informações ausentes em outra.</span><span class="sxs-lookup"><span data-stu-id="64bde-321">Consider running a periodic process to locate any data integrity issues, such as data in one partition that references missing information in another.</span></span> <span data-ttu-id="64bde-322">O processo pode tentar corrigir esses problemas de forma automática ou simplesmente gerar um relatório para revisão manual.</span><span class="sxs-lookup"><span data-stu-id="64bde-322">The process can either attempt to fix these issues automatically or simply generate a report for manual review.</span></span>

## <a name="rebalancing-partitions"></a><span data-ttu-id="64bde-323">Rebalanceando partições</span><span class="sxs-lookup"><span data-stu-id="64bde-323">Rebalancing partitions</span></span>

<span data-ttu-id="64bde-324">À medida que um sistema amadurece, talvez seja preciso ajustar o esquema de particionamento.</span><span class="sxs-lookup"><span data-stu-id="64bde-324">As a system matures, you might have to adjust the partitioning scheme.</span></span> <span data-ttu-id="64bde-325">Por exemplo, as partições individuais podem começar a obter um volume desproporcional de tráfego e se tornar mais acessadas, levando à contenção excessiva.</span><span class="sxs-lookup"><span data-stu-id="64bde-325">For example, individual partitions might start get a disproportionate volume of traffic and become hot, leading to excessive contention.</span></span> <span data-ttu-id="64bde-326">Ou você pode ter subestimado o volume de dados em algumas partições, fazendo com que algumas partições abordem limites de capacidade.</span><span class="sxs-lookup"><span data-stu-id="64bde-326">Or you might have underestimated the volume of data in some partitions, causing some partitions to approach capacity limits.</span></span>

<span data-ttu-id="64bde-327">Alguns armazenamentos de dados, como o Cosmos DB pode automaticamente rebalancear partições.</span><span class="sxs-lookup"><span data-stu-id="64bde-327">Some data stores, such as Cosmos DB, can automatically rebalance partitions.</span></span> <span data-ttu-id="64bde-328">Em outros casos, o rebalanceamento é uma tarefa administrativa que consiste em dois estágios:</span><span class="sxs-lookup"><span data-stu-id="64bde-328">In other cases, rebalancing is an administrative task that consists of two stages:</span></span>

1. <span data-ttu-id="64bde-329">Determine uma nova estratégia de particionamento.</span><span class="sxs-lookup"><span data-stu-id="64bde-329">Determine a new partitioning strategy.</span></span>

    - <span data-ttu-id="64bde-330">Quais partições precisam ser divididas (ou possivelmente combinadas)?</span><span class="sxs-lookup"><span data-stu-id="64bde-330">Which partitions need to be split (or possibly combined)?</span></span>
    - <span data-ttu-id="64bde-331">Qual é a nova chave de partição?</span><span class="sxs-lookup"><span data-stu-id="64bde-331">What is the new partition key?</span></span>

2. <span data-ttu-id="64bde-332">Migre os dados do antigo esquema de particionamento para o novo conjunto de partições.</span><span class="sxs-lookup"><span data-stu-id="64bde-332">Migrate data from the old partitioning scheme to the new set of partitions.</span></span>

<span data-ttu-id="64bde-333">Dependendo do armazenamento de dados, você poderá migrar os dados entre as partições enquanto eles estiverem em uso.</span><span class="sxs-lookup"><span data-stu-id="64bde-333">Depending on the data store, you might be able to migrate data between partitions while they are in use.</span></span> <span data-ttu-id="64bde-334">Isso é chamado de *migração online*.</span><span class="sxs-lookup"><span data-stu-id="64bde-334">This is called *online migration*.</span></span> <span data-ttu-id="64bde-335">Se isso não for possível, talvez você precise deixar as partições indisponíveis enquanto os dados são realocados (*migração offline*).</span><span class="sxs-lookup"><span data-stu-id="64bde-335">If that's not possible, you might need to make partitions unavailable while the data is relocated (*offline migration*).</span></span>

### <a name="offline-migration"></a><span data-ttu-id="64bde-336">Migração offline</span><span class="sxs-lookup"><span data-stu-id="64bde-336">Offline migration</span></span>

<span data-ttu-id="64bde-337">Geralmente, a migração offline é mais simples porque ela reduz as chances de ocorrência de contenção.</span><span class="sxs-lookup"><span data-stu-id="64bde-337">Offline migration is generally simpler, because it reduces the chances of contention occurring.</span></span> <span data-ttu-id="64bde-338">Conceitualmente, a migração offline funciona da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="64bde-338">Conceptually, offline migration works as follows:</span></span>

1. <span data-ttu-id="64bde-339">Marque a partição offline.</span><span class="sxs-lookup"><span data-stu-id="64bde-339">Mark the partition offline.</span></span>
2. <span data-ttu-id="64bde-340">Divida/mescle e mova os dados para as novas partições.</span><span class="sxs-lookup"><span data-stu-id="64bde-340">Split-merge and move the data to the new partitions.</span></span>
3. <span data-ttu-id="64bde-341">Verificar os dados.</span><span class="sxs-lookup"><span data-stu-id="64bde-341">Verify the data.</span></span>
4. <span data-ttu-id="64bde-342">Deixe as novas partições online.</span><span class="sxs-lookup"><span data-stu-id="64bde-342">Bring the new partitions online.</span></span>
5. <span data-ttu-id="64bde-343">Remova a partição antiga.</span><span class="sxs-lookup"><span data-stu-id="64bde-343">Remove the old partition.</span></span>

<span data-ttu-id="64bde-344">Como opção, você pode marcar uma partição como somente leitura na etapa 1 de modo que os aplicativos ainda possam ler os dados enquanto eles estão sendo movidos.</span><span class="sxs-lookup"><span data-stu-id="64bde-344">Optionally, you can mark a partition as read-only in step 1, so that applications can still read the data while it is being moved.</span></span>

## <a name="online-migration"></a><span data-ttu-id="64bde-345">Migração online</span><span class="sxs-lookup"><span data-stu-id="64bde-345">Online migration</span></span>

<span data-ttu-id="64bde-346">A migração online é mais complexa de ser executada, mas menos interruptiva.</span><span class="sxs-lookup"><span data-stu-id="64bde-346">Online migration is more complex to perform but less disruptive.</span></span> <span data-ttu-id="64bde-347">O processo é semelhante à migração offline, com a exceção de que a partição original não está marcada como offline.</span><span class="sxs-lookup"><span data-stu-id="64bde-347">The process is similar to offline migration, except the original partition is not marked offline.</span></span> <span data-ttu-id="64bde-348">Dependendo da granularidade do processo de migração (por exemplo, item por item ou fragmento por fragmento), o código de acesso a dados nos aplicativos cliente pode ter de manipular os dados de leitura e gravação que são mantidos em dois locais: a partição original e a nova partição.</span><span class="sxs-lookup"><span data-stu-id="64bde-348">Depending on the granularity of the migration process (for example, item by item versus shard by shard), the data access code in the client applications might have to handle reading and writing data that's held in two locations, the original partition and the new partition.</span></span>

## <a name="related-patterns"></a><span data-ttu-id="64bde-349">Padrões relacionados</span><span class="sxs-lookup"><span data-stu-id="64bde-349">Related patterns</span></span>

<span data-ttu-id="64bde-350">Os seguintes padrões de design podem ser relevantes para o seu cenário:</span><span class="sxs-lookup"><span data-stu-id="64bde-350">The following design patterns might be relevant to your scenario:</span></span>

- <span data-ttu-id="64bde-351">O [Padrão de fragmentação](../patterns/sharding.md) descreve algumas estratégias comuns de fragmentação de dados.</span><span class="sxs-lookup"><span data-stu-id="64bde-351">The [sharding pattern](../patterns/sharding.md) describes some common strategies for sharding data.</span></span>

- <span data-ttu-id="64bde-352">O [padrão da tabela de índice](../patterns/index-table.md) mostra como criar índices secundários sobre os dados.</span><span class="sxs-lookup"><span data-stu-id="64bde-352">The [index table pattern](../patterns/index-table.md) shows how to create secondary indexes over data.</span></span> <span data-ttu-id="64bde-353">Um aplicativo pode recuperar dados rapidamente com essa abordagem, usando consultas que não referenciam a chave primária de uma coleção.</span><span class="sxs-lookup"><span data-stu-id="64bde-353">An application can quickly retrieve data with this approach, by using queries that do not reference the primary key of a collection.</span></span>

- <span data-ttu-id="64bde-354">O [padrão de exibição materializada](../patterns/materialized-view.md) descreve como gerar exibições pré-populadas que resumem os dados para permitir operações de consulta rápidas.</span><span class="sxs-lookup"><span data-stu-id="64bde-354">The [materialized view pattern](../patterns/materialized-view.md) describes how to generate pre-populated views that summarize data to support fast query operations.</span></span> <span data-ttu-id="64bde-355">Essa abordagem poderá ser útil em um armazenamento de dados particionado se as partições que contêm os dados sendo resumidos forem distribuídas em vários locais.</span><span class="sxs-lookup"><span data-stu-id="64bde-355">This approach can be useful in a partitioned data store if the partitions that contain the data being summarized are distributed across multiple sites.</span></span>

## <a name="next-steps"></a><span data-ttu-id="64bde-356">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="64bde-356">Next steps</span></span>

- <span data-ttu-id="64bde-357">Saiba mais sobre estratégias de particionamento para serviços específicos do Azure.</span><span class="sxs-lookup"><span data-stu-id="64bde-357">Learn about partitioning strategies for specific Azure services.</span></span> <span data-ttu-id="64bde-358">Confira [Estratégias de particionamento de dados](./data-partitioning-strategies.md)</span><span class="sxs-lookup"><span data-stu-id="64bde-358">See [Data partitioning strategies](./data-partitioning-strategies.md)</span></span>

[Metas de desempenho e escalabilidade do Armazenamento do Azure]: /azure/storage/storage-scalability-targets
[Azure Storage Scalability and Performance Targets]: /azure/storage/storage-scalability-targets
