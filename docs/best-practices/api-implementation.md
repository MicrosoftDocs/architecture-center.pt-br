---
title: "Diretrizes para implementação de API"
description: "Diretrizes para modo de implementação de uma API."
author: dragon119
ms.date: 07/13/2016
pnp.series.title: Best Practices
ms.openlocfilehash: b4d197719380bf55033942b3ebcad384170d950d
ms.sourcegitcommit: b0482d49aab0526be386837702e7724c61232c60
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/14/2017
---
# <a name="api-implementation"></a><span data-ttu-id="4f348-103">Implementação da API</span><span class="sxs-lookup"><span data-stu-id="4f348-103">API implementation</span></span>
[!INCLUDE [header](../_includes/header.md)]

<span data-ttu-id="4f348-104">Uma API da Web RESTful cuidadosamente projetada define os recursos, relacionamentos e esquemas de navegação que podem ser acessados por aplicativos cliente.</span><span class="sxs-lookup"><span data-stu-id="4f348-104">A carefully-designed RESTful web API defines the resources, relationships, and navigation schemes that are accessible to client applications.</span></span> <span data-ttu-id="4f348-105">Ao implementar e implantar uma API da Web, você deve considerar os requisitos físicos do ambiente de hospedagem dessa API e o modo como ela é construída, em vez da estrutura lógica dos dados.</span><span class="sxs-lookup"><span data-stu-id="4f348-105">When you implement and deploy a web API, you should consider the physical requirements of the environment hosting the web API and the way in which the web API is constructed rather than the logical structure of the data.</span></span> <span data-ttu-id="4f348-106">Estas diretrizes abordam as práticas recomendadas para implementar uma API da Web e publicá-la para torná-la disponível para aplicativos cliente.</span><span class="sxs-lookup"><span data-stu-id="4f348-106">This guidance focusses on best practices for implementing a web API and publishing it to make it available to client applications.</span></span> <span data-ttu-id="4f348-107">Para obter informações detalhadas sobre o design de API da Web, confira [Diretrizes de design de API](/azure/architecture/best-practices/api-design).</span><span class="sxs-lookup"><span data-stu-id="4f348-107">For detailed information about web API design, see [API Design Guidance](/azure/architecture/best-practices/api-design).</span></span>

## <a name="considerations-for-processing-requests"></a><span data-ttu-id="4f348-108">Considerações para processamento de solicitações</span><span class="sxs-lookup"><span data-stu-id="4f348-108">Considerations for processing requests</span></span>

<span data-ttu-id="4f348-109">Considere os pontos a seguir ao implementar o código para processar solicitações.</span><span class="sxs-lookup"><span data-stu-id="4f348-109">Consider the following points when you implement the code to handle requests.</span></span>

### <a name="get-put-delete-head-and-patch-actions-should-be-idempotent"></a><span data-ttu-id="4f348-110">As ações GET, PUT, DELETE, HEAD e PATCH devem ser idempotentes</span><span class="sxs-lookup"><span data-stu-id="4f348-110">GET, PUT, DELETE, HEAD, and PATCH actions should be idempotent</span></span>

<span data-ttu-id="4f348-111">O código que implementa essas solicitações não deve impor nenhum efeito colateral.</span><span class="sxs-lookup"><span data-stu-id="4f348-111">The code that implements these requests should not impose any side-effects.</span></span> <span data-ttu-id="4f348-112">A mesma solicitação repetida sobre o mesmo recurso deve resultar no mesmo estado.</span><span class="sxs-lookup"><span data-stu-id="4f348-112">The same request repeated over the same resource should result in the same state.</span></span> <span data-ttu-id="4f348-113">Por exemplo, enviar várias solicitações DELETE para o mesmo URI deve ter o mesmo efeito, embora o código de status de HTTP nas mensagens de resposta possa ser diferente.</span><span class="sxs-lookup"><span data-stu-id="4f348-113">For example, sending multiple DELETE requests to the same URI should have the same effect, although the HTTP status code in the response messages may be different.</span></span> <span data-ttu-id="4f348-114">A primeira solicitação DELETE pode retornar o código de status 204 (Sem conteúdo), enquanto uma solicitação DELETE subsequente pode retornar um código de status 404 (Não encontrado).</span><span class="sxs-lookup"><span data-stu-id="4f348-114">The first DELETE request might return status code 204 (No Content), while a subsequent DELETE request might return status code 404 (Not Found).</span></span>

> [!NOTE]
> <span data-ttu-id="4f348-115">O artigo [Padrões de Idempotência](http://blog.jonathanoliver.com/idempotency-patterns/) , no blog de Jonathan Oliver, fornece uma visão geral de idempotência e de como ela se relaciona às operações de gerenciamento de dados.</span><span class="sxs-lookup"><span data-stu-id="4f348-115">The article [Idempotency Patterns](http://blog.jonathanoliver.com/idempotency-patterns/) on Jonathan Oliver’s blog provides an overview of idempotency and how it relates to data management operations.</span></span>
>

### <a name="post-actions-that-create-new-resources-should-not-have-unrelated-side-effects"></a><span data-ttu-id="4f348-116">Ações POST que criam novos recursos não devem ter efeitos colaterais não relacionados</span><span class="sxs-lookup"><span data-stu-id="4f348-116">POST actions that create new resources should not have unrelated side-effects</span></span>

<span data-ttu-id="4f348-117">Se uma solicitação POST destina-se a criar um novo recurso, os efeitos da solicitação devem ser limitados a esse novo recurso (e possivelmente quaisquer recursos diretamente relacionados, se houver algum tipo de vinculação envolvida). Por exemplo, em um sistema de comércio eletrônico, uma solicitação POST que cria um novo pedido para um cliente pode também corrigir os níveis de estoque e gerar informações de cobrança , mas não deve modificar informações que não estejam diretamente relacionadas ao pedido nem ter nenhum outro efeito colateral sobre o estado geral do sistema.</span><span class="sxs-lookup"><span data-stu-id="4f348-117">If a POST request is intended to create a new resource, the effects of the request should be limited to the new resource (and possibly any directly related resources if there is some sort of linkage involved) For example, in an ecommerce system, a POST request that creates a new order for a customer might also amend inventory levels and generate billing information, but it should not modify information not directly related to the order or have any other side-effects on the overall state of the system.</span></span>

### <a name="avoid-implementing-chatty-post-put-and-delete-operations"></a><span data-ttu-id="4f348-118">Evite implementar operações POST, PUT e DELETE verborrágicas</span><span class="sxs-lookup"><span data-stu-id="4f348-118">Avoid implementing chatty POST, PUT, and DELETE operations</span></span>

<span data-ttu-id="4f348-119">Ofereça suporte a solicitações POST, PUT e DELETE por coleções de recursos.</span><span class="sxs-lookup"><span data-stu-id="4f348-119">Support POST, PUT and DELETE requests over resource collections.</span></span> <span data-ttu-id="4f348-120">Uma solicitação POST pode conter os detalhes para vários recursos novos e adicioná-los todos à mesma coleção, enquanto uma solicitação PUT pode substituir todo o conjunto de recursos de uma coleção e uma solicitação DELETE pode remover uma coleção inteira.</span><span class="sxs-lookup"><span data-stu-id="4f348-120">A POST request can contain the details for multiple new resources and add them all to the same collection, a PUT request can replace the entire set of resources in a collection, and a DELETE request can remove an entire collection.</span></span>

<span data-ttu-id="4f348-121">O suporte a OData incluído na API Web ASP.NET 2 oferece a capacidade de realizar solicitações em lote.</span><span class="sxs-lookup"><span data-stu-id="4f348-121">The OData support included in ASP.NET Web API 2 provides the ability to batch requests.</span></span> <span data-ttu-id="4f348-122">Um aplicativo cliente pode empacotar várias solicitações de API da Web e enviá-las para o servidor em uma única solicitação HTTP, para em seguida receber uma única resposta HTTP contendo as respostas para cada solicitação.</span><span class="sxs-lookup"><span data-stu-id="4f348-122">A client application can package up several web API requests and send them to the server in a single HTTP request, and receive a single HTTP response that contains the replies to each request.</span></span> <span data-ttu-id="4f348-123">Para obter mais informações, confira [Apresentando o suporte a lotes em API da Web e OData de API da Web](http://blogs.msdn.com/b/webdev/archive/2013/11/01/introducing-batch-support-in-web-api-and-web-api-odata.aspx).</span><span class="sxs-lookup"><span data-stu-id="4f348-123">For more information, [Introducing Batch Support in Web API and Web API OData](http://blogs.msdn.com/b/webdev/archive/2013/11/01/introducing-batch-support-in-web-api-and-web-api-odata.aspx).</span></span>

### <a name="follow-the-http-specification-when-sending-a-response"></a><span data-ttu-id="4f348-124">Siga a especificação de HTTP ao enviar uma resposta</span><span class="sxs-lookup"><span data-stu-id="4f348-124">Follow the HTTP specification when sending a response</span></span> 

<span data-ttu-id="4f348-125">Uma API da Web deve retornar mensagens contendo o código de status HTTP correto (para permitir que o cliente determine como tratar o resultado), os cabeçalhos HTTP apropriados (para que o cliente entenda a natureza do resultado) e um corpo formatado adequadamente (para permitir que o cliente analise o resultado).</span><span class="sxs-lookup"><span data-stu-id="4f348-125">A web API must return messages that contain the correct HTTP status code to enable the client to determine how to handle the result, the appropriate HTTP headers so that the client understands the nature of the result, and a suitably formatted body to enable the client to parse the result.</span></span> 

<span data-ttu-id="4f348-126">Por exemplo, uma operação POST deve retornar o código de status 201 (Criado), e a mensagem de resposta deve incluir o URI do recurso recém-criado no cabeçalho Location da mensagem de resposta.</span><span class="sxs-lookup"><span data-stu-id="4f348-126">For example, a POST operation should return status code 201 (Created) and the response message should include the URI of the newly created resource in the Location header of the response message.</span></span>

### <a name="support-content-negotiation"></a><span data-ttu-id="4f348-127">Ofereça suporte à negociação de conteúdo</span><span class="sxs-lookup"><span data-stu-id="4f348-127">Support content negotiation</span></span>

<span data-ttu-id="4f348-128">O corpo de uma mensagem de resposta pode conter dados em uma variedade de formatos.</span><span class="sxs-lookup"><span data-stu-id="4f348-128">The body of a response message may contain data in a variety of formats.</span></span> <span data-ttu-id="4f348-129">Por exemplo, uma solicitação HTTP GET poderia retornar dados em formato JSON ou XML.</span><span class="sxs-lookup"><span data-stu-id="4f348-129">For example, an HTTP GET request could return data in JSON, or XML format.</span></span> <span data-ttu-id="4f348-130">Quando o cliente envia uma solicitação, ele pode incluir um cabeçalho Accept que especifica os formatos de dados que pode processar.</span><span class="sxs-lookup"><span data-stu-id="4f348-130">When the client submits a request, it can include an Accept header that specifies the data formats that it can handle.</span></span> <span data-ttu-id="4f348-131">Esses formatos são especificados como tipos de mídia.</span><span class="sxs-lookup"><span data-stu-id="4f348-131">These formats are specified as media types.</span></span> <span data-ttu-id="4f348-132">Por exemplo, um cliente que emite uma solicitação GET que recupera uma imagem pode especificar um cabeçalho Accept listando os tipos de mídia que o cliente pode processar, como "image/jpeg, image/gif, image/png".</span><span class="sxs-lookup"><span data-stu-id="4f348-132">For example, a client that issues a GET request that retrieves an image can specify an Accept header that lists the media types that the client can handle, such as "image/jpeg, image/gif, image/png".</span></span>  <span data-ttu-id="4f348-133">Quando a API da Web retorna o resultado, ela deve formatar os dados usando um destes tipos de mídia e especificar o formato no cabeçalho Content-Type da resposta.</span><span class="sxs-lookup"><span data-stu-id="4f348-133">When the web API returns the result, it should format the data by using one of these media types and specify the format in the Content-Type header of the response.</span></span>

<span data-ttu-id="4f348-134">Se o cliente não especificar um cabeçalho Accept, use um formato padrão adequado para o corpo da resposta.</span><span class="sxs-lookup"><span data-stu-id="4f348-134">If the client does not specify an Accept header, then use a sensible default format for the response body.</span></span> <span data-ttu-id="4f348-135">Por exemplo, a estrutura da API Web ASP.NET utiliza JSON como formato padrão para dados baseados em texto.</span><span class="sxs-lookup"><span data-stu-id="4f348-135">As an example, the ASP.NET Web API framework defaults to JSON for text-based data.</span></span>

### <a name="provide-links-to-support-hateoas-style-navigation-and-discovery-of-resources"></a><span data-ttu-id="4f348-136">Forneça links para dar suporte à descoberta de recursos e navegação estilo HATEOAS</span><span class="sxs-lookup"><span data-stu-id="4f348-136">Provide links to support HATEOAS-style navigation and discovery of resources</span></span>

<span data-ttu-id="4f348-137">A abordagem HATEOAS permite que um cliente navegue e descubra recursos por meio de um ponto de partida inicial.</span><span class="sxs-lookup"><span data-stu-id="4f348-137">The HATEOAS approach enables a client to navigate and discover resources from an initial starting point.</span></span> <span data-ttu-id="4f348-138">Isso é realizado por meio de links contendo URIs; quando um cliente emite uma solicitação HTTP GET para obter um recurso, a resposta deve conter URIs que permitam que um aplicativo cliente localize rapidamente quaisquer recursos diretamente relacionados.</span><span class="sxs-lookup"><span data-stu-id="4f348-138">This is achieved by using links containing URIs; when a client issues an HTTP GET request to obtain a resource, the response should contain URIs that enable a client application to quickly locate any directly related resources.</span></span> <span data-ttu-id="4f348-139">Por exemplo, em uma API da Web que oferece suporte a uma solução de comércio eletrônico, um cliente pode ter realizado muitos pedidos.</span><span class="sxs-lookup"><span data-stu-id="4f348-139">For example, in a web API that supports an e-commerce solution, a customer may have placed many orders.</span></span> <span data-ttu-id="4f348-140">Quando um aplicativo cliente recupera os detalhes de um cliente, a resposta deve incluir links que permitam que o aplicativo cliente envie solicitações HTTP GET capazes de recuperar esses pedidos.</span><span class="sxs-lookup"><span data-stu-id="4f348-140">When a client application retrieves the details for a customer, the response should include links that enable the client application to send HTTP GET requests that can retrieve these orders.</span></span> <span data-ttu-id="4f348-141">Além disso, links estilo HATEOAS devem, para executar cada solicitação, descrever as outras operações (POST, PUT, DELETE e assim por diante) para as quais há suporte em cada recurso vinculado, junto com o URI correspondente.</span><span class="sxs-lookup"><span data-stu-id="4f348-141">Additionally, HATEOAS-style links should describe the other operations (POST, PUT, DELETE, and so on) that each linked resource supports together with the corresponding URI to perform each request.</span></span> <span data-ttu-id="4f348-142">Essa abordagem é descrita mais detalhadamente em [Design de API][api-design].</span><span class="sxs-lookup"><span data-stu-id="4f348-142">This approach is described in more detail in [API Design][api-design].</span></span>

<span data-ttu-id="4f348-143">Atualmente não há nenhum padrão que rege a implementação de HATEOAS, mas o exemplo a seguir ilustra uma abordagem possível.</span><span class="sxs-lookup"><span data-stu-id="4f348-143">Currently there are no standards that govern the implementation of HATEOAS, but the following example illustrates one possible approach.</span></span> <span data-ttu-id="4f348-144">Neste exemplo, uma solicitação HTTP GET que localiza os detalhes de um cliente retorna uma resposta que inclui links HATEOAS, que por sua vez fazem referência aos pedidos desse cliente:</span><span class="sxs-lookup"><span data-stu-id="4f348-144">In this example, an HTTP GET request that finds the details for a customer returns a response that include HATEOAS links that reference the orders for that customer:</span></span>

```HTTP
GET http://adventure-works.com/customers/2 HTTP/1.1
Accept: text/json
...
```

```HTTP
HTTP/1.1 200 OK
...
Content-Type: application/json; charset=utf-8
...
Content-Length: ...
{"CustomerID":2,"CustomerName":"Bert","Links":[
    {"rel":"self",
    "href":"http://adventure-works.com/customers/2",
    "action":"GET",
    "types":["text/xml","application/json"]},
    {"rel":"self",
    "href":"http://adventure-works.com/customers/2",
    "action":"PUT",
    "types":["application/x-www-form-urlencoded"]},
    {"rel":"self",
    "href":"http://adventure-works.com/customers/2",
    "action":"DELETE",
    "types":[]},
    {"rel":"orders",
    "href":"http://adventure-works.com/customers/2/orders",
    "action":"GET",
    "types":["text/xml","application/json"]},
    {"rel":"orders",
    "href":"http://adventure-works.com/customers/2/orders",
    "action":"POST",
    "types":["application/x-www-form-urlencoded"]}
]}
```

<span data-ttu-id="4f348-145">Neste exemplo, os dados do cliente são representados pela classe `Customer` mostrada no trecho de código a seguir.</span><span class="sxs-lookup"><span data-stu-id="4f348-145">In this example, the customer data is represented by the `Customer` class shown in the following code snippet.</span></span> <span data-ttu-id="4f348-146">Os links HATEOAS são mantidos na propriedade de coleção `Links` :</span><span class="sxs-lookup"><span data-stu-id="4f348-146">The HATEOAS links are held in the `Links` collection property:</span></span>

```csharp
public class Customer
{
    public int CustomerID { get; set; }
    public string CustomerName { get; set; }
    public List<Link> Links { get; set; }
    ...
}

public class Link
{
    public string Rel { get; set; }
    public string Href { get; set; }
    public string Action { get; set; }
    public string [] Types { get; set; }
}
```

<span data-ttu-id="4f348-147">A operação HTTP GET recupera os dados do cliente por meio do armazenamento, constrói um objeto `Customer` e, em seguida, preenche a coleção `Links`.</span><span class="sxs-lookup"><span data-stu-id="4f348-147">The HTTP GET operation retrieves the customer data from storage and constructs a `Customer` object, and then populates the `Links` collection.</span></span> <span data-ttu-id="4f348-148">O resultado é formatado como uma mensagem de resposta JSON.</span><span class="sxs-lookup"><span data-stu-id="4f348-148">The result is formatted as a JSON response message.</span></span> <span data-ttu-id="4f348-149">Cada link inclui os seguintes campos:</span><span class="sxs-lookup"><span data-stu-id="4f348-149">Each link comprises the following fields:</span></span>

* <span data-ttu-id="4f348-150">A relação entre o objeto que está sendo retornado e o objeto descrito pelo link.</span><span class="sxs-lookup"><span data-stu-id="4f348-150">The relationship between the object being returned and the object described by the link.</span></span> <span data-ttu-id="4f348-151">Nesse caso, "self" indica que o link é uma referência para o objeto em si (semelhante a um ponteiro `this` em muitas linguagens orientadas a objeto), enquanto "orders" é o nome de uma coleção que contém as informações de pedido relacionadas.</span><span class="sxs-lookup"><span data-stu-id="4f348-151">In this case "self" indicates that the link is a reference back to the object itself (similar to a `this` pointer in many object-oriented languages), and "orders" is the name of a collection containing the related order information.</span></span>
* <span data-ttu-id="4f348-152">O hiperlink (`Href`) para o objeto sendo descrito pelo link na forma de um URI.</span><span class="sxs-lookup"><span data-stu-id="4f348-152">The hyperlink (`Href`) for the object being described by the link in the form of a URI.</span></span>
* <span data-ttu-id="4f348-153">O tipo de solicitação HTTP (`Action`) que pode ser enviada para esse URI.</span><span class="sxs-lookup"><span data-stu-id="4f348-153">The type of HTTP request (`Action`) that can be sent to this URI.</span></span>
* <span data-ttu-id="4f348-154">O formato de quaisquer dados (`Types`) que devam ser fornecidos na solicitação HTTP ou que possam ser retornados na resposta, dependendo do tipo da solicitação.</span><span class="sxs-lookup"><span data-stu-id="4f348-154">The format of any data (`Types`) that should be provided in the HTTP request or that can be returned in the response, depending on the type of the request.</span></span>

<span data-ttu-id="4f348-155">Os links HATEOAS mostrados no exemplo de resposta HTTP indicam que um aplicativo cliente pode executar as seguintes operações:</span><span class="sxs-lookup"><span data-stu-id="4f348-155">The HATEOAS links shown in the example HTTP response indicate that a client application can perform the following operations:</span></span>

* <span data-ttu-id="4f348-156">Uma solicitação HTTP GET para o URI `http://adventure-works.com/customers/2` para coletar os detalhes do cliente (novamente).</span><span class="sxs-lookup"><span data-stu-id="4f348-156">An HTTP GET request to the URI `http://adventure-works.com/customers/2` to fetch the details of the customer (again).</span></span> <span data-ttu-id="4f348-157">Os dados podem ser retornados como XML ou JSON.</span><span class="sxs-lookup"><span data-stu-id="4f348-157">The data can be returned as XML or JSON.</span></span>
* <span data-ttu-id="4f348-158">Uma solicitação HTTP PUT para o URI `http://adventure-works.com/customers/2` para modificar os detalhes do cliente.</span><span class="sxs-lookup"><span data-stu-id="4f348-158">An HTTP PUT request to the URI `http://adventure-works.com/customers/2` to modify the details of the customer.</span></span> <span data-ttu-id="4f348-159">Os novos dados devem ser fornecidos na mensagem de solicitação no formato x-www-form-urlencoded.</span><span class="sxs-lookup"><span data-stu-id="4f348-159">The new data must be provided in the request message in x-www-form-urlencoded format.</span></span>
* <span data-ttu-id="4f348-160">Uma solicitação HTTP DELETE para o URI `http://adventure-works.com/customers/2` para excluir o cliente.</span><span class="sxs-lookup"><span data-stu-id="4f348-160">An HTTP DELETE request to the URI `http://adventure-works.com/customers/2` to delete the customer.</span></span> <span data-ttu-id="4f348-161">A solicitação não espera nenhuma informação adicional nem dados de retorno no corpo da mensagem de resposta.</span><span class="sxs-lookup"><span data-stu-id="4f348-161">The request does not expect any additional information or return data in the response message body.</span></span>
* <span data-ttu-id="4f348-162">Uma solicitação HTTP GET para o URI `http://adventure-works.com/customers/2/orders` para localizar todos os pedidos do cliente.</span><span class="sxs-lookup"><span data-stu-id="4f348-162">An HTTP GET request to the URI `http://adventure-works.com/customers/2/orders` to find all the orders for the customer.</span></span> <span data-ttu-id="4f348-163">Os dados podem ser retornados como XML ou JSON.</span><span class="sxs-lookup"><span data-stu-id="4f348-163">The data can be returned as XML or JSON.</span></span>
* <span data-ttu-id="4f348-164">Uma solicitação HTTP PUT para o URI `http://adventure-works.com/customers/2/orders` para criar um novo pedido desse cliente.</span><span class="sxs-lookup"><span data-stu-id="4f348-164">An HTTP PUT request to the URI `http://adventure-works.com/customers/2/orders` to create a new order for this customer.</span></span> <span data-ttu-id="4f348-165">Os dados devem ser fornecidos na mensagem de solicitação no formato x-www-form-urlencoded.</span><span class="sxs-lookup"><span data-stu-id="4f348-165">The data must be provided in the request message in x-www-form-urlencoded format.</span></span>

## <a name="considerations-for-handling-exceptions"></a><span data-ttu-id="4f348-166">Considerações para tratar de exceções</span><span class="sxs-lookup"><span data-stu-id="4f348-166">Considerations for handling exceptions</span></span>

<span data-ttu-id="4f348-167">Leve em consideração os pontos a seguir se uma operação lançar uma exceção não capturada.</span><span class="sxs-lookup"><span data-stu-id="4f348-167">Consider the following points if an operation throws an uncaught exception.</span></span>

### <a name="capture-exceptions-and-return-a-meaningful-response-to-clients"></a><span data-ttu-id="4f348-168">Capture exceções e retorne uma resposta significativa para os clientes</span><span class="sxs-lookup"><span data-stu-id="4f348-168">Capture exceptions and return a meaningful response to clients</span></span>

<span data-ttu-id="4f348-169">O código que implementa uma operação HTTP deve oferecer tratamento abrangente de exceções, em vez de permitir que exceções não percebidas se propaguem para a estrutura.</span><span class="sxs-lookup"><span data-stu-id="4f348-169">The code that implements an HTTP operation should provide comprehensive exception handling rather than letting uncaught exceptions propagate to the framework.</span></span> <span data-ttu-id="4f348-170">Se uma exceção torna impossível concluir a operação com êxito, a exceção pode ser passada de volta na mensagem de resposta, mas ela deve incluir uma descrição significativa do erro que causou a exceção.</span><span class="sxs-lookup"><span data-stu-id="4f348-170">If an exception makes it impossible to complete the operation successfully, the exception can be passed back in the response message, but it should include a meaningful description of the error that caused the exception.</span></span> <span data-ttu-id="4f348-171">A exceção também deve incluir o código de status HTTP adequado em vez de simplesmente retornar o código de status 500 para todas as situações.</span><span class="sxs-lookup"><span data-stu-id="4f348-171">The exception should also include the appropriate HTTP status code rather than simply returning status code 500 for every situation.</span></span> <span data-ttu-id="4f348-172">Por exemplo, se uma solicitação de usuário faz com que uma atualização de banco de dados que viola uma restrição (por exemplo, a tentativa de excluir um cliente que tenha pedidos pendentes), você deve retornar o código de status 409 (Conflito) e um corpo de mensagem que indique o motivo para o conflito.</span><span class="sxs-lookup"><span data-stu-id="4f348-172">For example, if a user request causes a database update that violates a constraint (such as attempting to delete a customer that has outstanding orders), you should return status code 409 (Conflict) and a message body indicating the reason for the conflict.</span></span> <span data-ttu-id="4f348-173">Se outra condição torna a solicitação inexequível, você pode retornar o código de status 400 (Solicitação Incorreta).</span><span class="sxs-lookup"><span data-stu-id="4f348-173">If some other condition renders the request unachievable, you can return status code 400 (Bad Request).</span></span> <span data-ttu-id="4f348-174">Você encontrará uma lista completa dos códigos de status HTTP na página [Definições de Código de Status](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html) , no site do W3C.</span><span class="sxs-lookup"><span data-stu-id="4f348-174">You can find a full list of HTTP status codes on the [Status Code Definitions](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html) page on the W3C website.</span></span>

<span data-ttu-id="4f348-175">O exemplo de código intercepta diferentes condições e retorna uma resposta apropriada.</span><span class="sxs-lookup"><span data-stu-id="4f348-175">The code example traps different conditions and returns an appropriate response.</span></span>

```csharp
[HttpDelete]
[Route("customers/{id:int}")]
public IHttpActionResult DeleteCustomer(int id)
{
    try
    {
        // Find the customer to be deleted in the repository
        var customerToDelete = repository.GetCustomer(id);

        // If there is no such customer, return an error response
        // with status code 404 (Not Found)
        if (customerToDelete == null)
        {
                return NotFound();
        }

        // Remove the customer from the repository
        // The DeleteCustomer method returns true if the customer
        // was successfully deleted
        if (repository.DeleteCustomer(id))
        {
            // Return a response message with status code 204 (No Content)
            // To indicate that the operation was successful
            return StatusCode(HttpStatusCode.NoContent);
        }
        else
        {
            // Otherwise return a 400 (Bad Request) error response
            return BadRequest(Strings.CustomerNotDeleted);
        }
    }
    catch
    {
        // If an uncaught exception occurs, return an error response
        // with status code 500 (Internal Server Error)
        return InternalServerError();
    }
}
```

> [!TIP]
> <span data-ttu-id="4f348-176">Não inclua informações que podem ser úteis para um invasor tentando invadir sua API.</span><span class="sxs-lookup"><span data-stu-id="4f348-176">Do not include information that could be useful to an attacker attempting to penetrate your API.</span></span>
  
<span data-ttu-id="4f348-177">Muitos servidores Web interceptam as condições de erro antes que elas atinjam a API da Web.</span><span class="sxs-lookup"><span data-stu-id="4f348-177">Many web servers trap error conditions themselves before they reach the web API.</span></span> <span data-ttu-id="4f348-178">Por exemplo, se você configura a autenticação para um site da Web e o usuário não fornece as informações de autenticação corretas, o servidor Web deve responder com o código de status 401 (Não Autorizado).</span><span class="sxs-lookup"><span data-stu-id="4f348-178">For example, if you configure authentication for a web site and the user fails to provide the correct authentication information, the web server should respond with status code 401 (Unauthorized).</span></span> <span data-ttu-id="4f348-179">Depois de um cliente ter sido autenticado, seu código poderá executar suas próprias verificações para conferir se o cliente é capaz de acessar o recurso solicitado.</span><span class="sxs-lookup"><span data-stu-id="4f348-179">Once a client has been authenticated, your code can perform its own checks to verify that the client should be able access the requested resource.</span></span> <span data-ttu-id="4f348-180">Se essa autorização falhar, você deve retornar o código de status 403 (Proibido).</span><span class="sxs-lookup"><span data-stu-id="4f348-180">If this authorization fails, you should return status code 403 (Forbidden).</span></span>
 
### <a name="handle-exceptions-consistently-and-log-information-about-errors"></a><span data-ttu-id="4f348-181">Trate exceções de modo consistente e registre em log as informações referentes a erros</span><span class="sxs-lookup"><span data-stu-id="4f348-181">Handle exceptions consistently and log information about errors</span></span>

<span data-ttu-id="4f348-182">Para tratar exceções de maneira consistente, considere a implementação de uma estratégia global para tratamento de erro, em toda a API da Web.</span><span class="sxs-lookup"><span data-stu-id="4f348-182">To handle exceptions in a consistent manner, consider implementing a global error handling strategy across the entire web API.</span></span> <span data-ttu-id="4f348-183">Você também deve incorporar o log de erros, que captura os detalhes completos de cada exceção; esse log pode conter informações detalhadas, desde que elas não estejam acessíveis aos clientes pela Web.</span><span class="sxs-lookup"><span data-stu-id="4f348-183">You should also incorporate error logging which captures the full details of each exception; this error log can contain detailed information as long as it is not made accessible over the web to clients.</span></span> 

### <a name="distinguish-between-client-side-errors-and-server-side-errors"></a><span data-ttu-id="4f348-184">Diferencie erros no lado do cliente de erros no lado do servidor</span><span class="sxs-lookup"><span data-stu-id="4f348-184">Distinguish between client-side errors and server-side errors</span></span>

<span data-ttu-id="4f348-185">O protocolo HTTP faz distinção entre os erros que ocorrem devido ao aplicativo cliente (os códigos de status HTTP 4xx) e erros que são causados por um problema no servidor (os códigos de status HTTP 5xx).</span><span class="sxs-lookup"><span data-stu-id="4f348-185">The HTTP protocol distinguishes between errors that occur due to the client application (the HTTP 4xx status codes), and errors that are caused by a mishap on the server (the HTTP 5xx status codes).</span></span> <span data-ttu-id="4f348-186">Certifique-se de respeitar essa convenção em todas as mensagens de resposta de erro.</span><span class="sxs-lookup"><span data-stu-id="4f348-186">Make sure that you respect this convention in any error response messages.</span></span>

## <a name="considerations-for-optimizing-client-side-data-access"></a><span data-ttu-id="4f348-187">Considerações para otimizar o acesso a dados do lado do cliente</span><span class="sxs-lookup"><span data-stu-id="4f348-187">Considerations for optimizing client-side data access</span></span>
<span data-ttu-id="4f348-188">Em um ambiente distribuído, como aquele envolvendo um servidor Web e aplicativos cliente, um dos principais motivos de preocupação é a rede.</span><span class="sxs-lookup"><span data-stu-id="4f348-188">In a distributed environment such as that involving a web server and client applications, one of the primary sources of concern is the network.</span></span> <span data-ttu-id="4f348-189">Ela pode atuar como um gargalo considerável, especialmente se um aplicativo cliente enviar solicitações ou receber dados com frequência.</span><span class="sxs-lookup"><span data-stu-id="4f348-189">This can act as a considerable bottleneck, especially if a client application is frequently sending requests or receiving data.</span></span> <span data-ttu-id="4f348-190">Portanto, você deve ter como objetivo minimizar a quantidade de tráfego que flui pela rede.</span><span class="sxs-lookup"><span data-stu-id="4f348-190">Therefore you should aim to minimize the amount of traffic that flows across the network.</span></span> <span data-ttu-id="4f348-191">Considere os pontos a seguir ao implementar o código para recuperar e manter dados:</span><span class="sxs-lookup"><span data-stu-id="4f348-191">Consider the following points when you implement the code to retrieve and maintain data:</span></span>

### <a name="support-client-side-caching"></a><span data-ttu-id="4f348-192">Ofereça suporte a cache no lado do cliente</span><span class="sxs-lookup"><span data-stu-id="4f348-192">Support client-side caching</span></span>

<span data-ttu-id="4f348-193">O protocolo HTTP 1.1 oferece suporte a caching em clientes e servidores intermediários por meio dos quais uma solicitação é roteada pelo uso do cabeçalho Cache-Control.</span><span class="sxs-lookup"><span data-stu-id="4f348-193">The HTTP 1.1 protocol supports caching in clients and intermediate servers through which a request is routed by the use of the Cache-Control header.</span></span> <span data-ttu-id="4f348-194">Quando um aplicativo cliente envia uma solicitação HTTP GET para a API da Web, a resposta pode incluir um cabeçalho Cache-Control que indica se os dados no corpo da resposta podem ou não ser armazenados com segurança pelo cliente ou um servidor intermediário por meio do qual a solicitação foi encaminhada, além de indicar quanto tempo resta até que esses dados expirem e sejam considerados desatualizados.</span><span class="sxs-lookup"><span data-stu-id="4f348-194">When a client application sends an HTTP GET request to the web API, the response can include a Cache-Control header that indicates whether the data in the body of the response can be safely cached by the client or an intermediate server through which the request has been routed, and for how long before it should expire and be considered out-of-date.</span></span> <span data-ttu-id="4f348-195">O exemplo a seguir mostra uma solicitação HTTP GET e a resposta correspondente, que inclui um cabeçalho Cache-Control:</span><span class="sxs-lookup"><span data-stu-id="4f348-195">The following example shows an HTTP GET request and the corresponding response that includes a Cache-Control header:</span></span>

```HTTP
GET http://adventure-works.com/orders/2 HTTP/1.1
```

```HTTP
HTTP/1.1 200 OK
...
Cache-Control: max-age=600, private
Content-Type: text/json; charset=utf-8
Content-Length: ...
{"orderID":2,"productID":4,"quantity":2,"orderValue":10.00}
```

<span data-ttu-id="4f348-196">Neste exemplo, o cabeçalho Cache-Control especifica que os dados retornados devem expirar após 600 segundos e ser adequados para um único cliente; além disso, esses dados não devem ser armazenados em um cache compartilhado usado por outros clientes (eles são *particulares*).</span><span class="sxs-lookup"><span data-stu-id="4f348-196">In this example, the Cache-Control header specifies that the data returned should be expired after 600 seconds, and is only suitable for a single client and must not be stored in a shared cache used by other clients (it is *private*).</span></span> <span data-ttu-id="4f348-197">O cabeçalho Cache-Control pode especificar *public* em vez de *private* caso os dados possam ser armazenados em um cache compartilhado, ou então pode especificar *no-store* caso os dados **não** possam ser armazenados em cache pelo cliente.</span><span class="sxs-lookup"><span data-stu-id="4f348-197">The Cache-Control header could specify *public* rather than *private* in which case the data can be stored in a shared cache, or it could specify *no-store* in which case the data must **not** be cached by the client.</span></span> <span data-ttu-id="4f348-198">O exemplo de código a seguir mostra como construir um cabeçalho Cache-Control em uma mensagem de resposta:</span><span class="sxs-lookup"><span data-stu-id="4f348-198">The following code example shows how to construct a Cache-Control header in a response message:</span></span>

```csharp
public class OrdersController : ApiController
{
    ...
    [Route("api/orders/{id:int:min(0)}")]
    [HttpGet]
    public IHttpActionResult FindOrderByID(int id)
    {
        // Find the matching order
        Order order = ...;
        ...
        // Create a Cache-Control header for the response
        var cacheControlHeader = new CacheControlHeaderValue();
        cacheControlHeader.Private = true;
        cacheControlHeader.MaxAge = new TimeSpan(0, 10, 0);
        ...

        // Return a response message containing the order and the cache control header
        OkResultWithCaching<Order> response = new OkResultWithCaching<Order>(order, this)
        {
            CacheControlHeader = cacheControlHeader
        };
        return response;
    }
    ...
}
```

<span data-ttu-id="4f348-199">Esse código usa uma classe `IHttpActionResult` personalizada denominada `OkResultWithCaching`.</span><span class="sxs-lookup"><span data-stu-id="4f348-199">This code makes use of a custom `IHttpActionResult` class named `OkResultWithCaching`.</span></span> <span data-ttu-id="4f348-200">Essa classe habilita o controlador a definir o conteúdo do cabeçalho de cache:</span><span class="sxs-lookup"><span data-stu-id="4f348-200">This class enables the controller to set the cache header contents:</span></span>

```csharp
public class OkResultWithCaching<T> : OkNegotiatedContentResult<T>
{
    public OkResultWithCaching(T content, ApiController controller)
        : base(content, controller) { }

    public OkResultWithCaching(T content, IContentNegotiator contentNegotiator, HttpRequestMessage request, IEnumerable<MediaTypeFormatter> formatters)
        : base(content, contentNegotiator, request, formatters) { }

    public CacheControlHeaderValue CacheControlHeader { get; set; }
    public EntityTagHeaderValue ETag { get; set; }

    public override async Task<HttpResponseMessage> ExecuteAsync(CancellationToken cancellationToken)
    {
        HttpResponseMessage response;
        try
        {
            response = await base.ExecuteAsync(cancellationToken);
            response.Headers.CacheControl = this.CacheControlHeader;
            response.Headers.ETag = ETag;
        }
        catch (OperationCanceledException)
        {
            response = new HttpResponseMessage(HttpStatusCode.Conflict) {ReasonPhrase = "Operation was cancelled"};
        }
        return response;
    }
}
```

> [!NOTE]
> <span data-ttu-id="4f348-201">O protocolo HTTP também define a diretiva *no-cache* para o cabeçalho Cache-Control.</span><span class="sxs-lookup"><span data-stu-id="4f348-201">The HTTP protocol also defines the *no-cache* directive for the Cache-Control header.</span></span> <span data-ttu-id="4f348-202">Confusamente, essa diretiva não significa "não armazenar em cache", mas sim "revalidar as informações em cache com o servidor antes de retorná-las"; os dados ainda podem ser armazenados em cache, mas eles são verificados cada vez que são usados para assegurar que ainda estão atualizados.</span><span class="sxs-lookup"><span data-stu-id="4f348-202">Rather confusingly, this directive does not mean "do not cache" but rather "revalidate the cached information with the server before returning it"; the data can still be cached, but it is checked each time it is used to ensure that it is still current.</span></span>
>
>

<span data-ttu-id="4f348-203">O gerenciamento de cache é responsabilidade do aplicativo cliente ou do servidor intermediário, mas se corretamente implementado ele pode economizar largura de banda e melhorar o desempenho, eliminando a necessidade de buscar os dados que já foram recuperados recentemente.</span><span class="sxs-lookup"><span data-stu-id="4f348-203">Cache management is the responsibility of the client application or intermediate server, but if properly implemented it can save bandwidth and improve performance by removing the need to fetch data that has already been recently retrieved.</span></span>

<span data-ttu-id="4f348-204">O valor *max-age* no cabeçalho Cache-Control é apenas um guia, não uma garantia de que os dados correspondentes não serão alterados durante o período especificado.</span><span class="sxs-lookup"><span data-stu-id="4f348-204">The *max-age* value in the Cache-Control header is only a guide and not a guarantee that the corresponding data won't change during the specified time.</span></span> <span data-ttu-id="4f348-205">A API da Web deve definir o parâmetro max-age para um valor adequado, que depende da volatilidade esperada dos dados.</span><span class="sxs-lookup"><span data-stu-id="4f348-205">The web API should set the max-age to a suitable value depending on the expected volatility of the data.</span></span> <span data-ttu-id="4f348-206">Quando esse período expirar, o cliente deve descartar o objeto do cache.</span><span class="sxs-lookup"><span data-stu-id="4f348-206">When this period expires, the client should discard the object from the cache.</span></span>

> [!NOTE]
> <span data-ttu-id="4f348-207">Navegadores da Web mais modernos dão suporte a arquivos offline, adicionando os cabeçalhos cache-control apropriados a solicitações e examinando os cabeçalhos dos resultados, conforme descrito.</span><span class="sxs-lookup"><span data-stu-id="4f348-207">Most modern web browsers support client-side caching by adding the appropriate cache-control headers to requests and examining the headers of the results, as described.</span></span> <span data-ttu-id="4f348-208">No entanto, alguns navegadores mais antigos não armazenarão em cache os valores retornados de uma URL que inclua uma cadeia de consulta.</span><span class="sxs-lookup"><span data-stu-id="4f348-208">However, some older browsers will not cache the values returned from a URL that includes a query string.</span></span> <span data-ttu-id="4f348-209">Isso geralmente não é um problema para aplicativos cliente personalizados que implementam sua própria estratégia de gerenciamento de cache, baseada no protocolo discutido aqui.</span><span class="sxs-lookup"><span data-stu-id="4f348-209">This is not usually an issue for custom client applications which implement their own cache management strategy based on the protocol discussed here.</span></span>
>
> <span data-ttu-id="4f348-210">Alguns proxies mais antigos exibem o mesmo comportamento e podem não armazenar em cache solicitações baseadas em URLs com cadeias de consulta.</span><span class="sxs-lookup"><span data-stu-id="4f348-210">Some older proxies exhibit the same behavior and might not cache requests based on URLs with query strings.</span></span> <span data-ttu-id="4f348-211">Isso pode ser um problema para os aplicativos cliente personalizados que se conectam a um servidor Web por meio de um proxy desse tipo.</span><span class="sxs-lookup"><span data-stu-id="4f348-211">This could be an issue for custom client applications that connect to a web server through such a proxy.</span></span>
>

### <a name="provide-etags-to-optimize-query-processing"></a><span data-ttu-id="4f348-212">Forneça ETags para otimizar o processamento de consulta</span><span class="sxs-lookup"><span data-stu-id="4f348-212">Provide ETags to optimize query processing</span></span>

<span data-ttu-id="4f348-213">Quando um aplicativo cliente recupera um objeto, a mensagem de resposta também pode incluir uma *ETag* (Marca de Entidade).</span><span class="sxs-lookup"><span data-stu-id="4f348-213">When a client application retrieves an object, the response message can also include an *ETag* (Entity Tag).</span></span> <span data-ttu-id="4f348-214">Uma ETag é uma cadeia de caracteres opaca, que indica a versão de um recurso; cada vez que um recurso for alterado, a Etag também será modificada.</span><span class="sxs-lookup"><span data-stu-id="4f348-214">An ETag is an opaque string that indicates the version of a resource; each time a resource changes the Etag is also modified.</span></span> <span data-ttu-id="4f348-215">Essa ETag deve ser armazenada em cache pelo aplicativo cliente como parte dos dados.</span><span class="sxs-lookup"><span data-stu-id="4f348-215">This ETag should be cached as part of the data by the client application.</span></span> <span data-ttu-id="4f348-216">O exemplo de código a seguir mostra como adicionar uma ETag como parte da resposta a uma solicitação HTTP GET.</span><span class="sxs-lookup"><span data-stu-id="4f348-216">The following code example shows how to add an ETag as part of the response to an HTTP GET request.</span></span> <span data-ttu-id="4f348-217">Esse código usa o método `GetHashCode` de um objeto para gerar um valor numérico que identifica o objeto (você pode substituir esse método se necessário e gerar seu próprio hash usando um algoritmo, como MD5):</span><span class="sxs-lookup"><span data-stu-id="4f348-217">This code uses the `GetHashCode` method of an object to generate a numeric value that identifies the object (you can override this method if necessary and generate your own hash using an algorithm such as MD5) :</span></span>

```csharp
public class OrdersController : ApiController
{
    ...
    public IHttpActionResult FindOrderByID(int id)
    {
        // Find the matching order
        Order order = ...;
        ...

        var hashedOrder = order.GetHashCode();
        string hashedOrderEtag = $"\"{hashedOrder}\"";
        var eTag = new EntityTagHeaderValue(hashedOrderEtag);

        // Return a response message containing the order and the cache control header
        OkResultWithCaching<Order> response = new OkResultWithCaching<Order>(order, this)
        {
            ...,
            ETag = eTag
        };
        return response;
    }
    ...
}
```

<span data-ttu-id="4f348-218">A mensagem de resposta publicada pela API da Web tem essa aparência:</span><span class="sxs-lookup"><span data-stu-id="4f348-218">The response message posted by the web API looks like this:</span></span>

```HTTP
HTTP/1.1 200 OK
...
Cache-Control: max-age=600, private
Content-Type: text/json; charset=utf-8
ETag: "2147483648"
Content-Length: ...
{"orderID":2,"productID":4,"quantity":2,"orderValue":10.00}
```

> [!TIP]
> <span data-ttu-id="4f348-219">Por motivos de segurança, não permita que dados confidenciais ou dados retornados por uma conexão autenticada (HTTPS) sejam armazenados em cache.</span><span class="sxs-lookup"><span data-stu-id="4f348-219">For security reasons, do not allow sensitive data or data returned over an authenticated (HTTPS) connection to be cached.</span></span>
>
>

<span data-ttu-id="4f348-220">Um aplicativo cliente pode emitir uma solicitação GET subsequente para recuperar o mesmo recurso a qualquer momento e, se o recurso foi alterado (se ele tem uma ETag diferente), a versão armazenada em cache deve ser descartada e a nova versão deve ser adicionada ao cache.</span><span class="sxs-lookup"><span data-stu-id="4f348-220">A client application can issue a subsequent GET request to retrieve the same resource at any time, and if the resource has changed (it has a different ETag) the cached version should be discarded and the new version added to the cache.</span></span> <span data-ttu-id="4f348-221">Se um recurso é grande e exige uma quantidade significativa de largura de banda para ser transmitido de volta ao cliente, repetidas solicitações para buscar os mesmos dados podem tornar-se ineficientes.</span><span class="sxs-lookup"><span data-stu-id="4f348-221">If a resource is large and requires a significant amount of bandwidth to transmit back to the client, repeated requests to fetch the same data can become inefficient.</span></span> <span data-ttu-id="4f348-222">Para combater isso, o protocolo HTTP define o processo a seguir para otimizar as solicitações GET às quais você deve oferecer suporte em uma API da Web:</span><span class="sxs-lookup"><span data-stu-id="4f348-222">To combat this, the HTTP protocol defines the following process for optimizing GET requests that you should support in a web API:</span></span>

* <span data-ttu-id="4f348-223">O cliente cria uma solicitação GET contendo a ETag para a versão atualmente armazenada em cache do recurso referenciado em um cabeçalho HTTP If-None-Match:</span><span class="sxs-lookup"><span data-stu-id="4f348-223">The client constructs a GET request containing the ETag for the currently cached version of the resource referenced in an If-None-Match HTTP header:</span></span>

    ```HTTP
    GET http://adventure-works.com/orders/2 HTTP/1.1
    If-None-Match: "2147483648"
    ```
* <span data-ttu-id="4f348-224">A operação GET na API da Web obtém a ETag atual para os dados solicitados (pedido 2 no exemplo acima) e compara-a ao valor do cabeçalho If-None-Match.</span><span class="sxs-lookup"><span data-stu-id="4f348-224">The GET operation in the web API obtains the current ETag for the requested data (order 2 in the above example), and compares it to the value in the If-None-Match header.</span></span>
* <span data-ttu-id="4f348-225">Se a ETag atual para os dados solicitados corresponde à ETag fornecida pela solicitação, isso significa que o recurso não foi alterado e a API da Web deve retornar uma resposta HTTP com um corpo de mensagem vazio, além de um código de status 304 (Não Modificado).</span><span class="sxs-lookup"><span data-stu-id="4f348-225">If the current ETag for the requested data matches the ETag provided by the request, the resource has not changed and the web API should return an HTTP response with an empty message body and a status code of 304 (Not Modified).</span></span>
* <span data-ttu-id="4f348-226">Se a ETag atual para os dados solicitados não corresponde à ETag fornecida pela solicitação, isso significa que os dados mudaram e a API da Web deve retornar uma resposta HTTP com os novos dados no corpo da mensagem, além de um código de status 200 (OK).</span><span class="sxs-lookup"><span data-stu-id="4f348-226">If the current ETag for the requested data does not match the ETag provided by the request, then the data has changed and the web API should return an HTTP response with the new data in the message body and a status code of 200 (OK).</span></span>
* <span data-ttu-id="4f348-227">Se os dados solicitados não existem mais, a API da Web deve retornar uma resposta HTTP com o código de status 404 (Não Encontrado).</span><span class="sxs-lookup"><span data-stu-id="4f348-227">If the requested data no longer exists then the web API should return an HTTP response with the status code of 404 (Not Found).</span></span>
* <span data-ttu-id="4f348-228">O cliente usa o código de status para manter o cache.</span><span class="sxs-lookup"><span data-stu-id="4f348-228">The client uses the status code to maintain the cache.</span></span> <span data-ttu-id="4f348-229">Se os dados não mudaram (código de status 304), o objeto pode permanecer armazenado em cache e o aplicativo cliente deve continuar a usar essa versão do objeto.</span><span class="sxs-lookup"><span data-stu-id="4f348-229">If the data has not changed (status code 304) then the object can remain cached and the client application should continue to use this version of the object.</span></span> <span data-ttu-id="4f348-230">Se os dados mudaram (código de status 200), o objeto armazenado em cache deve ser descartado e o novo objeto deve ser inserido.</span><span class="sxs-lookup"><span data-stu-id="4f348-230">If the data has changed (status code 200) then the cached object should be discarded and the new one inserted.</span></span> <span data-ttu-id="4f348-231">Se os dados não estão mais disponíveis (código de status 404), o objeto deve ser removido do cache.</span><span class="sxs-lookup"><span data-stu-id="4f348-231">If the data is no longer available (status code 404) then the object should be removed from the cache.</span></span>

> [!NOTE]
> <span data-ttu-id="4f348-232">Se o cabeçalho de resposta contém o cabeçalho Cache-Control com valor no-store, o objeto deve ser sempre removido do cache, independentemente do código de status HTTP.</span><span class="sxs-lookup"><span data-stu-id="4f348-232">If the response header contains the Cache-Control header no-store then the object should always be removed from the cache regardless of the HTTP status code.</span></span>
>

<span data-ttu-id="4f348-233">O código a seguir mostra o método `FindOrderByID` estendido para oferecer suporte ao cabeçalho If-None-Match.</span><span class="sxs-lookup"><span data-stu-id="4f348-233">The code below shows the `FindOrderByID` method extended to support the If-None-Match header.</span></span> <span data-ttu-id="4f348-234">Observe que, se o cabeçalho If-None-Match for omitido, o pedido especificado sempre será recuperado:</span><span class="sxs-lookup"><span data-stu-id="4f348-234">Notice that if the If-None-Match header is omitted, the specified order is always retrieved:</span></span>

```csharp
public class OrdersController : ApiController
{
    [Route("api/orders/{id:int:min(0)}")]
    [HttpGet]
    public IHttpActionResult FindOrderByID(int id)
    {
        try
        {
            // Find the matching order
            Order order = ...;

            // If there is no such order then return NotFound
            if (order == null)
            {
                return NotFound();
            }

            // Generate the ETag for the order
            var hashedOrder = order.GetHashCode();
            string hashedOrderEtag = $"\"{hashedOrder}\"";

            // Create the Cache-Control and ETag headers for the response
            IHttpActionResult response;
            var cacheControlHeader = new CacheControlHeaderValue();
            cacheControlHeader.Public = true;
            cacheControlHeader.MaxAge = new TimeSpan(0, 10, 0);
            var eTag = new EntityTagHeaderValue(hashedOrderEtag);

            // Retrieve the If-None-Match header from the request (if it exists)
            var nonMatchEtags = Request.Headers.IfNoneMatch;

            // If there is an ETag in the If-None-Match header and
            // this ETag matches that of the order just retrieved,
            // then create a Not Modified response message
            if (nonMatchEtags.Count > 0 &&
                String.CompareOrdinal(nonMatchEtags.First().Tag, hashedOrderEtag) == 0)
            {
                response = new EmptyResultWithCaching()
                {
                    StatusCode = HttpStatusCode.NotModified,
                    CacheControlHeader = cacheControlHeader,
                    ETag = eTag
                };
            }
            // Otherwise create a response message that contains the order details
            else
            {
                response = new OkResultWithCaching<Order>(order, this)
                {
                    CacheControlHeader = cacheControlHeader,
                    ETag = eTag
                };
            }

            return response;
        }
        catch
        {
            return InternalServerError();
        }
    }
...
}
```

<span data-ttu-id="4f348-235">Este exemplo incorpora uma classe personalizada adicional `IHttpActionResult`, denominada `EmptyResultWithCaching`.</span><span class="sxs-lookup"><span data-stu-id="4f348-235">This example incorporates an additional custom `IHttpActionResult` class named `EmptyResultWithCaching`.</span></span> <span data-ttu-id="4f348-236">Essa classe age simplesmente como um wrapper em torno de um objeto `HttpResponseMessage` , que não contém um corpo de resposta:</span><span class="sxs-lookup"><span data-stu-id="4f348-236">This class simply acts as a wrapper around an `HttpResponseMessage` object that does not contain a response body:</span></span>

```csharp
public class EmptyResultWithCaching : IHttpActionResult
{
    public CacheControlHeaderValue CacheControlHeader { get; set; }
    public EntityTagHeaderValue ETag { get; set; }
    public HttpStatusCode StatusCode { get; set; }
    public Uri Location { get; set; }

    public async Task<HttpResponseMessage> ExecuteAsync(CancellationToken cancellationToken)
    {
        HttpResponseMessage response = new HttpResponseMessage(StatusCode);
        response.Headers.CacheControl = this.CacheControlHeader;
        response.Headers.ETag = this.ETag;
        response.Headers.Location = this.Location;
        return response;
    }
}
```

> [!TIP]
> <span data-ttu-id="4f348-237">Neste exemplo, a ETag para os dados é gerada pelo hash dos dados recuperados da fonte de dados subjacente.</span><span class="sxs-lookup"><span data-stu-id="4f348-237">In this example, the ETag for the data is generated by hashing the data retrieved from the underlying data source.</span></span> <span data-ttu-id="4f348-238">Se a ETag pode ser computada de algum outro modo, o processo pode ser otimizado ainda mais e os dados só precisarão ser coletados da fonte de dados se tiverem sofrido modificações.</span><span class="sxs-lookup"><span data-stu-id="4f348-238">If the ETag can be computed in some other way, then the process can be optimized further and the data only needs to be fetched from the data source if it has changed.</span></span>  <span data-ttu-id="4f348-239">Essa abordagem é especialmente útil se os dados forem grandes ou se acessar a fonte de dados puder resultar em latência significativa (por exemplo, se a fonte de dados for um banco de dados remoto).</span><span class="sxs-lookup"><span data-stu-id="4f348-239">This approach is especially useful if the data is large or accessing the data source can result in significant latency (for example, if the data source is a remote database).</span></span>
>

### <a name="use-etags-to-support-optimistic-concurrency"></a><span data-ttu-id="4f348-240">Use ETags para oferecer suporte à simultaneidade otimista</span><span class="sxs-lookup"><span data-stu-id="4f348-240">Use ETags to Support Optimistic Concurrency</span></span>

<span data-ttu-id="4f348-241">Para habilitar atualizações nos dados armazenados em cache anteriormente, o protocolo HTTP oferece suporte a uma estratégia de simultaneidade otimista.</span><span class="sxs-lookup"><span data-stu-id="4f348-241">To enable updates over previously cached data, the HTTP protocol supports an optimistic concurrency strategy.</span></span> <span data-ttu-id="4f348-242">Se, após coletar um recurso e armazená-lo em cache, o aplicativo cliente subsequentemente envia uma solicitação PUT ou DELETE para alterar ou remover o recurso, essa solicitação deve incluir o cabeçalho If-Match, que faz referência à ETag.</span><span class="sxs-lookup"><span data-stu-id="4f348-242">If, after fetching and caching a resource, the client application subsequently sends a PUT or DELETE request to change or remove the resource, it should include in If-Match header that references the ETag.</span></span> <span data-ttu-id="4f348-243">A API da Web pode usar essas informações para determinar se o recurso já foi alterado por outro usuário desde que foi recuperado e enviar uma resposta apropriada para o aplicativo cliente, conforme demonstrado a seguir:</span><span class="sxs-lookup"><span data-stu-id="4f348-243">The web API can then use this information to determine whether the resource has already been changed by another user since it was retrieved and send an appropriate response back to the client application as follows:</span></span>

* <span data-ttu-id="4f348-244">O cliente cria uma solicitação PUT contendo os novos detalhes para o recurso e a ETag para a versão atualmente armazenada em cache do recurso referenciado em um cabeçalho HTTP If-Match.</span><span class="sxs-lookup"><span data-stu-id="4f348-244">The client constructs a PUT request containing the new details for the resource and the ETag for the currently cached version of the resource referenced in an If-Match HTTP header.</span></span> <span data-ttu-id="4f348-245">O exemplo a seguir mostra uma solicitação PUT que atualiza um pedido:</span><span class="sxs-lookup"><span data-stu-id="4f348-245">The following example shows a PUT request that updates an order:</span></span>

    ```HTTP
    PUT http://adventure-works.com/orders/1 HTTP/1.1
    If-Match: "2282343857"
    Content-Type: application/x-www-form-urlencoded
    Content-Length: ...
    productID=3&quantity=5&orderValue=250
    ```
* <span data-ttu-id="4f348-246">A operação PUT na API da Web obtém a ETag atual para os dados solicitados (pedido 1 no exemplo acima) e compara-a ao valor do cabeçalho If-Match.</span><span class="sxs-lookup"><span data-stu-id="4f348-246">The PUT operation in the web API obtains the current ETag for the requested data (order 1 in the above example), and compares it to the value in the If-Match header.</span></span>
* <span data-ttu-id="4f348-247">Se a ETag atual para os dados solicitados corresponde à ETag fornecida pela solicitação, isso significa que o recurso não foi alterado e a API da Web deve executar a atualização, retornando uma mensagem com código de status HTTP 204 (Sem Conteúdo) se for bem-sucedida.</span><span class="sxs-lookup"><span data-stu-id="4f348-247">If the current ETag for the requested data matches the ETag provided by the request, the resource has not changed and the web API should perform the update, returning a message with HTTP status code 204 (No Content) if it is successful.</span></span> <span data-ttu-id="4f348-248">A resposta pode incluir os cabeçalhos Cache-Control e ETag para a versão atualizada do recurso.</span><span class="sxs-lookup"><span data-stu-id="4f348-248">The response can include Cache-Control and ETag headers for the updated version of the resource.</span></span> <span data-ttu-id="4f348-249">A resposta sempre deve incluir o cabeçalho de localização que referencia o URI do recurso recém-atualizado.</span><span class="sxs-lookup"><span data-stu-id="4f348-249">The response should always include the Location header that references the URI of the newly updated resource.</span></span>
* <span data-ttu-id="4f348-250">Se a ETag atual para os dados solicitados não corresponde à ETag fornecida pela solicitação, isso significa que os dados foram modificados por outro usuários desde que foram coletados, e a API da Web deve retornar uma resposta HTTP com um corpo de mensagem vazio e um código de status 412 (Falha na Pré-condição).</span><span class="sxs-lookup"><span data-stu-id="4f348-250">If the current ETag for the requested data does not match the ETag provided by the request, then the data has been changed by another user since it was fetched and the web API should return an HTTP response with an empty message body and a status code of 412 (Precondition Failed).</span></span>
* <span data-ttu-id="4f348-251">Se o recurso a ser atualizado não existe mais, a API da Web deve retornar uma resposta HTTP com o código de status 404 (Não Encontrado).</span><span class="sxs-lookup"><span data-stu-id="4f348-251">If the resource to be updated no longer exists then the web API should return an HTTP response with the status code of 404 (Not Found).</span></span>
* <span data-ttu-id="4f348-252">O cliente usa o código de status e os cabeçalhos de resposta para manter o cache.</span><span class="sxs-lookup"><span data-stu-id="4f348-252">The client uses the status code and response headers to maintain the cache.</span></span> <span data-ttu-id="4f348-253">Se os dados tiverem sido atualizados (código de status 204), o objeto poderá permanecer armazenado em cache (contanto que o cabeçalho Cache-Control não esteja definido como no-store), mas a ETag deverá ser atualizada.</span><span class="sxs-lookup"><span data-stu-id="4f348-253">If the data has been updated (status code 204) then the object can remain cached (as long as the Cache-Control header does not specify no-store) but the ETag should be updated.</span></span> <span data-ttu-id="4f348-254">Se os dados foram alterados por outro usuário (código de status 412) ou não foram encontrados (código de status 404), o objeto armazenado em cache deve ser descartado.</span><span class="sxs-lookup"><span data-stu-id="4f348-254">If the data was changed by another user changed (status code 412) or not found (status code 404) then the cached object should be discarded.</span></span>

<span data-ttu-id="4f348-255">O exemplo de código a seguir mostra uma implementação da operação PUT para o controlador Orders:</span><span class="sxs-lookup"><span data-stu-id="4f348-255">The next code example shows an implementation of the PUT operation for the Orders controller:</span></span>

```csharp
public class OrdersController : ApiController
{
    [HttpPut]
    [Route("api/orders/{id:int}")]
    public IHttpActionResult UpdateExistingOrder(int id, DTOOrder order)
    {
        try
        {
            var baseUri = Constants.GetUriFromConfig();
            var orderToUpdate = this.ordersRepository.GetOrder(id);
            if (orderToUpdate == null)
            {
                return NotFound();
            }

            var hashedOrder = orderToUpdate.GetHashCode();
            string hashedOrderEtag = $"\"{hashedOrder}\"";

            // Retrieve the If-Match header from the request (if it exists)
            var matchEtags = Request.Headers.IfMatch;

            // If there is an Etag in the If-Match header and
            // this etag matches that of the order just retrieved,
            // or if there is no etag, then update the Order
            if (((matchEtags.Count > 0 &&
                String.CompareOrdinal(matchEtags.First().Tag, hashedOrderEtag) == 0)) ||
                matchEtags.Count == 0)
            {
                // Modify the order
                orderToUpdate.OrderValue = order.OrderValue;
                orderToUpdate.ProductID = order.ProductID;
                orderToUpdate.Quantity = order.Quantity;

                // Save the order back to the data store
                // ...

                // Create the No Content response with Cache-Control, ETag, and Location headers
                var cacheControlHeader = new CacheControlHeaderValue();
                cacheControlHeader.Private = true;
                cacheControlHeader.MaxAge = new TimeSpan(0, 10, 0);

                hashedOrder = order.GetHashCode();
                hashedOrderEtag = $"\"{hashedOrder}\"";
                var eTag = new EntityTagHeaderValue(hashedOrderEtag);

                var location = new Uri($"{baseUri}/{Constants.ORDERS}/{id}");
                var response = new EmptyResultWithCaching()
                {
                    StatusCode = HttpStatusCode.NoContent,
                    CacheControlHeader = cacheControlHeader,
                    ETag = eTag,
                    Location = location
                };

                return response;
            }

            // Otherwise return a Precondition Failed response
            return StatusCode(HttpStatusCode.PreconditionFailed);
        }
        catch
        {
            return InternalServerError();
        }
    }
    ...
}
```

> [!TIP]
> <span data-ttu-id="4f348-256">O uso do cabeçalho If-Match é totalmente opcional e, se ele for omitido, a API da Web sempre tentará atualizar o pedido especificado, possivelmente substituindo às cegas uma atualização feita por outro usuário.</span><span class="sxs-lookup"><span data-stu-id="4f348-256">Use of the If-Match header is entirely optional, and if it is omitted the web API will always attempt to update the specified order, possibly blindly overwriting an update made by another user.</span></span> <span data-ttu-id="4f348-257">Para evitar problemas devido a atualizações perdidas, forneça sempre um cabeçalho If-Match.</span><span class="sxs-lookup"><span data-stu-id="4f348-257">To avoid problems due to lost updates, always provide an If-Match header.</span></span>
>
>

## <a name="considerations-for-handling-large-requests-and-responses"></a><span data-ttu-id="4f348-258">Considerações para lidar com grandes solicitações e respostas</span><span class="sxs-lookup"><span data-stu-id="4f348-258">Considerations for handling large requests and responses</span></span>
<span data-ttu-id="4f348-259">Pode haver ocasiões em que um aplicativo cliente precise emitir solicitações que enviam ou recebem dados, os quais podem chegar a um tamanho de vários megabytes (ou ainda maior).</span><span class="sxs-lookup"><span data-stu-id="4f348-259">There may be occasions when a client application needs to issue requests that send or receive data that may be several megabytes (or bigger) in size.</span></span> <span data-ttu-id="4f348-260">Aguardar enquanto essa quantidade de dados é transmitida pode fazer com que o aplicativo cliente pare de responder.</span><span class="sxs-lookup"><span data-stu-id="4f348-260">Waiting while this amount of data is transmitted could cause the client application to become unresponsive.</span></span> <span data-ttu-id="4f348-261">Quando você precisar processar solicitações que incluem uma quantidade significativa de dados, considere os seguintes pontos:</span><span class="sxs-lookup"><span data-stu-id="4f348-261">Consider the following points when you need to handle requests that include significant amounts of data:</span></span>

### <a name="optimize-requests-and-responses-that-involve-large-objects"></a><span data-ttu-id="4f348-262">Otimize as solicitações e respostas que envolvem objetos grandes</span><span class="sxs-lookup"><span data-stu-id="4f348-262">Optimize requests and responses that involve large objects</span></span>

<span data-ttu-id="4f348-263">Alguns recursos podem ser objetos grandes ou incluir campos grandes, como imagens de gráficos ou outros tipos de dados binários.</span><span class="sxs-lookup"><span data-stu-id="4f348-263">Some resources may be large objects or include large fields, such as graphics images or other types of binary data.</span></span> <span data-ttu-id="4f348-264">Uma API da Web deve oferecer suporte a streaming, para habilitar carregamento e download otimizados desses recursos.</span><span class="sxs-lookup"><span data-stu-id="4f348-264">A web API should support streaming to enable optimized uploading and downloading of these resources.</span></span>

<span data-ttu-id="4f348-265">O protocolo HTTP fornece o mecanismo de codificação para transferência em partes, para transmitir grandes objetos de dados para um cliente.</span><span class="sxs-lookup"><span data-stu-id="4f348-265">The HTTP protocol provides the chunked transfer encoding mechanism to stream large data objects back to a client.</span></span> <span data-ttu-id="4f348-266">Quando o cliente envia uma solicitação HTTP GET para um objeto grande, a API da Web pode enviar a resposta em *partes* fragmentadas por uma conexão HTTP.</span><span class="sxs-lookup"><span data-stu-id="4f348-266">When the client sends an HTTP GET request for a large object, the web API can send the reply back in piecemeal *chunks* over an HTTP connection.</span></span> <span data-ttu-id="4f348-267">O comprimento dos dados na resposta pode não ser conhecido inicialmente (eles podem ser gerados), por isso o servidor que hospeda a API da Web deve enviar uma mensagem de resposta com cada parte que especifique o cabeçalho Transfer-Encoding: Chunked, em vez de um cabeçalho Content-Length.</span><span class="sxs-lookup"><span data-stu-id="4f348-267">The length of the data in the reply may not be known initially (it might be generated), so the server hosting the web API should send a response message with each chunk that specifies the Transfer-Encoding: Chunked header rather than a Content-Length header.</span></span> <span data-ttu-id="4f348-268">O aplicativo cliente pode receber cada uma das partes por vez, para criar a resposta completa.</span><span class="sxs-lookup"><span data-stu-id="4f348-268">The client application can receive each chunk in turn to build up the complete response.</span></span> <span data-ttu-id="4f348-269">A transferência de dados é concluída quando o servidor envia de volta uma parte final com tamanho zero.</span><span class="sxs-lookup"><span data-stu-id="4f348-269">The data transfer completes when the server sends back a final chunk with zero size.</span></span> 

<span data-ttu-id="4f348-270">Uma única solicitação pode perfeitamente resultar em um objeto massivo que consome recursos consideráveis.</span><span class="sxs-lookup"><span data-stu-id="4f348-270">A single request could conceivably result in a massive object that consumes considerable resources.</span></span> <span data-ttu-id="4f348-271">Se, durante o processo de streaming, a API da Web determina que a quantidade de dados em uma solicitação excedeu alguns limites aceitáveis, ele pode anular a operação e retornar uma mensagem de resposta com código de status 413 (Entidade de Solicitação Demasiadamente Grande).</span><span class="sxs-lookup"><span data-stu-id="4f348-271">If, during the streaming process, the web API determines that the amount of data in a request has exceeded some acceptable bounds, it can abort the operation and return a response message with status code 413 (Request Entity Too Large).</span></span>

<span data-ttu-id="4f348-272">Você pode minimizar o tamanho de objetos grandes transmitidos pela rede pelo uso de compactação HTTP.</span><span class="sxs-lookup"><span data-stu-id="4f348-272">You can minimize the size of large objects transmitted over the network by using HTTP compression.</span></span> <span data-ttu-id="4f348-273">Essa abordagem ajuda a reduzir a quantidade de tráfego de rede e a latência de rede associada, mas para isso exigem processamento adicional no cliente e no servidor que hospeda a API da Web.</span><span class="sxs-lookup"><span data-stu-id="4f348-273">This approach helps to reduce the amount of network traffic and the associated network latency, but at the cost of requiring additional processing at the client and the server hosting the web API.</span></span> <span data-ttu-id="4f348-274">Por exemplo, um aplicativo cliente que espera receber dados compactados pode incluir um cabeçalho de solicitação Accept-Encoding: gzip (outros algoritmos de compactação de dados também podem ser especificados).</span><span class="sxs-lookup"><span data-stu-id="4f348-274">For example, a client application that expects to receive compressed data can include an Accept-Encoding: gzip request header (other data compression algorithms can also be specified).</span></span> <span data-ttu-id="4f348-275">Se o servidor oferece suporte à compactação, ele deverá responder com o conteúdo mantido em formato gzip no corpo da mensagem e o cabeçalho de resposta Content-Encoding: gzip.</span><span class="sxs-lookup"><span data-stu-id="4f348-275">If the server supports compression it should respond with the content held in gzip format in the message body and the Content-Encoding: gzip response header.</span></span>

<span data-ttu-id="4f348-276">Você pode combinar compactação codificada com streaming; compacte os dados antes de enviá-los por streaming, então especifique a codificação de conteúdo gzip e codificação de transferência em partes nos cabeçalhos das mensagens.</span><span class="sxs-lookup"><span data-stu-id="4f348-276">You can combine encoded compression with streaming; compress the data first before streaming it, and specify the gzip content encoding and chunked transfer encoding in the message headers.</span></span> <span data-ttu-id="4f348-277">Observe também que alguns servidores Web (como o Internet Information Server) podem ser configurados para compactar automaticamente respostas HTTP, independentemente de a API da Web compactar os dados ou não.</span><span class="sxs-lookup"><span data-stu-id="4f348-277">Also note that some web servers (such as Internet Information Server) can be configured to automatically compress HTTP responses regardless of whether the web API compresses the data or not.</span></span>

### <a name="implement-partial-responses-for-clients-that-do-not-support-asynchronous-operations"></a><span data-ttu-id="4f348-278">Implemente respostas parciais para clientes que não oferecem suporte a operações assíncronas</span><span class="sxs-lookup"><span data-stu-id="4f348-278">Implement partial responses for clients that do not support asynchronous operations</span></span>

<span data-ttu-id="4f348-279">Como alternativa para streaming assíncrono, um aplicativo cliente pode solicitar explicitamente que dados para objetos grandes sejam transmitidos em partes, conhecidas como respostas parciais.</span><span class="sxs-lookup"><span data-stu-id="4f348-279">As an alternative to asynchronous streaming, a client application can explicitly request data for large objects in chunks, known as partial responses.</span></span> <span data-ttu-id="4f348-280">O aplicativo cliente envia uma solicitação HTTP HEAD para obter informações sobre o objeto.</span><span class="sxs-lookup"><span data-stu-id="4f348-280">The client application sends an HTTP HEAD request to obtain information about the object.</span></span> <span data-ttu-id="4f348-281">Se a API da Web oferece suporte a respostas parciais, ela deve responder à solicitação HEAD com uma mensagem de resposta contendo um cabeçalho Accept-Ranges e um cabeçalho Content-Length, que indica o tamanho total do objeto; o corpo da mensagem, porém, deve estar vazio.</span><span class="sxs-lookup"><span data-stu-id="4f348-281">If the web API supports partial responses if should respond to the HEAD request with a response message that contains an Accept-Ranges header and a Content-Length header that indicates the total size of the object, but the body of the message should be empty.</span></span> <span data-ttu-id="4f348-282">O aplicativo cliente pode usar essas informações para construir uma série de operações GET que especificam um intervalo de bytes a receber.</span><span class="sxs-lookup"><span data-stu-id="4f348-282">The client application can use this information to construct a series of GET requests that specify a range of bytes to receive.</span></span> <span data-ttu-id="4f348-283">A API da Web deve retornar uma mensagem de resposta com status HTTP 206 (Conteúdo Parcial), um cabeçalho Content-Length, que especifica a quantidade real de dados incluídos no corpo da mensagem de resposta e, por fim, um cabeçalho de Content-Range, que indica qual parte (como os bytes 4.000 a 8.000) do objeto esses dados representam.</span><span class="sxs-lookup"><span data-stu-id="4f348-283">The web API should return a response message with HTTP status 206 (Partial Content), a Content-Length header that specifies the actual amount of data included in the body of the response message, and a Content-Range header that indicates which part (such as bytes 4000 to 8000) of the object this data represents.</span></span>

<span data-ttu-id="4f348-284">Solicitações HTTP HEAD e respostas parciais são descritas mais detalhadamente em [Design de API][api-design].</span><span class="sxs-lookup"><span data-stu-id="4f348-284">HTTP HEAD requests and partial responses are described in more detail in [API Design][api-design].</span></span>

### <a name="avoid-sending-unnecessary-100-continue-status-messages-in-client-applications"></a><span data-ttu-id="4f348-285">Evite enviar mensagens de status 100-Continue desnecessárias em aplicativos cliente</span><span class="sxs-lookup"><span data-stu-id="4f348-285">Avoid sending unnecessary 100-Continue status messages in client applications</span></span>

<span data-ttu-id="4f348-286">Um aplicativo cliente que está prestes a enviar uma grande quantidade de dados para um servidor pode determinar primeiro se o servidor está ou não realmente disposto a aceitar a solicitação.</span><span class="sxs-lookup"><span data-stu-id="4f348-286">A client application that is about to send a large amount of data to a server may determine first whether the server is actually willing to accept the request.</span></span> <span data-ttu-id="4f348-287">Antes de enviar os dados, o aplicativo cliente pode enviar uma solicitação HTTP com um cabeçalho Expect: 100-Continue, um cabeçalho Content-Length que indica o tamanho dos dados e, além disso, um corpo de mensagem vazio.</span><span class="sxs-lookup"><span data-stu-id="4f348-287">Prior to sending the data, the client application can submit an HTTP request with an Expect: 100-Continue header, a Content-Length header that indicates the size of the data, but an empty message body.</span></span> <span data-ttu-id="4f348-288">Se o servidor estiver disposto a processar a solicitação, ele deve responder com uma mensagem que especifica o status HTTP 100 (Continuar).</span><span class="sxs-lookup"><span data-stu-id="4f348-288">If the server is willing to handle the request, it should respond with a message that specifies the HTTP status 100 (Continue).</span></span> <span data-ttu-id="4f348-289">O aplicativo cliente pode, em seguida, prosseguir e enviar a solicitação completa, incluindo os dados no corpo da mensagem.</span><span class="sxs-lookup"><span data-stu-id="4f348-289">The client application can then proceed and send the complete request including the data in the message body.</span></span>

<span data-ttu-id="4f348-290">Se você está hospedando um serviço usando o IIS, o driver HTTP.sys detecta e processa automaticamente cabeçalhos Expect: 100-Continue antes de passar as solicitações ao seu aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="4f348-290">If you are hosting a service by using IIS, the HTTP.sys driver automatically detects and handles Expect: 100-Continue headers before passing requests to your web application.</span></span> <span data-ttu-id="4f348-291">Isso significa que é improvável que você veja esses cabeçalhos no código do aplicativo, e você pode presumir que o IIS já filtrou todas as mensagens que classifica como impróprias ou muito grandes.</span><span class="sxs-lookup"><span data-stu-id="4f348-291">This means that you are unlikely to see these headers in your application code, and you can assume that IIS has already filtered any messages that it deems to be unfit or too large.</span></span>

<span data-ttu-id="4f348-292">Se você está criando aplicativos cliente usando o .NET Framework, todas as mensagens POST e PUT enviarão primeiro, por padrão, mensagens com cabeçalhos Expect: 100-Continue.</span><span class="sxs-lookup"><span data-stu-id="4f348-292">If you are building client applications by using the .NET Framework, then all POST and PUT messages will first send messages with Expect: 100-Continue headers by default.</span></span> <span data-ttu-id="4f348-293">Assim como acontece com o lado do servidor, o processo é tratado de modo transparente pelo .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="4f348-293">As with the server-side, the process is handled transparently by the .NET Framework.</span></span> <span data-ttu-id="4f348-294">No entanto, como resultado desse processo, cada solicitação POST e PUT causa duas viagens de ida e volta ao servidor, mesmo para solicitações pequenas.</span><span class="sxs-lookup"><span data-stu-id="4f348-294">However, this process results in each POST and PUT request causing two round-trips to the server, even for small requests.</span></span> <span data-ttu-id="4f348-295">Se seu aplicativo não está enviando solicitações com grandes quantidades de dados, você pode desabilitar esse recurso usando a classe `ServicePointManager` para criar objetos `ServicePoint` no aplicativo cliente.</span><span class="sxs-lookup"><span data-stu-id="4f348-295">If your application is not sending requests with large amounts of data, you can disable this feature by using the `ServicePointManager` class to create `ServicePoint` objects in the client application.</span></span> <span data-ttu-id="4f348-296">Um objeto `ServicePoint` processa as conexões que o cliente faz a um servidor com base no esquema nos fragmentos de host de URIs que identificam recursos no servidor.</span><span class="sxs-lookup"><span data-stu-id="4f348-296">A `ServicePoint` object handles the connections that the client makes to a server based on the scheme and host fragments of URIs that identify resources on the server.</span></span> <span data-ttu-id="4f348-297">Então, você pode definir a propriedade `Expect100Continue` do objeto `ServicePoint` como false.</span><span class="sxs-lookup"><span data-stu-id="4f348-297">You can then set the `Expect100Continue` property of the `ServicePoint` object to false.</span></span> <span data-ttu-id="4f348-298">Todas as solicitações POST e PUT subsequentes feitas pelo cliente por meio de um URI que corresponda ao esquema e aos fragmentos de host do objeto `ServicePoint` serão enviadas sem cabeçalhos Expect: 100-Continue.</span><span class="sxs-lookup"><span data-stu-id="4f348-298">All subsequent POST and PUT requests made by the client through a URI that matches the scheme and host fragments of the `ServicePoint` object will be sent without Expect: 100-Continue headers.</span></span> <span data-ttu-id="4f348-299">O código a seguir mostra como configurar um `ServicePoint` que configura todas as solicitações enviadas para URIs com um esquema `http` e um host de `www.contoso.com`.</span><span class="sxs-lookup"><span data-stu-id="4f348-299">The following code shows how to configure a `ServicePoint` object that configures all requests sent to URIs with a scheme of `http` and a host of `www.contoso.com`.</span></span>

```csharp
Uri uri = new Uri("http://www.contoso.com/");
ServicePoint sp = ServicePointManager.FindServicePoint(uri);
sp.Expect100Continue = false;
```

<span data-ttu-id="4f348-300">Você também pode definir a propriedade `Expect100Continue` estática da classe `ServicePointManager` para especificar o valor padrão dessa propriedade para todos os objetos `ServicePoint` criados posteriormente.</span><span class="sxs-lookup"><span data-stu-id="4f348-300">You can also set the static `Expect100Continue` property of the `ServicePointManager` class to specify the default value of this property for all subsequently created `ServicePoint` objects.</span></span> <span data-ttu-id="4f348-301">Para obter mais informações, confira [Classe ServicePoint](https://msdn.microsoft.com/library/system.net.servicepoint.aspx).</span><span class="sxs-lookup"><span data-stu-id="4f348-301">For more information, see [ServicePoint Class](https://msdn.microsoft.com/library/system.net.servicepoint.aspx).</span></span>

### <a name="support-pagination-for-requests-that-may-return-large-numbers-of-objects"></a><span data-ttu-id="4f348-302">Ofereça suporte a paginação para solicitações que podem retornar um grande número de objetos</span><span class="sxs-lookup"><span data-stu-id="4f348-302">Support pagination for requests that may return large numbers of objects</span></span>

<span data-ttu-id="4f348-303">Se uma coleção contém um grande número de recursos, emitir uma solicitação GET para o URI correspondente pode resultar em processamento significativo no servidor que hospeda a API da Web, afetando o desempenho, além de gerar uma quantidade significativa de tráfego de rede resultando em aumento da latência.</span><span class="sxs-lookup"><span data-stu-id="4f348-303">If a collection contains a large number of resources, issuing a GET request to the corresponding URI could result in significant processing on the server hosting the web API affecting performance, and generate a significant amount of network traffic resulting in increased latency.</span></span>

<span data-ttu-id="4f348-304">Para tratar desses casos, a API da Web deve oferecer suporte a cadeias de consulta que habilitam o aplicativo cliente a refinar solicitações ou coletar dados em blocos (ou páginas) mais gerenciáveis e discretos.</span><span class="sxs-lookup"><span data-stu-id="4f348-304">To handle these cases, the web API should support query strings that enable the client application to refine requests or fetch data in more manageable, discrete blocks (or pages).</span></span> <span data-ttu-id="4f348-305">O código a seguir mostra o método `GetAllOrders` no controlador `Orders`.</span><span class="sxs-lookup"><span data-stu-id="4f348-305">The code below shows the `GetAllOrders` method in the `Orders` controller.</span></span> <span data-ttu-id="4f348-306">Esse método obtém os detalhes de pedidos.</span><span class="sxs-lookup"><span data-stu-id="4f348-306">This method retrieves the details of orders.</span></span> <span data-ttu-id="4f348-307">Se esse método fosse irrestrito, ele poderia perfeitamente retornar uma grande quantidade de dados.</span><span class="sxs-lookup"><span data-stu-id="4f348-307">If this method was unconstrained, it could conceivably return a large amount of data.</span></span> <span data-ttu-id="4f348-308">Os parâmetros `limit` e `offset` têm a finalidade de reduzir o volume de dados a um subconjunto menor; nesse caso, por padrão, somente os primeiros 10 pedidos:</span><span class="sxs-lookup"><span data-stu-id="4f348-308">The `limit` and `offset` parameters are intended to reduce the volume of data to a smaller subset, in this case only the first 10 orders by default:</span></span>

```csharp
public class OrdersController : ApiController
{
    ...
    [Route("api/orders")]
    [HttpGet]
    public IEnumerable<Order> GetAllOrders(int limit=10, int offset=0)
    {
        // Find the number of orders specified by the limit parameter
        // starting with the order specified by the offset parameter
        var orders = ...
        return orders;
    }
    ...
}
```

<span data-ttu-id="4f348-309">Usando o URI `http://www.adventure-works.com/api/orders?limit=30&offset=50`, um aplicativo cliente pode emitir uma solicitação para recuperar 30 pedidos começando com deslocamento 50.</span><span class="sxs-lookup"><span data-stu-id="4f348-309">A client application can issue a request to retrieve 30 orders starting at offset 50 by using the URI `http://www.adventure-works.com/api/orders?limit=30&offset=50`.</span></span>

> [!TIP]
> <span data-ttu-id="4f348-310">Evite habilitar aplicativos cliente a especificar cadeias de consulta que resultem em um URI com mais de 2.000 caracteres.</span><span class="sxs-lookup"><span data-stu-id="4f348-310">Avoid enabling client applications to specify query strings that result in a URI that is more than 2000 characters long.</span></span> <span data-ttu-id="4f348-311">Muitos servidores e clientes da Web não podem processar URIs tão longos.</span><span class="sxs-lookup"><span data-stu-id="4f348-311">Many web clients and servers cannot handle URIs that are this long.</span></span>
>
>

## <a name="considerations-for-maintaining-responsiveness-scalability-and-availability"></a><span data-ttu-id="4f348-312">Considerações para manter a disponibilidade, escalabilidade e capacidade de resposta</span><span class="sxs-lookup"><span data-stu-id="4f348-312">Considerations for maintaining responsiveness, scalability, and availability</span></span>
<span data-ttu-id="4f348-313">A mesma API da Web pode ser utilizada por muitos aplicativos cliente em execução em qualquer lugar do mundo.</span><span class="sxs-lookup"><span data-stu-id="4f348-313">The same web API might be utilized by many client applications running anywhere in the world.</span></span> <span data-ttu-id="4f348-314">É importante garantir que a API da Web seja implementada para manter a capacidade de resposta sob uma carga pesada, para ser dimensionável de modo a oferecer suporte a uma carga de trabalho altamente variável e, por fim, para garantir a disponibilidade para clientes que executam operações críticas para os negócios.</span><span class="sxs-lookup"><span data-stu-id="4f348-314">It is important to ensure that the web API is implemented to maintain responsiveness under a heavy load, to be scalable to support a highly varying workload, and to guarantee availability for clients that perform business-critical operations.</span></span> <span data-ttu-id="4f348-315">Considere os pontos a seguir ao determinar como atender a esses requisitos:</span><span class="sxs-lookup"><span data-stu-id="4f348-315">Consider the following points when determining how to meet these requirements:</span></span>

### <a name="provide-asynchronous-support-for-long-running-requests"></a><span data-ttu-id="4f348-316">Forneça suporte assíncrono para solicitações de execução longa</span><span class="sxs-lookup"><span data-stu-id="4f348-316">Provide asynchronous support for long-running requests</span></span>

<span data-ttu-id="4f348-317">Uma solicitação que pode levar muito tempo para ser processada deve ser realizada sem bloquear o cliente que enviou a solicitação.</span><span class="sxs-lookup"><span data-stu-id="4f348-317">A request that might take a long time to process should be performed without blocking the client that submitted the request.</span></span> <span data-ttu-id="4f348-318">A API da Web pode executar algumas verificações iniciais para validar a solicitação, iniciar uma tarefa separada para executar o trabalho e, em seguida, retornar uma mensagem de resposta com o código HTTP 202 (Aceito).</span><span class="sxs-lookup"><span data-stu-id="4f348-318">The web API can perform some initial checking to validate the request, initiate a separate task to perform the work, and then return a response message with HTTP code 202 (Accepted).</span></span> <span data-ttu-id="4f348-319">A tarefa pode ser executada de maneira assíncrona como parte da API de Web em processamento ou pode ser descarregada para uma tarefa em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="4f348-319">The task could run asynchronously as part of the web API processing, or it could be offloaded to a background task.</span></span>

<span data-ttu-id="4f348-320">A API da Web também deve fornecer um mecanismo para retornar os resultados do processamento para o aplicativo cliente.</span><span class="sxs-lookup"><span data-stu-id="4f348-320">The web API should also provide a mechanism to return the results of the processing to the client application.</span></span> <span data-ttu-id="4f348-321">Você pode fazer isso fornecendo um mecanismo de pesquisa para que aplicativos cliente consultem periodicamente se o processamento foi concluído e obtenham o resultado, ou então habilitando a API da Web para enviar uma notificação quando a operação tiver sido concluída.</span><span class="sxs-lookup"><span data-stu-id="4f348-321">You can achieve this by providing a polling mechanism for client applications to periodically query whether the processing has finished and obtain the result, or enabling the web API to send a notification when the operation has completed.</span></span>

<span data-ttu-id="4f348-322">Você pode implementar um mecanismo de pesquisa simples, fornecendo um URI de *sondagem* que atue como um recurso virtual usando a seguinte abordagem:</span><span class="sxs-lookup"><span data-stu-id="4f348-322">You can implement a simple polling mechanism by providing a *polling* URI that acts as a virtual resource using the following approach:</span></span>

1. <span data-ttu-id="4f348-323">O aplicativo cliente envia a solicitação inicial para a API da Web.</span><span class="sxs-lookup"><span data-stu-id="4f348-323">The client application sends the initial request to the web API.</span></span>
2. <span data-ttu-id="4f348-324">A API da Web armazena informações sobre a solicitação em uma tabela mantida no armazenamento de tabela ou no Cache do Microsoft Azure e gera uma chave exclusiva para essa entrada, possivelmente na forma de uma GUID.</span><span class="sxs-lookup"><span data-stu-id="4f348-324">The web API stores information about the request in a table held in table storage or Microsoft Azure Cache, and generates a unique key for this entry, possibly in the form of a GUID.</span></span>
3. <span data-ttu-id="4f348-325">A API da Web inicia o processamento como uma tarefa separada.</span><span class="sxs-lookup"><span data-stu-id="4f348-325">The web API initiates the processing as a separate task.</span></span> <span data-ttu-id="4f348-326">A API da Web registra o estado da tarefa na tabela como *Em execução*.</span><span class="sxs-lookup"><span data-stu-id="4f348-326">The web API records the state of the task in the table as *Running*.</span></span>
4. <span data-ttu-id="4f348-327">A API da Web retorna uma mensagem de resposta com código de status HTTP 202 (Aceito) e a GUID da entrada da tabela no corpo da mensagem.</span><span class="sxs-lookup"><span data-stu-id="4f348-327">The web API returns a response message with HTTP status code 202 (Accepted), and the GUID of the table entry in the body of the message.</span></span>
5. <span data-ttu-id="4f348-328">Quando a tarefa for concluída, a API da Web armazenará os resultados na tabela e definirá o estado da tarefa como *Concluída*.</span><span class="sxs-lookup"><span data-stu-id="4f348-328">When the task has completed, the web API stores the results in the table, and sets the state of the task to *Complete*.</span></span> <span data-ttu-id="4f348-329">Observe que, se a tarefa falhar, a API da Web poderá também armazenar informações sobre a falha e definir o status como *Falha*.</span><span class="sxs-lookup"><span data-stu-id="4f348-329">Note that if the task fails, the web API could also store information about the failure and set the status to *Failed*.</span></span>
6. <span data-ttu-id="4f348-330">Enquanto a tarefa é executada, o cliente pode continuar a executar seu próprio processamento.</span><span class="sxs-lookup"><span data-stu-id="4f348-330">While the task is running, the client can continue performing its own processing.</span></span> <span data-ttu-id="4f348-331">Ele pode enviar periodicamente uma solicitação para o URI*/polling/{guid}* onde *{guid}* é a GUID retornada na mensagem de resposta 202 pela API da Web.</span><span class="sxs-lookup"><span data-stu-id="4f348-331">It can periodically send a request to the URI */polling/{guid}* where *{guid}* is the GUID returned in the 202 response message by the web API.</span></span>
7. <span data-ttu-id="4f348-332">A API da Web no URI */polling/{guid}* consulta o estado da tarefa correspondente na tabela e retorna uma mensagem de resposta, com código de status HTTP 200 (OK) e contendo esse estado (*Running*, *Complete* ou *Failed*).</span><span class="sxs-lookup"><span data-stu-id="4f348-332">The web API at the */polling/{guid}* URI queries the state of the corresponding task in the table and returns a response message with HTTP status code 200 (OK) containing this state (*Running*, *Complete*, or *Failed*).</span></span> <span data-ttu-id="4f348-333">Se a tarefa foi concluída ou falhou, a mensagem de resposta também pode incluir os resultados de processamento ou quaisquer informações disponíveis sobre o motivo da falha.</span><span class="sxs-lookup"><span data-stu-id="4f348-333">If the task has completed or failed, the response message can also include the results of the processing or any information available about the reason for the failure.</span></span>

<span data-ttu-id="4f348-334">Entre as opções para implementar notificações, temos:</span><span class="sxs-lookup"><span data-stu-id="4f348-334">Options for implementing notifications include:</span></span>

- <span data-ttu-id="4f348-335">Usar um Hub de Notificação do Azure para enviar respostas assíncronas para aplicativos cliente.</span><span class="sxs-lookup"><span data-stu-id="4f348-335">Using an Azure Notification Hub to push asynchronous responses to client applications.</span></span> <span data-ttu-id="4f348-336">Para obter mais informações, confira [Notificação de usuários nos Hubs de Notificação do Azure](/azure/notification-hubs/notification-hubs-aspnet-backend-windows-dotnet-wns-notification/).</span><span class="sxs-lookup"><span data-stu-id="4f348-336">For more information, see [Azure Notification Hubs Notify Users](/azure/notification-hubs/notification-hubs-aspnet-backend-windows-dotnet-wns-notification/).</span></span>
- <span data-ttu-id="4f348-337">Usar o modelo Comet para manter uma conexão de rede persistente entre o cliente e o servidor que hospeda a API da Web, e usar essa conexão para enviar mensagens do servidor por push de volta para o cliente.</span><span class="sxs-lookup"><span data-stu-id="4f348-337">Using the Comet model to retain a persistent network connection between the client and the server hosting the web API, and using this connection to push messages from the server back to the client.</span></span> <span data-ttu-id="4f348-338">O artigo da revista MSDN [Criando um Aplicativo Comet Simples no Microsoft .NET Framework](https://msdn.microsoft.com/magazine/jj891053.aspx) descreve um exemplo de solução.</span><span class="sxs-lookup"><span data-stu-id="4f348-338">The MSDN magazine article [Building a Simple Comet Application in the Microsoft .NET Framework](https://msdn.microsoft.com/magazine/jj891053.aspx) describes an example solution.</span></span>
- <span data-ttu-id="4f348-339">Usar o SignalR para enviar dados em tempo real do servidor Web ao cliente por uma conexão de rede persistente.</span><span class="sxs-lookup"><span data-stu-id="4f348-339">Using SignalR to push data in real-time from the web server to the client over a persistent network connection.</span></span> <span data-ttu-id="4f348-340">O SignalR está disponível para aplicativos Web ASP.NET como um pacote do NuGet.</span><span class="sxs-lookup"><span data-stu-id="4f348-340">SignalR is available for ASP.NET web applications as a NuGet package.</span></span> <span data-ttu-id="4f348-341">Você pode encontrar mais informações no site [SignalR ASP.NET](http://signalr.net/) .</span><span class="sxs-lookup"><span data-stu-id="4f348-341">You can find more information on the [ASP.NET SignalR](http://signalr.net/) website.</span></span>

### <a name="ensure-that-each-request-is-stateless"></a><span data-ttu-id="4f348-342">Verifique se cada solicitação é sem estado</span><span class="sxs-lookup"><span data-stu-id="4f348-342">Ensure that each request is stateless</span></span>

<span data-ttu-id="4f348-343">Cada solicitação deve ser considerada atômica.</span><span class="sxs-lookup"><span data-stu-id="4f348-343">Each request should be considered atomic.</span></span> <span data-ttu-id="4f348-344">Não deve haver nenhuma dependência entre uma solicitação feita por um aplicativo cliente e as solicitações subsequentes emitidas pelo mesmo cliente.</span><span class="sxs-lookup"><span data-stu-id="4f348-344">There should be no dependencies between one request made by a client application and any subsequent requests submitted by the same client.</span></span> <span data-ttu-id="4f348-345">Essa abordagem ajuda na escalabilidade; instâncias do serviço Web podem ser implantadas em vários servidores.</span><span class="sxs-lookup"><span data-stu-id="4f348-345">This approach assists in scalability; instances of the web service can be deployed on a number of servers.</span></span> <span data-ttu-id="4f348-346">Solicitações de cliente podem ser direcionadas para qualquer uma dessas instâncias e os resultados devem ser sempre os mesmos.</span><span class="sxs-lookup"><span data-stu-id="4f348-346">Client requests can be directed at any of these instances and the results should always be the same.</span></span> <span data-ttu-id="4f348-347">Ele também melhora a disponibilidade pelo mesmo motivo; se um servidor Web falhar, as solicitações poderão ser roteadas para outra instância (usando o Gerenciador de Tráfego do Azure), enquanto o servidor será reiniciado sem nenhum dano aos aplicativos cliente.</span><span class="sxs-lookup"><span data-stu-id="4f348-347">It also improves availability for a similar reason; if a web server fails requests can be routed to another instance (by using Azure Traffic Manager) while the server is restarted with no ill effects on client applications.</span></span>

### <a name="track-clients-and-implement-throttling-to-reduce-the-chances-of-dos-attacks"></a><span data-ttu-id="4f348-348">Acompanhe os clientes e implemente limitação para reduzir as chances de ataques DOS</span><span class="sxs-lookup"><span data-stu-id="4f348-348">Track clients and implement throttling to reduce the chances of DOS attacks</span></span>

<span data-ttu-id="4f348-349">Se um cliente específico faz um grande número de solicitações em um determinado período de tempo, ele pode monopolizar o serviço e afetar o desempenho de outros clientes.</span><span class="sxs-lookup"><span data-stu-id="4f348-349">If a specific client makes a large number of requests within a given period of time it might monopolize the service and affect the performance of other clients.</span></span> <span data-ttu-id="4f348-350">Para atenuar esse problema, uma API da Web pode monitorar chamadas de aplicativos cliente acompanhando o endereço IP de todas as solicitações em entrada ou registrando cada acesso autenticado em log.</span><span class="sxs-lookup"><span data-stu-id="4f348-350">To mitigate this issue, a web API can monitor calls from client applications either by tracking the IP address of all incoming requests or by logging each authenticated access.</span></span> <span data-ttu-id="4f348-351">Você pode usar essas informações para limitar o acesso aos recursos.</span><span class="sxs-lookup"><span data-stu-id="4f348-351">You can use this information to limit resource access.</span></span> <span data-ttu-id="4f348-352">Se um cliente exceder um limite definido, a API da Web pode retornar uma mensagem de resposta com status 503 (Serviço Indisponível) e incluir um cabeçalho Retry-After, que especifica quando o cliente pode enviar a próxima solicitação sem que esta seja recusada.</span><span class="sxs-lookup"><span data-stu-id="4f348-352">If a client exceeds a defined limit, the web API can return a response message with status 503 (Service Unavailable) and include a Retry-After header that specifies when the client can send the next request without it being declined.</span></span> <span data-ttu-id="4f348-353">Essa estratégia pode ajudar a reduzir as chances de que um ataque DOS (Negação de Serviço) de um conjunto de clientes paralise o sistema.</span><span class="sxs-lookup"><span data-stu-id="4f348-353">This strategy can help to reduce the chances of a Denial Of Service (DOS) attack from a set of clients stalling the system.</span></span>

### <a name="manage-persistent-http-connections-carefully"></a><span data-ttu-id="4f348-354">Gerencie as conexões HTTP persistentes cuidadosamente</span><span class="sxs-lookup"><span data-stu-id="4f348-354">Manage persistent HTTP connections carefully</span></span>

<span data-ttu-id="4f348-355">O protocolo HTTP oferece suporte a conexões HTTP persistentes nos casos em que elas estão disponíveis.</span><span class="sxs-lookup"><span data-stu-id="4f348-355">The HTTP protocol supports persistent HTTP connections where they are available.</span></span> <span data-ttu-id="4f348-356">A especificação de HTTP 1.0 adicionada ao cabeçalho Connection:Keep-Alive habilita um aplicativo cliente a indicar ao servidor que ele pode usar a mesma conexão para enviar solicitações subsequentes, em vez de abrir novas conexões.</span><span class="sxs-lookup"><span data-stu-id="4f348-356">The HTTP 1.0 specificiation added the Connection:Keep-Alive header that enables a client application to indicate to the server that it can use the same connection to send subsequent requests rather than opening new ones.</span></span> <span data-ttu-id="4f348-357">A conexão será fechada automaticamente se o cliente não reutilizar a conexão dentro de um período definido pelo host.</span><span class="sxs-lookup"><span data-stu-id="4f348-357">The connection closes automatically if the client does not reuse the connection within a period defined by the host.</span></span> <span data-ttu-id="4f348-358">Esse comportamento é o padrão no HTTP 1.1 conforme usado por serviços do Azure, portanto, não é necessário incluir cabeçalhos Keep-Alive nas mensagens.</span><span class="sxs-lookup"><span data-stu-id="4f348-358">This behavior is the default in HTTP 1.1 as used by Azure services, so there is no need to include Keep-Alive headers in messages.</span></span>

<span data-ttu-id="4f348-359">Manter uma conexão aberta pode ajudar a melhorar a capacidade de resposta, reduzindo a latência e o congestionamento da rede, mas pode ser prejudicial para escalabilidade ao manter conexões desnecessárias abertas por mais tempo que o necessário, limitando a capacidade de conexão de outros clientes simultâneos.</span><span class="sxs-lookup"><span data-stu-id="4f348-359">Keeping a connection open can help to improve responsiveness by reducing latency and network congestion, but it can be detrimental to scalability by keeping unnecessary connections open for longer than required, limiting the ability of other concurrent clients to connect.</span></span> <span data-ttu-id="4f348-360">Isso também pode afetar vida útil da bateria, se o aplicativo cliente for executado em um dispositivo móvel; se o aplicativo realizará apenas solicitações ocasionais ao servidor, manter uma conexão aberta pode descarregar a bateria mais rapidamente.</span><span class="sxs-lookup"><span data-stu-id="4f348-360">It can also affect battery life if the client application is running on a mobile device; if the application only makes occasional requests to the server, maintaining an open connection can cause the battery to drain more quickly.</span></span> <span data-ttu-id="4f348-361">Para garantir que uma conexão não seja tornada persistente com o HTTP 1.1, o cliente pode incluir um cabeçalho Connection:Close às mensagens, para substituir o comportamento padrão.</span><span class="sxs-lookup"><span data-stu-id="4f348-361">To ensure that a connection is not made persistent with HTTP 1.1, the client can include a Connection:Close header with messages to override the default behavior.</span></span> <span data-ttu-id="4f348-362">Do mesmo modo, se um servidor está lidando com um grande número de clientes, ele pode incluir um cabeçalho Connection:Close nas mensagens de resposta que, consequentemente, devem fechar a conexão e poupar os recursos do servidor.</span><span class="sxs-lookup"><span data-stu-id="4f348-362">Similarly, if a server is handling a very large number of clients it can include a Connection:Close header in response messages which should close the connection and save server resources.</span></span>

> [!NOTE]
> <span data-ttu-id="4f348-363">As conexões HTTP persistentes são um recurso puramente opcional para reduzir a sobrecarga de rede associada à repetição no estabelecimento de um canal de comunicação.</span><span class="sxs-lookup"><span data-stu-id="4f348-363">Persistent HTTP connections are a purely optional feature to reduce the network overhead associated with repeatedly establishing a communications channel.</span></span> <span data-ttu-id="4f348-364">Nem a API da Web, tampouco o aplicativo cliente dependem de uma conexão HTTP persistente estar disponível.</span><span class="sxs-lookup"><span data-stu-id="4f348-364">Neither the web API nor the client application should depend on a persistent HTTP connection being available.</span></span> <span data-ttu-id="4f348-365">Não use as conexões HTTP persistentes para implementar sistemas de notificação estilo Comet; em vez disso, você deve utilizar soquetes (ou websockets, se disponível) na camada de TCP.</span><span class="sxs-lookup"><span data-stu-id="4f348-365">Do not use persistent HTTP connections to implement Comet-style notification systems; instead you should utilize sockets (or websockets if available) at the TCP layer.</span></span> <span data-ttu-id="4f348-366">Finalmente, observe que os cabeçalhos Keep-Alive são de uso limitado se um aplicativo cliente comunica-se com um servidor por meio de um proxy, já que apenas a conexão com o cliente e o proxy será persistente.</span><span class="sxs-lookup"><span data-stu-id="4f348-366">Finally, note Keep-Alive headers are of limited use if a client application communicates with a server via a proxy; only the connection with the client and the proxy will be persistent.</span></span>
>
>

## <a name="considerations-for-publishing-and-managing-a-web-api"></a><span data-ttu-id="4f348-367">Considerações para publicação e gerenciamento de uma API da Web</span><span class="sxs-lookup"><span data-stu-id="4f348-367">Considerations for publishing and managing a web API</span></span>
<span data-ttu-id="4f348-368">Para disponibilizar uma API da Web para aplicativos cliente, essa API deve ser implantada em um ambiente de host.</span><span class="sxs-lookup"><span data-stu-id="4f348-368">To make a web API available for client applications, the web API must be deployed to a host environment.</span></span> <span data-ttu-id="4f348-369">Esse ambiente é normalmente um servidor Web, embora possa ser algum outro tipo de processo de host.</span><span class="sxs-lookup"><span data-stu-id="4f348-369">This environment is typically a web server, although it may be some other type of host process.</span></span> <span data-ttu-id="4f348-370">Ao publicar uma API da Web, você deve considerar os seguintes pontos:</span><span class="sxs-lookup"><span data-stu-id="4f348-370">You should consider the following points when publishing a web API:</span></span>

* <span data-ttu-id="4f348-371">Todas as solicitações devem ser autenticadas e autorizadas; o nível apropriado de controle de acesso deve ser imposto.</span><span class="sxs-lookup"><span data-stu-id="4f348-371">All requests must be authenticated and authorized, and the appropriate level of access control must be enforced.</span></span>
* <span data-ttu-id="4f348-372">Uma API da Web comercial pode estar sujeita a diversas garantias de qualidade relacionadas a tempos de resposta.</span><span class="sxs-lookup"><span data-stu-id="4f348-372">A commercial web API might be subject to various quality guarantees concerning response times.</span></span> <span data-ttu-id="4f348-373">Se a carga pode variar significativamente ao longo do tempo, é importante certificar-se de que esse ambiente de host é escalável.</span><span class="sxs-lookup"><span data-stu-id="4f348-373">It is important to ensure that host environment is scalable if the load can vary significantly over time.</span></span>
* <span data-ttu-id="4f348-374">Pode ser necessário fazer a medição das solicitações para fins de monetização.</span><span class="sxs-lookup"><span data-stu-id="4f348-374">It may be necessary to meter requests for monetization purposes.</span></span>
* <span data-ttu-id="4f348-375">Talvez seja necessário controlar o fluxo do tráfego para a API da Web, além de implementar limitação para clientes específicos que tenham esgotado suas cotas.</span><span class="sxs-lookup"><span data-stu-id="4f348-375">It might be necessary to regulate the flow of traffic to the web API, and implement throttling for specific clients that have exhausted their quotas.</span></span>
* <span data-ttu-id="4f348-376">Requisitos normativos podem obrigar o registro e auditoria de todas as solicitações e respostas.</span><span class="sxs-lookup"><span data-stu-id="4f348-376">Regulatory requirements might mandate logging and auditing of all requests and responses.</span></span>
* <span data-ttu-id="4f348-377">Para garantir a disponibilidade, pode ser necessário monitorar a integridade do servidor que hospeda a API da Web e reiniciá-lo se necessário.</span><span class="sxs-lookup"><span data-stu-id="4f348-377">To ensure availability, it may be necessary to monitor the health of the server hosting the web API and restart it if necessary.</span></span>

<span data-ttu-id="4f348-378">É útil poder separar esses problemas dos problemas técnicos relacionados à implementação da API Web.</span><span class="sxs-lookup"><span data-stu-id="4f348-378">It is useful to be able to decouple these issues from the technical issues concerning the implementation of the web API.</span></span> <span data-ttu-id="4f348-379">Por esse motivo, considere a possibilidade de criar uma [fachada](http://en.wikipedia.org/wiki/Facade_pattern), em execução como um processo separado e que encaminhe as solicitações para a API da Web.</span><span class="sxs-lookup"><span data-stu-id="4f348-379">For this reason, consider creating a [façade](http://en.wikipedia.org/wiki/Facade_pattern), running as a separate process and that routes requests to the web API.</span></span> <span data-ttu-id="4f348-380">A fachada pode fornecer as operações de gerenciamento e encaminhar solicitações validadas para a API da Web.</span><span class="sxs-lookup"><span data-stu-id="4f348-380">The façade can provide the management operations and forward validated requests to the web API.</span></span> <span data-ttu-id="4f348-381">O uso de uma fachada também pode oferecer muitas vantagens funcionais, incluindo:</span><span class="sxs-lookup"><span data-stu-id="4f348-381">Using a façade can also bring many functional advantages, including:</span></span>

* <span data-ttu-id="4f348-382">Agir como um ponto de integração para várias APIs da Web.</span><span class="sxs-lookup"><span data-stu-id="4f348-382">Acting as an integration point for multiple web APIs.</span></span>
* <span data-ttu-id="4f348-383">Transformar mensagens e converter os protocolos de comunicação para clientes criados por meio de tecnologias diferentes.</span><span class="sxs-lookup"><span data-stu-id="4f348-383">Transforming messages and translating communications protocols for clients built by using varying technologies.</span></span>
* <span data-ttu-id="4f348-384">Armazenar solicitações e respostas em cache para reduzir a carga no servidor que hospeda a API da Web.</span><span class="sxs-lookup"><span data-stu-id="4f348-384">Caching requests and responses to reduce load on the server hosting the web API.</span></span>

## <a name="considerations-for-testing-a-web-api"></a><span data-ttu-id="4f348-385">Considerações para testar uma API da Web</span><span class="sxs-lookup"><span data-stu-id="4f348-385">Considerations for testing a web API</span></span>
<span data-ttu-id="4f348-386">Uma API da web Deve ser testada tão cuidadosamente quanto qualquer outro software.</span><span class="sxs-lookup"><span data-stu-id="4f348-386">A web API should be tested as thoroughly as any other piece of software.</span></span> <span data-ttu-id="4f348-387">Você deve levar em consideração a criação de testes de unidade para validar a funcionalidade da natureza de uma API da Web que traz seus próprios requisitos adicionais para verificar se está funcionando corretamente.</span><span class="sxs-lookup"><span data-stu-id="4f348-387">You should consider creating unit tests to validate the functionality of The nature of a web API brings its own additional requirements to verify that it operates correctly.</span></span> <span data-ttu-id="4f348-388">Você deve prestar atenção especial aos aspectos a seguir:</span><span class="sxs-lookup"><span data-stu-id="4f348-388">You should pay particular attention to the following aspects:</span></span>

* <span data-ttu-id="4f348-389">Teste todas as rotas para verificar que elas invocam as operações corretas.</span><span class="sxs-lookup"><span data-stu-id="4f348-389">Test all routes to verify that they invoke the correct operations.</span></span> <span data-ttu-id="4f348-390">Esteja ciente principalmente do código de status HTTP 405 (Método Não Permitido) que está sendo retornado inesperadamente, já que isso pode indicar uma incompatibilidade entre uma rota e os métodos HTTP (GET, POST, PUT e DELETE) que podem ser enviados para essa rota.</span><span class="sxs-lookup"><span data-stu-id="4f348-390">Be especially aware of HTTP status code 405 (Method Not Allowed) being returned unexpectedly as this can indicate a mismatch between a route and the HTTP methods (GET, POST, PUT, DELETE) that can be dispatched to that route.</span></span>

    <span data-ttu-id="4f348-391">Envie solicitações HTTP para as rotas que não oferecem suporte a elas, como enviar uma solicitação POST para um recurso específico (solicitações POST só devem ser enviadas para coleções de recursos).</span><span class="sxs-lookup"><span data-stu-id="4f348-391">Send HTTP requests to routes that do not support them, such as submitting a POST request to a specific resource (POST requests should only be sent to resource collections).</span></span> <span data-ttu-id="4f348-392">Nesses casos, a única resposta válida *deve* ser o código de status 405 (Não Permitido).</span><span class="sxs-lookup"><span data-stu-id="4f348-392">In these cases, the only valid response *should* be status code 405 (Not Allowed).</span></span>
* <span data-ttu-id="4f348-393">Verifique se todas as rotas são protegidas adequadamente e estão sujeitas às verificações apropriadas de autenticação e autorização.</span><span class="sxs-lookup"><span data-stu-id="4f348-393">Verify that all routes are protected properly and are subject to the appropriate authentication and authorization checks.</span></span>

  > [!NOTE]
  > <span data-ttu-id="4f348-394">Alguns aspectos de segurança, como autenticação de usuário, muito provavelmente são de responsabilidade do ambiente de host, e não da API da Web; ainda assim, é necessário incluir testes de segurança como parte do processo de implantação.</span><span class="sxs-lookup"><span data-stu-id="4f348-394">Some aspects of security such as user authentication are most likely to be the responsibility of the host environment rather than the web API, but it is still necessary to include security tests as part of the deployment process.</span></span>
  >
  >
* <span data-ttu-id="4f348-395">Teste o processamento de exceção realizado por cada operação e verifique se uma resposta HTTP apropriada e significativa é passada de volta para o aplicativo cliente.</span><span class="sxs-lookup"><span data-stu-id="4f348-395">Test the exception handling performed by each operation and verify that an appropriate and meaningful HTTP response is passed back to the client application.</span></span>
* <span data-ttu-id="4f348-396">Verifique se as mensagens de solicitação e resposta são bem formadas.</span><span class="sxs-lookup"><span data-stu-id="4f348-396">Verify that request and response messages are well-formed.</span></span> <span data-ttu-id="4f348-397">Por exemplo, se uma solicitação HTTP POST contém os dados para um novo recurso no formato x-www-form-urlencoded, confirme que a operação correspondente analisa corretamente os dados, cria os recursos e retorna uma resposta que contém os detalhes do novo recurso, incluindo o cabeçalho Location correto.</span><span class="sxs-lookup"><span data-stu-id="4f348-397">For example, if an HTTP POST request contains the data for a new resource in x-www-form-urlencoded format, confirm that the corresponding operation correctly parses the data, creates the resources, and returns a response containing the details of the new resource, including the correct Location header.</span></span>
* <span data-ttu-id="4f348-398">Verifique todos os links e URIs nas mensagens de resposta.</span><span class="sxs-lookup"><span data-stu-id="4f348-398">Verify all links and URIs in response messages.</span></span> <span data-ttu-id="4f348-399">Por exemplo, uma mensagem HTTP POST deve retornar o URI do recurso recém-criado.</span><span class="sxs-lookup"><span data-stu-id="4f348-399">For example, an HTTP POST message should return the URI of the newly-created resource.</span></span> <span data-ttu-id="4f348-400">Todos os links HATEOAS devem ser válidos.</span><span class="sxs-lookup"><span data-stu-id="4f348-400">All HATEOAS links should be valid.</span></span>

* <span data-ttu-id="4f348-401">Certifique-se de que cada operação retorna os códigos de status corretos para diferentes combinações de entrada.</span><span class="sxs-lookup"><span data-stu-id="4f348-401">Ensure that each operation returns the correct status codes for different combinations of input.</span></span> <span data-ttu-id="4f348-402">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="4f348-402">For example:</span></span>

  * <span data-ttu-id="4f348-403">Se uma consulta for bem-sucedida, ela deverá retornar o código de status 200 (OK)</span><span class="sxs-lookup"><span data-stu-id="4f348-403">If a query is successful, it should return status code 200 (OK)</span></span>
  * <span data-ttu-id="4f348-404">Se um recurso não for encontrado, a operação deverá retornar o código de status HTTP 404 (Não Encontrado).</span><span class="sxs-lookup"><span data-stu-id="4f348-404">If a resource is not found, the operation should return HTTP status code 404 (Not Found).</span></span>
  * <span data-ttu-id="4f348-405">Se o cliente envia uma solicitação que exclui um recurso com êxito, o código de status deve ser 204 (Sem Conteúdo).</span><span class="sxs-lookup"><span data-stu-id="4f348-405">If the client sends a request that successfully deletes a resource, the status code should be 204 (No Content).</span></span>
  * <span data-ttu-id="4f348-406">Se o cliente envia uma solicitação que cria um novo recurso, o código de status deve ser 201 (Criado).</span><span class="sxs-lookup"><span data-stu-id="4f348-406">If the client sends a request that creates a new resource, the status code should be 201 (Created)</span></span>

<span data-ttu-id="4f348-407">Cuidado com códigos de status de resposta inesperados do intervalo 5xx.</span><span class="sxs-lookup"><span data-stu-id="4f348-407">Watch out for unexpected response status codes in the 5xx range.</span></span> <span data-ttu-id="4f348-408">Normalmente, essas mensagens são relatadas pelo servidor de host para indicar que não foi possível atender a uma solicitação válida.</span><span class="sxs-lookup"><span data-stu-id="4f348-408">These messages are usually reported by the host server to indicate that it was unable to fulfill a valid request.</span></span>

* <span data-ttu-id="4f348-409">Teste as diferentes combinações de cabeçalho de solicitação que um aplicativo cliente pode especificar e certifique-se de que a API da Web retorna as informações esperadas nas mensagens de resposta.</span><span class="sxs-lookup"><span data-stu-id="4f348-409">Test the different request header combinations that a client application can specify and ensure that the web API returns the expected information in response messages.</span></span>
* <span data-ttu-id="4f348-410">Teste as cadeias de consulta.</span><span class="sxs-lookup"><span data-stu-id="4f348-410">Test query strings.</span></span> <span data-ttu-id="4f348-411">Se uma operação aceita parâmetros opcionais (por exemplo, solicitações de paginação), teste as diferentes combinações e ordens dos parâmetros.</span><span class="sxs-lookup"><span data-stu-id="4f348-411">If an operation can take optional parameters (such as pagination requests), test the different combinations and order of parameters.</span></span>
* <span data-ttu-id="4f348-412">Verifique se as operações assíncronas são concluídas com êxito.</span><span class="sxs-lookup"><span data-stu-id="4f348-412">Verify that asynchronous operations complete successfully.</span></span> <span data-ttu-id="4f348-413">Se a API da Web oferece suporte a streaming para solicitações que retornam objetos binários grandes (como vídeo ou áudio), certifique-se de que as solicitações de cliente não são bloqueadas enquanto os dados são transmitidos.</span><span class="sxs-lookup"><span data-stu-id="4f348-413">If the web API supports streaming for requests that return large binary objects (such as video or audio), ensure that client requests are not blocked while the data is streamed.</span></span> <span data-ttu-id="4f348-414">Se a API da Web implementa sondagem para operações de modificação de dados de execução longa, verifique se as operações relatam seu status corretamente conforme elas prosseguem.</span><span class="sxs-lookup"><span data-stu-id="4f348-414">If the web API implements polling for long-running data modification operations, verify that that the operations report their status correctly as they proceed.</span></span>

<span data-ttu-id="4f348-415">Você também deve criar e executar testes de desempenho para verificar que a API da Web funciona satisfatoriamente durante emergências.</span><span class="sxs-lookup"><span data-stu-id="4f348-415">You should also create and run performance tests to check that the web API operates satisfactorily under duress.</span></span> <span data-ttu-id="4f348-416">Você pode criar um projeto de teste de carga e desempenho da Web usando o Visual Studio Ultimate.</span><span class="sxs-lookup"><span data-stu-id="4f348-416">You can build a web performance and load test project by using Visual Studio Ultimate.</span></span> <span data-ttu-id="4f348-417">Para obter mais informações, confira [Executar testes de desempenho em um aplicativo antes do lançamento](https://msdn.microsoft.com/library/dn250793.aspx).</span><span class="sxs-lookup"><span data-stu-id="4f348-417">For more information, see [Run performance tests on an application before a release](https://msdn.microsoft.com/library/dn250793.aspx).</span></span>

## <a name="publish-and-manage-a-web-api-using-the-azure-api-management-service"></a><span data-ttu-id="4f348-418">Publicar e gerenciar uma API da Web usando o Serviço de Gerenciamento de API do Azure</span><span class="sxs-lookup"><span data-stu-id="4f348-418">Publish and manage a web API using the Azure API Management Service</span></span>
<span data-ttu-id="4f348-419">O Azure fornece o [Serviço de Gerenciamento de API](https://azure.microsoft.com/documentation/services/api-management/) , que você pode usar para publicar e gerenciar uma API da Web.</span><span class="sxs-lookup"><span data-stu-id="4f348-419">Azure provides the [API Management Service](https://azure.microsoft.com/documentation/services/api-management/) which you can use to publish and manage a web API.</span></span> <span data-ttu-id="4f348-420">Usando esse recurso, é possível gerar um serviço que atua como uma fachada para uma ou mais APIs da Web.</span><span class="sxs-lookup"><span data-stu-id="4f348-420">Using this facility, you can generate a service that acts as a façade for one or more web APIs.</span></span> <span data-ttu-id="4f348-421">O serviço é por si próprio um serviço Web escalonável, que você pode criar e configurar usando o Portal de Gerenciamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="4f348-421">The service is itself a scalable web service that you can create and configure by using the Azure Management portal.</span></span> <span data-ttu-id="4f348-422">Você pode usar esse serviço para publicar e gerenciar uma API da Web conforme descrito a seguir:</span><span class="sxs-lookup"><span data-stu-id="4f348-422">You can use this service to publish and manage a web API as follows:</span></span>

1. <span data-ttu-id="4f348-423">Implante a API da Web em um site, Serviço de Nuvem do Azure ou máquina virtual do Azure.</span><span class="sxs-lookup"><span data-stu-id="4f348-423">Deploy the web API to a website, Azure cloud service, or Azure virtual machine.</span></span>
2. <span data-ttu-id="4f348-424">Conecte o Serviço de Gerenciamento de API à API da Web.</span><span class="sxs-lookup"><span data-stu-id="4f348-424">Connect the API management service to the web API.</span></span> <span data-ttu-id="4f348-425">Solicitações enviadas para a URL da API de gerenciamento são mapeadas para URIs na API da Web.</span><span class="sxs-lookup"><span data-stu-id="4f348-425">Requests sent to the URL of the management API are mapped to URIs in the web API.</span></span> <span data-ttu-id="4f348-426">O mesmo serviço de Gerenciamento de API pode rotear solicitações para mais de uma API da Web.</span><span class="sxs-lookup"><span data-stu-id="4f348-426">The same API management service can route requests to more than one web API.</span></span> <span data-ttu-id="4f348-427">Isso permite que você agregue várias APIs da Web em um único serviço de gerenciamento.</span><span class="sxs-lookup"><span data-stu-id="4f348-427">This enables you to aggregate multiple web APIs into a single management service.</span></span> <span data-ttu-id="4f348-428">Do mesmo modo, a mesma API da Web pode ser referenciada de mais de um serviço de Gerenciamento de API, se for necessário restringir ou particionar a funcionalidade disponível para aplicativos diferentes.</span><span class="sxs-lookup"><span data-stu-id="4f348-428">Similarly, the same web API can be referenced from more than one API management service if you need to restrict or partition the functionality available to different applications.</span></span>

   > [!NOTE]
   > <span data-ttu-id="4f348-429">Os URIs nos links HATEOAS gerados como parte da resposta para solicitações HTTP GET devem referenciar a URL do serviço de gerenciamento de API, e não o servidor Web hospedando a API da Web.</span><span class="sxs-lookup"><span data-stu-id="4f348-429">The URIs in HATEOAS links generated as part of the response for HTTP GET requests should reference the URL of the API management service and not the web server hosting the web API.</span></span>
   >
   >
3. <span data-ttu-id="4f348-430">Para cada API da Web, especifique as operações HTTP expostas por essa API, juntamente com quaisquer parâmetros opcionais que uma operação possa utilizar como entrada.</span><span class="sxs-lookup"><span data-stu-id="4f348-430">For each web API, specify the HTTP operations that the web API exposes together with any optional parameters that an operation can take as input.</span></span> <span data-ttu-id="4f348-431">Você também pode configurar se o serviço de gerenciamento de API deve ou não armazenar em cache a resposta recebida da API da Web, para reduzir a ocorrência de solicitações repetidas para os mesmos dados.</span><span class="sxs-lookup"><span data-stu-id="4f348-431">You can also configure whether the API management service should cache the response received from the web API to optimize repeated requests for the same data.</span></span> <span data-ttu-id="4f348-432">Registre os detalhes das respostas HTTP que cada operação pode gerar.</span><span class="sxs-lookup"><span data-stu-id="4f348-432">Record the details of the HTTP responses that each operation can generate.</span></span> <span data-ttu-id="4f348-433">Essas informações são usadas para gerar a documentação para desenvolvedores, portanto, é importante que sejam completas e precisas.</span><span class="sxs-lookup"><span data-stu-id="4f348-433">This information is used to generate documentation for developers, so it is important that it is accurate and complete.</span></span>

   <span data-ttu-id="4f348-434">Você pode definir operações manualmente usando os assistentes fornecidos pelo Portal de Gerenciamento do Azure, ou pode importá-los de um arquivo que contenha as definições no formato WADL ou Swagger.</span><span class="sxs-lookup"><span data-stu-id="4f348-434">You can either define operations manually using the wizards provided by the Azure Management portal, or you can import them from a file containing the definitions in WADL or Swagger format.</span></span>
4. <span data-ttu-id="4f348-435">Defina as configurações de segurança para comunicações entre o serviço de gerenciamento de API e o servidor Web que hospeda a API da Web.</span><span class="sxs-lookup"><span data-stu-id="4f348-435">Configure the security settings for communications between the API management service and the web server hosting the web API.</span></span> <span data-ttu-id="4f348-436">O serviço de gerenciamento de API atualmente oferece suporte a autenticação Básica e autenticação mútua pelo uso de certificados, além de autorização do usuário OAuth 2.0.</span><span class="sxs-lookup"><span data-stu-id="4f348-436">The API management service currently supports Basic authentication and mutual authentication using certificates, and OAuth 2.0 user authorization.</span></span>
5. <span data-ttu-id="4f348-437">Crie um produto.</span><span class="sxs-lookup"><span data-stu-id="4f348-437">Create a product.</span></span> <span data-ttu-id="4f348-438">Um produto é a unidade de publicação: você adiciona ao produto as APIs da Web que conectou anteriormente ao serviço de gerenciamento.</span><span class="sxs-lookup"><span data-stu-id="4f348-438">A product is the unit of publication; you add the web APIs that you previously connected to the management service to the product.</span></span> <span data-ttu-id="4f348-439">Quando o produto é publicado, APIs da web são disponibilizadas para os desenvolvedores.</span><span class="sxs-lookup"><span data-stu-id="4f348-439">When the product is published, the web APIs become available to developers.</span></span>

   > [!NOTE]
   > <span data-ttu-id="4f348-440">Antes de publicar um produto, você também pode definir grupos de usuários que podem acessar o produto e adicionar usuários a esses grupos.</span><span class="sxs-lookup"><span data-stu-id="4f348-440">Prior to publishing a product, you can also define user-groups that can access the product and add users to these groups.</span></span> <span data-ttu-id="4f348-441">Isso lhe confere controle sobre os desenvolvedores e aplicativos que podem usar a API da Web.</span><span class="sxs-lookup"><span data-stu-id="4f348-441">This gives you control over the developers and applications that can use the web API.</span></span> <span data-ttu-id="4f348-442">Se uma API da Web está sujeita a aprovação, um desenvolvedor, antes de poder acessá-la, deve enviar uma solicitação ao administrador do produto.</span><span class="sxs-lookup"><span data-stu-id="4f348-442">If a web API is subject to approval, prior to being able to access it a developer must send a request to the product administrator.</span></span> <span data-ttu-id="4f348-443">O administrador pode conceder ou negar acesso ao desenvolvedor.</span><span class="sxs-lookup"><span data-stu-id="4f348-443">The administrator can grant or deny access to the developer.</span></span> <span data-ttu-id="4f348-444">Os desenvolvedores existentes também poderão ser bloqueados se as circunstâncias mudarem.</span><span class="sxs-lookup"><span data-stu-id="4f348-444">Existing developers can also be blocked if circumstances change.</span></span>
   >
   >
6. <span data-ttu-id="4f348-445">Configure políticas para cada API da Web.</span><span class="sxs-lookup"><span data-stu-id="4f348-445">Configure policies for each web API.</span></span> <span data-ttu-id="4f348-446">Políticas controlam aspectos como permitir ou não chamadas entre domínios, como autenticar clientes, converter ou não de modo transparente entre os formatos de dados XML e JSON, restringir ou não chamadas de um determinado intervalo de IPs, cotas de uso e, por fim, limitar ou não a taxa de chamada.</span><span class="sxs-lookup"><span data-stu-id="4f348-446">Policies govern aspects such as whether cross-domain calls should be allowed, how to authenticate clients, whether to convert between XML and JSON data formats transparently, whether to restrict calls from a given IP range, usage quotas, and whether to limit the call rate.</span></span> <span data-ttu-id="4f348-447">As políticas podem ser aplicadas globalmente no produto inteiro, para uma única API da Web em um produto ou então para operações individuais em uma API da Web.</span><span class="sxs-lookup"><span data-stu-id="4f348-447">Policies can be applied globally across the entire product, for a single web API in a product, or for individual operations in a web API.</span></span>

<span data-ttu-id="4f348-448">Para obter mais informações, confira a [Documentação de gerenciamento de API](/azure/api-management/).</span><span class="sxs-lookup"><span data-stu-id="4f348-448">For more information, see the [API Management Documentation](/azure/api-management/).</span></span> 

> [!TIP]
> <span data-ttu-id="4f348-449">O Azure oferece o Gerenciador de Tráfego do Azure, que permite implementar failover e balanceamento de carga, além de reduzir a latência entre várias instâncias de um site hospedado em diferentes locais geográficos.</span><span class="sxs-lookup"><span data-stu-id="4f348-449">Azure provides the Azure Traffic Manager which enables you to implement failover and load-balancing, and reduce latency across multiple instances of a web site hosted in different geographic locations.</span></span> <span data-ttu-id="4f348-450">Você pode usar o Gerenciador de Tráfego do Azure em conjunto com o Serviço de Gerenciamento de API; o Serviço de Gerenciamento de API pode rotear solicitações para instâncias de um site por meio do Gerenciador de Tráfego do Azure.</span><span class="sxs-lookup"><span data-stu-id="4f348-450">You can use Azure Traffic Manager in conjunction with the API Management Service; the API Management Service can route requests to instances of a web site through Azure Traffic Manager.</span></span>  <span data-ttu-id="4f348-451">Para obter mais informações, confira [Métodos de roteamento do Gerenciador de Tráfego](/azure/traffic-manager/traffic-manager-routing-methods/).</span><span class="sxs-lookup"><span data-stu-id="4f348-451">For more information, see [Traffic Manager routing Methods](/azure/traffic-manager/traffic-manager-routing-methods/).</span></span>
>
> <span data-ttu-id="4f348-452">Nessa estrutura, se você estiver usando nomes DNS personalizados para sites, você deve configurar o registro CNAME apropriado para que cada site aponte para o nome DNS do site do Gerenciador de Tráfego do Azure.</span><span class="sxs-lookup"><span data-stu-id="4f348-452">In this structure, if you are using custom DNS names for your web sites, you should configure the appropriate CNAME record for each web site to point to the DNS name of the Azure Traffic Manager web site.</span></span>
>

## <a name="support-developers-building-client-applications"></a><span data-ttu-id="4f348-453">Oferecer suporte a desenvolvedores que compilam aplicativos cliente</span><span class="sxs-lookup"><span data-stu-id="4f348-453">Support developers building client applications</span></span>
<span data-ttu-id="4f348-454">Os desenvolvedores construindo aplicativos cliente normalmente exigem informações sobre como acessar a API da Web e documentação sobre os parâmetros, tipos de dados, tipos de retorno e códigos de retorno que descrevem as diferentes solicitações e respostas entre o serviço Web e o aplicativo cliente.</span><span class="sxs-lookup"><span data-stu-id="4f348-454">Developers constructing client applications typically require information on how to access the web API, and documentation concerning the parameters, data types, return types, and return codes that describe the different requests and responses between the web service and the client application.</span></span>

### <a name="document-the-rest-operations-for-a-web-api"></a><span data-ttu-id="4f348-455">Documentar as operações REST de uma API da Web</span><span class="sxs-lookup"><span data-stu-id="4f348-455">Document the REST operations for a web API</span></span>
<span data-ttu-id="4f348-456">O Serviço de Gerenciamento de API do Azure inclui um portal do desenvolvedor que descreve as operações REST expostas por uma API da Web.</span><span class="sxs-lookup"><span data-stu-id="4f348-456">The Azure API Management Service includes a developer portal that describes the REST operations exposed by a web API.</span></span> <span data-ttu-id="4f348-457">Se um produto já foi publicado, ele é exibido nesse portal.</span><span class="sxs-lookup"><span data-stu-id="4f348-457">When a product has been published it appears on this portal.</span></span> <span data-ttu-id="4f348-458">Os desenvolvedores podem usar esse portal para inscrever-se para obter acesso; o administrador pode aprovar ou negar a solicitação.</span><span class="sxs-lookup"><span data-stu-id="4f348-458">Developers can use this portal to sign up for access; the administrator can then approve or deny the request.</span></span> <span data-ttu-id="4f348-459">Se o desenvolvedor for aprovado, ele recebe uma chave de assinatura que é usada para autenticar as chamadas dos aplicativos cliente que ele desenvolve.</span><span class="sxs-lookup"><span data-stu-id="4f348-459">If the developer is approved, they are assigned a subscription key that is used to authenticate calls from the client applications that they develop.</span></span> <span data-ttu-id="4f348-460">Essa chave deve ser fornecida com cada chamada à API da Web; caso contrário, essa chamada será rejeitada.</span><span class="sxs-lookup"><span data-stu-id="4f348-460">This key must be provided with each web API call otherwise it will be rejected.</span></span>

<span data-ttu-id="4f348-461">Esse portal também fornece:</span><span class="sxs-lookup"><span data-stu-id="4f348-461">This portal also provides:</span></span>

* <span data-ttu-id="4f348-462">Documentação do produto, listando as operações que ele expõe, os parâmetros necessários e as diferentes respostas que podem ser retornadas.</span><span class="sxs-lookup"><span data-stu-id="4f348-462">Documentation for the product, listing the operations that it exposes, the parameters required, and the different responses that can be returned.</span></span> <span data-ttu-id="4f348-463">Observe que essas informações são geradas de detalhes fornecidos na etapa 3 da lista na seção Publicando uma API da Web usando o Serviço de Gerenciamento de API do Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="4f348-463">Note that this information is generated from the details provided in step 3 in the list in the Publishing a web API by using the Microsoft Azure API Management Service section.</span></span>
* <span data-ttu-id="4f348-464">Trechos de código que mostram como invocar operações em várias linguagens, inclusive JavaScript, C#, Java, Ruby, Python e PHP.</span><span class="sxs-lookup"><span data-stu-id="4f348-464">Code snippets that show how to invoke operations from several languages, including JavaScript, C#, Java, Ruby, Python, and PHP.</span></span>
* <span data-ttu-id="4f348-465">Um console do desenvolvedor, que permite que um desenvolvedor envie uma solicitação HTTP para testar cada operação no produto e visualize os resultados.</span><span class="sxs-lookup"><span data-stu-id="4f348-465">A developers' console that enables a developer to send an HTTP request to test each operation in the product and view the results.</span></span>
* <span data-ttu-id="4f348-466">Uma página em que o desenvolvedor pode relatar quaisquer questões ou problemas encontrados.</span><span class="sxs-lookup"><span data-stu-id="4f348-466">A page where the developer can report any issues or problems found.</span></span>

<span data-ttu-id="4f348-467">O Portal de Gerenciamento do Azure permite que você personalize o portal do desenvolvedor para alterar o estilo e o layout, de modo que correspondam à identidade visual da sua organização.</span><span class="sxs-lookup"><span data-stu-id="4f348-467">The Azure Management portal enables you to customize the developer portal to change the styling and layout to match the branding of your organization.</span></span>

### <a name="implement-a-client-sdk"></a><span data-ttu-id="4f348-468">Implementar um SDK de cliente</span><span class="sxs-lookup"><span data-stu-id="4f348-468">Implement a client SDK</span></span>
<span data-ttu-id="4f348-469">Criar um aplicativo cliente que chama solicitações REST para acessar uma API da Web requer a criação de uma quantidade significativa de código para construir cada solicitação e formatá-la adequadamente, enviar a solicitação ao servidor que hospeda o serviço Web e analisar a resposta para descobrir se a solicitação foi bem-sucedida ou falhou, além de extrair os dados retornados.</span><span class="sxs-lookup"><span data-stu-id="4f348-469">Building a client application that invokes REST requests to access a web API requires writing a significant amount of code to construct each request and format it appropriately, send the request to the server hosting the web service, and parse the response to work out whether the request succeeded or failed and extract any data returned.</span></span> <span data-ttu-id="4f348-470">Para isolar o aplicativo cliente dessas preocupações, você pode fornecer um SDK que encapsula a interface REST e abstrai esses detalhes de baixo nível dentro de um conjunto de métodos mais funcional.</span><span class="sxs-lookup"><span data-stu-id="4f348-470">To insulate the client application from these concerns, you can provide an SDK that wraps the REST interface and abstracts these low-level details inside a more functional set of methods.</span></span> <span data-ttu-id="4f348-471">Um aplicativo cliente usa esses métodos, os quais convertem transparentemente chamadas em solicitações REST e, em seguida, convertem as respostas de volta em valores de retorno do método.</span><span class="sxs-lookup"><span data-stu-id="4f348-471">A client application uses these methods, which transparently convert calls into REST requests and then convert the responses back into method return values.</span></span> <span data-ttu-id="4f348-472">Essa é uma técnica comum implementada por muitos serviços, incluindo o SDK do Azure.</span><span class="sxs-lookup"><span data-stu-id="4f348-472">This is a common technique that is implemented by many services, including the Azure SDK.</span></span>

<span data-ttu-id="4f348-473">Criar um SDK no lado do cliente é uma tarefa considerável, já que ele precisa ser implementado de modo consistente e testado com cuidado.</span><span class="sxs-lookup"><span data-stu-id="4f348-473">Creating a client-side SDK is a considerable undertaking as it has to be implemented consistently and tested carefully.</span></span> <span data-ttu-id="4f348-474">No entanto, grande parte desse processo pode ser tornado mecânico, e muitos fornecedores oferecem ferramentas que podem automatizar muitas dessas tarefas.</span><span class="sxs-lookup"><span data-stu-id="4f348-474">However, much of this process can be made mechanical, and many vendors supply tools that can automate many of these tasks.</span></span>

## <a name="monitoring-a-web-api"></a><span data-ttu-id="4f348-475">Monitoramento de uma API da Web</span><span class="sxs-lookup"><span data-stu-id="4f348-475">Monitoring a web API</span></span>
<span data-ttu-id="4f348-476">Dependendo de como você publicou e implantou a API da Web, você pode monitorá-la diretamente, ou então coletar informações de uso e integridade analisando o tráfego que passa pelo Serviço de Gerenciamento de API.</span><span class="sxs-lookup"><span data-stu-id="4f348-476">Depending on how you have published and deployed your web API you can monitor the web API directly, or you can gather usage and health information by analyzing the traffic that passes through the API Management service.</span></span>

### <a name="monitoring-a-web-api-directly"></a><span data-ttu-id="4f348-477">Monitorando uma API da Web diretamente</span><span class="sxs-lookup"><span data-stu-id="4f348-477">Monitoring a web API directly</span></span>
<span data-ttu-id="4f348-478">Se você tiver implementado sua API da Web usando o modelo de API Web ASP.NET (seja como um projeto de API da Web, ou como uma função web em um serviço de nuvem do Azure) e o Visual Studio 2013, você pode coletar dados de uso, desempenho e disponibilidade por meio do Application Insights para ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="4f348-478">If you have implemented your web API by using the ASP.NET Web API template (either as a Web API project or as a Web role in an Azure cloud service) and Visual Studio 2013, you can gather availability, performance, and usage data by using ASP.NET Application Insights.</span></span> <span data-ttu-id="4f348-479">O Application Insights é um pacote que rastreia e registra de modo transparente as informações sobre solicitações e respostas quando a API da Web é implantada na nuvem; uma vez que o pacote está instalado e configurado, você não precisa modificar nenhum código em sua API da Web para usá-la.</span><span class="sxs-lookup"><span data-stu-id="4f348-479">Application Insights is a package that transparently tracks and records information about requests and responses when the web API is deployed to the cloud; once the package is installed and configured, you don't need to amend any code in your web API to use it.</span></span> <span data-ttu-id="4f348-480">Quando você implanta a API da Web em um site do Azure, todo o tráfego é examinado e as estatísticas a seguir são coletadas:</span><span class="sxs-lookup"><span data-stu-id="4f348-480">When you deploy the web API to an Azure web site, all traffic is examined and the following statistics are gathered:</span></span>

* <span data-ttu-id="4f348-481">Tempo de resposta do servidor.</span><span class="sxs-lookup"><span data-stu-id="4f348-481">Server response time.</span></span>
* <span data-ttu-id="4f348-482">Número de solicitações do servidor e os detalhes de cada solicitação.</span><span class="sxs-lookup"><span data-stu-id="4f348-482">Number of server requests and the details of each request.</span></span>
* <span data-ttu-id="4f348-483">As solicitações mais lentas em termos de tempo médio de resposta.</span><span class="sxs-lookup"><span data-stu-id="4f348-483">The top slowest requests in terms of average response time.</span></span>
* <span data-ttu-id="4f348-484">Os detalhes de quaisquer eventuais solicitações com falha.</span><span class="sxs-lookup"><span data-stu-id="4f348-484">The details of any failed requests.</span></span>
* <span data-ttu-id="4f348-485">O número de sessões iniciadas por agentes de usuário e navegadores diferentes.</span><span class="sxs-lookup"><span data-stu-id="4f348-485">The number of sessions initiated by different browsers and user agents.</span></span>
* <span data-ttu-id="4f348-486">As páginas exibidas mais frequentemente (útil principalmente para aplicativos da Web em vez de APIs Web).</span><span class="sxs-lookup"><span data-stu-id="4f348-486">The most frequently viewed pages (primarily useful for web applications rather than web APIs).</span></span>
* <span data-ttu-id="4f348-487">As diferentes funções de usuário ao acessar a API da Web.</span><span class="sxs-lookup"><span data-stu-id="4f348-487">The different user roles accessing the web API.</span></span>

<span data-ttu-id="4f348-488">Você pode exibir esses dados em tempo real no Portal de Gerenciamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="4f348-488">You can view this data in real time from the Azure Management portal.</span></span> <span data-ttu-id="4f348-489">Você também pode criar webtests que monitorem a integridade da API da Web.</span><span class="sxs-lookup"><span data-stu-id="4f348-489">You can also create webtests that monitor the health of the web API.</span></span> <span data-ttu-id="4f348-490">Um webtest envia uma solicitação periódica para um URI especificado no API da Web e captura a resposta.</span><span class="sxs-lookup"><span data-stu-id="4f348-490">A webtest sends a periodic request to a specified URI in the web API and captures the response.</span></span> <span data-ttu-id="4f348-491">Você pode especificar a definição de uma resposta bem-sucedida (como o código de status HTTP 200) e, se a solicitação não retornar essa resposta, você pode fazer com que um alerta seja enviado ao administrador.</span><span class="sxs-lookup"><span data-stu-id="4f348-491">You can specify the definition of a successful response (such as HTTP status code 200), and if the request does not return this response you can arrange for an alert to be sent to an administrator.</span></span> <span data-ttu-id="4f348-492">Se necessário, o administrador pode reiniciar o servidor que hospeda a API da Web caso ele tenha falhado.</span><span class="sxs-lookup"><span data-stu-id="4f348-492">If necessary, the administrator can restart the server hosting the web API if it has failed.</span></span>

<span data-ttu-id="4f348-493">Para obter mais informações, confira [Application Insights - Introdução ao ASP.NET](/azure/application-insights/app-insights-asp-net/).</span><span class="sxs-lookup"><span data-stu-id="4f348-493">For more information, see [Application Insights - Get started with ASP.NET](/azure/application-insights/app-insights-asp-net/).</span></span>

### <a name="monitoring-a-web-api-through-the-api-management-service"></a><span data-ttu-id="4f348-494">Monitoramento de uma API da Web por meio do Serviço de Gerenciamento de API</span><span class="sxs-lookup"><span data-stu-id="4f348-494">Monitoring a web API through the API Management Service</span></span>
<span data-ttu-id="4f348-495">Se você publicou sua API da Web usando o Serviço de Gerenciamento de API, a página Gerenciamento de API no Portal de Gerenciamento do Azure contém um painel que permite visualizar o desempenho geral do serviço.</span><span class="sxs-lookup"><span data-stu-id="4f348-495">If you have published your web API by using the API Management service, the API Management page on the Azure Management portal contains a dashboard that enables you to view the overall performance of the service.</span></span> <span data-ttu-id="4f348-496">A página Análise permite aprofundar-se nos detalhes de como o produto está sendo usado.</span><span class="sxs-lookup"><span data-stu-id="4f348-496">The Analytics page enables you to drill down into the details of how the product is being used.</span></span> <span data-ttu-id="4f348-497">Essa página contém as seguintes guias:</span><span class="sxs-lookup"><span data-stu-id="4f348-497">This page contains the following tabs:</span></span>

* <span data-ttu-id="4f348-498">**Uso**.</span><span class="sxs-lookup"><span data-stu-id="4f348-498">**Usage**.</span></span> <span data-ttu-id="4f348-499">Essa guia fornece informações sobre o número de chamadas de API feitas e a largura de banda usada para lidar com essas chamadas ao longo do tempo.</span><span class="sxs-lookup"><span data-stu-id="4f348-499">This tab provides information about the number of API calls made and the bandwidth used to handle these calls over time.</span></span> <span data-ttu-id="4f348-500">Você pode filtrar os detalhes de uso por produto, API e operação.</span><span class="sxs-lookup"><span data-stu-id="4f348-500">You can filter usage details by product, API, and operation.</span></span>
* <span data-ttu-id="4f348-501">**Integridade**.</span><span class="sxs-lookup"><span data-stu-id="4f348-501">**Health**.</span></span> <span data-ttu-id="4f348-502">Essa guia permite que você visualize o resultado de solicitações de API (os códigos de status HTTP retornados), a eficácia da política de cache, o tempo de resposta de API e o tempo de resposta do serviço.</span><span class="sxs-lookup"><span data-stu-id="4f348-502">This tab enables you to view the outcome of API requests (the HTTP status codes returned), the effectiveness of the caching policy, the API response time, and the service response time.</span></span> <span data-ttu-id="4f348-503">Novamente, você pode filtrar os detalhes de integridade por produto, API e operação.</span><span class="sxs-lookup"><span data-stu-id="4f348-503">Again, you can filter health data by product, API, and operation.</span></span>
* <span data-ttu-id="4f348-504">**Atividade**.</span><span class="sxs-lookup"><span data-stu-id="4f348-504">**Activity**.</span></span> <span data-ttu-id="4f348-505">Essa guia fornece um resumo de texto dos números de chamadas bem-sucedidas, chamadas com falha, chamadas bloqueadas, tempo médio de resposta e tempos de resposta para cada produto, API da Web e operação.</span><span class="sxs-lookup"><span data-stu-id="4f348-505">This tab provides a text summary of the numbers of successful calls, failed calls, blocked calls, average response time, and response times for each product, web API, and operation.</span></span> <span data-ttu-id="4f348-506">Esta página também lista o número de chamadas feitas por cada desenvolvedor.</span><span class="sxs-lookup"><span data-stu-id="4f348-506">This page also lists the number of calls made by each developer.</span></span>
* <span data-ttu-id="4f348-507">**Visão rápida**.</span><span class="sxs-lookup"><span data-stu-id="4f348-507">**At a glance**.</span></span> <span data-ttu-id="4f348-508">Essa guia exibe um resumo dos dados de desempenho, incluindo os desenvolvedores responsáveis por fazer a maioria das chamadas de API, além dos produtos, APIs da Web e operações que receberam essas chamadas.</span><span class="sxs-lookup"><span data-stu-id="4f348-508">This tab displays a summary of the performance data, including the developers responsible for making the most API calls, and the products, web APIs, and operations that received these calls.</span></span>

<span data-ttu-id="4f348-509">Você pode usar essas informações para determinar se uma operação ou API da Web específica está agindo como um gargalo e, se necessário, dimensionar o ambiente de host e adicionar mais servidores.</span><span class="sxs-lookup"><span data-stu-id="4f348-509">You can use this information to determine whether a particular web API or operation is causing a bottleneck, and if necessary scale the host environment and add more servers.</span></span> <span data-ttu-id="4f348-510">Você também pode verificar se um ou mais aplicativos estão usando um volume desproporcional de recursos e aplicam as políticas adequadas para definir cotas e limitar as taxas de chamada.</span><span class="sxs-lookup"><span data-stu-id="4f348-510">You can also ascertain whether one or more applications are using a disproportionate volume of resources and apply the appropriate policies to set quotas and limit call rates.</span></span>

> [!NOTE]
> <span data-ttu-id="4f348-511">Você pode alterar os detalhes de um produto publicado, as alterações serão aplicadas imediatamente.</span><span class="sxs-lookup"><span data-stu-id="4f348-511">You can change the details for a published product, and the changes are applied immediately.</span></span> <span data-ttu-id="4f348-512">Por exemplo, você pode adicionar ou remover uma operação de uma API da Web sem precisar publicar novamente o produto que contém essa API.</span><span class="sxs-lookup"><span data-stu-id="4f348-512">For example, you can add or remove an operation from a web API without requiring that you republish the product that contains the web API.</span></span>
>
>

## <a name="more-information"></a><span data-ttu-id="4f348-513">Mais informações</span><span class="sxs-lookup"><span data-stu-id="4f348-513">More information</span></span>
* <span data-ttu-id="4f348-514">[OData para API Web ASP.NET](http://www.asp.net/web-api/overview/odata-support-in-aspnet-web-api): contém exemplos e mais informações sobre como implementar uma API da Web com protocolo OData usando o ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="4f348-514">[ASP.NET Web API OData](http://www.asp.net/web-api/overview/odata-support-in-aspnet-web-api) contains examples and further information on implementing an OData web API by using ASP.NET.</span></span>
* <span data-ttu-id="4f348-515">[Apresentando o suporte a lotes na API da Web e OData para API da Web](http://blogs.msdn.com/b/webdev/archive/2013/11/01/introducing-batch-support-in-web-api-and-web-api-odata.aspx): descreve como implementar operações em lote em uma API da Web usando o protocolo OData.</span><span class="sxs-lookup"><span data-stu-id="4f348-515">[Introducing Batch Support in Web API and Web API OData](http://blogs.msdn.com/b/webdev/archive/2013/11/01/introducing-batch-support-in-web-api-and-web-api-odata.aspx) describes how to implement batch operations in a web API by using OData.</span></span>
* <span data-ttu-id="4f348-516">[Padrões de idempotência](http://blog.jonathanoliver.com/idempotency-patterns/), no blog de Jonathan Oliver: fornece uma visão geral de idempotência e de como ela se relaciona às operações de gerenciamento de dados.</span><span class="sxs-lookup"><span data-stu-id="4f348-516">[Idempotency Patterns](http://blog.jonathanoliver.com/idempotency-patterns/) on Jonathan Oliver’s blog provides an overview of idempotency and how it relates to data management operations.</span></span>
* <span data-ttu-id="4f348-517">[Definições de Código de Status](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html), no site do W3C: contém uma lista completa dos códigos de status HTTP e suas descrições.</span><span class="sxs-lookup"><span data-stu-id="4f348-517">[Status Code Definitions](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html) on the W3C website contains a full list of HTTP status codes and their descriptions.</span></span>
* <span data-ttu-id="4f348-518">[Executar tarefas em segundo plano com WebJobs](/azure/app-service-web/web-sites-create-web-jobs/): fornece informações e exemplos sobre como usar os WebJobs para realizar operações em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="4f348-518">[Run background tasks with WebJobs](/azure/app-service-web/web-sites-create-web-jobs/) provides information and examples on using WebJobs to perform background operations.</span></span>
* <span data-ttu-id="4f348-519">[Notificação de usuários nos Hubs de Notificação do Azure](/azure/notification-hubs/notification-hubs-aspnet-backend-windows-dotnet-wns-notification/): mostra como usar um Hub de notificação do Azure para enviar respostas assíncronas a aplicativos cliente.</span><span class="sxs-lookup"><span data-stu-id="4f348-519">[Azure Notification Hubs Notify Users](/azure/notification-hubs/notification-hubs-aspnet-backend-windows-dotnet-wns-notification/) shows how to use an Azure Notification Hub to push asynchronous responses to client applications.</span></span>
* <span data-ttu-id="4f348-520">[Gerenciamento de API](https://azure.microsoft.com/services/api-management/): descreve como publicar um produto que fornece acesso controlado e seguro a uma API da Web.</span><span class="sxs-lookup"><span data-stu-id="4f348-520">[API Management](https://azure.microsoft.com/services/api-management/) describes how to publish a product that provides controlled and secure access to a web API.</span></span>
* <span data-ttu-id="4f348-521">[Referência de API REST de Gerenciamento de API do Azure](https://msdn.microsoft.com/library/azure/dn776326.aspx): descreve como usar a API REST de Gerenciamento de API para criar aplicativos de gerenciamento personalizados.</span><span class="sxs-lookup"><span data-stu-id="4f348-521">[Azure API Management REST API Reference](https://msdn.microsoft.com/library/azure/dn776326.aspx) describes how to use the API Management REST API to build custom management applications.</span></span>
* <span data-ttu-id="4f348-522">[Métodos de roteamento do Gerenciador de Tráfego](/azure/traffic-manager/traffic-manager-routing-methods/): resume como o Gerenciador de Tráfego do Azure pode ser usado para realizar o balanceamento de carga de solicitações entre várias instâncias de um site que hospeda uma API da Web.</span><span class="sxs-lookup"><span data-stu-id="4f348-522">[Traffic Manager Routing Methods](/azure/traffic-manager/traffic-manager-routing-methods/) summarizes how Azure Traffic Manager can be used to load-balance requests across multiple instances of a website hosting a web API.</span></span>
* <span data-ttu-id="4f348-523">[Application Insights - introdução ao ASP. NET](/azure/application-insights/app-insights-asp-net/): fornece informações detalhadas sobre como instalar e configurar o Application Insights em um projeto de API Web ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="4f348-523">[Application Insights - Get started with ASP.NET](/azure/application-insights/app-insights-asp-net/) provides detailed information on installing and configuring Application Insights in an ASP.NET Web API project.</span></span>


<!-- links -->

[api-design]: ./api-design.md
