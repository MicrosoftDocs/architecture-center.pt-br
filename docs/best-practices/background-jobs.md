---
title: Diretrizes de trabalhos em segundo plano
description: Diretrizes sobre as tarefas em segundo plano executadas independentemente da interface do usuário.
author: dragon119
ms.date: 05/24/2017
pnp.series.title: Best Practices
ms.openlocfilehash: fa5c6352da289591d92b9427c44b8ba9f01245aa
ms.sourcegitcommit: 94d50043db63416c4d00cebe927a0c88f78c3219
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/28/2018
ms.locfileid: "47429614"
---
# <a name="background-jobs"></a><span data-ttu-id="e9c7e-103">Trabalhos em segundo plano</span><span class="sxs-lookup"><span data-stu-id="e9c7e-103">Background jobs</span></span>
[!INCLUDE [header](../_includes/header.md)]

<span data-ttu-id="e9c7e-104">Muitos tipos de aplicativos requerem tarefas em segundo plano executadas independentemente da interface do usuário (IU).</span><span class="sxs-lookup"><span data-stu-id="e9c7e-104">Many types of applications require background tasks that run independently of the user interface (UI).</span></span> <span data-ttu-id="e9c7e-105">Os exemplos incluem trabalhos em lotes, tarefas com uso intensivo de processamento e processos de longa duração, como fluxos de trabalho.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-105">Examples include batch jobs, intensive processing tasks, and long-running processes such as workflows.</span></span> <span data-ttu-id="e9c7e-106">Os trabalhos em segundo plano podem ser executados sem a necessidade de interação do usuário; o aplicativo pode iniciar o trabalho e continuar processando solicitações interativas de usuários.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-106">Background jobs can be executed without requiring user interaction--the application can start the job and then continue to process interactive requests from users.</span></span> <span data-ttu-id="e9c7e-107">Isso pode ajudar a reduzir a carga na interface do usuário do aplicativo, que pode melhorar a disponibilidade e reduzir os tempos de resposta interativa.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-107">This can help to minimize the load on the application UI, which can improve availability and reduce interactive response times.</span></span>

<span data-ttu-id="e9c7e-108">Por exemplo, se for necessário que um aplicativo gere miniaturas de imagens carregadas por usuários, ele poderá fazer isso como um trabalho em segundo plano e salvar a miniatura no armazenamento quando ela for concluída, sem que o usuário precise aguardar a conclusão do processo.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-108">For example, if an application is required to generate thumbnails of images that are uploaded by users, it can do this as a background job and save the thumbnail to storage when it is complete--without the user needing to wait for the process to be completed.</span></span> <span data-ttu-id="e9c7e-109">Da mesma forma, um usuário fazendo um pedido pode iniciar um fluxo de trabalho em segundo plano que processa o pedido, enquanto a interface do usuário permite que o usuário continue a navegação no aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-109">In the same way, a user placing an order can initiate a background workflow that processes the order, while the UI allows the user to continue browsing the web app.</span></span> <span data-ttu-id="e9c7e-110">Quando o trabalho em segundo plano for concluído, ele poderá atualizar os dados de pedidos armazenados e enviar um email para o usuário confirmando o pedido.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-110">When the background job is complete, it can update the stored orders data and send an email to the user that confirms the order.</span></span>

<span data-ttu-id="e9c7e-111">Ao considerar se deve implementar uma tarefa como trabalho em segundo plano, o critério principal é se a tarefa pode ser executada sem interação do usuário e sem que a interface do usuário precise aguardar a conclusão desse trabalho.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-111">When you consider whether to implement a task as a background job, the main criteria is whether the task can run without user interaction and without the UI needing to wait for the job to be completed.</span></span> <span data-ttu-id="e9c7e-112">Tarefas que exigem que o usuário ou a interface do usuário aguardem enquanto são concluídas podem não ser apropriadas como trabalhos em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-112">Tasks that require the user or the UI to wait while they are completed might not be appropriate as background jobs.</span></span>

## <a name="types-of-background-jobs"></a><span data-ttu-id="e9c7e-113">Tipos de trabalhos em segundo plano</span><span class="sxs-lookup"><span data-stu-id="e9c7e-113">Types of background jobs</span></span>
<span data-ttu-id="e9c7e-114">Os trabalhos em segundo plano normalmente incluem um ou mais dos seguintes tipos de trabalho:</span><span class="sxs-lookup"><span data-stu-id="e9c7e-114">Background jobs typically include one or more of the following types of jobs:</span></span>

* <span data-ttu-id="e9c7e-115">Trabalhos com uso intensivo de CPU, como cálculos matemáticos ou análises de modelo estrutural.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-115">CPU-intensive jobs, such as mathematical calculations or structural model analysis.</span></span>
* <span data-ttu-id="e9c7e-116">Trabalhos com uso intensivo de E/S, como a execução de uma série de transações de armazenamento ou a indexação de arquivos.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-116">I/O-intensive jobs, such as executing a series of storage transactions or indexing files.</span></span>
* <span data-ttu-id="e9c7e-117">Trabalhos em lote, como atualizações de dados que são feitas todas as noites ou processamentos agendados.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-117">Batch jobs, such as nightly data updates or scheduled processing.</span></span>
* <span data-ttu-id="e9c7e-118">Fluxos de trabalho de longa duração, como o atendimento de pedidos ou o provisionamento de serviços e sistemas.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-118">Long-running workflows, such as order fulfillment, or provisioning services and systems.</span></span>
* <span data-ttu-id="e9c7e-119">Processamento de dados confidenciais em que a tarefa é transferida para um local mais seguro para processamento.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-119">Sensitive-data processing where the task is handed off to a more secure location for processing.</span></span> <span data-ttu-id="e9c7e-120">Por exemplo, não convém processar dados confidenciais em um aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-120">For example, you might not want to process sensitive data within a web app.</span></span> <span data-ttu-id="e9c7e-121">Em vez disso, você pode usar um padrão como o [Gatekeeper](https://msdn.microsoft.com/library/dn589793.aspx) para transferir os dados para um processo em segundo plano isolado que tenha acesso a armazenamento protegido.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-121">Instead, you might use a pattern such as [Gatekeeper](https://msdn.microsoft.com/library/dn589793.aspx) to transfer the data to an isolated background process that has access to protected storage.</span></span>

## <a name="triggers"></a><span data-ttu-id="e9c7e-122">Gatilhos</span><span class="sxs-lookup"><span data-stu-id="e9c7e-122">Triggers</span></span>
<span data-ttu-id="e9c7e-123">Os trabalhos em segundo plano podem ser iniciados de diversas maneiras.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-123">Background jobs can be initiated in several different ways.</span></span> <span data-ttu-id="e9c7e-124">Eles se encaixam em uma destas categorias:</span><span class="sxs-lookup"><span data-stu-id="e9c7e-124">They fall into one of the following categories:</span></span>

* <span data-ttu-id="e9c7e-125">[**Gatilhos acionados por eventos**](#event-driven-triggers).</span><span class="sxs-lookup"><span data-stu-id="e9c7e-125">[**Event-driven triggers**](#event-driven-triggers).</span></span> <span data-ttu-id="e9c7e-126">A tarefa é iniciada em resposta a um evento, normalmente uma ação executada por um usuário ou uma etapa em um fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-126">The task is started in response to an event, typically an action taken by a user or a step in a workflow.</span></span>
* <span data-ttu-id="e9c7e-127">[**Gatilhos acionados por agendamentos**](#schedule-driven-triggers).</span><span class="sxs-lookup"><span data-stu-id="e9c7e-127">[**Schedule-driven triggers**](#schedule-driven-triggers).</span></span> <span data-ttu-id="e9c7e-128">A tarefa é invocada em um agendamento com base em um temporizador.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-128">The task is invoked on a schedule based on a timer.</span></span> <span data-ttu-id="e9c7e-129">Pode de tratar de um agendamento recorrente ou de uma invocação única especificada para um momento posterior.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-129">This might be a recurring schedule or a one-off invocation that is specified for a later time.</span></span>

### <a name="event-driven-triggers"></a><span data-ttu-id="e9c7e-130">Gatilhos acionados por eventos</span><span class="sxs-lookup"><span data-stu-id="e9c7e-130">Event-driven triggers</span></span>
<span data-ttu-id="e9c7e-131">A invocação acionada por evento usa um gatilho para iniciar a tarefa em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-131">Event-driven invocation uses a trigger to start the background task.</span></span> <span data-ttu-id="e9c7e-132">Exemplos de uso de gatilhos acionados por eventos incluem:</span><span class="sxs-lookup"><span data-stu-id="e9c7e-132">Examples of using event-driven triggers include:</span></span>

* <span data-ttu-id="e9c7e-133">A interface do usuário ou outro trabalho coloca uma mensagem em uma fila.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-133">The UI or another job places a message in a queue.</span></span> <span data-ttu-id="e9c7e-134">A mensagem contém dados sobre uma ação que tenha ocorrido, como o usuário fazer um pedido.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-134">The message contains data about an action that has taken place, such as the user placing an order.</span></span> <span data-ttu-id="e9c7e-135">A tarefa em segundo plano escuta nessa fila e detecta a chegada de uma nova mensagem.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-135">The background task listens on this queue and detects the arrival of a new message.</span></span> <span data-ttu-id="e9c7e-136">Ela lê a mensagem e usa os dados contidos nela como a entrada para o trabalho em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-136">It reads the message and uses the data in it as the input to the background job.</span></span>
* <span data-ttu-id="e9c7e-137">A interface do usuário ou outro trabalho salva ou atualiza um valor no armazenamento.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-137">The UI or another job saves or updates a value in storage.</span></span> <span data-ttu-id="e9c7e-138">A tarefa em segundo plano monitora o armazenamento e detecta alterações.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-138">The background task monitors the storage and detects changes.</span></span> <span data-ttu-id="e9c7e-139">Ela lê os dados e os utiliza como entrada para o trabalho em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-139">It reads the data and uses it as the input to the background job.</span></span>
* <span data-ttu-id="e9c7e-140">A interface do usuário ou outro trabalho faz uma solicitação a um ponto de extremidade, como um URI HTTPS, ou a uma API exposta como um serviço Web.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-140">The UI or another job makes a request to an endpoint, such as an HTTPS URI, or an API that is exposed as a web service.</span></span> <span data-ttu-id="e9c7e-141">Ela passa os dados necessários para concluir a tarefa em segundo plano como parte da solicitação.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-141">It passes the data that is required to complete the background task as part of the request.</span></span> <span data-ttu-id="e9c7e-142">O ponto de extremidade ou serviço Web invoca a tarefa em segundo plano, que usa os dados como entrada.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-142">The endpoint or web service invokes the background task, which uses the data as its input.</span></span>

<span data-ttu-id="e9c7e-143">Exemplos comuns de tarefas que são adequadas a invocações acionadas por evento incluem processamento de imagem, fluxos de trabalho, envio de informações para serviços remotos, envio de mensagens de email e provisionamento de novos usuários em aplicativos multilocatário.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-143">Typical examples of tasks that are suited to event-driven invocation include image processing, workflows, sending information to remote services, sending email messages, and provisioning new users in multitenant applications.</span></span>

### <a name="schedule-driven-triggers"></a><span data-ttu-id="e9c7e-144">Gatilhos acionados por agendamentos</span><span class="sxs-lookup"><span data-stu-id="e9c7e-144">Schedule-driven triggers</span></span>
<span data-ttu-id="e9c7e-145">A invocação acionada por agendamento usa um temporizador para iniciar a tarefa em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-145">Schedule-driven invocation uses a timer to start the background task.</span></span> <span data-ttu-id="e9c7e-146">Exemplos de uso de gatilhos acionados por agendamento incluem:</span><span class="sxs-lookup"><span data-stu-id="e9c7e-146">Examples of using schedule-driven triggers include:</span></span>

* <span data-ttu-id="e9c7e-147">Um temporizador que está em execução localmente no aplicativo ou como parte do sistema operacional do aplicativo e que invoca uma tarefa em segundo plano regularmente.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-147">A timer that is running locally within the application or as part of the application’s operating system invokes a background task on a regular basis.</span></span>
* <span data-ttu-id="e9c7e-148">Um temporizador que está em execução em um aplicativo diferente ou um serviço de temporizador como o Agendador do Azure envia uma solicitação para um serviço Web ou API regularmente.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-148">A timer that is running in a different application, or a timer service such as Azure Scheduler, sends a request to an API or web service on a regular basis.</span></span> <span data-ttu-id="e9c7e-149">O serviço Web ou API chama a tarefa em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-149">The API or web service invokes the background task.</span></span>
* <span data-ttu-id="e9c7e-150">Um processo separado ou aplicativo inicia um temporizador que faz com que a tarefa em segundo plano seja invocada após um atraso especificado ou em um momento específico.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-150">A separate process or application starts a timer that causes the background task to be invoked once after a specified time delay, or at a specific time.</span></span>

<span data-ttu-id="e9c7e-151">Exemplos comuns de tarefas que são adequadas para invocação acionada por agendamento incluem rotinas de processamento em lote (como atualização de listas de produtos relacionados para usuários com base no comportamento recente), tarefas rotineiras de processamento de dados (como atualização de índices ou geração de resultados acumulados), análise de dados para relatórios diários, limpeza de retenção de dados e verificação de consistência de dados.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-151">Typical examples of tasks that are suited to schedule-driven invocation include batch-processing routines (such as updating related-products lists for users based on their recent behavior), routine data processing tasks (such as updating indexes or generating accumulated results), data analysis for daily reports, data retention cleanup, and data consistency checks.</span></span>

<span data-ttu-id="e9c7e-152">Se você usar uma tarefa acionada por agendamento que precisa ser executada como uma única instância, lembre-se do seguinte:</span><span class="sxs-lookup"><span data-stu-id="e9c7e-152">If you use a schedule-driven task that must run as a single instance, be aware of the following:</span></span>

* <span data-ttu-id="e9c7e-153">se a instância de computação que está executando o agendador (como uma máquina virtual que usa tarefas agendadas do Windows) for dimensionada, você terá várias instâncias do agendador em execução.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-153">If the compute instance that is running the scheduler (such as a virtual machine using Windows scheduled tasks) is scaled, you will have multiple instances of the scheduler running.</span></span> <span data-ttu-id="e9c7e-154">Elas poderiam iniciar várias instâncias da tarefa.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-154">These could start multiple instances of the task.</span></span>
* <span data-ttu-id="e9c7e-155">Se as tarefas forem executadas por mais tempo que o período entre os eventos do Agendador, o Agendador pode iniciar outra instância da tarefa enquanto a anterior ainda está em execução.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-155">If tasks run for longer than the period between scheduler events, the scheduler may start another instance of the task while the previous one is still running.</span></span>

## <a name="returning-results"></a><span data-ttu-id="e9c7e-156">Retornando os resultados</span><span class="sxs-lookup"><span data-stu-id="e9c7e-156">Returning results</span></span>
<span data-ttu-id="e9c7e-157">Os trabalhos em segundo plano são executados de forma assíncrona em um processo separado, ou até mesmo em um local separado, da interface do usuário ou do processo que invocou a tarefa em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-157">Background jobs execute asynchronously in a separate process, or even in a separate location, from the UI or the process that invoked the background task.</span></span> <span data-ttu-id="e9c7e-158">Em um cenário ideal, as tarefas em segundo plano são operações para "disparar e esquecer", e o seu progresso de execução não tem impacto sobre a interface do usuário ou o processo de chamada.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-158">Ideally, background tasks are “fire and forget” operations, and their execution progress has no impact on the UI or the calling process.</span></span> <span data-ttu-id="e9c7e-159">Isso significa que o processo de chamada não aguarda a conclusão das tarefas.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-159">This means that the calling process does not wait for completion of the tasks.</span></span> <span data-ttu-id="e9c7e-160">Portanto, ele não detecta automaticamente quando a tarefa termina.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-160">Therefore, it cannot automatically detect when the task ends.</span></span>

<span data-ttu-id="e9c7e-161">Se você precisar de uma tarefa em segundo plano para se comunicar com a tarefa de chamada para indicar o progresso ou a conclusão, você deve implementar um mecanismo para isso.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-161">If you require a background task to communicate with the calling task to indicate progress or completion, you must implement a mechanism for this.</span></span> <span data-ttu-id="e9c7e-162">Alguns exemplos incluem:</span><span class="sxs-lookup"><span data-stu-id="e9c7e-162">Some examples are:</span></span>

* <span data-ttu-id="e9c7e-163">gravar o valor de um indicador de status no armazenamento que fica acessível para a tarefa de interface do usuário ou do autor da chamada, que pode monitorar ou verificar esse valor quando for necessário.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-163">Write a status indicator value to storage that is accessible to the UI or caller task, which can monitor or check this value when required.</span></span> <span data-ttu-id="e9c7e-164">Outros dados que a tarefa em segundo plano deve retornar para o chamador podem ser colocados no mesmo armazenamento.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-164">Other data that the background task must return to the caller can be placed into the same storage.</span></span>
* <span data-ttu-id="e9c7e-165">Estabeleça uma fila de resposta que a interface do usuário ou o chamador detecte.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-165">Establish a reply queue that the UI or caller listens on.</span></span> <span data-ttu-id="e9c7e-166">A tarefa em segundo plano pode enviar mensagens para a fila indicando o status e a conclusão.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-166">The background task can send messages to the queue that indicate status and completion.</span></span> <span data-ttu-id="e9c7e-167">Os dados que a tarefa em segundo plano deve retornar ao chamador podem ser colocados em mensagens.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-167">Data that the background task must return to the caller can be placed into the messages.</span></span> <span data-ttu-id="e9c7e-168">Se estiver usando o Barramento de Serviço do Azure, você pode usar as propriedades **ReplyTo** e **CorrelationId** para implementar essa funcionalidade.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-168">If you are using Azure Service Bus, you can use the **ReplyTo** and **CorrelationId** properties to implement this capability.</span></span>
* <span data-ttu-id="e9c7e-169">Expor uma API ou um ponto de extremidade da tarefa em segundo plano que a interface do usuário ou o chamador pode acessar para obter informações de status.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-169">Expose an API or endpoint from the background task that the UI or caller can access to obtain status information.</span></span> <span data-ttu-id="e9c7e-170">Os dados que a tarefa em segundo plano deve retornar ao chamador podem ser incluídos na resposta.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-170">Data that the background task must return to the caller can be included in the response.</span></span>
* <span data-ttu-id="e9c7e-171">Retornar a chamada de tarefa de segundo plano à interface do usuário ou ao chamador por meio de uma API para indicar o status em pontos predefinidos ou após a conclusão.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-171">Have the background task call back to the UI or caller through an API to indicate status at predefined points or on completion.</span></span> <span data-ttu-id="e9c7e-172">Isso pode ser feito por meio de eventos gerados localmente ou de um mecanismo de publicação e assinatura.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-172">This might be through events raised locally or through a publish-and-subscribe mechanism.</span></span> <span data-ttu-id="e9c7e-173">Os dados que a tarefa em segundo plano deve retornar para o chamador podem ser incluídos na solicitação ou carga do evento.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-173">Data that the background task must return to the caller can be included in the request or event payload.</span></span>

## <a name="hosting-environment"></a><span data-ttu-id="e9c7e-174">Ambiente de hospedagem</span><span class="sxs-lookup"><span data-stu-id="e9c7e-174">Hosting environment</span></span>
<span data-ttu-id="e9c7e-175">Você pode hospedar as tarefas em segundo plano usando diversos serviços diferentes da plataforma Azure:</span><span class="sxs-lookup"><span data-stu-id="e9c7e-175">You can host background tasks by using a range of different Azure platform services:</span></span>

* <span data-ttu-id="e9c7e-176">[**Aplicativos Web do Azure e Azure WebJobs**](#azure-web-apps-and-webjobs).</span><span class="sxs-lookup"><span data-stu-id="e9c7e-176">[**Azure Web Apps and WebJobs**](#azure-web-apps-and-webjobs).</span></span> <span data-ttu-id="e9c7e-177">Você pode usar o WebJobs para executar trabalhos personalizados com base em uma variedade de diferentes tipos de scripts ou programas executáveis no contexto de um aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-177">You can use WebJobs to execute custom jobs based on a range of different types of scripts or executable programs within the context of a web app.</span></span>
* <span data-ttu-id="e9c7e-178">[**Máquinas Virtuais do Azure**](#azure-virtual-machines).</span><span class="sxs-lookup"><span data-stu-id="e9c7e-178">[**Azure Virtual Machines**](#azure-virtual-machines).</span></span> <span data-ttu-id="e9c7e-179">Caso tenha um serviço Windows ou queira usar o Agendador de Tarefas do Windows, é comum hospedar as suas tarefas em segundo plano em uma máquina virtual dedicada.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-179">If you have a Windows service or want to use the Windows Task Scheduler, it is common to host your background tasks within a dedicated virtual machine.</span></span>
* <span data-ttu-id="e9c7e-180">[**Lote do Azure**](#azure-batch).</span><span class="sxs-lookup"><span data-stu-id="e9c7e-180">[**Azure Batch**](#azure-batch).</span></span> <span data-ttu-id="e9c7e-181">O Lote é um serviço de plataforma que agenda trabalhos de computação intensiva para execução em uma coleção gerenciada de máquinas virtuais.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-181">Batch is a platform service that schedules compute-intensive work to run on a managed collection of virtual machines.</span></span> <span data-ttu-id="e9c7e-182">Ele pode dimensionar automaticamente os recursos de computação.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-182">It can automatically scale compute resources.</span></span>
* <span data-ttu-id="e9c7e-183">[**Serviço de Contêiner do Azure**](#azure-container-service).</span><span class="sxs-lookup"><span data-stu-id="e9c7e-183">[**Azure Container Service**](#azure-container-service).</span></span> <span data-ttu-id="e9c7e-184">O Serviço de Contêiner do Azure fornece um ambiente de hospedagem de contêineres no Azure.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-184">Azure Container Service provides a container hosting environment on Azure.</span></span> 
* <span data-ttu-id="e9c7e-185">[**Serviços de Nuvem do Azure**](#azure-cloud-services).</span><span class="sxs-lookup"><span data-stu-id="e9c7e-185">[**Azure Cloud Services**](#azure-cloud-services).</span></span> <span data-ttu-id="e9c7e-186">Você pode gravar código dentro de uma função que é executada como uma tarefa em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-186">You can write code within a role that executes as a background task.</span></span>

<span data-ttu-id="e9c7e-187">As seções a seguir descrevem cada uma dessas opções em mais detalhes e incluem considerações para ajudá-lo a escolher a opção apropriada.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-187">The following sections describe each of these options in more detail, and include considerations to help you choose the appropriate option.</span></span>

### <a name="azure-web-apps-and-webjobs"></a><span data-ttu-id="e9c7e-188">Aplicativos Web do Azure e Azure WebJobs</span><span class="sxs-lookup"><span data-stu-id="e9c7e-188">Azure Web Apps and WebJobs</span></span>

<span data-ttu-id="e9c7e-189">Você pode usar os Azure WebJobs para executar trabalhos personalizados como tarefas em segundo plano em um aplicativo Web do Azure.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-189">You can use Azure WebJobs to execute custom jobs as background tasks within an Azure Web App.</span></span> <span data-ttu-id="e9c7e-190">O WebJobs é executado no contexto de seu aplicativo Web como um processo contínuo.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-190">WebJobs run within the context of your web app as a continuous process.</span></span> <span data-ttu-id="e9c7e-191">Ele é executado em resposta a um evento de gatilho do Agendador do Azure ou a fatores externos, como alterações em blobs de armazenamento e filas de mensagens.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-191">WebJobs also run in response to a trigger event from Azure Scheduler or external factors, such as changes to storage blobs and message queues.</span></span> <span data-ttu-id="e9c7e-192">Os trabalhos podem ser iniciados e interrompidos sob demanda, e serem desligados normalmente.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-192">Jobs can be started and stopped on demand, and shut down gracefully.</span></span> <span data-ttu-id="e9c7e-193">Se um WebJob em execução continuamente falhar, ele será reiniciado automaticamente.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-193">If a continuously running WebJob fails, it is automatically restarted.</span></span> <span data-ttu-id="e9c7e-194">As ações de nova tentativa e erro são configuráveis.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-194">Retry and error actions are configurable.</span></span>

<span data-ttu-id="e9c7e-195">Quando você configura um WebJob:</span><span class="sxs-lookup"><span data-stu-id="e9c7e-195">When you configure a WebJob:</span></span>

* <span data-ttu-id="e9c7e-196">Se desejar que o trabalho responda a um gatilho acionado por evento, você deverá configurá-lo como **Executar continuamente**.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-196">If you want the job to respond to an event-driven trigger, you should configure it as **Run continuously**.</span></span> <span data-ttu-id="e9c7e-197">O script ou programa é armazenado na pasta chamada site/wwwroot/app_data/jobs/continuous.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-197">The script or program is stored in the folder named site/wwwroot/app_data/jobs/continuous.</span></span>
* <span data-ttu-id="e9c7e-198">Se desejar que o trabalho responda a um gatilho acionado por agendamento, configure-o como **Executar segundo agendamento**.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-198">If you want the job to respond to a schedule-driven trigger, you should configure it as **Run on a schedule**.</span></span> <span data-ttu-id="e9c7e-199">O script ou o programa é armazenado na pasta chamada site/wwwroot/app_data/jobs/triggered.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-199">The script or program is stored in the folder named site/wwwroot/app_data/jobs/triggered.</span></span>
* <span data-ttu-id="e9c7e-200">Se você escolher a opção **Executar sob demanda** ao configurar um trabalho, ele executará o mesmo código que a opção **Executar em um agendamento** quando você iniciá-lo.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-200">If you choose the **Run on demand** option when you configure a job, it will execute the same code as the **Run on a schedule** option when you start it.</span></span>

<span data-ttu-id="e9c7e-201">O Azure WebJobs é executado na área restrita do aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-201">Azure WebJobs run within the sandbox of the web app.</span></span> <span data-ttu-id="e9c7e-202">Isso significa que eles podem acessar variáveis de ambiente e compartilhar informações, como cadeias de conexão, com o aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-202">This means that they can access environment variables and share information, such as connection strings, with the web app.</span></span> <span data-ttu-id="e9c7e-203">O trabalho tem acesso ao identificador exclusivo do computador que o executa.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-203">The job has access to the unique identifier of the machine that is running the job.</span></span> <span data-ttu-id="e9c7e-204">A cadeia de conexão chamada **AzureWebJobsStorage** fornece acesso a filas de armazenamento, blobs e tabelas do Azure para dados de aplicativo e acesso ao Barramento de Serviço para mensagens e comunicação.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-204">The connection string named **AzureWebJobsStorage** provides access to Azure storage queues, blobs, and tables for application data, and access to Service Bus for messaging and communication.</span></span> <span data-ttu-id="e9c7e-205">A cadeia de conexão chamada **AzureWebJobsDashboard** fornece acesso aos arquivos de log de ação do trabalho.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-205">The connection string named **AzureWebJobsDashboard** provides access to the job action log files.</span></span>

<span data-ttu-id="e9c7e-206">Os Azure WebJobs têm as seguintes características:</span><span class="sxs-lookup"><span data-stu-id="e9c7e-206">Azure WebJobs have the following characteristics:</span></span>

* <span data-ttu-id="e9c7e-207">**Segurança**: os WebJobs são protegidos pelas credenciais de implantação do aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-207">**Security**: WebJobs are protected by the deployment credentials of the web app.</span></span>
* <span data-ttu-id="e9c7e-208">**Tipos de arquivo com suporte**: você pode definir WebJobs usando scripts de comando (.cmd), arquivos em lote (.bat), scripts do PowerShell (.ps1), scripts bash shell (.sh), scripts PHP (.PHP), scripts Python (.py), código JavaScript (.js) e programas executáveis (.exe, .jar e outros).</span><span class="sxs-lookup"><span data-stu-id="e9c7e-208">**Supported file types**: You can define WebJobs by using command scripts (.cmd), batch files (.bat), PowerShell scripts (.ps1), bash shell scripts (.sh), PHP scripts (.php), Python scripts (.py), JavaScript code (.js), and executable programs (.exe, .jar, and more).</span></span>
* <span data-ttu-id="e9c7e-209">**Implantação**: você pode implantar scripts e executáveis usando o [portal do Azure](/azure/app-service-web/web-sites-create-web-jobs), usando o [Visual Studio](/azure/app-service-web/websites-dotnet-deploy-webjobs), usando o [SDK do Azure WebJobs](/azure/app-service/webjobs-sdk-get-started), ou copiá-los diretamente para os seguintes locais:</span><span class="sxs-lookup"><span data-stu-id="e9c7e-209">**Deployment**: You can deploy scripts and executables by using the [Azure portal](/azure/app-service-web/web-sites-create-web-jobs), by using [Visual Studio](/azure/app-service-web/websites-dotnet-deploy-webjobs), by using the [Azure WebJobs SDK](/azure/app-service/webjobs-sdk-get-started), or by copying them directly to the following locations:</span></span>
  * <span data-ttu-id="e9c7e-210">para execução acionada: site/wwwroot/app_data/jobs/triggered/{nome do trabalho}</span><span class="sxs-lookup"><span data-stu-id="e9c7e-210">For triggered execution: site/wwwroot/app_data/jobs/triggered/{job name}</span></span>
  * <span data-ttu-id="e9c7e-211">para execução contínua: site/wwwroot/app_data/jobs/continuous/{nome do trabalho}</span><span class="sxs-lookup"><span data-stu-id="e9c7e-211">For continuous execution: site/wwwroot/app_data/jobs/continuous/{job name}</span></span>
* <span data-ttu-id="e9c7e-212">**Registro em log**: Console.Out é tratado (marcado) como INFO.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-212">**Logging**: Console.Out is treated (marked) as INFO.</span></span> <span data-ttu-id="e9c7e-213">Console.Error é tratado como ERROR.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-213">Console.Error is treated as ERROR.</span></span> <span data-ttu-id="e9c7e-214">Você pode acessar informações de monitoramento e diagnóstico usando o Portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-214">You can access monitoring and diagnostics information by using the Azure portal.</span></span> <span data-ttu-id="e9c7e-215">Você pode baixar os arquivos de log diretamente do site.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-215">You can download log files directly from the site.</span></span> <span data-ttu-id="e9c7e-216">Eles estão salvos nos seguintes locais:</span><span class="sxs-lookup"><span data-stu-id="e9c7e-216">They are saved in the following locations:</span></span>
  * <span data-ttu-id="e9c7e-217">Para execução disparada: Vfs/data/jobs/triggered/jobName</span><span class="sxs-lookup"><span data-stu-id="e9c7e-217">For triggered execution: Vfs/data/jobs/triggered/jobName</span></span>
  * <span data-ttu-id="e9c7e-218">Para execução contínua: Vfs/data/jobs/continuous/jobName</span><span class="sxs-lookup"><span data-stu-id="e9c7e-218">For continuous execution: Vfs/data/jobs/continuous/jobName</span></span>
* <span data-ttu-id="e9c7e-219">**Configuração**: você pode configurar o WebJobs usando o portal, a API REST e o PowerShell.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-219">**Configuration**: You can configure WebJobs by using the portal, the REST API, and PowerShell.</span></span> <span data-ttu-id="e9c7e-220">Você pode usar um arquivo de configuração chamado settings.job no mesmo diretório raiz que o script de trabalho para fornecer informações de configuração para um trabalho.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-220">You can use a configuration file named settings.job in the same root directory as the job script to provide configuration information for a job.</span></span> <span data-ttu-id="e9c7e-221">Por exemplo: </span><span class="sxs-lookup"><span data-stu-id="e9c7e-221">For example:</span></span>
  * <span data-ttu-id="e9c7e-222">{ "stopping_wait_time": 60 }</span><span class="sxs-lookup"><span data-stu-id="e9c7e-222">{ "stopping_wait_time": 60 }</span></span>
  * <span data-ttu-id="e9c7e-223">{ "is_singleton": true }</span><span class="sxs-lookup"><span data-stu-id="e9c7e-223">{ "is_singleton": true }</span></span>

#### <a name="considerations"></a><span data-ttu-id="e9c7e-224">Considerações</span><span class="sxs-lookup"><span data-stu-id="e9c7e-224">Considerations</span></span>

* <span data-ttu-id="e9c7e-225">Por padrão, os WebJobs são dimensionados com o aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-225">By default, WebJobs scale with the web app.</span></span> <span data-ttu-id="e9c7e-226">No entanto, você pode configurar os trabalhos para serem executados em única instância definindo a propriedade de configuração **is_singleton** como **true**.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-226">However, you can configure jobs to run on single instance by setting the **is_singleton** configuration property to **true**.</span></span> <span data-ttu-id="e9c7e-227">O WebJobs de instância única e útil para tarefas que você não quer dimensionar ou executar como várias instâncias simultâneas, como reindexação, análise de dados e tarefas semelhantes.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-227">Single instance WebJobs are useful for tasks that you do not want to scale or run as simultaneous multiple instances, such as reindexing, data analysis, and similar tasks.</span></span>
* <span data-ttu-id="e9c7e-228">Para minimizar o impacto dos trabalhos no desempenho do aplicativo Web, considere a criação de uma instância vazia do Aplicativo Web do Azure em um novo plano de Serviço de Aplicativo para hospedar WebJobs que pode ter execução de longa duração ou consumir muitos recursos.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-228">To minimize the impact of jobs on the performance of the web app, consider creating an empty Azure Web App instance in a new App Service plan to host WebJobs that may be long running or resource intensive.</span></span>

### <a name="more-information"></a><span data-ttu-id="e9c7e-229">Mais informações</span><span class="sxs-lookup"><span data-stu-id="e9c7e-229">More information</span></span>
* <span data-ttu-id="e9c7e-230">[Recursos recomendados dos Azure WebJobs](/azure/app-service-web/websites-webjobs-resources) listam muitos recursos, downloads e exemplos de WebJobs.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-230">[Azure WebJobs recommended resources](/azure/app-service-web/websites-webjobs-resources) lists the many useful resources, downloads, and samples for WebJobs.</span></span>

### <a name="azure-virtual-machines"></a><span data-ttu-id="e9c7e-231">Máquinas Virtuais do Azure</span><span class="sxs-lookup"><span data-stu-id="e9c7e-231">Azure Virtual Machines</span></span>
<span data-ttu-id="e9c7e-232">Tarefas em segundo plano podem ser implementadas de forma que as impeça de serem implantadas nos Aplicativos Web ou nos Serviços de Nuvem do Azure, ou essas opções podem não ser convenientes.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-232">Background tasks might be implemented in a way that prevents them from being deployed to Azure Web Apps or Cloud Services, or these options might not be convenient.</span></span> <span data-ttu-id="e9c7e-233">Exemplos típicos são serviços do Windows e utilitários e programas executáveis de terceiros.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-233">Typical examples are Windows services, and third-party utilities and executable programs.</span></span> <span data-ttu-id="e9c7e-234">Outro exemplo seriam programas escritos para um ambiente de execução que é diferente daquele que hospeda o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-234">Another example might be programs written for an execution environment that is different than that hosting the application.</span></span> <span data-ttu-id="e9c7e-235">Por exemplo, pode ser um programa Unix ou Linux que você deseja executar em um aplicativo Windows ou .NET.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-235">For example, it might be a Unix or Linux program that you want to execute from a Windows or .NET application.</span></span> <span data-ttu-id="e9c7e-236">Você pode escolher entre uma variedade de sistemas operacionais para uma máquina virtual do Azure e executar o serviço ou o executável naquela máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-236">You can choose from a range of operating systems for an Azure virtual machine, and run your service or executable on that virtual machine.</span></span>

<span data-ttu-id="e9c7e-237">Para ajudar com a escolha de quando usar Máquinas Virtuais, confira a [Comparação de Serviço de Aplicativo, Serviços de Nuvem e Máquinas Virtuais do Azure](/azure/app-service-web/choose-web-site-cloud-service-vm/).</span><span class="sxs-lookup"><span data-stu-id="e9c7e-237">To help you choose when to use Virtual Machines, see [Azure App Services, Cloud Services and Virtual Machines comparison](/azure/app-service-web/choose-web-site-cloud-service-vm/).</span></span> <span data-ttu-id="e9c7e-238">Para saber mais sobre as opções para Máquinas Virtuais, confira [Tamanhos de máquinas virtuais do Windows no Azure](/azure/virtual-machines/windows/sizes).</span><span class="sxs-lookup"><span data-stu-id="e9c7e-238">For information about the options for Virtual Machines, see [Sizes for Windows virtual machines in Azure](/azure/virtual-machines/windows/sizes).</span></span> <span data-ttu-id="e9c7e-239">Para obter mais informações sobre os sistemas operacionais e imagens predefinidas disponíveis para Máquinas Virtuais, consulte [Marketplace de Máquinas Virtuais do Azure](https://azure.microsoft.com/gallery/virtual-machines/).</span><span class="sxs-lookup"><span data-stu-id="e9c7e-239">For more information about the operating systems and prebuilt images that are available for Virtual Machines, see [Azure Virtual Machines Marketplace](https://azure.microsoft.com/gallery/virtual-machines/).</span></span>

<span data-ttu-id="e9c7e-240">Para iniciar a tarefa em segundo plano em uma máquina virtual separada, você tem várias opções:</span><span class="sxs-lookup"><span data-stu-id="e9c7e-240">To initiate the background task in a separate virtual machine, you have a range of options:</span></span>

* <span data-ttu-id="e9c7e-241">Você pode executar a tarefa sob demanda diretamente do seu aplicativo, enviando uma solicitação para um ponto de extremidade que a tarefa expõe.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-241">You can execute the task on demand directly from your application by sending a request to an endpoint that the task exposes.</span></span> <span data-ttu-id="e9c7e-242">Isso transmite todos os dados que a tarefa requer.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-242">This passes in any data that the task requires.</span></span> <span data-ttu-id="e9c7e-243">Esse ponto de extremidade invoca a tarefa.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-243">This endpoint invokes the task.</span></span>
* <span data-ttu-id="e9c7e-244">Você pode configurar a tarefa para que ela seja executada segundo uma agenda usando um agendador ou temporizador disponível em seu sistema operacional escolhido.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-244">You can configure the task to run on a schedule by using a scheduler or timer that is available in your chosen operating system.</span></span> <span data-ttu-id="e9c7e-245">Por exemplo, no Windows, você pode usar o Agendador de Tarefas do Windows para executar scripts e tarefas.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-245">For example, on Windows you can use Windows Task Scheduler to execute scripts and tasks.</span></span> <span data-ttu-id="e9c7e-246">Ou, se tiver o SQL Server instalado na máquina virtual, você poderá usar o SQL Server Agent para executar scripts e tarefas.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-246">Or, if you have SQL Server installed on the virtual machine, you can use the SQL Server Agent to execute scripts and tasks.</span></span>
* <span data-ttu-id="e9c7e-247">Você pode usar o Agendador do Azure para iniciar a tarefa acrescentando uma mensagem a uma fila que a tarefa escuta ou enviando uma solicitação para uma API que a tarefa expõe.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-247">You can use Azure Scheduler to initiate the task by adding a message to a queue that the task listens on, or by sending a request to an API that the task exposes.</span></span>

<span data-ttu-id="e9c7e-248">Consulte a seção anterior [Gatilhos](#triggers) para obter mais informações sobre como você pode iniciar tarefas em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-248">See the earlier section [Triggers](#triggers) for more information about how you can initiate background tasks.</span></span>  

#### <a name="considerations"></a><span data-ttu-id="e9c7e-249">Considerações</span><span class="sxs-lookup"><span data-stu-id="e9c7e-249">Considerations</span></span>
<span data-ttu-id="e9c7e-250">Considere os seguintes pontos ao decidir se deseja implantar tarefas em segundo plano em uma máquina virtual do Azure:</span><span class="sxs-lookup"><span data-stu-id="e9c7e-250">Consider the following points when you are deciding whether to deploy background tasks in an Azure virtual machine:</span></span>

* <span data-ttu-id="e9c7e-251">Hospedar as tarefas em segundo plano em uma máquina virtual do Azure separada fornece   flexibilidade e permite um controle preciso sobre a iniciação, execução, agendamento e alocação de recurso.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-251">Hosting background tasks in a separate Azure virtual machine provides flexibility and allows precise control over initiation, execution, scheduling, and resource allocation.</span></span> <span data-ttu-id="e9c7e-252">No entanto, isso aumentará o custo do tempo de execução se uma máquina virtual deve ser implantada apenas para executar tarefas em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-252">However, it will increase runtime cost if a virtual machine must be deployed just to run background tasks.</span></span>
* <span data-ttu-id="e9c7e-253">Não há um recurso para monitorar as tarefas no Portal do Azure e nenhuma funcionalidade de reinicialização automatizada para tarefas que falharam, embora você possa monitorar o status básico da máquina virtual e gerenciá-la usando os [Cmdlets do Azure Resource Manager](https://msdn.microsoft.com/library/mt125356.aspx).</span><span class="sxs-lookup"><span data-stu-id="e9c7e-253">There is no facility to monitor the tasks in the Azure portal and no automated restart capability for failed tasks--although you can monitor the basic status of the virtual machine and manage it by using the  [Azure Resource Manager Cmdlets](https://msdn.microsoft.com/library/mt125356.aspx).</span></span> <span data-ttu-id="e9c7e-254">No entanto, não há nenhum recurso para controlar os processos e threads em nós de computação.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-254">However, there are no facilities to control processes and threads in compute nodes.</span></span> <span data-ttu-id="e9c7e-255">Normalmente, usar uma máquina virtual exigirá mais esforço para implementar um mecanismo que coleta dados da instrumentação na tarefa e do sistema operacional na máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-255">Typically, using a virtual machine will require additional effort to implement a mechanism that collects data from instrumentation in the task, and from the operating system in the virtual machine.</span></span> <span data-ttu-id="e9c7e-256">Uma solução que pode ser apropriada é usar o [System Center Management Pack para o Azure](https://www.microsoft.com/download/details.aspx?id=50013).</span><span class="sxs-lookup"><span data-stu-id="e9c7e-256">One solution that might be appropriate is to use the [System Center Management Pack for Azure](https://www.microsoft.com/download/details.aspx?id=50013).</span></span>
* <span data-ttu-id="e9c7e-257">Você pode considerar a criação de testes de monitoramento que são expostos por meio de pontos de extremidade HTTP.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-257">You might consider creating monitoring probes that are exposed through HTTP endpoints.</span></span> <span data-ttu-id="e9c7e-258">O código para esses testes pode executar verificações de integridade, coletar informações operacionais e estatísticas ou agrupar informações de erro e retorná-las a um aplicativo de gerenciamento.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-258">The code for these probes could perform health checks, collect operational information and statistics--or collate error information and return it to a management application.</span></span> <span data-ttu-id="e9c7e-259">Para obter mais informações, consulte o [Padrão de monitoramento de ponto de extremidade de integridade](../patterns/health-endpoint-monitoring.md).</span><span class="sxs-lookup"><span data-stu-id="e9c7e-259">For more information, see [Health Endpoint Monitoring Pattern](../patterns/health-endpoint-monitoring.md).</span></span>

#### <a name="more-information"></a><span data-ttu-id="e9c7e-260">Mais informações</span><span class="sxs-lookup"><span data-stu-id="e9c7e-260">More information</span></span>
* <span data-ttu-id="e9c7e-261">[Máquinas Virtuais](https://azure.microsoft.com/services/virtual-machines/) no Azure</span><span class="sxs-lookup"><span data-stu-id="e9c7e-261">[Virtual Machines](https://azure.microsoft.com/services/virtual-machines/) on Azure</span></span>
* [<span data-ttu-id="e9c7e-262">Perguntas frequentes sobre Máquinas Virtuais do Azure</span><span class="sxs-lookup"><span data-stu-id="e9c7e-262">Azure Virtual Machines FAQ</span></span>](/azure/virtual-machines/virtual-machines-linux-classic-faq?toc=%2fazure%2fvirtual-machines%2flinux%2fclassic%2ftoc.json)

### <a name="azure-batch"></a><span data-ttu-id="e9c7e-263">Lote do Azure</span><span class="sxs-lookup"><span data-stu-id="e9c7e-263">Azure Batch</span></span> 

<span data-ttu-id="e9c7e-264">Considere o [Lote do Azure](/azure/batch/) se você precisa executar cargas de trabalho grandes, cargas de trabalho HPC (computação de alto desempenho) em paralelo entre dezenas, centenas ou milhares de máquinas virtuais.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-264">Consider [Azure Batch](/azure/batch/) if you need to run large, parallel high-performance computing (HPC) workloads across tens, hundreds, or thousands of VMs.</span></span>  

<span data-ttu-id="e9c7e-265">O serviço do Lote provisiona as VMs, atribui tarefas às VMs, executa as tarefas e monitora o progresso.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-265">The Batch service provisions the VMs, assign tasks to the VMs, runs the tasks, and monitors the progress.</span></span> <span data-ttu-id="e9c7e-266">O Lote pode se escalar horizontal e automaticamente as VMs em resposta à carga de trabalho.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-266">Batch can automatically scale out the VMs in response to the workload.</span></span> <span data-ttu-id="e9c7e-267">O Lote também fornece o agendamento de trabalho.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-267">Batch also provides job scheduling.</span></span> <span data-ttu-id="e9c7e-268">O Lote do Azure oferece suporte a máquinas virtuais Windows e Linux.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-268">Azure Batch supports both Linux and Windows VMs.</span></span>

#### <a name="considerations"></a><span data-ttu-id="e9c7e-269">Considerações</span><span class="sxs-lookup"><span data-stu-id="e9c7e-269">Considerations</span></span> 

<span data-ttu-id="e9c7e-270">O Lote funciona bem com cargas de trabalho intrinsecamente paralelas.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-270">Batch works well with intrinsically parallel workloads.</span></span> <span data-ttu-id="e9c7e-271">Ele também pode executar cálculos paralelos com uma etapa de redução no final ou executar [aplicativos MPI (Interface de Passagem de Mensagens)](/azure/batch/batch-mpi) para tarefas paralelas que exigem a passagem de mensagem entre nós.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-271">It can also perform parallel calculations with a reduce step at the end, or run [Message Passing Interface (MPI) applications](/azure/batch/batch-mpi) for parallel tasks that require message passing between nodes.</span></span> 

<span data-ttu-id="e9c7e-272">Um trabalho do Lote do Azure é executado em um pool de nós (VMs).</span><span class="sxs-lookup"><span data-stu-id="e9c7e-272">An Azure Batch job runs on a pool of nodes (VMs).</span></span> <span data-ttu-id="e9c7e-273">Uma abordagem é alocar um pool somente quando necessário e, em seguida, excluí-lo depois que o trabalho for concluído.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-273">One approach is to allocate a pool only when needed and then delete it after the job completes.</span></span> <span data-ttu-id="e9c7e-274">Isso maximiza a utilização porque os nós não estão ociosos, mas o trabalho deverá aguardar a alocação dos nós.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-274">This maximizes utilization, because nodes are not idle, but the job must wait for nodes to be allocated.</span></span> <span data-ttu-id="e9c7e-275">Como alternativa, você pode criar um pool antecipadamente.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-275">Alternatively, you can create a pool ahead of time.</span></span> <span data-ttu-id="e9c7e-276">Essa abordagem minimiza o tempo que leva para um trabalho Iniciar, mas pode resultar em nós ociosos.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-276">That approach minimizes the time that it takes for a job to start, but can result in having nodes that sit idle.</span></span> <span data-ttu-id="e9c7e-277">Para saber mais, veja [Tempo de vida de nó de computação e pool](/azure/batch/batch-api-basics#pool-and-compute-node-lifetime).</span><span class="sxs-lookup"><span data-stu-id="e9c7e-277">For more information, see [Pool and compute node lifetime](/azure/batch/batch-api-basics#pool-and-compute-node-lifetime).</span></span>

#### <a name="more-information"></a><span data-ttu-id="e9c7e-278">Mais informações</span><span class="sxs-lookup"><span data-stu-id="e9c7e-278">More information</span></span> 

* [<span data-ttu-id="e9c7e-279">Executar cargas de trabalho intrinsecamente paralelas com o Lote</span><span class="sxs-lookup"><span data-stu-id="e9c7e-279">Run intrinsically parallel workloads with Batch</span></span>](/azure/batch/batch-technical-overview) 
* [<span data-ttu-id="e9c7e-280">Desenvolver soluções de computação paralela em larga escala com o Lote</span><span class="sxs-lookup"><span data-stu-id="e9c7e-280">Develop large-scale parallel compute solutions with Batch</span></span>](/azure/batch/batch-api-basics) 
* [<span data-ttu-id="e9c7e-281">Soluções HPC e do Lote para cargas de trabalho de computação em larga escala</span><span class="sxs-lookup"><span data-stu-id="e9c7e-281">Batch and HPC solutions for large-scale computing workloads</span></span>](/azure/batch/batch-hpc-solutions)

### <a name="azure-container-service"></a><span data-ttu-id="e9c7e-282">Serviço de Contêiner do Azure</span><span class="sxs-lookup"><span data-stu-id="e9c7e-282">Azure Container Service</span></span> 

<span data-ttu-id="e9c7e-283">O Serviço de Contêiner do Azure permite configurar e gerenciar um cluster de VMs no Azure para executar aplicativos em contêineres.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-283">Azure Container Service lets you configure and manage a cluster of VMs in Azure to run containerized applications.</span></span> <span data-ttu-id="e9c7e-284">Ele oferece uma opção de Docker Swarm, DC/SO ou Kubernetes para orquestração.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-284">It provides a choice of Docker Swarm, DC/OS, or Kubernetes for orchestration.</span></span> 

<span data-ttu-id="e9c7e-285">Os contêineres podem ser úteis para a execução de trabalhos em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-285">Containers can be useful for running background jobs.</span></span> <span data-ttu-id="e9c7e-286">Alguns benefícios incluem:</span><span class="sxs-lookup"><span data-stu-id="e9c7e-286">Some of the benefits include:</span></span> 

- <span data-ttu-id="e9c7e-287">Os contêineres dão suporte à hospedagem de alta densidade.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-287">Containers support high-density hosting.</span></span> <span data-ttu-id="e9c7e-288">Você pode isolar uma tarefa em segundo plano em um contêiner ao colocar vários contêineres em cada VM.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-288">You can isolate a background task in a container, while placing multiple containers in each VM.</span></span>
- <span data-ttu-id="e9c7e-289">O orquestrador de contêiner lida com o balanceamento de carga interno, configurando a rede interna e outras tarefas de configuração.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-289">The container orchestrator handles internal load balancing, configuring the internal network, and other configuration tasks.</span></span>
- <span data-ttu-id="e9c7e-290">Os contêineres podem ser iniciados e interrompidos conforme necessário.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-290">Containers can be started and stopped as needed.</span></span> 
- <span data-ttu-id="e9c7e-291">O Registro de Contêiner do Azure permite que você registre seus contêineres dentro dos limites do Azure.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-291">Azure Container Registry allows you to register your containers inside Azure boundaries.</span></span> <span data-ttu-id="e9c7e-292">Isso é fornecido com os benefícios de segurança, privacidade e proximidade.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-292">This comes with security, privacy, and proximity benefits.</span></span> 

#### <a name="considerations"></a><span data-ttu-id="e9c7e-293">Considerações</span><span class="sxs-lookup"><span data-stu-id="e9c7e-293">Considerations</span></span>

- <span data-ttu-id="e9c7e-294">Requer uma compreensão de como usar um orquestrador de contêiner.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-294">Requires an understanding of how to use a container orchestrator.</span></span> <span data-ttu-id="e9c7e-295">Dependendo do conjunto de qualificações da sua equipe DevOps, isso pode ou não ser um problema.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-295">Depending on the skillset of your DevOps team, this may or may not be an issue.</span></span>  
- <span data-ttu-id="e9c7e-296">O Serviço de Contêiner é executado em um ambiente de IaaS.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-296">Container Service runs in an IaaS environment.</span></span> <span data-ttu-id="e9c7e-297">Ele fornece um cluster de máquinas virtuais dentro de uma rede virtual dedicada.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-297">It provisions a cluster of VMs inside a dedicated VNet.</span></span> 

#### <a name="more-information"></a><span data-ttu-id="e9c7e-298">Mais informações</span><span class="sxs-lookup"><span data-stu-id="e9c7e-298">More information</span></span> 

* [<span data-ttu-id="e9c7e-299">Introdução às soluções de hospedagem de contêineres do Docker com o Serviço de Contêiner do Azure</span><span class="sxs-lookup"><span data-stu-id="e9c7e-299">Introduction to Docker container hosting solutions with Azure Container Service</span></span>](/azure/container-service/container-service-intro) 
* [<span data-ttu-id="e9c7e-300">Introdução aos registros de contêiner do Docker privado</span><span class="sxs-lookup"><span data-stu-id="e9c7e-300">Introduction to private Docker container registries</span></span>](/azure/container-registry/container-registry-intro) 

### <a name="azure-cloud-services"></a><span data-ttu-id="e9c7e-301">Serviços de nuvem do Azure</span><span class="sxs-lookup"><span data-stu-id="e9c7e-301">Azure Cloud Services</span></span> 
<span data-ttu-id="e9c7e-302">Tarefas em segundo plano podem ser executadas dentro de uma função web ou em uma função de trabalho separada.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-302">You can execute background tasks within a web role or in a separate worker role.</span></span> <span data-ttu-id="e9c7e-303">Quando estiver decidindo se prefere usar uma função de trabalho, leve em consideração fatores como requisitos de escalabilidade e elasticidade, tempo de vida da tarefa, cadência de versão, segurança, tolerância a falhas, contenção, complexidade e a arquitetura lógica.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-303">When you are deciding whether to use a worker role, consider scalability and elasticity requirements, task lifetime, release cadence, security, fault tolerance, contention, complexity, and the logical architecture.</span></span> <span data-ttu-id="e9c7e-304">Para obter mais informações, consulte [Padrão de consolidação de recursos de computação](../patterns/compute-resource-consolidation.md).</span><span class="sxs-lookup"><span data-stu-id="e9c7e-304">For more information, see [Compute Resource Consolidation Pattern](../patterns/compute-resource-consolidation.md).</span></span>

<span data-ttu-id="e9c7e-305">Há várias maneiras de implementar tarefas em segundo plano em uma função de Serviços de Nuvem:</span><span class="sxs-lookup"><span data-stu-id="e9c7e-305">There are several ways to implement background tasks within a Cloud Services role:</span></span>

* <span data-ttu-id="e9c7e-306">Criar uma implementação da classe **RoleEntryPoint** na função e usar os seus métodos para executar tarefas em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-306">Create an implementation of the **RoleEntryPoint** class in the role and use its methods to execute background tasks.</span></span> <span data-ttu-id="e9c7e-307">As tarefas são executadas no contexto de WaIISHost.exe.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-307">The tasks run in the context of WaIISHost.exe.</span></span> <span data-ttu-id="e9c7e-308">Elas podem usar o método **GetSetting** da classe **CloudConfigurationManager** para carregar definições de configuração.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-308">They can use the **GetSetting** method of the **CloudConfigurationManager** class to load configuration settings.</span></span> <span data-ttu-id="e9c7e-309">Para obter mais informações, consulte [Ciclo de vida](#lifecycle).</span><span class="sxs-lookup"><span data-stu-id="e9c7e-309">For more information, see [Lifecycle](#lifecycle).</span></span>
* <span data-ttu-id="e9c7e-310">Use as tarefas de inicialização para executar tarefas em segundo plano quando o aplicativo for iniciado.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-310">Use startup tasks to execute background tasks when the application starts.</span></span> <span data-ttu-id="e9c7e-311">Para forçar as tarefas a continuar sendo executadas em segundo plano, configure a propriedade **taskType** como **background** (se você não fizer isso, o processo de inicialização do aplicativo será interrompido e aguardará até que a tarefa seja concluída).</span><span class="sxs-lookup"><span data-stu-id="e9c7e-311">To force the tasks to continue to run in the background, set the **taskType** property to **background** (if you do not do this, the application startup process will halt and wait for the task to finish).</span></span> <span data-ttu-id="e9c7e-312">Para saber mais, confira [Executar Tarefas de Inicialização no Azure](/azure/cloud-services/cloud-services-startup-tasks).</span><span class="sxs-lookup"><span data-stu-id="e9c7e-312">For more information, see [Run startup tasks in Azure](/azure/cloud-services/cloud-services-startup-tasks).</span></span>
* <span data-ttu-id="e9c7e-313">Use o SDK do WebJobs para implementar tarefas em segundo plano como WebJobs, que são iniciados como uma tarefa de inicialização.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-313">Use the WebJobs SDK to implement background tasks such as WebJobs that are initiated as a startup task.</span></span> <span data-ttu-id="e9c7e-314">Para saber mais, veja [Criar um WebJob .NET no Serviço de Aplicativo do Azure](/azure/app-service-web/websites-dotnet-webjobs-sdk-get-started).</span><span class="sxs-lookup"><span data-stu-id="e9c7e-314">For more information, see [Create a .NET WebJob in Azure App Service](/azure/app-service-web/websites-dotnet-webjobs-sdk-get-started).</span></span>
* <span data-ttu-id="e9c7e-315">Use uma tarefa de inicialização para instalar um serviço do Windows que executa uma ou mais tarefas em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-315">Use a startup task to install a Windows service that executes one or more background tasks.</span></span> <span data-ttu-id="e9c7e-316">Você deve definir a propriedade **taskType** para **background** para que o serviço seja executado em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-316">You must set the **taskType** property to **background** so that the service executes in the background.</span></span> <span data-ttu-id="e9c7e-317">Para saber mais, confira [Executar Tarefas de Inicialização no Azure](/azure/cloud-services/cloud-services-startup-tasks).</span><span class="sxs-lookup"><span data-stu-id="e9c7e-317">For more information, see [Run startup tasks in Azure](/azure/cloud-services/cloud-services-startup-tasks).</span></span>

<span data-ttu-id="e9c7e-318">A principal vantagem de executar tarefas em segundo plano na função web é a economia nos custos de hospedagem porque não há nenhum requisito para implantar funções adicionais.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-318">The main advantage of running background tasks in the web role is the saving in hosting costs because there is no requirement to deploy additional roles.</span></span>

<span data-ttu-id="e9c7e-319">A execução de tarefas em segundo plano em uma função de trabalho tem várias vantagens:</span><span class="sxs-lookup"><span data-stu-id="e9c7e-319">Running background tasks in a worker role has several advantages:</span></span>

* <span data-ttu-id="e9c7e-320">Ela permite que você gerencie o dimensionamento separadamente para cada tipo de função.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-320">It allows you to manage scaling separately for each type of role.</span></span> <span data-ttu-id="e9c7e-321">Por exemplo, talvez sejam necessárias mais instâncias de uma função web para dar suporte à carga atual, mas menos instâncias da função de trabalho que executa tarefas em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-321">For example, you might need more instances of a web role to support the current load, but fewer instances of the worker role that executes background tasks.</span></span> <span data-ttu-id="e9c7e-322">Dimensionando instâncias de computação de tarefas de segundo plano separadamente das funções de interface do usuário, você pode reduzir o custo de hospedagem enquanto mantém um desempenho aceitável.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-322">By scaling background task compute instances separately from the UI roles, you can reduce hosting costs, while maintaining acceptable performance.</span></span>
* <span data-ttu-id="e9c7e-323">Ele descarrega a sobrecarga de processamento de tarefas em segundo plano da função web.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-323">It offloads the processing overhead for background tasks from the web role.</span></span> <span data-ttu-id="e9c7e-324">A função web que fornece a interface do usuário pode permanecer responsiva e pode significar que serão necessárias menos instâncias para dar suporte a um determinado volume de solicitações de usuários.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-324">The web role that provides the UI can remain responsive, and it may mean fewer instances are required to support a given volume of requests from users.</span></span>
* <span data-ttu-id="e9c7e-325">Ela permite que você implemente a separação de preocupações.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-325">It allows you to implement separation of concerns.</span></span> <span data-ttu-id="e9c7e-326">Cada tipo de função pode implementar um conjunto específico de tarefas claramente definidas e relacionadas.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-326">Each role type can implement a specific set of clearly defined and related tasks.</span></span> <span data-ttu-id="e9c7e-327">Isso torna a criação e a manutenção de código mais fácil porque há menos interdependência de código e funcionalidade entre cada função.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-327">This makes designing and maintaining the code easier because there is less interdependence of code and functionality between each role.</span></span>
* <span data-ttu-id="e9c7e-328">Isso pode ajudar a isolar os dados e processos importantes.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-328">It can help to isolate sensitive processes and data.</span></span> <span data-ttu-id="e9c7e-329">Por exemplo, as funções web que implementam a interface do usuário não precisam ter acesso a dados que são gerenciados e controlados por uma função de trabalho.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-329">For example, web roles that implement the UI do not need to have access to data that is managed and controlled by a worker role.</span></span> <span data-ttu-id="e9c7e-330">Isso pode ser útil para reforçar a segurança, especialmente quando você usa um padrão como o [Padrão Gatekeeper](../patterns/gatekeeper.md).</span><span class="sxs-lookup"><span data-stu-id="e9c7e-330">This can be useful in strengthening security, especially when you use a pattern such as the [Gatekeeper Pattern](../patterns/gatekeeper.md).</span></span>  

#### <a name="considerations"></a><span data-ttu-id="e9c7e-331">Considerações</span><span class="sxs-lookup"><span data-stu-id="e9c7e-331">Considerations</span></span>
<span data-ttu-id="e9c7e-332">Considere os seguintes pontos ao escolher como e onde implantar tarefas em segundo plano ao usar funções web e de trabalho de Serviços de Nuvem:</span><span class="sxs-lookup"><span data-stu-id="e9c7e-332">Consider the following points when choosing how and where to deploy background tasks when using Cloud Services web and worker roles:</span></span>

* <span data-ttu-id="e9c7e-333">Hospedar tarefas em segundo plano em uma função web existente pode economizar o custo de executar uma função de trabalho separada apenas para essas tarefas.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-333">Hosting background tasks in an existing web role can save the cost of running a separate worker role just for these tasks.</span></span> <span data-ttu-id="e9c7e-334">No entanto, é provável que isso afete o desempenho e a disponibilidade do aplicativo caso haja contenção para processamento e outros recursos.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-334">However, it is likely to affect the performance and availability of the application if there is contention for processing and other resources.</span></span> <span data-ttu-id="e9c7e-335">Usar uma função de trabalho separada protege a função web do impacto causado por tarefas em segundo plano com uso intensivo de recursos ou de longa duração.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-335">Using a separate worker role protects the web role from the impact of long-running or resource-intensive background tasks.</span></span>
* <span data-ttu-id="e9c7e-336">Se hospedar tarefas em segundo plano usando a classe **RoleEntryPoint** , você poderá mover facilmente para outra função.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-336">If you host background tasks by using the **RoleEntryPoint** class, you can easily move this to another role.</span></span> <span data-ttu-id="e9c7e-337">Por exemplo, se você criar a classe em uma função web e depois decidir que precisa executar as tarefas em uma função de trabalho, será possível mover a implementação da classe **RoleEntryPoint** para a função de trabalho.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-337">For example, if you create the class in a web role and later decide that you need to run the tasks in a worker role, you can move the **RoleEntryPoint** class implementation into the worker role.</span></span>
* <span data-ttu-id="e9c7e-338">As tarefas de inicialização são projetadas para executar um programa ou um script.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-338">Startup tasks are designed to execute a program or a script.</span></span> <span data-ttu-id="e9c7e-339">Implantar um trabalho em segundo plano como um programa executável poderá ser mais difícil, especialmente se ele também exigir a implantação de assemblies dependentes.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-339">Deploying a background job as an executable program might be more difficult, especially if it also requires deployment of dependent assemblies.</span></span> <span data-ttu-id="e9c7e-340">Pode ser mais fácil implantar e usar um script para definir um trabalho em segundo plano usando tarefas de inicialização.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-340">It might be easier to deploy and use a script to define a background job when you use startup tasks.</span></span>
* <span data-ttu-id="e9c7e-341">As exceções que levam uma tarefa em segundo plano a falhar têm um impacto diferente dependendo da forma como são hospedadas:</span><span class="sxs-lookup"><span data-stu-id="e9c7e-341">Exceptions that cause a background task to fail have a different impact, depending on the way that they are hosted:</span></span>
  * <span data-ttu-id="e9c7e-342">Se você usar a abordagem de classe **RoleEntryPoint** , uma tarefa com falha fará com que a função reinicie para que a tarefa seja reiniciada automaticamente.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-342">If you use the **RoleEntryPoint** class approach, a failed task will cause the role to restart so that the task automatically restarts.</span></span> <span data-ttu-id="e9c7e-343">Isso pode afetar a disponibilidade do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-343">This can affect availability of the application.</span></span> <span data-ttu-id="e9c7e-344">Para evitar isso, certifique-se de incluir um tratamento de exceções robusto na classe **RoleEntryPoint** e todas as tarefas em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-344">To prevent this, ensure that you include robust exception handling within the **RoleEntryPoint** class and all the background tasks.</span></span> <span data-ttu-id="e9c7e-345">Use o código para reiniciar tarefas que falham onde for apropriado e lançar a exceção para reiniciar a função somente se você não puder se recuperar normalmente da falha dentro do seu código.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-345">Use code to restart tasks that fail where this is appropriate, and throw the exception to restart the role only if you cannot gracefully recover from the failure within your code.</span></span>
  * <span data-ttu-id="e9c7e-346">Se usar tarefas de inicialização, você é responsável por gerenciar a execução da tarefa e verificar se ela falhar.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-346">If you use startup tasks, you are responsible for managing the task execution and checking if it fails.</span></span>
* <span data-ttu-id="e9c7e-347">Gerenciar e monitorar tarefas de inicialização é mais difícil do que usar a abordagem de classe **RoleEntryPoint** .</span><span class="sxs-lookup"><span data-stu-id="e9c7e-347">Managing and monitoring startup tasks is more difficult than using the **RoleEntryPoint** class approach.</span></span> <span data-ttu-id="e9c7e-348">No entanto, o SDK do Azure WebJobs inclui um painel para facilitar o gerenciamento de WebJobs iniciado por meio de tarefas de inicialização.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-348">However, the Azure WebJobs SDK includes a dashboard to make it easier to manage WebJobs that you initiate through startup tasks.</span></span>

#### <a name="lifecycle"></a><span data-ttu-id="e9c7e-349">Ciclo de vida</span><span class="sxs-lookup"><span data-stu-id="e9c7e-349">Lifecycle</span></span> 
 <span data-ttu-id="e9c7e-350">Se você decidir implementar trabalhos em segundo plano para aplicativos de Serviços de Nuvem que usam funções da web e de trabalho usando a classe **RoleEntryPoint** , é importante entender o ciclo de vida dessa classe para usá-la corretamente.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-350">If you decide to implement background jobs for Cloud Services applications that use web and worker roles by using the **RoleEntryPoint** class, it is important to understand the lifecycle of this class in order to use it correctly.</span></span>

<span data-ttu-id="e9c7e-351">As funções da web e de trabalho passam por um conjunto de fases distintas, como iniciar, executar e parar.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-351">Web and worker roles go through a set of distinct phases as they start, run, and stop.</span></span> <span data-ttu-id="e9c7e-352">A classe **RoleEntryPoint** expõe uma série de eventos que indicam quando essas fases estão ocorrendo.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-352">The **RoleEntryPoint** class exposes a series of events that indicate when these stages are occurring.</span></span> <span data-ttu-id="e9c7e-353">Use-as para inicializar, executar e interromper as tarefas personalizadas em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-353">You use these to initialize, run, and stop your custom background tasks.</span></span> <span data-ttu-id="e9c7e-354">O ciclo completo é:</span><span class="sxs-lookup"><span data-stu-id="e9c7e-354">The complete cycle is:</span></span>

* <span data-ttu-id="e9c7e-355">O Azure carrega o assembly de função e ele o procura para uma classe que deriva de **RoleEntryPoint**.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-355">Azure loads the role assembly and searches it for a class that derives from **RoleEntryPoint**.</span></span>
* <span data-ttu-id="e9c7e-356">Se ele encontrar essa classe, ele chama **RoleEntryPoint.OnStart()**.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-356">If it finds this class, it calls **RoleEntryPoint.OnStart()**.</span></span> <span data-ttu-id="e9c7e-357">Você substitui esse método para inicializar as tarefas em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-357">You override this method to initialize your background tasks.</span></span>
* <span data-ttu-id="e9c7e-358">Após o método **OnStart** ser concluído, o Azure chamará **Application_Start ()** no arquivo Global do aplicativo se ele estiver presente (por exemplo, Global.asax em uma função web executando ASP.NET).</span><span class="sxs-lookup"><span data-stu-id="e9c7e-358">After the **OnStart** method has completed, Azure calls **Application_Start()** in the application’s Global file if this is present (for example, Global.asax in a web role running ASP.NET).</span></span>
* <span data-ttu-id="e9c7e-359">As chamadas do **Azure RoleEntryPoint.Run()** em um novo thread de primeiro plano são executadas em paralelo com o **OnStart()**.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-359">Azure calls **RoleEntryPoint.Run()** on a new foreground thread that executes in parallel with **OnStart()**.</span></span> <span data-ttu-id="e9c7e-360">Você substitui esse método para inicializar as tarefas em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-360">You override this method to start your background tasks.</span></span>
* <span data-ttu-id="e9c7e-361">Quando termina o método Run, o Azure chama primeiro **Application_End()** no arquivo Global do aplicativo se ele estiver presente e, em seguida, chama **RoleEntryPoint.OnStop()**.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-361">When the Run method ends, Azure first calls **Application_End()** in the application’s Global file if this is present, and then calls **RoleEntryPoint.OnStop()**.</span></span> <span data-ttu-id="e9c7e-362">Você substitui o método **OnStop** para interromper as tarefas em segundo plano, limpar recursos, descartar objetos e fechar conexões que podem ter usado as tarefas.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-362">You override the **OnStop** method to stop your background tasks, clean up resources, dispose of objects, and close connections that the tasks may have used.</span></span>
* <span data-ttu-id="e9c7e-363">O processo de host de função de trabalho do Azure está parado.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-363">The Azure worker role host process is stopped.</span></span> <span data-ttu-id="e9c7e-364">Neste ponto, a função será reciclada e reiniciada.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-364">At this point, the role will be recycled and will restart.</span></span>

<span data-ttu-id="e9c7e-365">Para obter mais detalhes e um exemplo de como usar os métodos da classe **RoleEntryPoint** , consulte [Padrão de consolidação de recursos de computação](../patterns/compute-resource-consolidation.md).</span><span class="sxs-lookup"><span data-stu-id="e9c7e-365">For more details and an example of using the methods of the **RoleEntryPoint** class, see [Compute Resource Consolidation Pattern](../patterns/compute-resource-consolidation.md).</span></span>

#### <a name="implementation-considerations"></a><span data-ttu-id="e9c7e-366">Considerações sobre a implementação</span><span class="sxs-lookup"><span data-stu-id="e9c7e-366">Implementation considerations</span></span>

<span data-ttu-id="e9c7e-367">Considere os seguintes pontos se você estiver implementando tarefas em segundo plano em uma função Web ou de trabalho:</span><span class="sxs-lookup"><span data-stu-id="e9c7e-367">Consider the following points if you are implementing background tasks in a web or worker role:</span></span>

* <span data-ttu-id="e9c7e-368">A implementação do método padrão **Run** na classe **RoleEntryPoint** contém uma chamada para **Thread.Sleep(Timeout.Infinite)** que mantém a função ativa indefinidamente.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-368">The default **Run** method implementation in the **RoleEntryPoint** class contains a call to **Thread.Sleep(Timeout.Infinite)** that keeps the role alive indefinitely.</span></span> <span data-ttu-id="e9c7e-369">Se substituir o método **Run** (que é geralmente necessário para executar tarefas em segundo plano), você não deverá permitir que o seu código saia do método, a menos que você deseje reciclar a instância de função.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-369">If you override the **Run** method (which is typically necessary to execute background tasks), you must not allow your code to exit from the method unless you want to recycle the role instance.</span></span>
* <span data-ttu-id="e9c7e-370">Uma implementação típica do método **Run** inclui código para iniciar cada uma das tarefas em segundo plano e um constructo de loop que verifica periodicamente o estado de todas as tarefas em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-370">A typical implementation of the **Run** method includes code to start each of the background tasks and a loop construct that periodically checks the state of all the background tasks.</span></span> <span data-ttu-id="e9c7e-371">Ela pode reiniciar qualquer falha ou monitorar os tokens de cancelamento que indicam que os trabalhos foram concluídos.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-371">It can restart any that fail or monitor for cancellation tokens that indicate that jobs have completed.</span></span>
* <span data-ttu-id="e9c7e-372">Se uma tarefa em segundo plano lançar uma exceção sem tratamento, essa tarefa deve ser reciclada, permitindo que outras tarefas de segundo plano na função continuem em execução.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-372">If a background task throws an unhandled exception, that task should be recycled while allowing any other background tasks in the role to continue running.</span></span> <span data-ttu-id="e9c7e-373">No entanto, se a exceção for causada por corrupção de objetos fora da tarefa, como armazenamento compartilhado, a exceção deverá ser tratada pela sua classe **RoleEntryPoint**, todas as tarefas devem ser canceladas e deve ser permitido que o método **Run** seja encerrado.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-373">However, if the exception is caused by corruption of objects outside the task, such as shared storage, the exception should be handled by your **RoleEntryPoint** class, all tasks should be cancelled, and the **Run** method should be allowed to end.</span></span> <span data-ttu-id="e9c7e-374">Em seguida, o Azure reiniciará a função.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-374">Azure will then restart the role.</span></span>
* <span data-ttu-id="e9c7e-375">Use o método **OnStop** para pausar ou interromper as tarefas em segundo plano e limpar os recursos.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-375">Use the **OnStop** method to pause or kill background tasks and clean up resources.</span></span> <span data-ttu-id="e9c7e-376">Isso pode envolver a interrupção de tarefas de longa execução ou com várias etapas.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-376">This might involve stopping long-running or multistep tasks.</span></span> <span data-ttu-id="e9c7e-377">É essencial considerar como isso pode ser feito para evitar inconsistências de dados.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-377">It is vital to consider how this can be done to avoid data inconsistencies.</span></span> <span data-ttu-id="e9c7e-378">Se uma instância de função para por algum motivo que não seja um desligamento iniciado pelo usuário, o código em execução no método **OnStop** deve ser concluído em cinco minutos antes da finalização forçada.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-378">If a role instance stops for any reason other than a user-initiated shutdown, the code running in the **OnStop** method must be completed within five minutes before it is forcibly terminated.</span></span> <span data-ttu-id="e9c7e-379">Certifique-se de que o seu código possa ser concluído naquele momento ou que ele possa tolerar não estar em execução até a conclusão.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-379">Ensure that your code can be completed in that time or can tolerate not running to completion.</span></span>  
* <span data-ttu-id="e9c7e-380">O Azure Load Balancer inicia o direcionamento do tráfego para a instância de função quando o método **RoleEntryPoint.OnStart** retorna o valor **true**.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-380">The Azure load balancer starts directing traffic to the role instance when the **RoleEntryPoint.OnStart** method returns the value **true**.</span></span> <span data-ttu-id="e9c7e-381">Portanto, considere colocar todo o código de inicialização no método **OnStart** para que as instâncias de função não inicializadas com êxito não recebam qualquer tráfego.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-381">Therefore, consider putting all your initialization code in the **OnStart** method so that role instances that do not successfully initialize will not receive any traffic.</span></span>
* <span data-ttu-id="e9c7e-382">Você pode usar as tarefas de inicialização além dos métodos da classe **RoleEntryPoint** .</span><span class="sxs-lookup"><span data-stu-id="e9c7e-382">You can use startup tasks in addition to the methods of the **RoleEntryPoint** class.</span></span> <span data-ttu-id="e9c7e-383">Você deve usar as tarefas de inicialização para inicializar as configurações que precisa alterar no balanceador de carga do Azure, pois essas tarefas serão executadas antes de a função receber quaisquer solicitações.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-383">You should use startup tasks to initialize any settings that you need to change in the Azure load balancer because these tasks will execute before the role receives any requests.</span></span> <span data-ttu-id="e9c7e-384">Para saber mais, confira [Executar Tarefas de Inicialização no Azure](/azure/cloud-services/cloud-services-startup-tasks/).</span><span class="sxs-lookup"><span data-stu-id="e9c7e-384">For more information, see [Run startup tasks in Azure](/azure/cloud-services/cloud-services-startup-tasks/).</span></span>
* <span data-ttu-id="e9c7e-385">Se houver um erro em uma tarefa de inicialização, isso poderá forçar a função a reiniciar continuamente.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-385">If there is an error in a startup task, it might force the role to continually restart.</span></span> <span data-ttu-id="e9c7e-386">Isso pode impedir que você execute uma Permuta de endereço de VIP (IP virtual) para uma versão preparada anteriormente porque a permuta requer acesso exclusivo à função.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-386">This can prevent you from performing a virtual IP (VIP) address swap back to a previously staged version because the swap requires exclusive access to the role.</span></span> <span data-ttu-id="e9c7e-387">Não é possível obtê-lo enquanto a função estiver reiniciando.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-387">This cannot be obtained while the role is restarting.</span></span> <span data-ttu-id="e9c7e-388">Para resolver esse problema:</span><span class="sxs-lookup"><span data-stu-id="e9c7e-388">To resolve this:</span></span>
  
  * <span data-ttu-id="e9c7e-389">Adicione o seguinte código ao início dos métodos **OnStart** e **Run** em sua função:</span><span class="sxs-lookup"><span data-stu-id="e9c7e-389">Add the following code to the beginning of the **OnStart** and **Run** methods in your role:</span></span>
    
    ```C#
    var freeze = CloudConfigurationManager.GetSetting("Freeze");
    if (freeze != null)
    {
     if (Boolean.Parse(freeze))
       {
         Thread.Sleep(System.Threading.Timeout.Infinite);
     }
    }
    ```
    
  * <span data-ttu-id="e9c7e-390">Adicione a definição da configuração **Congelar** como um valor booliano para os arquivos ServiceDefinition.csdef e ServiceConfiguration.\*.cscfg para a função e defina-a como **false**.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-390">Add the definition of the **Freeze** setting as a Boolean value to the ServiceDefinition.csdef and ServiceConfiguration.\*.cscfg files for the role and set it to **false**.</span></span> <span data-ttu-id="e9c7e-391">Se a função entra em um modo de reinicialização repetida, você pode alterar a configuração para **true** para congelar a execução da função e permitir que ela seja trocada por uma versão anterior.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-391">If the role goes into a repeated restart mode, you can change the setting to **true** to freeze role execution and allow it to be swapped with a previous version.</span></span>

#### <a name="more-information"></a><span data-ttu-id="e9c7e-392">Mais informações</span><span class="sxs-lookup"><span data-stu-id="e9c7e-392">More information</span></span>
* [<span data-ttu-id="e9c7e-393">Padrão de consolidação de recursos de computação</span><span class="sxs-lookup"><span data-stu-id="e9c7e-393">Compute Resource Consolidation Pattern</span></span>](../patterns/compute-resource-consolidation.md)
* [<span data-ttu-id="e9c7e-394">Introdução ao SDK do Azure WebJobs</span><span class="sxs-lookup"><span data-stu-id="e9c7e-394">Get started with the Azure WebJobs SDK</span></span>](/azure/app-service-web/websites-dotnet-webjobs-sdk-get-started/)


## <a name="partitioning"></a><span data-ttu-id="e9c7e-395">Particionamento</span><span class="sxs-lookup"><span data-stu-id="e9c7e-395">Partitioning</span></span>
<span data-ttu-id="e9c7e-396">Se decidir incluir tarefas em segundo plano em uma instância de computação existente (como um aplicativo Web, uma função Web, uma função de trabalho existente ou uma máquina virtual), você deverá considerar como isso afetará os atributos de qualidade da instância de computação e a própria tarefa em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-396">If you decide to include background tasks within an existing compute instance (such as a web app, web role, existing worker role, or virtual machine), you must consider how this will affect the quality attributes of the compute instance and the background task itself.</span></span> <span data-ttu-id="e9c7e-397">Esses fatores vão ajudar você a decidir se deseja colocalizar as tarefas com a instância de computação existente ou separá-las em outra instância de computação:</span><span class="sxs-lookup"><span data-stu-id="e9c7e-397">These factors will help you to decide whether to colocate the tasks with the existing compute instance or separate them out into a separate compute instance:</span></span>

* <span data-ttu-id="e9c7e-398">**Disponibilidade**: as tarefas em segundo plano podem não precisar ter o mesmo nível de disponibilidade que outras partes do aplicativo, em particular a interface do usuário e outras partes diretamente envolvidas na interação do usuário.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-398">**Availability**: Background tasks might not need to have the same level of availability as other parts of the application, in particular the UI and other parts that are directly involved in user interaction.</span></span> <span data-ttu-id="e9c7e-399">Tarefas em segundo plano podem ser mais tolerantes a falhas de conexão repetida, latência e outros fatores que afetam a disponibilidade porque as operações podem ser colocadas na fila.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-399">Background tasks might be more tolerant of latency, retried connection failures, and other factors that affect availability because the operations can be queued.</span></span> <span data-ttu-id="e9c7e-400">No entanto, deve haver capacidade suficiente para impedir o backup de solicitações que poderiam bloquear as filas e afetar o aplicativo como um todo.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-400">However, there must be sufficient capacity to prevent the backup of requests that could block queues and affect the application as a whole.</span></span>
* <span data-ttu-id="e9c7e-401">**Escalabilidade**: é provável que as tarefas em segundo plano tenham um requisito de escalabilidade diferente para a interface do usuário e as partes interativas do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-401">**Scalability**: Background tasks are likely to have a different scalability requirement than the UI and the interactive parts of the application.</span></span> <span data-ttu-id="e9c7e-402">Pode ser necessário o dimensionamento da interface do usuário para atender a picos de demanda, enquanto as tarefas pendentes em segundo plano podem ser concluídas em horários com menor demanda por menos instâncias de computação.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-402">Scaling the UI might be necessary to meet peaks in demand, while outstanding background tasks might be completed during less busy times by a fewer number of compute instances.</span></span>
* <span data-ttu-id="e9c7e-403">**Resiliência**: a falha de uma instância de computação que hospeda apenas tarefas em segundo plano poderá não afetar de modo fatal o aplicativo como um todo se as solicitações para essas tarefas puderem ser enfileiradas ou adiadas até que a tarefa esteja disponível novamente.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-403">**Resiliency**: Failure of a compute instance that just hosts background tasks might not fatally affect the application as a whole if the requests for these tasks can be queued or postponed until the task is available again.</span></span> <span data-ttu-id="e9c7e-404">Se as tarefas e/ou instância de computação puderem ser reiniciadas dentro de um intervalo apropriado, os usuários do aplicativo poderão não ser afetados.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-404">If the compute instance and/or tasks can be restarted within an appropriate interval, users of the application might not be affected.</span></span>
* <span data-ttu-id="e9c7e-405">**Segurança**: as tarefas em segundo plano podem ter requisitos de segurança ou restrições diferentes da interface de usuário ou de outras partes do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-405">**Security**: Background tasks might have different security requirements or restrictions than the UI or other parts of the application.</span></span> <span data-ttu-id="e9c7e-406">Ao usar uma instância de computação separada, você pode especificar um ambiente de segurança diferente para as tarefas.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-406">By using a separate compute instance, you can specify a different security environment for the tasks.</span></span> <span data-ttu-id="e9c7e-407">Você também pode usar os padrões como Gatekeeper para isolar as instâncias de computação em segundo plano da interface do usuário para maximizar a segurança e a separação.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-407">You can also use patterns such as Gatekeeper to isolate the background compute instances from the UI in order to maximize security and separation.</span></span>
* <span data-ttu-id="e9c7e-408">**Desempenho**: você pode escolher o tipo de instância de computação para as tarefas em segundo plano para fazer a correspondência especificamente aos requisitos de desempenho das tarefas.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-408">**Performance**: You can choose the type of compute instance for background tasks to specifically match the performance requirements of the tasks.</span></span> <span data-ttu-id="e9c7e-409">Isso poderá significar usar uma opção de computação mais barata se as tarefas não exigirem os mesmos recursos de processamento que a interface do usuário ou uma instância maior se eles exigirem recursos e capacidade adicionais.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-409">This might mean using a less expensive compute option if the tasks do not require the same processing capabilities as the UI, or a larger instance if they require additional capacity and resources.</span></span>
* <span data-ttu-id="e9c7e-410">**Gerenciabilidade**: as tarefas em segundo plano podem ter um ritmo diferente de desenvolvimento e implantação daquele do código do aplicativo principal ou da interface do usuário.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-410">**Manageability**: Background tasks might have a different development and deployment rhythm from the main application code or the UI.</span></span> <span data-ttu-id="e9c7e-411">Implantá-los para uma instância de computação separada pode simplificar as atualizações e o controle de versão.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-411">Deploying them to a separate compute instance can simplify updates and versioning.</span></span>
* <span data-ttu-id="e9c7e-412">**Custo**: adicionar as instâncias de computação para executar tarefas em segundo plano aumenta os custos de hospedagem.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-412">**Cost**: Adding compute instances to execute background tasks increases hosting costs.</span></span> <span data-ttu-id="e9c7e-413">Você deve considerar cuidadosamente a compensação entre a capacidade adicional e esses custos extras.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-413">You should carefully consider the trade-off between additional capacity and these extra costs.</span></span>

<span data-ttu-id="e9c7e-414">Para obter mais informações, consulte o [Padrão de eleição de líder](../patterns/leader-election.md) e o [Padrão de consumidores concorrentes](../patterns/competing-consumers.md).</span><span class="sxs-lookup"><span data-stu-id="e9c7e-414">For more information, see [Leader Election Pattern](../patterns/leader-election.md) and [Competing Consumers Pattern](../patterns/competing-consumers.md).</span></span>

## <a name="conflicts"></a><span data-ttu-id="e9c7e-415">Conflitos</span><span class="sxs-lookup"><span data-stu-id="e9c7e-415">Conflicts</span></span>
<span data-ttu-id="e9c7e-416">Se você tiver várias instâncias de um trabalho em segundo plano, será possível que elas competirão pelo acesso aos recursos e serviços, como bancos de dados e armazenamento.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-416">If you have multiple instances of a background job, it is possible that they will compete for access to resources and services, such as databases and storage.</span></span> <span data-ttu-id="e9c7e-417">Esse acesso simultâneo pode resultar na contenção de recursos, que pode causar conflitos na disponibilidade dos serviços e na integridade dos dados no armazenamento.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-417">This concurrent access can result in resource contention, which might cause conflicts in availability of the services and in the integrity of data in storage.</span></span> <span data-ttu-id="e9c7e-418">Você pode resolver a contenção de recursos usando uma abordagem de bloqueio pessimista.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-418">You can resolve resource contention by using a pessimistic locking approach.</span></span> <span data-ttu-id="e9c7e-419">Isso evita que instâncias concorrentes de uma tarefa acessem um serviço simultaneamente ou corrompam dados.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-419">This prevents competing instances of a task from concurrently accessing a service or corrupting data.</span></span>

<span data-ttu-id="e9c7e-420">Outra abordagem para resolver conflitos é definir tarefas em segundo plano como um singleton, para que haja sempre apenas uma instância em execução.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-420">Another approach to resolve conflicts is to define background tasks as a singleton, so that there is only ever one instance running.</span></span> <span data-ttu-id="e9c7e-421">No entanto, isso elimina os benefícios de desempenho e confiabilidade que uma configuração com várias instâncias pode fornecer.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-421">However, this eliminates the reliability and performance benefits that a multiple-instance configuration can provide.</span></span> <span data-ttu-id="e9c7e-422">Isso será especialmente verdadeiro se a interface do usuário puder fornecer trabalho suficiente para manter mais de uma tarefa em segundo plano ocupada.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-422">This is especially true if the UI can supply sufficient work to keep more than one background task busy.</span></span>

<span data-ttu-id="e9c7e-423">É vital garantir que a tarefa em segundo plano possa ser reiniciada automaticamente e tenha capacidade suficiente para lidar com picos de demanda.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-423">It is vital to ensure that the background task can automatically restart and that it has sufficient capacity to cope with peaks in demand.</span></span> <span data-ttu-id="e9c7e-424">Isso pode ser feito por meio da alocação de uma instância de computação com recursos suficientes, da implementação de um mecanismo de enfileiramento que pode armazenar solicitações para execução posterior quando a demanda diminui ou com uma combinação dessas técnicas.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-424">You can achieve this by allocating a compute instance with sufficient resources, by implementing a queueing mechanism that can store requests for later execution when demand decreases, or by using a combination of these techniques.</span></span>

## <a name="coordination"></a><span data-ttu-id="e9c7e-425">Coordenação</span><span class="sxs-lookup"><span data-stu-id="e9c7e-425">Coordination</span></span>
<span data-ttu-id="e9c7e-426">As tarefas em segundo plano podem ser complexas e demandar que várias tarefas individuais sejam executadas para produzir um resultado ou para atender a todos os requisitos.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-426">The background tasks might be complex and might require multiple individual tasks to execute to produce a result or to fulfil all the requirements.</span></span> <span data-ttu-id="e9c7e-427">É comum nesses cenários dividir a tarefa em subtarefas ou etapas menores que podem ser executadas por vários consumidores.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-427">It is common in these scenarios to divide the task into smaller discreet steps or subtasks that can be executed by multiple consumers.</span></span> <span data-ttu-id="e9c7e-428">Trabalhos com várias etapas podem ser mais eficientes e mais flexíveis porque as etapas individuais podem ser reutilizáveis em vários trabalhos.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-428">Multistep jobs can be more efficient and more flexible because individual steps might be reusable in multiple jobs.</span></span> <span data-ttu-id="e9c7e-429">Também é fácil adicionar, remover ou modificar a ordem das etapas.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-429">It is also easy to add, remove, or modify the order of the steps.</span></span>

<span data-ttu-id="e9c7e-430">A coordenação de várias tarefas e etapas pode ser desafiadora, mas existem três padrões comuns que você pode usar para orientar a implementação de uma solução:</span><span class="sxs-lookup"><span data-stu-id="e9c7e-430">Coordinating multiple tasks and steps can be challenging, but there are three common patterns that you can use to guide your implementation of a solution:</span></span>

* <span data-ttu-id="e9c7e-431">**Decomposição de uma tarefa em várias etapas reutilizáveis**.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-431">**Decomposing a task into multiple reusable steps**.</span></span> <span data-ttu-id="e9c7e-432">Pode ser necessário um aplicativo para executar uma variedade de tarefas de diferentes níveis de complexidade nas informações que elas processam.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-432">An application might be required to perform a variety of tasks of varying complexity on the information that it processes.</span></span> <span data-ttu-id="e9c7e-433">Uma abordagem simples, mas inflexível, para implementar esse aplicativo poderia ser executar o processamento como um módulo monolítico.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-433">A straightforward but inflexible approach to implementing this application might be to perform this processing as a monolithic module.</span></span> <span data-ttu-id="e9c7e-434">No entanto, essa abordagem provavelmente reduzirá as oportunidades para refatorar o código, otimizá-lo ou reutilizá-lo se partes do mesmo processamento forem necessárias em outros lugares no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-434">However, this approach is likely to reduce the opportunities for refactoring the code, optimizing it, or reusing it if parts of the same processing are required elsewhere within the application.</span></span> <span data-ttu-id="e9c7e-435">Para obter mais informações, consulte [Tubos e filtros padrão](../patterns/pipes-and-filters.md).</span><span class="sxs-lookup"><span data-stu-id="e9c7e-435">For more information, see [Pipes and Filters Pattern](../patterns/pipes-and-filters.md).</span></span>
* <span data-ttu-id="e9c7e-436">**Execução de gerenciamento das etapas de uma tarefa**.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-436">**Managing execution of the steps for a task**.</span></span> <span data-ttu-id="e9c7e-437">Um aplicativo pode executar tarefas que compõem uma série de etapas, algumas das quais podem invocar serviços remotos ou acessar recursos remotos.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-437">An application might perform tasks that comprise a number of steps (some of which might invoke remote services or access remote resources).</span></span> <span data-ttu-id="e9c7e-438">As etapas individuais podem ser independentes umas das outras, mas elas são organizadas pela lógica de aplicativo que implementa a tarefa.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-438">The individual steps might be independent of each other, but they are orchestrated by the application logic that implements the task.</span></span> <span data-ttu-id="e9c7e-439">Para obter mais informações, consulte o [Padrão do Supervisor do Agente do Agendador](../patterns/scheduler-agent-supervisor.md).</span><span class="sxs-lookup"><span data-stu-id="e9c7e-439">For more information, see [Scheduler Agent Supervisor Pattern](../patterns/scheduler-agent-supervisor.md).</span></span>
* <span data-ttu-id="e9c7e-440">**Gerenciamento de recuperação para as etapas de uma tarefa que falhou**.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-440">**Managing recovery for task steps that fail**.</span></span> <span data-ttu-id="e9c7e-441">Um aplicativo poderá precisar desfazer o trabalho executado por uma série de etapas, que juntas definem uma operação eventualmente consistente, se uma ou mais das etapas falhar.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-441">An application might need to undo the work that is performed by a series of steps (which together define an eventually consistent operation) if one or more of the steps fail.</span></span> <span data-ttu-id="e9c7e-442">Para obter mais informações, consulte [Padrão de transação de compensação](../patterns/compensating-transaction.md).</span><span class="sxs-lookup"><span data-stu-id="e9c7e-442">For more information, see [Compensating Transaction Pattern](../patterns/compensating-transaction.md).</span></span>


## <a name="resiliency-considerations"></a><span data-ttu-id="e9c7e-443">Considerações de resiliência</span><span class="sxs-lookup"><span data-stu-id="e9c7e-443">Resiliency considerations</span></span>
<span data-ttu-id="e9c7e-444">As tarefas em segundo plano devem ser resilientes para fornecer serviços confiáveis ao aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-444">Background tasks must be resilient in order to provide reliable services to the application.</span></span> <span data-ttu-id="e9c7e-445">Ao planejar e criar tarefas em segundo plano, considere os seguintes pontos:</span><span class="sxs-lookup"><span data-stu-id="e9c7e-445">When you are planning and designing background tasks, consider the following points:</span></span>

* <span data-ttu-id="e9c7e-446">As tarefas em segundo plano devem ser capazes de lidar normalmente com as reinicializações de função ou serviço sem corromper os dados ou apresentar inconsistência no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-446">Background tasks must be able to gracefully handle role or service restarts without corrupting data or introducing inconsistency into the application.</span></span> <span data-ttu-id="e9c7e-447">Para tarefas de execução longa ou com várias etapas, considere o uso de *pontos de verificação* salvando o estado de trabalhos no armazenamento persistente ou como mensagens em uma fila, se isso for apropriado.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-447">For long-running or multistep tasks, consider using *check pointing* by saving the state of jobs in persistent storage, or as messages in a queue if this is appropriate.</span></span> <span data-ttu-id="e9c7e-448">Por exemplo, você pode manter informações de estado em uma mensagem em uma fila e atualizar incrementalmente essas informações de estado com o andamento da tarefa para que a tarefa possa ser processada desde o último ponto de verificação conhecido, em vez de reiniciar desde o início.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-448">For example, you can persist state information in a message in a queue and incrementally update this state information with the task progress so that the task can be processed from the last known good checkpoint--instead of restarting from the beginning.</span></span> <span data-ttu-id="e9c7e-449">Ao usar as filas do Barramento de Serviço do Azure, você pode usar sessões de mensagens para habilitar o mesmo cenário.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-449">When using Azure Service Bus queues, you can use message sessions to enable the same scenario.</span></span> <span data-ttu-id="e9c7e-450">As sessões permitem salvar e recuperar o estado de processamento do aplicativo usando os métodos [SetState](https://docs.microsoft.com/dotnet/api/microsoft.servicebus.messaging.messagesession.setstate?view=azureservicebus-4.0.0) e [GetState](https://docs.microsoft.com/dotnet/api/microsoft.servicebus.messaging.messagesession.getstate?view=azureservicebus-4.0.0).</span><span class="sxs-lookup"><span data-stu-id="e9c7e-450">Sessions allow you to save and retrieve the application processing state by using the [SetState](https://docs.microsoft.com/dotnet/api/microsoft.servicebus.messaging.messagesession.setstate?view=azureservicebus-4.0.0) and [GetState](https://docs.microsoft.com/dotnet/api/microsoft.servicebus.messaging.messagesession.getstate?view=azureservicebus-4.0.0) methods.</span></span> <span data-ttu-id="e9c7e-451">Para obter mais informações sobre a criação de fluxos de trabalho e processos confiáveis de várias etapa, consulte [Padrão de Supervisor de Agente do Agendador](../patterns/scheduler-agent-supervisor.md).</span><span class="sxs-lookup"><span data-stu-id="e9c7e-451">For more information about designing reliable multistep processes and workflows, see [Scheduler Agent Supervisor Pattern](../patterns/scheduler-agent-supervisor.md).</span></span>
* <span data-ttu-id="e9c7e-452">Ao usar as funções de trabalho ou web para hospedar várias tarefas em segundo plano, projete a sua substituição do método **Run** para monitorar as tarefas com falhas ou paralisadas e reiniciá-las.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-452">When you use web or worker roles to host multiple background tasks, design your override of the **Run** method to monitor for failed or stalled tasks, and restart them.</span></span> <span data-ttu-id="e9c7e-453">Quando isso não for prático e você estiver usando uma função de trabalho, force a função de trabalho a reiniciar saindo do método **Run** .</span><span class="sxs-lookup"><span data-stu-id="e9c7e-453">Where this is not practical, and you are using a worker role, force the worker role to restart by exiting from the **Run** method.</span></span>
* <span data-ttu-id="e9c7e-454">Ao usar filas para se comunicar com as tarefas em segundo plano, as filas podem agir como um buffer para armazenar solicitações enviadas para as tarefas, enquanto o aplicativo estiver com carga maior que o normal.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-454">When you use queues to communicate with background tasks, the queues can act as a buffer to store requests that are sent to the tasks while the application is under higher than usual load.</span></span> <span data-ttu-id="e9c7e-455">Isso permite que as tarefas alcancem a interface do usuário durante os períodos menos ocupados.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-455">This allows the tasks to catch up with the UI during less busy periods.</span></span> <span data-ttu-id="e9c7e-456">Isso também significa que a reciclagem de função não bloqueará a interface do usuário.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-456">It also means that recycling the role will not block the UI.</span></span> <span data-ttu-id="e9c7e-457">Para obter mais informações, consulte o [Padrão de Nivelamento de Carga Baseado em Fila](../patterns/queue-based-load-leveling.md).</span><span class="sxs-lookup"><span data-stu-id="e9c7e-457">For more information, see [Queue-Based Load Leveling Pattern](../patterns/queue-based-load-leveling.md).</span></span> <span data-ttu-id="e9c7e-458">Se algumas tarefas forem mais importantes que outras, considere implementar o [Padrão de fila de prioridade](../patterns/priority-queue.md) para garantir que essas tarefas sejam executadas antes daquelas menos importantes.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-458">If some tasks are more important than others, consider implementing the [Priority Queue Pattern](../patterns/priority-queue.md) to ensure that these tasks run before less important ones.</span></span>
* <span data-ttu-id="e9c7e-459">As tarefas em segundo plano que são iniciadas ou processam mensagens devem ser projetadas para lidar com inconsistências, como mensagens que chegam fora de ordem, mensagens que causam um erro repetidas vezes (conhecidas como *mensagens suspeitas*) e mensagens que são entregues mais de uma vez.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-459">Background tasks that are initiated by messages or process messages must be designed to handle inconsistencies, such as messages arriving out of order, messages that repeatedly cause an error (often referred to as *poison messages*), and messages that are delivered more than once.</span></span> <span data-ttu-id="e9c7e-460">Considere o seguinte:</span><span class="sxs-lookup"><span data-stu-id="e9c7e-460">Consider the following:</span></span>
  * <span data-ttu-id="e9c7e-461">As mensagens que devem ser processadas em uma ordem específica, como aquelas que alteram os dados com base em seu valor existente (por exemplo, adicionando um valor a um valor existente), podem não chegar na ordem original que foram enviadas.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-461">Messages that must be processed in a specific order, such as those that change data based on the existing data value (for example, adding a value to an existing value), might not arrive in the original order in which they were sent.</span></span> <span data-ttu-id="e9c7e-462">Como alternativa, eles podem ser tratados por diferentes instâncias de uma tarefa em segundo plano em uma ordem diferente devido a cargas diferentes em cada instância.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-462">Alternatively, they might be handled by different instances of a background task in a different order due to varying loads on each instance.</span></span> <span data-ttu-id="e9c7e-463">As mensagens que devem ser processadas em uma ordem específica devem incluir um número de sequência, chave ou outro indicador que as tarefas em segundo plano podem usar para garantir que elas sejam processadas na ordem correta.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-463">Messages that must be processed in a specific order should include a sequence number, key, or some other indicator that background tasks can use to ensure that they are processed in the correct order.</span></span> <span data-ttu-id="e9c7e-464">Se estiver usando o Barramento de Serviço do Azure, você pode usar sessões de mensagens para garantir a ordem de entrega.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-464">If you are using Azure Service Bus, you can use message sessions to guarantee the order of delivery.</span></span> <span data-ttu-id="e9c7e-465">No entanto, é geralmente mais eficiente, quando possível, projetar o processo para que a ordem das mensagens não seja importante.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-465">However, it is usually more efficient, where possible, to design the process so that the message order is not important.</span></span>
  * <span data-ttu-id="e9c7e-466">Normalmente, uma tarefa em segundo plano inspecionará mensagens na fila, o que as oculta temporariamente de outros consumidores de mensagens.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-466">Typically, a background task will peek at messages in the queue, which temporarily hides them from other message consumers.</span></span> <span data-ttu-id="e9c7e-467">Em seguida, ela exclui as mensagens após elas serem processadas com êxito.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-467">Then it deletes the messages after they have been successfully processed.</span></span> <span data-ttu-id="e9c7e-468">Se uma tarefa em segundo plano falhar durante o processamento de uma mensagem, essa mensagem reaparecerá na fila após o tempo de inspeção terminar.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-468">If a background task fails when processing a message, that message will reappear on the queue after the peek time-out expires.</span></span> <span data-ttu-id="e9c7e-469">Ela será processada por outra instância da tarefa ou durante o próximo ciclo de processamento desta instância.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-469">It will be processed by another instance of the task or during the next processing cycle of this instance.</span></span> <span data-ttu-id="e9c7e-470">Se a mensagem causar consistentemente um erro ao consumidor, ela bloqueará a tarefa, a fila e, por fim, o próprio aplicativo quando a fila ficar cheia.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-470">If the message consistently causes an error in the consumer, it will block the task, the queue, and eventually the application itself when the queue becomes full.</span></span> <span data-ttu-id="e9c7e-471">Portanto, é vital detectar e remover mensagens suspeitas da fila.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-471">Therefore, it is vital to detect and remove poison messages from the queue.</span></span> <span data-ttu-id="e9c7e-472">Se você estiver usando o Barramento de Serviço do Azure, as mensagens que causam um erro podem ser movidas automaticamente ou manualmente para uma fila de inatividade associada.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-472">If you are using Azure Service Bus, messages that cause an error can be moved automatically or manually to an associated dead letter queue.</span></span>
  * <span data-ttu-id="e9c7e-473">As filas são garantidas no *mínimo uma vez* nos mecanismos de entrega, mas elas podem entregar a mesma mensagem mais de uma vez.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-473">Queues are guaranteed at *least once* delivery mechanisms, but they might deliver the same message more than once.</span></span> <span data-ttu-id="e9c7e-474">Além disso, se uma tarefa em segundo plano falhar após processar uma mensagem, mas antes de excluí-la da fila, a mensagem estará disponível para processamento novamente.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-474">In addition, if a background task fails after processing a message but before deleting it from the queue, the message will become available for processing again.</span></span> <span data-ttu-id="e9c7e-475">As tarefas em segundo plano devem ser idempotentes, o que significa que processar a mesma mensagem mais de uma vez não causa um erro ou inconsistência nos dados do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-475">Background tasks should be idempotent, which means that processing the same message more than once does not cause an error or inconsistency in the application’s data.</span></span> <span data-ttu-id="e9c7e-476">Algumas operações são naturalmente idempotentes, como a definição de um valor armazenado para um novo valor específico.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-476">Some operations are naturally idempotent, such as setting a stored value to a specific new value.</span></span> <span data-ttu-id="e9c7e-477">No entanto, operações como adicionar um valor a um valor armazenado existente sem verificar que o valor armazenado ainda é o mesmo quando a mensagem foi enviada originalmente causará inconsistências.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-477">However, operations such as adding a value to an existing stored value without checking that the stored value is still the same as when the message was originally sent will cause inconsistencies.</span></span> <span data-ttu-id="e9c7e-478">As filas do Barramento de Serviço do Azure podem ser configuradas para remover automaticamente as mensagens duplicadas.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-478">Azure Service Bus queues can be configured to automatically remove duplicated messages.</span></span>
  * <span data-ttu-id="e9c7e-479">Alguns sistemas de mensagens, como as filas de armazenamento do Azure e as filas do Barramento de Serviço do Azure, dão suporte a uma propriedade de contagem de fila que indica o número de vezes que uma mensagem foi lida na fila.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-479">Some messaging systems, such as Azure storage queues and Azure Service Bus queues, support a de-queue count property that indicates the number of times a message has been read from the queue.</span></span> <span data-ttu-id="e9c7e-480">Isso pode ser útil ao lidar com mensagens suspeitas e repetidas.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-480">This can be useful in handling repeated and poison messages.</span></span> <span data-ttu-id="e9c7e-481">Para obter mais informações, consulte [Prévia de mensagens assíncronas](https://msdn.microsoft.com/library/dn589781.aspx) e [Padrões de idempotência](https://blog.jonathanoliver.com/idempotency-patterns/).</span><span class="sxs-lookup"><span data-stu-id="e9c7e-481">For more information, see [Asynchronous Messaging Primer](https://msdn.microsoft.com/library/dn589781.aspx) and [Idempotency Patterns](https://blog.jonathanoliver.com/idempotency-patterns/).</span></span>

## <a name="scaling-and-performance-considerations"></a><span data-ttu-id="e9c7e-482">Considerações sobre dimensionamento e desempenho</span><span class="sxs-lookup"><span data-stu-id="e9c7e-482">Scaling and performance considerations</span></span>
<span data-ttu-id="e9c7e-483">As tarefas em segundo plano devem oferecer desempenho suficiente para garantir que elas não bloqueiem o aplicativo nem causem inconsistências devido à operação atrasada quando o sistema estiver sob carga.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-483">Background tasks must offer sufficient performance to ensure they do not block the application, or cause inconsistencies due to delayed operation when the system is under load.</span></span> <span data-ttu-id="e9c7e-484">Normalmente, o desempenho é aprimorado expandindo as instâncias de computação que hospedam as tarefas em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-484">Typically, performance is improved by scaling the compute instances that host the background tasks.</span></span> <span data-ttu-id="e9c7e-485">Quando estiver planejando e criando tarefas em segundo plano, considere os seguintes pontos ligados ao desempenho e à escalabilidade:</span><span class="sxs-lookup"><span data-stu-id="e9c7e-485">When you are planning and designing background tasks, consider the following points around scalability and performance:</span></span>

* <span data-ttu-id="e9c7e-486">O Azure dá suporte ao dimensionamento automático (escalar horizontalmente e escalar verticalmente de volta) com base na demanda atual e na carga ou em um planejamento predefinido, para Aplicativos Web, funções de trabalho e Web dos Serviços de Nuvem e implantações de Máquinas Virtuais hospedadas.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-486">Azure supports autoscaling (both scaling out and scaling back in) based on current demand and load--or on a predefined schedule, for Web Apps, Cloud Services web and worker roles, and Virtual Machines hosted deployments.</span></span> <span data-ttu-id="e9c7e-487">Use esse recurso para garantir que o aplicativo como um todo tenha recursos suficientes de desempenho enquanto minimiza os custos de tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-487">Use this feature to ensure that the application as a whole has sufficient performance capabilities while minimizing runtime costs.</span></span>
* <span data-ttu-id="e9c7e-488">Onde as tarefas em segundo plano têm uma funcionalidade de desempenho diferente de outras partes de um aplicativo de Serviços de Nuvem (por exemplo, a interface do usuário ou os componentes, como a camada de acesso a dados), hospedar as tarefas em segundo plano juntas em uma função de trabalho separada permite que as a interface do usuário e as funções da tarefa de segundo plano sejam dimensionadas de forma independente para gerenciar a carga.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-488">Where background tasks have a different performance capability from the other parts of a Cloud Services application (for example, the UI or components such as the data access layer), hosting the background tasks together in a separate worker role allows the UI and background task roles to scale independently to manage the load.</span></span> <span data-ttu-id="e9c7e-489">Se várias tarefas em segundo plano tiverem recursos de desempenho significativamente diferentes umas das outras, considere dividi-las em funções de trabalho separadas e dimensionar cada tipo de função independentemente.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-489">If multiple background tasks have significantly different performance capabilities from each other, consider dividing them into separate worker roles and scaling each role type independently.</span></span> <span data-ttu-id="e9c7e-490">No entanto, observe que isso pode aumentar os custos de tempo de execução em comparação a combinar todas as tarefas em menor funções.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-490">However, note that this might increase runtime costs compared to combining all the tasks into fewer roles.</span></span>
* <span data-ttu-id="e9c7e-491">Simplesmente dimensionar as funções pode não ser suficiente para evitar a perda de desempenho sob carga.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-491">Simply scaling the roles might not be sufficient to prevent loss of performance under load.</span></span> <span data-ttu-id="e9c7e-492">Talvez também seja necessário dimensionar as filas de armazenamento e outros recursos para impedir que um ponto único do canal geral de processamento se torne um gargalo.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-492">You might also need to scale storage queues and other resources to prevent a single point of the overall processing chain from becoming a bottleneck.</span></span> <span data-ttu-id="e9c7e-493">Além disso, considere outras limitações, como a taxa de transferência máxima de armazenamento e outros serviços do aplicativo e as tarefas em segundo plano relacionadas.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-493">Also, consider other limitations, such as the maximum throughput of storage and other services that the application and the background tasks rely on.</span></span>
* <span data-ttu-id="e9c7e-494">As tarefas em segundo plano devem ser projetadas para dimensionamento.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-494">Background tasks must be designed for scaling.</span></span> <span data-ttu-id="e9c7e-495">Por exemplo, eles devem ser capazes de detectar dinamicamente o número de filas de armazenamento em uso para escutar ou enviar mensagens à fila apropriada.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-495">For example, they must be able to dynamically detect the number of storage queues in use in order to listen on or send messages to the appropriate queue.</span></span>
* <span data-ttu-id="e9c7e-496">Por padrão, os WebJobs são dimensionados com a respectiva instância de Aplicativos Web do Azure associada.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-496">By default, WebJobs scale with their associated Azure Web Apps instance.</span></span> <span data-ttu-id="e9c7e-497">No entanto, se quiser que um WebJob seja executado como uma única instância, você poderá criar um arquivo Settings.job que contém os dados JSON **{ "is_singleton": true }**.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-497">However, if you want a WebJob to run as only a single instance, you can create a Settings.job file that contains the JSON data **{ "is_singleton": true }**.</span></span> <span data-ttu-id="e9c7e-498">Isso forçará o Azure a executar apenas uma instância do WebJob, mesmo se houver várias instâncias do aplicativo Web associado.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-498">This forces Azure to only run one instance of the WebJob, even if there are multiple instances of the associated web app.</span></span> <span data-ttu-id="e9c7e-499">Isso pode ser uma técnica útil para trabalhos agendados que devem ser executados como uma única instância.</span><span class="sxs-lookup"><span data-stu-id="e9c7e-499">This can be a useful technique for scheduled jobs that must run as only a single instance.</span></span>

## <a name="related-patterns"></a><span data-ttu-id="e9c7e-500">Padrões relacionados</span><span class="sxs-lookup"><span data-stu-id="e9c7e-500">Related patterns</span></span>
* [<span data-ttu-id="e9c7e-501">Prévia de mensagens assíncronas</span><span class="sxs-lookup"><span data-stu-id="e9c7e-501">Asynchronous Messaging Primer</span></span>](https://msdn.microsoft.com/library/dn589781.aspx)
* [<span data-ttu-id="e9c7e-502">Diretrizes de dimensionamento automático</span><span class="sxs-lookup"><span data-stu-id="e9c7e-502">Autoscaling Guidance</span></span>](https://msdn.microsoft.com/library/dn589774.aspx)
* [<span data-ttu-id="e9c7e-503">Padrão de transação de compensação</span><span class="sxs-lookup"><span data-stu-id="e9c7e-503">Compensating Transaction Pattern</span></span>](../patterns/compensating-transaction.md)
* [<span data-ttu-id="e9c7e-504">Padrão de consumidores concorrentes</span><span class="sxs-lookup"><span data-stu-id="e9c7e-504">Competing Consumers Pattern</span></span>](../patterns/competing-consumers.md)
* [<span data-ttu-id="e9c7e-505">Diretrizes de particionamento de computação</span><span class="sxs-lookup"><span data-stu-id="e9c7e-505">Compute Partitioning Guidance</span></span>](https://msdn.microsoft.com/library/dn589773.aspx)
* [<span data-ttu-id="e9c7e-506">Padrão de consolidação de recursos de computação</span><span class="sxs-lookup"><span data-stu-id="e9c7e-506">Compute Resource Consolidation Pattern</span></span>](https://msdn.microsoft.com/library/dn589778.aspx)
* [<span data-ttu-id="e9c7e-507">Padrão de gatekeeper</span><span class="sxs-lookup"><span data-stu-id="e9c7e-507">Gatekeeper Pattern</span></span>](../patterns/gatekeeper.md)
* [<span data-ttu-id="e9c7e-508">Padrão de eleição de líder</span><span class="sxs-lookup"><span data-stu-id="e9c7e-508">Leader Election Pattern</span></span>](../patterns/leader-election.md)
* [<span data-ttu-id="e9c7e-509">Padrão de filtros e tubos</span><span class="sxs-lookup"><span data-stu-id="e9c7e-509">Pipes and Filters Pattern</span></span>](../patterns/pipes-and-filters.md)
* [<span data-ttu-id="e9c7e-510">Padrão de fila de prioridade</span><span class="sxs-lookup"><span data-stu-id="e9c7e-510">Priority Queue Pattern</span></span>](../patterns/priority-queue.md)
* [<span data-ttu-id="e9c7e-511">Padrão de nivelamento de carga baseado em fila</span><span class="sxs-lookup"><span data-stu-id="e9c7e-511">Queue-based Load Leveling Pattern</span></span>](../patterns/queue-based-load-leveling.md)
* [<span data-ttu-id="e9c7e-512">Padrão de supervisor de agente do Agendador</span><span class="sxs-lookup"><span data-stu-id="e9c7e-512">Scheduler Agent Supervisor Pattern</span></span>](../patterns/scheduler-agent-supervisor.md)

## <a name="more-information"></a><span data-ttu-id="e9c7e-513">Mais informações</span><span class="sxs-lookup"><span data-stu-id="e9c7e-513">More information</span></span>
* [<span data-ttu-id="e9c7e-514">Executando tarefas em segundo plano</span><span class="sxs-lookup"><span data-stu-id="e9c7e-514">Executing Background Tasks</span></span>](https://msdn.microsoft.com/library/ff803365.aspx)
* <span data-ttu-id="e9c7e-515">[Ciclo de vida da função de Serviços de Nuvem do Azure](https://channel9.msdn.com/Series/Windows-Azure-Cloud-Services-Tutorials/Windows-Azure-Cloud-Services-Role-Lifecycle) (vídeo)</span><span class="sxs-lookup"><span data-stu-id="e9c7e-515">[Azure Cloud Services Role Lifecycle](https://channel9.msdn.com/Series/Windows-Azure-Cloud-Services-Tutorials/Windows-Azure-Cloud-Services-Role-Lifecycle) (video)</span></span>
* [<span data-ttu-id="e9c7e-516">O que é o SDK do Azure WebJobs</span><span class="sxs-lookup"><span data-stu-id="e9c7e-516">What is the Azure WebJobs SDK</span></span>](https://docs.microsoft.com/azure/app-service-web/websites-dotnet-webjobs-sdk)
* [<span data-ttu-id="e9c7e-517">Executar tarefas em segundo plano com o WebJobs</span><span class="sxs-lookup"><span data-stu-id="e9c7e-517">Run Background tasks with WebJobs</span></span>](https://docs.microsoft.com/azure/app-service-web/web-sites-create-web-jobs)
* [<span data-ttu-id="e9c7e-518">Filas do Azure e filas do Barramento de Serviço – comparações e contrastes</span><span class="sxs-lookup"><span data-stu-id="e9c7e-518">Azure Queues and Service Bus Queues - Compared and Contrasted</span></span>](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-azure-and-service-bus-queues-compared-contrasted)
* [<span data-ttu-id="e9c7e-519">Como habilitar o diagnóstico em um serviço de nuvem</span><span class="sxs-lookup"><span data-stu-id="e9c7e-519">How to Enable Diagnostics in a Cloud Service</span></span>](https://docs.microsoft.com/azure/cloud-services/cloud-services-dotnet-diagnostics)

