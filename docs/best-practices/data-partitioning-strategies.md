---
title: Estratégias de particionamento de dados
titleSuffix: Best practices for cloud applications
description: Orientação sobre como separar partições de dados para gerenciamento e acesso separados.
author: dragon119
ms.date: 11/04/2018
ms.topic: best-practice
ms.service: architecture-center
ms.subservice: cloud-fundamentals
ms.custom: seodec18
ms.openlocfilehash: bb810f549c78d16eabd4a96cd811cdc120cc8b6f
ms.sourcegitcommit: 579c39ff4b776704ead17a006bf24cd4cdc65edd
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/17/2019
ms.locfileid: "59640933"
---
# <a name="data-partitioning-strategies"></a><span data-ttu-id="193c5-103">Estratégias de particionamento de dados</span><span class="sxs-lookup"><span data-stu-id="193c5-103">Data partitioning strategies</span></span>

<span data-ttu-id="193c5-104">Este artigo descreve algumas estratégias de particionamento de dados em vários armazenamentos de dados do Azure.</span><span class="sxs-lookup"><span data-stu-id="193c5-104">This article describes some strategies for partitioning data in various Azure data stores.</span></span> <span data-ttu-id="193c5-105">Para obter diretrizes gerais sobre quando particionar os dados e sobre as melhores práticas, confira [Particionamento de dados](./data-partitioning.md)</span><span class="sxs-lookup"><span data-stu-id="193c5-105">For general guidance about when to partition data and best practices, see [Data partitioning](./data-partitioning.md)</span></span>

## <a name="partitioning-azure-sql-database"></a><span data-ttu-id="193c5-106">Particionamento do Banco de Dados SQL do Azure</span><span class="sxs-lookup"><span data-stu-id="193c5-106">Partitioning Azure SQL Database</span></span>

<span data-ttu-id="193c5-107">Um banco de dados SQL individual tem um limite para volume de dados que ele pode conter.</span><span class="sxs-lookup"><span data-stu-id="193c5-107">A single SQL database has a limit to the volume of data that it can contain.</span></span> <span data-ttu-id="193c5-108">A taxa de transferência é restrita por fatores de arquitetura e pelo número de conexões simultâneas que são permitidas.</span><span class="sxs-lookup"><span data-stu-id="193c5-108">Throughput is constrained by architectural factors and the number of concurrent connections that it supports.</span></span>

<span data-ttu-id="193c5-109">Os [Pools elásticos](/azure/sql-database/sql-database-elastic-pool) dão suporte ao dimensionamento horizontal para um banco de dados SQL.</span><span class="sxs-lookup"><span data-stu-id="193c5-109">[Elastic pools](/azure/sql-database/sql-database-elastic-pool) support horizontal scaling for a SQL database.</span></span> <span data-ttu-id="193c5-110">Usando pools elásticos, você pode particionar os dados em fragmentos que são distribuídos ente vários bancos de dados SQL.</span><span class="sxs-lookup"><span data-stu-id="193c5-110">Using elastic pools, you can partition your data into shards that are spread across multiple SQL databases.</span></span> <span data-ttu-id="193c5-111">Também é possível adicionar ou remover fragmentos à medida que o volume de dados com o qual você precisa lidar aumenta e diminui.</span><span class="sxs-lookup"><span data-stu-id="193c5-111">You can also add or remove shards as the volume of data that you need to handle grows and shrinks.</span></span> <span data-ttu-id="193c5-112">Os pools elásticos também podem ajudar a reduzir a contenção pela distribuição da carga nos bancos de dados.</span><span class="sxs-lookup"><span data-stu-id="193c5-112">Elastic pools can also help reduce contention by distributing the load across databases.</span></span>

<span data-ttu-id="193c5-113">Cada fragmento é implementado como um banco de dados SQL.</span><span class="sxs-lookup"><span data-stu-id="193c5-113">Each shard is implemented as a SQL database.</span></span> <span data-ttu-id="193c5-114">Um fragmento pode conter mais de um conjunto de dados (chamado de *shardlet*).</span><span class="sxs-lookup"><span data-stu-id="193c5-114">A shard can hold more than one dataset (called a *shardlet*).</span></span> <span data-ttu-id="193c5-115">Cada banco de dados mantém metadados que descrevem os shardlets que eles contêm.</span><span class="sxs-lookup"><span data-stu-id="193c5-115">Each database maintains metadata that describes the shardlets that it contains.</span></span> <span data-ttu-id="193c5-116">Um shardlet pode ser um único item de dados ou um grupo de itens que compartilham a mesma chave de shardlet.</span><span class="sxs-lookup"><span data-stu-id="193c5-116">A shardlet can be a single data item, or a group of items that share the same shardlet key.</span></span> <span data-ttu-id="193c5-117">Por exemplo, em um aplicativo multilocatário, a chave de shardlet poderá ser a ID do locatário, e todos os dados de um locatário podem ser mantidos no mesmo shardlet.</span><span class="sxs-lookup"><span data-stu-id="193c5-117">For example, in a multitenant application, the shardlet key can be the tenant ID, and all data for a tenant can be held in the same shardlet.</span></span>

<span data-ttu-id="193c5-118">Os aplicativos cliente são responsáveis pela associação de um conjunto de dados a uma chave de shardlet.</span><span class="sxs-lookup"><span data-stu-id="193c5-118">Client applications are responsible for associating a dataset with a shardlet key.</span></span> <span data-ttu-id="193c5-119">Um banco de dados SQL separado age como um gerenciador global de mapa de fragmentos.</span><span class="sxs-lookup"><span data-stu-id="193c5-119">A separate SQL database acts as a global shard map manager.</span></span> <span data-ttu-id="193c5-120">Esse banco de dados contém uma lista de todos os fragmentos e shardlets no sistema.</span><span class="sxs-lookup"><span data-stu-id="193c5-120">This database has a list of all the shards and shardlets in the system.</span></span> <span data-ttu-id="193c5-121">O aplicativo conecta-se ao banco de dados do gerenciador de mapa de fragmentos para obter uma cópia do mapa do fragmento.</span><span class="sxs-lookup"><span data-stu-id="193c5-121">The application connects to the shard map manager database to obtain a copy of the shard map.</span></span> <span data-ttu-id="193c5-122">Ele armazena o mapa de fragmentos em cache localmente e usa o mapa para rotear as solicitações de dados ao fragmento adequado.</span><span class="sxs-lookup"><span data-stu-id="193c5-122">It caches the shard map locally, and uses the map to route data requests to the appropriate shard.</span></span> <span data-ttu-id="193c5-123">Essa funcionalidade fica oculta atrás de uma série de APIs contidas na [Biblioteca de clientes do Banco de Dados Elástico](/azure/sql-database/sql-database-elastic-database-client-library), disponível para Java e .NET.</span><span class="sxs-lookup"><span data-stu-id="193c5-123">This functionality is hidden behind a series of APIs that are contained in the [Elastic Database client library](/azure/sql-database/sql-database-elastic-database-client-library), which is available for Java and .NET.</span></span>

<span data-ttu-id="193c5-124">Para obter mais informações sobre pools elásticos, confira [Escalando horizontalmente com o Banco de Dados SQL do Azure](/azure/sql-database/sql-database-elastic-scale-introduction).</span><span class="sxs-lookup"><span data-stu-id="193c5-124">For more information about elastic pools, see [Scaling out with Azure SQL Database](/azure/sql-database/sql-database-elastic-scale-introduction).</span></span>

<span data-ttu-id="193c5-125">Para reduzir a latência e melhorar a disponibilidade, você pode replicar o banco de dados do gerenciador do mapa de fragmentos global.</span><span class="sxs-lookup"><span data-stu-id="193c5-125">To reduce latency and improve availability, you can replicate the global shard map manager database.</span></span> <span data-ttu-id="193c5-126">Com tipos de preço Premium, você poderá configurar a replicação geográfica ativa para copiar os dados continuamente para os bancos de dados em diferentes regiões.</span><span class="sxs-lookup"><span data-stu-id="193c5-126">With the Premium pricing tiers, you can configure active geo-replication to continuously copy data to databases in different regions.</span></span>

<span data-ttu-id="193c5-127">Como alternativa, use a [Sincronização de Dados SQL do Azure](/azure/sql-database/sql-database-sync-data) ou o [Azure Data Factory](/azure/data-factory/) para replicar o banco de dados do gerenciador de mapa de fragmentos nas regiões.</span><span class="sxs-lookup"><span data-stu-id="193c5-127">Alternatively, use [Azure SQL Data Sync](/azure/sql-database/sql-database-sync-data) or [Azure Data Factory](/azure/data-factory/) to replicate the shard map manager database across regions.</span></span> <span data-ttu-id="193c5-128">Essa forma de replicação é executada periodicamente e é mais adequada se o mapa de fragmentos não for alterado com frequência e não requerer um tipo Premium.</span><span class="sxs-lookup"><span data-stu-id="193c5-128">This form of replication runs periodically and is more suitable if the shard map changes infrequently, and does not require Premium tier.</span></span>

<span data-ttu-id="193c5-129">O Banco de Dados Elástico oferece dois esquemas para mapear dados para shardlets e armazená-los em fragmentos:</span><span class="sxs-lookup"><span data-stu-id="193c5-129">Elastic Database provides two schemes for mapping data to shardlets and storing them in shards:</span></span>

- <span data-ttu-id="193c5-130">Um **mapa de fragmentos de lista** associa uma única chave a um shardlet.</span><span class="sxs-lookup"><span data-stu-id="193c5-130">A **list shard map** associates a single key to a shardlet.</span></span> <span data-ttu-id="193c5-131">Por exemplo, em um sistema multilocatário, os dados de cada locatário podem ser associados a uma chave exclusiva e armazenados em seu próprio shardlet.</span><span class="sxs-lookup"><span data-stu-id="193c5-131">For example, in a multitenant system, the data for each tenant can be associated with a unique key and stored in its own shardlet.</span></span> <span data-ttu-id="193c5-132">Para garantir o isolamento, cada shardlet pode ser mantido em seu próprio fragmento.</span><span class="sxs-lookup"><span data-stu-id="193c5-132">To guarantee isolation, each shardlet can be held within its own shard.</span></span>

    ![Usando um mapa de fragmentos da lista para armazenar dados de locatário em fragmentos separados](./images/data-partitioning/PointShardlet.png)

- <span data-ttu-id="193c5-134">Um **mapa de fragmentos de intervalo** associa um conjunto contíguo de valores de chave a um shardlet.</span><span class="sxs-lookup"><span data-stu-id="193c5-134">A **range shard map** associates a set of contiguous key values to a shardlet.</span></span> <span data-ttu-id="193c5-135">Por exemplo, você pode agrupar os dados para um conjunto de locatários (cada um com sua própria chave) dentro do mesmo shardlet.</span><span class="sxs-lookup"><span data-stu-id="193c5-135">For example, you can group the data for a set of tenants (each with their own key) within the same shardlet.</span></span> <span data-ttu-id="193c5-136">Esse esquema é mais barato que o primeiro porque os locatários compartilham o armazenamento de dados, mas apresenta menos isolamento.</span><span class="sxs-lookup"><span data-stu-id="193c5-136">This scheme is less expensive than the first, because tenants share data storage, but has less isolation.</span></span>

    ![Usando um mapa de fragmentos do intervalo para armazenar dados de um intervalo de locatários em um fragmento](./images/data-partitioning/RangeShardlet.png)

<span data-ttu-id="193c5-138">Um único fragmento pode conter os dados de vários shardlets.</span><span class="sxs-lookup"><span data-stu-id="193c5-138">A single shard can contain the data for several shardlets.</span></span> <span data-ttu-id="193c5-139">Por exemplo, você pode usar os shardlets da lista para armazenar dados de diferentes locatários não contíguos no mesmo fragmento.</span><span class="sxs-lookup"><span data-stu-id="193c5-139">For example, you can use list shardlets to store data for different non-contiguous tenants in the same shard.</span></span> <span data-ttu-id="193c5-140">Você também pode combinar shardlets de intervalo e de lista no mesmo fragmento, mesmo que eles sejam abordados por meio de mapas diferentes.</span><span class="sxs-lookup"><span data-stu-id="193c5-140">You can also mix range shardlets and list shardlets in the same shard, although they will be addressed through different maps.</span></span> <span data-ttu-id="193c5-141">O diagrama a seguir mostra essa abordagem:</span><span class="sxs-lookup"><span data-stu-id="193c5-141">The following diagram shows this approach:</span></span>

![Implementando vários mapas de fragmentos](./images/data-partitioning/MultipleShardMaps.png)

<span data-ttu-id="193c5-143">Pools elásticos tornam possível a adição ou remoção de fragmentos conforme o volume de dados é reduzido ou aumentado.</span><span class="sxs-lookup"><span data-stu-id="193c5-143">Elastic pools makes it possible to add and remove shards as the volume of data shrinks and grows.</span></span> <span data-ttu-id="193c5-144">Os aplicativos cliente podem criar e excluir fragmentos dinamicamente, além de atualizar o gerenciador de mapa de fragmentos de modo transparente.</span><span class="sxs-lookup"><span data-stu-id="193c5-144">Client applications can create and delete shards dynamically, and transparently update the shard map manager.</span></span> <span data-ttu-id="193c5-145">No entanto, a remoção de um fragmento é uma operação destrutiva que também requer a exclusão de todos os dados nesse fragmento.</span><span class="sxs-lookup"><span data-stu-id="193c5-145">However, removing a shard is a destructive operation that also requires deleting all the data in that shard.</span></span>

<span data-ttu-id="193c5-146">Se um aplicativo precisar dividir um fragmento em dois fragmentos separados ou combinar os fragmentos, use a [ferramenta de mesclagem/divisão](/azure/sql-database/sql-database-elastic-scale-overview-split-and-merge).</span><span class="sxs-lookup"><span data-stu-id="193c5-146">If an application needs to split a shard into two separate shards or combine shards, use the [split-merge tool](/azure/sql-database/sql-database-elastic-scale-overview-split-and-merge).</span></span> <span data-ttu-id="193c5-147">Essa ferramenta é executada como um serviço Web do Azure e migra os dados entre os fragmentos com segurança.</span><span class="sxs-lookup"><span data-stu-id="193c5-147">This tool runs as an Azure web service, and migrates data safely between shards.</span></span>

<span data-ttu-id="193c5-148">O esquema de particionamento pode afetar significativamente o desempenho do seu sistema.</span><span class="sxs-lookup"><span data-stu-id="193c5-148">The partitioning scheme can significantly affect the performance of your system.</span></span> <span data-ttu-id="193c5-149">Ele também pode afetar a taxa na qual os fragmentos devem ser adicionados ou removidos, ou esses dados devem ser reparticionados entre os fragmentos.</span><span class="sxs-lookup"><span data-stu-id="193c5-149">It can also affect the rate at which shards have to be added or removed, or that data must be repartitioned across shards.</span></span> <span data-ttu-id="193c5-150">Considere os seguintes pontos:</span><span class="sxs-lookup"><span data-stu-id="193c5-150">Consider the following points:</span></span>

- <span data-ttu-id="193c5-151">Agrupe os dados que são usados juntos no mesmo fragmento e evite operações que acessem os dados a partir de vários fragmentos.</span><span class="sxs-lookup"><span data-stu-id="193c5-151">Group data that is used together in the same shard, and avoid operations that access data from multiple shards.</span></span> <span data-ttu-id="193c5-152">Um fragmento é um banco de dados SQL em si mesmo, e as junções entre bancos de dados devem ser executadas no lado do cliente.</span><span class="sxs-lookup"><span data-stu-id="193c5-152">A shard is a SQL database in its own right, and cross-database joins must be performed on the client side.</span></span>

    <span data-ttu-id="193c5-153">Embora o banco de dados SQL não oferece suporte a junções entre bancos de dados, você pode usar as ferramentas de banco de dados Elástico para realizar [consultas de vários fragmentos](/azure/sql-database/sql-database-elastic-scale-multishard-querying).</span><span class="sxs-lookup"><span data-stu-id="193c5-153">Although SQL Database does not support cross-database joins, you can use the Elastic Database tools to perform [multi-shard queries](/azure/sql-database/sql-database-elastic-scale-multishard-querying).</span></span> <span data-ttu-id="193c5-154">Uma consulta de vários fragmentos envia consultas individuais para cada banco de dados e mescla os resultados.</span><span class="sxs-lookup"><span data-stu-id="193c5-154">A multi-shard query sends individual queries to each database and merges the results.</span></span>

- <span data-ttu-id="193c5-155">Não crie um sistema que tenha dependências entre fragmentos.</span><span class="sxs-lookup"><span data-stu-id="193c5-155">Don't design a system that has dependencies between shards.</span></span> <span data-ttu-id="193c5-156">Restrições de integridade referencial, gatilhos e procedimentos armazenados em um banco de dados não podem fazer referência a objetos em outro.</span><span class="sxs-lookup"><span data-stu-id="193c5-156">Referential integrity constraints, triggers, and stored procedures in one database cannot reference objects in another.</span></span>

- <span data-ttu-id="193c5-157">Se você tiver dados de referência que são usados com frequência por consultas, cogite replicar esses dados em fragmentos.</span><span class="sxs-lookup"><span data-stu-id="193c5-157">If you have reference data that is frequently used by queries, consider replicating this data across shards.</span></span> <span data-ttu-id="193c5-158">Essa abordagem pode remover a necessidade de unir os dados em bancos de dados.</span><span class="sxs-lookup"><span data-stu-id="193c5-158">This approach can remove the need to join data across databases.</span></span> <span data-ttu-id="193c5-159">O ideal é que esses dados sejam estáticos ou lentos para minimizar o esforço de replicação e reduzir a probabilidade de eles se tornarem obsoletos.</span><span class="sxs-lookup"><span data-stu-id="193c5-159">Ideally, such data should be static or slow-moving, to minimize the replication effort and reduce the chances of it becoming stale.</span></span>

- <span data-ttu-id="193c5-160">Shardlets que pertencem ao mesmo mapa de fragmentos devem ter o mesmo esquema.</span><span class="sxs-lookup"><span data-stu-id="193c5-160">Shardlets that belong to the same shard map should have the same schema.</span></span> <span data-ttu-id="193c5-161">Essa regra não é imposta pelo Banco de Dados SQL, mas o gerenciamento de dados e a consulta se tornam muito complexos se cada shardlet tiver um esquema diferente.</span><span class="sxs-lookup"><span data-stu-id="193c5-161">This rule is not enforced by SQL Database, but data management and querying becomes very complex if each shardlet has a different schema.</span></span> <span data-ttu-id="193c5-162">Em vez disso, crie mapas de fragmentos separados para cada esquema.</span><span class="sxs-lookup"><span data-stu-id="193c5-162">Instead, create separate shard maps for each schema.</span></span> <span data-ttu-id="193c5-163">Lembre-se de que os dados pertencentes a diferentes shardlets podem ser armazenados no mesmo fragmento.</span><span class="sxs-lookup"><span data-stu-id="193c5-163">Remember that data belonging to different shardlets can be stored in the same shard.</span></span>

- <span data-ttu-id="193c5-164">As operações transacionais contam com suporte apenas para dados dentro de um fragmento, não entre fragmentos.</span><span class="sxs-lookup"><span data-stu-id="193c5-164">Transactional operations are only supported for data within a shard, and not across shards.</span></span> <span data-ttu-id="193c5-165">As transações podem abranger shardlets, desde que façam parte do mesmo fragmento.</span><span class="sxs-lookup"><span data-stu-id="193c5-165">Transactions can span shardlets as long as they are part of the same shard.</span></span> <span data-ttu-id="193c5-166">Portanto, se a sua lógica de negócios precisar executar transações, armazene os dados no mesmo fragmento ou implemente a consistência eventual.</span><span class="sxs-lookup"><span data-stu-id="193c5-166">Therefore, if your business logic needs to perform transactions, either store the data in the same shard or implement eventual consistency.</span></span>

- <span data-ttu-id="193c5-167">Coloque os fragmentos próximos aos usuários que acessam os dados nesses fragmentos.</span><span class="sxs-lookup"><span data-stu-id="193c5-167">Place shards close to the users that access the data in those shards.</span></span> <span data-ttu-id="193c5-168">Essa estratégia ajuda a reduzir a latência.</span><span class="sxs-lookup"><span data-stu-id="193c5-168">This strategy helps reduce latency.</span></span>

- <span data-ttu-id="193c5-169">Evite ter uma combinação de fragmentos altamente ativos e fragmentos relativamente inativos.</span><span class="sxs-lookup"><span data-stu-id="193c5-169">Avoid having a mixture of highly active and relatively inactive shards.</span></span> <span data-ttu-id="193c5-170">Tente distribuir a carga uniformemente entre os fragmentos.</span><span class="sxs-lookup"><span data-stu-id="193c5-170">Try to spread the load evenly across shards.</span></span> <span data-ttu-id="193c5-171">Isso pode exigir o hash das chaves de fragmentação.</span><span class="sxs-lookup"><span data-stu-id="193c5-171">This might require hashing the sharding keys.</span></span> <span data-ttu-id="193c5-172">Se estiver localizando os fragmentos geograficamente, verifique se as chaves em hash são mapeadas para os shardlets mantidos em fragmentos armazenados próximo aos usuários que acessam esses dados.</span><span class="sxs-lookup"><span data-stu-id="193c5-172">If you are geo-locating shards, make sure that the hashed keys map to shardlets held in shards stored close to the users that access that data.</span></span>

### <a name="partitioning-azure-table-storage"></a><span data-ttu-id="193c5-173">Particionamento do armazenamento de tabela do Azure</span><span class="sxs-lookup"><span data-stu-id="193c5-173">Partitioning Azure table storage</span></span>

<span data-ttu-id="193c5-174">O armazenamento de tabelas do Azure é um repositório de chave/valor que foi desenvolvido em torno do particionamento.</span><span class="sxs-lookup"><span data-stu-id="193c5-174">Azure table storage is a key-value store that's designed around partitioning.</span></span> <span data-ttu-id="193c5-175">Todas as entidades são armazenadas em uma partição e as partições são gerenciadas internamente pelo armazenamento de tabela do Azure.</span><span class="sxs-lookup"><span data-stu-id="193c5-175">All entities are stored in a partition, and partitions are managed internally by Azure table storage.</span></span> <span data-ttu-id="193c5-176">Cada entidade armazenada em uma tabela deve fornecer uma chave de duas partes que inclui:</span><span class="sxs-lookup"><span data-stu-id="193c5-176">Each entity stored in a table must provide a two-part key that includes:</span></span>

- <span data-ttu-id="193c5-177">**A chave de partição**.</span><span class="sxs-lookup"><span data-stu-id="193c5-177">**The partition key**.</span></span> <span data-ttu-id="193c5-178">Esse é um valor de cadeia de caracteres que determina em qual partição o armazenamento de tabelas do Azure colocará a entidade.</span><span class="sxs-lookup"><span data-stu-id="193c5-178">This is a string value that determines the partition where Azure table storage will place the entity.</span></span> <span data-ttu-id="193c5-179">Todas as entidades com a mesma chave de partição são armazenadas na mesma partição.</span><span class="sxs-lookup"><span data-stu-id="193c5-179">All entities with the same partition key are stored in the same partition.</span></span>

- <span data-ttu-id="193c5-180">**A chave de linha**.</span><span class="sxs-lookup"><span data-stu-id="193c5-180">**The row key**.</span></span> <span data-ttu-id="193c5-181">Trata-se de um valor de cadeia de caracteres que identifica a entidade na partição.</span><span class="sxs-lookup"><span data-stu-id="193c5-181">This is a string value that identifies the entity within the partition.</span></span> <span data-ttu-id="193c5-182">Todas as entidades em uma partição são classificadas lexicalmente, em ordem crescente, por essa chave.</span><span class="sxs-lookup"><span data-stu-id="193c5-182">All entities within a partition are sorted lexically, in ascending order, by this key.</span></span> <span data-ttu-id="193c5-183">A combinação de chave de linha/chave de partição deve ser exclusiva para cada entidade e não pode exceder 1 KB.</span><span class="sxs-lookup"><span data-stu-id="193c5-183">The partition key/row key combination must be unique for each entity and cannot exceed 1 KB in length.</span></span>

<span data-ttu-id="193c5-184">Se uma entidade for adicionada a uma tabela com uma chave de partição não usada anteriormente, o armazenamento de tabelas do Azure criará uma nova partição para esta entidade.</span><span class="sxs-lookup"><span data-stu-id="193c5-184">If an entity is added to a table with a previously unused partition key, Azure table storage creates a new partition for this entity.</span></span> <span data-ttu-id="193c5-185">Outras entidades com a mesma chave de partição serão armazenadas na mesma partição.</span><span class="sxs-lookup"><span data-stu-id="193c5-185">Other entities with the same partition key will be stored in the same partition.</span></span>

<span data-ttu-id="193c5-186">Esse mecanismo implementa de modo efetivo uma estratégia de escala horizontal automática.</span><span class="sxs-lookup"><span data-stu-id="193c5-186">This mechanism effectively implements an automatic scale-out strategy.</span></span> <span data-ttu-id="193c5-187">Cada partição é armazenada no mesmo servidor em um datacenter do Azure para ajudar a garantir que as consultas que recuperam dados de uma única partição sejam executadas rapidamente.</span><span class="sxs-lookup"><span data-stu-id="193c5-187">Each partition is stored on the same server in an Azure datacenter to help ensure that queries that retrieve data from a single partition run quickly.</span></span>

<span data-ttu-id="193c5-188">A Microsoft publicou [alvos de escalabilidade] para o Armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="193c5-188">Microsoft has published [scalability targets] for Azure Storage.</span></span> <span data-ttu-id="193c5-189">Se for provável que o sistema exceda esses limites, considere dividir as entidades em várias tabelas.</span><span class="sxs-lookup"><span data-stu-id="193c5-189">If your system is likely to exceed these limits, consider splitting entities into multiple tables.</span></span> <span data-ttu-id="193c5-190">Use o particionamento vertical para dividir os campos nos grupos que têm mais probabilidade de serem acessados juntos.</span><span class="sxs-lookup"><span data-stu-id="193c5-190">Use vertical partitioning to divide the fields into the groups that are most likely to be accessed together.</span></span>

<span data-ttu-id="193c5-191">O diagrama a seguir mostra a estrutura lógica de um exemplo de conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="193c5-191">The following diagram shows the logical structure of an example storage account.</span></span> <span data-ttu-id="193c5-192">A conta de armazenamento contém três tabelas: Informações de clientes, Informações de produto e Informações do pedido.</span><span class="sxs-lookup"><span data-stu-id="193c5-192">The storage account contains three tables: Customer Info, Product Info, and Order Info.</span></span>

![As tabelas e partições em um exemplo de conta de armazenamento](./images/data-partitioning/TableStorage.png)

<span data-ttu-id="193c5-194">Cada tabela tem várias partições.</span><span class="sxs-lookup"><span data-stu-id="193c5-194">Each table has multiple partitions.</span></span>

- <span data-ttu-id="193c5-195">Na tabela Informações de clientes, os dados são particionados de acordo com a cidade em que o cliente está localizado.</span><span class="sxs-lookup"><span data-stu-id="193c5-195">In the Customer Info table, the data is partitioned according to the city where the customer is located.</span></span> <span data-ttu-id="193c5-196">A chave de linha contém a ID do cliente.</span><span class="sxs-lookup"><span data-stu-id="193c5-196">The row key contains the customer ID.</span></span>
- <span data-ttu-id="193c5-197">Na tabela de Informações de produtos, os produtos são particionados por categoria e a chave de linha contém o número do produto.</span><span class="sxs-lookup"><span data-stu-id="193c5-197">In the Product Info table, products are partitioned by product category, and the row key contains the product number.</span></span>
- <span data-ttu-id="193c5-198">Na tabela de Informações de pedidos, os pedidos são particionados por data e a chave de linha especifica o horário em que o pedido foi recebido.</span><span class="sxs-lookup"><span data-stu-id="193c5-198">In the Order Info table, the orders are partitioned by order date, and the row key specifies the time the order was received.</span></span> <span data-ttu-id="193c5-199">Observe que todos os dados são ordenados pela chave de linha em cada partição.</span><span class="sxs-lookup"><span data-stu-id="193c5-199">Note that all data is ordered by the row key in each partition.</span></span>

<span data-ttu-id="193c5-200">Considere os seguintes pontos ao criar entidades para o armazenamento de tabelas do Azure:</span><span class="sxs-lookup"><span data-stu-id="193c5-200">Consider the following points when you design your entities for Azure table storage:</span></span>

- <span data-ttu-id="193c5-201">Selecione uma chave de partição e chave de linha de como os dados são acessados.</span><span class="sxs-lookup"><span data-stu-id="193c5-201">Select a partition key and row key by how the data is accessed.</span></span> <span data-ttu-id="193c5-202">Escolha uma combinação de chave de linha/chave de partição que seja compatível com a maioria de suas consultas.</span><span class="sxs-lookup"><span data-stu-id="193c5-202">Choose a partition key/row key combination that supports the majority of your queries.</span></span> <span data-ttu-id="193c5-203">As consultas mais eficientes recuperam dados especificando a chave de partição e a chave de linha.</span><span class="sxs-lookup"><span data-stu-id="193c5-203">The most efficient queries retrieve data by specifying the partition key and the row key.</span></span> <span data-ttu-id="193c5-204">As consultas que especificam uma chave de partição e um intervalo de chaves de linha podem ser concluídas por meio da verificação de uma única partição.</span><span class="sxs-lookup"><span data-stu-id="193c5-204">Queries that specify a partition key and a range of row keys can be completed by scanning a single partition.</span></span> <span data-ttu-id="193c5-205">Isso é relativamente rápido, pois os dados são mantidos na ordem da chave de linha.</span><span class="sxs-lookup"><span data-stu-id="193c5-205">This is relatively fast because the data is held in row key order.</span></span> <span data-ttu-id="193c5-206">Se as consultas não especificarem qual partição verificar, todas devem ser verificadas.</span><span class="sxs-lookup"><span data-stu-id="193c5-206">If queries don't specify which partition to scan, every partition must be scanned.</span></span>

- <span data-ttu-id="193c5-207">Se uma entidade tiver uma chave natural, use-a como a chave de partição e especifique uma cadeia de caracteres vazia como a chave de linha.</span><span class="sxs-lookup"><span data-stu-id="193c5-207">If an entity has one natural key, then use it as the partition key and specify an empty string as the row key.</span></span> <span data-ttu-id="193c5-208">Se uma entidade tiver uma chave composta que consista em duas propriedades, selecione a propriedade com alteração mais lenta como a chave de partição e a outra como a chave de linha.</span><span class="sxs-lookup"><span data-stu-id="193c5-208">If an entity has a composite key consisting of two properties, select the slowest changing property as the partition key and the other as the row key.</span></span> <span data-ttu-id="193c5-209">Se uma entidade tiver mais de duas propriedades de chave, use uma concatenação de propriedades para fornecer as chaves de partição e de linha.</span><span class="sxs-lookup"><span data-stu-id="193c5-209">If an entity has more than two key properties, use a concatenation of properties to provide the partition and row keys.</span></span>

- <span data-ttu-id="193c5-210">Se você executa regularmente consultas que pesquisam dados usando campos que não sejam as chaves de partição e de linha, considere a implementação do [Padrão da tabela de índice](../patterns/index-table.md) ou cogite usar um armazenamento de dados diferente que dê suporte ao índice, como o Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="193c5-210">If you regularly perform queries that look up data by using fields other than the partition and row keys, consider implementing the [Index Table pattern](../patterns/index-table.md), or consider using a different data store that supports indexing, such as Cosmos DB.</span></span>

- <span data-ttu-id="193c5-211">Se você gerar chaves de partição usando uma sequência monotônica (como “0001”, “0002”, “0003”) e cada partição contiver apenas uma quantidade limitada de dados, o armazenamento de tabelas do Azure poderá agrupar fisicamente essas partições no mesmo servidor.</span><span class="sxs-lookup"><span data-stu-id="193c5-211">If you generate partition keys by using a monotonic sequence (such as "0001", "0002", "0003") and each partition only contains a limited amount of data, Azure table storage can physically group these partitions together on the same server.</span></span> <span data-ttu-id="193c5-212">O Armazenamento do Azure pressupõe que o aplicativo tem mais probabilidade de executar consultas em um intervalo contíguo de partições (consultas do intervalo) e é otimizado para esse caso.</span><span class="sxs-lookup"><span data-stu-id="193c5-212">Azure Storage assumes that the application is most likely to perform queries across a contiguous range of partitions (range queries) and is optimized for this case.</span></span> <span data-ttu-id="193c5-213">No entanto, essa abordagem pode levar a pontos de acesso, pois todas as inserções das novas entidades provavelmente estão concentradas em uma extremidade dos intervalos contíguos.</span><span class="sxs-lookup"><span data-stu-id="193c5-213">However, this approach can lead to hotspots, because all insertions of new entities are likely to be concentrated at one end the contiguous range.</span></span> <span data-ttu-id="193c5-214">Ela também pode reduzir a escalabilidade.</span><span class="sxs-lookup"><span data-stu-id="193c5-214">It can also reduce scalability.</span></span> <span data-ttu-id="193c5-215">Para distribuir a carga mais uniformemente, cogite fazer o hash da chave de partição.</span><span class="sxs-lookup"><span data-stu-id="193c5-215">To spread the load more evenly, consider hashing the partition key.</span></span>

- <span data-ttu-id="193c5-216">O armazenamento de tabela do Azure dá suporte a operações transacionais para entidades que pertencem à mesma partição.</span><span class="sxs-lookup"><span data-stu-id="193c5-216">Azure table storage supports transactional operations for entities that belong to the same partition.</span></span> <span data-ttu-id="193c5-217">Um aplicativo pode executar várias operações de inserção, atualização, exclusão, substituição ou mesclagem como uma unidade atômica, desde que a transação não inclua mais de 100 entidades e que a carga da solicitação não exceda 4 MB.</span><span class="sxs-lookup"><span data-stu-id="193c5-217">An application can perform multiple insert, update, delete, replace, or merge operations as an atomic unit, as long as the transaction doesn't include more than 100 entities and the payload of the request doesn't exceed 4 MB.</span></span> <span data-ttu-id="193c5-218">As operações que abrangem várias partições não são transacionais e podem exigir que você implemente a consistência eventual.</span><span class="sxs-lookup"><span data-stu-id="193c5-218">Operations that span multiple partitions are not transactional, and might require you to implement eventual consistency.</span></span> <span data-ttu-id="193c5-219">Para obter mais informações sobre armazenamento de tabela e transações, confira [Executar transações de grupo de entidade].</span><span class="sxs-lookup"><span data-stu-id="193c5-219">For more information about table storage and transactions, see [Performing entity group transactions].</span></span>

- <span data-ttu-id="193c5-220">Considere a granularidade da chave de partição:</span><span class="sxs-lookup"><span data-stu-id="193c5-220">Consider the granularity of the partition key:</span></span>

  - <span data-ttu-id="193c5-221">O uso da mesma chave de partição para todas as entidades resulta em uma única partição que é mantida em um servidor.</span><span class="sxs-lookup"><span data-stu-id="193c5-221">Using the same partition key for every entity results in a single partition that's held on one server.</span></span> <span data-ttu-id="193c5-222">Isso impede a escala horizontal da partição e concentra a carga em um único servidor.</span><span class="sxs-lookup"><span data-stu-id="193c5-222">This prevents the partition from scaling out and focuses the load on a single server.</span></span> <span data-ttu-id="193c5-223">Como resultado, essa abordagem só é adequada para armazenar uma pequena quantidade de entidades.</span><span class="sxs-lookup"><span data-stu-id="193c5-223">As a result, this approach is only suitable for storing a small number of entities.</span></span> <span data-ttu-id="193c5-224">No entanto, ela garante que todas as entidades possam participar das transações do grupo de entidade.</span><span class="sxs-lookup"><span data-stu-id="193c5-224">However, it does ensure that all entities can participate in entity group transactions.</span></span>

  - <span data-ttu-id="193c5-225">Usar uma chave de partição exclusiva para todas as entidades faz com que o serviço de armazenamento de tabelas crie uma partição separada para cada entidade, possivelmente, resultando em uma grande quantidade de partições pequenas.</span><span class="sxs-lookup"><span data-stu-id="193c5-225">Using a unique partition key for every entity causes the table storage service to create a separate partition for each entity, possibly resulting in a large number of small partitions.</span></span> <span data-ttu-id="193c5-226">Essa abordagem é mais escalonável do que usar uma chave de partição única, mas as transações de grupo da entidade não são possíveis.</span><span class="sxs-lookup"><span data-stu-id="193c5-226">This approach is more scalable than using a single partition key, but entity group transactions are not possible.</span></span> <span data-ttu-id="193c5-227">Além disso, as consultas que buscam mais de uma entidade podem envolver a leitura em mais de um servidor.</span><span class="sxs-lookup"><span data-stu-id="193c5-227">Also, queries that fetch more than one entity might involve reading from more than one server.</span></span> <span data-ttu-id="193c5-228">No entanto, se o aplicativo executar consultas do intervalo, o uso de uma sequência monotônica para chaves de partição pode ajudar a otimizar essas consultas.</span><span class="sxs-lookup"><span data-stu-id="193c5-228">However, if the application performs range queries, then using a monotonic sequence for the partition keys might help to optimize these queries.</span></span>

  - <span data-ttu-id="193c5-229">Compartilhar a chave da partição entre um subconjunto de entidades torna possível o agrupamento de entidades relacionadas na mesma partição.</span><span class="sxs-lookup"><span data-stu-id="193c5-229">Sharing the partition key across a subset of entities makes it possible to group related entities in the same partition.</span></span> <span data-ttu-id="193c5-230">As operações que envolvem entidades relacionadas podem ser executadas usando transações de grupo da entidade, e as consultas que buscam um conjunto de entidades relacionadas podem ser atendidas acessando um único servidor.</span><span class="sxs-lookup"><span data-stu-id="193c5-230">Operations that involve related entities can be performed by using entity group transactions, and queries that fetch a set of related entities can be satisfied by accessing a single server.</span></span>

<span data-ttu-id="193c5-231">Para obter mais informações, confira o [Guia de design de armazenamento do Azure].</span><span class="sxs-lookup"><span data-stu-id="193c5-231">For more information, see [Azure storage table design guide].</span></span>

## <a name="partitioning-azure-blob-storage"></a><span data-ttu-id="193c5-232">Particionamento do armazenamento de blobs do Azure</span><span class="sxs-lookup"><span data-stu-id="193c5-232">Partitioning Azure blob storage</span></span>

<span data-ttu-id="193c5-233">O armazenamento de blobs do Azure torna possível manter objetos binários grandes.</span><span class="sxs-lookup"><span data-stu-id="193c5-233">Azure blob storage makes it possible to hold large binary objects.</span></span> <span data-ttu-id="193c5-234">Use blobs de blocos em cenários quando for necessário fazer upload ou download de grandes volumes de dados rapidamente.</span><span class="sxs-lookup"><span data-stu-id="193c5-234">Use block blobs in scenarios when you need to upload or download large volumes of data quickly.</span></span> <span data-ttu-id="193c5-235">Use blobs de páginas para aplicativos que exigem o acesso aleatório em vez do acesso serial a partes dos dados.</span><span class="sxs-lookup"><span data-stu-id="193c5-235">Use page blobs for applications that require random rather than serial access to parts of the data.</span></span>

<span data-ttu-id="193c5-236">Cada blob (de blocos ou páginas) é mantido em um contêiner em uma conta de armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="193c5-236">Each blob (either block or page) is held in a container in an Azure storage account.</span></span> <span data-ttu-id="193c5-237">Você pode usar contêineres para agrupar blobs relacionados que tenham os mesmos requisitos de segurança.</span><span class="sxs-lookup"><span data-stu-id="193c5-237">You can use containers to group related blobs that have the same security requirements.</span></span> <span data-ttu-id="193c5-238">Esse agrupamento é lógico em vez de físico.</span><span class="sxs-lookup"><span data-stu-id="193c5-238">This grouping is logical rather than physical.</span></span> <span data-ttu-id="193c5-239">Dentro de um contêiner, cada blob tem um nome exclusivo.</span><span class="sxs-lookup"><span data-stu-id="193c5-239">Inside a container, each blob has a unique name.</span></span>

<span data-ttu-id="193c5-240">A chave de partição de um blob é o nome da conta + nome do contêiner + nome do blob.</span><span class="sxs-lookup"><span data-stu-id="193c5-240">The partition key for a blob is account name + container name + blob name.</span></span> <span data-ttu-id="193c5-241">A chave de partição é usada para particionar dados em intervalos e esses intervalos têm balanceamento de carga em todo o sistema.</span><span class="sxs-lookup"><span data-stu-id="193c5-241">The partition key is used to partition data into ranges and these ranges are load-balanced across the system.</span></span> <span data-ttu-id="193c5-242">BLOBs podem ser distribuídos em vários servidores para escalar horizontalmente o acesso a eles, mas um único blob só pode ser atendido por um único servidor.</span><span class="sxs-lookup"><span data-stu-id="193c5-242">Blobs can be distributed across many servers in order to scale out access to them, but a single blob can only be served by a single server.</span></span>

<span data-ttu-id="193c5-243">Se o esquema de nomenclatura usa os carimbos de data/hora ou identificadores numéricos, ele pode levar ao tráfego excessivo direcionado a uma partição, não permitindo que o sistema faça o balanceamento de carga efetivamente.</span><span class="sxs-lookup"><span data-stu-id="193c5-243">If your naming scheme uses timestamps or numerical identifiers, it can lead to excessive traffic going to one partition, limiting the system from effectively load balancing.</span></span> <span data-ttu-id="193c5-244">Por exemplo, se você tiver operações diárias que usam um objeto de blob com um carimbo de data/hora, como *aaaa-mm-dd*, todo o tráfego para essa operação iria para um único servidor de partição.</span><span class="sxs-lookup"><span data-stu-id="193c5-244">For instance, if you have daily operations that use a blob object with a timestamp such as *yyyy-mm-dd*, all the traffic for that operation would go to a single partition server.</span></span> <span data-ttu-id="193c5-245">Em vez disso, cogite prefixar o nome com um hash de 3 dígitos.</span><span class="sxs-lookup"><span data-stu-id="193c5-245">Instead, consider prefixing the name with a 3-digit hash.</span></span> <span data-ttu-id="193c5-246">Para obter mais informações, confira [ Convenção de nomenclatura de partição](/azure/storage/common/storage-performance-checklist#subheading47)</span><span class="sxs-lookup"><span data-stu-id="193c5-246">For more information, see [Partition Naming Convention](/azure/storage/common/storage-performance-checklist#subheading47)</span></span>

<span data-ttu-id="193c5-247">As ações de gravação de um único bloco ou página são atômicas, mas as operações que abrangem blocos, páginas ou blobs não são.</span><span class="sxs-lookup"><span data-stu-id="193c5-247">The actions of writing a single block or page are atomic, but operations that span blocks, pages, or blobs are not.</span></span> <span data-ttu-id="193c5-248">Se precisar garantir a consistência ao executar operações de gravação em blocos, páginas e blobs, remova um bloco de gravação usando uma concessão de blob.</span><span class="sxs-lookup"><span data-stu-id="193c5-248">If you need to ensure consistency when performing write operations across blocks, pages, and blobs, take out a write lock by using a blob lease.</span></span>

## <a name="partitioning-azure-storage-queues"></a><span data-ttu-id="193c5-249">Particionamento de filas de armazenamento do Azure</span><span class="sxs-lookup"><span data-stu-id="193c5-249">Partitioning Azure storage queues</span></span>

<span data-ttu-id="193c5-250">As filas de armazenamento do Azure permitem implementar mensagens assíncronas entre processos.</span><span class="sxs-lookup"><span data-stu-id="193c5-250">Azure storage queues enable you to implement asynchronous messaging between processes.</span></span> <span data-ttu-id="193c5-251">Uma conta de armazenamento do Azure pode conter um número ilimitado de filas e cada fila pode conter um número ilimitado de mensagens.</span><span class="sxs-lookup"><span data-stu-id="193c5-251">An Azure storage account can contain any number of queues, and each queue can contain any number of messages.</span></span> <span data-ttu-id="193c5-252">A única limitação é o espaço disponível na conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="193c5-252">The only limitation is the space that's available in the storage account.</span></span> <span data-ttu-id="193c5-253">O tamanho máximo de uma mensagem individual é de 64 KB.</span><span class="sxs-lookup"><span data-stu-id="193c5-253">The maximum size of an individual message is 64 KB.</span></span> <span data-ttu-id="193c5-254">Se precisar de mensagens com tamanhos maiores do que esse, considere usar as filas do Barramento de Serviço do Azure.</span><span class="sxs-lookup"><span data-stu-id="193c5-254">If you require messages bigger than this, then consider using Azure Service Bus queues instead.</span></span>

<span data-ttu-id="193c5-255">Cada fila de armazenamento tem um nome exclusivo dentro da conta de armazenamento na qual ela está contida.</span><span class="sxs-lookup"><span data-stu-id="193c5-255">Each storage queue has a unique name within the storage account that contains it.</span></span> <span data-ttu-id="193c5-256">O Azure particiona filas com base no nome.</span><span class="sxs-lookup"><span data-stu-id="193c5-256">Azure partitions queues based on the name.</span></span> <span data-ttu-id="193c5-257">Todas as mensagens para a mesma fila são armazenadas na mesma partição, que é controlada por um único servidor.</span><span class="sxs-lookup"><span data-stu-id="193c5-257">All messages for the same queue are stored in the same partition, which is controlled by a single server.</span></span> <span data-ttu-id="193c5-258">Diferentes filas podem ser gerenciadas por diferentes servidores para ajudar a balancear a carga.</span><span class="sxs-lookup"><span data-stu-id="193c5-258">Different queues can be managed by different servers to help balance the load.</span></span> <span data-ttu-id="193c5-259">A alocação de filas para servidores é transparente para aplicativos e usuários.</span><span class="sxs-lookup"><span data-stu-id="193c5-259">The allocation of queues to servers is transparent to applications and users.</span></span>

<span data-ttu-id="193c5-260">Em um aplicativo de grande escala, não use a mesma fila de armazenamento para todas as instâncias do aplicativo, pois essa abordagem pode fazer com que o servidor que está hospedando a fila se torne um ponto de acesso.</span><span class="sxs-lookup"><span data-stu-id="193c5-260">In a large-scale application, don't use the same storage queue for all instances of the application because this approach might cause the server that's hosting the queue to become a hotspot.</span></span> <span data-ttu-id="193c5-261">Em vez disso, use filas diferentes para diferentes áreas funcionais do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="193c5-261">Instead, use different queues for different functional areas of the application.</span></span> <span data-ttu-id="193c5-262">As filas do armazenamento do Azure não damos suporte a transações, portanto, direcionar mensagens para diferentes filas deve ter pouco efeito na consistência das mensagens.</span><span class="sxs-lookup"><span data-stu-id="193c5-262">Azure storage queues do not support transactions, so directing messages to different queues should have little effect on messaging consistency.</span></span>

<span data-ttu-id="193c5-263">Uma fila de armazenamento do Azure pode manipular até 2.000 mensagens por segundo.</span><span class="sxs-lookup"><span data-stu-id="193c5-263">An Azure storage queue can handle up to 2,000 messages per second.</span></span> <span data-ttu-id="193c5-264">Se precisar processar mensagens a uma taxa maior que essa, considere criar várias filas.</span><span class="sxs-lookup"><span data-stu-id="193c5-264">If you need to process messages at a greater rate than this, consider creating multiple queues.</span></span> <span data-ttu-id="193c5-265">Por exemplo, em um aplicativo global, crie filas de armazenamento separadas em contas de armazenamento separadas para manipular instâncias do aplicativo que estão sendo executadas em cada região.</span><span class="sxs-lookup"><span data-stu-id="193c5-265">For example, in a global application, create separate storage queues in separate storage accounts to handle application instances that are running in each region.</span></span>

## <a name="partitioning-azure-service-bus"></a><span data-ttu-id="193c5-266">Particionamento do Barramento de Serviço do Azure</span><span class="sxs-lookup"><span data-stu-id="193c5-266">Partitioning Azure Service Bus</span></span>

<span data-ttu-id="193c5-267">O Barramento de Serviço do Azure usa um agente de mensagem para manipular as mensagens que são enviadas para uma fila ou um tópico do Barramento de Serviço.</span><span class="sxs-lookup"><span data-stu-id="193c5-267">Azure Service Bus uses a message broker to handle messages that are sent to a Service Bus queue or topic.</span></span> <span data-ttu-id="193c5-268">Por padrão, todas as mensagens que são enviadas para uma fila ou um tópico são manipuladas pelo mesmo processo de agente de mensagem.</span><span class="sxs-lookup"><span data-stu-id="193c5-268">By default, all messages that are sent to a queue or topic are handled by the same message broker process.</span></span> <span data-ttu-id="193c5-269">Essa arquitetura pode colocar uma limitação na taxa de transferência geral da fila de mensagens.</span><span class="sxs-lookup"><span data-stu-id="193c5-269">This architecture can place a limitation on the overall throughput of the message queue.</span></span> <span data-ttu-id="193c5-270">No entanto, você também pode particionar a uma fila ou um tópico quando ele é criado.</span><span class="sxs-lookup"><span data-stu-id="193c5-270">However, you can also partition a queue or topic when it is created.</span></span> <span data-ttu-id="193c5-271">Você pode fazer isso definindo a propriedade *EnablePartitioning* da fila ou da descrição do tópico para *true*.</span><span class="sxs-lookup"><span data-stu-id="193c5-271">You do this by setting the *EnablePartitioning* property of the queue or topic description to *true*.</span></span>

<span data-ttu-id="193c5-272">Uma fila ou um tópico particionado é dividido em vários fragmentos, e cada um deles tem o suporte de um repositório e agente de mensagem separados.</span><span class="sxs-lookup"><span data-stu-id="193c5-272">A partitioned queue or topic is divided into multiple fragments, each of which is backed by a separate message store and message broker.</span></span> <span data-ttu-id="193c5-273">O Barramento de Serviço assume a responsabilidade pela criação e gerenciamento desses fragmentos.</span><span class="sxs-lookup"><span data-stu-id="193c5-273">Service Bus takes responsibility for creating and managing these fragments.</span></span> <span data-ttu-id="193c5-274">Quando um aplicativo publica uma mensagem em uma fila ou tópico particionado, o Barramento de Serviço atribui a mensagem a um fragmento dessa fila ou tópico.</span><span class="sxs-lookup"><span data-stu-id="193c5-274">When an application posts a message to a partitioned queue or topic, Service Bus assigns the message to a fragment for that queue or topic.</span></span> <span data-ttu-id="193c5-275">Quando um aplicativo recebe uma mensagem de uma fila ou assinatura, o Barramento de Serviço verifica cada fragmento em relação à próxima mensagem disponível e, em seguida, transmite-a para o aplicativo para o processamento.</span><span class="sxs-lookup"><span data-stu-id="193c5-275">When an application receives a message from a queue or subscription, Service Bus checks each fragment for the next available message and then passes it to the application for processing.</span></span>

<span data-ttu-id="193c5-276">Essa estrutura ajuda a distribuir a carga entre agentes e repositórios de mensagem, aumentando a escalabilidade e melhorando a disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="193c5-276">This structure helps distribute the load across message brokers and message stores, increasing scalability and improving availability.</span></span> <span data-ttu-id="193c5-277">Se o repositório ou o agente de mensagem para um fragmento estiver temporariamente indisponível, o Barramento de Serviço poderá recuperar mensagens de um dos fragmentos restantes disponíveis.</span><span class="sxs-lookup"><span data-stu-id="193c5-277">If the message broker or message store for one fragment is temporarily unavailable, Service Bus can retrieve messages from one of the remaining available fragments.</span></span>

<span data-ttu-id="193c5-278">O Barramento de Serviço atribui uma mensagem a um fragmento da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="193c5-278">Service Bus assigns a message to a fragment as follows:</span></span>

- <span data-ttu-id="193c5-279">Se a mensagem pertencer a uma sessão, todas as mensagens com o mesmo valor para a propriedade *SessionId* são enviadas para o mesmo fragmento.</span><span class="sxs-lookup"><span data-stu-id="193c5-279">If the message belongs to a session, all messages with the same value for the *SessionId*  property are sent to the same fragment.</span></span>

- <span data-ttu-id="193c5-280">Se a mensagem não pertencer a uma sessão, mas o remetente especificou um valor para a propriedade *PartitionKey*, então, todas as mensagens com o mesmo valor *PartitionKey* serão enviadas para o mesmo fragmento.</span><span class="sxs-lookup"><span data-stu-id="193c5-280">If the message does not belong to a session, but the sender has specified a value for the *PartitionKey* property, then all messages with the same *PartitionKey* value are sent to the same fragment.</span></span>

  > [!NOTE]
  > <span data-ttu-id="193c5-281">Se as propriedades *SessionId* e *PartitionKey* forem especificadas, então, deverão ser definidas para o mesmo valor ou a mensagem será rejeitada.</span><span class="sxs-lookup"><span data-stu-id="193c5-281">If the *SessionId* and *PartitionKey* properties are both specified, then they must be set to the same value or the message will be rejected.</span></span>

- <span data-ttu-id="193c5-282">Se as propriedades *SessionId* e *PartitionKey* de uma mensagem não forem especificadas, mas a detecção de duplicidades estiver habilitada, a propriedade *MessageId* será usada.</span><span class="sxs-lookup"><span data-stu-id="193c5-282">If the *SessionId* and *PartitionKey* properties for a message are not specified, but duplicate detection is enabled, the *MessageId* property will be used.</span></span> <span data-ttu-id="193c5-283">Todas as mensagens com a mesma *MessageId* serão direcionadas para o mesmo fragmento.</span><span class="sxs-lookup"><span data-stu-id="193c5-283">All messages with the same *MessageId* will be directed to the same fragment.</span></span>

- <span data-ttu-id="193c5-284">Se as mensagens não incluírem uma propriedade *SessionId, PartitionKey* ou *MessageId*, então, o Barramento de Serviço atribuirá as mensagens aos fragmentos em sequência.</span><span class="sxs-lookup"><span data-stu-id="193c5-284">If messages do not include a *SessionId, PartitionKey,* or *MessageId* property, then Service Bus assigns messages to fragments sequentially.</span></span> <span data-ttu-id="193c5-285">Se um fragmento estiver indisponível, o Barramento de Serviço passará para o próximo.</span><span class="sxs-lookup"><span data-stu-id="193c5-285">If a fragment is unavailable, Service Bus will move on to the next.</span></span> <span data-ttu-id="193c5-286">Isso significa que uma falha temporária na infraestrutura das mensagens não causa uma falha na operação de envio de mensagem.</span><span class="sxs-lookup"><span data-stu-id="193c5-286">This means that a temporary fault in the messaging infrastructure does not cause the message-send operation to fail.</span></span>

<span data-ttu-id="193c5-287">Considere os seguintes pontos ao decidir se ou como particionar uma fila ou um tópico de mensagem do Barramento de Serviço:</span><span class="sxs-lookup"><span data-stu-id="193c5-287">Consider the following points when deciding if or how to partition a Service Bus message queue or topic:</span></span>

- <span data-ttu-id="193c5-288">Tópicos e filas do Barramento de Serviço são criados dentro do escopo de um namespace do Barramento de Serviço.</span><span class="sxs-lookup"><span data-stu-id="193c5-288">Service Bus queues and topics are created within the scope of a Service Bus namespace.</span></span> <span data-ttu-id="193c5-289">O Barramento de Serviço atualmente permite até 100 filas ou tópicos particionados por namespace.</span><span class="sxs-lookup"><span data-stu-id="193c5-289">Service Bus currently allows up to 100 partitioned queues or topics per namespace.</span></span>

- <span data-ttu-id="193c5-290">Cada namespace do Barramento de Serviço impõe cotas nos recursos disponíveis, como o número de assinaturas por tópico, o número de solicitações simultâneas de envio e recebimento por segundo e o número máximo de conexões simultâneas que podem ser estabelecidas.</span><span class="sxs-lookup"><span data-stu-id="193c5-290">Each Service Bus namespace imposes quotas on the available resources, such as the number of subscriptions per topic, the number of concurrent send and receive requests per second, and the maximum number of concurrent connections that can be established.</span></span> <span data-ttu-id="193c5-291">Essas cotas são documentadas nas [cotas do Barramento de Serviço].</span><span class="sxs-lookup"><span data-stu-id="193c5-291">These quotas are documented in [Service Bus quotas].</span></span> <span data-ttu-id="193c5-292">Se você prevê que esses valores serão excedidos, crie namespaces adicionais com suas próprias filas e tópicos e distribua o trabalho entre esses namespaces.</span><span class="sxs-lookup"><span data-stu-id="193c5-292">If you expect to exceed these values, then create additional namespaces with their own queues and topics, and spread the work across these namespaces.</span></span> <span data-ttu-id="193c5-293">Por exemplo, em um aplicativo global, crie namespaces separados em cada região e configure instâncias do aplicativo para usar as filas e tópicos no namespace mais próximo.</span><span class="sxs-lookup"><span data-stu-id="193c5-293">For example, in a global application, create separate namespaces in each region and configure application instances to use the queues and topics in the nearest namespace.</span></span>

- <span data-ttu-id="193c5-294">As mensagens enviadas como parte de uma transação devem especificar uma chave de partição.</span><span class="sxs-lookup"><span data-stu-id="193c5-294">Messages that are sent as part of a transaction must specify a partition key.</span></span> <span data-ttu-id="193c5-295">Isso pode ser uma propriedade *SessionId*, *PartitionKey* ou *MessageId*.</span><span class="sxs-lookup"><span data-stu-id="193c5-295">This can be a *SessionId*, *PartitionKey*, or *MessageId* property.</span></span> <span data-ttu-id="193c5-296">Todas as mensagens enviadas como parte da mesma transação devem especificar a mesma chave de partição, pois elas devem ser manipuladas pelo mesmo processo de agente de mensagem.</span><span class="sxs-lookup"><span data-stu-id="193c5-296">All messages that are sent as part of the same transaction must specify the same partition key because they must be handled by the same message broker process.</span></span> <span data-ttu-id="193c5-297">Você não pode enviar mensagens para diferentes filas ou tópicos na mesma transação.</span><span class="sxs-lookup"><span data-stu-id="193c5-297">You cannot send messages to different queues or topics within the same transaction.</span></span>

- <span data-ttu-id="193c5-298">As filas e os tópicos particionados não podem ser configurados para serem excluídos automaticamente quando se tornam ociosos.</span><span class="sxs-lookup"><span data-stu-id="193c5-298">Partitioned queues and topics can't be configured to be automatically deleted when they become idle.</span></span>

- <span data-ttu-id="193c5-299">Atualmente, as filas e os tópicos particionados não podem ser usados com o AMQP (Advanced Message Queuing Protocol) se você estiver criando soluções híbridas ou entre plataformas.</span><span class="sxs-lookup"><span data-stu-id="193c5-299">Partitioned queues and topics can't currently be used with the Advanced Message Queuing Protocol (AMQP) if you are building cross-platform or hybrid solutions.</span></span>

## <a name="partitioning-cosmos-db"></a><span data-ttu-id="193c5-300">Particionamento do Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="193c5-300">Partitioning Cosmos DB</span></span>

<span data-ttu-id="193c5-301">O Azure Cosmos DB é um banco de dados NoSQL pode armazenar documentos JSON usando a [API de SQL do Azure Cosmos DB][cosmosdb-sql-api].</span><span class="sxs-lookup"><span data-stu-id="193c5-301">Azure Cosmos DB is a NoSQL database that can store JSON documents using the [Azure Cosmos DB SQL API][cosmosdb-sql-api].</span></span> <span data-ttu-id="193c5-302">Um documento no banco de dados do Cosmos DB é uma representação serializada pelo JSON de um objeto ou outro dado.</span><span class="sxs-lookup"><span data-stu-id="193c5-302">A document in a Cosmos DB database is a JSON-serialized representation of an object or other piece of data.</span></span> <span data-ttu-id="193c5-303">Nenhum esquema fixo é imposto, exceto pelo fato de que cada documento deve conter uma ID exclusiva.</span><span class="sxs-lookup"><span data-stu-id="193c5-303">No fixed schemas are enforced except that every document must contain a unique ID.</span></span>

<span data-ttu-id="193c5-304">Os documentos são organizados em coleções.</span><span class="sxs-lookup"><span data-stu-id="193c5-304">Documents are organized into collections.</span></span> <span data-ttu-id="193c5-305">Você pode agrupar documentos relacionados em uma coleção.</span><span class="sxs-lookup"><span data-stu-id="193c5-305">You can group related documents together in a collection.</span></span> <span data-ttu-id="193c5-306">Por exemplo, em um sistema que mantém postagens de blog, você pode armazenar o conteúdo de cada postagem de blog como um documento em uma coleção.</span><span class="sxs-lookup"><span data-stu-id="193c5-306">For example, in a system that maintains blog postings, you can store the contents of each blog post as a document in a collection.</span></span> <span data-ttu-id="193c5-307">Também é possível criar coleções para cada tipo de assunto.</span><span class="sxs-lookup"><span data-stu-id="193c5-307">You can also create collections for each subject type.</span></span> <span data-ttu-id="193c5-308">Como alternativa, em um aplicativo multilocatário, como um sistema em que diferentes autores controlam e gerenciam suas postagens de blog, você pode particionar os blogs por autor e criar coleções separadas para cada um deles.</span><span class="sxs-lookup"><span data-stu-id="193c5-308">Alternatively, in a multitenant application, such as a system where different authors control and manage their own blog posts, you can partition blogs by author and create separate collections for each author.</span></span> <span data-ttu-id="193c5-309">O espaço de armazenamento que é alocado às coleções é flexível e pode diminuir ou aumentar conforme necessário.</span><span class="sxs-lookup"><span data-stu-id="193c5-309">The storage space that's allocated to collections is elastic and can shrink or grow as needed.</span></span>

<span data-ttu-id="193c5-310">O Cosmos DB suporta o particionamento automático de dados baseados numa chave de partição definida pelo aplicativo.</span><span class="sxs-lookup"><span data-stu-id="193c5-310">Cosmos DB supports automatic partitioning of data based on an application-defined partition key.</span></span> <span data-ttu-id="193c5-311">Uma *partição lógica* é uma partição que armazena todos os dados para um valor de chave de partição única.</span><span class="sxs-lookup"><span data-stu-id="193c5-311">A *logical partition* is a partition that stores all the data for a single partition key value.</span></span> <span data-ttu-id="193c5-312">Todos os documentos que compartilham o mesmo valor para a chave de partição são colocados na mesma partição lógica.</span><span class="sxs-lookup"><span data-stu-id="193c5-312">All documents that share the same value for the partition key are placed within the same logical partition.</span></span> <span data-ttu-id="193c5-313">O Cosmos DB distribui valores de acordo com o hash da chave de partição.</span><span class="sxs-lookup"><span data-stu-id="193c5-313">Cosmos DB distributes values according to hash of the partition key.</span></span> <span data-ttu-id="193c5-314">Uma partição lógica tem um tamanho máximo de 10 GB.</span><span class="sxs-lookup"><span data-stu-id="193c5-314">A logical partition has a maximum size of 10 GB.</span></span> <span data-ttu-id="193c5-315">Portanto, a escolha da chave de partição é uma decisão importante no momento do design.</span><span class="sxs-lookup"><span data-stu-id="193c5-315">Therefore, the choice of the partition key is an important decision at design time.</span></span> <span data-ttu-id="193c5-316">Escolha uma propriedade com um amplo intervalo de valores e padrões de acesso regular.</span><span class="sxs-lookup"><span data-stu-id="193c5-316">Choose a property with a wide range of values and even access patterns.</span></span> <span data-ttu-id="193c5-317">Para obter mais informações, veja [Partição e redução horizontal no Azure Cosmos DB](/azure/cosmos-db/partition-data).</span><span class="sxs-lookup"><span data-stu-id="193c5-317">For more information, see [Partition and scale in Azure Cosmos DB](/azure/cosmos-db/partition-data).</span></span>

> [!NOTE]
> <span data-ttu-id="193c5-318">Cada banco de dados do Cosmos DB tem um *nível de desempenho* que determina a quantidade de recursos que ele obtém.</span><span class="sxs-lookup"><span data-stu-id="193c5-318">Each Cosmos DB database has a *performance level* that determines the amount of resources it gets.</span></span> <span data-ttu-id="193c5-319">Um nível de desempenho é associado a um limite de taxa da *unidade de solicitação* (RU).</span><span class="sxs-lookup"><span data-stu-id="193c5-319">A performance level is associated with a *request unit* (RU) rate limit.</span></span> <span data-ttu-id="193c5-320">O limite de taxa da RU especifica o volume de recursos que é reservado e disponibilizado para uso exclusivo dessa coleção.</span><span class="sxs-lookup"><span data-stu-id="193c5-320">The RU rate limit specifies the volume of resources that's reserved and available for exclusive use by that collection.</span></span> <span data-ttu-id="193c5-321">O custo de uma coleção depende do nível de desempenho que é selecionado para a coleção.</span><span class="sxs-lookup"><span data-stu-id="193c5-321">The cost of a collection depends on the performance level that's selected for that collection.</span></span> <span data-ttu-id="193c5-322">Quanto maior o nível de desempenho (e o limite de taxa da RU), maior o custo.</span><span class="sxs-lookup"><span data-stu-id="193c5-322">The higher the performance level (and RU rate limit) the higher the charge.</span></span> <span data-ttu-id="193c5-323">É possível ajustar o nível de desempenho de uma coleção usando o portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="193c5-323">You can adjust the performance level of a collection by using the Azure portal.</span></span> <span data-ttu-id="193c5-324">Para obter mais informações, confira [Unidades de Solicitação no Azure Cosmos DB][cosmos-db-ru].</span><span class="sxs-lookup"><span data-stu-id="193c5-324">For more information, see [Request Units in Azure Cosmos DB][cosmos-db-ru].</span></span>

<span data-ttu-id="193c5-325">Se o mecanismo de particionamento que o Cosmos DB fornecer não for suficiente, pode ser preciso fragmentar os dados ao nível do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="193c5-325">If the partitioning mechanism that Cosmos DB provides is not sufficient, you may need to shard the data at the application level.</span></span> <span data-ttu-id="193c5-326">As coleções de documentos fornecem um mecanismo natural para particionar dados em um banco de dados individual.</span><span class="sxs-lookup"><span data-stu-id="193c5-326">Document collections provide a natural mechanism for partitioning data within a single database.</span></span> <span data-ttu-id="193c5-327">A maneira mais simples de implementar a fragmentação é criar uma coleção para cada fragmento.</span><span class="sxs-lookup"><span data-stu-id="193c5-327">The simplest way to implement sharding is to create a collection for each shard.</span></span> <span data-ttu-id="193c5-328">Os contêineres são recursos lógicos e podem abranger um ou mais servidores.</span><span class="sxs-lookup"><span data-stu-id="193c5-328">Containers are logical resources and can span one or more servers.</span></span> <span data-ttu-id="193c5-329">Contêineres de tamanho fixo têm um limite máximo de 10 GB e taxa de transferência de 10.000 RU/s.</span><span class="sxs-lookup"><span data-stu-id="193c5-329">Fixed-size containers have a maximum limit of 10 GB and 10,000 RU/s throughput.</span></span> <span data-ttu-id="193c5-330">Os contêineres ilimitados não têm um tamanho de armazenamento máximo, mas devem especificar uma chave de partição.</span><span class="sxs-lookup"><span data-stu-id="193c5-330">Unlimited containers do not have a maximum storage size, but must specify a partition key.</span></span> <span data-ttu-id="193c5-331">Com a fragmentação do aplicativo, o aplicativo cliente deve direcionar as solicitações ao fragmento adequado, normalmente pela implementação do seu próprio mecanismo de mapeamento com base em alguns atributos dos dados que definem a chave de fragmento.</span><span class="sxs-lookup"><span data-stu-id="193c5-331">With application sharding, the client application must direct requests to the appropriate shard, usually by implementing its own mapping mechanism based on some attributes of the data that define the shard key.</span></span>

<span data-ttu-id="193c5-332">Todos os bancos de dados são criados no contexto de uma conta de banco de dados do Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="193c5-332">All databases are created in the context of a Cosmos DB database account.</span></span> <span data-ttu-id="193c5-333">Uma única conta pode conter vários bancos de dados e especifica em qual região os bancos de dados são criados.</span><span class="sxs-lookup"><span data-stu-id="193c5-333">A single account can contain several databases, and it specifies in which regions the databases are created.</span></span> <span data-ttu-id="193c5-334">Cada conta também impõe seu próprio controle de acesso.</span><span class="sxs-lookup"><span data-stu-id="193c5-334">Each account also enforces its own access control.</span></span> <span data-ttu-id="193c5-335">Você pode usar contas do Cosmos DB para localizar os fragmentos geograficamente (coleções nos bancos de dados) próximos aos usuários que precisam acessá-los e impor restrições para que somente esses usuários possam se conectar a eles.</span><span class="sxs-lookup"><span data-stu-id="193c5-335">You can use Cosmos DB accounts to geo-locate shards (collections within databases) close to the users who need to access them, and enforce restrictions so that only those users can connect to them.</span></span>

<span data-ttu-id="193c5-336">Considere os seguintes pontos ao decidir como particionar dados com a API do SQL do Cosmos DB:</span><span class="sxs-lookup"><span data-stu-id="193c5-336">Consider the following points when deciding how to partition data with the Cosmos DB SQL API:</span></span>

- <span data-ttu-id="193c5-337">**Os recursos disponíveis para um banco de dados do Cosmos DB estão sujeitos às limitações de cota da conta**.</span><span class="sxs-lookup"><span data-stu-id="193c5-337">**The resources available to a Cosmos DB database are subject to the quota limitations of the account**.</span></span> <span data-ttu-id="193c5-338">Cada banco de dados pode conter um número de coleções e cada coleção é associada a um nível de desempenho que rege o limite de taxa da RU (produtividade reservada) para essa coleção.</span><span class="sxs-lookup"><span data-stu-id="193c5-338">Each database can hold a number of collections, and each collection is associated with a performance level that governs the RU rate limit (reserved throughput) for that collection.</span></span> <span data-ttu-id="193c5-339">Para saber mais, confira [Assinatura e limites de serviço, cotas e restrições do Azure][azure-limits].</span><span class="sxs-lookup"><span data-stu-id="193c5-339">For more information, see [Azure subscription and service limits, quotas, and constraints][azure-limits].</span></span>

- <span data-ttu-id="193c5-340">**Cada documento deve ter um atributo que pode ser usado para identificar exclusivamente o documento dentro da coleção na qual ele é mantido**.</span><span class="sxs-lookup"><span data-stu-id="193c5-340">**Each document must have an attribute that can be used to uniquely identify that document within the collection in which it is held**.</span></span> <span data-ttu-id="193c5-341">Esse atributo é diferente da chave de fragmento, que define qual coleção mantém o documento.</span><span class="sxs-lookup"><span data-stu-id="193c5-341">This attribute is different from the shard key, which defines which collection holds the document.</span></span> <span data-ttu-id="193c5-342">Uma coleção pode conter um grande número de documentos.</span><span class="sxs-lookup"><span data-stu-id="193c5-342">A collection can contain a large number of documents.</span></span> <span data-ttu-id="193c5-343">Teoricamente, ela é limitada apenas pelo tamanho máximo da ID do documento.</span><span class="sxs-lookup"><span data-stu-id="193c5-343">In theory, it's limited only by the maximum length of the document ID.</span></span> <span data-ttu-id="193c5-344">A ID do documento pode ter até 255 caracteres.</span><span class="sxs-lookup"><span data-stu-id="193c5-344">The document ID can be up to 255 characters.</span></span>

- <span data-ttu-id="193c5-345">**Todas as operações em um documento são realizadas dentro do contexto de uma transação. As transações estão no escopo da coleção em que o documento está contido.**</span><span class="sxs-lookup"><span data-stu-id="193c5-345">**All operations against a document are performed within the context of a transaction. Transactions are scoped to the collection in which the document is contained.**</span></span> <span data-ttu-id="193c5-346">Se uma operação falhar, o trabalho realizado será revertido.</span><span class="sxs-lookup"><span data-stu-id="193c5-346">If an operation fails, the work that it has performed is rolled back.</span></span> <span data-ttu-id="193c5-347">Quando um documento está sujeito a uma operação, todas as alterações feitas estão sujeitas ao isolamento no nível do instantâneo.</span><span class="sxs-lookup"><span data-stu-id="193c5-347">While a document is subject to an operation, any changes that are made are subject to snapshot-level isolation.</span></span> <span data-ttu-id="193c5-348">Esse mecanismo garante que se, por exemplo, houver uma falha em uma solicitação para a criação de um novo documento, outro usuário que estiver consultando o banco de dados simultaneamente não verá um documento parcial que será então removido.</span><span class="sxs-lookup"><span data-stu-id="193c5-348">This mechanism guarantees that if, for example, a request to create a new document fails, another user who's querying the database simultaneously will not see a partial document that is then removed.</span></span>

- <span data-ttu-id="193c5-349">**As consultas do banco de dados também estão dentro do escopo do nível da coleção**.</span><span class="sxs-lookup"><span data-stu-id="193c5-349">**Database queries are also scoped to the collection level**.</span></span> <span data-ttu-id="193c5-350">Uma única consulta pode recuperar dados somente de uma coleção.</span><span class="sxs-lookup"><span data-stu-id="193c5-350">A single query can retrieve data from only one collection.</span></span> <span data-ttu-id="193c5-351">Se precisar recuperar dados de várias coleções, você deverá consultar cada coleção individualmente e mesclar os resultados no código do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="193c5-351">If you need to retrieve data from multiple collections, you must query each collection individually and merge the results in your application code.</span></span>

- <span data-ttu-id="193c5-352">**O Cosmos DB oferece suporte aos itens programáveis que podem ser armazenados em uma coleção com os documentos**.</span><span class="sxs-lookup"><span data-stu-id="193c5-352">**Cosmos DB supports programmable items that can all be stored in a collection alongside documents**.</span></span> <span data-ttu-id="193c5-353">Isso inclui procedimentos armazenados, funções definidas pelo usuário e gatilhos (escritos em JavaScript).</span><span class="sxs-lookup"><span data-stu-id="193c5-353">These include stored procedures, user-defined functions, and triggers (written in JavaScript).</span></span> <span data-ttu-id="193c5-354">Esses itens podem acessar qualquer documento na mesma coleção.</span><span class="sxs-lookup"><span data-stu-id="193c5-354">These items can access any document within the same collection.</span></span> <span data-ttu-id="193c5-355">Além disso, esses itens são executados dentro do escopo da transação de ambiente (no caso de um gatilho que é acionado como resultado de uma operação de criação, exclusão ou substituição executada em um documento) ou por iniciar uma nova transação (no caso de um procedimento armazenado executado como resultado de uma solicitação de cliente explícita).</span><span class="sxs-lookup"><span data-stu-id="193c5-355">Furthermore, these items run either inside the scope of the ambient transaction (in the case of a trigger that fires as the result of a create, delete, or replace operation performed against a document), or by starting a new transaction (in the case of a stored procedure that is run as the result of an explicit client request).</span></span> <span data-ttu-id="193c5-356">Se o código em um item programável lançar uma exceção, a transação será revertida.</span><span class="sxs-lookup"><span data-stu-id="193c5-356">If the code in a programmable item throws an exception, the transaction is rolled back.</span></span> <span data-ttu-id="193c5-357">Você pode usar procedimentos armazenados e gatilhos para manter a integridade e a consistência entre documentos, mas esses documentos devem fazer parte da mesma coleção.</span><span class="sxs-lookup"><span data-stu-id="193c5-357">You can use stored procedures and triggers to maintain integrity and consistency between documents, but these documents must all be part of the same collection.</span></span>

- <span data-ttu-id="193c5-358">**Provavelmente, as coleções que você pretende manter nos bancos de dados não excederão os limites de taxa de transferência definidos pelos níveis de desempenho das coleções**.</span><span class="sxs-lookup"><span data-stu-id="193c5-358">**The collections that you intend to hold in the databases should be unlikely to exceed the throughput limits defined by the performance levels of the collections**.</span></span> <span data-ttu-id="193c5-359">Para obter mais informações, confira [Unidades de Solicitação no Azure Cosmos DB][cosmos-db-ru].</span><span class="sxs-lookup"><span data-stu-id="193c5-359">For more information, see [Request Units in Azure Cosmos DB][cosmos-db-ru].</span></span> <span data-ttu-id="193c5-360">Se você prevê que esses limites serão atingidos, considere dividir as coleções em bancos de dados em diferentes contas para reduzir a carga por coleção.</span><span class="sxs-lookup"><span data-stu-id="193c5-360">If you anticipate reaching these limits, consider splitting collections across databases in different accounts to reduce the load per collection.</span></span>

## <a name="partitioning-azure-search"></a><span data-ttu-id="193c5-361">Particionamento do Azure Search</span><span class="sxs-lookup"><span data-stu-id="193c5-361">Partitioning Azure Search</span></span>

<span data-ttu-id="193c5-362">A capacidade de pesquisar dados geralmente é o principal método de navegação e exploração fornecido por muitos aplicativos Web.</span><span class="sxs-lookup"><span data-stu-id="193c5-362">The ability to search for data is often the primary method of navigation and exploration that's provided by many web applications.</span></span> <span data-ttu-id="193c5-363">Ela ajuda os usuários a encontrar recursos rapidamente (por exemplo, produtos em um aplicativo de comércio eletrônico) com base em combinações de critérios de pesquisa.</span><span class="sxs-lookup"><span data-stu-id="193c5-363">It helps users find resources quickly (for example, products in an e-commerce application) based on combinations of search criteria.</span></span> <span data-ttu-id="193c5-364">O serviço de Azure Search fornece recursos de pesquisa de texto completo em relação ao conteúdo da Web e inclui recursos como consultas recomendadas de preenchimento automático com base em correspondências aproximadas e na navegação facetada.</span><span class="sxs-lookup"><span data-stu-id="193c5-364">The Azure Search service provides full-text search capabilities over web content, and includes features such as type-ahead, suggested queries based on near matches, and faceted navigation.</span></span> <span data-ttu-id="193c5-365">Para obter mais informações, confira [O que é o Azure Search?].</span><span class="sxs-lookup"><span data-stu-id="193c5-365">For more information, see [What is Azure Search?].</span></span>

<span data-ttu-id="193c5-366">O Azure Search armazena conteúdo pesquisável como documentos JSON em um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="193c5-366">Azure Search stores searchable content as JSON documents in a database.</span></span> <span data-ttu-id="193c5-367">Defina os índices que especificam os campos pesquisáveis nesses documentos e forneça essas definições ao Azure Search.</span><span class="sxs-lookup"><span data-stu-id="193c5-367">You define indexes that specify the searchable fields in these documents and provide these definitions to Azure Search.</span></span> <span data-ttu-id="193c5-368">Quando um usuário envia uma solicitação de pesquisa, o Azure Search usa os índices adequados para localizar itens correspondentes.</span><span class="sxs-lookup"><span data-stu-id="193c5-368">When a user submits a search request, Azure Search uses the appropriate indexes to find matching items.</span></span>

<span data-ttu-id="193c5-369">Para reduzir a contenção, o armazenamento usado pelo Azure Search pode ser dividido em 1, 2, 3, 4, 6 ou 12 partições, e cada partição pode ser replicada até seis vezes.</span><span class="sxs-lookup"><span data-stu-id="193c5-369">To reduce contention, the storage that's used by Azure Search can be divided into 1, 2, 3, 4, 6, or 12 partitions, and each partition can be replicated up to 6 times.</span></span> <span data-ttu-id="193c5-370">O produto do número de partições multiplicado pelo número de réplicas é denominado *unidade de pesquisa* (SU).</span><span class="sxs-lookup"><span data-stu-id="193c5-370">The product of the number of partitions multiplied by the number of replicas is called the *search unit* (SU).</span></span> <span data-ttu-id="193c5-371">Uma única instância do Azure Search pode conter um máximo de 36 SUs (um banco de dados com 12 partições somente dá suporte a um máximo de 3 réplicas).</span><span class="sxs-lookup"><span data-stu-id="193c5-371">A single instance of Azure Search can contain a maximum of 36 SUs (a database with 12 partitions only supports a maximum of 3 replicas).</span></span>

<span data-ttu-id="193c5-372">Você será cobrado por cada SU alocada ao seu serviço.</span><span class="sxs-lookup"><span data-stu-id="193c5-372">You are billed for each SU that is allocated to your service.</span></span> <span data-ttu-id="193c5-373">Conforme o volume de conteúdo pesquisável ou a taxa de solicitações de pesquisa aumenta, é possível adicionar SUs a uma instância existente do Azure Search para manipular a carga extra.</span><span class="sxs-lookup"><span data-stu-id="193c5-373">As the volume of searchable content increases or the rate of search requests grows, you can add SUs to an existing instance of Azure Search to handle the extra load.</span></span> <span data-ttu-id="193c5-374">O Azure Search em si distribui os documentos uniformemente entre as partições.</span><span class="sxs-lookup"><span data-stu-id="193c5-374">Azure Search itself distributes the documents evenly across the partitions.</span></span> <span data-ttu-id="193c5-375">Atualmente, nenhuma estratégia de particionamento manual é compatível.</span><span class="sxs-lookup"><span data-stu-id="193c5-375">No manual partitioning strategies are currently supported.</span></span>

<span data-ttu-id="193c5-376">Cada partição pode conter um máximo de 15 milhões de documentos ou ocupar 300 GB de espaço de armazenamento (o que for menor).</span><span class="sxs-lookup"><span data-stu-id="193c5-376">Each partition can contain a maximum of 15 million documents or occupy 300 GB of storage space (whichever is smaller).</span></span> <span data-ttu-id="193c5-377">Você pode criar até 50 índices.</span><span class="sxs-lookup"><span data-stu-id="193c5-377">You can create up to 50 indexes.</span></span> <span data-ttu-id="193c5-378">O desempenho do serviço varia e depende da complexidade dos documentos, dos índices disponíveis e dos efeitos da latência de rede.</span><span class="sxs-lookup"><span data-stu-id="193c5-378">The performance of the service varies and depends on the complexity of the documents, the available indexes, and the effects of network latency.</span></span> <span data-ttu-id="193c5-379">Em média, uma única réplica (1 SU) deve ser capaz de manipular 15 QPS (consultas por segundo), embora seja recomendável avaliar o desempenho com seus próprios dados para obter uma medida mais precisa da taxa de transferência.</span><span class="sxs-lookup"><span data-stu-id="193c5-379">On average, a single replica (1 SU) should be able to handle 15 queries per second (QPS), although we recommend performing benchmarking with your own data to obtain a more precise measure of throughput.</span></span> <span data-ttu-id="193c5-380">Para obter mais informações, confira [Limites de serviço no Azure Search].</span><span class="sxs-lookup"><span data-stu-id="193c5-380">For more information, see [Service limits in Azure Search].</span></span>

> [!NOTE]
> <span data-ttu-id="193c5-381">Você pode armazenar um conjunto limitado de tipos de dados em documentos pesquisáveis, incluindo cadeias de caracteres, boolianos, dados numéricos, dados de data/hora e alguns dados geográficos.</span><span class="sxs-lookup"><span data-stu-id="193c5-381">You can store a limited set of data types in searchable documents, including strings, Booleans, numeric data, datetime data, and some geographical data.</span></span> <span data-ttu-id="193c5-382">Para obter mais detalhes, visite a página [Tipos de Dados com Suporte (Azure Search)] no site da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="193c5-382">For more details, see the page [Supported data types (Azure Search)] on the Microsoft website.</span></span>

<span data-ttu-id="193c5-383">Você tem controle limitado sobre como o Azure Search particiona os dados para cada instância do serviço.</span><span class="sxs-lookup"><span data-stu-id="193c5-383">You have limited control over how Azure Search partitions data for each instance of the service.</span></span> <span data-ttu-id="193c5-384">No entanto, em um ambiente global, é possível melhorar o desempenho e reduzir ainda mais a latência e contenção pelo particionamento do próprio serviço usando qualquer uma das seguintes estratégias:</span><span class="sxs-lookup"><span data-stu-id="193c5-384">However, in a global environment you might be able to improve performance and reduce latency and contention further by partitioning the service itself using either of the following strategies:</span></span>

- <span data-ttu-id="193c5-385">Crie uma instância do Azure Search em cada região geográfica e verifique se os aplicativos cliente são direcionados à instância disponível mais próxima.</span><span class="sxs-lookup"><span data-stu-id="193c5-385">Create an instance of Azure Search in each geographic region, and ensure that client applications are directed towards the nearest available instance.</span></span> <span data-ttu-id="193c5-386">Essa estratégia exige que todas as atualizações de conteúdo pesquisável sejam replicadas pontualmente em todas as instâncias do serviço.</span><span class="sxs-lookup"><span data-stu-id="193c5-386">This strategy requires that any updates to searchable content are replicated in a timely manner across all instances of the service.</span></span>

- <span data-ttu-id="193c5-387">Crie duas camadas de Azure Search:</span><span class="sxs-lookup"><span data-stu-id="193c5-387">Create two tiers of Azure Search:</span></span>

  - <span data-ttu-id="193c5-388">Um serviço local em cada região que contenha os dados que são acessados com mais frequência pelos usuários nessa região.</span><span class="sxs-lookup"><span data-stu-id="193c5-388">A local service in each region that contains the data that's most frequently accessed by users in that region.</span></span> <span data-ttu-id="193c5-389">Os usuários podem direcionar solicitações para obter resultados rápidos, mas limitados.</span><span class="sxs-lookup"><span data-stu-id="193c5-389">Users can direct requests here for fast but limited results.</span></span>
  - <span data-ttu-id="193c5-390">Um serviço global que inclua todos os dados.</span><span class="sxs-lookup"><span data-stu-id="193c5-390">A global service that encompasses all the data.</span></span> <span data-ttu-id="193c5-391">Os usuários podem direcionar solicitações para obter resultados mais demorados, porém, mais completos.</span><span class="sxs-lookup"><span data-stu-id="193c5-391">Users can direct requests here for slower but more complete results.</span></span>

<span data-ttu-id="193c5-392">Essa abordagem é mais adequada quando há uma variação regional significativa nos dados que estão sendo pesquisados.</span><span class="sxs-lookup"><span data-stu-id="193c5-392">This approach is most suitable when there is a significant regional variation in the data that's being searched.</span></span>

## <a name="partitioning-azure-redis-cache"></a><span data-ttu-id="193c5-393">Particionamento do Cache Redis do Azure</span><span class="sxs-lookup"><span data-stu-id="193c5-393">Partitioning Azure Redis Cache</span></span>

<span data-ttu-id="193c5-394">O Cache Redis do Azure fornece um serviço de cache compartilhado na nuvem que se baseia no repositório de dados de chave/valor do Redis.</span><span class="sxs-lookup"><span data-stu-id="193c5-394">Azure Redis Cache provides a shared caching service in the cloud that's based on the Redis key-value data store.</span></span> <span data-ttu-id="193c5-395">Como o nome sugere, o Cache Redis do Azure serve como uma solução de cache.</span><span class="sxs-lookup"><span data-stu-id="193c5-395">As its name implies, Azure Redis Cache is intended as a caching solution.</span></span> <span data-ttu-id="193c5-396">Use-o apenas para dados manter dados transitórios, e não como um repositório de dados permanentes.</span><span class="sxs-lookup"><span data-stu-id="193c5-396">Use it only for holding transient data and not as a permanent data store.</span></span> <span data-ttu-id="193c5-397">Os aplicativos que usam o Cache Redis do Azure devem poder continuar funcionando se o cache ficar indisponível.</span><span class="sxs-lookup"><span data-stu-id="193c5-397">Applications that use Azure Redis Cache should be able to continue functioning if the cache is unavailable.</span></span> <span data-ttu-id="193c5-398">O Cache Redis do Azure permite a replicação primária/secundária para fornecer alta disponibilidade, mas atualmente limita o tamanho máximo do cache para 53 GB.</span><span class="sxs-lookup"><span data-stu-id="193c5-398">Azure Redis Cache supports primary/secondary replication to provide high availability, but currently limits the maximum cache size to 53 GB.</span></span> <span data-ttu-id="193c5-399">Se você precisar de mais espaço, é necessário criar caches adicionais.</span><span class="sxs-lookup"><span data-stu-id="193c5-399">If you need more space than this, you must create additional caches.</span></span> <span data-ttu-id="193c5-400">Para obter mais informações, confira [Cache Redis do Azure].</span><span class="sxs-lookup"><span data-stu-id="193c5-400">For more information, see [Azure Redis Cache].</span></span>

<span data-ttu-id="193c5-401">O particionamento de um repositório de dados do Redis envolve a divisão dos dados entre instâncias do serviço do Redis.</span><span class="sxs-lookup"><span data-stu-id="193c5-401">Partitioning a Redis data store involves splitting the data across instances of the Redis service.</span></span> <span data-ttu-id="193c5-402">Cada instância constitui uma única partição.</span><span class="sxs-lookup"><span data-stu-id="193c5-402">Each instance constitutes a single partition.</span></span> <span data-ttu-id="193c5-403">O Cache Redis do Azure abstrai os serviços do Redis por trás de uma fachada e não os expõe diretamente.</span><span class="sxs-lookup"><span data-stu-id="193c5-403">Azure Redis Cache abstracts the Redis services behind a façade and does not expose them directly.</span></span> <span data-ttu-id="193c5-404">A maneira mais simples de implementar o particionamento é criar várias instâncias do Cache Redis do Azure e distribuir os dados entre eles.</span><span class="sxs-lookup"><span data-stu-id="193c5-404">The simplest way to implement partitioning is to create multiple Azure Redis Cache instances and spread the data across them.</span></span>

<span data-ttu-id="193c5-405">Você pode associar cada item de dados a um identificador (uma chave de partição) que especifica qual cache armazena o item de dados.</span><span class="sxs-lookup"><span data-stu-id="193c5-405">You can associate each data item with an identifier (a partition key) that specifies which cache stores the data item.</span></span> <span data-ttu-id="193c5-406">A lógica do aplicativo cliente pode usar esse identificador para rotear solicitações para a partição adequada.</span><span class="sxs-lookup"><span data-stu-id="193c5-406">The client application logic can then use this identifier to route requests to the appropriate partition.</span></span> <span data-ttu-id="193c5-407">Esse esquema é muito simples, mas se o esquema de particionamento for alterado (por exemplo, se instâncias adicionais do Cache Redis do Azure forem criadas), os aplicativos cliente precisarão ser reconfigurados.</span><span class="sxs-lookup"><span data-stu-id="193c5-407">This scheme is very simple, but if the partitioning scheme changes (for example, if additional Azure Redis Cache instances are created), client applications might need to be reconfigured.</span></span>

<span data-ttu-id="193c5-408">O Redis nativo (não o Cache Redis do Azure) dá suporte ao particionamento do lado do servidor com base no clustering do Redis.</span><span class="sxs-lookup"><span data-stu-id="193c5-408">Native Redis (not Azure Redis Cache) supports server-side partitioning based on Redis clustering.</span></span> <span data-ttu-id="193c5-409">Nessa abordagem, é possível dividir os dados uniformemente entre os servidores usando um mecanismo de hash.</span><span class="sxs-lookup"><span data-stu-id="193c5-409">In this approach, you can divide the data evenly across servers by using a hashing mechanism.</span></span> <span data-ttu-id="193c5-410">Cada servidor do Redis armazena metadados que descrevem o intervalo de chaves de hash contidos na partição, além de conter informações sobre quais chaves de hash estão localizadas nas partições em outros servidores.</span><span class="sxs-lookup"><span data-stu-id="193c5-410">Each Redis server stores metadata that describes the range of hash keys that the partition holds, and also contains information about which hash keys are located in the partitions on other servers.</span></span>

<span data-ttu-id="193c5-411">Os aplicativos cliente simplesmente enviam solicitações para qualquer um dos servidores Redis participantes (provavelmente o mais próximo).</span><span class="sxs-lookup"><span data-stu-id="193c5-411">Client applications simply send requests to any of the participating Redis servers (probably the closest one).</span></span> <span data-ttu-id="193c5-412">O servidor Redis examina a solicitação do cliente.</span><span class="sxs-lookup"><span data-stu-id="193c5-412">The Redis server examines the client request.</span></span> <span data-ttu-id="193c5-413">Se ela puder ser resolvida localmente, o servidor executa a operação solicitada.</span><span class="sxs-lookup"><span data-stu-id="193c5-413">If it can be resolved locally, it performs the requested operation.</span></span> <span data-ttu-id="193c5-414">Caso contrário, ele encaminha a solicitação para o servidor adequado.</span><span class="sxs-lookup"><span data-stu-id="193c5-414">Otherwise it forwards the request on to the appropriate server.</span></span>

<span data-ttu-id="193c5-415">Esse modelo é implementado usando o clustering do Redis e é descrito mais detalhadamente na página [tutorial de cluster do Redis] no site do Redis.</span><span class="sxs-lookup"><span data-stu-id="193c5-415">This model is implemented by using Redis clustering, and is described in more detail on the [Redis cluster tutorial] page on the Redis website.</span></span> <span data-ttu-id="193c5-416">O clustering do Redis é transparente para os aplicativos cliente.</span><span class="sxs-lookup"><span data-stu-id="193c5-416">Redis clustering is transparent to client applications.</span></span> <span data-ttu-id="193c5-417">Outros servidores do Redis podem ser adicionados ao cluster (e os dados podem ser particionados novamente) sem a necessidade de reconfigurar os clientes.</span><span class="sxs-lookup"><span data-stu-id="193c5-417">Additional Redis servers can be added to the cluster (and the data can be re-partitioned) without requiring that you reconfigure the clients.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="193c5-418">O Cache Redis do Azure atualmente oferece suporte ao clustering do Redis somente na camada [premium](/azure/azure-cache-for-redis/cache-how-to-premium-clustering).</span><span class="sxs-lookup"><span data-stu-id="193c5-418">Azure Redis Cache currently supports Redis clustering in [premium](/azure/azure-cache-for-redis/cache-how-to-premium-clustering) tier only.</span></span>

<span data-ttu-id="193c5-419">A página [Partitioning: how to split data among multiple Redis instances] , no site do Redis, fornece mais informações sobre a implementação do particionamento com o Redis.</span><span class="sxs-lookup"><span data-stu-id="193c5-419">The page [Partitioning: how to split data among multiple Redis instances] on the Redis website provides more information about implementing partitioning with Redis.</span></span> <span data-ttu-id="193c5-420">Ao ler o restante desta seção, pressupomos que você esteja implementando o particionamento do lado do cliente ou assistido por proxy.</span><span class="sxs-lookup"><span data-stu-id="193c5-420">The remainder of this section assumes that you are implementing client-side or proxy-assisted partitioning.</span></span>

<span data-ttu-id="193c5-421">Considere os seguintes pontos ao decidir como particionar dados com o Cache Redis do Azure:</span><span class="sxs-lookup"><span data-stu-id="193c5-421">Consider the following points when deciding how to partition data with Azure Redis Cache:</span></span>

- <span data-ttu-id="193c5-422">O Cache Redis do Azure não pretende agir como um repositório de dados permanente; portanto, seja qual for o esquema de particionamento que você implemente, o código do aplicativo deverá poder recuperar dados de um local que não seja o cache.</span><span class="sxs-lookup"><span data-stu-id="193c5-422">Azure Redis Cache is not intended to act as a permanent data store, so whatever partitioning scheme you implement, your application code must be able to retrieve data from a location that's not the cache.</span></span>

- <span data-ttu-id="193c5-423">Os dados que são acessados juntos frequentemente devem ser mantidos na mesma partição.</span><span class="sxs-lookup"><span data-stu-id="193c5-423">Data that is frequently accessed together should be kept in the same partition.</span></span> <span data-ttu-id="193c5-424">O Redis é um poderoso repositório de chave/valor que fornece vários mecanismos altamente otimizados para estruturação de dados.</span><span class="sxs-lookup"><span data-stu-id="193c5-424">Redis is a powerful key-value store that provides several highly optimized mechanisms for structuring data.</span></span> <span data-ttu-id="193c5-425">Esses mecanismos podem ser um dos seguintes:</span><span class="sxs-lookup"><span data-stu-id="193c5-425">These mechanisms can be one of the following:</span></span>
  - <span data-ttu-id="193c5-426">Cadeias de caracteres simples (dados binários de até 512 MB)</span><span class="sxs-lookup"><span data-stu-id="193c5-426">Simple strings (binary data up to 512 MB in length)</span></span>
  - <span data-ttu-id="193c5-427">Tipos de agregação, como listas (que podem atuar como filas e pilhas)</span><span class="sxs-lookup"><span data-stu-id="193c5-427">Aggregate types such as lists (which can act as queues and stacks)</span></span>
  - <span data-ttu-id="193c5-428">Conjuntos (ordenados e não ordenados)</span><span class="sxs-lookup"><span data-stu-id="193c5-428">Sets (ordered and unordered)</span></span>
  - <span data-ttu-id="193c5-429">Hashes (que podem agrupar campos relacionados, como os itens que representam os campos em um objeto)</span><span class="sxs-lookup"><span data-stu-id="193c5-429">Hashes (which can group related fields together, such as the items that represent the fields in an object)</span></span>

- <span data-ttu-id="193c5-430">Os tipos de agregação permitem associar vários valores relacionados com a mesma chave.</span><span class="sxs-lookup"><span data-stu-id="193c5-430">The aggregate types enable you to associate many related values with the same key.</span></span> <span data-ttu-id="193c5-431">Uma chave do Redis identifica uma lista, um conjunto ou um hash em vez de itens de dados que ela contém.</span><span class="sxs-lookup"><span data-stu-id="193c5-431">A Redis key identifies a list, set, or hash rather than the data items that it contains.</span></span> <span data-ttu-id="193c5-432">Esses tipos estão disponíveis com o Cache Redis do Azure e são descritos na página [Data types] no site do Redis.</span><span class="sxs-lookup"><span data-stu-id="193c5-432">These types are all available with Azure Redis Cache and are described by the [Data types] page on the Redis website.</span></span> <span data-ttu-id="193c5-433">Por exemplo, em uma parte de um sistema de comércio eletrônico que rastreia os pedidos que são feitos pelos clientes, os detalhes de cada cliente podem ser armazenados em um hash do Redis que é digitado usando a ID do cliente.</span><span class="sxs-lookup"><span data-stu-id="193c5-433">For example, in part of an e-commerce system that tracks the orders that are placed by customers, the details of each customer can be stored in a Redis hash that is keyed by using the customer ID.</span></span> <span data-ttu-id="193c5-434">Cada hash pode manter uma coleção de IDs de pedido do cliente.</span><span class="sxs-lookup"><span data-stu-id="193c5-434">Each hash can hold a collection of order IDs for the customer.</span></span> <span data-ttu-id="193c5-435">Um conjunto separado do Redis pode manter os pedidos, novamente estruturados como hashes, e digitados com o uso da ID de pedido.</span><span class="sxs-lookup"><span data-stu-id="193c5-435">A separate Redis set can hold the orders, again structured as hashes, and keyed by using the order ID.</span></span> <span data-ttu-id="193c5-436">A Figura 8 mostra essa estrutura.</span><span class="sxs-lookup"><span data-stu-id="193c5-436">Figure 8 shows this structure.</span></span> <span data-ttu-id="193c5-437">Observe que o Redis não implementa nenhuma forma de integridade referencial; portanto, é responsabilidade do desenvolvedor manter os relacionamentos entre clientes e pedidos.</span><span class="sxs-lookup"><span data-stu-id="193c5-437">Note that Redis does not implement any form of referential integrity, so it is the developer's responsibility to maintain the relationships between customers and orders.</span></span>

![Estrutura recomendada no armazenamento do Redis para registrar pedidos de clientes e seus detalhes](./images/data-partitioning/RedisCustomersandOrders.png)

<span data-ttu-id="193c5-439">*Figura 8. Estrutura recomendada no armazenamento do Redis para registrar pedidos de clientes e seus detalhes.*</span><span class="sxs-lookup"><span data-stu-id="193c5-439">*Figure 8. Suggested structure in Redis storage for recording customer orders and their details.*</span></span>

> [!NOTE]
> <span data-ttu-id="193c5-440">No Redis, todas as chaves são valores de dados binários (como cadeias de caracteres do Redis) e podem conter até 512 MB de dados.</span><span class="sxs-lookup"><span data-stu-id="193c5-440">In Redis, all keys are binary data values (like Redis strings) and can contain up to 512 MB of data.</span></span> <span data-ttu-id="193c5-441">Teoricamente, uma chave pode conter quase todo tipo de informação.</span><span class="sxs-lookup"><span data-stu-id="193c5-441">In theory, a key can contain almost any information.</span></span> <span data-ttu-id="193c5-442">No entanto, é recomendável adotar uma convenção de nomenclatura consistente para chaves que descrevam o tipo de dados e identifiquem a entidade, mas que não seja excessivamente longa.</span><span class="sxs-lookup"><span data-stu-id="193c5-442">However, we recommend adopting a consistent naming convention for keys that is descriptive of the type of data and that identifies the entity, but is not excessively long.</span></span> <span data-ttu-id="193c5-443">Uma abordagem comum é usar chaves na forma "entity_type: ID".</span><span class="sxs-lookup"><span data-stu-id="193c5-443">A common approach is to use keys of the form "entity_type:ID".</span></span> <span data-ttu-id="193c5-444">Por exemplo, você pode usar "customer:99" para indicar a chave de um cliente com a ID 99.</span><span class="sxs-lookup"><span data-stu-id="193c5-444">For example, you can use "customer:99" to indicate the key for a customer with the ID 99.</span></span>

- <span data-ttu-id="193c5-445">Você pode implementar o particionamento vertical armazenando informações relacionadas em diferentes agregações no mesmo banco de dados.</span><span class="sxs-lookup"><span data-stu-id="193c5-445">You can implement vertical partitioning by storing related information in different aggregations in the same database.</span></span> <span data-ttu-id="193c5-446">Por exemplo, em um aplicativo de comércio eletrônico, você pode armazenar as informações frequentemente acessadas sobre produtos em um hash do Redis e as informações detalhadas usadas com menos frequência em outro.</span><span class="sxs-lookup"><span data-stu-id="193c5-446">For example, in an e-commerce application, you can store commonly accessed information about products in one Redis hash and less frequently used detailed information in another.</span></span> <span data-ttu-id="193c5-447">Os dois hashes podem usar a mesma ID de produto como parte da chave.</span><span class="sxs-lookup"><span data-stu-id="193c5-447">Both hashes can use the same product ID as part of the key.</span></span> <span data-ttu-id="193c5-448">Por exemplo, você pode usar "produto: *nn*" (onde *nn* é a ID do produto) para as informações do produto e "product_details: *nn*" para os dados detalhados.</span><span class="sxs-lookup"><span data-stu-id="193c5-448">For example, you can use "product: *nn*" (where *nn* is the product ID) for the product information and "product_details: *nn*" for the detailed data.</span></span> <span data-ttu-id="193c5-449">Essa estratégia pode ajudar a reduzir o volume de dados que a maioria das consultas provavelmente recuperará.</span><span class="sxs-lookup"><span data-stu-id="193c5-449">This strategy can help reduce the volume of data that most queries are likely to retrieve.</span></span>

- <span data-ttu-id="193c5-450">Você pode reparticionar um repositório de dados do Redis, mas lembre-se de que é uma tarefa complexa e demorada.</span><span class="sxs-lookup"><span data-stu-id="193c5-450">You can repartition a Redis data store, but keep in mind that it's a complex and time-consuming task.</span></span> <span data-ttu-id="193c5-451">O clustering do Redis pode reparticionar os dados automaticamente, mas esse recurso não está disponível com o Cache Redis do Azure.</span><span class="sxs-lookup"><span data-stu-id="193c5-451">Redis clustering can repartition data automatically, but this capability is not available with Azure Redis Cache.</span></span> <span data-ttu-id="193c5-452">Portanto, ao criar o esquema de particionamento, tente deixar espaço livre suficiente em cada partição para permitir o crescimento esperado dos dados com o tempo.</span><span class="sxs-lookup"><span data-stu-id="193c5-452">Therefore, when you design your partitioning scheme, try to leave sufficient free space in each partition to allow for expected data growth over time.</span></span> <span data-ttu-id="193c5-453">No entanto, lembre-se de que o Cache Redis do Azure foi criado para armazenar os dados em cache temporariamente e que os dados mantidos no cache podem ter um tempo de vida limitado especificado como um valor de tempo de vida (TTL).</span><span class="sxs-lookup"><span data-stu-id="193c5-453">However, remember that Azure Redis Cache is intended to cache data temporarily, and that data held in the cache can have a limited lifetime specified as a time-to-live (TTL) value.</span></span> <span data-ttu-id="193c5-454">Para dados relativamente voláteis, o TTL pode ser curto, mas para dados estáticos, o TTL pode ser muito mais longo.</span><span class="sxs-lookup"><span data-stu-id="193c5-454">For relatively volatile data, the TTL can be short, but for static data the TTL can be a lot longer.</span></span> <span data-ttu-id="193c5-455">Evite armazenar grandes quantidades de dados com tempo de vida longo no cache se o volume de dados tiver a probabilidade de preencher o cache.</span><span class="sxs-lookup"><span data-stu-id="193c5-455">Avoid storing large amounts of long-lived data in the cache if the volume of this data is likely to fill the cache.</span></span> <span data-ttu-id="193c5-456">É possível especificar uma política de remoção que faz com que o Cache Redis do Azure remova os dados se o espaço for um fator determinante.</span><span class="sxs-lookup"><span data-stu-id="193c5-456">You can specify an eviction policy that causes Azure Redis Cache to remove data if space is at a premium.</span></span>

  > [!NOTE]
  > <span data-ttu-id="193c5-457">Quando você usa o Cache Redis do Azure, especifica o tamanho máximo do cache (de 250 MB a 53 GB) selecionando o tipo de preço adequado.</span><span class="sxs-lookup"><span data-stu-id="193c5-457">When you use Azure Redis cache, you specify the maximum size of the cache (from 250 MB to 53 GB) by selecting the appropriate pricing tier.</span></span> <span data-ttu-id="193c5-458">No entanto, depois de criar um Cache Redis do Azure, não é possível aumentar (ou diminuir) seu tamanho.</span><span class="sxs-lookup"><span data-stu-id="193c5-458">However, after an Azure Redis Cache has been created, you cannot increase (or decrease) its size.</span></span>

- <span data-ttu-id="193c5-459">Como os lotes e as transações do Redis não abrangem várias conexões, todos os dados afetados por um lote ou uma transação devem ser mantidos no mesmo banco de dados (fragmento).</span><span class="sxs-lookup"><span data-stu-id="193c5-459">Redis batches and transactions cannot span multiple connections, so all data that is affected by a batch or transaction should be held in the same database (shard).</span></span>

  > [!NOTE]
  > <span data-ttu-id="193c5-460">Uma sequência de operações em uma transação do Redis não é necessariamente atômica.</span><span class="sxs-lookup"><span data-stu-id="193c5-460">A sequence of operations in a Redis transaction is not necessarily atomic.</span></span> <span data-ttu-id="193c5-461">Os comandos que compõem uma transação são verificados e enfileirados antes de serem executados.</span><span class="sxs-lookup"><span data-stu-id="193c5-461">The commands that compose a transaction are verified and queued before they run.</span></span> <span data-ttu-id="193c5-462">Se ocorrer um erro durante essa fase, a fila inteira será descartada.</span><span class="sxs-lookup"><span data-stu-id="193c5-462">If an error occurs during this phase, the entire queue is discarded.</span></span> <span data-ttu-id="193c5-463">No entanto, depois que a transação tiver sido enviada com êxito, os comandos na fila serão executados na sequência.</span><span class="sxs-lookup"><span data-stu-id="193c5-463">However, after the transaction has been successfully submitted, the queued commands run in sequence.</span></span> <span data-ttu-id="193c5-464">Se algum comando falhar, somente a execução desse comando será interrompida.</span><span class="sxs-lookup"><span data-stu-id="193c5-464">If any command fails, only that command stops running.</span></span> <span data-ttu-id="193c5-465">Todos os comandos anteriores e subsequentes na fila são executados.</span><span class="sxs-lookup"><span data-stu-id="193c5-465">All previous and subsequent commands in the queue are performed.</span></span> <span data-ttu-id="193c5-466">Para saber mais, visite a página [Transações] no site do Redis.</span><span class="sxs-lookup"><span data-stu-id="193c5-466">For more information, go to the [Transactions] page on the Redis website.</span></span>

- <span data-ttu-id="193c5-467">O Redis permite um número limitado de operações atômicas.</span><span class="sxs-lookup"><span data-stu-id="193c5-467">Redis supports a limited number of atomic operations.</span></span> <span data-ttu-id="193c5-468">As únicas operações desse tipo que permitem vários valores e chaves são MGET e MSET.</span><span class="sxs-lookup"><span data-stu-id="193c5-468">The only operations of this type that support multiple keys and values are MGET and MSET operations.</span></span> <span data-ttu-id="193c5-469">As operações MGET retornam uma coleção de valores para uma lista de chaves especificada e as operações MSET armazenam uma coleção de valores para uma lista de chaves especificada.</span><span class="sxs-lookup"><span data-stu-id="193c5-469">MGET operations return a collection of values for a specified list of keys, and MSET operations store a collection of values for a specified list of keys.</span></span> <span data-ttu-id="193c5-470">Se precisar usar essas operações, os pares de chave/valor referenciados pelos comandos MSET e MGET devem ser armazenados no mesmo banco de dados.</span><span class="sxs-lookup"><span data-stu-id="193c5-470">If you need to use these operations, the key-value pairs that are referenced by the MSET and MGET commands must be stored within the same database.</span></span>

## <a name="partitioning-azure-service-fabric"></a><span data-ttu-id="193c5-471">Particionamento do Azure Service Fabric</span><span class="sxs-lookup"><span data-stu-id="193c5-471">Partitioning Azure Service Fabric</span></span>

<span data-ttu-id="193c5-472">O Azure Service Fabric é uma plataforma de microsserviços que fornece um tempo de execução para aplicativos distribuídos na nuvem.</span><span class="sxs-lookup"><span data-stu-id="193c5-472">Azure Service Fabric is a microservices platform that provides a runtime for distributed applications in the cloud.</span></span> <span data-ttu-id="193c5-473">O Service Fabric oferece suporte a executáveis convidados do .Net, serviços com e sem monitoração de estado e contêineres.</span><span class="sxs-lookup"><span data-stu-id="193c5-473">Service Fabric supports .Net guest executables, stateful and stateless services, and containers.</span></span> <span data-ttu-id="193c5-474">Serviços com monitoração de estado fornecem um [coleção confiável][service-fabric-reliable-collections] para armazenar dados de maneira persistente em uma coleção de chave-valor dentro do cluster do Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="193c5-474">Stateful services provide a [reliable collection][service-fabric-reliable-collections] to persistently store data in a key-value collection within the Service Fabric cluster.</span></span> <span data-ttu-id="193c5-475">Para saber mais sobre as estratégias de particionamento de chaves em uma coleção confiável, consulte [Diretrizes e recomendações para coleções confiáveis no Azure Service Fabric].</span><span class="sxs-lookup"><span data-stu-id="193c5-475">For more information about strategies for partitioning keys in a reliable collection, see [guidelines and recommendations for reliable collections in Azure Service Fabric].</span></span>

### <a name="more-information"></a><span data-ttu-id="193c5-476">Mais informações</span><span class="sxs-lookup"><span data-stu-id="193c5-476">More information</span></span>

- <span data-ttu-id="193c5-477">[Visão geral do Azure Service Fabric] é uma introdução ao Azure Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="193c5-477">[Overview of Azure Service Fabric] is an introduction to Azure Service Fabric.</span></span>

- <span data-ttu-id="193c5-478">[Particionar serviços confiáveis do Service Fabric] fornece mais informações sobre os serviços confiáveis no Azure Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="193c5-478">[Partition Service Fabric reliable services] provides more information about reliable services in Azure Service Fabric.</span></span>

## <a name="partitioning-azure-event-hubs"></a><span data-ttu-id="193c5-479">Particionamento dos Hubs de Eventos do Azure</span><span class="sxs-lookup"><span data-stu-id="193c5-479">Partitioning Azure Event Hubs</span></span>

<span data-ttu-id="193c5-480">Os [Hubs de Eventos do Azure][event-hubs] foram projetados para streaming em grande escala e o particionamento de dados foi inserido no serviço para habilitar o escalonamento horizontal.</span><span class="sxs-lookup"><span data-stu-id="193c5-480">[Azure Event Hubs][event-hubs] is designed for data streaming at massive scale, and partitioning is built into the service to enable horizontal scaling.</span></span> <span data-ttu-id="193c5-481">Cada consumidor lê somente uma partição específica de fluxo de mensagens.</span><span class="sxs-lookup"><span data-stu-id="193c5-481">Each consumer only reads a specific partition of the message stream.</span></span>

<span data-ttu-id="193c5-482">O editor de eventos só está ciente da sua chave de partição, não da partição para a qual os eventos são publicados.</span><span class="sxs-lookup"><span data-stu-id="193c5-482">The event publisher is only aware of its partition key, not the partition to which the events are published.</span></span> <span data-ttu-id="193c5-483">Essa desassociação de chave e partição isenta o remetente da necessidade de saber muito sobre o processamento de downstream.</span><span class="sxs-lookup"><span data-stu-id="193c5-483">This decoupling of key and partition insulates the sender from needing to know too much about the downstream processing.</span></span> <span data-ttu-id="193c5-484">(Também é possível enviar eventos diretamente para uma determinada partição, mas geralmente isso não é recomendável).</span><span class="sxs-lookup"><span data-stu-id="193c5-484">(It's also possible send events directly to a given partition, but generally that's not recommended.)</span></span>  

<span data-ttu-id="193c5-485">Considere a escala de longo prazo quando você seleciona a contagem de partições.</span><span class="sxs-lookup"><span data-stu-id="193c5-485">Consider long-term scale when you select the partition count.</span></span> <span data-ttu-id="193c5-486">Após a criação de um hub de eventos, você não poderá alterar o número de partições.</span><span class="sxs-lookup"><span data-stu-id="193c5-486">After an event hub is created, you can't change the number of partitions.</span></span>

<span data-ttu-id="193c5-487">Para saber mais sobre como usar as partições em Hubs de Eventos, veja [O que são Hubs de Eventos?].</span><span class="sxs-lookup"><span data-stu-id="193c5-487">For more information about using partitions in Event Hubs, see [What is Event Hubs?].</span></span>

<span data-ttu-id="193c5-488">Para obter considerações sobre compensações entre disponibilidade e a consistência, veja [Disponibilidade e consistência nos Hubs de Eventos].</span><span class="sxs-lookup"><span data-stu-id="193c5-488">For considerations about trade-offs between availability and consistency, see [Availability and consistency in Event Hubs].</span></span>

[Disponibilidade e consistência nos Hubs de Eventos]: /azure/event-hubs/event-hubs-availability-and-consistency
[Availability and consistency in Event Hubs]: /azure/event-hubs/event-hubs-availability-and-consistency
[azure-limits]: /azure/azure-subscription-service-limits
[Azure Content Delivery Network]: /azure/cdn/cdn-overview
[Cache Redis do Azure]: https://azure.microsoft.com/services/cache/
[Azure Redis Cache]: https://azure.microsoft.com/services/cache/
[Azure Storage Scalability and Performance Targets]: /azure/storage/storage-scalability-targets
[Guia de design de armazenamento do Azure]: /azure/storage/storage-table-design-guide
[Azure Storage Table Design Guide]: /azure/storage/storage-table-design-guide
[Building a Polyglot Solution]: https://msdn.microsoft.com/library/dn313279.aspx
[cosmos-db-ru]: /azure/cosmos-db/request-units
[Data Access for Highly-Scalable Solutions: Using SQL, NoSQL, and Polyglot Persistence]: https://msdn.microsoft.com/library/dn271399.aspx
[Data consistency primer]: https://aka.ms/Data-Consistency-Primer
[Data Partitioning Guidance]: https://msdn.microsoft.com/library/dn589795.aspx
[Data Types]: https://redis.io/topics/data-types
[cosmosdb-sql-api]: /azure/cosmos-db/sql-api-introduction
[Elastic Database features overview]: /azure/sql-database/sql-database-elastic-scale-introduction
[event-hubs]: /azure/event-hubs
[Federations Migration Utility]: https://code.msdn.microsoft.com/vstudio/Federations-Migration-ce61e9c1
[diretrizes e recomendações para Coleções Confiáveis no Azure Service Fabric]: /azure/service-fabric/service-fabric-reliable-services-reliable-collections-guidelines
[guidelines and recommendations for reliable collections in Azure Service Fabric]: /azure/service-fabric/service-fabric-reliable-services-reliable-collections-guidelines
[Multi-shard querying]: /azure/sql-database/sql-database-elastic-scale-multishard-querying
[Visão geral do Azure Service Fabric]: /azure/service-fabric/service-fabric-overview
[Overview of Azure Service Fabric]: /azure/service-fabric/service-fabric-overview
[Particionar serviços confiáveis do Service Fabric]: /azure/service-fabric/service-fabric-concepts-partitioning
[Partition Service Fabric reliable services]: /azure/service-fabric/service-fabric-concepts-partitioning
[Partitioning: how to split data among multiple Redis instances]: https://redis.io/topics/partitioning
[Executar transações de grupo de entidade]: /rest/api/storageservices/Performing-Entity-Group-Transactions
[Performing Entity Group Transactions]: /rest/api/storageservices/Performing-Entity-Group-Transactions
[tutorial de cluster do Redis]: https://redis.io/topics/cluster-tutorial
[Redis cluster tutorial]: https://redis.io/topics/cluster-tutorial
[Running Redis on a CentOS Linux VM in Azure]: https://blogs.msdn.microsoft.com/tconte/2012/06/08/running-redis-on-a-centos-linux-vm-in-windows-azure/
[Scaling using the Elastic Database split-merge tool]: /azure/sql-database/sql-database-elastic-scale-overview-split-and-merge
[Using Azure Content Delivery Network]: /azure/cdn/cdn-create-new-endpoint
[Cotas do Barramento de Serviço]: /azure/service-bus-messaging/service-bus-quotas
[Service Bus quotas]: /azure/service-bus-messaging/service-bus-quotas
[service-fabric-reliable-collections]: /azure/service-fabric/service-fabric-reliable-services-reliable-collections
[Limites de serviço no Azure Search]:  /azure/search/search-limits-quotas-capacity
[Service limits in Azure Search]:  /azure/search/search-limits-quotas-capacity
[Sharding pattern]: ../patterns/sharding.md
[Tipos de Dados com Suporte (Azure Search)]:  https://msdn.microsoft.com/library/azure/dn798938.aspx
[Supported Data Types (Azure Search)]:  https://msdn.microsoft.com/library/azure/dn798938.aspx
[Transações]: https://redis.io/topics/transactions
[Transactions]: https://redis.io/topics/transactions
[O que são Hubs de Eventos?]: /azure/event-hubs/event-hubs-what-is-event-hubs
[What is Event Hubs?]: /azure/event-hubs/event-hubs-what-is-event-hubs
[O que é o Azure Search?]: /azure/search/search-what-is-azure-search
[What is Azure Search?]: /azure/search/search-what-is-azure-search
[What is Azure SQL Database?]: /azure/sql-database/sql-database-technical-overview
[alvos de escalabilidade]: /azure/storage/common/storage-scalability-targets
[scalability targets]: /azure/storage/common/storage-scalability-targets
