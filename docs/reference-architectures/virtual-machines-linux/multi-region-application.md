---
title: "Executar VMs do Linux em várias regiões do Azure para ter alta disponibilidade"
description: "Como implantar VMs em várias regiões no Azure para alta disponibilidade e resiliência."
author: MikeWasson
ms.date: 11/22/2016
pnp.series.title: Linux VM workloads
pnp.series.prev: n-tier
ms.openlocfilehash: 7d720a004d21edbffc0ddeba54e291aa817550e0
ms.sourcegitcommit: c9e6d8edb069b8c513de748ce8114c879bad5f49
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2018
---
# <a name="run-linux-vms-in-multiple-regions-for-high-availability"></a><span data-ttu-id="d3357-103">Executar VMs do Linux em várias regiões para ter alta disponibilidade</span><span class="sxs-lookup"><span data-stu-id="d3357-103">Run Linux VMs in multiple regions for high availability</span></span>

<span data-ttu-id="d3357-104">Essa arquitetura de referência mostra um conjunto de práticas comprovadas para executar um aplicativo de N camadas em várias regiões do Azure, a fim de alcançar a disponibilidade e uma infraestrutura de recuperação de desastres robusta.</span><span class="sxs-lookup"><span data-stu-id="d3357-104">This reference architecture shows a set of proven practices for running an N-tier application in multiple Azure regions, in order to achieve availability and a robust disaster recovery infrastructure.</span></span> 

<span data-ttu-id="d3357-105">![[0]][0]</span><span class="sxs-lookup"><span data-stu-id="d3357-105">![[0]][0]</span></span>

<span data-ttu-id="d3357-106">*Baixe um [Arquivo Visio][visio-download] dessa arquitetura.*</span><span class="sxs-lookup"><span data-stu-id="d3357-106">*Download a [Visio file][visio-download] of this architecture.*</span></span>

## <a name="architecture"></a><span data-ttu-id="d3357-107">Arquitetura</span><span class="sxs-lookup"><span data-stu-id="d3357-107">Architecture</span></span> 

<span data-ttu-id="d3357-108">Essa arquitetura baseia-se naquela mostrada em [Executar VMs do Linux para um aplicativo de N camadas](n-tier.md).</span><span class="sxs-lookup"><span data-stu-id="d3357-108">This architecture builds on the one shown in [Run Linux VMs for an N-tier application](n-tier.md).</span></span> 

* <span data-ttu-id="d3357-109">**Regiões primárias e secundárias**.</span><span class="sxs-lookup"><span data-stu-id="d3357-109">**Primary and secondary regions**.</span></span> <span data-ttu-id="d3357-110">Use duas regiões para obter alta disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="d3357-110">Use two regions to achieve higher availability.</span></span> <span data-ttu-id="d3357-111">Uma é a região primária, a outra destina-se a failover.</span><span class="sxs-lookup"><span data-stu-id="d3357-111">One is the primary region.The other region is for failover.</span></span>
* <span data-ttu-id="d3357-112">**DNS do Azure**.</span><span class="sxs-lookup"><span data-stu-id="d3357-112">**Azure DNS**.</span></span> <span data-ttu-id="d3357-113">[DNS do Azure][azure-dns] é um serviço de hospedagem para domínios DNS, que fornece resolução de nomes usando a infraestrutura do Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="d3357-113">[Azure DNS][azure-dns] is a hosting service for DNS domains, providing name resolution using Microsoft Azure infrastructure.</span></span> <span data-ttu-id="d3357-114">Ao hospedar seus domínios no Azure, você pode gerenciar seus registros DNS usando as mesmas credenciais, APIs, ferramentas e cobrança que seus outros serviços do Azure.</span><span class="sxs-lookup"><span data-stu-id="d3357-114">By hosting your domains in Azure, you can manage your DNS records using the same credentials, APIs, tools, and billing as your other Azure services.</span></span>
* <span data-ttu-id="d3357-115">**Gerenciador de Tráfego do Microsoft Azure**.</span><span class="sxs-lookup"><span data-stu-id="d3357-115">**Azure Traffic Manager**.</span></span> <span data-ttu-id="d3357-116">O [Gerenciador de Tráfego][traffic-manager] roteia as solicitações de entrada para uma das regiões.</span><span class="sxs-lookup"><span data-stu-id="d3357-116">[Traffic Manager][traffic-manager] routes incoming requests to one of the regions.</span></span> <span data-ttu-id="d3357-117">Durante as operações normais, ele roteia as solicitações para a região primária.</span><span class="sxs-lookup"><span data-stu-id="d3357-117">During normal operations, it routes requests to the primary region.</span></span> <span data-ttu-id="d3357-118">Se essa região ficar indisponível, o Gerenciador de Tráfego fará failover para a região secundária.</span><span class="sxs-lookup"><span data-stu-id="d3357-118">If that region becomes unavailable, Traffic Manager fails over to the secondary region.</span></span> <span data-ttu-id="d3357-119">Para obter mais informações, consulte a [Configuração do Gerenciador de Tráfego](#traffic-manager-configuration).</span><span class="sxs-lookup"><span data-stu-id="d3357-119">For more information, see the section [Traffic Manager configuration](#traffic-manager-configuration).</span></span>
* <span data-ttu-id="d3357-120">**Grupos de recursos**.</span><span class="sxs-lookup"><span data-stu-id="d3357-120">**Resource groups**.</span></span> <span data-ttu-id="d3357-121">Crie [grupos de recursos][resource groups] separados para a região primária, a região secundária e para o Gerenciador de Tráfego.</span><span class="sxs-lookup"><span data-stu-id="d3357-121">Create separate [resource groups][resource groups] for the primary region, the secondary region, and for Traffic Manager.</span></span> <span data-ttu-id="d3357-122">Isso oferece flexibilidade para gerenciar cada região como uma única coleção de recursos.</span><span class="sxs-lookup"><span data-stu-id="d3357-122">This gives you the flexibility to manage each region as a single collection of resources.</span></span> <span data-ttu-id="d3357-123">Por exemplo, você poderia reimplantar uma região sem interromper a outra.</span><span class="sxs-lookup"><span data-stu-id="d3357-123">For example, you could redeploy one region, without taking down the other one.</span></span> <span data-ttu-id="d3357-124">[Vincule os grupos de recursos][resource-group-links] para ser possível executar uma consulta para listar todos os recursos para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d3357-124">[Link the resource groups][resource-group-links], so that you can run a query to list all the resources for the application.</span></span>
* <span data-ttu-id="d3357-125">**VNets**.</span><span class="sxs-lookup"><span data-stu-id="d3357-125">**VNets**.</span></span> <span data-ttu-id="d3357-126">Crie uma VNet separada para cada região.</span><span class="sxs-lookup"><span data-stu-id="d3357-126">Create a separate VNet for each region.</span></span> <span data-ttu-id="d3357-127">Verifique se que os espaços de endereço não se sobrepõem.</span><span class="sxs-lookup"><span data-stu-id="d3357-127">Make sure the address spaces do not overlap.</span></span>
* <span data-ttu-id="d3357-128">**Apache Cassandra**.</span><span class="sxs-lookup"><span data-stu-id="d3357-128">**Apache Cassandra**.</span></span> <span data-ttu-id="d3357-129">Implante o Cassandra em data centers nas regiões do Azure para ter alta disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="d3357-129">Deploy Cassandra in data centers across Azure regions for high availability.</span></span> <span data-ttu-id="d3357-130">Dentro de cada região, os nós são configurados no modo de reconhecimento de rack com domínios de falha e de atualização para garantir a resiliência dentro da região.</span><span class="sxs-lookup"><span data-stu-id="d3357-130">Within each region, nodes are configured in rack-aware mode with fault and upgrade domains, for resiliency inside the region.</span></span>

## <a name="recommendations"></a><span data-ttu-id="d3357-131">Recomendações</span><span class="sxs-lookup"><span data-stu-id="d3357-131">Recommendations</span></span>

<span data-ttu-id="d3357-132">Uma arquitetura de várias regiões pode fornecer uma disponibilidade maior que a implantação em uma única região.</span><span class="sxs-lookup"><span data-stu-id="d3357-132">A multi-region architecture can provide higher availability than deploying to a single region.</span></span> <span data-ttu-id="d3357-133">Se uma interrupção regional afetar a região primária, você poderá usar o [Gerenciador de Tráfego][traffic-manager] para fazer failover para a região secundária.</span><span class="sxs-lookup"><span data-stu-id="d3357-133">If a regional outage affects the primary region, you can use [Traffic Manager][traffic-manager] to fail over to the secondary region.</span></span> <span data-ttu-id="d3357-134">Essa arquitetura também poderá ajudar a se um subsistema individual do aplicativo falhar.</span><span class="sxs-lookup"><span data-stu-id="d3357-134">This architecture can also help if an individual subsystem of the application fails.</span></span>

<span data-ttu-id="d3357-135">Há várias abordagens gerais para alcançar alta disponibilidade em várias regiões:</span><span class="sxs-lookup"><span data-stu-id="d3357-135">There are several general approaches to achieving high availability across regions:</span></span>   

* <span data-ttu-id="d3357-136">Ativo/passivo com espera ativa.</span><span class="sxs-lookup"><span data-stu-id="d3357-136">Active/passive with hot standby.</span></span> <span data-ttu-id="d3357-137">O tráfego vai para uma região, enquanto a outra aguarda em espera ativa.</span><span class="sxs-lookup"><span data-stu-id="d3357-137">Traffic goes to one region, while the other waits on hot standby.</span></span> <span data-ttu-id="d3357-138">A espera ativa significa que as VMs na região secundária são alocadas e ficam em execução a todo momentos.</span><span class="sxs-lookup"><span data-stu-id="d3357-138">Hot standby means the VMs in the secondary region are allocated and running at all times.</span></span>
* <span data-ttu-id="d3357-139">Ativo/passivo com espera passiva.</span><span class="sxs-lookup"><span data-stu-id="d3357-139">Active/passive with cold standby.</span></span> <span data-ttu-id="d3357-140">O tráfego vai para uma região, enquanto a outra aguarda em espera passiva.</span><span class="sxs-lookup"><span data-stu-id="d3357-140">Traffic goes to one region, while the other waits on cold standby.</span></span> <span data-ttu-id="d3357-141">A espera passiva significa que as VMs na região secundária não são alocadas até serem necessárias para failover.</span><span class="sxs-lookup"><span data-stu-id="d3357-141">Cold standby means the VMs in the secondary region are not allocated until needed for failover.</span></span> <span data-ttu-id="d3357-142">Essa abordagem custa menos para ser executada, mas geralmente leva mais tempo para ficar online durante uma falha.</span><span class="sxs-lookup"><span data-stu-id="d3357-142">This approach costs less to run, but will generally take longer to come online during a failure.</span></span>
* <span data-ttu-id="d3357-143">Ativa/ativa.</span><span class="sxs-lookup"><span data-stu-id="d3357-143">Active/active.</span></span> <span data-ttu-id="d3357-144">Ambas as regiões ficam ativas e a carga das solicitações é balanceada entre elas.</span><span class="sxs-lookup"><span data-stu-id="d3357-144">Both regions are active, and requests are load balanced between them.</span></span> <span data-ttu-id="d3357-145">Se uma região ficar indisponível, ela será retirada da rotação.</span><span class="sxs-lookup"><span data-stu-id="d3357-145">If one region becomes unavailable, it is taken out of rotation.</span></span> 

<span data-ttu-id="d3357-146">Essa arquitetura de referência se concentra em ativo/passivo com espera ativa, usando o Gerenciador de Tráfego para failover.</span><span class="sxs-lookup"><span data-stu-id="d3357-146">This architecture focuses on active/passive with hot standby, using Traffic Manager for failover.</span></span> <span data-ttu-id="d3357-147">Observe que você poderia implantar um pequeno número de VMs para espera ativa e, em seguida, aumentar conforme necessário.</span><span class="sxs-lookup"><span data-stu-id="d3357-147">Note that you could deploy a small number of VMs for hot standby and then scale out as needed.</span></span>


### <a name="regional-pairing"></a><span data-ttu-id="d3357-148">Emparelhamento regional</span><span class="sxs-lookup"><span data-stu-id="d3357-148">Regional pairing</span></span>

<span data-ttu-id="d3357-149">Cada região do Azure é emparelhada com outra na mesma área geográfica.</span><span class="sxs-lookup"><span data-stu-id="d3357-149">Each Azure region is paired with another region within the same geography.</span></span> <span data-ttu-id="d3357-150">Em geral, escolha regiões do mesmo par regional (por exemplo, Leste dos EUA 2 e Centro dos EUA).</span><span class="sxs-lookup"><span data-stu-id="d3357-150">In general, choose regions from the same regional pair (for example, East US 2 and US Central).</span></span> <span data-ttu-id="d3357-151">Os benefícios de se fazer isso são:</span><span class="sxs-lookup"><span data-stu-id="d3357-151">Benefits of doing so include:</span></span>

* <span data-ttu-id="d3357-152">No caso de uma interrupção ampla, a recuperação de pelo menos uma região de cada par é priorizada.</span><span class="sxs-lookup"><span data-stu-id="d3357-152">If there is a broad outage, recovery of at least one region out of every pair is prioritized.</span></span>
* <span data-ttu-id="d3357-153">As atualizações planejadas do sistema do Azure são distribuídas em regiões emparelhadas sequencialmente para minimizar o possível tempo de inatividade.</span><span class="sxs-lookup"><span data-stu-id="d3357-153">Planned Azure system updates are rolled out to paired regions sequentially, to minimize possible downtime.</span></span>
* <span data-ttu-id="d3357-154">Os pares residem na mesma geografia para atender aos requisitos de residência de dados.</span><span class="sxs-lookup"><span data-stu-id="d3357-154">Pairs reside within the same geography, to meet data residency requirements.</span></span>

<span data-ttu-id="d3357-155">No entanto, verifique se ambas as regiões dão suporte a todos os serviços do Azure necessários para seu aplicativo (consulte [Serviços por região][services-by-region]).</span><span class="sxs-lookup"><span data-stu-id="d3357-155">However, make sure that both regions support all of the Azure services needed for your application (see [Services by region][services-by-region]).</span></span> <span data-ttu-id="d3357-156">Para saber mais sobre pares regionais, consulte [Continuidade dos negócios e recuperação de desastres (BCDR): Regiões Emparelhadas do Azure][regional-pairs].</span><span class="sxs-lookup"><span data-stu-id="d3357-156">For more information about regional pairs, see [Business continuity and disaster recovery (BCDR): Azure Paired Regions][regional-pairs].</span></span>

### <a name="traffic-manager-configuration"></a><span data-ttu-id="d3357-157">Configuração do Gerenciador de Tráfego</span><span class="sxs-lookup"><span data-stu-id="d3357-157">Traffic Manager configuration</span></span>

<span data-ttu-id="d3357-158">Considere os seguintes pontos ao configurar o Gerenciador de Tráfego:</span><span class="sxs-lookup"><span data-stu-id="d3357-158">Consider the following points when configuring Traffic Manager:</span></span>

* <span data-ttu-id="d3357-159">**Roteamento**.</span><span class="sxs-lookup"><span data-stu-id="d3357-159">**Routing**.</span></span> <span data-ttu-id="d3357-160">O Gerenciador de Tráfego dá suporte a vários [algoritmos de roteamento][tm-routing].</span><span class="sxs-lookup"><span data-stu-id="d3357-160">Traffic Manager supports several [routing algorithms][tm-routing].</span></span> <span data-ttu-id="d3357-161">Para o cenário descrito neste artigo, use roteamento *prioritário* (anteriormente chamado de roteamento de *failover*).</span><span class="sxs-lookup"><span data-stu-id="d3357-161">For the scenario described in this article, use *priority* routing (formerly called *failover* routing).</span></span> <span data-ttu-id="d3357-162">Com essa configuração, o Gerenciador de Tráfego envia todas as solicitações para a região primária, a menos que ela fique inacessível.</span><span class="sxs-lookup"><span data-stu-id="d3357-162">With this setting, Traffic Manager sends all requests to the primary region, unless the primary region becomes unreachable.</span></span> <span data-ttu-id="d3357-163">Nesse ponto, ele automaticamente faz failover para a região secundária.</span><span class="sxs-lookup"><span data-stu-id="d3357-163">At that point, it automatically fails over to the secondary region.</span></span> <span data-ttu-id="d3357-164">Consulte [Configurar o método de roteamento de failover][tm-configure-failover].</span><span class="sxs-lookup"><span data-stu-id="d3357-164">See [Configure Failover routing method][tm-configure-failover].</span></span>
* <span data-ttu-id="d3357-165">**Investigação de integridade**.</span><span class="sxs-lookup"><span data-stu-id="d3357-165">**Health probe**.</span></span> <span data-ttu-id="d3357-166">O Gerenciador de Tráfego usa uma [investigação][tm-monitoring] HTTP (ou HTTPS) para monitorar a disponibilidade de cada região.</span><span class="sxs-lookup"><span data-stu-id="d3357-166">Traffic Manager uses an HTTP (or HTTPS) [probe][tm-monitoring] to monitor the availability of each region.</span></span> <span data-ttu-id="d3357-167">A investigação verifica uma resposta HTTP 200 para um caminho de URL especificado.</span><span class="sxs-lookup"><span data-stu-id="d3357-167">The probe checks for an HTTP 200 response for a specified URL path.</span></span> <span data-ttu-id="d3357-168">Como uma prática recomendada, crie um ponto de extremidade que relata a integridade geral do aplicativo e use esse ponto de extremidade para a investigação de integridade.</span><span class="sxs-lookup"><span data-stu-id="d3357-168">As a best practice, create an endpoint that reports the overall health of the application, and use this endpoint for the health probe.</span></span> <span data-ttu-id="d3357-169">Caso contrário, a investigação pode relatar um ponto de extremidade íntegro quando partes essenciais do aplicativo estão falhando na verdade.</span><span class="sxs-lookup"><span data-stu-id="d3357-169">Otherwise, the probe might report a healthy endpoint when critical parts of the application are actually failing.</span></span> <span data-ttu-id="d3357-170">Para obter mais informações, consulte o [Padrão de monitoramento de ponto de extremidade de integridade][health-endpoint-monitoring-pattern].</span><span class="sxs-lookup"><span data-stu-id="d3357-170">For more information, see [Health Endpoint Monitoring Pattern][health-endpoint-monitoring-pattern].</span></span>

<span data-ttu-id="d3357-171">Quando o Gerenciador de Tráfego faz failover, há um período em que os clientes não podem acessar o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d3357-171">When Traffic Manager fails over there is a period of time when clients cannot reach the application.</span></span> <span data-ttu-id="d3357-172">A duração é afetada pelos seguintes fatores:</span><span class="sxs-lookup"><span data-stu-id="d3357-172">The duration is affected by the following factors:</span></span>

* <span data-ttu-id="d3357-173">A investigação de integridade precisa detectar que a região primária ficou inacessível.</span><span class="sxs-lookup"><span data-stu-id="d3357-173">The health probe must detect that the primary region has become unreachable.</span></span>
* <span data-ttu-id="d3357-174">Os servidores DNS precisam atualizar os registros DNS armazenados em cache para o endereço IP, dependendo da TTL (vida útil) DNS.</span><span class="sxs-lookup"><span data-stu-id="d3357-174">DNS servers must update the cached DNS records for the IP address, which depends on the DNS time-to-live (TTL).</span></span> <span data-ttu-id="d3357-175">A TTL padrão é 300 segundos (5 minutos), mas você pode configurar esse valor ao criar o perfil do Gerenciador de Tráfego.</span><span class="sxs-lookup"><span data-stu-id="d3357-175">The default TTL is 300 seconds (5 minutes), but you can configure this value when you create the Traffic Manager profile.</span></span>

<span data-ttu-id="d3357-176">Para saber mais, consulte [Sobre o monitoramento do Gerenciador de Tráfego][tm-monitoring].</span><span class="sxs-lookup"><span data-stu-id="d3357-176">For details, see [About Traffic Manager Monitoring][tm-monitoring].</span></span>

<span data-ttu-id="d3357-177">Em caso de falha do Gerenciador de Tráfego, é recomendável executar um failback manual em vez de implementar um failback automático.</span><span class="sxs-lookup"><span data-stu-id="d3357-177">If Traffic Manager fails over, we recommend performing a manual failback rather than implementing an automatic failback.</span></span> <span data-ttu-id="d3357-178">Caso contrário, você pode criar uma situação em que o aplicativo fica alternando entre as regiões.</span><span class="sxs-lookup"><span data-stu-id="d3357-178">Otherwise, you can create a situation where the application flips back and forth between regions.</span></span> <span data-ttu-id="d3357-179">Verifique se todos os subsistemas de aplicativo estão íntegros antes de realizar o failback.</span><span class="sxs-lookup"><span data-stu-id="d3357-179">Verify that all application subsystems are healthy before failing back.</span></span>

<span data-ttu-id="d3357-180">Observe que o Gerenciador de Tráfego realiza failback automaticamente por padrão.</span><span class="sxs-lookup"><span data-stu-id="d3357-180">Note that Traffic Manager automatically fails back by default.</span></span> <span data-ttu-id="d3357-181">Para evitar isso, diminua manualmente a prioridade da região primária após um evento de failover.</span><span class="sxs-lookup"><span data-stu-id="d3357-181">To prevent this, manually lower the priority of the primary region after a failover event.</span></span> <span data-ttu-id="d3357-182">Por exemplo, suponha que a região primária tem prioridade 1 e a secundária tem prioridade 2.</span><span class="sxs-lookup"><span data-stu-id="d3357-182">For example, suppose the primary region is priority 1 and the secondary is priority 2.</span></span> <span data-ttu-id="d3357-183">Após um failover, defina a região primária para a prioridade 3, para impedir o failback automático.</span><span class="sxs-lookup"><span data-stu-id="d3357-183">After a failover, set the primary region to priority 3, to prevent automatic failback.</span></span> <span data-ttu-id="d3357-184">Quando você estiver pronto retornar para ela, atualize a prioridade para 1.</span><span class="sxs-lookup"><span data-stu-id="d3357-184">When you are ready to switch back, update the priority to 1.</span></span>

<span data-ttu-id="d3357-185">O seguinte comando da [CLI do Azure][install-azure-cli] atualiza a prioridade:</span><span class="sxs-lookup"><span data-stu-id="d3357-185">The following [Azure CLI][install-azure-cli] command updates the priority:</span></span>

```bat
azure network traffic-manager  endpoint set --resource-group <resource-group> --profile-name <profile>
    --name <traffic-manager-name> --type AzureEndpoints --priority 3
```    

<span data-ttu-id="d3357-186">Outra abordagem é desabilitar temporariamente o ponto de extremidade até que você esteja pronto para realizar failback:</span><span class="sxs-lookup"><span data-stu-id="d3357-186">Another approach is to temporarily disable the endpoint until you are ready to fail back:</span></span>

```bat
azure network traffic-manager  endpoint set --resource-group <resource-group> --profile-name <profile>
    --name <traffic-manager-name> --type AzureEndpoints --status Disabled
```    

<span data-ttu-id="d3357-187">Dependendo da causa de um failover, será necessário reimplantar os recursos dentro de uma região.</span><span class="sxs-lookup"><span data-stu-id="d3357-187">Depending on the cause of a failover, you might need to redeploy the resources within a region.</span></span> <span data-ttu-id="d3357-188">Antes de fazer o failback, execute um teste de prontidão operacional.</span><span class="sxs-lookup"><span data-stu-id="d3357-188">Before failing back, perform an operational readiness test.</span></span> <span data-ttu-id="d3357-189">O teste deverá verificar o seguinte:</span><span class="sxs-lookup"><span data-stu-id="d3357-189">The test should verify things like:</span></span>

* <span data-ttu-id="d3357-190">As VMs estão configuradas corretamente.</span><span class="sxs-lookup"><span data-stu-id="d3357-190">VMs are configured correctly.</span></span> <span data-ttu-id="d3357-191">(Todo o software necessário está instalado, o IIS está em execução e assim por diante.)</span><span class="sxs-lookup"><span data-stu-id="d3357-191">(All required software is installed, IIS is running, and so on.)</span></span>
* <span data-ttu-id="d3357-192">Os subsistemas de aplicativos estão íntegros.</span><span class="sxs-lookup"><span data-stu-id="d3357-192">Application subsystems are healthy.</span></span>
* <span data-ttu-id="d3357-193">Testes funcionais.</span><span class="sxs-lookup"><span data-stu-id="d3357-193">Functional testing.</span></span> <span data-ttu-id="d3357-194">(Por exemplo, a camada de banco de dados pode ser acessada da camada da Web.)</span><span class="sxs-lookup"><span data-stu-id="d3357-194">(For example, the database tier is reachable from the web tier.)</span></span>

### <a name="cassandra-deployment-across-multiple-regions"></a><span data-ttu-id="d3357-195">Implantação de Cassandra em várias regiões</span><span class="sxs-lookup"><span data-stu-id="d3357-195">Cassandra deployment across multiple regions</span></span>

<span data-ttu-id="d3357-196">Data centers Cassandra são um grupo de nós de dados relacionados que são configurados juntos em um cluster para replicação e diferenciação de carga de trabalho.</span><span class="sxs-lookup"><span data-stu-id="d3357-196">Cassandra data centers are a group of related data nodes that are configured together within a cluster for replication and workload segregation.</span></span>

<span data-ttu-id="d3357-197">Recomendamos o [DataStax Enterprise][datastax] para uso na produção.</span><span class="sxs-lookup"><span data-stu-id="d3357-197">We recommend [DataStax Enterprise][datastax] for production use.</span></span> <span data-ttu-id="d3357-198">Para obter mais informações sobre como executar o DataStax no Azure, consulte [Guia de implantação do DataStax Enterprise no Azure][cassandra-in-azure].</span><span class="sxs-lookup"><span data-stu-id="d3357-198">For more information on running DataStax in Azure, see [DataStax Enterprise Deployment Guide for Azure][cassandra-in-azure].</span></span> <span data-ttu-id="d3357-199">As seguintes recomendações gerais se aplicam a qualquer edição do Cassandra:</span><span class="sxs-lookup"><span data-stu-id="d3357-199">The following general recommendations apply to any Cassandra edition:</span></span> 

* <span data-ttu-id="d3357-200">Atribua um endereço IP público para cada nó.</span><span class="sxs-lookup"><span data-stu-id="d3357-200">Assign a public IP address to each node.</span></span> <span data-ttu-id="d3357-201">Isso permite que os clusters se comuniquem entre regiões usando a infraestrutura de backbone do Azure, fornecendo alta taxa de transferência a baixo custo.</span><span class="sxs-lookup"><span data-stu-id="d3357-201">This enables the clusters to communicate across regions using the Azure backbone infrastructure, providing high throughput at low cost.</span></span>
* <span data-ttu-id="d3357-202">Proteja os nós usando o firewall e as configurações de NSG (grupo de segurança de rede) apropriados, permitindo somente o tráfego de e para hosts conhecidos, incluindo os clientes e outros nós de cluster.</span><span class="sxs-lookup"><span data-stu-id="d3357-202">Secure nodes using the appropriate firewall and network security group (NSG) configurations, allowing traffic only to and from known hosts, including clients and other cluster nodes.</span></span> <span data-ttu-id="d3357-203">Observe que o Cassandra usa portas diferentes para comunicação, OpsCenter, Spark e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="d3357-203">Note that Cassandra uses different ports for communication, OpsCenter, Spark, and so forth.</span></span> <span data-ttu-id="d3357-204">Para ver mais sobre o uso de portas no Cassandra, consulte [Configurando o acesso de porta de firewall][cassandra-ports].</span><span class="sxs-lookup"><span data-stu-id="d3357-204">For port usage in Cassandra, see [Configuring firewall port access][cassandra-ports].</span></span>
* <span data-ttu-id="d3357-205">Use criptografia SSL para todas as comunicações [cliente para nó][ssl-client-node] e [nó para nó][ssl-node-node].</span><span class="sxs-lookup"><span data-stu-id="d3357-205">Use SSL encryption for all [client-to-node][ssl-client-node] and [node-to-node][ssl-node-node] communications.</span></span>
* <span data-ttu-id="d3357-206">Dentro de uma região, siga as diretrizes das [Recomendações do Cassandra](n-tier.md#cassandra).</span><span class="sxs-lookup"><span data-stu-id="d3357-206">Within a region, follow the guidelines in [Cassandra recommendations](n-tier.md#cassandra).</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="d3357-207">Considerações sobre disponibilidade</span><span class="sxs-lookup"><span data-stu-id="d3357-207">Availability considerations</span></span>

<span data-ttu-id="d3357-208">Com um aplicativo complexo de N camadas, pode não ser necessário replicar o aplicativo inteiro na região secundária.</span><span class="sxs-lookup"><span data-stu-id="d3357-208">With a complex N-tier app, you may not need to replicate the entire application in the secondary region.</span></span> <span data-ttu-id="d3357-209">Em vez disso, você pode replicar apenas um subsistema crítico que é necessário para dar suporte à continuidade de negócios.</span><span class="sxs-lookup"><span data-stu-id="d3357-209">Instead, you might just replicate a critical subsystem that is needed to support business continuity.</span></span>

<span data-ttu-id="d3357-210">O Gerenciador de Tráfego é um possível ponto de falha no sistema.</span><span class="sxs-lookup"><span data-stu-id="d3357-210">Traffic Manager is a possible failure point in the system.</span></span> <span data-ttu-id="d3357-211">Se o serviço do Gerenciador de Tráfego falhar, os clientes não poderão acessar seu aplicativo durante o tempo de inatividade.</span><span class="sxs-lookup"><span data-stu-id="d3357-211">If the Traffic Manager service fails, clients cannot access your application during the downtime.</span></span> <span data-ttu-id="d3357-212">Examine o [SLA do Gerenciador de Tráfego][tm-sla] e determine se usar apenas o Gerenciador de Tráfego atende aos seus requisitos de negócios para alta disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="d3357-212">Review the [Traffic Manager SLA][tm-sla], and determine whether using Traffic Manager alone meets your business requirements for high availability.</span></span> <span data-ttu-id="d3357-213">Caso contrário, considere adicionar outra solução de gerenciamento de tráfego como um failback.</span><span class="sxs-lookup"><span data-stu-id="d3357-213">If not, consider adding another traffic management solution as a failback.</span></span> <span data-ttu-id="d3357-214">Se o serviço do Gerenciador de Tráfego do Azure falhar, altere os registros CNAME no DNS para apontar para outro serviço de gerenciamento de tráfego.</span><span class="sxs-lookup"><span data-stu-id="d3357-214">If the Azure Traffic Manager service fails, change your CNAME records in DNS to point to the other traffic management service.</span></span> <span data-ttu-id="d3357-215">(Esta etapa deve ser executada manualmente e seu aplicativo estará indisponível até que as alterações de DNS sejam propagadas.)</span><span class="sxs-lookup"><span data-stu-id="d3357-215">(This step must be performed manually, and your application will be unavailable until the DNS changes are propagated.)</span></span>

<span data-ttu-id="d3357-216">Para o cluster Cassandra, os cenários de failover a considerar dependem dos níveis de consistência usados pelo aplicativo, bem como o número de réplicas usadas.</span><span class="sxs-lookup"><span data-stu-id="d3357-216">For the Cassandra cluster, the failover scenarios to consider depend on the consistency levels used by the application, as well as the number of replicas used.</span></span> <span data-ttu-id="d3357-217">Para níveis de consistência e uso no Cassandra, consulte [Configurando a consistência dos dados][cassandra-consistency] e [Cassandra: quantos nós se comunicam com o Quorum?][cassandra-consistency-usage]</span><span class="sxs-lookup"><span data-stu-id="d3357-217">For consistency levels and usage in Cassandra, see [Configuring data consistency][cassandra-consistency] and [Cassandra: How many nodes are talked to with Quorum?][cassandra-consistency-usage]</span></span> <span data-ttu-id="d3357-218">A disponibilidade de dados do Cassandra é determinada pelo nível de consistência usado pelo aplicativo e pelo mecanismo de replicação.</span><span class="sxs-lookup"><span data-stu-id="d3357-218">Data availability in Cassandra is determined by the consistency level used by the application and the replication mechanism.</span></span> <span data-ttu-id="d3357-219">Para replicação no Cassandra, consulte [Explicação de replicação de dados em Bancos de Dados NoSQL][cassandra-replication].</span><span class="sxs-lookup"><span data-stu-id="d3357-219">For replication in Cassandra, see [Data Replication in NoSQL Databases Explained][cassandra-replication].</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="d3357-220">Considerações sobre capacidade de gerenciamento</span><span class="sxs-lookup"><span data-stu-id="d3357-220">Manageability considerations</span></span>

<span data-ttu-id="d3357-221">Quando você atualizar a implantação, atualize uma região de cada vez para reduzir a chance de uma falha global devido a uma configuração incorreta ou um erro no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d3357-221">When you update your deployment, update one region at a time to reduce the chance of a global failure from an incorrect configuration or an error in the application.</span></span>

<span data-ttu-id="d3357-222">Teste a resiliência do sistema a falhas.</span><span class="sxs-lookup"><span data-stu-id="d3357-222">Test the resiliency of the system to failures.</span></span> <span data-ttu-id="d3357-223">Aqui estão alguns cenários comuns de falha para testar:</span><span class="sxs-lookup"><span data-stu-id="d3357-223">Here are some common failure scenarios to test:</span></span>

* <span data-ttu-id="d3357-224">Desligamento de instâncias de VM.</span><span class="sxs-lookup"><span data-stu-id="d3357-224">Shut down VM instances.</span></span>
* <span data-ttu-id="d3357-225">Recursos de pressão, como CPU e memória.</span><span class="sxs-lookup"><span data-stu-id="d3357-225">Pressure resources such as CPU and memory.</span></span>
* <span data-ttu-id="d3357-226">Desconectar/atraso de rede.</span><span class="sxs-lookup"><span data-stu-id="d3357-226">Disconnect/delay network.</span></span>
* <span data-ttu-id="d3357-227">Falha de processos.</span><span class="sxs-lookup"><span data-stu-id="d3357-227">Crash processes.</span></span>
* <span data-ttu-id="d3357-228">Expiração de certificados.</span><span class="sxs-lookup"><span data-stu-id="d3357-228">Expire certificates.</span></span>
* <span data-ttu-id="d3357-229">Simular falhas de hardware.</span><span class="sxs-lookup"><span data-stu-id="d3357-229">Simulate hardware faults.</span></span>
* <span data-ttu-id="d3357-230">Desligamento do serviço DNS nos controladores de domínio.</span><span class="sxs-lookup"><span data-stu-id="d3357-230">Shut down the DNS service on the domain controllers.</span></span>

<span data-ttu-id="d3357-231">Meça o tempo de recuperação e verifique se ele cumpre seus requisitos de negócios.</span><span class="sxs-lookup"><span data-stu-id="d3357-231">Measure the recovery times and verify they meet your business requirements.</span></span> <span data-ttu-id="d3357-232">Teste também combinações dos modos de falha.</span><span class="sxs-lookup"><span data-stu-id="d3357-232">Test combinations of failure modes, as well.</span></span>


<!-- Links -->
[hybrid-vpn]: ../hybrid-networking/vpn.md
[azure-dns]: /azure/dns/dns-overview
[cassandra-in-azure]: https://academy.datastax.com/resources/deployment-guide-azure
[cassandra-consistency]: http://docs.datastax.com/en/cassandra/2.0/cassandra/dml/dml_config_consistency_c.html
[cassandra-replication]: http://www.planetcassandra.org/data-replication-in-nosql-databases-explained/
[cassandra-consistency-usage]: https://medium.com/@foundev/cassandra-how-many-nodes-are-talked-to-with-quorum-also-should-i-use-it-98074e75d7d5#.b4pb4alb2
[cassandra-ports]: https://docs.datastax.com/en/datastax_enterprise/5.0/datastax_enterprise/sec/configFirewallPorts.html
[datastax]: https://www.datastax.com/products/datastax-enterprise
[health-endpoint-monitoring-pattern]: https://msdn.microsoft.com/library/dn589789.aspx
[install-azure-cli]: /azure/xplat-cli-install
[regional-pairs]: /azure/best-practices-availability-paired-regions
[resource groups]: /azure/azure-resource-manager/resource-group-overview
[resource-group-links]: /azure/resource-group-link-resources
[services-by-region]: https://azure.microsoft.com/regions/#services
[ssl-client-node]: http://docs.datastax.com/en/cassandra/2.0/cassandra/security/secureSSLClientToNode_t.html
[ssl-node-node]: http://docs.datastax.com/en/cassandra/2.0/cassandra/security/secureSSLNodeToNode_t.html
[tablediff]: https://msdn.microsoft.com/library/ms162843.aspx
[tm-configure-failover]: /azure/traffic-manager/traffic-manager-configure-failover-routing-method
[tm-monitoring]: /azure/traffic-manager/traffic-manager-monitoring
[tm-routing]: /azure/traffic-manager/traffic-manager-routing-methods
[tm-sla]: https://azure.microsoft.com/support/legal/sla/traffic-manager/v1_0/
[traffic-manager]: https://azure.microsoft.com/services/traffic-manager/
[visio-download]: https://archcenter.azureedge.net/cdn/vm-reference-architectures.vsdx
[wsfc]: https://msdn.microsoft.com/library/hh270278.aspx
[0]: ./images/multi-region-application-diagram.png "Arquitetura de rede altamente disponível para aplicativos de N camadas do Azure"
