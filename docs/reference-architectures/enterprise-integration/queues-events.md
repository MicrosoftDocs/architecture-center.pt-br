---
title: Integração empresarial usando filas de mensagens e eventos
titleSuffix: Azure Reference Architectures
description: Arquitetura de referência para implementação de um padrão de integração empresarial com o Aplicativos Lógicos do Azure, o Gerenciamento de API do Azure, o Barramento de Serviço do Azure e a Grade de Eventos do Azure.
author: mattfarm
ms.reviewer: jonfan, estfan, LADocs
ms.topic: reference-architecture
ms.date: 12/03/2018
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: integration-services
ms.openlocfilehash: 4c9d2e201bcfc077990d746a1decd55ede2f220a
ms.sourcegitcommit: c053e6edb429299a0ad9b327888d596c48859d4a
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/20/2019
ms.locfileid: "58245507"
---
# <a name="enterprise-integration-on-azure-using-message-queues-and-events"></a><span data-ttu-id="5b0b9-103">Integração empresarial no Azure usando filas de mensagens e eventos</span><span class="sxs-lookup"><span data-stu-id="5b0b9-103">Enterprise integration on Azure using message queues and events</span></span>

<span data-ttu-id="5b0b9-104">Essa arquitetura de referência integra sistemas de back-end corporativos usando filas de mensagens e eventos para separar os serviços e fornecer mais escalabilidade e confiabilidade.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-104">This reference architecture integrates enterprise backend systems, using message queues and events to decouple services for greater scalability and reliability.</span></span> <span data-ttu-id="5b0b9-105">Os sistemas de back-end podem incluir sistemas SaaS (software como serviço), serviços do Azure e serviços da Web existentes em sua empresa.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-105">The backend systems may include software as a service (SaaS) systems, Azure services, and existing web services in your enterprise.</span></span>

![Arquitetura de referência para integração empresarial com filas e eventos](./_images/enterprise-integration-queues-events.png)

## <a name="architecture"></a><span data-ttu-id="5b0b9-107">Arquitetura</span><span class="sxs-lookup"><span data-stu-id="5b0b9-107">Architecture</span></span>

<span data-ttu-id="5b0b9-108">A arquitetura mostrada aqui se baseia em uma arquitetura mais simples, mostrada em [Integração empresarial básica][basic-enterprise-integration].</span><span class="sxs-lookup"><span data-stu-id="5b0b9-108">The architecture shown here builds on a simpler architecture that is shown in [Basic enterprise integration][basic-enterprise-integration].</span></span> <span data-ttu-id="5b0b9-109">Essa arquitetura usa os [Aplicativos Lógicos][logic-apps] para orquestrar fluxos de trabalho, e [Gerenciamento de API][apim] para criar catálogos de APIs.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-109">That architecture uses [Logic Apps][logic-apps] to orchestrate workflows and [API Management][apim] to create catalogs of APIs.</span></span>

<span data-ttu-id="5b0b9-110">Esta versão da arquitetura adiciona dois componentes que ajudam a tornar o sistema mais confiável e escalonável:</span><span class="sxs-lookup"><span data-stu-id="5b0b9-110">This version of the architecture adds two components that help make the system more reliable and scalable:</span></span>

- <span data-ttu-id="5b0b9-111">**[Barramento de Serviço do Azure][service-bus]**.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-111">**[Azure Service Bus][service-bus]**.</span></span> <span data-ttu-id="5b0b9-112">O Barramento de Serviço é um agente de mensagens seguro e confiável.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-112">Service Bus is a secure, reliable message broker.</span></span>

- <span data-ttu-id="5b0b9-113">**[Grade de Eventos do Azure][event-grid]**.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-113">**[Azure Event Grid][event-grid]**.</span></span> <span data-ttu-id="5b0b9-114">A Grade de Eventos é um serviço de roteamento de eventos.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-114">Event Grid is an event routing service.</span></span> <span data-ttu-id="5b0b9-115">Ele usa um modelo de eventos de [publicação/assinatura](../../patterns/publisher-subscriber.md) (pub/sub).</span><span class="sxs-lookup"><span data-stu-id="5b0b9-115">It uses a [publish/subscribe](../../patterns/publisher-subscriber.md) (pub/sub) eventing model.</span></span>

<span data-ttu-id="5b0b9-116">A comunicação assíncrona usando um agente de mensagens oferece inúmeras vantagens em relação às chamadas síncronas, diretas aos serviços de back-end:</span><span class="sxs-lookup"><span data-stu-id="5b0b9-116">Asynchronous communication using a message broker provides a number of advantages over making direct, synchronous calls to backend services:</span></span>

- <span data-ttu-id="5b0b9-117">Ela fornece o nivelamento de carga para lidar com intermitências nas cargas de trabalho, usando o [padrão de nivelamento de carga baseado em fila](../../patterns/queue-based-load-leveling.md).</span><span class="sxs-lookup"><span data-stu-id="5b0b9-117">Provides load-leveling to handle bursts in workloads, using the [Queue-Based Load Leveling pattern](../../patterns/queue-based-load-leveling.md).</span></span>
- <span data-ttu-id="5b0b9-118">Acompanhe de forma confiável o progresso de fluxos de trabalho de longa execução que envolvem vários aplicativos ou várias etapas.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-118">Reliably tracks the progress of long-running workflows that involve multiple steps or multiple applications.</span></span>
- <span data-ttu-id="5b0b9-119">Ajuda a separar os aplicativos.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-119">Helps to decouple applications.</span></span>
- <span data-ttu-id="5b0b9-120">Integra-se com sistemas existentes baseados em mensagens.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-120">Integrates with existing message-based systems.</span></span>
- <span data-ttu-id="5b0b9-121">Permite o enfileiramento do trabalho quando um sistema de back-end não estiver disponível.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-121">Allows work to be queued when a backend system is not available.</span></span>

<span data-ttu-id="5b0b9-122">A Grade de Eventos permite que os vários componentes no sistema reaja a eventos conforme eles acontecem, em vez de depender de tarefas agendadas ou de sondagem.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-122">Event Grid enables the various components in the system to react to events as they happen, rather than relying on polling or scheduled tasks.</span></span> <span data-ttu-id="5b0b9-123">Assim como acontece com uma fila de mensagens, ela ajuda a separar aplicativos e serviços.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-123">As with a message queue, it helps decouple applications and services.</span></span> <span data-ttu-id="5b0b9-124">Um aplicativo ou serviço pode publicar eventos, e os assinantes interessados receberão uma notificação.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-124">An application or service can publish events, and any interested subscribers will be notified.</span></span> <span data-ttu-id="5b0b9-125">É possível adicionar novos assinantes sem atualizar o remetente.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-125">New subscribers can be added without updating the sender.</span></span>

<span data-ttu-id="5b0b9-126">Muitos serviços do Azure dão suporte ao envio de eventos à Grade de Eventos.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-126">Many Azure services support sending events to Event Grid.</span></span> <span data-ttu-id="5b0b9-127">Por exemplo, um aplicativo lógico pode escutar um evento quando novos arquivos são adicionados a um armazenamento de blobs.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-127">For example, a logic app can listen for an event when new files are added to a blob store.</span></span> <span data-ttu-id="5b0b9-128">Esse padrão permite fluxos de trabalho reativos, nos quais o carregamento de um arquivo ou posicionamento de uma mensagem em uma fila dá início a uma série de processos.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-128">This pattern enables reactive workflows, where uploading a file or putting a message on a queue kicks off a series of processes.</span></span> <span data-ttu-id="5b0b9-129">Os processos podem ser executados em paralelo ou em uma sequência específica.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-129">The processes might be executed in parallel or in a specific sequence.</span></span>

## <a name="recommendations"></a><span data-ttu-id="5b0b9-130">Recomendações</span><span class="sxs-lookup"><span data-stu-id="5b0b9-130">Recommendations</span></span>

<span data-ttu-id="5b0b9-131">As recomendações descritas em [Integração corporativa básica][basic-enterprise-integration] se aplicam a essa arquitetura.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-131">The recommendations described in [Basic enterprise integration][basic-enterprise-integration] apply to this architecture.</span></span> <span data-ttu-id="5b0b9-132">As seguintes recomendações também se aplicam ao:</span><span class="sxs-lookup"><span data-stu-id="5b0b9-132">The following recommendations also apply:</span></span>

### <a name="service-bus"></a><span data-ttu-id="5b0b9-133">Barramento de Serviço</span><span class="sxs-lookup"><span data-stu-id="5b0b9-133">Service Bus</span></span>

<span data-ttu-id="5b0b9-134">O Barramento de Serviço tem dois modos de entrega, *pull* ou *push*.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-134">Service Bus has two delivery modes, *pull* or *push*.</span></span> <span data-ttu-id="5b0b9-135">No modelo de pull, o receptor faz uma sondagem contínua em busca de novas mensagens.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-135">In the pull model, the receiver continuously polls for new messages.</span></span> <span data-ttu-id="5b0b9-136">A sondagem pode ser ineficiente, especialmente se você tiver várias filas, com cada uma recebendo algumas mensagens, ou se houver muito tempo entre as mensagens.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-136">Polling can be inefficient, especially if you have many queues that each receive a few messages, or if there a lot of time between messages.</span></span> <span data-ttu-id="5b0b9-137">No modelo de push, o Barramento de Serviço envia um evento por meio da Grade de Eventos quando há novas mensagens.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-137">In the push model, Service Bus sends an event through Event Grid when there are new messages.</span></span> <span data-ttu-id="5b0b9-138">O receptor assina o evento.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-138">The receiver subscribes to the event.</span></span> <span data-ttu-id="5b0b9-139">Quando o evento é disparado, o receptor efetua o pull do próximo lote de mensagens do Barramento de Serviço.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-139">When the event is triggered, the receiver pulls the next batch of messages from Service Bus.</span></span>

<span data-ttu-id="5b0b9-140">Quando você cria um aplicativo lógico para consumir mensagens do Barramento de Serviço, recomendamos o uso do modelo de push com a integração da Grade de Eventos.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-140">When you create a logic app to consume Service Bus messages, we recommend using the push model with Event Grid integration.</span></span> <span data-ttu-id="5b0b9-141">Geralmente, isso é mais econômico, porque o aplicativo lógico não precisa sondar o Barramento de Serviço.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-141">It's often more cost efficient, because the logic app doesn't need to poll Service Bus.</span></span> <span data-ttu-id="5b0b9-142">Para saber mais, confira [Visão geral da integração do Barramento de Serviço do Azure com a Grade de Eventos](/azure/service-bus-messaging/service-bus-to-event-grid-integration-concept).</span><span class="sxs-lookup"><span data-stu-id="5b0b9-142">For more information, see [Azure Service Bus to Event Grid integration overview](/azure/service-bus-messaging/service-bus-to-event-grid-integration-concept).</span></span> <span data-ttu-id="5b0b9-143">Atualmente, a [camada Premium](https://azure.microsoft.com/pricing/details/service-bus/) do Barramento de Serviço é exigida para notificações da Grade de Eventos.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-143">Currently, Service Bus [Premium tier](https://azure.microsoft.com/pricing/details/service-bus/) is required for Event Grid notifications.</span></span>

<span data-ttu-id="5b0b9-144">Use [PeekLock](/azure/service-bus-messaging/service-bus-messaging-overview#queues) para acessar um grupo de mensagens.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-144">Use [PeekLock](/azure/service-bus-messaging/service-bus-messaging-overview#queues) for accessing a group of messages.</span></span> <span data-ttu-id="5b0b9-145">Ao usar o PeekLock pode executar etapas para validar cada mensagem antes de concluir ou abandonar a mensagem.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-145">When you use PeekLock, the logic app can perform steps to validate each message before completing or abandoning the message.</span></span> <span data-ttu-id="5b0b9-146">Essa abordagem protege contra a perda acidental de mensagens.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-146">This approach protects against accidental message loss.</span></span>

### <a name="event-grid"></a><span data-ttu-id="5b0b9-147">Grade de Eventos</span><span class="sxs-lookup"><span data-stu-id="5b0b9-147">Event Grid</span></span>

<span data-ttu-id="5b0b9-148">Quando um gatilho da Grade de Eventos é acionado, significa que *pelo menos* um evento aconteceu.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-148">When an Event Grid trigger fires, it means *at least one* event happened.</span></span> <span data-ttu-id="5b0b9-149">Por exemplo, quando um aplicativo lógico recebe um gatilho da Grade de Eventos para uma mensagem do Barramento de Serviço, ele deve supor que há várias mensagens disponíveis para processar.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-149">For example, when a logic app gets an Event Grid triggers for a Service Bus message, it should assume that several messages might be available to process.</span></span>

<span data-ttu-id="5b0b9-150">A Grade de Eventos usam um modelo sem servidor.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-150">Event Grid uses a serverless model.</span></span> <span data-ttu-id="5b0b9-151">A cobrança é calculada com base no número de operações (execuções do evento).</span><span class="sxs-lookup"><span data-stu-id="5b0b9-151">Billing is calculated based on the number of operations (event executions).</span></span> <span data-ttu-id="5b0b9-152">Consulte mais informações, consulte [Preço da Grade de Eventos](https://azure.microsoft.com/pricing/details/event-grid/).</span><span class="sxs-lookup"><span data-stu-id="5b0b9-152">For more information, see [Event Grid pricing](https://azure.microsoft.com/pricing/details/event-grid/).</span></span> <span data-ttu-id="5b0b9-153">Atualmente, não há considerações de camada para a Grade de Eventos.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-153">Currently, there are no tier considerations for Event Grid.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="5b0b9-154">Considerações sobre escalabilidade</span><span class="sxs-lookup"><span data-stu-id="5b0b9-154">Scalability considerations</span></span>

<span data-ttu-id="5b0b9-155">Para obter maior escalabilidade, a camada Premium do Barramento de Serviço pode aumentar o número de unidades do sistema de mensagens.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-155">To achieve higher scalability, the Service Bus Premium tier can scale out the number of messaging units.</span></span> <span data-ttu-id="5b0b9-156">Configurações de camada Premium podem ter um, dois ou quatro unidades de mensagens.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-156">Premium tier configurations can have one, two, or four messaging units.</span></span> <span data-ttu-id="5b0b9-157">Para saber mais informações sobre escalonar Barramento de Serviço, consulte [Práticas recomendadas para melhorias de desempenho usando o Sistema de Mensagens do Barramento de Serviço](/azure/service-bus-messaging/service-bus-performance-improvements).</span><span class="sxs-lookup"><span data-stu-id="5b0b9-157">For more information about scaling Service Bus, see [Best practices for performance improvements by using Service Bus Messaging](/azure/service-bus-messaging/service-bus-performance-improvements).</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="5b0b9-158">Considerações sobre disponibilidade</span><span class="sxs-lookup"><span data-stu-id="5b0b9-158">Availability considerations</span></span>

<span data-ttu-id="5b0b9-159">Examine o SLA para cada serviço:</span><span class="sxs-lookup"><span data-stu-id="5b0b9-159">Review the SLA for each service:</span></span>

- <span data-ttu-id="5b0b9-160">[SLA de Gerenciamento de API][apim-sla]</span><span class="sxs-lookup"><span data-stu-id="5b0b9-160">[API Management SLA][apim-sla]</span></span>
- <span data-ttu-id="5b0b9-161">[SLA da Grade de Eventos][event-grid-sla]</span><span class="sxs-lookup"><span data-stu-id="5b0b9-161">[Event Grid SLA][event-grid-sla]</span></span>
- <span data-ttu-id="5b0b9-162">[SLA de Aplicativos Lógicos][logic-apps-sla]</span><span class="sxs-lookup"><span data-stu-id="5b0b9-162">[Logic Apps SLA][logic-apps-sla]</span></span>
- <span data-ttu-id="5b0b9-163">[SLA do Barramento de Serviço][sb-sla]</span><span class="sxs-lookup"><span data-stu-id="5b0b9-163">[Service Bus SLA][sb-sla]</span></span>

<span data-ttu-id="5b0b9-164">Para habilitar o failover em caso de uma interrupção grave, considere implementar a recuperação de desastre geográfico no Barramento de Serviço Premium.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-164">To enable failover if a serious outage occurs, consider implementing geo-disaster recovery in Service Bus Premium.</span></span> <span data-ttu-id="5b0b9-165">Para mais informações consulte [Recuperação de desastre em área geográfica do Barramento de Serviço do Azure](/azure/service-bus-messaging/service-bus-geo-dr).</span><span class="sxs-lookup"><span data-stu-id="5b0b9-165">For more information, see [Azure Service Bus geo-disaster recovery](/azure/service-bus-messaging/service-bus-geo-dr).</span></span>

## <a name="security-considerations"></a><span data-ttu-id="5b0b9-166">Considerações de segurança</span><span class="sxs-lookup"><span data-stu-id="5b0b9-166">Security considerations</span></span>

<span data-ttu-id="5b0b9-167">Para proteger o Barramento de Serviço, use a SAS (Assinatura de Acesso Compartilhado).</span><span class="sxs-lookup"><span data-stu-id="5b0b9-167">To secure Service Bus, use shared access signature (SAS).</span></span> <span data-ttu-id="5b0b9-168">É possível conceder a um usuário acesso aos recursos do Barramento de Serviço com direitos específicos usando a [autenticação SAS](/azure/service-bus-messaging/service-bus-sas).</span><span class="sxs-lookup"><span data-stu-id="5b0b9-168">You can grant a user access to Service Bus resources with specific rights by using [SAS authentication](/azure/service-bus-messaging/service-bus-sas).</span></span> <span data-ttu-id="5b0b9-169">Para saber mais, confira [Autenticação e autorização do barramento de Serviço](/azure/service-bus-messaging/service-bus-authentication-and-authorization).</span><span class="sxs-lookup"><span data-stu-id="5b0b9-169">For more information, see [Service Bus authentication and authorization](/azure/service-bus-messaging/service-bus-authentication-and-authorization).</span></span>

<span data-ttu-id="5b0b9-170">Se for necessário expor uma fila do Barramento de Serviço como um ponto de extremidade HTTP, por exemplo, para postar novas mensagens, use o Gerenciamento de API para proteger a fila administrando o ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-170">If you need to expose a Service Bus queue as an HTTP endpoint, for example, to post new messages, use API Management to secure the queue by fronting the endpoint.</span></span> <span data-ttu-id="5b0b9-171">Em seguida, proteja o ponto de extremidade com certificados ou autenticação OAuth, conforme apropriado.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-171">You can then secure the endpoint with certificates or OAuth authentication as appropriate.</span></span> <span data-ttu-id="5b0b9-172">A maneira mais fácil de proteger um ponto de extremidade é usando um aplicativo lógico com um gatilho de solicitação/resposta HTTP como intermediário.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-172">The easiest way to secure an endpoint is using a logic app with an HTTP request/response trigger as an intermediary.</span></span>

<span data-ttu-id="5b0b9-173">O serviço da Grade de Eventos protege a entrega de eventos por meio de um código de validação.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-173">The Event Grid service secures event delivery through a validation code.</span></span> <span data-ttu-id="5b0b9-174">Se você usar os Aplicativos Lógicos para consumir o evento, a validação será realizada automaticamente.</span><span class="sxs-lookup"><span data-stu-id="5b0b9-174">If you use Logic Apps to consume the event, validation is automatically performed.</span></span> <span data-ttu-id="5b0b9-175">Para saber mais, confira [Event Grid security and authentication](/azure/event-grid/security-authentication) (Segurança e autenticação da Grade de Eventos).</span><span class="sxs-lookup"><span data-stu-id="5b0b9-175">For more information, see [Event Grid security and authentication](/azure/event-grid/security-authentication).</span></span>

[apim]: /azure/api-management
[apim-sla]: https://azure.microsoft.com/support/legal/sla/api-management/
[event-grid]: /azure/event-grid/
[event-grid-sla]: https://azure.microsoft.com/support/legal/sla/event-grid
[logic-apps]: /azure/logic-apps/logic-apps-overview
[logic-apps-sla]: https://azure.microsoft.com/support/legal/sla/logic-apps
[sb-sla]: https://azure.microsoft.com/support/legal/sla/service-bus/
[service-bus]: /azure/service-bus-messaging/
[basic-enterprise-integration]: ./basic-enterprise-integration.md
