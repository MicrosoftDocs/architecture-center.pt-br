---
title: Executar um farm do SharePoint Server 2016 de alta disponibilidade no Azure
titleSuffix: Azure Reference Architectures
description: Arquitetura recomendada para implantar um farm do SharePoint Server 2016 de alta disponibilidade no Azure.
author: njray
ms.date: 07/26/2018
ms.topic: reference-architecture
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: seodec18
---

# <a name="run-a-highly-available-sharepoint-server-2016-farm-in-azure"></a><span data-ttu-id="54fb7-103">Executar um farm do SharePoint Server 2016 de alta disponibilidade no Azure</span><span class="sxs-lookup"><span data-stu-id="54fb7-103">Run a highly available SharePoint Server 2016 farm in Azure</span></span>

<span data-ttu-id="54fb7-104">Essa arquitetura de referência mostra práticas comprovadas para implantar um farm do SharePoint Server 2016 de alta disponibilidade no Azure, usando a topologia de MinRole e grupos de disponibilidade Always On do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="54fb7-104">This reference architecture shows proven practices for deploying a highly available SharePoint Server 2016 farm on Azure, using MinRole topology and SQL Server Always On availability groups.</span></span> <span data-ttu-id="54fb7-105">O farm do SharePoint é implantado em uma rede virtual protegida sem nenhuma presença ou ponto de extremidade para a Internet.</span><span class="sxs-lookup"><span data-stu-id="54fb7-105">The SharePoint farm is deployed in a secured virtual network with no Internet-facing endpoint or presence.</span></span> <span data-ttu-id="54fb7-106">[**Implantar esta solução**](#deploy-the-solution).</span><span class="sxs-lookup"><span data-stu-id="54fb7-106">[**Deploy this solution**](#deploy-the-solution).</span></span>

![Arquitetura de referência para um farm do SharePoint Server 2016 de alta disponibilidade no Azure](./images/sharepoint-ha.png)

<span data-ttu-id="54fb7-108">*Baixe um [Arquivo Visio][visio-download] dessa arquitetura.*</span><span class="sxs-lookup"><span data-stu-id="54fb7-108">*Download a [Visio file][visio-download] of this architecture.*</span></span>

## <a name="architecture"></a><span data-ttu-id="54fb7-109">Arquitetura</span><span class="sxs-lookup"><span data-stu-id="54fb7-109">Architecture</span></span>

<span data-ttu-id="54fb7-110">Essa arquitetura baseia-se naquela mostrada em [Executar máquinas virtuais do Windows para um aplicativo de N camadas][windows-n-tier].</span><span class="sxs-lookup"><span data-stu-id="54fb7-110">This architecture builds on the one shown in [Run Windows VMs for an N-tier application][windows-n-tier].</span></span> <span data-ttu-id="54fb7-111">Ela implanta um farm do SharePoint Server 2016 com alta disponibilidade dentro de uma rede virtual do Azure (VNet).</span><span class="sxs-lookup"><span data-stu-id="54fb7-111">It deploys a SharePoint Server 2016 farm with high availability inside an Azure virtual network (VNet).</span></span> <span data-ttu-id="54fb7-112">Essa arquitetura é adequada para um ambiente de teste ou de produção, uma infraestrutura híbrida do SharePoint com o Office 365 ou como base para um cenário de recuperação de desastres.</span><span class="sxs-lookup"><span data-stu-id="54fb7-112">This architecture is suitable for a test or production environment, a SharePoint hybrid infrastructure with Office 365, or as the basis for a disaster recovery scenario.</span></span>

<span data-ttu-id="54fb7-113">Essa arquitetura consiste nos seguintes componentes:</span><span class="sxs-lookup"><span data-stu-id="54fb7-113">The architecture consists of the following components:</span></span>

- <span data-ttu-id="54fb7-114">**Grupos de recursos**.</span><span class="sxs-lookup"><span data-stu-id="54fb7-114">**Resource groups**.</span></span> <span data-ttu-id="54fb7-115">Um [grupo de recursos][resource-group] é um contêiner que armazena os recursos relacionados ao Azure.</span><span class="sxs-lookup"><span data-stu-id="54fb7-115">A [resource group][resource-group] is a container that holds related Azure resources.</span></span> <span data-ttu-id="54fb7-116">Um grupo de recursos é usado para os servidores do SharePoint e outro grupo de recursos é usado para os componentes de infraestrutura que são independentes das VMs, como a rede virtual e os balanceadores de carga.</span><span class="sxs-lookup"><span data-stu-id="54fb7-116">One resource group is used for the SharePoint servers, and another resource group is used for infrastructure components that are independent of VMs, such as the virtual network and load balancers.</span></span>

- <span data-ttu-id="54fb7-117">**Rede virtual (VNet)**.</span><span class="sxs-lookup"><span data-stu-id="54fb7-117">**Virtual network (VNet)**.</span></span> <span data-ttu-id="54fb7-118">As VMs são implantadas em uma rede virtual com um espaço de endereço da intranet exclusivo.</span><span class="sxs-lookup"><span data-stu-id="54fb7-118">The VMs are deployed in a VNet with a unique intranet address space.</span></span> <span data-ttu-id="54fb7-119">A rede virtual é, posteriormente, subdividida em sub-redes.</span><span class="sxs-lookup"><span data-stu-id="54fb7-119">The VNet is further subdivided into subnets.</span></span>

- <span data-ttu-id="54fb7-120">**Máquinas Virtuais (VMs)**.</span><span class="sxs-lookup"><span data-stu-id="54fb7-120">**Virtual machines (VMs)**.</span></span> <span data-ttu-id="54fb7-121">As VMs são implantadas na rede virtual e os endereços IP estáticos são atribuídos a todas as VMs.</span><span class="sxs-lookup"><span data-stu-id="54fb7-121">The VMs are deployed into the VNet, and private static IP addresses are assigned to all of the VMs.</span></span> <span data-ttu-id="54fb7-122">Os endereços IP estáticos são recomendados para as máquinas virtuais que executam o SQL Server e o SharePoint Server 2016, para evitar problemas com armazenamento em cache de endereço IP e alterações de endereços após uma reinicialização.</span><span class="sxs-lookup"><span data-stu-id="54fb7-122">Static IP addresses are recommended for the VMs running SQL Server and SharePoint Server 2016, to avoid issues with IP address caching and changes of addresses after a restart.</span></span>

- <span data-ttu-id="54fb7-123">**Conjuntos de disponibilidade**.</span><span class="sxs-lookup"><span data-stu-id="54fb7-123">**Availability sets**.</span></span> <span data-ttu-id="54fb7-124">Coloque as VMs para cada função do SharePoint em [conjuntos de disponibilidade][availability-set] separados e forneça pelo menos duas máquinas virtuais (VMs) para cada função.</span><span class="sxs-lookup"><span data-stu-id="54fb7-124">Place the VMs for each SharePoint role into separate [availability sets][availability-set], and provision at least two virtual machines (VMs) for each role.</span></span> <span data-ttu-id="54fb7-125">Isso torna as VMs qualificadas para um contrato de nível de serviço (SLA) mais alto.</span><span class="sxs-lookup"><span data-stu-id="54fb7-125">This makes the VMs eligible for a higher service level agreement (SLA).</span></span>

- <span data-ttu-id="54fb7-126">**Balanceador Interno de carga**.</span><span class="sxs-lookup"><span data-stu-id="54fb7-126">**Internal load balancer**.</span></span> <span data-ttu-id="54fb7-127">O [balanceador de carga][load-balancer] distribui o tráfego de solicitação do SharePoint da rede local para os servidores Web de front-end do farm do SharePoint.</span><span class="sxs-lookup"><span data-stu-id="54fb7-127">The [load balancer][load-balancer] distributes SharePoint request traffic from the on-premises network to the front-end web servers of the SharePoint farm.</span></span>

- <span data-ttu-id="54fb7-128">**Grupos de segurança de rede (NSG)**.</span><span class="sxs-lookup"><span data-stu-id="54fb7-128">**Network security groups (NSGs)**.</span></span> <span data-ttu-id="54fb7-129">Para cada sub-rede que contém máquinas virtuais, um [grupo de segurança de rede][nsg] é criado.</span><span class="sxs-lookup"><span data-stu-id="54fb7-129">For each subnet that contains virtual machines, a [network security group][nsg] is created.</span></span> <span data-ttu-id="54fb7-130">Use os NSGs para restringir o tráfego de rede na VNet, para isolar as sub-redes.</span><span class="sxs-lookup"><span data-stu-id="54fb7-130">Use NSGs to restrict network traffic within the VNet, in order to isolate subnets.</span></span>

- <span data-ttu-id="54fb7-131">**Gateway**.</span><span class="sxs-lookup"><span data-stu-id="54fb7-131">**Gateway**.</span></span> <span data-ttu-id="54fb7-132">O gateway fornece uma conexão entre a sua rede local e a rede virtual do Azure.</span><span class="sxs-lookup"><span data-stu-id="54fb7-132">The gateway provides a connection between your on-premises network and the Azure virtual network.</span></span> <span data-ttu-id="54fb7-133">A conexão pode usar ExpressRoute ou VPN site a site.</span><span class="sxs-lookup"><span data-stu-id="54fb7-133">Your connection can use ExpressRoute or site-to-site VPN.</span></span> <span data-ttu-id="54fb7-134">Para obter mais informações, consulte [Conectar uma rede local ao Azure][hybrid-ra].</span><span class="sxs-lookup"><span data-stu-id="54fb7-134">For more information, see [Connect an on-premises network to Azure][hybrid-ra].</span></span>

- <span data-ttu-id="54fb7-135">**Controladores de domínio do Active Directory (AD) do Windows Server**.</span><span class="sxs-lookup"><span data-stu-id="54fb7-135">**Windows Server Active Directory (AD) domain controllers**.</span></span> <span data-ttu-id="54fb7-136">Essa arquitetura de referência implanta os controladores de domínio do AD do Windows Server.</span><span class="sxs-lookup"><span data-stu-id="54fb7-136">This reference architecture deploys Windows Server AD domain controllers.</span></span> <span data-ttu-id="54fb7-137">Esses controladores de domínio são executados na rede virtual do Azure e possuem uma relação de confiança com a floresta do AD do Windows Server local.</span><span class="sxs-lookup"><span data-stu-id="54fb7-137">These domain controllers run in the Azure VNet and have a trust relationship with the on-premises Windows Server AD forest.</span></span> <span data-ttu-id="54fb7-138">As solicitações da Web do cliente por recursos de farm do SharePoint podem ser autenticadas na rede virtual, em vez de enviar esse tráfego de autenticação pela conexão do gateway para a rede local.</span><span class="sxs-lookup"><span data-stu-id="54fb7-138">Client web requests for SharePoint farm resources are authenticated in the VNet rather than sending that authentication traffic across the gateway connection to the on-premises network.</span></span> <span data-ttu-id="54fb7-139">No DNS, os registros CNAME ou intranet um são criados para que os usuários da intranet possam resolver o nome do farm do SharePoint para o endereço IP privado do balanceador de carga interno.</span><span class="sxs-lookup"><span data-stu-id="54fb7-139">In DNS, intranet A or CNAME records are created so that intranet users can resolve the name of the SharePoint farm to the private IP address of the internal load balancer.</span></span>

  <span data-ttu-id="54fb7-140">O SharePoint Server 2016 também suporta o uso do [Azure Active Directory Domain Services](/azure/active-directory-domain-services/).</span><span class="sxs-lookup"><span data-stu-id="54fb7-140">SharePoint Server 2016 also supports using [Azure Active Directory Domain Services](/azure/active-directory-domain-services/).</span></span> <span data-ttu-id="54fb7-141">O Azure Active Directory Domain Services fornece serviços de domínio gerenciado para que você não precise implantar e gerenciar controladores de domínio no Azure.</span><span class="sxs-lookup"><span data-stu-id="54fb7-141">Azure AD Domain Services provides managed domain services, so that you don't need to deploy and manage domain controllers in Azure.</span></span>

- <span data-ttu-id="54fb7-142">**Grupo de Disponibilidade Always On do SQL Server**.</span><span class="sxs-lookup"><span data-stu-id="54fb7-142">**SQL Server Always On Availability Group**.</span></span> <span data-ttu-id="54fb7-143">Para obter alta disponibilidade do banco de dados do SQL Server, recomendamos os [Grupos de Disponibilidade AlwaysOn do SQL Server][sql-always-on].</span><span class="sxs-lookup"><span data-stu-id="54fb7-143">For high availability of the SQL Server database, we recommend [SQL Server Always On Availability Groups][sql-always-on].</span></span> <span data-ttu-id="54fb7-144">Duas máquinas virtuais são usadas para o SQL Server.</span><span class="sxs-lookup"><span data-stu-id="54fb7-144">Two virtual machines are used for SQL Server.</span></span> <span data-ttu-id="54fb7-145">Uma contém a réplica do banco de dados primário e a outra contém a réplica secundária.</span><span class="sxs-lookup"><span data-stu-id="54fb7-145">One contains the primary database replica and the other contains the secondary replica.</span></span>

- <span data-ttu-id="54fb7-146">**Nó principal da VM**.</span><span class="sxs-lookup"><span data-stu-id="54fb7-146">**Majority node VM**.</span></span> <span data-ttu-id="54fb7-147">Essa VM permite que o cluster de failover estabeleça um quorum.</span><span class="sxs-lookup"><span data-stu-id="54fb7-147">This VM allows the failover cluster to establish quorum.</span></span> <span data-ttu-id="54fb7-148">Para saber mais, consulte [Noções básicas sobre configurações de quorum em um cluster de failover][sql-quorum].</span><span class="sxs-lookup"><span data-stu-id="54fb7-148">For more information, see [Understanding Quorum Configurations in a Failover Cluster][sql-quorum].</span></span>

- <span data-ttu-id="54fb7-149">**Servidores do SharePoint**.</span><span class="sxs-lookup"><span data-stu-id="54fb7-149">**SharePoint servers**.</span></span> <span data-ttu-id="54fb7-150">Os servidores do SharePoint executam funções de front-end da Web, armazenamento em cache, aplicativo e pesquisa.</span><span class="sxs-lookup"><span data-stu-id="54fb7-150">The SharePoint servers perform the web front-end, caching, application, and search roles.</span></span>

- <span data-ttu-id="54fb7-151">**Jumpbox**.</span><span class="sxs-lookup"><span data-stu-id="54fb7-151">**Jumpbox**.</span></span> <span data-ttu-id="54fb7-152">Também chamado de um [host bastião][bastion-host].</span><span class="sxs-lookup"><span data-stu-id="54fb7-152">Also called a [bastion host][bastion-host].</span></span> <span data-ttu-id="54fb7-153">Esta é uma VM segura na rede que os administradores usam para se conectar às outras VMs.</span><span class="sxs-lookup"><span data-stu-id="54fb7-153">This is a secure VM on the network that administrators use to connect to the other VMs.</span></span> <span data-ttu-id="54fb7-154">O jumpbox tem um NSG que permite o tráfego remoto apenas de endereços IP públicos em uma lista segura.</span><span class="sxs-lookup"><span data-stu-id="54fb7-154">The jumpbox has an NSG that allows remote traffic only from public IP addresses on a safe list.</span></span> <span data-ttu-id="54fb7-155">O NSG deve permitir o tráfego de RDP (área de trabalho remota).</span><span class="sxs-lookup"><span data-stu-id="54fb7-155">The NSG should permit remote desktop (RDP) traffic.</span></span>

## <a name="recommendations"></a><span data-ttu-id="54fb7-156">Recomendações</span><span class="sxs-lookup"><span data-stu-id="54fb7-156">Recommendations</span></span>

<span data-ttu-id="54fb7-157">Seus requisitos podem ser diferentes dos requisitos da arquitetura descrita aqui.</span><span class="sxs-lookup"><span data-stu-id="54fb7-157">Your requirements might differ from the architecture described here.</span></span> <span data-ttu-id="54fb7-158">Use essas recomendações como ponto de partida.</span><span class="sxs-lookup"><span data-stu-id="54fb7-158">Use these recommendations as a starting point.</span></span>

### <a name="resource-group-recommendations"></a><span data-ttu-id="54fb7-159">Recomendações do grupo de recursos</span><span class="sxs-lookup"><span data-stu-id="54fb7-159">Resource group recommendations</span></span>

<span data-ttu-id="54fb7-160">É recomendável separar grupos de recursos de acordo com a função de servidor e ter um grupo de recursos separado para os componentes de infraestrutura que são recursos globais.</span><span class="sxs-lookup"><span data-stu-id="54fb7-160">We recommend separating resource groups according to the server role, and having a separate resource group for infrastructure components that are global resources.</span></span> <span data-ttu-id="54fb7-161">Nessa arquitetura, os recursos do SharePoint formam um grupo, enquanto o SQL Server e outros ativos de utilitário formam o outro.</span><span class="sxs-lookup"><span data-stu-id="54fb7-161">In this architecture, the SharePoint resources form one group, while the SQL Server and other utility assets form another.</span></span>

### <a name="virtual-network-and-subnet-recommendations"></a><span data-ttu-id="54fb7-162">Recomendações para a rede virtual e a sub-rede</span><span class="sxs-lookup"><span data-stu-id="54fb7-162">Virtual network and subnet recommendations</span></span>

<span data-ttu-id="54fb7-163">Use uma sub-rede para cada função do SharePoint, além de uma sub-rede para o gateway e uma para o jumpbox.</span><span class="sxs-lookup"><span data-stu-id="54fb7-163">Use one subnet for each SharePoint role, plus a subnet for the gateway and one for the jumpbox.</span></span>

<span data-ttu-id="54fb7-164">A sub-rede de gateway deve ser nomeada *GatewaySubnet*.</span><span class="sxs-lookup"><span data-stu-id="54fb7-164">The gateway subnet must be named *GatewaySubnet*.</span></span> <span data-ttu-id="54fb7-165">Atribua o espaço de endereço de sub-rede de gateway da última parte do espaço de endereço de rede virtual.</span><span class="sxs-lookup"><span data-stu-id="54fb7-165">Assign the gateway subnet address space from the last part of the virtual network address space.</span></span> <span data-ttu-id="54fb7-166">Para obter mais informações, consulte [Conectar uma rede local ao Azure usando um gateway de VPN][hybrid-vpn-ra].</span><span class="sxs-lookup"><span data-stu-id="54fb7-166">For more information, see [Connect an on-premises network to Azure using a VPN gateway][hybrid-vpn-ra].</span></span>

### <a name="vm-recommendations"></a><span data-ttu-id="54fb7-167">Recomendações de VM</span><span class="sxs-lookup"><span data-stu-id="54fb7-167">VM recommendations</span></span>

<span data-ttu-id="54fb7-168">Essa arquitetura exige um mínimo de 44 núcleos:</span><span class="sxs-lookup"><span data-stu-id="54fb7-168">This architecture requires a minimum of 44 cores:</span></span>

- <span data-ttu-id="54fb7-169">8 servidores do SharePoint em Standard_DS3_v2 (4 núcleos cada) = 32 núcleos</span><span class="sxs-lookup"><span data-stu-id="54fb7-169">8 SharePoint servers on Standard_DS3_v2 (4 cores each) = 32 cores</span></span>
- <span data-ttu-id="54fb7-170">2 controladores de domínio do Active Directory em Standard_DS1_v2 (1 núcleo cada) = 2 núcleos</span><span class="sxs-lookup"><span data-stu-id="54fb7-170">2 Active Directory domain controllers on Standard_DS1_v2 (1 core each) = 2 cores</span></span>
- <span data-ttu-id="54fb7-171">2 VMs do SQL Server em Standard_DS3_v2 = 8 núcleos</span><span class="sxs-lookup"><span data-stu-id="54fb7-171">2 SQL Server VMs on Standard_DS3_v2 = 8 cores</span></span>
- <span data-ttu-id="54fb7-172">1 nó principal em Standard_DS1_v2 = 1 núcleo</span><span class="sxs-lookup"><span data-stu-id="54fb7-172">1 majority node on Standard_DS1_v2 = 1 core</span></span>
- <span data-ttu-id="54fb7-173">1 servidor de gerenciamento em Standard_DS1_v2 = 1 núcleo</span><span class="sxs-lookup"><span data-stu-id="54fb7-173">1 management server on Standard_DS1_v2 = 1 core</span></span>

<span data-ttu-id="54fb7-174">Certifique-se de que sua assinatura do Azure tem suficiente cota de núcleo da VM para a implantação ou a implantação falhará.</span><span class="sxs-lookup"><span data-stu-id="54fb7-174">Make sure your Azure subscription has enough VM core quota for the deployment, or the deployment will fail.</span></span> <span data-ttu-id="54fb7-175">Consulte [Assinatura do Azure e limites de serviço, cotas e restrições][quotas].</span><span class="sxs-lookup"><span data-stu-id="54fb7-175">See [Azure subscription and service limits, quotas, and constraints][quotas].</span></span>

<span data-ttu-id="54fb7-176">Para todas as funções do SharePoint, exceto o Indexador da Pesquisa, é recomendável usar o tamanho de VM [Standard_DS3_v2][vm-sizes-general].</span><span class="sxs-lookup"><span data-stu-id="54fb7-176">For all SharePoint roles except the Search Indexer, we recommended using the [Standard_DS3_v2][vm-sizes-general] VM size.</span></span> <span data-ttu-id="54fb7-177">O indexador da pesquisa deve ser pelo menos do tamanho [Standard_DS13_v2][vm-sizes-memory].</span><span class="sxs-lookup"><span data-stu-id="54fb7-177">The Search Indexer should be at least the [Standard_DS13_v2][vm-sizes-memory] size.</span></span> <span data-ttu-id="54fb7-178">Para teste, os arquivos de parâmetro para essa arquitetura de referência especificam o tamanho de DS3_v2 menor para a função do Indexador de Pesquisa.</span><span class="sxs-lookup"><span data-stu-id="54fb7-178">For testing, the parameter files for this reference architecture specify the smaller DS3_v2 size for the Search Indexer role.</span></span> <span data-ttu-id="54fb7-179">Para uma implantação de produção, atualize os arquivos de parâmetro para usar o tamanho DS13 ou maior.</span><span class="sxs-lookup"><span data-stu-id="54fb7-179">For a production deployment, update the parameter files to use the DS13 size or larger.</span></span> <span data-ttu-id="54fb7-180">Para obter mais informações, confira [Requisitos de hardware e software para o SharePoint Server 2016][sharepoint-reqs].</span><span class="sxs-lookup"><span data-stu-id="54fb7-180">For more information, see [Hardware and software requirements for SharePoint Server 2016][sharepoint-reqs].</span></span>

<span data-ttu-id="54fb7-181">Para VMs do SQL Server, é recomendável um mínimo de 4 núcleos e 8 GB de RAM.</span><span class="sxs-lookup"><span data-stu-id="54fb7-181">For the SQL Server VMs, we recommend a minimum of 4 cores and 8 GB RAM.</span></span> <span data-ttu-id="54fb7-182">Os arquivos de parâmetro para essa arquitetura de referência especificam o tamanho de DS3_v2.</span><span class="sxs-lookup"><span data-stu-id="54fb7-182">The parameter files for this reference architecture specify the DS3_v2 size.</span></span> <span data-ttu-id="54fb7-183">Para uma implantação de produção, talvez seja necessário especificar um tamanho maior de VM.</span><span class="sxs-lookup"><span data-stu-id="54fb7-183">For a production deployment, you might need to specify a larger VM size.</span></span> <span data-ttu-id="54fb7-184">Para obter mais informações, confira [Configuração e planejamento de capacidade de armazenamento e do SQL Server (SharePoint Server)](/sharepoint/administration/storage-and-sql-server-capacity-planning-and-configuration#estimate-memory-requirements).</span><span class="sxs-lookup"><span data-stu-id="54fb7-184">For more information, see [Storage and SQL Server capacity planning and configuration (SharePoint Server)](/sharepoint/administration/storage-and-sql-server-capacity-planning-and-configuration#estimate-memory-requirements).</span></span>

### <a name="nsg-recommendations"></a><span data-ttu-id="54fb7-185">Recomendações de NSG</span><span class="sxs-lookup"><span data-stu-id="54fb7-185">NSG recommendations</span></span>

<span data-ttu-id="54fb7-186">É recomendável ter um NSG para cada sub-rede que contém máquinas virtuais, para permitir o isolamento de sub-rede.</span><span class="sxs-lookup"><span data-stu-id="54fb7-186">We recommend having one NSG for each subnet that contains VMs, to enable subnet isolation.</span></span> <span data-ttu-id="54fb7-187">Se você quiser configurar o isolamento de sub-rede, adicione regras NSG que definem o tráfego de entrada ou saída permitido ou negado para cada sub-rede.</span><span class="sxs-lookup"><span data-stu-id="54fb7-187">If you want to configure subnet isolation, add NSG rules that define the allowed or denied inbound or outbound traffic for each subnet.</span></span> <span data-ttu-id="54fb7-188">Para obter mais informações, consulte [Filtrar o tráfego de rede com grupos de segurança de rede][virtual-networks-nsg].</span><span class="sxs-lookup"><span data-stu-id="54fb7-188">For more information, see [Filter network traffic with network security groups][virtual-networks-nsg].</span></span>

<span data-ttu-id="54fb7-189">Não atribua um NSG à sub-rede de gateway ou o gateway irá parar de funcionar.</span><span class="sxs-lookup"><span data-stu-id="54fb7-189">Do not assign an NSG to the gateway subnet, or the gateway will stop functioning.</span></span>

### <a name="storage-recommendations"></a><span data-ttu-id="54fb7-190">Recomendações de armazenamento</span><span class="sxs-lookup"><span data-stu-id="54fb7-190">Storage recommendations</span></span>

<span data-ttu-id="54fb7-191">A configuração de armazenamento das VMs no farm devem corresponder às melhores práticas apropriadas usadas para implantações locais.</span><span class="sxs-lookup"><span data-stu-id="54fb7-191">The storage configuration of the VMs in the farm should match the appropriate best practices used for on-premises deployments.</span></span> <span data-ttu-id="54fb7-192">Servidores do SharePoint devem ter um disco separado de logs.</span><span class="sxs-lookup"><span data-stu-id="54fb7-192">SharePoint servers should have a separate disk for logs.</span></span> <span data-ttu-id="54fb7-193">Os servidores do SharePoint que hospedam funções de índice de pesquisa requerem espaço em disco adicional para o índice de pesquisa a ser armazenado.</span><span class="sxs-lookup"><span data-stu-id="54fb7-193">SharePoint servers hosting search index roles require additional disk space for the search index to be stored.</span></span> <span data-ttu-id="54fb7-194">Para o SQL Server, a prática padrão é separar os dados dos logs.</span><span class="sxs-lookup"><span data-stu-id="54fb7-194">For SQL Server, the standard practice is to separate data and logs.</span></span> <span data-ttu-id="54fb7-195">Adicione mais discos para armazenamento de backup do banco de dados e use um disco separado para [tempdb][tempdb].</span><span class="sxs-lookup"><span data-stu-id="54fb7-195">Add more disks for database backup storage, and use a separate disk for [tempdb][tempdb].</span></span>

<span data-ttu-id="54fb7-196">Para melhor confiabilidade, é recomendável usar o [Azure Managed Disks][managed-disks].</span><span class="sxs-lookup"><span data-stu-id="54fb7-196">For best reliability, we recommend using [Azure Managed Disks][managed-disks].</span></span> <span data-ttu-id="54fb7-197">Os discos gerenciados garantem que os discos para VMs dentro de um conjunto de disponibilidade são isolados para evitar pontos únicos de falha.</span><span class="sxs-lookup"><span data-stu-id="54fb7-197">Managed disks ensure that the disks for VMs within an availability set are isolated to avoid single points of failure.</span></span>

> [!NOTE]
> <span data-ttu-id="54fb7-198">Atualmente o modelo do Resource Manager para esta arquitetura de referência não utiliza discos gerenciados.</span><span class="sxs-lookup"><span data-stu-id="54fb7-198">Currently the Resource Manager template for this reference architecture does not use managed disks.</span></span> <span data-ttu-id="54fb7-199">Estamos planejando atualizar o modelo para usar discos gerenciados.</span><span class="sxs-lookup"><span data-stu-id="54fb7-199">We are planning to update the template to use managed disks.</span></span>

<span data-ttu-id="54fb7-200">Use discos gerenciados Premium para todas as VMs do SQL Server e do SharePoint.</span><span class="sxs-lookup"><span data-stu-id="54fb7-200">Use Premium managed disks for all SharePoint and SQL Server VMs.</span></span> <span data-ttu-id="54fb7-201">Você pode usar o Standard Managed Disks para o servidor de nós principal, os controladores de domínio e o servidor de gerenciamento.</span><span class="sxs-lookup"><span data-stu-id="54fb7-201">You can use Standard managed disks for the majority node server, the domain controllers, and the management server.</span></span>

### <a name="sharepoint-server-recommendations"></a><span data-ttu-id="54fb7-202">Recomendações do SharePoint Server</span><span class="sxs-lookup"><span data-stu-id="54fb7-202">SharePoint Server recommendations</span></span>

<span data-ttu-id="54fb7-203">Antes de configurar o farm do SharePoint, verifique se você tem uma conta de serviço do Active Directory do Windows Server por serviço.</span><span class="sxs-lookup"><span data-stu-id="54fb7-203">Before configuring the SharePoint farm, make sure you have one Windows Server Active Directory service account per service.</span></span> <span data-ttu-id="54fb7-204">Para essa arquitetura, é necessário no mínimo as seguintes contas de nível de domínio para isolar o privilégio por função:</span><span class="sxs-lookup"><span data-stu-id="54fb7-204">For this architecture, you need at a minimum the following domain-level accounts to isolate privilege per role:</span></span>

- <span data-ttu-id="54fb7-205">Conta de serviço do SQL Server</span><span class="sxs-lookup"><span data-stu-id="54fb7-205">SQL Server Service account</span></span>
- <span data-ttu-id="54fb7-206">Conta de usuário de configuração</span><span class="sxs-lookup"><span data-stu-id="54fb7-206">Setup User account</span></span>
- <span data-ttu-id="54fb7-207">Conta do Farm de servidor</span><span class="sxs-lookup"><span data-stu-id="54fb7-207">Server Farm account</span></span>
- <span data-ttu-id="54fb7-208">Conta de serviço de pesquisa</span><span class="sxs-lookup"><span data-stu-id="54fb7-208">Search Service account</span></span>
- <span data-ttu-id="54fb7-209">Conta de acesso de conteúdo</span><span class="sxs-lookup"><span data-stu-id="54fb7-209">Content Access account</span></span>
- <span data-ttu-id="54fb7-210">Contas de pool de aplicativos Web</span><span class="sxs-lookup"><span data-stu-id="54fb7-210">Web App Pool accounts</span></span>
- <span data-ttu-id="54fb7-211">Contas de pool de aplicativos de serviço</span><span class="sxs-lookup"><span data-stu-id="54fb7-211">Service App Pool accounts</span></span>
- <span data-ttu-id="54fb7-212">Conta de superusuário do cache</span><span class="sxs-lookup"><span data-stu-id="54fb7-212">Cache Super User account</span></span>
- <span data-ttu-id="54fb7-213">Conta de superleitor do cache</span><span class="sxs-lookup"><span data-stu-id="54fb7-213">Cache Super Reader account</span></span>

<span data-ttu-id="54fb7-214">Para atender ao requisito de suporte para a taxa de transferência de disco de 200 MB por segundo mínimo, certifique-se de planejar a arquitetura de pesquisa.</span><span class="sxs-lookup"><span data-stu-id="54fb7-214">To meet the support requirement for disk throughput of 200 MB per second minimum, make sure to plan the Search architecture.</span></span> <span data-ttu-id="54fb7-215">Consulte [Planejar a arquitetura de pesquisa no SharePoint Server 2013][sharepoint-search].</span><span class="sxs-lookup"><span data-stu-id="54fb7-215">See [Plan enterprise search architecture in SharePoint Server 2013][sharepoint-search].</span></span> <span data-ttu-id="54fb7-216">Siga também as diretrizes em [Melhores práticas para rastreamento no SharePoint Server 2016][sharepoint-crawling].</span><span class="sxs-lookup"><span data-stu-id="54fb7-216">Also follow the guidelines in [Best practices for crawling in SharePoint Server 2016][sharepoint-crawling].</span></span>

<span data-ttu-id="54fb7-217">Além disso, armazene os dados do componente de pesquisa em um volume de armazenamento separado ou partição com alto desempenho.</span><span class="sxs-lookup"><span data-stu-id="54fb7-217">In addition, store the search component data on a separate storage volume or partition with high performance.</span></span> <span data-ttu-id="54fb7-218">Para reduzir a carga e melhorar a taxa de transferência, configure as contas de usuário de cache do objeto, que são necessárias nesta arquitetura.</span><span class="sxs-lookup"><span data-stu-id="54fb7-218">To reduce load and improve throughput, configure the object cache user accounts, which are required in this architecture.</span></span> <span data-ttu-id="54fb7-219">Dividir os arquivos do sistema operacional Windows Server, arquivos de programa do SharePoint Server 2016 e logs de diagnóstico em três partições ou volumes de armazenamento separados com desempenho normal.</span><span class="sxs-lookup"><span data-stu-id="54fb7-219">Split the Windows Server operating system files, the SharePoint Server 2016 program files, and diagnostics logs across three separate storage volumes or partitions with normal performance.</span></span>

<span data-ttu-id="54fb7-220">Para obter mais informações sobre essas recomendações, consulte [Contas de serviço e administrativa da implantação inicial no SharePoint Server 2016][sharepoint-accounts].</span><span class="sxs-lookup"><span data-stu-id="54fb7-220">For more information about these recommendations, see [Initial deployment administrative and service accounts in SharePoint Server 2016][sharepoint-accounts].</span></span>

### <a name="hybrid-workloads"></a><span data-ttu-id="54fb7-221">Cargas de trabalho híbridas</span><span class="sxs-lookup"><span data-stu-id="54fb7-221">Hybrid workloads</span></span>

<span data-ttu-id="54fb7-222">Essa arquitetura de referência implanta um farm do SharePoint Server 2016 que pode ser usado como um [ambiente híbrido do SharePoint][sharepoint-hybrid] &mdash; ou seja, estendendo o SharePoint Server 2016 para o Office 365 SharePoint Online.</span><span class="sxs-lookup"><span data-stu-id="54fb7-222">This reference architecture deploys a SharePoint Server 2016 farm that can be used as a [SharePoint hybrid environment][sharepoint-hybrid] &mdash; that is, extending SharePoint Server 2016 to Office 365 SharePoint Online.</span></span> <span data-ttu-id="54fb7-223">Se você tiver um Servidor do Office Online, consulte [Suporte para Aplicativos Web do Office e Servidor Online do Office no Azure][office-web-apps].</span><span class="sxs-lookup"><span data-stu-id="54fb7-223">If you have Office Online Server, see [Office Web Apps and Office Online Server supportability in Azure][office-web-apps].</span></span>

<span data-ttu-id="54fb7-224">Os aplicativos de serviço padrão nesta implantação foram projetados para oferecer suporte a cargas de trabalho híbridas.</span><span class="sxs-lookup"><span data-stu-id="54fb7-224">The default service applications in this deployment are designed to support hybrid workloads.</span></span> <span data-ttu-id="54fb7-225">Todas as cargas de trabalho híbridas do SharePoint Server 2016 e do Office 365 podem ser implantadas neste farm sem alterações na infraestrutura do SharePoint, com uma exceção: O Aplicativo de Serviço de Pesquisa Híbrido de Nuvem não deve ser implantado em servidores que hospedam uma topologia de pesquisa existente.</span><span class="sxs-lookup"><span data-stu-id="54fb7-225">All SharePoint Server 2016 and Office 365 hybrid workloads can be deployed to this farm without changes to the SharePoint infrastructure, with one exception: The Cloud Hybrid Search Service Application must not be deployed onto servers hosting an existing search topology.</span></span> <span data-ttu-id="54fb7-226">Portanto, uma ou mais VMs com base em função de pesquisa devem ser adicionadas ao farm para oferecer suporte a esse cenário híbrido.</span><span class="sxs-lookup"><span data-stu-id="54fb7-226">Therefore, one or more search-role-based VMs must be added to the farm to support this hybrid scenario.</span></span>

### <a name="sql-server-always-on-availability-groups"></a><span data-ttu-id="54fb7-227">Grupos de Disponibilidade Always On do SQL Server</span><span class="sxs-lookup"><span data-stu-id="54fb7-227">SQL Server Always On Availability Groups</span></span>

<span data-ttu-id="54fb7-228">Essa arquitetura usa máquinas virtuais do SQL Server porque o SharePoint Server 2016 não pode usar o Banco de Dados do SQL.</span><span class="sxs-lookup"><span data-stu-id="54fb7-228">This architecture uses SQL Server virtual machines because SharePoint Server 2016 cannot use Azure SQL Database.</span></span> <span data-ttu-id="54fb7-229">Para dar suporte à alta disponibilidade no SQL Server, é recomendável usar Grupos de Disponibilidade AlwaysOn, que especificam um conjunto de bancos de dados que fazem failover juntos, tornando-os, altamente disponíveis e recuperáveis.</span><span class="sxs-lookup"><span data-stu-id="54fb7-229">To support high availability in SQL Server, we recommend using Always On Availability Groups, which specify a set of databases that fail over together, making them highly-available and recoverable.</span></span> <span data-ttu-id="54fb7-230">Nessa arquitetura de referência, os bancos de dados são criados durante a implantação, mas você deve habilitar manualmente os Grupos de Disponibilidade Always On e adicionar os bancos de dados do SharePoint a um grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="54fb7-230">In this reference architecture, the databases are created during deployment, but you must manually enable Always On Availability Groups and add the SharePoint databases to an availability group.</span></span> <span data-ttu-id="54fb7-231">Para saber mais, consulte [Criar o grupo de disponibilidade e adicionar os bancos de dados do SharePoint][create-availability-group].</span><span class="sxs-lookup"><span data-stu-id="54fb7-231">For more information, see [Create the availability group and add the SharePoint databases][create-availability-group].</span></span>

<span data-ttu-id="54fb7-232">Também é recomendável adicionar um endereço IP de ouvinte ao cluster, que é o endereço IP privado do balanceador de carga interno para máquinas virtuais do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="54fb7-232">We also recommend adding a listener IP address to the cluster, which is the private IP address of the internal load balancer for the SQL Server virtual machines.</span></span>

<span data-ttu-id="54fb7-233">Para saber os tamanhos de VM recomendados e outras recomendações de desempenho para o SQL Server em execução no Azure, consulte [Práticas recomendadas de desempenho para o SQL Server em máquinas virtuais do Azure][sql-performance].</span><span class="sxs-lookup"><span data-stu-id="54fb7-233">For recommended VM sizes and other performance recommendations for SQL Server running in Azure, see [Performance best practices for SQL Server in Azure Virtual Machines][sql-performance].</span></span> <span data-ttu-id="54fb7-234">Além disso, siga as recomendações em [Melhores práticas para o SQL Server em um farm do SharePoint Server 2016][sql-sharepoint-best-practices].</span><span class="sxs-lookup"><span data-stu-id="54fb7-234">Also follow the recommendations in [Best practices for SQL Server in a SharePoint Server 2016 farm][sql-sharepoint-best-practices].</span></span>

<span data-ttu-id="54fb7-235">É recomendável que o servidor de nós principais resida em um computador separado dos parceiros de replicação.</span><span class="sxs-lookup"><span data-stu-id="54fb7-235">We recommend that the majority node server reside on a separate computer from the replication partners.</span></span> <span data-ttu-id="54fb7-236">O servidor permite que o servidor parceiro de replicação secundária em uma sessão de modo de alta segurança reconheça se deve iniciar um failover automático.</span><span class="sxs-lookup"><span data-stu-id="54fb7-236">The server enables the secondary replication partner server in a high-safety mode session to recognize whether to initiate an automatic failover.</span></span> <span data-ttu-id="54fb7-237">Ao contrário dos dois parceiros, o servidor de nós principais não atende o banco de dados, mas em vez disso, oferece suporte a failover automático.</span><span class="sxs-lookup"><span data-stu-id="54fb7-237">Unlike the two partners, the majority node server doesn't serve the database but rather supports automatic failover.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="54fb7-238">Considerações sobre escalabilidade</span><span class="sxs-lookup"><span data-stu-id="54fb7-238">Scalability considerations</span></span>

<span data-ttu-id="54fb7-239">Para dimensionar os servidores existentes, basta alterar o tamanho da VM.</span><span class="sxs-lookup"><span data-stu-id="54fb7-239">To scale up the existing servers, simply change the VM size.</span></span>

<span data-ttu-id="54fb7-240">Com o recurso [MinRoles][minroles] no SharePoint Server 2016, você pode expandir servidores com base na função do servidor e também remover servidores de uma função.</span><span class="sxs-lookup"><span data-stu-id="54fb7-240">With the [MinRoles][minroles] capability in SharePoint Server 2016, you can scale out servers based on the server's role and also remove servers from a role.</span></span> <span data-ttu-id="54fb7-241">Quando você adiciona servidores a uma função, você pode especificar qualquer uma das funções individuais ou uma das funções combinadas.</span><span class="sxs-lookup"><span data-stu-id="54fb7-241">When you add servers to a role, you can specify any of the single roles or one of the combined roles.</span></span> <span data-ttu-id="54fb7-242">Se você adicionar servidores para a função de pesquisa, no entanto, você deverá também reconfigurar a topologia de pesquisa usando o PowerShell.</span><span class="sxs-lookup"><span data-stu-id="54fb7-242">If you add servers to the Search role, however, you must also reconfigure the search topology using PowerShell.</span></span> <span data-ttu-id="54fb7-243">Você também pode converter funções usando MinRoles.</span><span class="sxs-lookup"><span data-stu-id="54fb7-243">You can also convert roles using MinRoles.</span></span> <span data-ttu-id="54fb7-244">Para obter mais informações, consulte [Gerenciamento de um farm de servidores MinRole no SharePoint Server 2016][sharepoint-minrole].</span><span class="sxs-lookup"><span data-stu-id="54fb7-244">For more information, see [Managing a MinRole Server Farm in SharePoint Server 2016][sharepoint-minrole].</span></span>

<span data-ttu-id="54fb7-245">Observe que o SharePoint Server 2016 não oferece suporte ao uso de conjuntos de escala de máquina virtual para o dimensionamento automático.</span><span class="sxs-lookup"><span data-stu-id="54fb7-245">Note that SharePoint Server 2016 doesn't support using virtual machine scale sets for auto-scaling.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="54fb7-246">Considerações sobre disponibilidade</span><span class="sxs-lookup"><span data-stu-id="54fb7-246">Availability considerations</span></span>

<span data-ttu-id="54fb7-247">Essa arquitetura de referência oferece suporte à alta disponibilidade em uma região do Azure, porque cada função possui pelo menos duas VMs implantadas em um conjunto de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="54fb7-247">This reference architecture supports high availability within an Azure region, because each role has at least two VMs deployed in an availability set.</span></span>

<span data-ttu-id="54fb7-248">Para proteger-se contra uma falha regional, crie um farm de recuperação de desastres separado em uma região do Azure diferente.</span><span class="sxs-lookup"><span data-stu-id="54fb7-248">To protect against a regional failure, create a separate disaster recovery farm in a different Azure region.</span></span> <span data-ttu-id="54fb7-249">Seus objetivos de tempo de recuperação (RTOs) e objetivos de ponto de recuperação (RPOs) determinarão os requisitos de configuração.</span><span class="sxs-lookup"><span data-stu-id="54fb7-249">Your recovery time objectives (RTOs) and recovery point objectives (RPOs) will determine the setup requirements.</span></span> <span data-ttu-id="54fb7-250">Para obter detalhes, consulte [Escolher uma estratégia de recuperação de desastres para o SharePoint 2016][sharepoint-dr].</span><span class="sxs-lookup"><span data-stu-id="54fb7-250">For details, see [Choose a disaster recovery strategy for SharePoint 2016][sharepoint-dr].</span></span> <span data-ttu-id="54fb7-251">A região secundária deve ser uma *região emparelhada* com a região principal.</span><span class="sxs-lookup"><span data-stu-id="54fb7-251">The secondary region should be a *paired region* with the primary region.</span></span> <span data-ttu-id="54fb7-252">No caso de uma interrupção ampla, é priorizada a recuperação de uma região de cada par.</span><span class="sxs-lookup"><span data-stu-id="54fb7-252">In the event of a broad outage, recovery of one region is prioritized out of every pair.</span></span> <span data-ttu-id="54fb7-253">Para saber mais, confira [Continuidade dos negócios e recuperação de desastres (BCDR): Regiões Combinadas do Azure][paired-regions].</span><span class="sxs-lookup"><span data-stu-id="54fb7-253">For more information, see [Business continuity and disaster recovery (BCDR): Azure Paired Regions][paired-regions].</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="54fb7-254">Considerações sobre capacidade de gerenciamento</span><span class="sxs-lookup"><span data-stu-id="54fb7-254">Manageability considerations</span></span>

<span data-ttu-id="54fb7-255">Para operar e manter servidores, farms de servidores e sites, siga as práticas recomendadas para operações do SharePoint.</span><span class="sxs-lookup"><span data-stu-id="54fb7-255">To operate and maintain servers, server farms, and sites, follow the recommended practices for SharePoint operations.</span></span> <span data-ttu-id="54fb7-256">Para obter mais informações, consulte [Operações para o Sharepoint Server 2016][sharepoint-ops].</span><span class="sxs-lookup"><span data-stu-id="54fb7-256">For more information, see [Operations for SharePoint Server 2016][sharepoint-ops].</span></span>

<span data-ttu-id="54fb7-257">As tarefas a serem considerados no gerenciamento do SQL Server em um ambiente do SharePoint podem ser diferentes daquelas que normalmente são consideradas para um aplicativo de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="54fb7-257">The tasks to consider when managing SQL Server in a SharePoint environment may differ from the ones typically considered for a database application.</span></span> <span data-ttu-id="54fb7-258">Uma prática recomendada é fazer backup total de todos os bancos de dados SQL semanalmente com backups incrementais todas as noites.</span><span class="sxs-lookup"><span data-stu-id="54fb7-258">A best practice is to fully back up all SQL databases weekly with incremental nightly backups.</span></span> <span data-ttu-id="54fb7-259">Faça um backup de logs de transações a cada 15 minutos.</span><span class="sxs-lookup"><span data-stu-id="54fb7-259">Back up transaction logs every 15 minutes.</span></span> <span data-ttu-id="54fb7-260">Outra prática é implementar as tarefas de manutenção do SQL Server nos bancos de dados ao mesmo tempo em que aquelas que são internas do SharePoint são desativadas.</span><span class="sxs-lookup"><span data-stu-id="54fb7-260">Another practice is to implement SQL Server maintenance tasks on the databases while disabling the built-in SharePoint ones.</span></span> <span data-ttu-id="54fb7-261">Para obter mais informações, consulte [Configuração e planejamento de capacidade de armazenamento e do SQL Server][sql-server-capacity-planning].</span><span class="sxs-lookup"><span data-stu-id="54fb7-261">For more information, see [Storage and SQL Server capacity planning and configuration][sql-server-capacity-planning].</span></span>

## <a name="security-considerations"></a><span data-ttu-id="54fb7-262">Considerações de segurança</span><span class="sxs-lookup"><span data-stu-id="54fb7-262">Security considerations</span></span>

<span data-ttu-id="54fb7-263">As contas de serviço de nível de domínio usadas para executar o SharePoint Server 2016 exigem controladores de domínio do AD do Windows Server para processos de autenticação e associação de domínio.</span><span class="sxs-lookup"><span data-stu-id="54fb7-263">The domain-level service accounts used to run SharePoint Server 2016 require Windows Server AD domain controllers for domain-join and authentication processes.</span></span> <span data-ttu-id="54fb7-264">O Azure Active Directory Domain Services não pode ser usado para essa finalidade.</span><span class="sxs-lookup"><span data-stu-id="54fb7-264">Azure Active Directory Domain Services can't be used for this purpose.</span></span> <span data-ttu-id="54fb7-265">Para estender a infraestrutura de identidade do AD do Windows Server já em vigor na intranet, essa arquitetura usa dois controladores de domínio de réplica do AD do Windows Server de uma floresta do AD do Windows Server local existente.</span><span class="sxs-lookup"><span data-stu-id="54fb7-265">To extend the Windows Server AD identity infrastructure already in place in the intranet, this architecture uses two Windows Server AD replica domain controllers of an existing on-premises Windows Server AD forest.</span></span>

<span data-ttu-id="54fb7-266">Além disso, sempre é aconselhável planejar para se ter uma segurança mais alta.</span><span class="sxs-lookup"><span data-stu-id="54fb7-266">In addition, it's always wise to plan for security hardening.</span></span> <span data-ttu-id="54fb7-267">Outras recomendações incluem:</span><span class="sxs-lookup"><span data-stu-id="54fb7-267">Other recommendations include:</span></span>

- <span data-ttu-id="54fb7-268">Adicionar regras para os NSGs para isolar sub-redes e funções.</span><span class="sxs-lookup"><span data-stu-id="54fb7-268">Add rules to NSGs to isolate subnets and roles.</span></span>
- <span data-ttu-id="54fb7-269">Não atribuir endereços IP públicos para máquinas virtuais.</span><span class="sxs-lookup"><span data-stu-id="54fb7-269">Don't assign public IP addresses to VMs.</span></span>
- <span data-ttu-id="54fb7-270">Para a detecção de intrusão e a análise de conteúdo, considere o uso de uma solução de virtualização de rede na frente de servidores Web de front-end em vez de um balanceador de carga interno do Azure.</span><span class="sxs-lookup"><span data-stu-id="54fb7-270">For intrusion detection and analysis of payloads, consider using a network virtual appliance in front of the front-end web servers instead of an internal Azure load balancer.</span></span>
- <span data-ttu-id="54fb7-271">Como opção, use as políticas de IPsec para criptografia de tráfego de texto não criptografado entre servidores.</span><span class="sxs-lookup"><span data-stu-id="54fb7-271">As an option, use IPsec policies for encryption of cleartext traffic between servers.</span></span> <span data-ttu-id="54fb7-272">Se você também estiver fazendo o isolamento de sub-rede, atualize suas regras de grupo de segurança de rede para permitir o tráfego IPsec.</span><span class="sxs-lookup"><span data-stu-id="54fb7-272">If you are also doing subnet isolation, update your network security group rules to allow IPsec traffic.</span></span>
- <span data-ttu-id="54fb7-273">Instale agentes antimalware nas VMs.</span><span class="sxs-lookup"><span data-stu-id="54fb7-273">Install anti-malware agents for the VMs.</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="54fb7-274">Implantar a solução</span><span class="sxs-lookup"><span data-stu-id="54fb7-274">Deploy the solution</span></span>

<span data-ttu-id="54fb7-275">Uma implantação para essa arquitetura de referência está disponível no [GitHub][github].</span><span class="sxs-lookup"><span data-stu-id="54fb7-275">A deployment for this reference architecture is available on [GitHub][github].</span></span> <span data-ttu-id="54fb7-276">Toda a implantação pode levar várias horas para ser concluída.</span><span class="sxs-lookup"><span data-stu-id="54fb7-276">The entire deployment can take several hours to complete.</span></span>

<span data-ttu-id="54fb7-277">A implantação cria os seguintes grupos de recursos em sua assinatura:</span><span class="sxs-lookup"><span data-stu-id="54fb7-277">The deployment creates the following resource groups in your subscription:</span></span>

- <span data-ttu-id="54fb7-278">ra-onprem-sp2016-rg</span><span class="sxs-lookup"><span data-stu-id="54fb7-278">ra-onprem-sp2016-rg</span></span>
- <span data-ttu-id="54fb7-279">ra-sp2016-network-rg</span><span class="sxs-lookup"><span data-stu-id="54fb7-279">ra-sp2016-network-rg</span></span>

<span data-ttu-id="54fb7-280">Os arquivos de parâmetros de modelo se referem a esses nomes e, portanto, se você alterá-los, atualize os arquivos de parâmetros para que correspondam.</span><span class="sxs-lookup"><span data-stu-id="54fb7-280">The template parameter files refer to these names, so if you change them, update the parameter files to match.</span></span>

<span data-ttu-id="54fb7-281">Os arquivos de parâmetro incluem uma senha embutida em código em vários locais.</span><span class="sxs-lookup"><span data-stu-id="54fb7-281">The parameter files include a hard-coded password in various places.</span></span> <span data-ttu-id="54fb7-282">Altere esses valores antes de fazer a implantação.</span><span class="sxs-lookup"><span data-stu-id="54fb7-282">Change these values before you deploy.</span></span>

### <a name="prerequisites"></a><span data-ttu-id="54fb7-283">Pré-requisitos</span><span class="sxs-lookup"><span data-stu-id="54fb7-283">Prerequisites</span></span>

[!INCLUDE [ref-arch-prerequisites.md](../../../includes/ref-arch-prerequisites.md)]

### <a name="deployment-steps"></a><span data-ttu-id="54fb7-284">Etapas de implantação.</span><span class="sxs-lookup"><span data-stu-id="54fb7-284">Deployment steps</span></span>

1. <span data-ttu-id="54fb7-285">Execute o comando a seguir para implantar uma rede local simulada.</span><span class="sxs-lookup"><span data-stu-id="54fb7-285">Run the following command to deploy a simulated on-premises network.</span></span>

    ```bash
    azbb -s <subscription_id> -g ra-onprem-sp2016-rg -l <location> -p onprem.json --deploy
    ```

2. <span data-ttu-id="54fb7-286">Execute o comando a seguir para implantar a VNet do Azure e o gateway de VPN.</span><span class="sxs-lookup"><span data-stu-id="54fb7-286">Run the following command to deploy the Azure VNet and the VPN gateway.</span></span>

    ```bash
    azbb -s <subscription_id> -g ra-onprem-sp2016-rg -l <location> -p connections.json --deploy
    ```

3. <span data-ttu-id="54fb7-287">Execute o comando a seguir para implantar o jumpbox, controladores de domínio do AD e VMs do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="54fb7-287">Run the following command to deploy the jumpbox, AD domain controllers, and SQL Server VMs.</span></span>

    ```bash
    azbb -s <subscription_id> -g ra-onprem-sp2016-rg -l <location> -p azure1.json --deploy
    ```

4. <span data-ttu-id="54fb7-288">Execute o comando a seguir para criar o cluster de failover e o grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="54fb7-288">Run the following command to create the failover cluster and the availability group.</span></span>

    ```bash
    azbb -s <subscription_id> -g ra-onprem-sp2016-rg -l <location> -p azure2-cluster.json --deploy
    ```

5. <span data-ttu-id="54fb7-289">Execute o seguinte comando para implantar as VMs restantes.</span><span class="sxs-lookup"><span data-stu-id="54fb7-289">Run the following command to deploy the remaining VMs.</span></span>

    ```bash
    azbb -s <subscription_id> -g ra-onprem-sp2016-rg -l <location> -p azure3.json --deploy
    ```

<span data-ttu-id="54fb7-290">Neste ponto, verifique se você pode fazer uma conexão de TCP de front-end da Web ao balanceador de carga para o grupo de disponibilidade Always On do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="54fb7-290">At this point, verify that you can make a TCP connection from the web front end to the load balancer for the SQL Server Always On availability group.</span></span> <span data-ttu-id="54fb7-291">Para isso, execute as etapas a seguir:</span><span class="sxs-lookup"><span data-stu-id="54fb7-291">To do so, perform the following steps:</span></span>

1. <span data-ttu-id="54fb7-292">Usar o portal do Azure para encontrar a VM denominada `ra-sp-jb-vm1` no grupo de recursos `ra-sp2016-network-rg`.</span><span class="sxs-lookup"><span data-stu-id="54fb7-292">Use the Azure portal to find the VM named `ra-sp-jb-vm1` in the `ra-sp2016-network-rg` resource group.</span></span> <span data-ttu-id="54fb7-293">Esta é a VM do jumpbox.</span><span class="sxs-lookup"><span data-stu-id="54fb7-293">This is the jumpbox VM.</span></span>

2. <span data-ttu-id="54fb7-294">Clique em `Connect` para abrir uma sessão de área de trabalho remota para a VM.</span><span class="sxs-lookup"><span data-stu-id="54fb7-294">Click `Connect` to open a remote desktop session to the VM.</span></span> <span data-ttu-id="54fb7-295">Use a senha que você especificou no arquivo de parâmetro `azure1.json`.</span><span class="sxs-lookup"><span data-stu-id="54fb7-295">Use the password that you specified in the `azure1.json` parameter file.</span></span>

3. <span data-ttu-id="54fb7-296">Na sessão de Área de Trabalho Remota, faça logon no 10.0.5.4.</span><span class="sxs-lookup"><span data-stu-id="54fb7-296">From the Remote Desktop session, log into 10.0.5.4.</span></span> <span data-ttu-id="54fb7-297">Este é o endereço IP da VM denominada `ra-sp-app-vm1`.</span><span class="sxs-lookup"><span data-stu-id="54fb7-297">This is the IP address of the VM named `ra-sp-app-vm1`.</span></span>

4. <span data-ttu-id="54fb7-298">Abra um console do PowerShell na VM e use o cmdlet `Test-NetConnection` para verificar se você pode se conectar ao balanceador de carga.</span><span class="sxs-lookup"><span data-stu-id="54fb7-298">Open a PowerShell console in the VM, and use the `Test-NetConnection` cmdlet to verify that you can connect to the load balancer.</span></span>

    ```powershell
    Test-NetConnection 10.0.3.100 -Port 1433
    ```

<span data-ttu-id="54fb7-299">O resultado deve ser semelhante ao seguinte:</span><span class="sxs-lookup"><span data-stu-id="54fb7-299">The output should look similar to the following:</span></span>

```console
ComputerName     : 10.0.3.100
RemoteAddress    : 10.0.3.100
RemotePort       : 1433
InterfaceAlias   : Ethernet 3
SourceAddress    : 10.0.0.132
TcpTestSucceeded : True
```

<span data-ttu-id="54fb7-300">Se ele falhar, use o Portal do Azure para reiniciar a VM denominada `ra-sp-sql-vm2`.</span><span class="sxs-lookup"><span data-stu-id="54fb7-300">If it fails, use the Azure Portal to restart the VM named `ra-sp-sql-vm2`.</span></span> <span data-ttu-id="54fb7-301">Após a reinicialização da VM, execute o comando `Test-NetConnection` novamente.</span><span class="sxs-lookup"><span data-stu-id="54fb7-301">After the VM restarts, run the `Test-NetConnection` command again.</span></span> <span data-ttu-id="54fb7-302">Você precisará aguardar cerca de um minuto após a VM ser reiniciada para que a conexão seja bem-sucedida.</span><span class="sxs-lookup"><span data-stu-id="54fb7-302">You may need to wait about a minute after the VM restarts for the connection to succeed.</span></span>

<span data-ttu-id="54fb7-303">Agora conclua a implantação da seguinte maneira.</span><span class="sxs-lookup"><span data-stu-id="54fb7-303">Now complete the deployment as follows.</span></span>

1. <span data-ttu-id="54fb7-304">Execute o comando a seguir para implantar o nó primário do farm do SharePoint.</span><span class="sxs-lookup"><span data-stu-id="54fb7-304">Run the following command to deploy the SharePoint farm primary node.</span></span>

    ```bash
    azbb -s <subscription_id> -g ra-onprem-sp2016-rg -l <location> -p azure4-sharepoint-server.json --deploy
    ```

2. <span data-ttu-id="54fb7-305">Execute o comando a seguir para implantar o cache do SharePoint, a pesquisa e a Web.</span><span class="sxs-lookup"><span data-stu-id="54fb7-305">Run the following command to deploy the SharePoint cache, search, and web.</span></span>

    ```bash
    azbb -s <subscription_id> -g ra-onprem-sp2016-rg -l <location> -p azure5-sharepoint-farm.json --deploy
    ```

3. <span data-ttu-id="54fb7-306">Execute o comando a seguir para criar as regras do NSG.</span><span class="sxs-lookup"><span data-stu-id="54fb7-306">Run the following command to create the NSG rules.</span></span>

    ```bash
    azbb -s <subscription_id> -g ra-onprem-sp2016-rg -l <location> -p azure6-security.json --deploy
    ```

### <a name="validate-the-deployment"></a><span data-ttu-id="54fb7-307">Validar a implantação</span><span class="sxs-lookup"><span data-stu-id="54fb7-307">Validate the deployment</span></span>

1. <span data-ttu-id="54fb7-308">No [portal do Azure][azure-portal], navegue até o grupo de recursos `ra-onprem-sp2016-rg`.</span><span class="sxs-lookup"><span data-stu-id="54fb7-308">In the [Azure portal][azure-portal], navigate to the `ra-onprem-sp2016-rg` resource group.</span></span>

2. <span data-ttu-id="54fb7-309">Na lista de recursos, selecione o recurso de VM chamado `ra-onpr-u-vm1`.</span><span class="sxs-lookup"><span data-stu-id="54fb7-309">In the list of resources, select the VM resource named `ra-onpr-u-vm1`.</span></span>

3. <span data-ttu-id="54fb7-310">Conecte-se à VM, conforme descrito em [Conectar-se à máquina virtual][connect-to-vm].</span><span class="sxs-lookup"><span data-stu-id="54fb7-310">Connect to the VM, as described in [Connect to virtual machine][connect-to-vm].</span></span> <span data-ttu-id="54fb7-311">O nome de usuário é `\onpremuser`.</span><span class="sxs-lookup"><span data-stu-id="54fb7-311">The user name is `\onpremuser`.</span></span>

4. <span data-ttu-id="54fb7-312">Quando a conexão remota com a máquina virtual for estabelecida, abra um navegador na VM e navegue até `http://portal.contoso.local`.</span><span class="sxs-lookup"><span data-stu-id="54fb7-312">When the remote connection to the VM is established, open a browser in the VM and navigate to `http://portal.contoso.local`.</span></span>

5. <span data-ttu-id="54fb7-313">Na caixa **Segurança do Windows**, faça logon no portal do SharePoint usando `contoso.local\testuser` para o nome de usuário.</span><span class="sxs-lookup"><span data-stu-id="54fb7-313">In the **Windows Security** box, log on to the SharePoint portal using `contoso.local\testuser` for the user name.</span></span>

<span data-ttu-id="54fb7-314">Esse logon faz um túnel do domínio Fabrikam.com usado pela rede local até o domínio contoso.local usado pelo portal do SharePoint.</span><span class="sxs-lookup"><span data-stu-id="54fb7-314">This logon tunnels from the Fabrikam.com domain used by the on-premises network to the contoso.local domain used by the SharePoint portal.</span></span> <span data-ttu-id="54fb7-315">Quando o site do SharePoint abre, você verá o site de demonstração de raiz.</span><span class="sxs-lookup"><span data-stu-id="54fb7-315">When the SharePoint site opens, you'll see the root demo site.</span></span>

<span data-ttu-id="54fb7-316">**_Colaboradores dessa arquitetura de referência_** &mdash; Joe Davies, Bob Fox, Neil Hodgkinson, Paul Stork</span><span class="sxs-lookup"><span data-stu-id="54fb7-316">**_Contributors to this reference architecture_** &mdash; Joe Davies, Bob Fox, Neil Hodgkinson, Paul Stork</span></span>

<!-- links -->

[availability-set]: /azure/virtual-machines/windows/manage-availability
[azure-portal]: https://portal.azure.com
[azure-ps]: /powershell/azure/overview
[azure-pricing]: https://azure.microsoft.com/pricing/calculator/
[bastion-host]: https://en.wikipedia.org/wiki/Bastion_host
[create-availability-group]: /SharePoint/administration/sharepoint-intranet-farm-in-azure-phase-5-create-the-availability-group-and-add
[connect-to-vm]: /azure/virtual-machines/windows/quick-create-portal#connect-to-virtual-machine
[github]: https://github.com/mspnp/reference-architectures
[hybrid-ra]: ../hybrid-networking/index.md
[hybrid-vpn-ra]: ../hybrid-networking/vpn.md
[load-balancer]: /azure/load-balancer/load-balancer-internal-overview
[managed-disks]: /azure/storage/storage-managed-disks-overview
[minroles]: https://technet.microsoft.com/library/mt346114(v=office.16).aspx
[nsg]: /azure/virtual-network/virtual-networks-nsg
[office-web-apps]: https://support.microsoft.com/help/3199955/office-web-apps-and-office-online-server-supportability-in-azure
[paired-regions]: /azure/best-practices-availability-paired-regions
[readme]: https://github.com/mspnp/reference-architectures/tree/master/sharepoint/sharepoint-2016
[resource-group]: /azure/azure-resource-manager/resource-group-overview
[quotas]: /azure/azure-subscription-service-limits
[sharepoint-accounts]: https://technet.microsoft.com/library/ee662513(v=office.16).aspx
[sharepoint-crawling]: https://technet.microsoft.com/library/dn535606(v=office.16).aspx
[sharepoint-dr]: https://technet.microsoft.com/library/ff628971(v=office.16).aspx
[sharepoint-hybrid]: https://aka.ms/sphybrid
[sharepoint-minrole]: https://technet.microsoft.com/library/mt743705(v=office.16).aspx
[sharepoint-ops]: https://technet.microsoft.com/library/cc262289(v=office.16).aspx
[sharepoint-reqs]: https://technet.microsoft.com/library/cc262485(v=office.16).aspx
[sharepoint-search]: https://technet.microsoft.com/library/dn342836.aspx
[sql-always-on]: /sql/database-engine/availability-groups/windows/always-on-availability-groups-sql-server
[sql-performance]: /azure/virtual-machines/windows/sql/virtual-machines-windows-sql-performance
[sql-server-capacity-planning]: https://technet.microsoft.com/library/cc298801(v=office.16).aspx
[sql-quorum]: https://technet.microsoft.com/library/cc731739(v=ws.11).aspx
[sql-sharepoint-best-practices]: https://technet.microsoft.com/library/hh292622(v=office.16).aspx
[tempdb]: /sql/relational-databases/databases/tempdb-database
[virtual-networks-nsg]: /azure/virtual-network/virtual-networks-nsg
[visio-download]: https://archcenter.blob.core.windows.net/cdn/Sharepoint-2016.vsdx
[vm-sizes-general]: /azure/virtual-machines/windows/sizes-general
[vm-sizes-memory]: /azure/virtual-machines/windows/sizes-memory
[windows-n-tier]: ../virtual-machines-windows/n-tier.md
