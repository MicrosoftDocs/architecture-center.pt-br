---
title: Implementando uma arquitetura de rede híbrida segura no Azure
description: Como implementar uma arquitetura de rede híbrida segura no Azure.
author: telmosampaio
ms.date: 07/01/2018
pnp.series.title: Network DMZ
pnp.series.prev: ./index
pnp.series.next: secure-vnet-dmz
cardTitle: DMZ between Azure and on-premises
ms.openlocfilehash: 45583473ef297b2c7a5b0c4baff52485286dd051
ms.sourcegitcommit: 9b459f75254d97617e16eddd0d411d1f80b7fe90
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/03/2018
ms.locfileid: "37403157"
---
# <a name="dmz-between-azure-and-your-on-premises-datacenter"></a><span data-ttu-id="a54c4-103">DMZ entre o Azure e o datacenter local</span><span class="sxs-lookup"><span data-stu-id="a54c4-103">DMZ between Azure and your on-premises datacenter</span></span>

<span data-ttu-id="a54c4-104">Essa arquitetura de referência mostra uma rede híbrida segura que estende uma rede local para o Azure.</span><span class="sxs-lookup"><span data-stu-id="a54c4-104">This reference architecture shows a secure hybrid network that extends an on-premises network to Azure.</span></span> <span data-ttu-id="a54c4-105">A arquitetura implementa uma rede de perímetro, também chamada de *DMZ*, entre a rede local e uma VNet (rede virtual) do Azure.</span><span class="sxs-lookup"><span data-stu-id="a54c4-105">The architecture implements a DMZ, also called a *perimeter network*, between the on-premises network and an Azure virtual network (VNet).</span></span> <span data-ttu-id="a54c4-106">O DMZ inclui NVAs (soluções de virtualização de rede) que implementam a funcionalidade de segurança, como firewalls e inspeção de pacotes.</span><span class="sxs-lookup"><span data-stu-id="a54c4-106">The DMZ includes network virtual appliances (NVAs) that implement security functionality such as firewalls and packet inspection.</span></span> <span data-ttu-id="a54c4-107">Todo o tráfego de saída da VNet é enviado por túnel forçadamente à Internet por meio da rede local, para que ele possa ser auditado.</span><span class="sxs-lookup"><span data-stu-id="a54c4-107">All outgoing traffic from the VNet is force-tunneled to the Internet through the on-premises network, so that it can be audited.</span></span> [<span data-ttu-id="a54c4-108">**Implante essa solução**.</span><span class="sxs-lookup"><span data-stu-id="a54c4-108">**Deploy this solution**.</span></span>](#deploy-the-solution)

<span data-ttu-id="a54c4-109">[![0]][0]</span><span class="sxs-lookup"><span data-stu-id="a54c4-109">[![0]][0]</span></span> 

<span data-ttu-id="a54c4-110">*Baixe um [Arquivo Visio][visio-download] dessa arquitetura.*</span><span class="sxs-lookup"><span data-stu-id="a54c4-110">*Download a [Visio file][visio-download] of this architecture.*</span></span>

<span data-ttu-id="a54c4-111">Essa arquitetura exige uma conexão com o datacenter local, usando um [Gateway de VPN][ra-vpn] ou uma conexão do [ExpressRoute][ra-expressroute].</span><span class="sxs-lookup"><span data-stu-id="a54c4-111">This architecture requires a connection to your on-premises datacenter, using either a [VPN gateway][ra-vpn] or an [ExpressRoute][ra-expressroute] connection.</span></span> <span data-ttu-id="a54c4-112">Alguns usos típicos dessa arquitetura:</span><span class="sxs-lookup"><span data-stu-id="a54c4-112">Typical uses for this architecture include:</span></span>

* <span data-ttu-id="a54c4-113">Aplicativos híbridos nos quais as cargas de trabalho são executadas parcialmente localmente e parcialmente no Azure.</span><span class="sxs-lookup"><span data-stu-id="a54c4-113">Hybrid applications where workloads run partly on-premises and partly in Azure.</span></span>
* <span data-ttu-id="a54c4-114">Infraestrutura que requer um controle granular sobre o tráfego que entra em uma VNet do Azure proveniente de um datacenter local.</span><span class="sxs-lookup"><span data-stu-id="a54c4-114">Infrastructure that requires granular control over traffic entering an Azure VNet from an on-premises datacenter.</span></span>
* <span data-ttu-id="a54c4-115">Aplicativos que precisam auditar o tráfego de saída.</span><span class="sxs-lookup"><span data-stu-id="a54c4-115">Applications that must audit outgoing traffic.</span></span> <span data-ttu-id="a54c4-116">Isso geralmente é um requisito de regulamentação de muitos sistemas comerciais e pode ajudar a evitar a divulgação de informações privadas.</span><span class="sxs-lookup"><span data-stu-id="a54c4-116">This is often a regulatory requirement of many commercial systems and can help to prevent public disclosure of private information.</span></span>

## <a name="architecture"></a><span data-ttu-id="a54c4-117">Arquitetura</span><span class="sxs-lookup"><span data-stu-id="a54c4-117">Architecture</span></span>

<span data-ttu-id="a54c4-118">A arquitetura consiste nos componentes a seguir.</span><span class="sxs-lookup"><span data-stu-id="a54c4-118">The architecture consists of the following components.</span></span>

* <span data-ttu-id="a54c4-119">**Rede local**.</span><span class="sxs-lookup"><span data-stu-id="a54c4-119">**On-premises network**.</span></span> <span data-ttu-id="a54c4-120">Uma rede local privada implementada em uma organização.</span><span class="sxs-lookup"><span data-stu-id="a54c4-120">A  private local-area network implemented in an organization.</span></span>
* <span data-ttu-id="a54c4-121">**VNet (rede virtual) do Azure**.</span><span class="sxs-lookup"><span data-stu-id="a54c4-121">**Azure virtual network (VNet)**.</span></span> <span data-ttu-id="a54c4-122">A VNet hospeda o aplicativo e outros recursos em execução no Azure.</span><span class="sxs-lookup"><span data-stu-id="a54c4-122">The VNet hosts the application and other resources running in Azure.</span></span>
* <span data-ttu-id="a54c4-123">**Gateway**.</span><span class="sxs-lookup"><span data-stu-id="a54c4-123">**Gateway**.</span></span> <span data-ttu-id="a54c4-124">O gateway fornece conectividade entre os roteadores na rede local e na VNet.</span><span class="sxs-lookup"><span data-stu-id="a54c4-124">The gateway provides connectivity between the routers in the on-premises network and the VNet.</span></span>
* <span data-ttu-id="a54c4-125">**NVA (solução de virtualização de rede)**.</span><span class="sxs-lookup"><span data-stu-id="a54c4-125">**Network virtual appliance (NVA)**.</span></span> <span data-ttu-id="a54c4-126">NVA é um termo genérico que descreve uma VM que executa tarefas como permitir ou negar acesso como um firewall, otimizar operações de WAN (rede de longa distância) (incluindo compactação de rede), roteamento personalizado ou outros recursos de rede.</span><span class="sxs-lookup"><span data-stu-id="a54c4-126">NVA is a generic term that describes a VM performing tasks such as allowing or denying access as a firewall, optimizing wide area network (WAN) operations (including network compression), custom routing, or other network functionality.</span></span>
* <span data-ttu-id="a54c4-127">**Sub-redes de camada da Web, de camada de negócios e de camada de dados**.</span><span class="sxs-lookup"><span data-stu-id="a54c4-127">**Web tier, business tier, and data tier subnets**.</span></span> <span data-ttu-id="a54c4-128">Sub-redes que hospedam as VMs e os serviços que implementam um aplicativo de três camadas de exemplo em execução na nuvem.</span><span class="sxs-lookup"><span data-stu-id="a54c4-128">Subnets hosting the VMs and services that implement an example 3-tier application running in the cloud.</span></span> <span data-ttu-id="a54c4-129">Consulte [Executar VMs do Windows para um aplicativo de N camadas no Azure][ra-n-tier] para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="a54c4-129">See [Running Windows VMs for an N-tier architecture on Azure][ra-n-tier] for more information.</span></span>
* <span data-ttu-id="a54c4-130">**UDR (rotas definidas pelo usuário)**.</span><span class="sxs-lookup"><span data-stu-id="a54c4-130">**User defined routes (UDR)**.</span></span> <span data-ttu-id="a54c4-131">As [rotas definidas pelo usuário][udr-overview] definem o fluxo de tráfego de IP nas VNets do Azure.</span><span class="sxs-lookup"><span data-stu-id="a54c4-131">[User defined routes][udr-overview] define the flow of IP traffic within Azure VNets.</span></span>

    > [!NOTE]
    > <span data-ttu-id="a54c4-132">Dependendo dos requisitos da sua conexão de VPN, você pode configurar rotas de BGP (Border Gateway Protocol) em vez de usar UDRs para implementar as regras de encaminhamento que retornam o tráfego por meio da rede local.</span><span class="sxs-lookup"><span data-stu-id="a54c4-132">Depending on the requirements of your VPN connection, you can configure Border Gateway Protocol (BGP) routes instead of using UDRs to implement the forwarding rules that direct traffic back through the on-premises network.</span></span>
    > 
    > 

* <span data-ttu-id="a54c4-133">**Sub-rede de gerenciamento.**</span><span class="sxs-lookup"><span data-stu-id="a54c4-133">**Management subnet.**</span></span> <span data-ttu-id="a54c4-134">Essa sub-rede contém VMs que implementam recursos de gerenciamento e monitoramentos para os componentes em execução na VNet.</span><span class="sxs-lookup"><span data-stu-id="a54c4-134">This subnet contains VMs that implement management and monitoring capabilities for the components running in the VNet.</span></span>

## <a name="recommendations"></a><span data-ttu-id="a54c4-135">Recomendações</span><span class="sxs-lookup"><span data-stu-id="a54c4-135">Recommendations</span></span>

<span data-ttu-id="a54c4-136">As seguintes recomendações aplicam-se à maioria dos cenários.</span><span class="sxs-lookup"><span data-stu-id="a54c4-136">The following recommendations apply for most scenarios.</span></span> <span data-ttu-id="a54c4-137">Siga estas recomendações, a menos que você tenha um requisito específico que as substitua.</span><span class="sxs-lookup"><span data-stu-id="a54c4-137">Follow these recommendations unless you have a specific requirement that overrides them.</span></span> 

### <a name="access-control-recommendations"></a><span data-ttu-id="a54c4-138">Recomendações de controle de acesso</span><span class="sxs-lookup"><span data-stu-id="a54c4-138">Access control recommendations</span></span>

<span data-ttu-id="a54c4-139">Use o [RBAC ][rbac] (controle de acesso baseado em função) para gerenciar os recursos em seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="a54c4-139">Use [Role-Based Access Control ][rbac] (RBAC) to manage the resources in your application.</span></span> <span data-ttu-id="a54c4-140">Considere criar as seguintes [funções personalizadas][rbac-custom-roles]:</span><span class="sxs-lookup"><span data-stu-id="a54c4-140">Consider creating the following [custom roles][rbac-custom-roles]:</span></span>

- <span data-ttu-id="a54c4-141">Uma função de DevOps com permissões para administrar a infraestrutura do aplicativo, implantar os componentes do aplicativo e monitorar e reiniciar VMs.</span><span class="sxs-lookup"><span data-stu-id="a54c4-141">A DevOps role with permissions to administer the infrastructure for the application, deploy the application components, and monitor and restart VMs.</span></span>  

- <span data-ttu-id="a54c4-142">Uma função de administrador de TI centralizada para gerenciar e monitorar recursos de rede.</span><span class="sxs-lookup"><span data-stu-id="a54c4-142">A centralized IT administrator role to manage and monitor network resources.</span></span>

- <span data-ttu-id="a54c4-143">Uma função de administrador de TI de segurança para gerenciar recursos de rede segura, como as NVAs.</span><span class="sxs-lookup"><span data-stu-id="a54c4-143">A security IT administrator role to manage secure network resources such as the NVAs.</span></span> 

<span data-ttu-id="a54c4-144">As funções de DevOps e de administrador de TI não devem ter acesso aos recursos de NVA.</span><span class="sxs-lookup"><span data-stu-id="a54c4-144">The DevOps and IT administrator roles should not have access to the NVA resources.</span></span> <span data-ttu-id="a54c4-145">Esse acesso deve ser restrito à função de administrador de TI de segurança.</span><span class="sxs-lookup"><span data-stu-id="a54c4-145">This should be restricted to the security IT administrator role.</span></span>

### <a name="resource-group-recommendations"></a><span data-ttu-id="a54c4-146">Recomendações do grupo de recursos</span><span class="sxs-lookup"><span data-stu-id="a54c4-146">Resource group recommendations</span></span>

<span data-ttu-id="a54c4-147">Os recursos do Azure como VMs, VNets e balanceadores de carga podem ser gerenciados facilmente ao serem agrupados em grupos de recursos.</span><span class="sxs-lookup"><span data-stu-id="a54c4-147">Azure resources such as VMs, VNets, and load balancers can be easily managed by grouping them together into resource groups.</span></span> <span data-ttu-id="a54c4-148">Atribua funções de RBAC a cada grupo de recursos para restringir o acesso.</span><span class="sxs-lookup"><span data-stu-id="a54c4-148">Assign RBAC roles to each resource group to restrict access.</span></span>

<span data-ttu-id="a54c4-149">É recomendável criar os grupos de recursos a seguir:</span><span class="sxs-lookup"><span data-stu-id="a54c4-149">We recommend creating the following resource groups:</span></span>

* <span data-ttu-id="a54c4-150">Um grupo de recursos que contenha a VNet (excluindo as VMs), os NSGs e os recursos de gateway para conectar-se à rede local.</span><span class="sxs-lookup"><span data-stu-id="a54c4-150">A resource group containing the VNet (excluding the VMs), NSGs, and the gateway resources for connecting to the on-premises network.</span></span> <span data-ttu-id="a54c4-151">Atribua a função de administrador de TI centralizada a esse grupo de recursos.</span><span class="sxs-lookup"><span data-stu-id="a54c4-151">Assign the centralized IT administrator role to this resource group.</span></span>
* <span data-ttu-id="a54c4-152">Um grupo de recursos que contenha as VMs para as NVAs (incluindo o balanceador de carga), o jumpbox e outras VMs de gerenciamento e a UDR da sub-rede do gateway que force todo o tráfego pelas NVAs.</span><span class="sxs-lookup"><span data-stu-id="a54c4-152">A resource group containing the VMs for the NVAs (including the load balancer), the jumpbox and other management VMs, and the UDR for the gateway subnet that forces all traffic through the NVAs.</span></span> <span data-ttu-id="a54c4-153">Atribua a função de administrador de TI de segurança a este grupo de recursos.</span><span class="sxs-lookup"><span data-stu-id="a54c4-153">Assign the security IT administrator role to this resource group.</span></span>
* <span data-ttu-id="a54c4-154">Grupos de recursos separados para cada camada de aplicativo que contenha o balanceador de carga e as VMs.</span><span class="sxs-lookup"><span data-stu-id="a54c4-154">Separate resource groups for each application tier that contain the load balancer and VMs.</span></span> <span data-ttu-id="a54c4-155">Observe que esse grupo de recursos não deve incluir as sub-redes de cada camada.</span><span class="sxs-lookup"><span data-stu-id="a54c4-155">Note that this resource group shouldn't include the subnets for each tier.</span></span> <span data-ttu-id="a54c4-156">Atribua a função de DevOps a este grupo de recursos.</span><span class="sxs-lookup"><span data-stu-id="a54c4-156">Assign the DevOps role to this resource group.</span></span>

### <a name="virtual-network-gateway-recommendations"></a><span data-ttu-id="a54c4-157">Recomendações do gateway de rede virtual</span><span class="sxs-lookup"><span data-stu-id="a54c4-157">Virtual network gateway recommendations</span></span>

<span data-ttu-id="a54c4-158">O tráfego local passa para a VNet por meio de um gateway de rede virtual.</span><span class="sxs-lookup"><span data-stu-id="a54c4-158">On-premises traffic passes to the VNet through a virtual network gateway.</span></span> <span data-ttu-id="a54c4-159">É recomendável um [Gateway de VPN do Azure][guidance-vpn-gateway] ou um [gateway do Azure ExpressRoute][guidance-expressroute].</span><span class="sxs-lookup"><span data-stu-id="a54c4-159">We recommend an [Azure VPN gateway][guidance-vpn-gateway] or an [Azure ExpressRoute gateway][guidance-expressroute].</span></span>

### <a name="nva-recommendations"></a><span data-ttu-id="a54c4-160">Recomendações de NVA</span><span class="sxs-lookup"><span data-stu-id="a54c4-160">NVA recommendations</span></span>

<span data-ttu-id="a54c4-161">As NVAs fornecem diferentes serviços para gerenciar e monitorar o tráfego de rede.</span><span class="sxs-lookup"><span data-stu-id="a54c4-161">NVAs provide different services for managing and monitoring network traffic.</span></span> <span data-ttu-id="a54c4-162">O [Azure Marketplace][azure-marketplace-nva] oferece vários NVAs de fornecedores terceiros que você pode usar.</span><span class="sxs-lookup"><span data-stu-id="a54c4-162">The [Azure Marketplace][azure-marketplace-nva] offers several third-party vendor NVAs that you can use.</span></span> <span data-ttu-id="a54c4-163">Se nenhuma dessas NVAs de terceiros atender aos seus requisitos, você poderá criar uma NVA personalizada usando VMs.</span><span class="sxs-lookup"><span data-stu-id="a54c4-163">If none of these third-party NVAs meet your requirements, you can create a custom NVA using VMs.</span></span> 

<span data-ttu-id="a54c4-164">Por exemplo, a implantação da solução para essa arquitetura de referência implementa uma NVA com a seguinte funcionalidade em uma VM:</span><span class="sxs-lookup"><span data-stu-id="a54c4-164">For example, the solution deployment for this reference architecture implements an NVA with the following functionality on a VM:</span></span>

* <span data-ttu-id="a54c4-165">O tráfego é roteado usando [encaminhamento de IP][ip-forwarding] nos NICs (adaptadores de rede) da NVA.</span><span class="sxs-lookup"><span data-stu-id="a54c4-165">Traffic is routed using [IP forwarding][ip-forwarding] on the NVA network interfaces (NICs).</span></span>
* <span data-ttu-id="a54c4-166">O tráfego terá permissão para passar pela NVA somente se ele for apropriado para isso.</span><span class="sxs-lookup"><span data-stu-id="a54c4-166">Traffic is permitted to pass through the NVA only if it is appropriate to do so.</span></span> <span data-ttu-id="a54c4-167">Cada VM da NVA na arquitetura de referência é um roteador simples do Linux.</span><span class="sxs-lookup"><span data-stu-id="a54c4-167">Each NVA VM in the reference architecture is a simple Linux router.</span></span> <span data-ttu-id="a54c4-168">O tráfego de entrada chega no adaptador de rede *eth0* e o tráfego de saída corresponde às regras definidas por scripts personalizados expedidos por meio da adaptador de rede *eth1*.</span><span class="sxs-lookup"><span data-stu-id="a54c4-168">Inbound traffic arrives on network interface *eth0*, and outbound traffic matches rules defined by custom scripts dispatched through network interface *eth1*.</span></span>
* <span data-ttu-id="a54c4-169">As NVAs só podem ser configuradas por meio da sub-rede de gerenciamento.</span><span class="sxs-lookup"><span data-stu-id="a54c4-169">The NVAs can only be configured from the management subnet.</span></span> 
* <span data-ttu-id="a54c4-170">O tráfego roteado para a sub-rede de gerenciamento não passa pelas NVAs.</span><span class="sxs-lookup"><span data-stu-id="a54c4-170">Traffic routed to the management subnet does not pass through the NVAs.</span></span> <span data-ttu-id="a54c4-171">Caso contrário, se as NVAs falharem, não haverá nenhuma rota para a sub-rede de gerenciamento para corrigi-las.</span><span class="sxs-lookup"><span data-stu-id="a54c4-171">Otherwise, if the NVAs fail, there would be no route to the management subnet to fix them.</span></span>  
* <span data-ttu-id="a54c4-172">As VMs da NVA são colocadas em um [conjunto de disponibilidade][availability-set] atrás de um balanceador de carga.</span><span class="sxs-lookup"><span data-stu-id="a54c4-172">The VMs for the NVA are placed in an [availability set][availability-set] behind a load balancer.</span></span> <span data-ttu-id="a54c4-173">A UDR na sub-rede do gateway direciona as solicitações da NVA ao balanceador de carga.</span><span class="sxs-lookup"><span data-stu-id="a54c4-173">The UDR in the gateway subnet directs NVA requests to the load balancer.</span></span>

<span data-ttu-id="a54c4-174">Inclua uma NVA da camada 7 para encerrar conexões de aplicativo no nível da NVA e manter a afinidade com as camadas de back-end.</span><span class="sxs-lookup"><span data-stu-id="a54c4-174">Include a layer-7 NVA to terminate application connections at the NVA level and maintain affinity with the backend tiers.</span></span> <span data-ttu-id="a54c4-175">Isso garante a conectividade simétrica, na qual o tráfego de resposta das camadas de back-end retorna por meio da NVA.</span><span class="sxs-lookup"><span data-stu-id="a54c4-175">This guarantees symmetric connectivity, in which response traffic from the backend tiers returns through the NVA.</span></span>

<span data-ttu-id="a54c4-176">Outra opção a ser considerada é conectar várias NVAs em série, com cada NVA executando uma tarefa de segurança especializada.</span><span class="sxs-lookup"><span data-stu-id="a54c4-176">Another option to consider is connecting multiple NVAs in series, with each NVA performing a specialized security task.</span></span> <span data-ttu-id="a54c4-177">Isso permite que cada função de segurança seja gerenciada considerando cada NVA.</span><span class="sxs-lookup"><span data-stu-id="a54c4-177">This allows each security function to be managed on a per-NVA basis.</span></span> <span data-ttu-id="a54c4-178">Por exemplo, uma NVA que implementa um firewall pode ser colocada em série com uma NVA que executa serviços de identidade.</span><span class="sxs-lookup"><span data-stu-id="a54c4-178">For example, an NVA implementing a firewall could be placed in series with an NVA running identity services.</span></span> <span data-ttu-id="a54c4-179">A compensação para facilitar o gerenciamento é a adição de saltos de rede extras que podem aumentar a latência, portanto, verifique se isso não afeta o desempenho do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="a54c4-179">The tradeoff for ease of management is the addition of extra network hops that may increase latency, so ensure that this doesn't affect your application's performance.</span></span>


### <a name="nsg-recommendations"></a><span data-ttu-id="a54c4-180">Recomendações de NSG</span><span class="sxs-lookup"><span data-stu-id="a54c4-180">NSG recommendations</span></span>

<span data-ttu-id="a54c4-181">O Gateway de VPN expõe um endereço IP público para a conexão com a rede local.</span><span class="sxs-lookup"><span data-stu-id="a54c4-181">The VPN gateway exposes a public IP address for the connection to the on-premises network.</span></span> <span data-ttu-id="a54c4-182">É recomendável criar um NSG (Grupo de Segurança de Rede) para a sub-rede da NVA de entrada, com regras para bloquear todo o tráfego não originado na rede local.</span><span class="sxs-lookup"><span data-stu-id="a54c4-182">We recommend creating a network security group (NSG) for the inbound NVA subnet, with rules to block all traffic not originating from the on-premises network.</span></span>

<span data-ttu-id="a54c4-183">Também é recomendável que os NSGs de cada sub-rede forneçam um segundo nível de proteção contra o tráfego de entrada ignorando uma NVA desabilitada ou configurada incorretamente.</span><span class="sxs-lookup"><span data-stu-id="a54c4-183">We also recommend NSGs for each subnet to provide a second level of protection against inbound traffic bypassing an incorrectly configured or disabled NVA.</span></span> <span data-ttu-id="a54c4-184">Por exemplo, a sub-rede de camada da Web na arquitetura de referência implementa um NSG com uma regra para ignorar todas as solicitações que não sejam as recebidas da rede local (192.168.0.0/16) ou da VNet, e outra regra que ignora todas as solicitações que não são feitas na porta 80.</span><span class="sxs-lookup"><span data-stu-id="a54c4-184">For example, the web tier subnet in the reference architecture implements an NSG with a rule to ignore all requests other than those received from the on-premises network (192.168.0.0/16) or the VNet, and another rule that ignores all requests not made on port 80.</span></span>

### <a name="internet-access-recommendations"></a><span data-ttu-id="a54c4-185">Recomendações de acesso à Internet</span><span class="sxs-lookup"><span data-stu-id="a54c4-185">Internet access recommendations</span></span>

<span data-ttu-id="a54c4-186">[Force por túnel][azure-forced-tunneling] todo o tráfego de Internet de saída pela rede local usando o túnel de VPN site a site e rotear à Internet usando a NAT (conversão de endereços de rede).</span><span class="sxs-lookup"><span data-stu-id="a54c4-186">[Force-tunnel][azure-forced-tunneling] all outbound Internet traffic through your on-premises network using the site-to-site VPN tunnel, and route to the Internet using network address translation (NAT).</span></span> <span data-ttu-id="a54c4-187">Isso impede a perda acidental de informações confidenciais armazenadas na camada de dados e permite a inspeção e a auditoria de todo o tráfego de saída.</span><span class="sxs-lookup"><span data-stu-id="a54c4-187">This prevents accidental leakage of any confidential information stored in your data tier and allows inspection and auditing of all outgoing traffic.</span></span>

> [!NOTE]
> <span data-ttu-id="a54c4-188">Não bloqueie completamente o tráfego de Internet das camadas de aplicativo, pois isso impedirá que essas camadas usem os serviços de PaaS do Azure que se baseiam em endereços IP públicos, como o log de diagnóstico de VM, o download de extensões de VM e outras funcionalidades.</span><span class="sxs-lookup"><span data-stu-id="a54c4-188">Don't completely block Internet traffic from the application tiers, as this will prevent these tiers from using Azure PaaS services that rely on public IP addresses, such as VM diagnostics logging, downloading of VM extensions, and other functionality.</span></span> <span data-ttu-id="a54c4-189">O diagnóstico do Azure também requer que componentes possam ler e gravar em uma conta de armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="a54c4-189">Azure diagnostics also requires that components can read and write to an Azure Storage account.</span></span>
> 
> 

<span data-ttu-id="a54c4-190">Verifique se o tráfego de saída da Internet é forçado ao túnel corretamente.</span><span class="sxs-lookup"><span data-stu-id="a54c4-190">Verify that outbound internet traffic is force-tunneled correctly.</span></span> <span data-ttu-id="a54c4-191">Se você estiver usando uma conexão de VPN com o [serviço de roteamento e acesso remoto][routing-and-remote-access-service] em um servidor local, use uma ferramenta como o [WireShark][wireshark] ou o [Microsoft Message Analyzer](https://www.microsoft.com/download/details.aspx?id=44226).</span><span class="sxs-lookup"><span data-stu-id="a54c4-191">If you're using a VPN connection with the [routing and remote access service][routing-and-remote-access-service] on an on-premises server, use a tool such as [WireShark][wireshark] or [Microsoft Message Analyzer](https://www.microsoft.com/download/details.aspx?id=44226).</span></span>

### <a name="management-subnet-recommendations"></a><span data-ttu-id="a54c4-192">Recomendações da sub-rede de gerenciamento</span><span class="sxs-lookup"><span data-stu-id="a54c4-192">Management subnet recommendations</span></span>

<span data-ttu-id="a54c4-193">A sub-rede de gerenciamento contém um jumpbox que executa as funcionalidades de gerenciamento e de monitoramento.</span><span class="sxs-lookup"><span data-stu-id="a54c4-193">The management subnet contains a jumpbox that performs management and monitoring functionality.</span></span> <span data-ttu-id="a54c4-194">Restrinja a execução de todas as tarefas de gerenciamento seguro ao jumpbox.</span><span class="sxs-lookup"><span data-stu-id="a54c4-194">Restrict execution of all secure management tasks to the jumpbox.</span></span>
 
<span data-ttu-id="a54c4-195">Não crie um endereço IP público para o jumpbox.</span><span class="sxs-lookup"><span data-stu-id="a54c4-195">Do not create a public IP address for the jumpbox.</span></span> <span data-ttu-id="a54c4-196">Nesse caso, crie uma rota para acessar o jumpbox por meio do gateway de entrada.</span><span class="sxs-lookup"><span data-stu-id="a54c4-196">Instead, create one route to access the jumpbox through the incoming gateway.</span></span> <span data-ttu-id="a54c4-197">Crie regras do NSG para que a sub-rede de gerenciamento só responda a solicitações da rota permitida.</span><span class="sxs-lookup"><span data-stu-id="a54c4-197">Create NSG rules so the management subnet only responds to requests from the allowed route.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="a54c4-198">Considerações sobre escalabilidade</span><span class="sxs-lookup"><span data-stu-id="a54c4-198">Scalability considerations</span></span>

<span data-ttu-id="a54c4-199">A arquitetura de referência usa um balanceador de carga para direcionar o tráfego de rede local a um pool de dispositivos NVA, que roteiam o tráfego.</span><span class="sxs-lookup"><span data-stu-id="a54c4-199">The reference architecture uses a load balancer to direct on-premises network traffic to a pool of NVA devices, which route the traffic.</span></span> <span data-ttu-id="a54c4-200">As NVAs são colocadas em um [conjunto de disponibilidade][availability-set].</span><span class="sxs-lookup"><span data-stu-id="a54c4-200">The NVAs are placed in an [availability set][availability-set].</span></span> <span data-ttu-id="a54c4-201">Esse design permite que você monitore a produtividade das NVAs ao longo do tempo e adicione dispositivos NVA em resposta ao aumento de carga.</span><span class="sxs-lookup"><span data-stu-id="a54c4-201">This design allows you to monitor the throughput of the NVAs over time and add NVA devices in response to increases in load.</span></span>

<span data-ttu-id="a54c4-202">O Gateway de VPN da SKU Standard dá suporte para produtividade prolongada de até 100 Mbps.</span><span class="sxs-lookup"><span data-stu-id="a54c4-202">The standard SKU VPN gateway supports sustained throughput of up to 100 Mbps.</span></span> <span data-ttu-id="a54c4-203">A SKU de alto desempenho oferece até 200 Mbps.</span><span class="sxs-lookup"><span data-stu-id="a54c4-203">The High Performance SKU provides up to 200 Mbps.</span></span> <span data-ttu-id="a54c4-204">Para larguras de banda superiores, considere atualizar para um gateway do ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="a54c4-204">For higher bandwidths, consider upgrading to an ExpressRoute gateway.</span></span> <span data-ttu-id="a54c4-205">O ExpressRoute fornece até 10 Gbps de largura de banda com uma latência menor do que uma conexão de VPN.</span><span class="sxs-lookup"><span data-stu-id="a54c4-205">ExpressRoute provides up to 10 Gbps bandwidth with lower latency than a VPN connection.</span></span>

<span data-ttu-id="a54c4-206">Para obter mais informações sobre a escalabilidade dos gateways do Azure, consulte a seção de consideração de escalabilidade em [Implementing a hybrid network architecture with Azure and on-premises VPN][guidance-vpn-gateway-scalability] (Implementando uma arquitetura de rede híbrida com o Azure e VPN local) e [Implementing a hybrid network architecture with Azure ExpressRoute][guidance-expressroute-scalability] (Implementando uma arquitetura de rede híbrida com o Azure ExpressRoute).</span><span class="sxs-lookup"><span data-stu-id="a54c4-206">For more information about the scalability of Azure gateways, see the scalability consideration section in [Implementing a hybrid network architecture with Azure and on-premises VPN][guidance-vpn-gateway-scalability] and [Implementing a hybrid network architecture with Azure ExpressRoute][guidance-expressroute-scalability].</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="a54c4-207">Considerações sobre disponibilidade</span><span class="sxs-lookup"><span data-stu-id="a54c4-207">Availability considerations</span></span>

<span data-ttu-id="a54c4-208">Conforme mencionado, a arquitetura de referência usa um pool de dispositivos NVA atrás de um balanceador de carga.</span><span class="sxs-lookup"><span data-stu-id="a54c4-208">As mentioned, the reference architecture uses a pool of NVA devices behind a load balancer.</span></span> <span data-ttu-id="a54c4-209">O balanceador de carga usa uma investigação de integridade para monitorar cada NVA e removerá todas as NVAs sem resposta do pool.</span><span class="sxs-lookup"><span data-stu-id="a54c4-209">The load balancer uses a health probe to monitor each NVA and will remove any unresponsive NVAs from the pool.</span></span>

<span data-ttu-id="a54c4-210">Se você estiver usando o Azure ExpressRoute para fornecer conectividade entre a VNet e a rede local, [configure um Gateway de VPN para fornecer failover][ra-vpn-failover] se a conexão do ExpressRoute ficar indisponível.</span><span class="sxs-lookup"><span data-stu-id="a54c4-210">If you're using Azure ExpressRoute to provide connectivity between the VNet and on-premises network, [configure a VPN gateway to provide failover][ra-vpn-failover] if the ExpressRoute connection becomes unavailable.</span></span>

<span data-ttu-id="a54c4-211">Para obter informações específicas de como manter a disponibilidade para conexões de VPN e do ExpressRoute, consulte as considerações de disponibilidade [Implementing a hybrid network architecture with Azure and on-premises VPN][guidance-vpn-gateway-availability] (Implementando uma arquitetura de rede híbrida com o Azure e VPN local) e [Implementing a hybrid network architecture with Azure ExpressRoute][guidance-expressroute-availability] (Implementando uma arquitetura de rede híbrida com o Azure ExpressRoute).</span><span class="sxs-lookup"><span data-stu-id="a54c4-211">For specific information on maintaining availability for VPN and ExpressRoute connections, see the availability considerations in [Implementing a hybrid network architecture with Azure and on-premises VPN][guidance-vpn-gateway-availability] and [Implementing a hybrid network architecture with Azure ExpressRoute][guidance-expressroute-availability].</span></span> 

## <a name="manageability-considerations"></a><span data-ttu-id="a54c4-212">Considerações sobre capacidade de gerenciamento</span><span class="sxs-lookup"><span data-stu-id="a54c4-212">Manageability considerations</span></span>

<span data-ttu-id="a54c4-213">Todo o monitoramento de aplicativos e de recursos deve ser realizado pelo jumpbox na sub-rede de gerenciamento.</span><span class="sxs-lookup"><span data-stu-id="a54c4-213">All application and resource monitoring should be performed by the jumpbox in the management subnet.</span></span> <span data-ttu-id="a54c4-214">Dependendo dos requisitos do aplicativo, talvez sejam necessários recursos de monitoramentos adicionais na sub-rede de gerenciamento.</span><span class="sxs-lookup"><span data-stu-id="a54c4-214">Depending on your application requirements, you may need additional monitoring resources in the management subnet.</span></span> <span data-ttu-id="a54c4-215">Nesse caso, esses recursos deverão ser acessados por meio do jumpbox.</span><span class="sxs-lookup"><span data-stu-id="a54c4-215">If so, these resources should be accessed through the jumpbox.</span></span>

<span data-ttu-id="a54c4-216">Se a conectividade de gateway da rede local para o Azure estiver inativa, você ainda poderá acessar o jumpbox implantando um endereço IP público, adicionando-o ao jumpbox e comunicando-se remotamente pela Internet.</span><span class="sxs-lookup"><span data-stu-id="a54c4-216">If gateway connectivity from your on-premises network to Azure is down, you can still reach the jumpbox by deploying a public IP address, adding it to the jumpbox, and remoting in from the internet.</span></span>

<span data-ttu-id="a54c4-217">A sub-rede de cada camada na arquitetura de referência é protegida por regras de NSG.</span><span class="sxs-lookup"><span data-stu-id="a54c4-217">Each tier's subnet in the reference architecture is protected by NSG rules.</span></span> <span data-ttu-id="a54c4-218">Talvez seja necessário criar uma regra para abrir a porta 3389 para acesso do protocolo RDP em VMs do Windows ou a porta 22 para acesso de SSH (Secure Shell) em VMs do Linux.</span><span class="sxs-lookup"><span data-stu-id="a54c4-218">You may need to create a rule to open port 3389 for remote desktop protocol (RDP) access on Windows VMs or port 22 for secure shell (SSH) access on Linux VMs.</span></span> <span data-ttu-id="a54c4-219">Outras ferramentas de gerenciamento e monitoramentos podem exigir regras para abrir portas adicionais.</span><span class="sxs-lookup"><span data-stu-id="a54c4-219">Other management and monitoring tools may require rules to open additional ports.</span></span>

<span data-ttu-id="a54c4-220">Se você estiver usando o ExpressRoute para fornecer a conectividade entre o datacenter local e o Azure, use o [AzureCT (Kit de ferramentas de conectividade do Azure)][azurect] para monitorar e solucionar problemas de conexão.</span><span class="sxs-lookup"><span data-stu-id="a54c4-220">If you're using ExpressRoute to provide the connectivity between your on-premises datacenter and Azure, use the [Azure Connectivity Toolkit (AzureCT)][azurect] to monitor and troubleshoot connection issues.</span></span>

<span data-ttu-id="a54c4-221">Você pode encontrar informações adicionais especificamente destinadas ao monitoramento e ao gerenciamento de conexões de VPN e do ExpressRoute nos artigos [Implementing a hybrid network architecture with Azure and on-premises VPN][guidance-vpn-gateway-manageability] (Implementando uma arquitetura de rede híbrida com o Azure e VPN local) e [Implementing a hybrid network architecture with Azure ExpressRoute][guidance-expressroute-manageability] (Implementando uma arquitetura de rede híbrida com o Azure ExpressRoute).</span><span class="sxs-lookup"><span data-stu-id="a54c4-221">You can find additional information specifically aimed at monitoring and managing VPN and ExpressRoute connections in the articles [Implementing a hybrid network architecture with Azure and on-premises VPN][guidance-vpn-gateway-manageability] and [Implementing a hybrid network architecture with Azure ExpressRoute][guidance-expressroute-manageability].</span></span>

## <a name="security-considerations"></a><span data-ttu-id="a54c4-222">Considerações de segurança</span><span class="sxs-lookup"><span data-stu-id="a54c4-222">Security considerations</span></span>

<span data-ttu-id="a54c4-223">Essa arquitetura de referência implementa vários níveis de segurança.</span><span class="sxs-lookup"><span data-stu-id="a54c4-223">This reference architecture implements multiple levels of security.</span></span>

### <a name="routing-all-on-premises-user-requests-through-the-nva"></a><span data-ttu-id="a54c4-224">Roteando todas as solicitações de usuário locais por meio da NVA</span><span class="sxs-lookup"><span data-stu-id="a54c4-224">Routing all on-premises user requests through the NVA</span></span>
<span data-ttu-id="a54c4-225">A UDR na sub-rede do gateway bloqueia todas as solicitações de usuário que não são recebidas do local.</span><span class="sxs-lookup"><span data-stu-id="a54c4-225">The UDR in the gateway subnet blocks all user requests other than those received from on-premises.</span></span> <span data-ttu-id="a54c4-226">A UDR passa as solicitações permitidas para as NVAs na sub-rede do DMZ privado e essas solicitações somente serão passadas para o aplicativo se forem permitidas pelas regras da NVA.</span><span class="sxs-lookup"><span data-stu-id="a54c4-226">The UDR passes allowed requests to the NVAs in the private DMZ subnet, and these requests are passed on to the application if they are allowed by the NVA rules.</span></span> <span data-ttu-id="a54c4-227">Você pode adicionar outras rotas para a UDR, mas não ignore as NVAs nem bloqueie o tráfego administrativo destinado à sub-rede de gerenciamento acidentalmente.</span><span class="sxs-lookup"><span data-stu-id="a54c4-227">You can add other routes to the UDR, but make sure they don't inadvertently bypass the NVAs or block administrative traffic intended for the management subnet.</span></span>

<span data-ttu-id="a54c4-228">O balanceador de carga na frente das NVAs também atua como um dispositivo de segurança ignorando o tráfego nas portas que não estão abertas nas regras de balanceamento de carga.</span><span class="sxs-lookup"><span data-stu-id="a54c4-228">The load balancer in front of the NVAs also acts as a security device by ignoring traffic on ports that are not open in the load balancing rules.</span></span> <span data-ttu-id="a54c4-229">Os balanceadores de carga na arquitetura de referência só escutam as solicitações HTTP na porta 80 e as solicitações HTTPS na porta 443.</span><span class="sxs-lookup"><span data-stu-id="a54c4-229">The load balancers in the reference architecture only listen for HTTP requests on port 80 and HTTPS requests on port 443.</span></span> <span data-ttu-id="a54c4-230">Documente todas as regras adicionais que você adicionar aos balanceadores de carga e monitore o tráfego para garantir que não haja nenhum problema de segurança.</span><span class="sxs-lookup"><span data-stu-id="a54c4-230">Document any additional rules that you add to the load balancers, and monitor traffic to ensure there are no security issues.</span></span>

### <a name="using-nsgs-to-blockpass-traffic-between-application-tiers"></a><span data-ttu-id="a54c4-231">Usando os NSGs para bloquear/aprovar o tráfego entre as camadas de aplicativo</span><span class="sxs-lookup"><span data-stu-id="a54c4-231">Using NSGs to block/pass traffic between application tiers</span></span>
<span data-ttu-id="a54c4-232">O tráfego entre camadas é restringido usando NSGs.</span><span class="sxs-lookup"><span data-stu-id="a54c4-232">Traffic between tiers is restricted by using NSGs.</span></span> <span data-ttu-id="a54c4-233">A camada de negócios bloqueia todo o tráfego que não se origina na camada da Web e a camada de dados bloqueia todo o tráfego que não se origina na camada de negócios.</span><span class="sxs-lookup"><span data-stu-id="a54c4-233">The business tier blocks all traffic that doesn't originate in the web tier, and the data tier blocks all traffic that doesn't originate in the business tier.</span></span> <span data-ttu-id="a54c4-234">Se você tiver o requisito de expandir as regras do NSG para ampliar o acesso a essas camadas, pondere esses requisitos em relação aos riscos de segurança.</span><span class="sxs-lookup"><span data-stu-id="a54c4-234">If you have a requirement to expand the NSG rules to allow broader access to these tiers, weigh these requirements against the security risks.</span></span> <span data-ttu-id="a54c4-235">Cada novo caminho de entrada representa uma oportunidade para danos de aplicativo ou perda de dados acidental ou intencional.</span><span class="sxs-lookup"><span data-stu-id="a54c4-235">Each new inbound pathway represents an opportunity for accidental or purposeful data leakage or application damage.</span></span>

### <a name="devops-access"></a><span data-ttu-id="a54c4-236">Acesso de DevOps</span><span class="sxs-lookup"><span data-stu-id="a54c4-236">DevOps access</span></span>
<span data-ttu-id="a54c4-237">Use o [RBAC][rbac] para restringir as operações que DevOps pode executar em cada camada.</span><span class="sxs-lookup"><span data-stu-id="a54c4-237">Use [RBAC][rbac] to restrict the operations that DevOps can perform on each tier.</span></span> <span data-ttu-id="a54c4-238">Ao conceder permissões, use o [princípio de privilégios mínimos][security-principle-of-least-privilege].</span><span class="sxs-lookup"><span data-stu-id="a54c4-238">When granting permissions, use the [principle of least privilege][security-principle-of-least-privilege].</span></span> <span data-ttu-id="a54c4-239">Registre em log todas as operações administrativas e execute auditorias regulares para confirmar se todas as alterações de configuração foram planejadas.</span><span class="sxs-lookup"><span data-stu-id="a54c4-239">Log all administrative operations and perform regular audits to ensure any configuration changes were planned.</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="a54c4-240">Implantar a solução</span><span class="sxs-lookup"><span data-stu-id="a54c4-240">Deploy the solution</span></span>

<span data-ttu-id="a54c4-241">Uma implantação para uma arquitetura de referência que implementa essas recomendações está disponível no [GitHub][github-folder].</span><span class="sxs-lookup"><span data-stu-id="a54c4-241">A deployment for a reference architecture that implements these recommendations is available on [GitHub][github-folder].</span></span> 

### <a name="prerequisites"></a><span data-ttu-id="a54c4-242">pré-requisitos</span><span class="sxs-lookup"><span data-stu-id="a54c4-242">Prerequisites</span></span>

[!INCLUDE [ref-arch-prerequisites.md](../../../includes/ref-arch-prerequisites.md)]

### <a name="deploy-resources"></a><span data-ttu-id="a54c4-243">Implantação de recursos</span><span class="sxs-lookup"><span data-stu-id="a54c4-243">Deploy resources</span></span>

1. <span data-ttu-id="a54c4-244">Navegue para a pasta `/dmz/secure-vnet-hybrid` do repositório GitHub de arquiteturas de referência.</span><span class="sxs-lookup"><span data-stu-id="a54c4-244">Navigate to the `/dmz/secure-vnet-hybrid` folder of the reference architectures GitHub repository.</span></span>

2. <span data-ttu-id="a54c4-245">Execute o comando a seguir:</span><span class="sxs-lookup"><span data-stu-id="a54c4-245">Run the following command:</span></span>

    ```bash
    azbb -s <subscription_id> -g <resource_group_name> -l <region> -p onprem.json --deploy
    ```

3. <span data-ttu-id="a54c4-246">Execute o comando a seguir:</span><span class="sxs-lookup"><span data-stu-id="a54c4-246">Run the following command:</span></span>

    ```bash
    azbb -s <subscription_id> -g <resource_group_name> -l <region> -p secure-vnet-hybrid.json --deploy
    ```

### <a name="connect-the-on-premises-and-azure-gateways"></a><span data-ttu-id="a54c4-247">Conectar os gateways do Azure e locais</span><span class="sxs-lookup"><span data-stu-id="a54c4-247">Connect the on-premises and Azure gateways</span></span>

<span data-ttu-id="a54c4-248">Nesta etapa, você conectará os dois gateways de rede locais.</span><span class="sxs-lookup"><span data-stu-id="a54c4-248">In this step, you will connect the two local network gateways.</span></span>

1. <span data-ttu-id="a54c4-249">No portal do Azure, navegue até o grupo de recursos que você criou.</span><span class="sxs-lookup"><span data-stu-id="a54c4-249">In the Azure Portal, navigate to the resource group that you created.</span></span> 

2. <span data-ttu-id="a54c4-250">Localize o recurso denominado `ra-vpn-vgw-pip` e copie o endereço IP mostrado na folha **Visão geral**.</span><span class="sxs-lookup"><span data-stu-id="a54c4-250">Find the resource named `ra-vpn-vgw-pip` and copy the IP address shown in the **Overview** blade.</span></span>

3. <span data-ttu-id="a54c4-251">Encontre o recurso denominado `onprem-vpn-lgw`.</span><span class="sxs-lookup"><span data-stu-id="a54c4-251">Find the resource named `onprem-vpn-lgw`.</span></span>

4. <span data-ttu-id="a54c4-252">Clique na folha **Configuração**.</span><span class="sxs-lookup"><span data-stu-id="a54c4-252">Click the **Configuration** blade.</span></span> <span data-ttu-id="a54c4-253">No **Endereço IP**, cole o endereço IP da etapa 2.</span><span class="sxs-lookup"><span data-stu-id="a54c4-253">Under **IP address**, paste in the IP address from step 2.</span></span>

    ![](./images/local-net-gw.png)

5. <span data-ttu-id="a54c4-254">Clique em **Salvar** e aguarde a conclusão da operação.</span><span class="sxs-lookup"><span data-stu-id="a54c4-254">Click **Save** and wait for the operation to complete.</span></span> <span data-ttu-id="a54c4-255">Isso pode levar cerca de 5 minutos.</span><span class="sxs-lookup"><span data-stu-id="a54c4-255">It can take about 5 minutes.</span></span>

6. <span data-ttu-id="a54c4-256">Encontre o recurso denominado `onprem-vpn-gateway1-pip`.</span><span class="sxs-lookup"><span data-stu-id="a54c4-256">Find the resource named `onprem-vpn-gateway1-pip`.</span></span> <span data-ttu-id="a54c4-257">Copie o endereço IP mostrado na folha **Visão geral**.</span><span class="sxs-lookup"><span data-stu-id="a54c4-257">Copy the IP address shown in the **Overview** blade.</span></span>

7. <span data-ttu-id="a54c4-258">Encontre o recurso denominado `ra-vpn-lgw`.</span><span class="sxs-lookup"><span data-stu-id="a54c4-258">Find the resource named `ra-vpn-lgw`.</span></span> 

8. <span data-ttu-id="a54c4-259">Clique na folha **Configuração**.</span><span class="sxs-lookup"><span data-stu-id="a54c4-259">Click the **Configuration** blade.</span></span> <span data-ttu-id="a54c4-260">No **Endereço IP**, cole o endereço IP da etapa 6.</span><span class="sxs-lookup"><span data-stu-id="a54c4-260">Under **IP address**, paste in the IP address from step 6.</span></span>

9. <span data-ttu-id="a54c4-261">Clique em **Salvar** e aguarde a conclusão da operação.</span><span class="sxs-lookup"><span data-stu-id="a54c4-261">Click **Save** and wait for the operation to complete.</span></span>

10. <span data-ttu-id="a54c4-262">Para verificar a conexão, vá até a folha **Conexões** de cada gateway.</span><span class="sxs-lookup"><span data-stu-id="a54c4-262">To verify the connection, go to the **Connections** blade for each gateway.</span></span> <span data-ttu-id="a54c4-263">O status deve ser **Conectado**.</span><span class="sxs-lookup"><span data-stu-id="a54c4-263">The status should be **Connected**.</span></span>

### <a name="verify-that-network-traffic-reaches-the-web-tier"></a><span data-ttu-id="a54c4-264">Verificar se o tráfego de rede atinge a camada da Web</span><span class="sxs-lookup"><span data-stu-id="a54c4-264">Verify that network traffic reaches the web tier</span></span>

1. <span data-ttu-id="a54c4-265">No portal do Azure, navegue até o grupo de recursos que você criou.</span><span class="sxs-lookup"><span data-stu-id="a54c4-265">In the Azure Portal, navigate to the resource group that you created.</span></span> 

2. <span data-ttu-id="a54c4-266">Encontre o recurso denominado `int-dmz-lb`, que é o balanceador de carga na frente da DMZ privada.</span><span class="sxs-lookup"><span data-stu-id="a54c4-266">Find the resource named `int-dmz-lb`, which is the load balancer in front of the private DMZ.</span></span> <span data-ttu-id="a54c4-267">Copie o endereço IP privado da folha **Visão geral**.</span><span class="sxs-lookup"><span data-stu-id="a54c4-267">Copy the private IP address from the **Overview** blade.</span></span>

3. <span data-ttu-id="a54c4-268">Encontre a VM denominada `jb-vm1`.</span><span class="sxs-lookup"><span data-stu-id="a54c4-268">Find the VM named `jb-vm1`.</span></span> <span data-ttu-id="a54c4-269">Clique em **Conectar** e use a Área de Trabalho Remota para se conectar à VM.</span><span class="sxs-lookup"><span data-stu-id="a54c4-269">Click **Connect** and use Remote Desktop to connect to the VM.</span></span> <span data-ttu-id="a54c4-270">O nome de usuário e a senha são especificadas no arquivo onprem.json.</span><span class="sxs-lookup"><span data-stu-id="a54c4-270">The user name and password are specified in the onprem.json file.</span></span>

4. <span data-ttu-id="a54c4-271">Na sessão de Área de Trabalho Remota, abra um navegador da Web e navegue até o endereço IP da etapa 2.</span><span class="sxs-lookup"><span data-stu-id="a54c4-271">From the Remote Desktop Session, open a web browser and navigate to the IP address from step 2.</span></span> <span data-ttu-id="a54c4-272">Você deve ver a home page padrão do servidor Apache2.</span><span class="sxs-lookup"><span data-stu-id="a54c4-272">You should see the default Apache2 server home page.</span></span>

## <a name="next-steps"></a><span data-ttu-id="a54c4-273">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="a54c4-273">Next steps</span></span>

* <span data-ttu-id="a54c4-274">Aprenda a implementar uma [rede de perímetro entre o Azure e a Internet](secure-vnet-dmz.md).</span><span class="sxs-lookup"><span data-stu-id="a54c4-274">Learn how to implement a [DMZ between Azure and the Internet](secure-vnet-dmz.md).</span></span>
* <span data-ttu-id="a54c4-275">Aprenda a implementar uma [arquitetura de rede híbrida altamente disponível][ra-vpn-failover].</span><span class="sxs-lookup"><span data-stu-id="a54c4-275">Learn how to implement a [highly available hybrid network architecture][ra-vpn-failover].</span></span>
* <span data-ttu-id="a54c4-276">Para obter mais informações de como gerenciar a segurança da rede com o Azure, consulte [Segurança de rede e serviços em nuvem da Microsoft][cloud-services-network-security].</span><span class="sxs-lookup"><span data-stu-id="a54c4-276">For more information about managing network security with Azure, see [Microsoft cloud services and network security][cloud-services-network-security].</span></span>
* <span data-ttu-id="a54c4-277">Para obter informações detalhadas sobre como proteger recursos no Azure, consulte [Introdução à segurança do Microsoft Azure][getting-started-with-azure-security].</span><span class="sxs-lookup"><span data-stu-id="a54c4-277">For detailed information about protecting resources in Azure, see [Getting started with Microsoft Azure security][getting-started-with-azure-security].</span></span> 
* <span data-ttu-id="a54c4-278">Para obter detalhes adicionais de como solucionar preocupações de segurança em uma conexão de gateway do Azure, consulte [Implementing a hybrid network architecture with Azure and on-premises VPN][guidance-vpn-gateway-security] (Implementando uma arquitetura de rede híbrida com o Azure e VPN local) e [Implementing a hybrid network architecture with Azure ExpressRoute][guidance-expressroute-security] (Implementando uma arquitetura de rede híbrida com o Azure ExpressRoute).</span><span class="sxs-lookup"><span data-stu-id="a54c4-278">For additional details on addressing security concerns across an Azure gateway connection, see [Implementing a hybrid network architecture with Azure and on-premises VPN][guidance-vpn-gateway-security] and [Implementing a hybrid network architecture with Azure ExpressRoute][guidance-expressroute-security].</span></span>
  > 

<!-- links -->

[availability-set]: /azure/virtual-machines/virtual-machines-windows-create-availability-set
[azurect]: https://github.com/Azure/NetworkMonitoring/tree/master/AzureCT
[azure-forced-tunneling]: https://azure.microsoft.com/en-gb/documentation/articles/vpn-gateway-forced-tunneling-rm/
[azure-marketplace-nva]: https://azuremarketplace.microsoft.com/marketplace/apps/category/networking
[cloud-services-network-security]: https://azure.microsoft.com/documentation/articles/best-practices-network-security/
[getting-started-with-azure-security]: /azure/security/azure-security-getting-started
[github-folder]: https://github.com/mspnp/reference-architectures/tree/master/dmz/secure-vnet-hybrid
[guidance-expressroute]: ../hybrid-networking/expressroute.md
[guidance-expressroute-availability]: ../hybrid-networking/expressroute.md#availability-considerations
[guidance-expressroute-manageability]: ../hybrid-networking/expressroute.md#manageability-considerations
[guidance-expressroute-security]: ../hybrid-networking/expressroute.md#security-considerations
[guidance-expressroute-scalability]: ../hybrid-networking/expressroute.md#scalability-considerations
[guidance-vpn-gateway]: ../hybrid-networking/vpn.md
[guidance-vpn-gateway-availability]: ../hybrid-networking/vpn.md#availability-considerations
[guidance-vpn-gateway-manageability]: ../hybrid-networking/vpn.md#manageability-considerations
[guidance-vpn-gateway-scalability]: ../hybrid-networking/vpn.md#scalability-considerations
[guidance-vpn-gateway-security]: ../hybrid-networking/vpn.md#security-considerations
[ip-forwarding]: /azure/virtual-network/virtual-networks-udr-overview#ip-forwarding
[ra-expressroute]: ../hybrid-networking/expressroute.md
[ra-n-tier]: ../virtual-machines-windows/n-tier.md
[ra-vpn]: ../hybrid-networking/vpn.md
[ra-vpn-failover]: ../hybrid-networking/expressroute-vpn-failover.md
[rbac]: /azure/active-directory/role-based-access-control-configure
[rbac-custom-roles]: /azure/active-directory/role-based-access-control-custom-roles
[routing-and-remote-access-service]: https://technet.microsoft.com/library/dd469790(v=ws.11).aspx
[security-principle-of-least-privilege]: https://msdn.microsoft.com/library/hdb58b2f(v=vs.110).aspx#Anchor_1
[udr-overview]: /azure/virtual-network/virtual-networks-udr-overview
[visio-download]: https://archcenter.blob.core.windows.net/cdn/dmz-reference-architectures.vsdx
[wireshark]: https://www.wireshark.org/
[0]: ./images/dmz-private.png "Arquitetura de rede híbrida segura"
