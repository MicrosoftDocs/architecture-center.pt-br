---
title: Implantar o SAP NetWeaver (Windows) para AnyDB em VMs do Azure
titleSuffix: Azure Reference Architectures
description: Práticas comprovadas para executar o SAP S/4HANA em um ambiente Linux no Azure com alta disponibilidade.
author: lbrader
ms.date: 08/03/2018
ms.topic: reference-architecture
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: seodec18, SAP, Windows
ms.openlocfilehash: e866727a40551b60e74fc26878a15a5a48e69cf6
ms.sourcegitcommit: 273e690c0cfabbc3822089c7d8bc743ef41d2b6e
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 02/08/2019
ms.locfileid: "55897619"
---
# <a name="deploy-sap-netweaver-windows-for-anydb-on-azure-virtual-machines"></a><span data-ttu-id="687db-103">Implantar o SAP NetWeaver (Windows) para AnyDB em máquinas virtuais do Azure</span><span class="sxs-lookup"><span data-stu-id="687db-103">Deploy SAP NetWeaver (Windows) for AnyDB on Azure virtual machines</span></span>

<span data-ttu-id="687db-104">Essa arquitetura de referência mostra um conjunto de práticas comprovadas para executar o SAP NetWeaver em um ambiente Windows no Azure com alta disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="687db-104">This reference architecture shows a set of proven practices for running SAP NetWeaver in a Windows environment on Azure with high availability.</span></span> <span data-ttu-id="687db-105">O banco de dados é o AnyDB, o termo da SAP para qualquer DBMS com suporte, além do SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="687db-105">The database is AnyDB, the SAP term for any supported DBMS besides SAP HANA.</span></span> <span data-ttu-id="687db-106">Essa arquitetura é implantada com tamanhos específicos de VM (máquina virtual) que podem ser alterados para acomodar as necessidades da sua organização.</span><span class="sxs-lookup"><span data-stu-id="687db-106">This architecture is deployed with specific virtual machine (VM) sizes that can be changed to accommodate your organization's needs.</span></span>

![Arquitetura de referência para SAP NetWeaver (Windows) para AnyDB em VMs do Azure](./images/sap-netweaver.png)

<span data-ttu-id="687db-108">*Baixe um [Arquivo Visio][visio-download] dessa arquitetura.*</span><span class="sxs-lookup"><span data-stu-id="687db-108">*Download a [Visio file][visio-download] of this architecture.*</span></span>

> [!NOTE]
> <span data-ttu-id="687db-109">Implantar essa arquitetura de referência requer um licenciamento apropriado de produtos SAP e outras tecnologias que não são da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="687db-109">Deploying this reference architecture requires appropriate licensing of SAP products and other non-Microsoft technologies.</span></span>

## <a name="architecture"></a><span data-ttu-id="687db-110">Arquitetura</span><span class="sxs-lookup"><span data-stu-id="687db-110">Architecture</span></span>

<span data-ttu-id="687db-111">A arquitetura consiste na infraestrutura e nos componentes de software principais a seguir.</span><span class="sxs-lookup"><span data-stu-id="687db-111">The architecture consists of the following infrastructure and key software components.</span></span>

<span data-ttu-id="687db-112">**Rede virtual**.</span><span class="sxs-lookup"><span data-stu-id="687db-112">**Virtual network**.</span></span> <span data-ttu-id="687db-113">O serviço da Rede Virtual do Azure conecta com segurança os recursos do Azure entre si.</span><span class="sxs-lookup"><span data-stu-id="687db-113">The Azure Virtual Network service securely connects Azure resources to each other.</span></span> <span data-ttu-id="687db-114">Nessa arquitetura, a rede virtual se conecta a um ambiente local por meio de um gateway VPN implantado no hub de um [hub-spoke](../hybrid-networking/hub-spoke.md).</span><span class="sxs-lookup"><span data-stu-id="687db-114">In this architecture, the virtual network connects to an on-premises environment through a VPN gateway deployed in the hub of a [hub-spoke](../hybrid-networking/hub-spoke.md).</span></span> <span data-ttu-id="687db-115">O spoke é a rede virtual usada para os aplicativos SAP e para a camada de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="687db-115">The spoke is the virtual network used for the SAP applications and database tier.</span></span>

<span data-ttu-id="687db-116">**Sub-redes**.</span><span class="sxs-lookup"><span data-stu-id="687db-116">**Subnets**.</span></span> <span data-ttu-id="687db-117">A rede virtual é subdividida em sub-redes separadas para cada camada: aplicativo (SAP NetWeaver), banco de dados, serviços compartilhados (o jumpbox) e Active Directory.</span><span class="sxs-lookup"><span data-stu-id="687db-117">The virtual network is subdivided into separate subnets for each tier: application (SAP NetWeaver), database, shared services (the jumpbox), and Active Directory.</span></span>

<span data-ttu-id="687db-118">**Máquinas virtuais**.</span><span class="sxs-lookup"><span data-stu-id="687db-118">**Virtual machines**.</span></span> <span data-ttu-id="687db-119">Essa arquitetura usa máquinas virtuais para a camada de aplicativo e a camada de banco de dados, agrupadas da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="687db-119">This architecture uses virtual machines for the application tier and database tier, grouped as follows:</span></span>

- <span data-ttu-id="687db-120">**SAP NetWeaver**.</span><span class="sxs-lookup"><span data-stu-id="687db-120">**SAP NetWeaver**.</span></span> <span data-ttu-id="687db-121">A camada de aplicativo usa máquinas virtuais do Windows e executa os SAP Central Services e servidores de aplicativo SAP.</span><span class="sxs-lookup"><span data-stu-id="687db-121">The application tier uses Windows virtual machines and runs SAP Central Services and SAP application servers.</span></span> <span data-ttu-id="687db-122">As VMs que executam os Central Services são configuradas como um Cluster de Failover do Windows Server para alta disponibilidade, com suporte pelo SIOS DataKeeper Cluster Edition.</span><span class="sxs-lookup"><span data-stu-id="687db-122">The VMs that run Central Services are configured as a Windows Server Failover Cluster for high availability, supported by SIOS DataKeeper Cluster Edition.</span></span>
- <span data-ttu-id="687db-123">**AnyDB**.</span><span class="sxs-lookup"><span data-stu-id="687db-123">**AnyDB**.</span></span> <span data-ttu-id="687db-124">A camada de banco de dados executa o AnyDB como o banco de dados de origem, como Microsoft SQL Server, Oracle ou IBM DB2.</span><span class="sxs-lookup"><span data-stu-id="687db-124">The database tier runs AnyDB as the source database, such as Microsoft SQL Server, Oracle, or IBM DB2.</span></span>
- <span data-ttu-id="687db-125">**Jumpbox**.</span><span class="sxs-lookup"><span data-stu-id="687db-125">**Jumpbox**.</span></span> <span data-ttu-id="687db-126">Também chamada de um host bastião.</span><span class="sxs-lookup"><span data-stu-id="687db-126">Also called a bastion host.</span></span> <span data-ttu-id="687db-127">Essa é uma máquina virtual segura na rede que os administradores usam para se conectar às outras máquinas virtuais.</span><span class="sxs-lookup"><span data-stu-id="687db-127">This is a secure virtual machine on the network that administrators use to connect to the other virtual machines.</span></span>
- <span data-ttu-id="687db-128">**Controladores de domínio do Active Directory do Windows Server**.</span><span class="sxs-lookup"><span data-stu-id="687db-128">**Windows Server Active Directory domain controllers**.</span></span> <span data-ttu-id="687db-129">Os controladores de domínio são usados em todas as máquinas virtuais e usuários do domínio.</span><span class="sxs-lookup"><span data-stu-id="687db-129">The domain controllers are used on all VMs and users in the domain.</span></span>

<span data-ttu-id="687db-130">**Balanceadores de carga**.</span><span class="sxs-lookup"><span data-stu-id="687db-130">**Load balancers**.</span></span> <span data-ttu-id="687db-131">As instâncias do [Azure Load Balancer](/azure/load-balancer/load-balancer-overview) são usadas para distribuir o tráfego para as máquinas virtuais na sub-rede de camada do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="687db-131">[Azure Load Balancer](/azure/load-balancer/load-balancer-overview) instances are used to distribute traffic to virtual machines in the application tier subnet.</span></span> <span data-ttu-id="687db-132">Na camada de dados, a alta disponibilidade pode ser obtida usando balanceadores de carga SAP internos, o Azure Load Balancer ou outros mecanismos, dependendo do DBMS.</span><span class="sxs-lookup"><span data-stu-id="687db-132">At the data tier, high availability may be achieved using built-in SAP load balancers, Azure Load Balancer, or other mechanisms, depending on the DBMS.</span></span> <span data-ttu-id="687db-133">Para obter mais informações, consulte [Implantação de DBMS das Máquinas Virtuais do Azure para SAP NetWeaver](/azure/virtual-machines/workloads/sap/dbms-guide).</span><span class="sxs-lookup"><span data-stu-id="687db-133">For more information, see [Azure Virtual Machines DBMS deployment for SAP NetWeaver](/azure/virtual-machines/workloads/sap/dbms-guide).</span></span>

<span data-ttu-id="687db-134">**Conjuntos de disponibilidade**.</span><span class="sxs-lookup"><span data-stu-id="687db-134">**Availability sets**.</span></span> <span data-ttu-id="687db-135">As máquinas virtuais para funções do SAP Web Dispatcher, servidor de aplicativos SAP e (A)SCS são agrupadas em [conjuntos de disponibilidades](/azure/virtual-machines/windows/tutorial-availability-sets) separados, e pelo menos duas máquinas virtuais são provisionadas por função.</span><span class="sxs-lookup"><span data-stu-id="687db-135">Virtual machines for the SAP Web Dispatcher, SAP application server, and (A)SCS, roles are grouped into separate [availability sets](/azure/virtual-machines/windows/tutorial-availability-sets), and at least two virtual machines are provisioned per role.</span></span> <span data-ttu-id="687db-136">Isso torna as máquinas virtuais qualificadas para um [SLA (Contrato de Nível de Serviço)](https://azure.microsoft.com/support/legal/sla/virtual-machines) mais elevado.</span><span class="sxs-lookup"><span data-stu-id="687db-136">This makes the virtual machines eligible for a higher [service level agreement](https://azure.microsoft.com/support/legal/sla/virtual-machines) (SLA).</span></span>

<span data-ttu-id="687db-137">**NICs**.</span><span class="sxs-lookup"><span data-stu-id="687db-137">**NICs**.</span></span> <span data-ttu-id="687db-138">Os [cartões de interface de rede](/azure/virtual-network/virtual-network-network-interface) (NICs) permitem toda a comunicação de máquinas virtuais em uma rede virtual.</span><span class="sxs-lookup"><span data-stu-id="687db-138">[Network interface cards](/azure/virtual-network/virtual-network-network-interface) (NICs) enable all communication of virtual machines on a virtual network.</span></span>

<span data-ttu-id="687db-139">**Grupos de segurança de rede**.</span><span class="sxs-lookup"><span data-stu-id="687db-139">**Network security groups**.</span></span> <span data-ttu-id="687db-140">Para restringir o tráfego de entrada, saída e dentro da sub-rede na rede virtual, é possível criar [NSGs (grupos de segurança de rede)](/azure/virtual-network/virtual-networks-nsg).</span><span class="sxs-lookup"><span data-stu-id="687db-140">To restrict incoming, outgoing, and intra-subnet traffic in the virtual network, you can create [network security groups](/azure/virtual-network/virtual-networks-nsg) (NSGs).</span></span>

<span data-ttu-id="687db-141">**Gateway**.</span><span class="sxs-lookup"><span data-stu-id="687db-141">**Gateway**.</span></span> <span data-ttu-id="687db-142">Um gateway estende sua rede local para a rede virtual do Azure.</span><span class="sxs-lookup"><span data-stu-id="687db-142">A gateway extends your on-premises network to the Azure virtual network.</span></span> <span data-ttu-id="687db-143">O [ExpressRoute](/azure/architecture/reference-architectures/hybrid-networking/expressroute) é o serviço do Azure recomendado para criar conexões privadas que não passem pela Internet pública, mas uma conexão [Site a Site](/azure/vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal) também pode ser usada.</span><span class="sxs-lookup"><span data-stu-id="687db-143">[ExpressRoute](/azure/architecture/reference-architectures/hybrid-networking/expressroute) is the recommended Azure service for creating private connections that do not go over the public Internet, but a [Site-to-Site](/azure/vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal) connection can also be used.</span></span>

<span data-ttu-id="687db-144">**Armazenamento do Azure**.</span><span class="sxs-lookup"><span data-stu-id="687db-144">**Azure Storage**.</span></span> <span data-ttu-id="687db-145">Para fornecer um armazenamento persistente de um VHD (disco rígido virtual) de uma máquina virtual, é necessário o [Armazenamento do Azure](/azure/storage/storage-standard-storage).</span><span class="sxs-lookup"><span data-stu-id="687db-145">To provide persistent storage of a virtual machine's virtual hard disk (VHD), [Azure Storage](/azure/storage/storage-standard-storage) is required.</span></span> <span data-ttu-id="687db-146">Ele também é usado por [Testemunha de nuvem](/windows-server/failover-clustering/deploy-cloud-witness) para implementar uma operação de cluster de failover.</span><span class="sxs-lookup"><span data-stu-id="687db-146">It is also used by [Cloud Witness](/windows-server/failover-clustering/deploy-cloud-witness) to implement a failover cluster operation.</span></span>

## <a name="recommendations"></a><span data-ttu-id="687db-147">Recomendações</span><span class="sxs-lookup"><span data-stu-id="687db-147">Recommendations</span></span>

<span data-ttu-id="687db-148">Seus requisitos podem ser diferentes dos requisitos da arquitetura descrita aqui.</span><span class="sxs-lookup"><span data-stu-id="687db-148">Your requirements might differ from the architecture described here.</span></span> <span data-ttu-id="687db-149">Use essas recomendações como ponto de partida.</span><span class="sxs-lookup"><span data-stu-id="687db-149">Use these recommendations as a starting point.</span></span>

### <a name="sap-web-dispatcher-pool"></a><span data-ttu-id="687db-150">Pool do SAP Web Dispatcher</span><span class="sxs-lookup"><span data-stu-id="687db-150">SAP Web Dispatcher pool</span></span>

<span data-ttu-id="687db-151">O componente Web Dispatcher é usado como um balanceador de carga para tráfego da SAP entre os servidores de aplicativos SAP.</span><span class="sxs-lookup"><span data-stu-id="687db-151">The Web Dispatcher component is used as a load balancer for SAP traffic among the SAP application servers.</span></span> <span data-ttu-id="687db-152">Para obter a alta disponibilidade para o componente Web Dispatcher, o Azure Load Balancer é usado para implementar a configuração paralela do Web Dispatcher.</span><span class="sxs-lookup"><span data-stu-id="687db-152">To achieve high availability for the Web Dispatcher component, Azure Load Balancer is used to implement the parallel Web Dispatcher setup.</span></span> <span data-ttu-id="687db-153">O Web Dispatcher usa uma configuração de round robin para distribuição de tráfego HTTP(S) entre os Web Dispatchers disponíveis no pool de balanceadores.</span><span class="sxs-lookup"><span data-stu-id="687db-153">Web Dispatcher uses in a round-robin configuration for HTTP(S) traffic distribution among the available Web Dispatchers in the balancers pool.</span></span>

<span data-ttu-id="687db-154">Para obter detalhes sobre o SAP NetWeaver em VMs do Azure, confira [Planejamento e implementação de Máquinas Virtuais do Azure para SAP NetWeaver](/azure/virtual-machines/workloads/sap/planning-guide).</span><span class="sxs-lookup"><span data-stu-id="687db-154">For details about running SAP NetWeaver in Azure VMs, see [Azure Virtual Machines planning and implementation for SAP NetWeaver](/azure/virtual-machines/workloads/sap/planning-guide).</span></span>

### <a name="application-servers-pool"></a><span data-ttu-id="687db-155">Pool de servidores de aplicativos</span><span class="sxs-lookup"><span data-stu-id="687db-155">Application servers pool</span></span>

<span data-ttu-id="687db-156">Para gerenciar grupos de logon para servidores de aplicativos ABAP, é usada a transação SMLG.</span><span class="sxs-lookup"><span data-stu-id="687db-156">To manage logon groups for ABAP application servers, the SMLG transaction is used.</span></span> <span data-ttu-id="687db-157">Ela usa a função de balanceamento de carga no servidor de mensagens do Central Services para distribuir a carga de trabalho entre o pool de servidores de aplicativos SAP para o tráfego de SAPGUIs e RFC.</span><span class="sxs-lookup"><span data-stu-id="687db-157">It uses the load balancing function within the message server of the Central Services to distribute workload among SAP application servers pool for SAPGUIs and RFC traffic.</span></span> <span data-ttu-id="687db-158">A conexão do servidor de aplicativos para o Central Services altamente disponível é feita através do nome de rede virtual do cluster.</span><span class="sxs-lookup"><span data-stu-id="687db-158">The application server connection to the highly available Central Services is through the cluster virtual network name.</span></span>

### <a name="sap-central-services-cluster"></a><span data-ttu-id="687db-159">Cluster do SAP Central Services</span><span class="sxs-lookup"><span data-stu-id="687db-159">SAP Central Services cluster</span></span>

<span data-ttu-id="687db-160">Essa arquitetura de referência executa o Central Services em VMs na camada de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="687db-160">This reference architecture runs Central Services on VMs in the application tier.</span></span> <span data-ttu-id="687db-161">O Central Services é um SPOF (ponto único de falha) potencial quando implantado em uma única VM — uma implantação típica quando a alta disponibilidade não é um requisito.</span><span class="sxs-lookup"><span data-stu-id="687db-161">The Central Services is a potential single point of failure (SPOF) when deployed to a single VM—typical deployment when high availability is not a requirement.</span></span> <span data-ttu-id="687db-162">Para implementar uma solução de alta disponibilidade, pode ser usado um cluster de disco compartilhado ou um cluster de compartilhamento de arquivos.</span><span class="sxs-lookup"><span data-stu-id="687db-162">To implement a high availability solution, either a shared disk cluster or a file share cluster can be used.</span></span>

<span data-ttu-id="687db-163">Para configurar VMs para um cluster de disco compartilhado, use [Cluster de Failover do Windows Server](https://blogs.sap.com/2018/01/25/how-to-create-sap-resources-in-windows-failover-cluster/).</span><span class="sxs-lookup"><span data-stu-id="687db-163">To configure VMs for a shared disk cluster, use [Windows Server Failover Cluster](https://blogs.sap.com/2018/01/25/how-to-create-sap-resources-in-windows-failover-cluster/).</span></span> <span data-ttu-id="687db-164">A [Testemunha de nuvem](/windows-server/failover-clustering/deploy-cloud-witness) é recomendada como uma testemunha de quorum.</span><span class="sxs-lookup"><span data-stu-id="687db-164">[Cloud Witness](/windows-server/failover-clustering/deploy-cloud-witness) is recommended as a quorum witness.</span></span> <span data-ttu-id="687db-165">Para dar suporte ao ambiente de cluster de failover, a [SIOS DataKeeper Cluster Edition](https://azuremarketplace.microsoft.com/marketplace/apps/sios_datakeeper.sios-datakeeper-8) executa a função de volume de cluster compartilhado replicando discos independentes pertencentes a nós de cluster.</span><span class="sxs-lookup"><span data-stu-id="687db-165">To support the failover cluster environment, [SIOS DataKeeper Cluster Edition](https://azuremarketplace.microsoft.com/marketplace/apps/sios_datakeeper.sios-datakeeper-8) performs the cluster shared volume function by replicating independent disks owned by the cluster nodes.</span></span> <span data-ttu-id="687db-166">O Azure não oferece suporte a discos compartilhados e, portanto, requer soluções fornecidas pelo SIOS.</span><span class="sxs-lookup"><span data-stu-id="687db-166">Azure does not natively support shared disks and therefore requires solutions provided by SIOS.</span></span>

<span data-ttu-id="687db-167">Para obter detalhes, consulte “3.</span><span class="sxs-lookup"><span data-stu-id="687db-167">For details, see "3.</span></span> <span data-ttu-id="687db-168">Atualização importante para o clientes SAP que executam o ASCS no SIOS no Azure” em [Execução de aplicativos SAP na plataforma Microsoft](https://blogs.msdn.microsoft.com/saponsqlserver/2017/05/04/sap-on-azure-general-update-for-customers-partners-april-2017/).</span><span class="sxs-lookup"><span data-stu-id="687db-168">Important Update for SAP Customers Running ASCS on SIOS on Azure” at [Running SAP applications on the Microsoft platform](https://blogs.msdn.microsoft.com/saponsqlserver/2017/05/04/sap-on-azure-general-update-for-customers-partners-april-2017/).</span></span>

<span data-ttu-id="687db-169">Outra maneira de lidar com o clustering é implementando um cluster de compartilhamento de arquivos usando o Cluster de Failover do Windows Server.</span><span class="sxs-lookup"><span data-stu-id="687db-169">Another way to handle clustering is to implement a file share cluster using Windows Server Failover Cluster.</span></span> <span data-ttu-id="687db-170">Recentemente, a [SAP](https://blogs.sap.com/2018/03/19/migration-from-a-shared-disk-cluster-to-a-file-share-cluster/) modificou o padrão de implantação do Central Services para acessar os diretórios globais /sapmnt por meio de um caminho UNC.</span><span class="sxs-lookup"><span data-stu-id="687db-170">[SAP](https://blogs.sap.com/2018/03/19/migration-from-a-shared-disk-cluster-to-a-file-share-cluster/) recently modified the Central Services deployment pattern to access the /sapmnt global directories via a UNC path.</span></span> <span data-ttu-id="687db-171">Essa alteração [remove o requisito](https://blogs.msdn.microsoft.com/saponsqlserver/2017/08/10/high-available-ascs-for-windows-on-file-share-shared-disk-no-longer-required/) para SIOS ou outras soluções compartilhadas de disco nas VMs do Central Services.</span><span class="sxs-lookup"><span data-stu-id="687db-171">This change [removes the requirement](https://blogs.msdn.microsoft.com/saponsqlserver/2017/08/10/high-available-ascs-for-windows-on-file-share-shared-disk-no-longer-required/) for SIOS or other shared disk solutions on the Central Services VMs.</span></span> <span data-ttu-id="687db-172">Ainda é recomendável garantir que o compartilhamento do UNC /sapmnt seja [altamente disponível](https://blogs.sap.com/2017/07/21/how-to-create-a-high-available-sapmnt-share/).</span><span class="sxs-lookup"><span data-stu-id="687db-172">It is still recommended to ensure that the /sapmnt UNC share is [highly available](https://blogs.sap.com/2017/07/21/how-to-create-a-high-available-sapmnt-share/).</span></span> <span data-ttu-id="687db-173">Isso pode ser feito na instância do Central Services usando um Cluster de Failover do Windows Server com [SOFS (Servidor de Arquivos de Escalabilidade Horizontal)](https://blogs.msdn.microsoft.com/saponsqlserver/2017/11/14/file-server-with-sofs-and-s2d-as-an-alternative-to-cluster-shared-disk-for-clustering-of-an-sap-ascs-instance-in-azure-is-generally-available/) e o recurso [S2D (Espaços de Armazenamento Diretos)](https://blogs.sap.com/2018/03/07/your-sap-on-azure-part-5-ascs-high-availability-with-storage-spaces-direct/) no Windows Server 2016.</span><span class="sxs-lookup"><span data-stu-id="687db-173">This can be done on the Central Services instance by using Windows Server Failover Cluster with [Scale Out File Server](https://blogs.msdn.microsoft.com/saponsqlserver/2017/11/14/file-server-with-sofs-and-s2d-as-an-alternative-to-cluster-shared-disk-for-clustering-of-an-sap-ascs-instance-in-azure-is-generally-available/) (SOFS) and the [Storage Spaces Direct](https://blogs.sap.com/2018/03/07/your-sap-on-azure-part-5-ascs-high-availability-with-storage-spaces-direct/) (S2D) feature in Windows Server 2016.</span></span>

### <a name="availability-sets"></a><span data-ttu-id="687db-174">Conjuntos de disponibilidade</span><span class="sxs-lookup"><span data-stu-id="687db-174">Availability sets</span></span>

<span data-ttu-id="687db-175">Os conjuntos de disponibilidade distribuem os servidores a diferentes grupos de infraestrutura e atualizam grupos para melhorar a disponibilidade de serviço.</span><span class="sxs-lookup"><span data-stu-id="687db-175">Availability sets distribute servers to different physical infrastructure and update groups to improve service availability.</span></span> <span data-ttu-id="687db-176">Use máquinas virtuais que executem a mesma função em conjuntos de disponibilidade para ajudar a proteger contra o tempo de inatividade causado por uma manutenção da infraestrutura do Azure e para atender às [SLAs](https://azure.microsoft.com/support/legal/sla/virtual-machines).</span><span class="sxs-lookup"><span data-stu-id="687db-176">Put virtual machines that perform the same role into an availability sets to help guard against downtime caused by Azure infrastructure maintenance and to meet [SLAs](https://azure.microsoft.com/support/legal/sla/virtual-machines) (SLAs).</span></span> <span data-ttu-id="687db-177">É recomendável ter duas ou mais máquinas virtuais por conjunto de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="687db-177">Two or more virtual machines per availability set is recommended.</span></span>

<span data-ttu-id="687db-178">Todas as máquinas virtuais em um conjunto devem executar a mesma função.</span><span class="sxs-lookup"><span data-stu-id="687db-178">All virtual machines in a set must perform the same role.</span></span> <span data-ttu-id="687db-179">Não misture servidores de funções diferentes no mesmo conjunto de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="687db-179">Do not mix servers of different roles in the same availability set.</span></span> <span data-ttu-id="687db-180">Por exemplo, não coloque um nó do Central Services no mesmo conjunto de disponibilidade com o servidor de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="687db-180">For example, don't place a Central Services node in the same availability set with the application server.</span></span>

### <a name="nics"></a><span data-ttu-id="687db-181">NICs</span><span class="sxs-lookup"><span data-stu-id="687db-181">NICs</span></span>

<span data-ttu-id="687db-182">Implantações tradicionais locais da SAP implementam vários NICs (Cartões de interface de rede) por computador para separar o tráfego administrativo do tráfego de negócios.</span><span class="sxs-lookup"><span data-stu-id="687db-182">Traditional on-premises SAP deployments implement multiple network interface cards (NICs) per machine to segregate administrative traffic from business traffic.</span></span> <span data-ttu-id="687db-183">No Azure, a rede virtual é uma rede definida pelo software que envia todo o tráfego pela mesma malha de rede.</span><span class="sxs-lookup"><span data-stu-id="687db-183">On Azure, the virtual network is a software-defined network that sends all traffic through the same network fabric.</span></span> <span data-ttu-id="687db-184">Portanto, é desnecessário o uso de vários NICs.</span><span class="sxs-lookup"><span data-stu-id="687db-184">Therefore, the use of multiple NICs is unnecessary.</span></span> <span data-ttu-id="687db-185">No entanto, se sua organização precisar separar o tráfego, você pode implantar vários NICs por VM, conectar cada NIC a uma sub-rede diferente e, então, usar os NSGs para impor diferentes políticas de controle de acesso.</span><span class="sxs-lookup"><span data-stu-id="687db-185">However, if your organization needs to segregate traffic, you can deploy multiple NICs per VM, connect each NIC to a different subnet, and then use NSGs to enforce different access control policies.</span></span>

### <a name="subnets-and-nsgs"></a><span data-ttu-id="687db-186">Sub-redes e NSGs</span><span class="sxs-lookup"><span data-stu-id="687db-186">Subnets and NSGs</span></span>

<span data-ttu-id="687db-187">Essa arquitetura subdivide o espaço de endereço da rede virtual em sub-redes.</span><span class="sxs-lookup"><span data-stu-id="687db-187">This architecture subdivides the virtual network address space into subnets.</span></span> <span data-ttu-id="687db-188">Essa arquitetura de referência se concentra principalmente na sub-rede da camada de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="687db-188">This reference architecture focuses primarily on the application tier subnet.</span></span> <span data-ttu-id="687db-189">Cada sub-rede pode ser associada a um NSG que define as políticas de acesso para a sub-rede.</span><span class="sxs-lookup"><span data-stu-id="687db-189">Each subnet can be associated with a NSG that defines the access policies for the subnet.</span></span> <span data-ttu-id="687db-190">Coloque os servidores de aplicativos em uma sub-rede separada para poder protegê-los mais facilmente por meio do gerenciamento das políticas de segurança de sub-rede, não dos servidores individuais.</span><span class="sxs-lookup"><span data-stu-id="687db-190">Place application servers on a separate subnet so you can secure them more easily by managing the subnet security policies, not the individual servers.</span></span>

<span data-ttu-id="687db-191">Quando um NSG está associado a uma sub-rede, ele se aplica a todos os servidores dentro dessa sub-rede.</span><span class="sxs-lookup"><span data-stu-id="687db-191">When a NSG is associated with a subnet, it applies to all the servers within the subnet.</span></span> <span data-ttu-id="687db-192">Para saber mais sobre como usar os NSGs para um controle refinado sobre os servidores em uma sub-rede, veja [Filtrar o tráfego de rede com os grupos de segurança de rede](https://azure.microsoft.com/blog/multiple-vm-nics-and-network-virtual-appliances-in-azure).</span><span class="sxs-lookup"><span data-stu-id="687db-192">For more information about using NSGs for fine-grained control over the servers in a subnet, see [Filter network traffic with network security groups](https://azure.microsoft.com/blog/multiple-vm-nics-and-network-virtual-appliances-in-azure).</span></span>

### <a name="load-balancers"></a><span data-ttu-id="687db-193">Balanceadores de carga</span><span class="sxs-lookup"><span data-stu-id="687db-193">Load balancers</span></span>

<span data-ttu-id="687db-194">O [SAP Web Dispatcher](https://help.sap.com/doc/saphelp_nw73ehp1/7.31.19/en-US/48/8fe37933114e6fe10000000a421937/frameset.htm) lida com o balanceamento de carga do tráfego HTTP(S) a um pool de servidores de aplicativos SAP.</span><span class="sxs-lookup"><span data-stu-id="687db-194">[SAP Web Dispatcher](https://help.sap.com/doc/saphelp_nw73ehp1/7.31.19/en-US/48/8fe37933114e6fe10000000a421937/frameset.htm) handles load balancing of HTTP(S) traffic to a pool of SAP application servers.</span></span>

<span data-ttu-id="687db-195">Para o tráfego de clientes do SAP GUI se conectando a um servidor SAP via protocolo DIAG ou RFC (Remote Function Calls), o servidor de mensagens do Central Services faz o balanceamento da carga por meio de [grupos de logon](https://wiki.scn.sap.com/wiki/display/SI/ABAP+Logon+Group+based+Load+Balancing) do servidor de aplicativos SAP, não sendo necessário nenhum balanceador de carga adicional.</span><span class="sxs-lookup"><span data-stu-id="687db-195">For traffic from SAP GUI clients connecting a SAP server via DIAG protocol or Remote Function Calls (RFC), the Central Services message server balances the load through SAP application server [logon groups](https://wiki.scn.sap.com/wiki/display/SI/ABAP+Logon+Group+based+Load+Balancing), so no additional load balancer is needed.</span></span>

### <a name="azure-storage"></a><span data-ttu-id="687db-196">Armazenamento do Azure</span><span class="sxs-lookup"><span data-stu-id="687db-196">Azure Storage</span></span>

<span data-ttu-id="687db-197">É recomendável usar o Armazenamento Premium do Azure para latência de leitura/gravação consistente em todas as máquinas virtuais do servidor de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="687db-197">For all database server virtual machines, we recommend using Azure Premium Storage for consistent read/write latency.</span></span> <span data-ttu-id="687db-198">Para qualquer máquina virtual de instância única usando o Armazenamento Premium em todos os discos do sistema operacional e discos de dados, consulte [SLA para máquinas virtuais](https://azure.microsoft.com/support/legal/sla/virtual-machines).</span><span class="sxs-lookup"><span data-stu-id="687db-198">For any single instance virtual machine using Premium Storage for all operating system disks and data disks, see [SLA for Virtual Machines](https://azure.microsoft.com/support/legal/sla/virtual-machines).</span></span> <span data-ttu-id="687db-199">Além disso, para sistemas SAP de produção, é recomendável usar o [Azure Managed Disks](/azure/storage/storage-managed-disks-overview) Premium em todos os casos.</span><span class="sxs-lookup"><span data-stu-id="687db-199">Also, for production SAP systems, we recommend using Premium [Azure Managed Disks](/azure/storage/storage-managed-disks-overview) in all cases.</span></span> <span data-ttu-id="687db-200">Para fins de confiabilidade, os Managed Disks são usados para gerenciar os arquivos VHD dos discos.</span><span class="sxs-lookup"><span data-stu-id="687db-200">For reliability, Managed Disks are used to manage the VHD files for the disks.</span></span> <span data-ttu-id="687db-201">Os discos gerenciados garantem que os discos para máquinas virtuais dentro de um conjunto de disponibilidade fiquem isolados para evitar pontos únicos de falha.</span><span class="sxs-lookup"><span data-stu-id="687db-201">Managed disks ensure that the disks for virtual machines within an availability set are isolated to avoid single points of failure.</span></span>

<span data-ttu-id="687db-202">Para servidores de aplicativos SAP, incluindo as máquinas virtuais do Central Services, é possível usar o Armazenamento Padrão do Azure para reduzir os custos, uma vez que a execução do aplicativo ocorre na memória e os discos são usados somente para registro em log.</span><span class="sxs-lookup"><span data-stu-id="687db-202">For SAP application servers, including the Central Services virtual machines, you can use Azure Standard Storage to reduce cost, because application execution takes place in memory and disks are used for logging only.</span></span> <span data-ttu-id="687db-203">No entanto, neste momento, o Armazenamento Padrão só está certificado para armazenamento não gerenciado.</span><span class="sxs-lookup"><span data-stu-id="687db-203">However, at this time, Standard Storage is only certified for unmanaged storage.</span></span> <span data-ttu-id="687db-204">Uma vez que os servidores de aplicativos não hospedam nenhum dado, também é possível usar os discos menores de Armazenamento Premium P4 e P6 para ajudar a minimizar o custo.</span><span class="sxs-lookup"><span data-stu-id="687db-204">Since application servers do not host any data, you can also use the smaller P4 and P6 Premium Storage disks to help minimize cost.</span></span>

<span data-ttu-id="687db-205">O Armazenamento do Azure também é usado pela [Testemunha de nuvem](/windows-server/failover-clustering/deploy-cloud-witness) para manter o quorum com um dispositivo em uma região remota do Azure longe da região primária em que reside o cluster.</span><span class="sxs-lookup"><span data-stu-id="687db-205">Azure Storage is also used by [Cloud Witness](/windows-server/failover-clustering/deploy-cloud-witness) to maintain quorum with a device in a remote Azure region away from the primary region where the cluster resides.</span></span>

<span data-ttu-id="687db-206">Para o repositório de dados de backup, é recomendável usar a [camada de acesso esporádico](/azure/storage/storage-blob-storage-tiers) do Azure e o [armazenamento da camada de acesso de arquivos](/azure/storage/storage-blob-storage-tiers).</span><span class="sxs-lookup"><span data-stu-id="687db-206">For the backup data store, we recommend using Azure [coolaccess tier](/azure/storage/storage-blob-storage-tiers) and [archive access tier storage](/azure/storage/storage-blob-storage-tiers).</span></span> <span data-ttu-id="687db-207">Essas camadas de armazenamento são maneiras econômicas para armazenar dados de longa vida útil que são acessados com pouca frequência.</span><span class="sxs-lookup"><span data-stu-id="687db-207">These storage tiers are cost-effective ways to store long-lived data that is infrequently accessed.</span></span>

## <a name="performance-considerations"></a><span data-ttu-id="687db-208">Considerações sobre o desempenho</span><span class="sxs-lookup"><span data-stu-id="687db-208">Performance considerations</span></span>

<span data-ttu-id="687db-209">Os servidores de aplicativos SAP realizam constantes comunicações com os servidores de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="687db-209">SAP application servers carry on constant communications with the database servers.</span></span> <span data-ttu-id="687db-210">Para aplicativos com desempenho essencial sendo executados em quaisquer plataformas de banco de dados, incluindo o SAP HANA, cogite habilitar o [Acelerador de gravação](/azure/virtual-machines/linux/how-to-enable-write-accelerator) para melhorar a latência de gravação de log.</span><span class="sxs-lookup"><span data-stu-id="687db-210">For performance-critical applications running on any database platforms, including SAP HANA, consider enabling [Write Accelerator](/azure/virtual-machines/linux/how-to-enable-write-accelerator) to improve log write latency.</span></span> <span data-ttu-id="687db-211">Para otimizar as comunicações entre servidores, use a [Rede Acelerada](https://azure.microsoft.com/blog/linux-and-windows-networking-performance-enhancements-accelerated-networking/).</span><span class="sxs-lookup"><span data-stu-id="687db-211">To optimize inter-server communications, use the [Accelerated Network](https://azure.microsoft.com/blog/linux-and-windows-networking-performance-enhancements-accelerated-networking/).</span></span> <span data-ttu-id="687db-212">Observe que esses aceleradores estão disponíveis apenas para determinadas séries de VM.</span><span class="sxs-lookup"><span data-stu-id="687db-212">Note that these accelerators are available only for certain VM series.</span></span>

<span data-ttu-id="687db-213">Para obter altas IOPS e taxas de transferências de largura de banda de disco, as práticas comuns na [otimização de desempenho](/azure/virtual-machines/windows/premium-storage-performance) do volume de armazenamento se aplicam ao layout de armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="687db-213">To achieve high IOPS and disk bandwidth throughput, the common practices in storage volume [performance optimization](/azure/virtual-machines/windows/premium-storage-performance) apply to Azure storage layout.</span></span> <span data-ttu-id="687db-214">Por exemplo, a combinação de vários discos em conjunto para criar um volume de discos distribuídos melhora o desempenho de E/S.</span><span class="sxs-lookup"><span data-stu-id="687db-214">For example, combining multiple disks together to create a striped disk volume improves IO performance.</span></span> <span data-ttu-id="687db-215">Habilitar o cache de leitura do conteúdo de armazenamento que raramente é alterado melhora a velocidade de recuperação de dados.</span><span class="sxs-lookup"><span data-stu-id="687db-215">Enabling the read cache on storage content that changes infrequently enhances the speed of data retrieval.</span></span>

<span data-ttu-id="687db-216">Para SAP no SQL, o blog [As 10 principais considerações para a implantação de aplicativos SAP no Azure](https://blogs.msdn.microsoft.com/saponsqlserver/2015/05/25/top-10-key-considerations-for-deploying-sap-applications-on-azure/) oferece excelentes conselhos sobre como otimizar o armazenamento do Azure para cargas de trabalho da SAP no SQL Server.</span><span class="sxs-lookup"><span data-stu-id="687db-216">For SAP on SQL, the [Top 10 Key Considerations for Deploying SAP Applications on Azure](https://blogs.msdn.microsoft.com/saponsqlserver/2015/05/25/top-10-key-considerations-for-deploying-sap-applications-on-azure/) blog offers excellent advice on optimizing Azure storage for SAP workloads on SQL Server.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="687db-217">Considerações sobre escalabilidade</span><span class="sxs-lookup"><span data-stu-id="687db-217">Scalability considerations</span></span>

<span data-ttu-id="687db-218">Na camada de aplicativo SAP, o Azure oferece uma ampla variedade de tamanhos de máquina virtual para escalar vertical ou horizontalmente. Para obter uma lista inclusiva, confira a [Nota SAP 1928533](https://launchpad.support.sap.com/#/notes/1928533) - Aplicativos SAP no Azure: Produtos e tipos de VM do Azure com suporte.</span><span class="sxs-lookup"><span data-stu-id="687db-218">At the SAP application layer, Azure offers a wide range of virtual machine sizes for scaling up and scaling out. For an inclusive list, see [SAP note 1928533](https://launchpad.support.sap.com/#/notes/1928533) - SAP Applications on Azure: Supported Products and Azure VM Types.</span></span> <span data-ttu-id="687db-219">(Uma conta do SAP Service Marketplace é necessária para o acesso.)</span><span class="sxs-lookup"><span data-stu-id="687db-219">(SAP Service Marketplace account required for access).</span></span> <span data-ttu-id="687db-220">Servidores de aplicativos SAP e os clusters do Central Services podem ser escalado ou reduzido verticalmente com a adição de mais instâncias.</span><span class="sxs-lookup"><span data-stu-id="687db-220">SAP application servers and the Central Services clusters can scale up/down or scale out by adding more instances.</span></span> <span data-ttu-id="687db-221">O banco de dados AnyDB pode ser escalado ou reduzido verticalmente, mas não escalado horizontalmente. O contêiner do banco de dados SAP para AnyDB não oferece suporte para fragmentação.</span><span class="sxs-lookup"><span data-stu-id="687db-221">The AnyDB database can scale up/down but does not scale out. The SAP database container for AnyDB does not support sharding.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="687db-222">Considerações sobre disponibilidade</span><span class="sxs-lookup"><span data-stu-id="687db-222">Availability considerations</span></span>

<span data-ttu-id="687db-223">A redundância de recursos é o tema geral em soluções de infraestrutura altamente disponíveis.</span><span class="sxs-lookup"><span data-stu-id="687db-223">Resource redundancy is the general theme in highly available infrastructure solutions.</span></span> <span data-ttu-id="687db-224">Para empresas que contam com um SLA menos rigoroso, as máquinas virtuais de instância única do Azure oferecem um SLA de tempo de atividade.</span><span class="sxs-lookup"><span data-stu-id="687db-224">For enterprises that have a less stringent SLA, single-instance Azure VMs offer an uptime SLA.</span></span> <span data-ttu-id="687db-225">Para obter mais informações, confira [Contrato de Nível de Serviço do Azure](https://azure.microsoft.com/support/legal/sla/).</span><span class="sxs-lookup"><span data-stu-id="687db-225">For more information, see [Azure Service Level Agreement](https://azure.microsoft.com/support/legal/sla/).</span></span>

<span data-ttu-id="687db-226">Nessa instalação distribuída do aplicativo SAP, a instalação básica é replicada para obter a alta disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="687db-226">In this distributed installation of the SAP application, the base installation is replicated to achieve high availability.</span></span> <span data-ttu-id="687db-227">O design de alta disponibilidade varia para cada camada da arquitetura.</span><span class="sxs-lookup"><span data-stu-id="687db-227">For each layer of the architecture, the high availability design varies.</span></span>

### <a name="application-tier"></a><span data-ttu-id="687db-228">Camada de aplicativo</span><span class="sxs-lookup"><span data-stu-id="687db-228">Application tier</span></span>

<span data-ttu-id="687db-229">A alta disponibilidade do SAP Web Dispatcher é alcançada com instâncias redundantes.</span><span class="sxs-lookup"><span data-stu-id="687db-229">High availability for SAP Web Dispatcher is achieved with redundant instances.</span></span> <span data-ttu-id="687db-230">Consulte [SAP Web Dispatcher](https://help.sap.com/doc/saphelp_nw70ehp2/7.02.16/en-us/48/8fe37933114e6fe10000000a421937/frameset.htm) na documentação da SAP.</span><span class="sxs-lookup"><span data-stu-id="687db-230">See [SAP Web Dispatcher](https://help.sap.com/doc/saphelp_nw70ehp2/7.02.16/en-us/48/8fe37933114e6fe10000000a421937/frameset.htm) in the SAP Documentation.</span></span>

<span data-ttu-id="687db-231">A alta disponibilidade do Central Services é implementada com o Cluster de Failover do Windows Server.</span><span class="sxs-lookup"><span data-stu-id="687db-231">High availability of the Central Services is implemented with Windows Server Failover Cluster.</span></span> <span data-ttu-id="687db-232">Quando implantado no Azure, o armazenamento de cluster para o cluster de failover pode ser configurado usando duas abordagens: um volume compartilhado do cluster ou um compartilhamento de arquivos.</span><span class="sxs-lookup"><span data-stu-id="687db-232">When deployed on Azure, the cluster storage for the failover cluster can be configured using two approaches: either a clustered shared volume or a file share.</span></span>

<span data-ttu-id="687db-233">Uma vez que discos compartilhados não são possíveis no Azure, é usado o SIOS Datakeeper para replicar o conteúdo de discos independentes anexados a nós do cluster e para abstrair as unidades como um cluster de volume compartilhado para o gerenciador de cluster.</span><span class="sxs-lookup"><span data-stu-id="687db-233">Since shared disks are not possible on Azure, SIOS Datakeeper is used to replicate the content of independent disks attached to the cluster nodes and to abstract the drives as a cluster shared volume for the cluster manager.</span></span> <span data-ttu-id="687db-234">Para obter detalhes de implementação, consulte [Clustering do SAP ASCS no Azure](https://blogs.msdn.microsoft.com/saponsqlserver/2015/05/20/clustering-sap-ascs-instance-using-windows-server-failover-cluster-on-microsoft-azure-with-sios-datakeeper-and-azure-internal-load-balancer/).</span><span class="sxs-lookup"><span data-stu-id="687db-234">For implementation details, see [Clustering SAP ASCS on Azure](https://blogs.msdn.microsoft.com/saponsqlserver/2015/05/20/clustering-sap-ascs-instance-using-windows-server-failover-cluster-on-microsoft-azure-with-sios-datakeeper-and-azure-internal-load-balancer/).</span></span>

<span data-ttu-id="687db-235">Outra opção é usar um compartilhamento de arquivo apresentado pelo [SOFS (Servidor de Arquivos de Escalabilidade Horizontal)](https://blogs.msdn.microsoft.com/saponsqlserver/2017/11/14/file-server-with-sofs-and-s2d-as-an-alternative-to-cluster-shared-disk-for-clustering-of-an-sap-ascs-instance-in-azure-is-generally-available/).</span><span class="sxs-lookup"><span data-stu-id="687db-235">Another option is to use a file share served up by the [Scale Out Fileserver](https://blogs.msdn.microsoft.com/saponsqlserver/2017/11/14/file-server-with-sofs-and-s2d-as-an-alternative-to-cluster-shared-disk-for-clustering-of-an-sap-ascs-instance-in-azure-is-generally-available/) (SOFS).</span></span> <span data-ttu-id="687db-236">O SOFS oferece compartilhamentos de arquivos resilientes que podem ser usados como um volume compartilhado de cluster para o cluster do Windows.</span><span class="sxs-lookup"><span data-stu-id="687db-236">SOFS offers resilient file shares you can use as a cluster shared volume for the Windows cluster.</span></span> <span data-ttu-id="687db-237">Um cluster SOFS pode ser compartilhado entre vários nós do Central Services.</span><span class="sxs-lookup"><span data-stu-id="687db-237">A SOFS cluster can be shared among multiple Central Services nodes.</span></span> <span data-ttu-id="687db-238">A partir dessa gravação, o SOFS é usado apenas para o design de alta disponibilidade porque o cluster SOFS não se estende entre as regiões para dar suporte à recuperação de desastres.</span><span class="sxs-lookup"><span data-stu-id="687db-238">As of this writing, SOFS is used only for high availability design, because the SOFS cluster does not extend across regions to provide disaster recovery support.</span></span>

<span data-ttu-id="687db-239">A alta disponibilidade dos servidores de aplicativo SAP é obtida pelo tráfego de balanceamento de carga dentro de um pool de servidores de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="687db-239">High availability for the SAP application servers is achieved by load balancing traffic within a pool of application servers.</span></span>
<span data-ttu-id="687db-240">Veja [Certificações e configurações da SAP em execução no Microsoft Azure](/azure/virtual-machines/workloads/sap/sap-certifications).</span><span class="sxs-lookup"><span data-stu-id="687db-240">See [SAP certifications and configurations running on Microsoft Azure](/azure/virtual-machines/workloads/sap/sap-certifications).</span></span>

### <a name="database-tier"></a><span data-ttu-id="687db-241">Camada de banco de dados</span><span class="sxs-lookup"><span data-stu-id="687db-241">Database tier</span></span>

<span data-ttu-id="687db-242">Essa arquitetura de referência pressupõe que o banco de dados de origem esteja em execução no AnyDB — ou seja, um DBMS, como SQL Server, SAP ASE, IBM DB2 ou Oracle.</span><span class="sxs-lookup"><span data-stu-id="687db-242">This reference architecture assumes the source database is running on AnyDB—that is, a DBMS such as SQL Server, SAP ASE, IBM DB2, or Oracle.</span></span> <span data-ttu-id="687db-243">O recurso de replicação nativa da camada de banco de dados fornece o failover manual ou automático entre nós replicados.</span><span class="sxs-lookup"><span data-stu-id="687db-243">The database tier's native replication feature provides either manual or automatic failover between replicated nodes.</span></span>

<span data-ttu-id="687db-244">Para obter detalhes de implementação sobre sistemas específicos de banco de dados, consulte [Implantação de DBMS de Máquinas Virtuais do Azure para SAP NetWeaver](/azure/virtual-machines/workloads/sap/dbms-guide).</span><span class="sxs-lookup"><span data-stu-id="687db-244">For implementation details about specific database systems, see [Azure Virtual Machines DBMS deployment for SAP NetWeaver](/azure/virtual-machines/workloads/sap/dbms-guide).</span></span>

## <a name="disaster-recovery-considerations"></a><span data-ttu-id="687db-245">Considerações de recuperação de desastres</span><span class="sxs-lookup"><span data-stu-id="687db-245">Disaster recovery considerations</span></span>

<span data-ttu-id="687db-246">Para DR (recuperação de desastres), você deve ser capaz de fazer failover para uma região secundária.</span><span class="sxs-lookup"><span data-stu-id="687db-246">For disaster recovery (DR), you must be able to fail over to a secondary region.</span></span> <span data-ttu-id="687db-247">Cada camada usa uma estratégia diferente para fornecer proteção de recuperação de desastres.</span><span class="sxs-lookup"><span data-stu-id="687db-247">Each tier uses a different strategy to provide disaster recovery (DR) protection.</span></span>

- <span data-ttu-id="687db-248">**Camada de servidores de aplicativos**.</span><span class="sxs-lookup"><span data-stu-id="687db-248">**Application servers tier**.</span></span> <span data-ttu-id="687db-249">Os servidores de aplicativos SAP não contêm dados corporativos.</span><span class="sxs-lookup"><span data-stu-id="687db-249">SAP application servers do not contain business data.</span></span> <span data-ttu-id="687db-250">No Azure, uma estratégia simples de DR é criar servidores de aplicativos SAP na região secundária, depois tirá-los do ar.</span><span class="sxs-lookup"><span data-stu-id="687db-250">On Azure, a simple DR strategy is to create SAP application servers in the secondary region, then shut them down.</span></span> <span data-ttu-id="687db-251">Após quaisquer alterações de configuração ou atualizações de kernel no servidor de aplicativo primário, as mesmas alterações devem ser copiadas para as máquinas virtuais na região secundária.</span><span class="sxs-lookup"><span data-stu-id="687db-251">Upon any configuration changes or kernel updates on the primary application server, the same changes must be copied to the virtual machines in the secondary region.</span></span> <span data-ttu-id="687db-252">Por exemplo, os executáveis de kernel copiados para as máquinas virtuais de DR.</span><span class="sxs-lookup"><span data-stu-id="687db-252">For example, the kernel executables copied to the DR virtual machines.</span></span> <span data-ttu-id="687db-253">Para a replicação automática dos servidores de aplicativos para uma região secundária, o [Azure Site Recovery](/azure/site-recovery/site-recovery-overview) é a solução recomendada.</span><span class="sxs-lookup"><span data-stu-id="687db-253">For automatic replication of application servers to a secondary region, [Azure Site Recovery](/azure/site-recovery/site-recovery-overview) is the recommended solution.</span></span>

- <span data-ttu-id="687db-254">**Central Services**.</span><span class="sxs-lookup"><span data-stu-id="687db-254">**Central Services**.</span></span> <span data-ttu-id="687db-255">Esse componente da pilha do aplicativo SAP também não persiste dados corporativos.</span><span class="sxs-lookup"><span data-stu-id="687db-255">This component of the SAP application stack also does not persist business data.</span></span> <span data-ttu-id="687db-256">Você pode criar uma VM na região de recuperação de desastres para executar a função do Central Services.</span><span class="sxs-lookup"><span data-stu-id="687db-256">You can build a VM in the disaster recovery region to run the Central Services role.</span></span> <span data-ttu-id="687db-257">O único conteúdo do nó do Central Services primário a ser sincronizado é o conteúdo compartilhado /sapmnt.</span><span class="sxs-lookup"><span data-stu-id="687db-257">The only content from the primary Central Services node to synchronize is the /sapmnt share content.</span></span> <span data-ttu-id="687db-258">Além disso, se as configurações mudarem ou ocorrerem atualizações de kernel em servidores primários do Central Services, elas devem ser repetidas na VM na região de recuperação de desastres sendo executada no Central Services.</span><span class="sxs-lookup"><span data-stu-id="687db-258">Also, if configuration changes or kernel updates take place on the primary Central Services servers, they must be repeated on the VM in the disaster recovery region running Central Services.</span></span> <span data-ttu-id="687db-259">Para sincronizar os dois servidores, você pode usar o Azure Site Recovery para replicar os nós de cluster ou simplesmente usar um trabalho de cópia agendado regularmente para copiar /sapmnt à região de recuperação de desastres.</span><span class="sxs-lookup"><span data-stu-id="687db-259">To synchronize the two servers, you can use either Azure Site Recovery to replicate the cluster nodes or simply use a regularly scheduled copy job to copy /sapmnt to the disaster recovery region.</span></span> <span data-ttu-id="687db-260">Para obter detalhes sobre o processo de compilação, cópia e teste de failover desse método de replicação simples, baixe [SAP NetWeaver: compilar uma solução de recuperação de desastre baseada no Hyper-V e no Microsoft Azure](https://download.microsoft.com/download/9/5/6/956FEDC3-702D-4EFB-A7D3-2DB7505566B6/SAP%20NetWeaver%20-%20Building%20an%20Azure%20based%20Disaster%20Recovery%20Solution%20V1_5%20.docx) e confira "4.3.</span><span class="sxs-lookup"><span data-stu-id="687db-260">For details about this simple replication method's build, copy, and test failover process, download [SAP NetWeaver: Building a Hyper-V and Microsoft Azure–based Disaster Recovery Solution](https://download.microsoft.com/download/9/5/6/956FEDC3-702D-4EFB-A7D3-2DB7505566B6/SAP%20NetWeaver%20-%20Building%20an%20Azure%20based%20Disaster%20Recovery%20Solution%20V1_5%20.docx), and refer to "4.3.</span></span> <span data-ttu-id="687db-261">Camada SAP SPOF (ASCS)."</span><span class="sxs-lookup"><span data-stu-id="687db-261">SAP SPOF layer (ASCS)."</span></span>

- <span data-ttu-id="687db-262">**Camada de banco de dados**.</span><span class="sxs-lookup"><span data-stu-id="687db-262">**Database tier**.</span></span> <span data-ttu-id="687db-263">A melhor implementação da DR é com a tecnologia de replicação integrada própria do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="687db-263">DR is best implemented with the database's own integrated replication technology.</span></span> <span data-ttu-id="687db-264">No caso do SQL Server, por exemplo, é recomendável usar o Grupo de Disponibilidade do AlwaysOn para estabelecer uma réplica em uma região remota, replicando as transações de maneira assíncrona com failover manual.</span><span class="sxs-lookup"><span data-stu-id="687db-264">In the case of SQL Server, for example, we recommend using AlwaysOn Availability Group to establish a replica in a remote region, replicating transactions asynchronously with manual failover.</span></span> <span data-ttu-id="687db-265">A replicação assíncrona evita um impacto no desempenho de cargas de trabalho interativas no site primário.</span><span class="sxs-lookup"><span data-stu-id="687db-265">Asynchronous replication avoids an impact to the performance of interactive workloads at the primary site.</span></span> <span data-ttu-id="687db-266">O failover manual oferece a oportunidade de uma pessoa avaliar o impacto da DR e decidir se a operação do site da DR é justificada.</span><span class="sxs-lookup"><span data-stu-id="687db-266">Manual failover offers the opportunity for a person to evaluate the DR impact and decide if operating from the DR site is justified.</span></span>

<span data-ttu-id="687db-267">Para usar o Azure Site Recovery para compilar automaticamente um site de produção totalmente replicado do original, você deve executar [scripts de implantação](/azure/site-recovery/site-recovery-runbook-automation) personalizados.</span><span class="sxs-lookup"><span data-stu-id="687db-267">To use Azure Site Recovery to automatically build out a fully replicated production site of your original, you must run customized [deployment scripts](/azure/site-recovery/site-recovery-runbook-automation).</span></span> <span data-ttu-id="687db-268">Primeiro a recuperação de site implanta as VMs em conjuntos de disponibilidade, depois executa scripts para adicionar recursos, como balanceadores de carga.</span><span class="sxs-lookup"><span data-stu-id="687db-268">Site Recovery first deploys the VMs in availability sets, then runs scripts to add resources such as load balancers.</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="687db-269">Considerações sobre capacidade de gerenciamento</span><span class="sxs-lookup"><span data-stu-id="687db-269">Manageability considerations</span></span>

<span data-ttu-id="687db-270">O Azure oferece várias funções para [monitoramento e diagnóstico](/azure/architecture/best-practices/monitoring) da infraestrutura geral.</span><span class="sxs-lookup"><span data-stu-id="687db-270">Azure provides several functions for [monitoring and diagnostics](/azure/architecture/best-practices/monitoring) of the overall infrastructure.</span></span> <span data-ttu-id="687db-271">Além disso, o monitoramento avançado de máquinas virtuais do Azure é tratado pelo Azure OMS (Operations Management Suite).</span><span class="sxs-lookup"><span data-stu-id="687db-271">Also, enhanced monitoring of Azure virtual machines is handled by Azure Operations Management Suite (OMS).</span></span>

<span data-ttu-id="687db-272">Para fornecer monitoramento de recursos baseado na SAP e desempenho de serviço da infraestrutura da SAP, é usada a extensão [Monitoramento Avançado da SAP do Azure](/azure/virtual-machines/workloads/sap/deployment-guide#detailed-tasks-for-sap-software-deployment).</span><span class="sxs-lookup"><span data-stu-id="687db-272">To provide SAP-based monitoring of resources and service performance of the SAP infrastructure, the [Azure SAP Enhanced Monitoring](/azure/virtual-machines/workloads/sap/deployment-guide#detailed-tasks-for-sap-software-deployment) extension is used.</span></span> <span data-ttu-id="687db-273">Essa extensão fornece as estatísticas de monitoramento do Azure para o aplicativo SAP para monitoramento do sistema operacional e as funções da ferramenta cockpit de DBA.</span><span class="sxs-lookup"><span data-stu-id="687db-273">This extension feeds Azure monitoring statistics into the SAP application for operating system monitoring and DBA Cockpit functions.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="687db-274">Considerações de segurança</span><span class="sxs-lookup"><span data-stu-id="687db-274">Security considerations</span></span>

<span data-ttu-id="687db-275">O SAP tem seu próprio mecanismo de gerenciamento de usuários (UME) para controlar o acesso e a autorização baseados em função do aplicativo SAP.</span><span class="sxs-lookup"><span data-stu-id="687db-275">SAP has its own Users Management Engine (UME) to control role-based access and authorization within the SAP application.</span></span> <span data-ttu-id="687db-276">Para obter detalhes, consulte [Servidor de aplicativos do SAP NetWeaver para o guia de segurança ABAP](https://help.sap.com/viewer/864321b9b3dd487d94c70f6a007b0397/7.4.19) e [Guia de segurança do servidor de aplicativos Java do SAP NetWeaver](https://help.sap.com/doc/saphelp_snc_uiaddon_10/1.0/en-US/57/d8bfcf38f66f48b95ce1f52b3f5184/frameset.htm).</span><span class="sxs-lookup"><span data-stu-id="687db-276">For details, see [SAP NetWeaver Application Server for ABAP Security Guide](https://help.sap.com/viewer/864321b9b3dd487d94c70f6a007b0397/7.4.19) and [SAP NetWeaver Application Server Java Security Guide](https://help.sap.com/doc/saphelp_snc_uiaddon_10/1.0/en-US/57/d8bfcf38f66f48b95ce1f52b3f5184/frameset.htm).</span></span>

<span data-ttu-id="687db-277">Para a segurança da rede adicional, cogite implementar uma [rede de perímetro](../dmz/secure-vnet-hybrid.md), a qual usa um dispositivo de rede virtual para criar um firewall na frente da sub-rede para o Web Dispatcher.</span><span class="sxs-lookup"><span data-stu-id="687db-277">For additional network security, consider implementing a [network DMZ](../dmz/secure-vnet-hybrid.md), which uses a network virtual appliance to create a firewall in front of the subnet for Web Dispatcher.</span></span>

<span data-ttu-id="687db-278">Para a segurança da infraestrutura, os dados são criptografados em trânsito e em repouso.</span><span class="sxs-lookup"><span data-stu-id="687db-278">For infrastructure security, data is encrypted in transit and at rest.</span></span> <span data-ttu-id="687db-279">A seção “Considerações sobre segurança” do [SAP NetWeaver nas máquinas virtuais (VMs) do Azure – Guia de planejamento e implementação](/azure/virtual-machines/workloads/sap/planning-guide) começa a tratar da segurança de rede.</span><span class="sxs-lookup"><span data-stu-id="687db-279">The "Security considerations” section of the [SAP NetWeaver on Azure Virtual Machines (VMs) – Planning and Implementation Guide](/azure/virtual-machines/workloads/sap/planning-guide) begins to address network security.</span></span> <span data-ttu-id="687db-280">O guia também especifica as portas de rede que você deve abrir nos firewalls para permitir a comunicação do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="687db-280">The guide also specifies the network ports you must open on the firewalls to allow application communication.</span></span>

<span data-ttu-id="687db-281">Para criptografar os discos da máquina virtual do Windows, é possível usar o [Azure Disk Encryption](/azure/security/azure-security-disk-encryption).</span><span class="sxs-lookup"><span data-stu-id="687db-281">To encrypt Windows virtual machine disks, you can use [Azure Disk Encryption](/azure/security/azure-security-disk-encryption).</span></span> <span data-ttu-id="687db-282">Ele usa o recurso BitLocker do Windows para fornecer criptografia de volume para o sistema operacional e os discos de dados.</span><span class="sxs-lookup"><span data-stu-id="687db-282">It uses the BitLocker feature of Windows to provide volume encryption for the operating system and the data disks.</span></span> <span data-ttu-id="687db-283">A solução também funciona com o Azure Key Vault para ajudá-lo a controlar e gerenciar os segredos e chaves de criptografia de disco em sua assinatura do Key Vault.</span><span class="sxs-lookup"><span data-stu-id="687db-283">The solution also works with Azure Key Vault to help you control and manage the disk-encryption keys and secrets in your key vault subscription.</span></span> <span data-ttu-id="687db-284">Os dados em discos da máquina virtual são criptografados em repouso no armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="687db-284">Data on the virtual machine disks are encrypted at rest in your Azure storage.</span></span>

## <a name="communities"></a><span data-ttu-id="687db-285">Comunidades</span><span class="sxs-lookup"><span data-stu-id="687db-285">Communities</span></span>

<span data-ttu-id="687db-286">As comunidades podem responder a perguntas e ajudá-lo a configurar uma implantação bem-sucedida.</span><span class="sxs-lookup"><span data-stu-id="687db-286">Communities can answer questions and help you set up a successful deployment.</span></span> <span data-ttu-id="687db-287">Considere o seguinte:</span><span class="sxs-lookup"><span data-stu-id="687db-287">Consider the following:</span></span>

- [<span data-ttu-id="687db-288">Como executar aplicativos SAP no blog Microsoft Platform</span><span class="sxs-lookup"><span data-stu-id="687db-288">Running SAP Applications on the Microsoft Platform Blog</span></span>](https://blogs.msdn.microsoft.com/saponsqlserver/2017/05/04/sap-on-azure-general-update-for-customers-partners-april-2017/)
- [<span data-ttu-id="687db-289">Suporte da Comunidade do Azure</span><span class="sxs-lookup"><span data-stu-id="687db-289">Azure Community Support</span></span>](https://azure.microsoft.com/support/community/)
- [<span data-ttu-id="687db-290">Comunidade do SAP</span><span class="sxs-lookup"><span data-stu-id="687db-290">SAP Community</span></span>](https://www.sap.com/community.html)
- [<span data-ttu-id="687db-291">Stack Overflow</span><span class="sxs-lookup"><span data-stu-id="687db-291">Stack Overflow</span></span>](https://stackoverflow.com/tags/sap/)

## <a name="related-resources"></a><span data-ttu-id="687db-292">Recursos relacionados</span><span class="sxs-lookup"><span data-stu-id="687db-292">Related resources</span></span>

<span data-ttu-id="687db-293">Talvez seja melhor examinar os seguintes [cenários de exemplo do Azure](/azure/architecture/example-scenario), que demonstram soluções específicas usando algumas das mesmas tecnologias:</span><span class="sxs-lookup"><span data-stu-id="687db-293">You may wish to review the following [Azure example scenarios](/azure/architecture/example-scenario) that demonstrate specific solutions using some of the same technologies:</span></span>

- [<span data-ttu-id="687db-294">Executando cargas de trabalho de produção do SAP usando um Oracle Database no Azure</span><span class="sxs-lookup"><span data-stu-id="687db-294">Running SAP production workloads using an Oracle Database on Azure</span></span>](/azure/architecture/example-scenario/apps/sap-production)
- [<span data-ttu-id="687db-295">Ambientes de desenvolvimento/teste para cargas de trabalho do SAP no Azure</span><span class="sxs-lookup"><span data-stu-id="687db-295">Dev/test environments for SAP workloads on Azure</span></span>](/azure/architecture/example-scenario/apps/sap-dev-test)

<!-- links -->

[visio-download]: https://archcenter.blob.core.windows.net/cdn/sap-reference-architectures.vsdx
