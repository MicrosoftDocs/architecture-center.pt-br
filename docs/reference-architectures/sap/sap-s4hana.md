---
title: SAP S/4HANA para Máquinas Virtuais do Linux no Azure
titleSuffix: Azure Reference Architectures
description: Práticas comprovadas para executar o SAP S/4HANA em um ambiente Linux no Azure com alta disponibilidade.
author: lbrader
ms.date: 05/11/2018
ms.custom: seodec18
ms.openlocfilehash: 9eb73ddaf5b1cb815f037f46c7e187f61d126876
ms.sourcegitcommit: bb7fcffbb41e2c26a26f8781df32825eb60df70c
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 12/20/2018
ms.locfileid: "53644165"
---
# <a name="sap-s4hana-for-linux-virtual-machines-on-azure"></a><span data-ttu-id="105f4-103">SAP S/4HANA para máquinas virtuais com Linux no Azure</span><span class="sxs-lookup"><span data-stu-id="105f4-103">SAP S/4HANA for Linux virtual machines on Azure</span></span>

<span data-ttu-id="105f4-104">Essa arquitetura de referência mostra um conjunto de práticas comprovadas para executar o S/4HANA em um ambiente de alta disponibilidade no Azure que dê suporte à recuperação de desastre no Azure.</span><span class="sxs-lookup"><span data-stu-id="105f4-104">This reference architecture shows a set of proven practices for running S/4HANA in a high availability environment that supports disaster recovery on Azure.</span></span> <span data-ttu-id="105f4-105">Essa arquitetura é implantada com tamanhos específicos de VM (máquina virtual) que podem ser alterados para acomodar as necessidades da sua organização.</span><span class="sxs-lookup"><span data-stu-id="105f4-105">This architecture is deployed with specific virtual machine (VM) sizes that can be changed to accommodate your organization's needs.</span></span>

![Arquitetura de referência para SAP S/4HANA para máquinas virtuais com Linux no Azure](./images/sap-s4hana.png)

<span data-ttu-id="105f4-107">*Baixe um [Arquivo Visio][visio-download] dessa arquitetura.*</span><span class="sxs-lookup"><span data-stu-id="105f4-107">*Download a [Visio file][visio-download] of this architecture.*</span></span>

> [!NOTE]
> <span data-ttu-id="105f4-108">Implantar essa arquitetura de referência requer um licenciamento apropriado de produtos SAP e outras tecnologias que não são da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="105f4-108">Deploying this reference architecture requires appropriate licensing of SAP products and other non-Microsoft technologies.</span></span>

## <a name="architecture"></a><span data-ttu-id="105f4-109">Arquitetura</span><span class="sxs-lookup"><span data-stu-id="105f4-109">Architecture</span></span>

<span data-ttu-id="105f4-110">Essa arquitetura de referência descreve um nível empresarial, o sistema de nível de produção.</span><span class="sxs-lookup"><span data-stu-id="105f4-110">This reference architecture describes a enterprise-grade, production-level system.</span></span> <span data-ttu-id="105f4-111">De acordo com a necessidade da sua empresa, essa configuração poderá ser reduzida para uma única máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="105f4-111">To suit your business needs, this configuration can be reduced to a single virtual machine.</span></span> <span data-ttu-id="105f4-112">No entanto, os seguintes componentes são necessários:</span><span class="sxs-lookup"><span data-stu-id="105f4-112">However, the following components are required:</span></span>

<span data-ttu-id="105f4-113">**Rede virtual**.</span><span class="sxs-lookup"><span data-stu-id="105f4-113">**Virtual network**.</span></span> <span data-ttu-id="105f4-114">O serviço [Rede Virtual do Azure](/azure/virtual-network/virtual-networks-overview) conecta com segurança os recursos do Azure entre si.</span><span class="sxs-lookup"><span data-stu-id="105f4-114">The [Azure Virtual Network](/azure/virtual-network/virtual-networks-overview) service securely connects Azure resources to each other.</span></span> <span data-ttu-id="105f4-115">Nessa arquitetura, a rede virtual se conecta a um ambiente local por meio de um gateway implantado no hub de uma [tecnologia hub-spoke](../hybrid-networking/hub-spoke.md).</span><span class="sxs-lookup"><span data-stu-id="105f4-115">In this architecture, the virtual network connects to an on-premises environment through a gateway deployed in the hub of a [hub-spoke topology](../hybrid-networking/hub-spoke.md).</span></span> <span data-ttu-id="105f4-116">O spoke é a rede virtual usada para os aplicativos SAP.</span><span class="sxs-lookup"><span data-stu-id="105f4-116">The spoke is the virtual network used for the SAP applications.</span></span>

<span data-ttu-id="105f4-117">**Sub-redes**.</span><span class="sxs-lookup"><span data-stu-id="105f4-117">**Subnets**.</span></span> <span data-ttu-id="105f4-118">A rede virtual é subdividida em [sub-redes](/azure/virtual-network/virtual-network-manage-subnet) separadas para cada camada: gateway, aplicativo, banco de dados e serviços compartilhados.</span><span class="sxs-lookup"><span data-stu-id="105f4-118">The virtual network is subdivided into separate [subnets](/azure/virtual-network/virtual-network-manage-subnet) for each tier: gateway, application, database, and shared services.</span></span>

<span data-ttu-id="105f4-119">**Máquinas virtuais**.</span><span class="sxs-lookup"><span data-stu-id="105f4-119">**Virtual machines**.</span></span> <span data-ttu-id="105f4-120">Essa arquitetura usa máquinas virtuais que executam Linux para a camada de aplicativo e a camada de banco de dados, agrupadas da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="105f4-120">This architecture uses virtual machines running Linux for the application tier and database tier, grouped as follows:</span></span>

- <span data-ttu-id="105f4-121">**Camada de aplicativo**.</span><span class="sxs-lookup"><span data-stu-id="105f4-121">**Application tier**.</span></span> <span data-ttu-id="105f4-122">Inclui o pool de Servidores de Front-end Fiori, o pool do SAP Web Dispatcher, o pool de servidores de aplicativo e o cluster do SAP Central Services.</span><span class="sxs-lookup"><span data-stu-id="105f4-122">Includes the Fiori Front-end Server pool, SAP Web Dispatcher pool, application server pool, and SAP Central Services cluster.</span></span> <span data-ttu-id="105f4-123">Para alta disponibilidade do Central Services nas Máquinas Virtuais do Linux do Azure, é necessário um serviço NFS (Network File System) altamente disponível.</span><span class="sxs-lookup"><span data-stu-id="105f4-123">For high availability of Central Services on Azure Linux virtual machines, a highly available Network File System (NFS) service is required.</span></span>
- <span data-ttu-id="105f4-124">**Cluster NFS**.</span><span class="sxs-lookup"><span data-stu-id="105f4-124">**NFS cluster**.</span></span> <span data-ttu-id="105f4-125">Essa arquitetura usa um servidor [NFS](/azure/virtual-machines/workloads/sap/high-availability-guide-suse-nfs) em execução em um cluster Linux para armazenar dados compartilhados entre os sistemas SAP.</span><span class="sxs-lookup"><span data-stu-id="105f4-125">This architecture uses an [NFS](/azure/virtual-machines/workloads/sap/high-availability-guide-suse-nfs) server running on a Linux cluster to store data shared between SAP systems.</span></span> <span data-ttu-id="105f4-126">Este cluster centralizado pode ser compartilhado por vários sistemas SAP.</span><span class="sxs-lookup"><span data-stu-id="105f4-126">This centralized cluster can be shared across multiple SAP systems.</span></span> <span data-ttu-id="105f4-127">Para alta disponibilidade do serviço NFS, é usada a Extensão de Alta Disponibilidade apropriada para a distribuição de Linux selecionada.</span><span class="sxs-lookup"><span data-stu-id="105f4-127">For high availability of the NFS service, the appropriate High Availability Extension for the selected Linux distribution is used.</span></span>
- <span data-ttu-id="105f4-128">**SAP HANA**.</span><span class="sxs-lookup"><span data-stu-id="105f4-128">**SAP HANA**.</span></span> <span data-ttu-id="105f4-129">A camada de banco de dados usa duas ou mais máquinas virtuais do Linux em um cluster para obter alta disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="105f4-129">The database tier uses two or more Linux virtual machines in a cluster to achieve high availability.</span></span> <span data-ttu-id="105f4-130">A HSR (Replicação de Sistema do HANA) é usada para replicar conteúdo entre os sistemas HANA primários e secundários.</span><span class="sxs-lookup"><span data-stu-id="105f4-130">HANA System Replication (HSR) is used to replicate contents between primary and secondary HANA systems.</span></span> <span data-ttu-id="105f4-131">O clustering do Linux é usado para detectar falhas de sistema e facilitar o failover automático.</span><span class="sxs-lookup"><span data-stu-id="105f4-131">Linux clustering is used to detect system failures and facilitate automatic failover.</span></span> <span data-ttu-id="105f4-132">Um mecanismo de isolamento com base em nuvem ou em armazenamento pode ser usado para garantir que o sistema com falha seja isolado ou desligado para evitar a condição de separação de cluster.</span><span class="sxs-lookup"><span data-stu-id="105f4-132">A storage-based or cloud-based fencing mechanism can be used to ensure the failed system is isolated or shut down to avoid the cluster split-brain condition.</span></span>
- <span data-ttu-id="105f4-133">**Jumpbox**.</span><span class="sxs-lookup"><span data-stu-id="105f4-133">**Jumpbox**.</span></span> <span data-ttu-id="105f4-134">Também chamada de um host bastião.</span><span class="sxs-lookup"><span data-stu-id="105f4-134">Also called a bastion host.</span></span> <span data-ttu-id="105f4-135">Essa é uma máquina virtual segura na rede que os administradores usam para se conectar às outras máquinas virtuais.</span><span class="sxs-lookup"><span data-stu-id="105f4-135">This is a secure virtual machine on the network that administrators use to connect to the other virtual machines.</span></span> <span data-ttu-id="105f4-136">Ele pode executar o Windows ou o Linux.</span><span class="sxs-lookup"><span data-stu-id="105f4-136">It can run Windows or Linux.</span></span> <span data-ttu-id="105f4-137">Use um jumpbox do Windows para a conveniência de navegação na Web ao usar as ferramentas de gerenciamento do HANA Cockpit ou do HANA Studio.</span><span class="sxs-lookup"><span data-stu-id="105f4-137">Use a Windows jumpbox for web browsing convenience when using HANA Cockpit or HANA Studio management tools.</span></span>

<span data-ttu-id="105f4-138">**Balanceadores de carga**.</span><span class="sxs-lookup"><span data-stu-id="105f4-138">**Load balancers**.</span></span> <span data-ttu-id="105f4-139">Tanto os balanceadores de carga internos do SAP quanto o [Azure Load Balancer](/azure/load-balancer/load-balancer-overview) são usados para obter a alta disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="105f4-139">Both built-in SAP load balancers and [Azure Load Balancer](/azure/load-balancer/load-balancer-overview) are used to achieve HA.</span></span> <span data-ttu-id="105f4-140">As instâncias do Azure Load Balancer são usadas para distribuir o tráfego para máquinas virtuais na sub-rede de camada de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="105f4-140">Azure Load Balancer instances are used to distribute traffic to virtual machines in the application tier subnet.</span></span>

<span data-ttu-id="105f4-141">**Conjuntos de disponibilidade**.</span><span class="sxs-lookup"><span data-stu-id="105f4-141">**Availability sets**.</span></span> <span data-ttu-id="105f4-142">As máquinas virtuais para todos os pools e clusters (Web Dispatcher, servidores de aplicativos SAP, Central Services, NFS e HANA) são agrupadas em [conjuntos de disponibilidades](/azure/virtual-machines/windows/tutorial-availability-sets) separados, e pelo menos duas máquinas virtuais são provisionadas por função.</span><span class="sxs-lookup"><span data-stu-id="105f4-142">Virtual machines for all pools and clusters (Web Dispatcher, SAP application servers, Central Services, NFS, and HANA) are grouped into separate [availability sets](/azure/virtual-machines/windows/tutorial-availability-sets), and at least two virtual machines are provisioned per role.</span></span> <span data-ttu-id="105f4-143">Isso torna as máquinas virtuais qualificadas para um [SLA (Contrato de Nível de Serviço)](https://azure.microsoft.com/support/legal/sla/virtual-machines) mais elevado.</span><span class="sxs-lookup"><span data-stu-id="105f4-143">This makes the virtual machines eligible for a higher [service level agreement](https://azure.microsoft.com/support/legal/sla/virtual-machines) (SLA).</span></span>

<span data-ttu-id="105f4-144">**NICs**.</span><span class="sxs-lookup"><span data-stu-id="105f4-144">**NICs**.</span></span> <span data-ttu-id="105f4-145">Os [cartões de interface de rede](/azure/virtual-network/virtual-network-network-interface) (NICs) permitem toda a comunicação de máquinas virtuais em uma rede virtual.</span><span class="sxs-lookup"><span data-stu-id="105f4-145">[Network interface cards](/azure/virtual-network/virtual-network-network-interface) (NICs) enable all communication of virtual machines on a virtual network.</span></span>

<span data-ttu-id="105f4-146">**Grupos de segurança de rede**.</span><span class="sxs-lookup"><span data-stu-id="105f4-146">**Network security groups**.</span></span> <span data-ttu-id="105f4-147">Para restringir o tráfego de entrada, saída e dentro da sub-rede na rede virtual, é possível criar [grupos de segurança de rede](/azure/virtual-network/virtual-networks-nsg) (NSGs).</span><span class="sxs-lookup"><span data-stu-id="105f4-147">To restrict incoming, outgoing, and intra-subnet traffic in the virtual network, [network security groups](/azure/virtual-network/virtual-networks-nsg) (NSGs) are used.</span></span>

<span data-ttu-id="105f4-148">**Gateway**.</span><span class="sxs-lookup"><span data-stu-id="105f4-148">**Gateway**.</span></span> <span data-ttu-id="105f4-149">Um gateway estende sua rede local para a rede virtual do Azure.</span><span class="sxs-lookup"><span data-stu-id="105f4-149">A gateway extends your on-premises network to the Azure virtual network.</span></span> <span data-ttu-id="105f4-150">O [ExpressRoute](/azure/architecture/reference-architectures/hybrid-networking/expressroute) é o serviço do Azure recomendado para criar conexões privadas que não passem pela Internet pública, mas uma conexão [Site a Site](/azure/vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal) também pode ser usada.</span><span class="sxs-lookup"><span data-stu-id="105f4-150">[ExpressRoute](/azure/architecture/reference-architectures/hybrid-networking/expressroute) is the recommended Azure service for creating private connections that do not go over the public Internet, but a [Site-to-Site](/azure/vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal) connection can also be used.</span></span>

<span data-ttu-id="105f4-151">**Armazenamento do Azure**.</span><span class="sxs-lookup"><span data-stu-id="105f4-151">**Azure Storage**.</span></span> <span data-ttu-id="105f4-152">Para fornecer um armazenamento persistente de um VHD (disco rígido virtual) de uma máquina virtual, é necessário o [Armazenamento do Azure](/azure/storage/).</span><span class="sxs-lookup"><span data-stu-id="105f4-152">To provide persistent storage of a virtual machine's virtual hard disk (VHD), [Azure Storage](/azure/storage/) is required.</span></span>

## <a name="recommendations"></a><span data-ttu-id="105f4-153">Recomendações</span><span class="sxs-lookup"><span data-stu-id="105f4-153">Recommendations</span></span>

<span data-ttu-id="105f4-154">Essa arquitetura descreve a implantação de uma empresa com um nível de produção pequeno.</span><span class="sxs-lookup"><span data-stu-id="105f4-154">This architecture describes a small production-level enterprise deployment.</span></span> <span data-ttu-id="105f4-155">Sua implantação será diferente de acordo com suas necessidades de negócios.</span><span class="sxs-lookup"><span data-stu-id="105f4-155">Your deployment will differ based on your business requirements.</span></span> <span data-ttu-id="105f4-156">Use essas recomendações como ponto de partida.</span><span class="sxs-lookup"><span data-stu-id="105f4-156">Use these recommendations as a starting point.</span></span>

### <a name="virtual-machines"></a><span data-ttu-id="105f4-157">Máquinas virtuais</span><span class="sxs-lookup"><span data-stu-id="105f4-157">Virtual machines</span></span>

<span data-ttu-id="105f4-158">Nos pools e clusters de servidor de aplicativos, ajuste o número de máquinas virtuais com base nos seus requisitos.</span><span class="sxs-lookup"><span data-stu-id="105f4-158">In application server pools and clusters, adjust the number of virtual machines based on your requirements.</span></span> <span data-ttu-id="105f4-159">O [guia de planejamento e implementação de Máquinas Virtuais do Azure](/azure/virtual-machines/workloads/sap/planning-guide) inclui detalhes sobre a execução do SAP NetWeaver em máquinas virtuais, mas as informações também se aplicam ao SAP S/4HANA.</span><span class="sxs-lookup"><span data-stu-id="105f4-159">The [Azure Virtual Machines planning and implementation guide](/azure/virtual-machines/workloads/sap/planning-guide) includes details about running SAP NetWeaver on virtual machines, but the information applies to SAP S/4HANA as well.</span></span>

<span data-ttu-id="105f4-160">Para obter detalhes sobre o suporte da SAP para tipos de máquina virtual do Azure e métricas de taxa de transferência (SAPS), consulte [Nota SAP 1928533](https://launchpad.support.sap.com/#/notes/1928533).</span><span class="sxs-lookup"><span data-stu-id="105f4-160">For details about SAP support for Azure virtual machine types and throughput metrics (SAPS), see [SAP Note 1928533](https://launchpad.support.sap.com/#/notes/1928533).</span></span>

### <a name="sap-web-dispatcher-pool"></a><span data-ttu-id="105f4-161">Pool do SAP Web Dispatcher</span><span class="sxs-lookup"><span data-stu-id="105f4-161">SAP Web Dispatcher pool</span></span>

<span data-ttu-id="105f4-162">O componente Web Dispatcher é usado como um balanceador de carga para tráfego da SAP entre os servidores de aplicativos SAP.</span><span class="sxs-lookup"><span data-stu-id="105f4-162">The Web Dispatcher component is used as a load balancer for SAP traffic among the SAP application servers.</span></span> <span data-ttu-id="105f4-163">Para obter alta disponibilidade para o componente Web Dispatcher, o Azure Load Balancer será usado para implementar a configuração paralela do Web Dispatcher em uma configuração de round-robin para distribuição de tráfego de HTTP(S) entre os Web Dispatchers disponíveis no pool de back-end dos balanceadores.</span><span class="sxs-lookup"><span data-stu-id="105f4-163">To achieve high availability for the Web Dispatcher component, Azure Load Balancer is used to implement the parallel Web Dispatcher setup in a round-robin configuration for HTTP(S) traffic distribution among the available Web Dispatchers in the balancers back-end pool.</span></span>

### <a name="fiori-front-end-server"></a><span data-ttu-id="105f4-164">Servidor Front-end Fiori</span><span class="sxs-lookup"><span data-stu-id="105f4-164">Fiori Front-end Server</span></span>

<span data-ttu-id="105f4-165">O Servidor de Front-end Fiori usa um [NetWeaver Gateway](https://help.sap.com/doc/saphelp_gateway20sp12/2.0/en-US/76/08828d832e4aa78748e9f82204a864/content.htm?no_cache=true).</span><span class="sxs-lookup"><span data-stu-id="105f4-165">The Fiori Front-end Server uses a [NetWeaver Gateway](https://help.sap.com/doc/saphelp_gateway20sp12/2.0/en-US/76/08828d832e4aa78748e9f82204a864/content.htm?no_cache=true).</span></span> <span data-ttu-id="105f4-166">Para implantações pequenas, ele pode ser carregado no servidor Fiori.</span><span class="sxs-lookup"><span data-stu-id="105f4-166">For small deployments, it can be loaded on the Fiori server.</span></span> <span data-ttu-id="105f4-167">Para grandes implantações, um servidor separado para o NetWeaver Gateway pode ser implantado na frente do pool de Servidores de Front-end Fiori.</span><span class="sxs-lookup"><span data-stu-id="105f4-167">For large deployments, a separate server for the NetWeaver Gateway may be deployed in front of the Fiori Front-end Server pool.</span></span>

### <a name="application-servers-pool"></a><span data-ttu-id="105f4-168">Pool de servidores de aplicativos</span><span class="sxs-lookup"><span data-stu-id="105f4-168">Application servers pool</span></span>

<span data-ttu-id="105f4-169">Para gerenciar grupos de logon para servidores de aplicativos ABAP, é usada a transação SMLG.</span><span class="sxs-lookup"><span data-stu-id="105f4-169">To manage logon groups for ABAP application servers, the SMLG transaction is used.</span></span> <span data-ttu-id="105f4-170">Ela usa a função de balanceamento de carga no servidor de mensagens do Central Services para distribuir a carga de trabalho entre o pool de servidores de aplicativos SAP para o tráfego de SAPGUIs e RFC.</span><span class="sxs-lookup"><span data-stu-id="105f4-170">It uses the load balancing function within the message server of the Central Services to distribute workload among SAP application servers pool for SAPGUIs and RFC traffic.</span></span> <span data-ttu-id="105f4-171">A conexão do servidor de aplicativos para o Central Services altamente disponível é feita através do nome de rede virtual do cluster.</span><span class="sxs-lookup"><span data-stu-id="105f4-171">The application server connection to the highly available Central Services is through the cluster virtual network name.</span></span> <span data-ttu-id="105f4-172">Isso evita a necessidade de alterar o perfil de servidor de aplicativos para a conectividade do Central Services após um failover local.</span><span class="sxs-lookup"><span data-stu-id="105f4-172">This avoids the need to change the application server profile for Central Services connectivity after a local failover.</span></span>

### <a name="sap-central-services-cluster"></a><span data-ttu-id="105f4-173">Cluster do SAP Central Services</span><span class="sxs-lookup"><span data-stu-id="105f4-173">SAP Central Services cluster</span></span>

<span data-ttu-id="105f4-174">O Central Services poderá ser implantado em uma única máquina virtual quando não for um requisito de alta disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="105f4-174">Central Services can be deployed to a single virtual machine when high availability is not a requirement.</span></span> <span data-ttu-id="105f4-175">No entanto, a máquina virtual única se torna um potencial ponto único de falha (SPOF) para o ambiente do SAP.</span><span class="sxs-lookup"><span data-stu-id="105f4-175">However, the single virtual machine becomes a potential single point of failure (SPOF) for the SAP environment.</span></span> <span data-ttu-id="105f4-176">Para uma implantação do Central Services altamente disponível, um cluster NFS altamente disponível e um cluster do Central Services altamente disponível são usados.</span><span class="sxs-lookup"><span data-stu-id="105f4-176">For a highly available Central Services deployment, a highly available NFS cluster and a highly available Central Services cluster are used.</span></span>

### <a name="nfs-cluster"></a><span data-ttu-id="105f4-177">Cluster NFS</span><span class="sxs-lookup"><span data-stu-id="105f4-177">NFS cluster</span></span>

<span data-ttu-id="105f4-178">O DRBD (Distributed Replicated Block Device) é usado para a replicação entre os nós do cluster de NFS.</span><span class="sxs-lookup"><span data-stu-id="105f4-178">DRBD (Distributed Replicated Block Device) is used for replication between the nodes of the NFS cluster.</span></span>

### <a name="availability-sets"></a><span data-ttu-id="105f4-179">Conjuntos de disponibilidade</span><span class="sxs-lookup"><span data-stu-id="105f4-179">Availability sets</span></span>

<span data-ttu-id="105f4-180">Os conjuntos de disponibilidade distribuem os servidores a diferentes grupos de infraestrutura e atualizam grupos para melhorar a disponibilidade de serviço.</span><span class="sxs-lookup"><span data-stu-id="105f4-180">Availability sets distribute servers to different physical infrastructure and update groups to improve service availability.</span></span> <span data-ttu-id="105f4-181">Use máquinas virtuais que executem a mesma função em conjuntos de disponibilidade para ajudar a proteger contra o tempo de inatividade causado por uma manutenção da infraestrutura do Azure e para atender às [SLAs](https://azure.microsoft.com/support/legal/sla/virtual-machines).</span><span class="sxs-lookup"><span data-stu-id="105f4-181">Put virtual machines that perform the same role into an availability sets to help guard against downtime caused by Azure infrastructure maintenance and to meet [SLAs](https://azure.microsoft.com/support/legal/sla/virtual-machines).</span></span> <span data-ttu-id="105f4-182">É recomendável ter duas ou mais máquinas virtuais por conjunto de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="105f4-182">Two or more virtual machines per availability set is recommended.</span></span>

<span data-ttu-id="105f4-183">Todas as máquinas virtuais em um conjunto devem executar a mesma função.</span><span class="sxs-lookup"><span data-stu-id="105f4-183">All virtual machines in a set must perform the same role.</span></span> <span data-ttu-id="105f4-184">Não misture servidores de funções diferentes no mesmo conjunto de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="105f4-184">Do not mix servers of different roles in the same availability set.</span></span> <span data-ttu-id="105f4-185">Por exemplo, não coloque um nó do ASCS no mesmo conjunto de disponibilidade com o servidor de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="105f4-185">For example, don't place a ASCS node in the same availability set with the application server.</span></span>

### <a name="nics"></a><span data-ttu-id="105f4-186">NICs</span><span class="sxs-lookup"><span data-stu-id="105f4-186">NICs</span></span>

<span data-ttu-id="105f4-187">As paisagens tradicionais locais da SAP implementam várias NICs (placas de interface de rede) por computador para separar o tráfego administrativo do tráfego de negócios.</span><span class="sxs-lookup"><span data-stu-id="105f4-187">Traditional on-premises SAP landscapes implement multiple network interface cards (NICs) per machine to segregate administrative traffic from business traffic.</span></span> <span data-ttu-id="105f4-188">No Azure, a rede virtual é uma rede definida pelo software que envia todo o tráfego pela mesma malha de rede.</span><span class="sxs-lookup"><span data-stu-id="105f4-188">On Azure, the virtual network is a software-defined network that sends all traffic through the same network fabric.</span></span> <span data-ttu-id="105f4-189">Portanto, é desnecessário o uso de vários NICs.</span><span class="sxs-lookup"><span data-stu-id="105f4-189">Therefore, the use of multiple NICs is unnecessary.</span></span> <span data-ttu-id="105f4-190">No entanto, se sua organização precisar separar o tráfego, você pode implantar vários NICs por VM, conectar cada NIC a uma sub-rede diferente e, então, usar os NSGs para impor diferentes políticas de controle de acesso.</span><span class="sxs-lookup"><span data-stu-id="105f4-190">However, if your organization needs to segregate traffic, you can deploy multiple NICs per VM, connect each NIC to a different subnet, and then use NSGs to enforce different access control policies.</span></span>

### <a name="subnets-and-nsgs"></a><span data-ttu-id="105f4-191">Sub-redes e NSGs</span><span class="sxs-lookup"><span data-stu-id="105f4-191">Subnets and NSGs</span></span>

<span data-ttu-id="105f4-192">Essa arquitetura subdivide o espaço de endereço da rede virtual em sub-redes.</span><span class="sxs-lookup"><span data-stu-id="105f4-192">This architecture subdivides the virtual network address space into subnets.</span></span> <span data-ttu-id="105f4-193">Cada sub-rede pode ser associada a um NSG que define as políticas de acesso para a sub-rede.</span><span class="sxs-lookup"><span data-stu-id="105f4-193">Each subnet can be associated with a NSG that defines the access policies for the subnet.</span></span> <span data-ttu-id="105f4-194">Coloque os servidores de aplicativos em uma sub-rede separada para poder protegê-los mais facilmente por meio do gerenciamento das políticas de segurança de sub-rede, não dos servidores individuais.</span><span class="sxs-lookup"><span data-stu-id="105f4-194">Place application servers on a separate subnet so you can secure them more easily by managing the subnet security policies, not the individual servers.</span></span>

<span data-ttu-id="105f4-195">Quando um NSG está associado a uma sub-rede, então ele se aplica a todos os servidores dentro dessa sub-rede.</span><span class="sxs-lookup"><span data-stu-id="105f4-195">When a NSG is associated with a subnet, it then applies to all the servers within the subnet.</span></span> <span data-ttu-id="105f4-196">Para saber mais sobre como usar os NSGs para um controle refinado sobre os servidores em uma sub-rede, veja [Filtrar o tráfego de rede com os grupos de segurança de rede](https://azure.microsoft.com/blog/multiple-vm-nics-and-network-virtual-appliances-in-azure/).</span><span class="sxs-lookup"><span data-stu-id="105f4-196">For more information about using NSGs for fine-grained control over the servers in a subnet, see [Filter network traffic with network security groups](https://azure.microsoft.com/blog/multiple-vm-nics-and-network-virtual-appliances-in-azure/).</span></span>

<span data-ttu-id="105f4-197">Veja também [Planejamento e design para o Gateway de VPN](/azure/vpn-gateway/vpn-gateway-plan-design).</span><span class="sxs-lookup"><span data-stu-id="105f4-197">See also [Planning and design for VPN Gateway](/azure/vpn-gateway/vpn-gateway-plan-design).</span></span>

### <a name="load-balancers"></a><span data-ttu-id="105f4-198">Balanceadores de carga</span><span class="sxs-lookup"><span data-stu-id="105f4-198">Load balancers</span></span>

<span data-ttu-id="105f4-199">O [SAP Web Dispatcher](https://help.sap.com/doc/saphelp_nw73ehp1/7.31.19/en-US/48/8fe37933114e6fe10000000a421937/frameset.htm) lida com o balanceamento de carga do tráfego HTTP(S) incluindo aplicativos do estilo do Fiori a um pool de servidores de aplicativos SAP.</span><span class="sxs-lookup"><span data-stu-id="105f4-199">[SAP Web Dispatcher](https://help.sap.com/doc/saphelp_nw73ehp1/7.31.19/en-US/48/8fe37933114e6fe10000000a421937/frameset.htm) handles load balancing of HTTP(S) traffic including Fiori style applications to a pool of SAP application servers.</span></span>

<span data-ttu-id="105f4-200">Para o tráfego de clientes do SAP GUI se conectando a um servidor SAP via DIAG ou RFC (Remote Function Calls), o servidor de mensagens do Central Services faz o balanceamento da carga por meio de [grupos de logon](https://wiki.scn.sap.com/wiki/display/SI/ABAP+Logon+Group+based+Load+Balancing) do servidor de aplicativos SAP, não sendo necessário nenhum balanceador de carga adicional.</span><span class="sxs-lookup"><span data-stu-id="105f4-200">For traffic from SAP GUI clients connecting a SAP server via DIAG or Remote Function Calls (RFC), the Central Service message server balances the load through SAP application server [logon groups](https://wiki.scn.sap.com/wiki/display/SI/ABAP+Logon+Group+based+Load+Balancing), so no additional load balancer is needed.</span></span>

### <a name="azure-storage"></a><span data-ttu-id="105f4-201">Armazenamento do Azure</span><span class="sxs-lookup"><span data-stu-id="105f4-201">Azure Storage</span></span>

<span data-ttu-id="105f4-202">É recomendável usar o Armazenamento Premium do Azure para as máquinas de virtuais do servidor de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="105f4-202">We recommend using Azure Premium Storage for the database server virtual machines.</span></span> <span data-ttu-id="105f4-203">O armazenamento Premium oferece latência de leitura/gravação consistente.</span><span class="sxs-lookup"><span data-stu-id="105f4-203">Premium storage provides consistent read/write latency.</span></span> <span data-ttu-id="105f4-204">Para obter detalhes sobre o uso do Armazenamento Premium para os discos do sistema operacional e os discos de dados de uma máquina de instância única, veja [SLA para máquinas virtuais](https://azure.microsoft.com/support/legal/sla/virtual-machines/).</span><span class="sxs-lookup"><span data-stu-id="105f4-204">For details about using Premium Storage for the operating system disks and data disks of a single-instance virtual machine, see [SLA for Virtual Machines](https://azure.microsoft.com/support/legal/sla/virtual-machines/).</span></span>

<span data-ttu-id="105f4-205">Para todos os sistemas SAP de produção, é recomendável usar o [Azure Managed Disks](/azure/storage/storage-managed-disks-overview) Premium.</span><span class="sxs-lookup"><span data-stu-id="105f4-205">For all production SAP systems, we recommend using Premium [Azure Managed Disks](/azure/storage/storage-managed-disks-overview).</span></span> <span data-ttu-id="105f4-206">Os Managed Disks são usados para gerenciar os arquivos VHD dos discos, adicionando confiabilidade.</span><span class="sxs-lookup"><span data-stu-id="105f4-206">Managed Disks are used to manage the VHD files for the disks, adding reliability.</span></span> <span data-ttu-id="105f4-207">Eles também garantem que os discos para máquinas virtuais dentro de um conjunto de disponibilidade fiquem isolados para evitar pontos únicos de falha.</span><span class="sxs-lookup"><span data-stu-id="105f4-207">They also ensure that the disks for virtual machines within an availability set are isolated to avoid single points of failure.</span></span>

<span data-ttu-id="105f4-208">Para servidores de aplicativos SAP, incluindo as máquinas virtuais do Central Services, é possível usar o Armazenamento Padrão do Azure para reduzir os custos, uma vez que a execução do aplicativo ocorre na memória e usa os discos somente para registro em log.</span><span class="sxs-lookup"><span data-stu-id="105f4-208">For SAP application servers, including the Central Services virtual machines, you can use Azure Standard Storage to reduce cost, because application execution takes place in memory and uses disks for logging only.</span></span> <span data-ttu-id="105f4-209">No entanto, neste momento, o Armazenamento Padrão só está certificado para armazenamento não gerenciado.</span><span class="sxs-lookup"><span data-stu-id="105f4-209">However, at this time, Standard Storage is only certified for unmanaged storage.</span></span> <span data-ttu-id="105f4-210">Uma vez que os servidores de aplicativos não hospedam nenhum dado, também é possível usar os discos menores de Armazenamento Premium P4 e P6 para ajudar a minimizar o custo.</span><span class="sxs-lookup"><span data-stu-id="105f4-210">Since application servers do not host any data, you can also use the smaller P4 and P6 Premium Storage disks to help minimize cost.</span></span>

<span data-ttu-id="105f4-211">Para o repositório de dados de backup, é recomendável usar a [camada de acesso esporádico e/ou o armazenamento da camada de acesso de arquivos](/azure/storage/storage-blob-storage-tiers) do Azure.</span><span class="sxs-lookup"><span data-stu-id="105f4-211">For the backup data store, we recommend using Azure [cool access tier storage and/or archive access tier storage](/azure/storage/storage-blob-storage-tiers).</span></span> <span data-ttu-id="105f4-212">Essas camadas de armazenamento são maneiras econômicas para armazenar dados de longa vida útil que são acessados com menos frequência.</span><span class="sxs-lookup"><span data-stu-id="105f4-212">These storage tiers are cost-effective ways to store long-lived data that is less frequently accessed.</span></span>

## <a name="performance-considerations"></a><span data-ttu-id="105f4-213">Considerações sobre o desempenho</span><span class="sxs-lookup"><span data-stu-id="105f4-213">Performance considerations</span></span>

<span data-ttu-id="105f4-214">Os servidores de aplicativos SAP realizam constantes comunicações com os servidores de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="105f4-214">SAP application servers carry on constant communications with the database servers.</span></span> <span data-ttu-id="105f4-215">Para as máquinas virtuais de banco de dados HANA, considere habilitar o [Acelerador de Gravação](/azure/virtual-machines/linux/how-to-enable-write-accelerator) para melhorar a latência da gravação de logs.</span><span class="sxs-lookup"><span data-stu-id="105f4-215">For the HANA database virtual machines, consider enabling [Write Accelerator](/azure/virtual-machines/linux/how-to-enable-write-accelerator) to improve log write latency.</span></span> <span data-ttu-id="105f4-216">Para otimizar as comunicações entre servidores, use a [Rede Acelerada](https://azure.microsoft.com/blog/linux-and-windows-networking-performance-enhancements-accelerated-networking/).</span><span class="sxs-lookup"><span data-stu-id="105f4-216">To optimize inter-server communications, use the [Accelerated Network](https://azure.microsoft.com/blog/linux-and-windows-networking-performance-enhancements-accelerated-networking/).</span></span> <span data-ttu-id="105f4-217">Observe que esses aceleradores estão disponíveis apenas para determinadas séries de VM.</span><span class="sxs-lookup"><span data-stu-id="105f4-217">Note that these accelerators are available only for certain VM series.</span></span>

<span data-ttu-id="105f4-218">Para obter altas IOPS e taxas de transferências de largura de banda de disco, as práticas comuns na [otimização de desempenho](/azure/virtual-machines/linux/premium-storage-performance) do volume de armazenamento se aplicam ao layout de armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="105f4-218">To achieve high IOPS and disk bandwidth throughput, the common practices in storage volume [performance optimization](/azure/virtual-machines/linux/premium-storage-performance) apply to Azure storage layout.</span></span> <span data-ttu-id="105f4-219">Por exemplo, a combinação de vários discos em conjunto para criar um volume de discos distribuídos melhora o desempenho de E/S.</span><span class="sxs-lookup"><span data-stu-id="105f4-219">For example, combining multiple disks together to create a striped disk volume improves IO performance.</span></span> <span data-ttu-id="105f4-220">Habilitar o cache de leitura do conteúdo de armazenamento que raramente é alterado melhora a velocidade de recuperação de dados.</span><span class="sxs-lookup"><span data-stu-id="105f4-220">Enabling the read cache on storage content that changes infrequently enhances the speed of data retrieval.</span></span> <span data-ttu-id="105f4-221">Para obter detalhes sobre os requisitos de desempenho, consulte [Nota SAP 1943937 - Ferramenta de verificação de configuração de hardware](https://launchpad.support.sap.com/#/notes/1943937) (conta do SAP Service Marketplace necessária para o acesso).</span><span class="sxs-lookup"><span data-stu-id="105f4-221">For details about performance requirements, see [SAP note 1943937 - Hardware Configuration Check Tool](https://launchpad.support.sap.com/#/notes/1943937) (SAP Service Marketplace account required for access).</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="105f4-222">Considerações sobre escalabilidade</span><span class="sxs-lookup"><span data-stu-id="105f4-222">Scalability considerations</span></span>

<span data-ttu-id="105f4-223">Na camada de aplicativo SAP, o Azure oferece uma ampla variedade de tamanhos de máquina virtual para escalar vertical ou horizontalmente. Para obter uma lista inclusiva, confira a [Nota SAP 1928533](https://launchpad.support.sap.com/#/notes/1928533) - Aplicativos SAP no Azure: Produtos e tipos de VM do Azure com suporte (é necessário ter uma conta do SAP Service Marketplace para ter acesso).</span><span class="sxs-lookup"><span data-stu-id="105f4-223">At the SAP application layer, Azure offers a wide range of virtual machine sizes for scaling up and scaling out. For an inclusive list, see [SAP Note 1928533](https://launchpad.support.sap.com/#/notes/1928533) - SAP Applications on Azure: Supported Products and Azure VM types (SAP Service Marketplace account required for access).</span></span> <span data-ttu-id="105f4-224">Conforme continuamos a certificar mais tipos de máquinas virtuais, você pode expandir ou reduzir com a mesma implantação de nuvem.</span><span class="sxs-lookup"><span data-stu-id="105f4-224">As we continue to certify more virtual machines types, you can scale up or down with the same cloud deployment.</span></span>

<span data-ttu-id="105f4-225">Na camada de banco de dados, essa arquitetura executa o HANA em máquinas virtuais.</span><span class="sxs-lookup"><span data-stu-id="105f4-225">At the database layer, this architecture runs HANA on VMs.</span></span> <span data-ttu-id="105f4-226">Se sua carga de trabalho exceder o tamanho máximo da VM, a Microsoft também oferecerá [Instâncias Grandes do Azure](/azure/virtual-machines/workloads/sap/hana-overview-architecture) para o SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="105f4-226">If your workload exceeds the maximum VM size, Microsoft also offers [Azure Large Instances](/azure/virtual-machines/workloads/sap/hana-overview-architecture) for SAP HANA.</span></span> <span data-ttu-id="105f4-227">Esses servidores físicos são colocados em um datacenter certificado do Microsoft Azure e, no momento da redação deste artigo, forneça até 20 TB de capacidade de memória para uma única instância.</span><span class="sxs-lookup"><span data-stu-id="105f4-227">These physical servers are co-located in a Microsoft Azure certified datacenter and as of this writing, provide up to 20 TB of memory capacity for a single instance.</span></span> <span data-ttu-id="105f4-228">Uma configuração de vários nós também é possível com uma capacidade de memória total de até 60 TB.</span><span class="sxs-lookup"><span data-stu-id="105f4-228">Multi-node configuration is also possible with a total memory capacity of up to 60 TB.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="105f4-229">Considerações sobre disponibilidade</span><span class="sxs-lookup"><span data-stu-id="105f4-229">Availability considerations</span></span>

<span data-ttu-id="105f4-230">A redundância de recursos é o tema geral em soluções de infraestrutura altamente disponíveis.</span><span class="sxs-lookup"><span data-stu-id="105f4-230">Resource redundancy is the general theme in highly available infrastructure solutions.</span></span> <span data-ttu-id="105f4-231">Para empresas que contam com um SLA menos rigoroso, as máquinas virtuais de instância única do Azure oferecem um SLA de tempo de atividade.</span><span class="sxs-lookup"><span data-stu-id="105f4-231">For enterprises that have a less stringent SLA, single-instance Azure VMs offer an uptime SLA.</span></span> <span data-ttu-id="105f4-232">Para obter mais informações, confira [Contrato de Nível de Serviço do Azure](https://azure.microsoft.com/support/legal/sla/).</span><span class="sxs-lookup"><span data-stu-id="105f4-232">For more information, see [Azure Service Level Agreement](https://azure.microsoft.com/support/legal/sla/).</span></span>

<span data-ttu-id="105f4-233">Nessa instalação distribuída do aplicativo SAP, a instalação básica é replicada para obter a alta disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="105f4-233">In this distributed installation of the SAP application, the base installation is replicated to achieve high availability.</span></span> <span data-ttu-id="105f4-234">O design de alta disponibilidade varia para cada camada da arquitetura.</span><span class="sxs-lookup"><span data-stu-id="105f4-234">For each layer of the architecture, the high availability design varies.</span></span>

### <a name="application-tier"></a><span data-ttu-id="105f4-235">Camada de aplicativo</span><span class="sxs-lookup"><span data-stu-id="105f4-235">Application tier</span></span>

- <span data-ttu-id="105f4-236">Web Dispatcher.</span><span class="sxs-lookup"><span data-stu-id="105f4-236">Web Dispatcher.</span></span> <span data-ttu-id="105f4-237">A alta disponibilidade é obtida com instâncias redundantes do Web Dispatcher.</span><span class="sxs-lookup"><span data-stu-id="105f4-237">High availability is achieved with redundant Web Dispatcher instances.</span></span> <span data-ttu-id="105f4-238">Veja [SAP Web Dispatcher](https://help.sap.com/doc/saphelp_nw70ehp2/7.02.16/en-us/48/8fe37933114e6fe10000000a421937/frameset.htm) na documentação do SAP.</span><span class="sxs-lookup"><span data-stu-id="105f4-238">See [SAP Web Dispatcher](https://help.sap.com/doc/saphelp_nw70ehp2/7.02.16/en-us/48/8fe37933114e6fe10000000a421937/frameset.htm) in the SAP documentation.</span></span>
- <span data-ttu-id="105f4-239">Servidores Fiori.</span><span class="sxs-lookup"><span data-stu-id="105f4-239">Fiori servers.</span></span> <span data-ttu-id="105f4-240">A alta disponibilidade é obtida pelo tráfego de balanceamento de carga dentro de um pool de servidores.</span><span class="sxs-lookup"><span data-stu-id="105f4-240">High availability is achieved by load balancing traffic within a pool of servers.</span></span>
- <span data-ttu-id="105f4-241">Central Services.</span><span class="sxs-lookup"><span data-stu-id="105f4-241">Central Services.</span></span> <span data-ttu-id="105f4-242">Para a alta disponibilidade do Central Services em Máquinas Virtuais do Linux do Azure, a Extensão de Alta Disponibilidade apropriada para a distribuição Linux selecionada é usada, e o cluster NFS altamente disponível hospeda o armazenamento DRBD.</span><span class="sxs-lookup"><span data-stu-id="105f4-242">For high availability of Central Services on Azure Linux virtual machines, the appropriate High Availability Extension for the selected Linux distribution is used, and the highly available NFS cluster hosts DRBD storage.</span></span>
- <span data-ttu-id="105f4-243">Servidores de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="105f4-243">Application servers.</span></span> <span data-ttu-id="105f4-244">A alta disponibilidade é obtida pelo tráfego de balanceamento de carga dentro de um pool de servidores de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="105f4-244">High availability is achieved by load balancing traffic within a pool of application servers.</span></span>

### <a name="database-tier"></a><span data-ttu-id="105f4-245">Camada de banco de dados</span><span class="sxs-lookup"><span data-stu-id="105f4-245">Database tier</span></span>

<span data-ttu-id="105f4-246">Essa arquitetura de referência descreve um sistema altamente disponível de banco de dados SAP HANA com duas máquinas virtuais do Azure.</span><span class="sxs-lookup"><span data-stu-id="105f4-246">This reference architecture depicts a highly available SAP HANA database system consisting of two Azure virtual machines.</span></span> <span data-ttu-id="105f4-247">O recurso de replicação de sistema nativo da camada de banco de dados fornece o failover manual ou automático entre nós replicados:</span><span class="sxs-lookup"><span data-stu-id="105f4-247">The database tier's native system replication feature provides either manual or automatic failover between replicated nodes:</span></span>

- <span data-ttu-id="105f4-248">Para failover manual, implante mais de uma instância do HANA e use a Replicação de Sistema do HANA (HSR).</span><span class="sxs-lookup"><span data-stu-id="105f4-248">For manual failover, deploy more than one HANA instance and use HANA System Replication (HSR).</span></span>
- <span data-ttu-id="105f4-249">Para failover automático, use HSR e a Extensão de Alta Disponibilidade (HAE) do Linux para sua distribuição Linux.</span><span class="sxs-lookup"><span data-stu-id="105f4-249">For automatic failover, use both HSR and Linux High Availability Extension (HAE) for your Linux distribution.</span></span> <span data-ttu-id="105f4-250">O HAE Linux fornece os serviços de cluster para os recursos do HANA, detecção de eventos de falha e orquestração do failover de serviços problemáticos para o nó íntegro.</span><span class="sxs-lookup"><span data-stu-id="105f4-250">Linux HAE provides the cluster services to the HANA resources, detecting failure events and orchestrating the failover of errant services to the healthy node.</span></span>

<span data-ttu-id="105f4-251">Veja [Certificações e configurações da SAP em execução no Microsoft Azure](/azure/virtual-machines/workloads/sap/sap-certifications).</span><span class="sxs-lookup"><span data-stu-id="105f4-251">See [SAP certifications and configurations running on Microsoft Azure](/azure/virtual-machines/workloads/sap/sap-certifications).</span></span>

### <a name="disaster-recovery-considerations"></a><span data-ttu-id="105f4-252">Considerações de recuperação de desastres</span><span class="sxs-lookup"><span data-stu-id="105f4-252">Disaster recovery considerations</span></span>

<span data-ttu-id="105f4-253">Cada camada usa uma estratégia diferente para fornecer proteção de recuperação de desastres.</span><span class="sxs-lookup"><span data-stu-id="105f4-253">Each tier uses a different strategy to provide disaster recovery (DR) protection.</span></span>

- <span data-ttu-id="105f4-254">**Camada de servidores de aplicativos**.</span><span class="sxs-lookup"><span data-stu-id="105f4-254">**Application servers tier**.</span></span> <span data-ttu-id="105f4-255">Os servidores de aplicativos SAP não contêm dados corporativos.</span><span class="sxs-lookup"><span data-stu-id="105f4-255">SAP application servers do not contain business data.</span></span> <span data-ttu-id="105f4-256">No Azure, uma estratégia simples de DR é criar servidores de aplicativos SAP na região secundária, depois tirá-los do ar.</span><span class="sxs-lookup"><span data-stu-id="105f4-256">On Azure, a simple DR strategy is to create SAP application servers in the secondary region, then shut them down.</span></span> <span data-ttu-id="105f4-257">Após quaisquer alterações de configuração ou atualizações de kernel no servidor de aplicativo primário, as mesmas alterações devem ser aplicadas às máquinas virtuais na região secundária.</span><span class="sxs-lookup"><span data-stu-id="105f4-257">Upon any configuration changes or kernel updates on the primary application server, the same changes must be applied to the virtual machines in the secondary region.</span></span> <span data-ttu-id="105f4-258">Por exemplo, copie os executáveis de kernel do SAP para as máquinas virtuais de recuperação de desastre.</span><span class="sxs-lookup"><span data-stu-id="105f4-258">For example, copy the SAP kernel executables to the DR virtual machines.</span></span> <span data-ttu-id="105f4-259">Para a replicação automática dos servidores de aplicativos para uma região secundária, o [Azure Site Recovery](/azure/site-recovery/site-recovery-overview) é a solução recomendada.</span><span class="sxs-lookup"><span data-stu-id="105f4-259">For automatic replication of application servers to a secondary region, [Azure Site Recovery](/azure/site-recovery/site-recovery-overview) is the recommended solution.</span></span> <span data-ttu-id="105f4-260">No momento da preparação deste documento, o ASR ainda não dá suporte à replicação da configuração de Rede Acelerada em VMs do Azure.</span><span class="sxs-lookup"><span data-stu-id="105f4-260">As of the writing of this paper, ASR doesn't yet support the replication of the Accelerated Network configuration setting in Azure VMs.</span></span>

- <span data-ttu-id="105f4-261">**Central Services**.</span><span class="sxs-lookup"><span data-stu-id="105f4-261">**Central Services**.</span></span> <span data-ttu-id="105f4-262">Esse componente da pilha do aplicativo SAP também não persiste dados corporativos.</span><span class="sxs-lookup"><span data-stu-id="105f4-262">This component of the SAP application stack also does not persist business data.</span></span> <span data-ttu-id="105f4-263">Você pode criar uma VM na região secundária para executar a função do Central Services.</span><span class="sxs-lookup"><span data-stu-id="105f4-263">You can build a VM in the secondary region to run the Central Services role.</span></span> <span data-ttu-id="105f4-264">O único conteúdo do nó do Central Services primário a ser sincronizado é o conteúdo compartilhado /sapmnt.</span><span class="sxs-lookup"><span data-stu-id="105f4-264">The only content from the primary Central Services node to synchronize is the /sapmnt share content.</span></span> <span data-ttu-id="105f4-265">Além disso, se as configurações mudarem ou ocorrerem atualizações de kernel em servidores primários do Central Services, elas devem ser repetidas na VM na região secundária sendo executada no Central Services.</span><span class="sxs-lookup"><span data-stu-id="105f4-265">Also, if configuration changes or kernel updates take place on the primary Central Services servers, they must be repeated on the VM in the secondary region running Central Services.</span></span> <span data-ttu-id="105f4-266">Para sincronizar os dois servidores, você pode usar o Azure Site Recovery para replicar os nós de cluster ou simplesmente usar um trabalho de cópia agendado regularmente para copiar /sapmnt para o lado da recuperação de desastre.</span><span class="sxs-lookup"><span data-stu-id="105f4-266">To synchronize the two servers, you can use either Azure Site Recovery, to replicate the cluster nodes, or simply use a regularly scheduled copy job to copy /sapmnt to the DR side.</span></span> <span data-ttu-id="105f4-267">Para obter detalhes sobre a compilação, cópia e teste do processo de failover, baixe [SAP NetWeaver: Compilar uma solução de recuperação de desastre baseada em Hyper-V e no Microsoft Azure](https://download.microsoft.com/download/9/5/6/956FEDC3-702D-4EFB-A7D3-2DB7505566B6/SAP%20NetWeaver%20-%20Building%20an%20Azure%20based%20Disaster%20Recovery%20Solution%20V1_5%20.docx) e consulte a seção 4.3, "Camada SAP SPOF (ASCS)".</span><span class="sxs-lookup"><span data-stu-id="105f4-267">For details about the build, copy, and test failover process, download [SAP NetWeaver: Building a Hyper-V and Microsoft Azure–based Disaster Recovery Solution](https://download.microsoft.com/download/9/5/6/956FEDC3-702D-4EFB-A7D3-2DB7505566B6/SAP%20NetWeaver%20-%20Building%20an%20Azure%20based%20Disaster%20Recovery%20Solution%20V1_5%20.docx), and refer to section 4.3, "SAP SPOF layer (ASCS)."</span></span> <span data-ttu-id="105f4-268">Este artigo se aplica ao NetWeaver em execução no Windows, mas você pode criar a configuração equivalente para Linux.</span><span class="sxs-lookup"><span data-stu-id="105f4-268">This paper applies to NetWeaver running on Windows, but you can create the equivalent configuration for Linux.</span></span> <span data-ttu-id="105f4-269">Para o Central Services, use o [Azure Site Recovery](/en-us/azure/site-recovery/site-recovery-overview) para replicar os nós e o armazenamento do cluster.</span><span class="sxs-lookup"><span data-stu-id="105f4-269">For Central Services, use [Azure Site Recovery](/en-us/azure/site-recovery/site-recovery-overview) to replicate the cluster nodes and storage.</span></span> <span data-ttu-id="105f4-270">Para o Linux, crie um cluster geográfico de três nós usando uma Extensão de Alta Disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="105f4-270">For Linux, create a three node geo-cluster using a High Availability Extension.</span></span>

- <span data-ttu-id="105f4-271">**Camada de banco de dados do SAP**.</span><span class="sxs-lookup"><span data-stu-id="105f4-271">**SAP database tier**.</span></span> <span data-ttu-id="105f4-272">Use o HSR para replicação com suporte do HANA.</span><span class="sxs-lookup"><span data-stu-id="105f4-272">Use HSR for HANA-supported replication.</span></span> <span data-ttu-id="105f4-273">Além de uma configuração de alta disponibilidade local de dois nós, a HSR oferece suporte à replicação de várias camadas, em que um terceiro nó em uma região separada do Azure age como uma entidade estrangeira, que não faz parte do cluster, e é registrado na réplica secundária do par da HSR com cluster como seu destino de replicação.</span><span class="sxs-lookup"><span data-stu-id="105f4-273">In addition to a local, two-node high availability setup, HSR supports multi-tier replication where a third node in a separate Azure region acts as a foreign entity, not part of the cluster, and registers to the secondary replica of the clustered HSR pair as its replication target.</span></span> <span data-ttu-id="105f4-274">Isso forma uma corrente encadeada de replicação.</span><span class="sxs-lookup"><span data-stu-id="105f4-274">This form a replication daisy chain.</span></span> <span data-ttu-id="105f4-275">O failover para o nó de recuperação de desastre é um processo manual.</span><span class="sxs-lookup"><span data-stu-id="105f4-275">The failover to the DR node is a manual process.</span></span>

<span data-ttu-id="105f4-276">Para usar o Azure Site Recovery para compilar automaticamente um site de produção totalmente replicado do original, você deve executar [scripts de implantação](/azure/site-recovery/site-recovery-runbook-automation) personalizados.</span><span class="sxs-lookup"><span data-stu-id="105f4-276">To use Azure Site Recovery to automatically build a fully replicated production site of your original, you must run customized [deployment scripts](/azure/site-recovery/site-recovery-runbook-automation).</span></span> <span data-ttu-id="105f4-277">Primeiro a recuperação de site implanta as máquinas virtuais em conjuntos de disponibilidade, depois executa scripts para adicionar recursos, como balanceadores de carga.</span><span class="sxs-lookup"><span data-stu-id="105f4-277">Site Recovery first deploys the virtual machines in availability sets, then runs scripts to add resources such as load balancers.</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="105f4-278">Considerações sobre capacidade de gerenciamento</span><span class="sxs-lookup"><span data-stu-id="105f4-278">Manageability considerations</span></span>

<span data-ttu-id="105f4-279">O SAP HANA tem um recurso de backup que usa a infraestrutura subjacente do Azure.</span><span class="sxs-lookup"><span data-stu-id="105f4-279">SAP HANA has a backup feature that makes use of the underlying Azure infrastructure.</span></span> <span data-ttu-id="105f4-280">Para fazer backup do banco de dados do SAP HANA em execução em máquinas virtuais do Azure, o instantâneo do armazenamento do Azure e o instantâneo do SAP HANA são usados para garantir a consistência dos arquivos de backup.</span><span class="sxs-lookup"><span data-stu-id="105f4-280">To back up the SAP HANA database running on Azure virtual machines, both the SAP HANA snapshot and Azure storage snapshot are used to ensure the backup files' consistency.</span></span> <span data-ttu-id="105f4-281">Para obter detalhes, veja o [Guia de backup para o SAP HANA em máquinas virtuais do Azure](/azure/virtual-machines/workloads/sap/sap-hana-backup-guide) e [Perguntas frequentes sobre o serviço de Backup do Azure](/azure/backup/backup-azure-backup-faq).</span><span class="sxs-lookup"><span data-stu-id="105f4-281">For details, see [Backup guide for SAP HANA on Azure Virtual Machines](/azure/virtual-machines/workloads/sap/sap-hana-backup-guide) and the [Azure Backup service FAQ](/azure/backup/backup-azure-backup-faq).</span></span> <span data-ttu-id="105f4-282">Somente as implantações de contêiner único do HANA oferecem suporte a instantâneos de armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="105f4-282">Only HANA single container deployments support Azure storage snapshot.</span></span>

### <a name="identity-management"></a><span data-ttu-id="105f4-283">Gerenciamento de identidades</span><span class="sxs-lookup"><span data-stu-id="105f4-283">Identity management</span></span>

<span data-ttu-id="105f4-284">Controle o acesso aos recursos usando um sistema de gerenciamento centralizado de identidades em todos os níveis:</span><span class="sxs-lookup"><span data-stu-id="105f4-284">Control access to resources by using a centralized identity management system at all levels:</span></span>

- <span data-ttu-id="105f4-285">Forneça acesso aos recursos do Azure por meio de [controle de acesso baseado em função](/azure/active-directory/role-based-access-control-what-is) (RBAC).</span><span class="sxs-lookup"><span data-stu-id="105f4-285">Provide access to Azure resources through [role-based access control](/azure/active-directory/role-based-access-control-what-is) (RBAC).</span></span>
- <span data-ttu-id="105f4-286">Conceda acesso às VMs do Azure por meio do LDAP, Azure Active Directory, Kerberos ou outro sistema.</span><span class="sxs-lookup"><span data-stu-id="105f4-286">Grant access to Azure VMs through LDAP, Azure Active Directory, Kerberos, or another system.</span></span>
- <span data-ttu-id="105f4-287">Ofereça suporte ao acesso de dentro dos próprios apps por meio dos serviços fornecidos pela SAP ou use o [OAuth 2.0 e o Azure Active Directory](/azure/active-directory/develop/active-directory-protocols-oauth-code).</span><span class="sxs-lookup"><span data-stu-id="105f4-287">Support access within the apps themselves through the services that SAP provides, or use [OAuth 2.0 and Azure Active Directory](/azure/active-directory/develop/active-directory-protocols-oauth-code).</span></span>

### <a name="monitoring"></a><span data-ttu-id="105f4-288">Monitoramento</span><span class="sxs-lookup"><span data-stu-id="105f4-288">Monitoring</span></span>

<span data-ttu-id="105f4-289">O Azure oferece várias funções para [monitoramento e diagnóstico](/azure/architecture/best-practices/monitoring) da infraestrutura geral.</span><span class="sxs-lookup"><span data-stu-id="105f4-289">Azure provides several functions for [monitoring and diagnostics](/azure/architecture/best-practices/monitoring) of the overall infrastructure.</span></span> <span data-ttu-id="105f4-290">Além disso, o monitoramento avançado de máquinas virtuais do Azure (Linux ou Windows) é tratado pelo Azure Operations Management Suite (OMS).</span><span class="sxs-lookup"><span data-stu-id="105f4-290">Also, enhanced monitoring of Azure virtual machines (Linux or Windows) is handled by Azure Operations Management Suite (OMS).</span></span>

<span data-ttu-id="105f4-291">Para fornecer monitoramento de recursos baseado na SAP e desempenho de serviço da infraestrutura da SAP, é usada a extensão [Monitoramento Avançado da SAP do Azure](/azure/virtual-machines/workloads/sap/deployment-guide#d98edcd3-f2a1-49f7-b26a-07448ceb60ca).</span><span class="sxs-lookup"><span data-stu-id="105f4-291">To provide SAP-based monitoring of resources and service performance of the SAP infrastructure, the [Azure SAP Enhanced Monitoring](/azure/virtual-machines/workloads/sap/deployment-guide#d98edcd3-f2a1-49f7-b26a-07448ceb60ca) extension is used.</span></span> <span data-ttu-id="105f4-292">Essa extensão fornece as estatísticas de monitoramento do Azure para o aplicativo SAP para monitoramento do sistema operacional e as funções da ferramenta cockpit de DBA.</span><span class="sxs-lookup"><span data-stu-id="105f4-292">This extension feeds Azure monitoring statistics into the SAP application for operating system monitoring and DBA Cockpit functions.</span></span> <span data-ttu-id="105f4-293">O monitoramento avançado do SAP é um pré-requisito obrigatório para executar o SAP no Azure.</span><span class="sxs-lookup"><span data-stu-id="105f4-293">SAP enhanced monitoring is a mandatory prerequisite to run SAP on Azure.</span></span> <span data-ttu-id="105f4-294">Verifique os detalhes na [nota do SAP 2191498](https://launchpad.support.sap.com/#/notes/2191498) – "SAP no Linux com o Azure: Monitoramento avançado."</span><span class="sxs-lookup"><span data-stu-id="105f4-294">For details, see [SAP Note 2191498](https://launchpad.support.sap.com/#/notes/2191498) – "SAP on Linux with Azure: Enhanced Monitoring."</span></span>

## <a name="security-considerations"></a><span data-ttu-id="105f4-295">Considerações de segurança</span><span class="sxs-lookup"><span data-stu-id="105f4-295">Security considerations</span></span>

<span data-ttu-id="105f4-296">O SAP tem seu próprio mecanismo de gerenciamento de usuários (UME) para controlar o acesso e a autorização baseados em função do aplicativo SAP.</span><span class="sxs-lookup"><span data-stu-id="105f4-296">SAP has its own Users Management Engine (UME) to control role-based access and authorization within the SAP application.</span></span> <span data-ttu-id="105f4-297">Para obter detalhes, veja [Segurança do SAP HANA — uma visão geral](https://archive.sap.com/documents/docs/DOC-62943) (uma conta da SAP Service Marketplace é necessária para o acesso).</span><span class="sxs-lookup"><span data-stu-id="105f4-297">For details, see [SAP HANA Security—An Overview](https://archive.sap.com/documents/docs/DOC-62943) (SAP Service Marketplace account required for access.)</span></span>

<span data-ttu-id="105f4-298">Para a segurança da rede adicional, cogite implementar uma [Rede de Perímetro](/azure/architecture/reference-architectures/dmz/secure-vnet-hybrid), a qual usa um dispositivo de rede virtual para criar um firewall na frente da sub-rede para o Web Dispatcher e pools de Servidores de Front-end Fiori.</span><span class="sxs-lookup"><span data-stu-id="105f4-298">For additional network security, consider implementing a [Network DMZ](/azure/architecture/reference-architectures/dmz/secure-vnet-hybrid), which uses a network virtual appliance to create a firewall in front of the subnet for Web Dispatcher and Fiori Front-End Server pools.</span></span>

<span data-ttu-id="105f4-299">Para a segurança da infraestrutura, os dados são criptografados em trânsito e em repouso.</span><span class="sxs-lookup"><span data-stu-id="105f4-299">For infrastructure security, data is encrypted in transit and at rest.</span></span> <span data-ttu-id="105f4-300">A seção "Considerações sobre segurança" do [SAP NetWeaver nas máquinas virtuais do Azure – Guia de planejamento e implementação](/azure/virtual-machines/workloads/sap/planning-guide) começa a tratar da segurança de rede e a aplica ao S/4HANA.</span><span class="sxs-lookup"><span data-stu-id="105f4-300">The "Security considerations" section of the [SAP NetWeaver on Azure Virtual Machines–Planning and Implementation Guide](/azure/virtual-machines/workloads/sap/planning-guide) begins to address network security and applies to S/4HANA.</span></span> <span data-ttu-id="105f4-301">O guia também especifica as portas de rede que você deve abrir nos firewalls para permitir a comunicação do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="105f4-301">The guide also specifies the network ports you must open on the firewalls to allow application communication.</span></span>

<span data-ttu-id="105f4-302">Para criptografar os discos de máquina virtual do IaaS Linux, você pode usar o [Azure Disk Encryption](/azure/security/azure-security-disk-encryption).</span><span class="sxs-lookup"><span data-stu-id="105f4-302">To encrypt Linux IaaS virtual machine disks, you can use [Azure Disk Encryption](/azure/security/azure-security-disk-encryption).</span></span> <span data-ttu-id="105f4-303">Ele usa o recurso DM-Crypt do Linux para fornecer criptografia de volume para o sistema operacional e os discos de dados.</span><span class="sxs-lookup"><span data-stu-id="105f4-303">It uses the DM-Crypt feature of Linux to provide volume encryption for the operating system and the data disks.</span></span> <span data-ttu-id="105f4-304">A solução também funciona com o Azure Key Vault para ajudá-lo a controlar e gerenciar os segredos e chaves de criptografia de disco em sua assinatura do Key Vault.</span><span class="sxs-lookup"><span data-stu-id="105f4-304">The solution also works with Azure Key Vault to help you control and manage the disk-encryption keys and secrets in your key vault subscription.</span></span> <span data-ttu-id="105f4-305">Os dados em discos da máquina virtual são criptografados em repouso no armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="105f4-305">Data on the virtual machine disks are encrypted at rest in your Azure storage.</span></span>

<span data-ttu-id="105f4-306">Para criptografia de dados em repouso do SAP HANA, é recomendável usar a tecnologia de criptografia nativa do SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="105f4-306">For SAP HANA data-at-rest encryption, we recommend using the SAP HANA native encryption technology.</span></span>

> [!NOTE]
> <span data-ttu-id="105f4-307">Não use a criptografia de dados em repouso HANA com Azure Disk Encryption no mesmo servidor.</span><span class="sxs-lookup"><span data-stu-id="105f4-307">Do not use the HANA data-at-rest encryption with Azure Disk Encryption on the same server.</span></span> <span data-ttu-id="105f4-308">Para o HANA, use somente a criptografia de dados do HANA.</span><span class="sxs-lookup"><span data-stu-id="105f4-308">For HANA, use only HANA data encryption.</span></span>

## <a name="communities"></a><span data-ttu-id="105f4-309">Comunidades</span><span class="sxs-lookup"><span data-stu-id="105f4-309">Communities</span></span>

<span data-ttu-id="105f4-310">As comunidades podem responder a perguntas e ajudá-lo a configurar uma implantação bem-sucedida.</span><span class="sxs-lookup"><span data-stu-id="105f4-310">Communities can answer questions and help you set up a successful deployment.</span></span> <span data-ttu-id="105f4-311">Considere o seguinte:</span><span class="sxs-lookup"><span data-stu-id="105f4-311">Consider the following:</span></span>

- [<span data-ttu-id="105f4-312">Como executar aplicativos SAP no blog Microsoft Platform</span><span class="sxs-lookup"><span data-stu-id="105f4-312">Running SAP Applications on the Microsoft Platform Blog</span></span>](https://blogs.msdn.microsoft.com/saponsqlserver/2017/05/04/sap-on-azure-general-update-for-customers-partners-april-2017/)
- [<span data-ttu-id="105f4-313">Suporte da Comunidade do Azure</span><span class="sxs-lookup"><span data-stu-id="105f4-313">Azure Community Support</span></span>](https://azure.microsoft.com/support/community/)
- [<span data-ttu-id="105f4-314">Comunidade do SAP</span><span class="sxs-lookup"><span data-stu-id="105f4-314">SAP Community</span></span>](https://www.sap.com/community.html)
- [<span data-ttu-id="105f4-315">Stack Overflow</span><span class="sxs-lookup"><span data-stu-id="105f4-315">Stack Overflow</span></span>](https://stackoverflow.com/tags/sap/)

## <a name="related-resources"></a><span data-ttu-id="105f4-316">Recursos relacionados</span><span class="sxs-lookup"><span data-stu-id="105f4-316">Related resources</span></span>

<span data-ttu-id="105f4-317">Talvez seja melhor examinar os seguintes [cenários de exemplo do Azure](/azure/architecture/example-scenario), que demonstram soluções específicas usando algumas das mesmas tecnologias:</span><span class="sxs-lookup"><span data-stu-id="105f4-317">You may wish to review the following [Azure example scenarios](/azure/architecture/example-scenario) that demonstrate specific solutions using some of the same technologies:</span></span>

- [<span data-ttu-id="105f4-318">Executando cargas de trabalho de produção do SAP usando um Oracle Database no Azure</span><span class="sxs-lookup"><span data-stu-id="105f4-318">Running SAP production workloads using an Oracle Database on Azure</span></span>](/azure/architecture/example-scenario/apps/sap-production)
- [<span data-ttu-id="105f4-319">Ambientes de desenvolvimento/teste para cargas de trabalho do SAP no Azure</span><span class="sxs-lookup"><span data-stu-id="105f4-319">Dev/test environments for SAP workloads on Azure</span></span>](/azure/architecture/example-scenario/apps/sap-dev-test)

<!-- links -->

[visio-download]: https://archcenter.blob.core.windows.net/cdn/sap-reference-architectures.vsdx
