---
title: Conectar uma rede local ao Azure usando o ExpressRoute
description: Como implementar uma arquitetura de rede site a site segura que abranja uma rede virtual do Azure e uma rede local conectada usando o Azure ExpressRoute.
author: telmosampaio
ms.date: 11/28/2016
pnp.series.title: Connect an on-premises network to Azure
pnp.series.next: expressroute-vpn-failover
pnp.series.prev: vpn
cardTitle: ExpressRoute
ms.openlocfilehash: ada07f399925da6da28b24260f5c73f1e106fd7d
ms.sourcegitcommit: c441fd165e6bebbbbbc19854ec6f3676be9c3b25
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/30/2018
---
# <a name="connect-an-on-premises-network-to-azure-using-expressroute"></a><span data-ttu-id="c99f0-103">Conectar uma rede local ao Azure usando o ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="c99f0-103">Connect an on-premises network to Azure using ExpressRoute</span></span>

<span data-ttu-id="c99f0-104">Essa arquitetura de referência mostra como conectar uma rede local a redes virtuais no Azure usando o [Azure ExpressRoute][expressroute-introduction].</span><span class="sxs-lookup"><span data-stu-id="c99f0-104">This reference architecture shows how to connect an on-premises network to virtual networks on Azure, using [Azure ExpressRoute][expressroute-introduction].</span></span> <span data-ttu-id="c99f0-105">Conexões do ExpressRoute usam uma conexão privada dedicada por meio de um provedor de conectividade de terceiros.</span><span class="sxs-lookup"><span data-stu-id="c99f0-105">ExpressRoute connections use a private, dedicated connection through a third-party connectivity provider.</span></span> <span data-ttu-id="c99f0-106">A conexão privada estende sua rede local para o Azure.</span><span class="sxs-lookup"><span data-stu-id="c99f0-106">The private connection extends your on-premises network into Azure.</span></span> [<span data-ttu-id="c99f0-107">**Implante essa solução**.</span><span class="sxs-lookup"><span data-stu-id="c99f0-107">**Deploy this solution**.</span></span>](#deploy-the-solution)

<span data-ttu-id="c99f0-108">![[0]][0]</span><span class="sxs-lookup"><span data-stu-id="c99f0-108">![[0]][0]</span></span>

<span data-ttu-id="c99f0-109">*Baixe um [Arquivo Visio][visio-download] dessa arquitetura.*</span><span class="sxs-lookup"><span data-stu-id="c99f0-109">*Download a [Visio file][visio-download] of this architecture.*</span></span>

## <a name="architecture"></a><span data-ttu-id="c99f0-110">Arquitetura</span><span class="sxs-lookup"><span data-stu-id="c99f0-110">Architecture</span></span>

<span data-ttu-id="c99f0-111">A arquitetura consiste nos componentes a seguir.</span><span class="sxs-lookup"><span data-stu-id="c99f0-111">The architecture consists of the following components.</span></span>

* <span data-ttu-id="c99f0-112">**Rede corporativa local**.</span><span class="sxs-lookup"><span data-stu-id="c99f0-112">**On-premises corporate network**.</span></span> <span data-ttu-id="c99f0-113">Uma rede de área local privada em execução dentro de uma organização.</span><span class="sxs-lookup"><span data-stu-id="c99f0-113">A private local-area network running within an organization.</span></span>

* <span data-ttu-id="c99f0-114">**Circuito do ExpressRoute**.</span><span class="sxs-lookup"><span data-stu-id="c99f0-114">**ExpressRoute circuit**.</span></span> <span data-ttu-id="c99f0-115">Um circuito de camada 2 ou de camada 3 fornecido pelo provedor de conectividade que une a rede local com o Azure por meio de roteadores de borda.</span><span class="sxs-lookup"><span data-stu-id="c99f0-115">A layer 2 or layer 3 circuit supplied by the connectivity provider that joins the on-premises network with Azure through the edge routers.</span></span> <span data-ttu-id="c99f0-116">O circuito usa a infraestrutura de hardware gerenciada pelo provedor de conectividade.</span><span class="sxs-lookup"><span data-stu-id="c99f0-116">The circuit uses the hardware infrastructure managed by the connectivity provider.</span></span>

* <span data-ttu-id="c99f0-117">**Roteadores de borda locais**.</span><span class="sxs-lookup"><span data-stu-id="c99f0-117">**Local edge routers**.</span></span> <span data-ttu-id="c99f0-118">Roteadores que se conectam a rede local ao circuito gerenciado pelo provedor.</span><span class="sxs-lookup"><span data-stu-id="c99f0-118">Routers that connect the on-premises network to the circuit managed by the provider.</span></span> <span data-ttu-id="c99f0-119">Dependendo de como sua conexão é provisionada, talvez seja necessário fornecer endereços IP públicos usados pelos roteadores.</span><span class="sxs-lookup"><span data-stu-id="c99f0-119">Depending on how your connection is provisioned, you may need to provide the public IP addresses used by the routers.</span></span>
* <span data-ttu-id="c99f0-120">**Roteadores de borda da Microsoft**.</span><span class="sxs-lookup"><span data-stu-id="c99f0-120">**Microsoft edge routers**.</span></span> <span data-ttu-id="c99f0-121">Dois roteadores em uma configuração altamente disponível de tipo ativo-ativo.</span><span class="sxs-lookup"><span data-stu-id="c99f0-121">Two routers in an active-active highly available configuration.</span></span> <span data-ttu-id="c99f0-122">Esses roteadores permitem que um provedor de conectividade conecte seus circuitos diretamente ao seu datacenter.</span><span class="sxs-lookup"><span data-stu-id="c99f0-122">These routers enable a connectivity provider to connect their circuits directly to their datacenter.</span></span> <span data-ttu-id="c99f0-123">Dependendo de como sua conexão é provisionada, talvez seja necessário fornecer endereços IP públicos usados pelos roteadores.</span><span class="sxs-lookup"><span data-stu-id="c99f0-123">Depending on how your connection is provisioned, you may need to provide the public IP addresses used by the routers.</span></span>

* <span data-ttu-id="c99f0-124">**Redes virtuais do Azure (VNets)**.</span><span class="sxs-lookup"><span data-stu-id="c99f0-124">**Azure virtual networks (VNets)**.</span></span> <span data-ttu-id="c99f0-125">Cada VNet reside em uma única região do Azure e pode hospedar várias camadas de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="c99f0-125">Each VNet resides in a single Azure region, and can host multiple application tiers.</span></span> <span data-ttu-id="c99f0-126">As camadas de aplicativo podem ser segmentadas usando sub-redes em cada VNet.</span><span class="sxs-lookup"><span data-stu-id="c99f0-126">Application tiers can be segmented using subnets in each VNet.</span></span>

* <span data-ttu-id="c99f0-127">**Serviços públicos do Azure**.</span><span class="sxs-lookup"><span data-stu-id="c99f0-127">**Azure public services**.</span></span> <span data-ttu-id="c99f0-128">Serviços do Azure que podem ser usados em um aplicativo híbrido.</span><span class="sxs-lookup"><span data-stu-id="c99f0-128">Azure services that can be used within a hybrid application.</span></span> <span data-ttu-id="c99f0-129">Esses serviços também estão disponíveis na Internet, mas acessá-los usando um circuito do ExpressRoute fornece baixa latência e desempenho mais previsível, porque o tráfego não passa pela Internet.</span><span class="sxs-lookup"><span data-stu-id="c99f0-129">These services are also available over the Internet, but accessing them using an ExpressRoute circuit provides low latency and more predictable performance, because traffic does not go through the Internet.</span></span> <span data-ttu-id="c99f0-130">Conexões são executadas usando [emparelhamento público][expressroute-peering], com os endereços pertencentes à sua organização ou fornecidos pelo seu provedor de conectividade.</span><span class="sxs-lookup"><span data-stu-id="c99f0-130">Connections are performed using [public peering][expressroute-peering], with addresses that are either owned by your organization or supplied by your connectivity provider.</span></span>

* <span data-ttu-id="c99f0-131">**Serviços do Office 365**.</span><span class="sxs-lookup"><span data-stu-id="c99f0-131">**Office 365 services**.</span></span> <span data-ttu-id="c99f0-132">Os serviços fornecidos pela Microsoft e aplicativos do Office 365 publicamente disponíveis.</span><span class="sxs-lookup"><span data-stu-id="c99f0-132">The publicly available Office 365 applications and services provided by Microsoft.</span></span> <span data-ttu-id="c99f0-133">Conexões são realizadas usando [emparelhamento da Microsoft][expressroute-peering], com os endereços pertencentes à sua organização ou fornecidos pelo seu provedor de conectividade.</span><span class="sxs-lookup"><span data-stu-id="c99f0-133">Connections are performed using [Microsoft peering][expressroute-peering], with addresses that are either owned by your organization or supplied by your connectivity provider.</span></span> <span data-ttu-id="c99f0-134">Você também pode se conectar diretamente ao Microsoft CRM Online por meio do emparelhamento da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="c99f0-134">You can also connect directly to Microsoft CRM Online through Microsoft peering.</span></span>

* <span data-ttu-id="c99f0-135">**Provedores de conectividade** (não mostrados).</span><span class="sxs-lookup"><span data-stu-id="c99f0-135">**Connectivity providers** (not shown).</span></span> <span data-ttu-id="c99f0-136">Empresas que fornecem uma conexão usando conectividade de camada 2 ou camada 3 entre o seu datacenter e um datacenter do Azure.</span><span class="sxs-lookup"><span data-stu-id="c99f0-136">Companies that provide a connection either using layer 2 or layer 3 connectivity between your datacenter and an Azure datacenter.</span></span>

## <a name="recommendations"></a><span data-ttu-id="c99f0-137">Recomendações</span><span class="sxs-lookup"><span data-stu-id="c99f0-137">Recommendations</span></span>

<span data-ttu-id="c99f0-138">As seguintes recomendações aplicam-se à maioria dos cenários.</span><span class="sxs-lookup"><span data-stu-id="c99f0-138">The following recommendations apply for most scenarios.</span></span> <span data-ttu-id="c99f0-139">Siga estas recomendações, a menos que você tenha um requisito específico que as substitua.</span><span class="sxs-lookup"><span data-stu-id="c99f0-139">Follow these recommendations unless you have a specific requirement that overrides them.</span></span>

### <a name="connectivity-providers"></a><span data-ttu-id="c99f0-140">Provedores de conectividade</span><span class="sxs-lookup"><span data-stu-id="c99f0-140">Connectivity providers</span></span>

<span data-ttu-id="c99f0-141">Selecione um provedor de conectividade do ExpressRoute adequado para sua localização.</span><span class="sxs-lookup"><span data-stu-id="c99f0-141">Select a suitable ExpressRoute connectivity provider for your location.</span></span> <span data-ttu-id="c99f0-142">Para obter uma lista de provedores de conectividade disponíveis no local, use o seguinte comando do Azure PowerShell:</span><span class="sxs-lookup"><span data-stu-id="c99f0-142">To get a list of connectivity providers available at your location, use the following Azure PowerShell command:</span></span>

```powershell
Get-AzureRmExpressRouteServiceProvider
```

<span data-ttu-id="c99f0-143">Provedores de conectividade do ExpressRoute conectam seu datacenter à Microsoft das seguintes maneiras:</span><span class="sxs-lookup"><span data-stu-id="c99f0-143">ExpressRoute connectivity providers connect your datacenter to Microsoft in the following ways:</span></span>

* <span data-ttu-id="c99f0-144">**Colocalizado em uma troca de nuvem**.</span><span class="sxs-lookup"><span data-stu-id="c99f0-144">**Co-located at a cloud exchange**.</span></span> <span data-ttu-id="c99f0-145">Se você estiver colocalizado em uma instalação que tenha uma troca de nuvem, poderá solicitar conexões cruzadas virtuais ao Azure por meio da troca Ethernet do provedor da colocalização.</span><span class="sxs-lookup"><span data-stu-id="c99f0-145">If you're co-located in a facility with a cloud exchange, you can order virtual cross-connections to Azure through the co-location provider’s Ethernet exchange.</span></span> <span data-ttu-id="c99f0-146">Os provedores da colocalização podem oferecer conexões cruzadas de camada 2 ou conexões cruzadas gerenciadas de camada 3 entre sua infraestrutura na instalação de colocalização e o Azure.</span><span class="sxs-lookup"><span data-stu-id="c99f0-146">Co-location providers can offer either layer 2 cross-connections, or managed layer 3 cross-connections between your infrastructure in the co-location facility and Azure.</span></span>
* <span data-ttu-id="c99f0-147">**Conexões Ethernet ponto a ponto**.</span><span class="sxs-lookup"><span data-stu-id="c99f0-147">**Point-to-point Ethernet connections**.</span></span> <span data-ttu-id="c99f0-148">Você pode conectar seus data centers/escritórios locais ao Azure por meio de links de Ethernet ponto a ponto.</span><span class="sxs-lookup"><span data-stu-id="c99f0-148">You can connect your on-premises datacenters/offices to Azure through point-to-point Ethernet links.</span></span> <span data-ttu-id="c99f0-149">Os provedores de Ethernet ponto a ponto podem oferecer conexões de camada 2 ou conexões gerenciadas de camada 3 entre seu site e o Azure.</span><span class="sxs-lookup"><span data-stu-id="c99f0-149">Point-to-point Ethernet providers can offer layer 2 connections, or managed layer 3 connections between your site and Azure.</span></span>
* <span data-ttu-id="c99f0-150">**Redes qualquer para qualquer (IPVPN)**.</span><span class="sxs-lookup"><span data-stu-id="c99f0-150">**Any-to-any (IPVPN) networks**.</span></span> <span data-ttu-id="c99f0-151">Você pode integrar sua WAN (rede de longa distância) com o Azure.</span><span class="sxs-lookup"><span data-stu-id="c99f0-151">You can integrate your wide area network (WAN) with Azure.</span></span> <span data-ttu-id="c99f0-152">Provedores de Internet IPVPN (rede virtual privada de protocolo IP), normalmente uma VPN de mudança de rótulo multiprotocolo, oferecem conectividade de qualquer para qualquer entre suas filiais e data centers.</span><span class="sxs-lookup"><span data-stu-id="c99f0-152">Internet protocol virtual private network (IPVPN) providers (typically a multiprotocol label switching VPN) offer any-to-any connectivity between your branch offices and datacenters.</span></span> <span data-ttu-id="c99f0-153">O Azure pode ser interconectado à sua WAN para que ela fique exatamente igual a qualquer outra filial.</span><span class="sxs-lookup"><span data-stu-id="c99f0-153">Azure can be interconnected to your WAN to make it look just like any other branch office.</span></span> <span data-ttu-id="c99f0-154">Normalmente, os provedores de rede WAN oferecem conectividade gerenciada de camada 3.</span><span class="sxs-lookup"><span data-stu-id="c99f0-154">WAN providers typically offer managed layer 3 connectivity.</span></span>

<span data-ttu-id="c99f0-155">Para obter mais informações sobre provedores de conectividade, consulte a [Introdução ao ExpressRoute][expressroute-introduction].</span><span class="sxs-lookup"><span data-stu-id="c99f0-155">For more information about connectivity providers, see the [ExpressRoute introduction][expressroute-introduction].</span></span>

### <a name="expressroute-circuit"></a><span data-ttu-id="c99f0-156">Circuito do ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="c99f0-156">ExpressRoute circuit</span></span>

<span data-ttu-id="c99f0-157">Verifique se a sua organização cumpre os [pré-requisitos do ExpressRoute][expressroute-prereqs] para se conectar ao Azure.</span><span class="sxs-lookup"><span data-stu-id="c99f0-157">Ensure that your organization has met the [ExpressRoute prerequisite requirements][expressroute-prereqs] for connecting to Azure.</span></span>

<span data-ttu-id="c99f0-158">Se você ainda não o fez, adicione uma sub-rede denominada `GatewaySubnet` à sua VNet do Azure e crie um gateway de rede virtual do ExpressRoute usando o serviço de gateway VPN do Azure.</span><span class="sxs-lookup"><span data-stu-id="c99f0-158">If you haven't already done so, add a subnet named `GatewaySubnet` to your Azure VNet and create an ExpressRoute virtual network gateway using the Azure VPN gateway service.</span></span> <span data-ttu-id="c99f0-159">Para obter mais informações sobre este processo, consulte [Fluxos de trabalho do ExpressRoute para provisionamento e estados do circuito][ExpressRoute-provisioning].</span><span class="sxs-lookup"><span data-stu-id="c99f0-159">For more information about this process, see [ExpressRoute workflows for circuit provisioning and circuit states][ExpressRoute-provisioning].</span></span>

<span data-ttu-id="c99f0-160">Crie um circuito do ExpressRoute conforme descrito a seguir:</span><span class="sxs-lookup"><span data-stu-id="c99f0-160">Create an ExpressRoute circuit as follows:</span></span>

1. <span data-ttu-id="c99f0-161">Execute o seguinte comando do PowerShell:</span><span class="sxs-lookup"><span data-stu-id="c99f0-161">Run the following PowerShell command:</span></span>
   
    ```powershell
    New-AzureRmExpressRouteCircuit -Name <<circuit-name>> -ResourceGroupName <<resource-group>> -Location <<location>> -SkuTier <<sku-tier>> -SkuFamily <<sku-family>> -ServiceProviderName <<service-provider-name>> -PeeringLocation <<peering-location>> -BandwidthInMbps <<bandwidth-in-mbps>>
    ```
2. <span data-ttu-id="c99f0-162">Envie o `ServiceKey` para o novo circuito para o provedor de serviços.</span><span class="sxs-lookup"><span data-stu-id="c99f0-162">Send the `ServiceKey` for the new circuit to the service provider.</span></span>

3. <span data-ttu-id="c99f0-163">Aguarde até que o provedor provisione o circuito.</span><span class="sxs-lookup"><span data-stu-id="c99f0-163">Wait for the provider to provision the circuit.</span></span> <span data-ttu-id="c99f0-164">Para verificar o estado de provisionamento de um circuito, execute o seguinte comando do PowerShell:</span><span class="sxs-lookup"><span data-stu-id="c99f0-164">To verify the provisioning state of a circuit, run the following PowerShell command:</span></span>
   
    ```powershell
    Get-AzureRmExpressRouteCircuit -Name <<circuit-name>> -ResourceGroupName <<resource-group>>
    ```

    <span data-ttu-id="c99f0-165">O campo `Provisioning state` na seção `Service Provider` da saída será alterado de `NotProvisioned` para `Provisioned` quando o circuito estiver pronto.</span><span class="sxs-lookup"><span data-stu-id="c99f0-165">The `Provisioning state` field in the `Service Provider` section of the output will change from `NotProvisioned` to `Provisioned` when the circuit is ready.</span></span>

    > [!NOTE]
    > <span data-ttu-id="c99f0-166">Se você estiver usando uma conexão de camada 3, o provedor deverá configurar e gerenciar o roteamento para você.</span><span class="sxs-lookup"><span data-stu-id="c99f0-166">If you're using a layer 3 connection, the provider should configure and manage routing for you.</span></span> <span data-ttu-id="c99f0-167">Você fornece as informações necessárias para habilitar o provedor a implementar as rotas apropriadas.</span><span class="sxs-lookup"><span data-stu-id="c99f0-167">You provide the information necessary to enable the provider to implement the appropriate routes.</span></span>
    > 
    > 

4. <span data-ttu-id="c99f0-168">Se você estiver usando uma conexão de camada 2:</span><span class="sxs-lookup"><span data-stu-id="c99f0-168">If you're using a layer 2 connection:</span></span>

    1. <span data-ttu-id="c99f0-169">Reserve duas sub-redes /30 compostas de endereços IP públicos válidos para cada tipo de emparelhamento que você deseja implementar.</span><span class="sxs-lookup"><span data-stu-id="c99f0-169">Reserve two /30 subnets composed of valid public IP addresses for each type of peering you want to implement.</span></span> <span data-ttu-id="c99f0-170">Essas sub-redes /30 serão usadas para fornecer endereços IP para os roteadores usados para o circuito.</span><span class="sxs-lookup"><span data-stu-id="c99f0-170">These /30 subnets will be used to provide IP addresses for the routers used for the circuit.</span></span> <span data-ttu-id="c99f0-171">Se você estiver implementando emparelhamento privado, público e da Microsoft, você precisará de seis sub-redes /30 com endereços IP públicos válidos.</span><span class="sxs-lookup"><span data-stu-id="c99f0-171">If you are implementing private, public, and Microsoft peering, you'll need 6 /30 subnets with valid public IP addresses.</span></span>     

    2. <span data-ttu-id="c99f0-172">Configure o roteamento para o circuito do ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c99f0-172">Configure routing for the ExpressRoute circuit.</span></span> <span data-ttu-id="c99f0-173">Execute os seguinte comandos do PowerShell para cada tipo de emparelhamento a configurar (privado, público e da Microsoft).</span><span class="sxs-lookup"><span data-stu-id="c99f0-173">Run the following PowerShell commands for each type of peering you want to configure (private, public, and Microsoft).</span></span> <span data-ttu-id="c99f0-174">Para obter mais informações, consulte [Criar e modificar o roteamento de um circuito do ExpressRoute][configure-expressroute-routing].</span><span class="sxs-lookup"><span data-stu-id="c99f0-174">For more information, see [Create and modify routing for an ExpressRoute circuit][configure-expressroute-routing].</span></span>
   
        ```powershell
        Set-AzureRmExpressRouteCircuitPeeringConfig -Name <<peering-name>> -Circuit <<circuit-name>> -PeeringType <<peering-type>> -PeerASN <<peer-asn>> -PrimaryPeerAddressPrefix <<primary-peer-address-prefix>> -SecondaryPeerAddressPrefix <<secondary-peer-address-prefix>> -VlanId <<vlan-id>>

        Set-AzureRmExpressRouteCircuit -ExpressRouteCircuit <<circuit-name>>
        ```

    3. <span data-ttu-id="c99f0-175">Reserve outro pool de endereços IP públicos válidos a ser usado para NAT (conversão de endereços de rede) para emparelhamento público e da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="c99f0-175">Reserve another pool of valid public IP addresses to use for network address translation (NAT) for public and Microsoft peering.</span></span> <span data-ttu-id="c99f0-176">É recomendável ter um pool diferente para cada emparelhamento.</span><span class="sxs-lookup"><span data-stu-id="c99f0-176">It is recommended to have a different pool for each peering.</span></span> <span data-ttu-id="c99f0-177">Especifica o pool para seu provedor de conectividade, assim ele pode configurar anúncios do Protocolo BGP (Border Gateway Protocol) para esses intervalos.</span><span class="sxs-lookup"><span data-stu-id="c99f0-177">Specify the pool to your connectivity provider, so they can configure border gateway protocol (BGP) advertisements for those ranges.</span></span>

5. <span data-ttu-id="c99f0-178">Execute os comandos do PowerShell a seguir para vincular suas VNets privadas ao circuito do ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c99f0-178">Run the following PowerShell commands to link your private VNet(s) to the ExpressRoute circuit.</span></span> <span data-ttu-id="c99f0-179">Para obter mais informações, consulte [Vincular uma Rede Virtual a um circuito do ExpressRoute][link-vnet-to-expressroute].</span><span class="sxs-lookup"><span data-stu-id="c99f0-179">For more information,see [Link a virtual network to an ExpressRoute circuit][link-vnet-to-expressroute].</span></span>

    ```powershell
    $circuit = Get-AzureRmExpressRouteCircuit -Name <<circuit-name>> -ResourceGroupName <<resource-group>>
    $gw = Get-AzureRmVirtualNetworkGateway -Name <<gateway-name>> -ResourceGroupName <<resource-group>>
    New-AzureRmVirtualNetworkGatewayConnection -Name <<connection-name>> -ResourceGroupName <<resource-group>> -Location <<location> -VirtualNetworkGateway1 $gw -PeerId $circuit.Id -ConnectionType ExpressRoute
    ```

<span data-ttu-id="c99f0-180">Você pode conectar múltiplas VNets localizadas em regiões diferentes ao mesmo circuito do ExpressRoute, desde que todas as VNets e o circuito do ExpressRoute estejam localizados na mesma região geopolítica.</span><span class="sxs-lookup"><span data-stu-id="c99f0-180">You can connect multiple VNets located in different regions to the same ExpressRoute circuit, as long as all VNets and the ExpressRoute circuit are located within the same geopolitical region.</span></span>

### <a name="troubleshooting"></a><span data-ttu-id="c99f0-181">solução de problemas</span><span class="sxs-lookup"><span data-stu-id="c99f0-181">Troubleshooting</span></span> 

<span data-ttu-id="c99f0-182">Se um circuito do ExpressRoute que funcionava anteriormente agora falha ao se conectar sem que tenha ocorrido nenhuma alteração de configuração local ou dentro de sua VNet privada, você provavelmente precisará entrar em contato com o provedor de conectividade e trabalhar com eles para corrigir o problema.</span><span class="sxs-lookup"><span data-stu-id="c99f0-182">If a previously functioning ExpressRoute circuit now fails to connect, in the absence of any configuration changes on-premises or within your private VNet, you may need to contact the connectivity provider and work with them to correct the issue.</span></span> <span data-ttu-id="c99f0-183">Use os seguintes comandos do Powershell para verificar se o circuito do ExpressRoute foi configurado:</span><span class="sxs-lookup"><span data-stu-id="c99f0-183">Use the following Powershell commands to verify that the ExpressRoute circuit has been provisioned:</span></span>

```powershell
Get-AzureRmExpressRouteCircuit -Name <<circuit-name>> -ResourceGroupName <<resource-group>>
```

<span data-ttu-id="c99f0-184">A saída desse comando mostra várias propriedades para o circuito, incluindo `ProvisioningState`, `CircuitProvisioningState` e `ServiceProviderProvisioningState` conforme mostrado abaixo.</span><span class="sxs-lookup"><span data-stu-id="c99f0-184">The output of this command shows several properties for your circuit, including `ProvisioningState`, `CircuitProvisioningState`, and `ServiceProviderProvisioningState` as shown below.</span></span>

```
ProvisioningState                : Succeeded
Sku                              : {
                                     "Name": "Standard_MeteredData",
                                     "Tier": "Standard",
                                     "Family": "MeteredData"
                                   }
CircuitProvisioningState         : Enabled
ServiceProviderProvisioningState : NotProvisioned
```

<span data-ttu-id="c99f0-185">Se o `ProvisioningState` não está definido como `Succeeded` após uma tentativa de criar um novo circuito, remova o circuito usando o comando a seguir e tente criá-lo novamente.</span><span class="sxs-lookup"><span data-stu-id="c99f0-185">If the `ProvisioningState` is not set to `Succeeded` after you tried to create a new circuit, remove the circuit by using the command below and try to create it again.</span></span>

```powershell
Remove-AzureRmExpressRouteCircuit -Name <<circuit-name>> -ResourceGroupName <<resource-group>>
```

<span data-ttu-id="c99f0-186">Se seu provedor já tinha provisionado o circuito e o `ProvisioningState` está definido para `Failed` ou então, se o `CircuitProvisioningState` não é `Enabled`, entre em contato com seu provedor para obter assistência adicional.</span><span class="sxs-lookup"><span data-stu-id="c99f0-186">If your provider had already provisioned the circuit, and the `ProvisioningState` is set to `Failed`, or the `CircuitProvisioningState` is not `Enabled`, contact your provider for further assistance.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="c99f0-187">Considerações sobre escalabilidade</span><span class="sxs-lookup"><span data-stu-id="c99f0-187">Scalability considerations</span></span>

<span data-ttu-id="c99f0-188">Os circuitos do ExpressRoute fornecem um caminho de alta largura de banda entre redes.</span><span class="sxs-lookup"><span data-stu-id="c99f0-188">ExpressRoute circuits provide a high bandwidth path between networks.</span></span> <span data-ttu-id="c99f0-189">Em geral, quanto maior a largura de banda, maior o custo.</span><span class="sxs-lookup"><span data-stu-id="c99f0-189">Generally, the higher the bandwidth the greater the cost.</span></span> 

<span data-ttu-id="c99f0-190">O ExpressRoute oferece dois [planos de preços][expressroute-pricing] para clientes, um plano limitado e um plano de dados ilimitado.</span><span class="sxs-lookup"><span data-stu-id="c99f0-190">ExpressRoute offers two [pricing plans][expressroute-pricing] to customers, a metered plan and an unlimited data plan.</span></span> <span data-ttu-id="c99f0-191">Os encargos variam de acordo com a largura de banda do circuito.</span><span class="sxs-lookup"><span data-stu-id="c99f0-191">Charges vary according to circuit bandwidth.</span></span> <span data-ttu-id="c99f0-192">A largura de banda disponível provavelmente será diferente para cada provedor.</span><span class="sxs-lookup"><span data-stu-id="c99f0-192">Available bandwidth will likely vary from provider to provider.</span></span> <span data-ttu-id="c99f0-193">Use o cmdlet `Get-AzureRmExpressRouteServiceProvider` para ver os provedores disponíveis na sua região e as larguras de banda que eles oferecem.</span><span class="sxs-lookup"><span data-stu-id="c99f0-193">Use the `Get-AzureRmExpressRouteServiceProvider` cmdlet to see the providers available in your region and the bandwidths that they offer.</span></span>
 
<span data-ttu-id="c99f0-194">Um único circuito do ExpressRoute pode dar suporte a um determinado número de emparelhamentos e links de VNet.</span><span class="sxs-lookup"><span data-stu-id="c99f0-194">A single ExpressRoute circuit can support a certain number of peerings and VNet links.</span></span> <span data-ttu-id="c99f0-195">Para obter mais informações, consulte [limites do ExpressRoute](/azure/azure-subscription-service-limits).</span><span class="sxs-lookup"><span data-stu-id="c99f0-195">See [ExpressRoute limits](/azure/azure-subscription-service-limits) for more information.</span></span>

<span data-ttu-id="c99f0-196">A um custo adicional, o complemento ExpressRoute Premium oferece algumas funcionalidades adicionais:</span><span class="sxs-lookup"><span data-stu-id="c99f0-196">For an extra charge, the ExpressRoute Premium add-on provides some additional capability:</span></span>

* <span data-ttu-id="c99f0-197">Aumento dos limites de rota para emparelhamento público e privado.</span><span class="sxs-lookup"><span data-stu-id="c99f0-197">Increased route limits for public and private peering.</span></span> 
* <span data-ttu-id="c99f0-198">Aumento do número de links de VNet por circuito do ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c99f0-198">Increased number of VNet links per ExpressRoute circuit.</span></span> 
* <span data-ttu-id="c99f0-199">Conectividade global para serviços.</span><span class="sxs-lookup"><span data-stu-id="c99f0-199">Global connectivity for services.</span></span>

<span data-ttu-id="c99f0-200">Consulte [Preços do ExpressRoute][expressroute-pricing] para obter detalhes.</span><span class="sxs-lookup"><span data-stu-id="c99f0-200">See [ExpressRoute pricing][expressroute-pricing] for details.</span></span> 

<span data-ttu-id="c99f0-201">Circuitos de ExpressRoute são projetados para permitir intermitências de rede temporárias de até duas vezes o limite de largura de banda que você adquiriu, sem nenhum custo adicional.</span><span class="sxs-lookup"><span data-stu-id="c99f0-201">ExpressRoute circuits are designed to allow temporary network bursts up to two times the bandwidth limit that you procured for no additional cost.</span></span> <span data-ttu-id="c99f0-202">Isso é alcançado por meio de links redundantes.</span><span class="sxs-lookup"><span data-stu-id="c99f0-202">This is achieved by using redundant links.</span></span> <span data-ttu-id="c99f0-203">No entanto, nem todos os provedores de conectividade dão suporte a esse recurso.</span><span class="sxs-lookup"><span data-stu-id="c99f0-203">However, not all connectivity providers support this feature.</span></span> <span data-ttu-id="c99f0-204">Verifique se que o seu provedor de conectividade permite esse recurso antes de depender dele.</span><span class="sxs-lookup"><span data-stu-id="c99f0-204">Verify that your connectivity provider enables this feature before depending on it.</span></span>

<span data-ttu-id="c99f0-205">Embora alguns provedores permitam que você altere a largura de banda, verifique se você escolheu uma largura de banda inicial que ultrapassa a suas necessidades e deixa margem para crescimento.</span><span class="sxs-lookup"><span data-stu-id="c99f0-205">Although some providers allow you to change your bandwidth, make sure you pick an initial bandwidth that surpasses your needs and provides room for growth.</span></span> <span data-ttu-id="c99f0-206">Se você precisar aumentar a largura de banda no futuro, haverá duas opções:</span><span class="sxs-lookup"><span data-stu-id="c99f0-206">If you need to increase bandwidth in the future, you are left with two options:</span></span>

- <span data-ttu-id="c99f0-207">Aumentar a largura de banda.</span><span class="sxs-lookup"><span data-stu-id="c99f0-207">Increase the bandwidth.</span></span> <span data-ttu-id="c99f0-208">Evite essa opção sempre que possível; inclusive, nem todos os provedores permitem aumentar dinamicamente a largura de banda.</span><span class="sxs-lookup"><span data-stu-id="c99f0-208">You should avoid this option as much as possible, and not all providers allow you to increase bandwidth dynamically.</span></span> <span data-ttu-id="c99f0-209">Mas se for necessário um aumento de largura de banda, verifique com seu provedor se eles dão suporte à alteração de propriedades de largura de banda do ExpressRoute por meio de comandos do Powershell.</span><span class="sxs-lookup"><span data-stu-id="c99f0-209">But if a bandwidth increase is needed, check with your provider to verify they support changing ExpressRoute bandwidth properties via Powershell commands.</span></span> <span data-ttu-id="c99f0-210">Se esse for o caso, execute os comandos abaixo.</span><span class="sxs-lookup"><span data-stu-id="c99f0-210">If they do, run the commands below.</span></span>

    ```powershell
    $ckt = Get-AzureRmExpressRouteCircuit -Name <<circuit-name>> -ResourceGroupName <<resource-group>>
    $ckt.ServiceProviderProperties.BandwidthInMbps = <<bandwidth-in-mbps>>
    Set-AzureRmExpressRouteCircuit -ExpressRouteCircuit $ckt
    ```

    <span data-ttu-id="c99f0-211">Você pode aumentar a largura de banda sem perda de conectividade.</span><span class="sxs-lookup"><span data-stu-id="c99f0-211">You can increase the bandwidth without loss of connectivity.</span></span> <span data-ttu-id="c99f0-212">Fazer downgrade da largura de banda resultará em interrupções na conectividade, porque você deverá excluir o circuito e recriá-lo com a nova configuração.</span><span class="sxs-lookup"><span data-stu-id="c99f0-212">Downgrading the bandwidth will result in disruption in connectivity, because you must delete the circuit and recreate it with the new configuration.</span></span>

- <span data-ttu-id="c99f0-213">Alterar o plano de preços e/ou fazer upgrade para Premium.</span><span class="sxs-lookup"><span data-stu-id="c99f0-213">Change your pricing plan and/or upgrade to Premium.</span></span> <span data-ttu-id="c99f0-214">Para fazer isso, execute os comandos a seguir.</span><span class="sxs-lookup"><span data-stu-id="c99f0-214">To do so, run the following commands.</span></span> <span data-ttu-id="c99f0-215">A propriedade `Sku.Tier` pode ser `Standard` ou `Premium`; a propriedade `Sku.Name` pode ser `MeteredData` ou `UnlimitedData`.</span><span class="sxs-lookup"><span data-stu-id="c99f0-215">The `Sku.Tier` property can be `Standard` or `Premium`; the `Sku.Name` property can be `MeteredData` or `UnlimitedData`.</span></span>

    ```powershell
    $ckt = Get-AzureRmExpressRouteCircuit -Name <<circuit-name>> -ResourceGroupName <<resource-group>>

    $ckt.Sku.Tier = "Premium"
    $ckt.Sku.Family = "MeteredData"
    $ckt.Sku.Name = "Premium_MeteredData"

    Set-AzureRmExpressRouteCircuit -ExpressRouteCircuit $ckt
    ```

    > [!IMPORTANT]
    > <span data-ttu-id="c99f0-216">Verifique se a propriedade `Sku.Name` corresponde a `Sku.Tier` e `Sku.Family`.</span><span class="sxs-lookup"><span data-stu-id="c99f0-216">Make sure the `Sku.Name` property matches the `Sku.Tier` and `Sku.Family`.</span></span> <span data-ttu-id="c99f0-217">Se você alterar a família e camada, mas não o nome, a conexão será desabilitada.</span><span class="sxs-lookup"><span data-stu-id="c99f0-217">If you change the family and tier, but not the name, your connection will be disabled.</span></span>
    > 
    > 

    <span data-ttu-id="c99f0-218">Você pode fazer upgrade do SKU sem interrupções, mas você não pode mudar do plano de preços ilimitado para o limitado.</span><span class="sxs-lookup"><span data-stu-id="c99f0-218">You can upgrade the SKU without disruption, but you cannot switch from the unlimited pricing plan to metered.</span></span> <span data-ttu-id="c99f0-219">Ao fazer o downgrade do SKU, o consumo de largura de banda deve permanecer dentro do limite padrão do SKU padrão.</span><span class="sxs-lookup"><span data-stu-id="c99f0-219">When downgrading the SKU, your bandwidth consumption must remain within the default limit of the standard SKU.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="c99f0-220">Considerações sobre disponibilidade</span><span class="sxs-lookup"><span data-stu-id="c99f0-220">Availability considerations</span></span>

<span data-ttu-id="c99f0-221">O ExpressRoute não dá suporte a protocolos de redundância de roteador como HSRP (protocolo de roteamento de espera ativa) e VRRP (protocolo de redundância de roteador virtual) para implementar a alta disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="c99f0-221">ExpressRoute does not support router redundancy protocols such as hot standby routing protocol (HSRP) and virtual router redundancy protocol (VRRP) to implement high availability.</span></span> <span data-ttu-id="c99f0-222">Em vez disso, ele usa um par redundante de sessões de BGP por emparelhamento.</span><span class="sxs-lookup"><span data-stu-id="c99f0-222">Instead, it uses a redundant pair of BGP sessions per peering.</span></span> <span data-ttu-id="c99f0-223">Para facilitar as conexões de alta disponibilidade à sua rede, o Azure provisiona duas portas redundantes em dois roteadores (parte do Microsoft edge) em uma configuração ativo-ativo.</span><span class="sxs-lookup"><span data-stu-id="c99f0-223">To facilitate highly-available connections to your network, Azure provisions you with two redundant ports on two routers (part of the Microsoft edge) in an active-active configuration.</span></span>

<span data-ttu-id="c99f0-224">Por padrão, as sessões BGP usam um valor de tempo limite de ociosidade de 60 segundos.</span><span class="sxs-lookup"><span data-stu-id="c99f0-224">By default, BGP sessions use an idle timeout value of 60 seconds.</span></span> <span data-ttu-id="c99f0-225">Se uma sessão expirar três vezes (total de 180 segundos), o roteador será marcado como não disponível e todo o tráfego será redirecionado para o roteador restante.</span><span class="sxs-lookup"><span data-stu-id="c99f0-225">If a session times out three times (180 seconds total), the router is marked as unavailable, and all traffic is redirected to the remaining router.</span></span> <span data-ttu-id="c99f0-226">Esse tempo limite de 180 segundos pode ser muito longo para aplicativos críticos.</span><span class="sxs-lookup"><span data-stu-id="c99f0-226">This 180-second timeout might be too long for critical applications.</span></span> <span data-ttu-id="c99f0-227">Nesse caso, você pode alterar as configurações de tempo limite de BGP no roteador local para um valor menor.</span><span class="sxs-lookup"><span data-stu-id="c99f0-227">If so, you can change your BGP time-out settings on the on-premises router to a smaller value.</span></span>

<span data-ttu-id="c99f0-228">Você poderá configurar a alta disponibilidade para a conexão do Azure de maneiras diferentes, dependendo do tipo de provedor que você usar e do número de circuitos do ExpressRoute e de conexões de gateway de rede virtual que você pretender configurar.</span><span class="sxs-lookup"><span data-stu-id="c99f0-228">You can configure high availability for your Azure connection in different ways, depending on the type of provider you use, and the number of ExpressRoute circuits and virtual network gateway connections you're willing to configure.</span></span> <span data-ttu-id="c99f0-229">O exemplo a seguir resume as opções de disponibilidade:</span><span class="sxs-lookup"><span data-stu-id="c99f0-229">The following summarizes your availability options:</span></span>

* <span data-ttu-id="c99f0-230">Se você estiver usando uma conexão de camada 2, implante roteadores redundantes em sua rede local em uma configuração ativo-ativo.</span><span class="sxs-lookup"><span data-stu-id="c99f0-230">If you're using a layer 2 connection, deploy redundant routers in your on-premises network in an active-active configuration.</span></span> <span data-ttu-id="c99f0-231">Conecte o circuito primário a um roteador e o circuito secundário ao outro.</span><span class="sxs-lookup"><span data-stu-id="c99f0-231">Connect the primary circuit to one router, and the secondary circuit to the other.</span></span> <span data-ttu-id="c99f0-232">Isso lhe dará uma conexão altamente disponível em ambas as extremidades da conexão.</span><span class="sxs-lookup"><span data-stu-id="c99f0-232">This will give you a highly available connection at both ends of the connection.</span></span> <span data-ttu-id="c99f0-233">Isso é necessário se você precisar de contrato de nível de serviço (SLA) do ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c99f0-233">This is necessary if you require the ExpressRoute service level agreement (SLA).</span></span> <span data-ttu-id="c99f0-234">Consulte [SLA para o Azure ExpressRoute][sla-for-expressroute] para obter detalhes.</span><span class="sxs-lookup"><span data-stu-id="c99f0-234">See [SLA for Azure ExpressRoute][sla-for-expressroute] for details.</span></span>

    <span data-ttu-id="c99f0-235">O diagrama a seguir mostra uma configuração com roteadores locais redundantes conectados aos circuitos primários e secundários.</span><span class="sxs-lookup"><span data-stu-id="c99f0-235">The following diagram shows a configuration with redundant on-premises routers connected to the primary and secondary circuits.</span></span> <span data-ttu-id="c99f0-236">Cada circuito manipula o tráfego para um emparelhamento público e um emparelhamento privado (um par de espaços de endereço /30 é designado a cada emparelhamento, conforme descrito na seção anterior).</span><span class="sxs-lookup"><span data-stu-id="c99f0-236">Each circuit handles the traffic for a public peering and a private peering (each peering is designated a pair of /30 address spaces, as described in the previous section).</span></span>

    <span data-ttu-id="c99f0-237">![[1]][1]</span><span class="sxs-lookup"><span data-stu-id="c99f0-237">![[1]][1]</span></span>

* <span data-ttu-id="c99f0-238">Se você estiver usando uma conexão de camada 3, verifique se que ele forneça sessões de BGP redundantes que controlem a disponibilidade para você.</span><span class="sxs-lookup"><span data-stu-id="c99f0-238">If you're using a layer 3 connection, verify that it provides redundant BGP sessions that handle availability for you.</span></span>

* <span data-ttu-id="c99f0-239">Conecte a VNet a vários circuitos do ExpressRoute fornecidos por diferentes provedores de serviço.</span><span class="sxs-lookup"><span data-stu-id="c99f0-239">Connect the VNet to multiple ExpressRoute circuits, supplied by different service providers.</span></span> <span data-ttu-id="c99f0-240">Essa estratégia fornece funcionalidades adicionais de recuperação de desastre e alta disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="c99f0-240">This strategy provides additional high-availability and disaster recovery capabilities.</span></span>

* <span data-ttu-id="c99f0-241">Configure uma VPN site a site como um caminho de failover para o ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c99f0-241">Configure a site-to-site VPN as a failover path for ExpressRoute.</span></span> <span data-ttu-id="c99f0-242">Para obter mais informações sobre essa opção, consulte [Conectar uma rede local ao Azure usando o ExpressRoute com failover de VPN][highly-available-network-architecture].</span><span class="sxs-lookup"><span data-stu-id="c99f0-242">For more about this option, see [Connect an on-premises network to Azure using ExpressRoute with VPN failover][highly-available-network-architecture].</span></span>
 <span data-ttu-id="c99f0-243">Essa opção só se aplica ao emparelhamento privado.</span><span class="sxs-lookup"><span data-stu-id="c99f0-243">This option only applies to private peering.</span></span> <span data-ttu-id="c99f0-244">Para serviços do Azure e o Office 365, a Internet é o único caminho de failover.</span><span class="sxs-lookup"><span data-stu-id="c99f0-244">For Azure and Office 365 services, the Internet is the only failover path.</span></span> 

## <a name="manageability-considerations"></a><span data-ttu-id="c99f0-245">Considerações sobre capacidade de gerenciamento</span><span class="sxs-lookup"><span data-stu-id="c99f0-245">Manageability considerations</span></span>

<span data-ttu-id="c99f0-246">Você pode usar o [Kit de ferramentas do Azure conectividade (AzureCT)][azurect] para monitorar a conectividade entre o datacenter local e o Azure.</span><span class="sxs-lookup"><span data-stu-id="c99f0-246">You can use the [Azure Connectivity Toolkit (AzureCT)][azurect] to monitor connectivity between your on-premises datacenter and Azure.</span></span> 

## <a name="security-considerations"></a><span data-ttu-id="c99f0-247">Considerações de segurança</span><span class="sxs-lookup"><span data-stu-id="c99f0-247">Security considerations</span></span>

<span data-ttu-id="c99f0-248">Você pode configurar opções de segurança para sua conexão do Azure de maneiras diferentes, dependendo de suas necessidades de conformidade e questões de segurança.</span><span class="sxs-lookup"><span data-stu-id="c99f0-248">You can configure security options for your Azure connection in different ways, depending on your security concerns and compliance needs.</span></span> 

<span data-ttu-id="c99f0-249">O ExpressRoute funciona na camada 3.</span><span class="sxs-lookup"><span data-stu-id="c99f0-249">ExpressRoute operates in layer 3.</span></span> <span data-ttu-id="c99f0-250">Ameaças na camada de aplicativo podem ser evitadas por meio de um dispositivo de segurança de rede que restringe o tráfego a recursos legítimos.</span><span class="sxs-lookup"><span data-stu-id="c99f0-250">Threats in the application layer can be prevented by using a network security appliance that restricts traffic to legitimate resources.</span></span> <span data-ttu-id="c99f0-251">Além disso, as conexões do ExpressRoute usando o emparelhamento público podem ser iniciadas apenas localmente.</span><span class="sxs-lookup"><span data-stu-id="c99f0-251">Additionally, ExpressRoute connections using public peering can only be initiated from on-premises.</span></span> <span data-ttu-id="c99f0-252">Isso impede que um serviço invasor acesse e comprometa dados locais da Internet.</span><span class="sxs-lookup"><span data-stu-id="c99f0-252">This prevents a rogue service from accessing and compromising on-premises data from the Internet.</span></span>

<span data-ttu-id="c99f0-253">Para maximizar a segurança, adicione dispositivos de segurança de rede entre a rede local e os roteadores de borda do provedor.</span><span class="sxs-lookup"><span data-stu-id="c99f0-253">To maximize security, add network security appliances between the on-premises network and the provider edge routers.</span></span> <span data-ttu-id="c99f0-254">Isso ajudará a restringir o fluxo de entrada de tráfego não autorizado da VNet:</span><span class="sxs-lookup"><span data-stu-id="c99f0-254">This will help to restrict the inflow of unauthorized traffic from the VNet:</span></span>

<span data-ttu-id="c99f0-255">![[2]][2]</span><span class="sxs-lookup"><span data-stu-id="c99f0-255">![[2]][2]</span></span>

<span data-ttu-id="c99f0-256">Para fins de auditoria ou a conformidade, pode ser necessário impedir o acesso direto de componentes em execução na VNet à Internet e implementar [túnel forçado][forced-tuneling].</span><span class="sxs-lookup"><span data-stu-id="c99f0-256">For auditing or compliance purposes, it may be necessary to prohibit direct access from components running in the VNet to the Internet and implement [forced tunneling][forced-tuneling].</span></span> <span data-ttu-id="c99f0-257">Nessa situação, o tráfego de Internet deve ser redirecionado por meio de um proxy executado localmente, de modo que possa ser auditado.</span><span class="sxs-lookup"><span data-stu-id="c99f0-257">In this situation, Internet traffic should be redirected back through a proxy running  on-premises where it can be audited.</span></span> <span data-ttu-id="c99f0-258">O proxy pode ser configurado para bloquear a saída de tráfego não autorizado e filtrar tráfego de entrada potencialmente mal-intencionado.</span><span class="sxs-lookup"><span data-stu-id="c99f0-258">The proxy can be configured to block unauthorized traffic flowing out, and filter potentially malicious inbound traffic.</span></span>

<span data-ttu-id="c99f0-259">![[3]][3]</span><span class="sxs-lookup"><span data-stu-id="c99f0-259">![[3]][3]</span></span>

<span data-ttu-id="c99f0-260">Para maximizar a segurança, não habilite um endereço IP público para suas VMs e use os NSGs para garantir que essas VMs não fiquem acessíveis publicamente.</span><span class="sxs-lookup"><span data-stu-id="c99f0-260">To maximize security, do not enable a public IP address for your VMs, and use NSGs to ensure that these VMs aren't publicly accessible.</span></span> <span data-ttu-id="c99f0-261">VMs só devem estar disponíveis usando o endereço IP interno.</span><span class="sxs-lookup"><span data-stu-id="c99f0-261">VMs should only be available using the internal IP address.</span></span> <span data-ttu-id="c99f0-262">Esses endereços podem se tornar acessíveis através da rede de do ExpressRoute, permitindo que a equipe de DevOps local realize a configuração ou a manutenção.</span><span class="sxs-lookup"><span data-stu-id="c99f0-262">These addresses can be made accessible through the ExpressRoute network, enabling on-premises DevOps staff to perform configuration or maintenance.</span></span>

<span data-ttu-id="c99f0-263">Se você deve expor pontos de extremidade de gerenciamento para VMs a uma rede externa, use NSGs ou listas de controle de acesso para restringir a visibilidade dessas portas para uma lista de permissões de endereços IP ou redes.</span><span class="sxs-lookup"><span data-stu-id="c99f0-263">If you must expose management endpoints for VMs to an external network, use NSGs or access control lists to restrict the visibility of these ports to a whitelist of IP addresses or networks.</span></span>

> [!NOTE]
> <span data-ttu-id="c99f0-264">Por padrão, VMs do Azure implantadas por meio do Portal do Azure incluem um endereço IP público que fornece acesso de logon.</span><span class="sxs-lookup"><span data-stu-id="c99f0-264">By default, Azure VMs deployed through the Azure portal include a public IP address that provides login access.</span></span>  
> 
> 


## <a name="deploy-the-solution"></a><span data-ttu-id="c99f0-265">Implantar a solução</span><span class="sxs-lookup"><span data-stu-id="c99f0-265">Deploy the solution</span></span>

<span data-ttu-id="c99f0-266">**Pré-requisitos.**</span><span class="sxs-lookup"><span data-stu-id="c99f0-266">**Prequisites.**</span></span> <span data-ttu-id="c99f0-267">Você deve ter uma infraestrutura local existente já configurada com um dispositivo de rede adequado.</span><span class="sxs-lookup"><span data-stu-id="c99f0-267">You must have an existing on-premises infrastructure already configured with a suitable network appliance.</span></span>

<span data-ttu-id="c99f0-268">Para implantar a solução, execute as etapas a seguir.</span><span class="sxs-lookup"><span data-stu-id="c99f0-268">To deploy the solution, perform the following steps.</span></span>

1. <span data-ttu-id="c99f0-269">Clique no botão abaixo:</span><span class="sxs-lookup"><span data-stu-id="c99f0-269">Click the button below:</span></span><br><a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fmspnp%2Freference-architectures%2Fmaster%2Fhybrid-networking%2Fexpressroute%2Fazuredeploy.json" target="_blank"><img src="http://azuredeploy.net/deploybutton.png"/></a>
2. <span data-ttu-id="c99f0-270">Aguarde até o link abrir no Portal do Azure e siga estas etapas:</span><span class="sxs-lookup"><span data-stu-id="c99f0-270">Wait for the link to open in the Azure portal, then follow these steps:</span></span>
   * <span data-ttu-id="c99f0-271">O nome do **Grupo de recursos** já está definido no arquivo de parâmetros, portanto, selecione **Criar novo** e digite `ra-hybrid-er-rg` na caixa de texto.</span><span class="sxs-lookup"><span data-stu-id="c99f0-271">The **Resource group** name is already defined in the parameter file, so select **Create New** and enter `ra-hybrid-er-rg` in the text box.</span></span>
   * <span data-ttu-id="c99f0-272">Selecione a região na caixa suspensa **Local**.</span><span class="sxs-lookup"><span data-stu-id="c99f0-272">Select the region from the **Location** drop down box.</span></span>
   * <span data-ttu-id="c99f0-273">Não edite as caixas de texto **URI da raiz do modelo** ou **URI da raiz do parâmetro**.</span><span class="sxs-lookup"><span data-stu-id="c99f0-273">Do not edit the **Template Root Uri** or the **Parameter Root Uri** text boxes.</span></span>
   * <span data-ttu-id="c99f0-274">Analise os termos e condições e clique na caixa de seleção **Concordo com os termos e condições declarados acima**.</span><span class="sxs-lookup"><span data-stu-id="c99f0-274">Review the terms and conditions, then click the **I agree to the terms and conditions stated above** checkbox.</span></span>
   * <span data-ttu-id="c99f0-275">Clique no botão **Comprar**.</span><span class="sxs-lookup"><span data-stu-id="c99f0-275">Click the **Purchase** button.</span></span>
3. <span data-ttu-id="c99f0-276">Aguarde até que a implantação seja concluída.</span><span class="sxs-lookup"><span data-stu-id="c99f0-276">Wait for the deployment to complete.</span></span>
4. <span data-ttu-id="c99f0-277">Clique no botão abaixo:</span><span class="sxs-lookup"><span data-stu-id="c99f0-277">Click the button below:</span></span><br><a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fmspnp%2Freference-architectures%2Fmaster%2Fhybrid-networking%2Fexpressroute%2Fazuredeploy-expressRouteCircuit.json" target="_blank"><img src="http://azuredeploy.net/deploybutton.png"/></a>
5. <span data-ttu-id="c99f0-278">Aguarde até o link abrir no Portal do Azure e siga estas etapas:</span><span class="sxs-lookup"><span data-stu-id="c99f0-278">Wait for the link to open in the Azure portal, then follow these steps:</span></span>
   * <span data-ttu-id="c99f0-279">Selecione **Usar existente** na seção **Grupo de recursos** e digite `ra-hybrid-er-rg` na caixa de texto.</span><span class="sxs-lookup"><span data-stu-id="c99f0-279">Select **Use existing** in the **Resource group** section and enter `ra-hybrid-er-rg` in the text box.</span></span>
   * <span data-ttu-id="c99f0-280">Selecione a região na caixa suspensa **Local**.</span><span class="sxs-lookup"><span data-stu-id="c99f0-280">Select the region from the **Location** drop down box.</span></span>
   * <span data-ttu-id="c99f0-281">Não edite as caixas de texto **URI da raiz do modelo** ou **URI da raiz do parâmetro**.</span><span class="sxs-lookup"><span data-stu-id="c99f0-281">Do not edit the **Template Root Uri** or the **Parameter Root Uri** text boxes.</span></span>
   * <span data-ttu-id="c99f0-282">Analise os termos e condições e clique na caixa de seleção **Concordo com os termos e condições declarados acima**.</span><span class="sxs-lookup"><span data-stu-id="c99f0-282">Review the terms and conditions, then click the **I agree to the terms and conditions stated above** checkbox.</span></span>
   * <span data-ttu-id="c99f0-283">Clique no botão **Comprar**.</span><span class="sxs-lookup"><span data-stu-id="c99f0-283">Click the **Purchase** button.</span></span>
6. <span data-ttu-id="c99f0-284">Aguarde até que a implantação seja concluída.</span><span class="sxs-lookup"><span data-stu-id="c99f0-284">Wait for the deployment to complete.</span></span>


<!-- links -->
[forced-tuneling]: ../dmz/secure-vnet-hybrid.md
[highly-available-network-architecture]: ./expressroute-vpn-failover.md

[expressroute-technical-overview]: /azure/expressroute/expressroute-introduction
[expressroute-prereqs]: /azure/expressroute/expressroute-prerequisites
[configure-expressroute-routing]: /azure/expressroute/expressroute-howto-routing-arm
[sla-for-expressroute]: https://azure.microsoft.com/support/legal/sla/expressroute/v1_0/
[link-vnet-to-expressroute]: /azure/expressroute/expressroute-howto-linkvnet-arm
[ExpressRoute-provisioning]: /azure/expressroute/expressroute-workflows
[expressroute-introduction]: /azure/expressroute/expressroute-introduction
[expressroute-peering]: /azure/expressroute/expressroute-circuit-peerings
[expressroute-pricing]: https://azure.microsoft.com/pricing/details/expressroute/
[expressroute-limits]: /azure/azure-subscription-service-limits#networking-limits
[azurect]: https://github.com/Azure/NetworkMonitoring/tree/master/AzureCT
[visio-download]: https://archcenter.blob.core.windows.net/cdn/hybrid-network-architectures.vsdx
[er-circuit-parameters]: https://github.com/mspnp/reference-architectures/tree/master/hybrid-networking/expressroute/parameters/expressRouteCircuit.parameters.json
[azure-powershell-download]: https://azure.microsoft.com/documentation/articles/powershell-install-configure/
[azure-cli]: https://azure.microsoft.com/documentation/articles/xplat-cli-install/
[0]: ./images/expressroute.png "Arquitetura de rede híbrida usando o Azure ExpressRoute"
[1]: ../_images/guidance-hybrid-network-expressroute/figure2.png "Usando roteadores redundantes com circuitos primários e secundários do ExpressRoute"
[2]: ../_images/guidance-hybrid-network-expressroute/figure3.png "Adicionar dispositivos de segurança para a rede local"
[3]: ../_images/guidance-hybrid-network-expressroute/figure4.png "Usando túnel forçado para auditar o tráfego direcionado à Internet"
[4]: ../_images/guidance-hybrid-network-expressroute/figure5.png "Localizando a ServiceKey de um circuito do ExpressRoute"  