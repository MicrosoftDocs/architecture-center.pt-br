---
title: Criar uma floresta de recursos do AD DS no Azure
description: >-
  Como criar um domínio confiável do Active Directory no Azure.

  guidance,vpn-gateway,expressroute,load-balancer,virtual-network,active-directory
author: telmosampaio
ms.date: 11/28/2016
pnp.series.title: Identity management
pnp.series.prev: adds-extend-domain
pnp.series.next: adfs
cardTitle: Create an AD DS forest in Azure
ms.openlocfilehash: e32a6420821e70c84e77d2c39614f0c45efbb7e2
ms.sourcegitcommit: e67b751f230792bba917754d67789a20810dc76b
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/06/2018
---
# <a name="create-an-active-directory-domain-services-ad-ds-resource-forest-in-azure"></a><span data-ttu-id="d5ebe-104">Criar uma floresta de recursos do AD DS (Active Directory Domain Services) no Azure</span><span class="sxs-lookup"><span data-stu-id="d5ebe-104">Create an Active Directory Domain Services (AD DS) resource forest in Azure</span></span>

<span data-ttu-id="d5ebe-105">Essa arquitetura de referência mostra como criar um domínio separado do Active Directory no Azure que é de confiança nos domínios na sua floresta local do AD.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-105">This reference architecture shows how to create a separate Active Directory domain in Azure that is trusted by domains in your on-premises AD forest.</span></span> [<span data-ttu-id="d5ebe-106">**Implante essa solução**.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-106">**Deploy this solution**.</span></span>](#deploy-the-solution)

<span data-ttu-id="d5ebe-107">[![0]][0]</span><span class="sxs-lookup"><span data-stu-id="d5ebe-107">[![0]][0]</span></span> 

<span data-ttu-id="d5ebe-108">*Baixe um [Arquivo Visio][visio-download] dessa arquitetura.*</span><span class="sxs-lookup"><span data-stu-id="d5ebe-108">*Download a [Visio file][visio-download] of this architecture.*</span></span>

<span data-ttu-id="d5ebe-109">O AD DS (Active Directory Domain Services) armazena informações de identidade em uma estrutura hierárquica.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-109">Active Directory Domain Services (AD DS) stores identity information in a hierarchical structure.</span></span> <span data-ttu-id="d5ebe-110">O nó superior na estrutura hierárquica é conhecido como uma floresta.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-110">The top node in the hierarchical structure is known as a forest.</span></span> <span data-ttu-id="d5ebe-111">Uma floresta contém domínios e domínios contêm outros tipos de objetos.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-111">A forest contains domains, and domains contain other types of objects.</span></span> <span data-ttu-id="d5ebe-112">Essa arquitetura de referência cria uma floresta do AD DS no Azure com uma relação de confiança de saída unidirecional com um domínio local.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-112">This reference architecture creates an AD DS forest in Azure with a one-way outgoing trust relationship with an on-premises domain.</span></span> <span data-ttu-id="d5ebe-113">A floresta no Azure contém um domínio que não existe localmente.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-113">The forest in Azure contains a domain that does not exist on-premises.</span></span> <span data-ttu-id="d5ebe-114">Devido à relação de confiança, os logons realizados nos domínios locais pode ser confiáveis para acessar recursos em um domínio separado do Azure.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-114">Because of the trust relationship, logons made against on-premises domains can be trusted for access to resources in the separate Azure domain.</span></span> 

<span data-ttu-id="d5ebe-115">Usos típicos para essa arquitetura incluem manter uma separação segurança para objetos e identidades mantidos na nuvem e migrar os domínios individuais do local para a nuvem.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-115">Typical uses for this architecture include maintaining security separation for objects and identities held in the cloud, and migrating individual domains from on-premises to the cloud.</span></span> 

<span data-ttu-id="d5ebe-116">Para obter considerações adicionais, consulte [Escolher uma solução para a integração do Active Directory local ao Azure][considerations].</span><span class="sxs-lookup"><span data-stu-id="d5ebe-116">For additional considerations, see [Choose a solution for integrating on-premises Active Directory with Azure][considerations].</span></span> 

## <a name="architecture"></a><span data-ttu-id="d5ebe-117">Arquitetura</span><span class="sxs-lookup"><span data-stu-id="d5ebe-117">Architecture</span></span>

<span data-ttu-id="d5ebe-118">A arquitetura tem os seguintes componentes.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-118">The architecture has the following components.</span></span>

* <span data-ttu-id="d5ebe-119">**Rede local**.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-119">**On-premises network**.</span></span> <span data-ttu-id="d5ebe-120">A rede local contém sua própria floresta e domínios do Active Directory.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-120">The on-premises network contains its own Active Directory forest and domains.</span></span>
* <span data-ttu-id="d5ebe-121">**Servidores do Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-121">**Active Directory servers**.</span></span> <span data-ttu-id="d5ebe-122">Esses são controladores de domínio que implementam serviços de domínio em execução como VMs na nuvem.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-122">These are domain controllers implementing domain services running as VMs in the cloud.</span></span> <span data-ttu-id="d5ebe-123">Esses servidores hospedam uma floresta que contém um ou mais domínios, separados daqueles locais.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-123">These servers host a forest containing one or more domains, separate from those located on-premises.</span></span>
* <span data-ttu-id="d5ebe-124">**Relação de confiança unidirecional**.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-124">**One-way trust relationship**.</span></span> <span data-ttu-id="d5ebe-125">O exemplo no diagrama mostra uma relação de confiança unidirecional do domínio no Azure para o domínio local.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-125">The example in the diagram shows a one-way trust from the domain in Azure to the on-premises domain.</span></span> <span data-ttu-id="d5ebe-126">Essa relação permite que os usuários locais acessem os recursos no domínio no Azure, mas não o oposto.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-126">This relationship enables on-premises users to access resources in the domain in Azure, but not the other way around.</span></span> <span data-ttu-id="d5ebe-127">É possível criar uma relação de confiança bidirecional se os usuários de nuvem também precisarem de acesso aos recursos locais.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-127">It is possible to create a two-way trust if cloud users also require access to on-premises resources.</span></span>
* <span data-ttu-id="d5ebe-128">**Sub-rede do Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-128">**Active Directory subnet**.</span></span> <span data-ttu-id="d5ebe-129">Os servidores do AD DS são hospedados em uma sub-rede separada.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-129">The AD DS servers are hosted in a separate subnet.</span></span> <span data-ttu-id="d5ebe-130">As regras de NSG (grupo de segurança de rede) protegem os servidores do AD DS e fornecem um firewall em tráfego de fontes inesperadas.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-130">Network security group (NSG) rules protect the AD DS servers and provide a firewall against traffic from unexpected sources.</span></span>
* <span data-ttu-id="d5ebe-131">**Gateway do Azure**.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-131">**Azure gateway**.</span></span> <span data-ttu-id="d5ebe-132">O gateway do Azure fornece uma conexão entre a rede local e a VNet do Azure.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-132">The Azure gateway provides a connection between the on-premises network and the Azure VNet.</span></span> <span data-ttu-id="d5ebe-133">Essa pode ser uma [conexão VPN][azure-vpn-gateway] ou do [Azure ExpressRoute][azure-expressroute].</span><span class="sxs-lookup"><span data-stu-id="d5ebe-133">This can be a [VPN connection][azure-vpn-gateway] or [Azure ExpressRoute][azure-expressroute].</span></span> <span data-ttu-id="d5ebe-134">Para obter mais informações, consulte [Implementar uma arquitetura de rede híbrida segura no Azure][implementing-a-secure-hybrid-network-architecture].</span><span class="sxs-lookup"><span data-stu-id="d5ebe-134">For more information, see [Implementing a secure hybrid network architecture in Azure][implementing-a-secure-hybrid-network-architecture].</span></span>

## <a name="recommendations"></a><span data-ttu-id="d5ebe-135">Recomendações</span><span class="sxs-lookup"><span data-stu-id="d5ebe-135">Recommendations</span></span>

<span data-ttu-id="d5ebe-136">Para obter recomendações específicas sobre a implementação do Active Directory no Azure, consulte os seguintes artigos:</span><span class="sxs-lookup"><span data-stu-id="d5ebe-136">For specific recommendations on implementing Active Directory in Azure, see the following articles:</span></span>

- <span data-ttu-id="d5ebe-137">[Extensão do AD DS (Active Directory Domain Services) para o Azure][adds-extend-domain].</span><span class="sxs-lookup"><span data-stu-id="d5ebe-137">[Extending Active Directory Domain Services (AD DS) to Azure][adds-extend-domain].</span></span> 
- <span data-ttu-id="d5ebe-138">[Diretrizes para implantar o Active Directory do Windows Server em máquinas virtuais do Azure][ad-azure-guidelines].</span><span class="sxs-lookup"><span data-stu-id="d5ebe-138">[Guidelines for Deploying Windows Server Active Directory on Azure Virtual Machines][ad-azure-guidelines].</span></span>

### <a name="trust"></a><span data-ttu-id="d5ebe-139">Confiar</span><span class="sxs-lookup"><span data-stu-id="d5ebe-139">Trust</span></span>

<span data-ttu-id="d5ebe-140">Os domínios locais estão contidos em uma floresta diferente dos domínios na nuvem.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-140">The on-premises domains are contained within a different forest from the domains in the cloud.</span></span> <span data-ttu-id="d5ebe-141">Para habilitar a autenticação de usuários locais na nuvem, os domínios no Azure precisam confiar no domínio de logon na floresta local.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-141">To enable authentication of on-premises users in the cloud, the domains in Azure must trust the logon domain in the on-premises forest.</span></span> <span data-ttu-id="d5ebe-142">Da mesma forma, se a nuvem fornece um domínio de logon para usuários externos, pode ser necessário que a floresta local confie no domínio de nuvem.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-142">Similarly, if the cloud provides a logon domain for external users, it may be necessary for the on-premises forest to trust the cloud domain.</span></span>

<span data-ttu-id="d5ebe-143">Você pode estabelecer relações de confiança no nível de floresta [criando relações de confiança de floresta][creating-forest-trusts] ou no nível do domínio [criando relações de confiança externas][creating-external-trusts].</span><span class="sxs-lookup"><span data-stu-id="d5ebe-143">You can establish trusts at the forest level by [creating forest trusts][creating-forest-trusts], or at the domain level by [creating external trusts][creating-external-trusts].</span></span> <span data-ttu-id="d5ebe-144">Uma confiança no nível de floresta cria uma relação entre todos os domínios nas duas florestas.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-144">A forest level trust creates a relationship between all domains in two forests.</span></span> <span data-ttu-id="d5ebe-145">Uma relação de confiança no nível de domínio externo só cria uma relação entre dois domínios especificados.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-145">An external domain level trust only creates a relationship between two specified domains.</span></span> <span data-ttu-id="d5ebe-146">Você só deve criar relações de confiança no nível de domínio externo entre domínios de florestas diferentes.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-146">You should only create external domain level trusts between domains in different forests.</span></span>

<span data-ttu-id="d5ebe-147">Relações de confiança podem ser unidirecionais ou bidirecionais:</span><span class="sxs-lookup"><span data-stu-id="d5ebe-147">Trusts can be unidirectional (one-way) or bidirectional (two-way):</span></span>

* <span data-ttu-id="d5ebe-148">Uma relação de confiança unidirecional permite que os usuários em um domínio ou floresta (conhecido como o domínio ou a floresta de *entrada*) para acessar os recursos contidos em outro (o domínio ou a floresta de *saída*).</span><span class="sxs-lookup"><span data-stu-id="d5ebe-148">A one-way trust enables users in one domain or forest (known as the *incoming* domain or forest) to access the resources held in another (the *outgoing* domain or forest).</span></span>
* <span data-ttu-id="d5ebe-149">Uma relação de confiança bidirecional permite que os usuários no domínio ou floresta acessem os recursos mantidos no outro.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-149">A two-way trust enables users in either domain or forest to access resources held in the other.</span></span>

<span data-ttu-id="d5ebe-150">A tabela a seguir resume as configurações de confiança para alguns cenários simples:</span><span class="sxs-lookup"><span data-stu-id="d5ebe-150">The following table summarizes trust configurations for some simple scenarios:</span></span>

| <span data-ttu-id="d5ebe-151">Cenário</span><span class="sxs-lookup"><span data-stu-id="d5ebe-151">Scenario</span></span> | <span data-ttu-id="d5ebe-152">Relação de confiança local</span><span class="sxs-lookup"><span data-stu-id="d5ebe-152">On-premises trust</span></span> | <span data-ttu-id="d5ebe-153">Relação de confiança na nuvem</span><span class="sxs-lookup"><span data-stu-id="d5ebe-153">Cloud trust</span></span> |
| --- | --- | --- |
| <span data-ttu-id="d5ebe-154">Os usuários locais precisam de acesso aos recursos na nuvem, mas não vice-versa</span><span class="sxs-lookup"><span data-stu-id="d5ebe-154">On-premises users require access to resources in the cloud, but not vice versa</span></span> |<span data-ttu-id="d5ebe-155">Unidirecional de entrada</span><span class="sxs-lookup"><span data-stu-id="d5ebe-155">One-way, incoming</span></span> |<span data-ttu-id="d5ebe-156">Unidirecional de saída</span><span class="sxs-lookup"><span data-stu-id="d5ebe-156">One-way, outgoing</span></span> |
| <span data-ttu-id="d5ebe-157">Os usuários na nuvem precisam de acesso aos recursos locais, mas não vice-versa</span><span class="sxs-lookup"><span data-stu-id="d5ebe-157">Users in the cloud require access to resources located on-premises, but not vice versa</span></span> |<span data-ttu-id="d5ebe-158">Unidirecional de saída</span><span class="sxs-lookup"><span data-stu-id="d5ebe-158">One-way, outgoing</span></span> |<span data-ttu-id="d5ebe-159">Unidirecional de entrada</span><span class="sxs-lookup"><span data-stu-id="d5ebe-159">One-way, incoming</span></span> |
| <span data-ttu-id="d5ebe-160">Os usuários na nuvem e local precisam de acesso aos recursos mantidos tanto na nuvem quanto locais</span><span class="sxs-lookup"><span data-stu-id="d5ebe-160">Users in the cloud and on-premises both requires access to resources held in the cloud and on-premises</span></span> |<span data-ttu-id="d5ebe-161">Bidirecional de entrada e saída</span><span class="sxs-lookup"><span data-stu-id="d5ebe-161">Two-way, incoming and outgoing</span></span> |<span data-ttu-id="d5ebe-162">Bidirecional de entrada e saída</span><span class="sxs-lookup"><span data-stu-id="d5ebe-162">Two-way, incoming and outgoing</span></span> |

## <a name="scalability-considerations"></a><span data-ttu-id="d5ebe-163">Considerações sobre escalabilidade</span><span class="sxs-lookup"><span data-stu-id="d5ebe-163">Scalability considerations</span></span>

<span data-ttu-id="d5ebe-164">O Active Directory é automaticamente escalonável para controladores de domínio que fazem parte do mesmo domínio.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-164">Active Directory is automatically scalable for domain controllers that are part of the same domain.</span></span> <span data-ttu-id="d5ebe-165">As solicitações são distribuídas por todos os controladores em um domínio.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-165">Requests are distributed across all controllers within a domain.</span></span> <span data-ttu-id="d5ebe-166">Você pode adicionar outro controlador de domínio e ele é sincronizado automaticamente com o domínio.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-166">You can add another domain controller, and it synchronizes automatically with the domain.</span></span> <span data-ttu-id="d5ebe-167">Não configure um balanceador de carga separado para direcionar o tráfego para os controladores no domínio.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-167">Do not configure a separate load balancer to direct traffic to controllers within the domain.</span></span> <span data-ttu-id="d5ebe-168">Verifique se todos os controladores de domínio têm recursos de memória e armazenamento suficientes para lidar com o banco de dados do domínio.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-168">Ensure that all domain controllers have sufficient memory and storage resources to handle the domain database.</span></span> <span data-ttu-id="d5ebe-169">Deixe todas as VMs do controlador de domínio com o mesmo tamanho.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-169">Make all domain controller VMs the same size.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="d5ebe-170">Considerações sobre disponibilidade</span><span class="sxs-lookup"><span data-stu-id="d5ebe-170">Availability considerations</span></span>

<span data-ttu-id="d5ebe-171">Provisione pelo menos dois controladores de domínio para cada domínio.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-171">Provision at least two domain controllers for each domain.</span></span> <span data-ttu-id="d5ebe-172">Isso habilita a replicação automática entre os servidores.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-172">This enables automatic replication between servers.</span></span> <span data-ttu-id="d5ebe-173">Crie um conjunto de disponibilidade para as VMs que atuam como servidores do Active Directory que tratam de cada domínio.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-173">Create an availability set for the VMs acting as Active Directory servers handling each domain.</span></span> <span data-ttu-id="d5ebe-174">Coloque pelo menos dois servidores neste conjunto de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-174">Put at least two servers in this availability set.</span></span>

<span data-ttu-id="d5ebe-175">Além disso, considere a possibilidade de designar um ou mais servidores em cada domínio como [mestres de operações em espera][standby-operations-masters] em caso de falha de conectividade com um servidor que atua na função de FSMO (operações principais únicas flexíveis).</span><span class="sxs-lookup"><span data-stu-id="d5ebe-175">Also, consider designating one or more servers in each domain as [standby operations masters][standby-operations-masters] in case connectivity to a server acting as a flexible single master operation (FSMO) role fails.</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="d5ebe-176">Considerações sobre capacidade de gerenciamento</span><span class="sxs-lookup"><span data-stu-id="d5ebe-176">Manageability considerations</span></span>

<span data-ttu-id="d5ebe-177">Para obter informações sobre as considerações de gerenciamento e monitoramento, consulte [Estendendo o Active Directory para o Azure][adds-extend-domain].</span><span class="sxs-lookup"><span data-stu-id="d5ebe-177">For information about management and monitoring considerations, see [Extending Active Directory to Azure][adds-extend-domain].</span></span> 
 
<span data-ttu-id="d5ebe-178">Para obter informações adicionais, consulte [Monitoramento do Active Directory][monitoring_ad].</span><span class="sxs-lookup"><span data-stu-id="d5ebe-178">For additional information, see [Monitoring Active Directory][monitoring_ad].</span></span> <span data-ttu-id="d5ebe-179">Você pode instalar ferramentas como o [Microsoft Systems Center][microsoft_systems_center] em um servidor de monitoramento na sub-rede de gerenciamento para ajudar a executar essas tarefas.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-179">You can install tools such as [Microsoft Systems Center][microsoft_systems_center] on a monitoring server in the management subnet to help perform these tasks.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="d5ebe-180">Considerações de segurança</span><span class="sxs-lookup"><span data-stu-id="d5ebe-180">Security considerations</span></span>

<span data-ttu-id="d5ebe-181">As relações de confiança no nível de floresta são transitivas.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-181">Forest level trusts are transitive.</span></span> <span data-ttu-id="d5ebe-182">Se você estabelecer uma relação de confiança no nível de floresta entre uma floresta local e uma floresta na nuvem, essa relação de confiança é estendida para outros novos domínios criados em uma dessas florestas.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-182">If you establish a forest level trust between an on-premises forest and a forest in the cloud, this trust is extended to other new domains created in either forest.</span></span> <span data-ttu-id="d5ebe-183">Se você usar domínios para fornecer separação para fins de segurança, considere criar relações de confiança somente no nível de domínio.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-183">If you use domains to provide separation for security purposes, consider creating trusts at the domain level only.</span></span> <span data-ttu-id="d5ebe-184">As relações de confiança no nível de domínio são não transitivas.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-184">Domain level trusts are non-transitive.</span></span>

<span data-ttu-id="d5ebe-185">Para considerações de segurança específicas do Active Directory, consulte a seção de considerações de segurança em [Estendendo o Active Directory para o Azure][adds-extend-domain].</span><span class="sxs-lookup"><span data-stu-id="d5ebe-185">For Active Directory-specific security considerations, see the security considerations section in [Extending Active Directory to Azure][adds-extend-domain].</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="d5ebe-186">Implantar a solução</span><span class="sxs-lookup"><span data-stu-id="d5ebe-186">Deploy the solution</span></span>

<span data-ttu-id="d5ebe-187">Há uma solução disponível no [GitHub][github] para implantar essa arquitetura de referência.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-187">A solution is available on [GitHub][github] to deploy this reference architecture.</span></span> <span data-ttu-id="d5ebe-188">Você precisará da versão mais recente da CLI do Azure para executar o script do Powershell que implanta a solução.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-188">You will need the latest version of the Azure CLI to run the Powershell script that deploys the solution.</span></span> <span data-ttu-id="d5ebe-189">Para implantar a arquitetura de referência, siga estas etapas:</span><span class="sxs-lookup"><span data-stu-id="d5ebe-189">To deploy the reference architecture, follow these steps:</span></span>

1. <span data-ttu-id="d5ebe-190">Baixe ou clone a pasta da solução do [GitHub][github] em seu computador local.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-190">Download or clone the solution folder from [GitHub][github] to your local machine.</span></span>

2. <span data-ttu-id="d5ebe-191">Abra a CLI do Azure e navegue até a pasta da solução local.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-191">Open the Azure CLI and navigate to the local solution folder.</span></span>

3. <span data-ttu-id="d5ebe-192">Execute o comando a seguir:</span><span class="sxs-lookup"><span data-stu-id="d5ebe-192">Run the following command:</span></span>
   
    ```Powershell
    .\Deploy-ReferenceArchitecture.ps1 <subscription id> <location> <mode>
    ```
   
    <span data-ttu-id="d5ebe-193">Substitua `<subscription id>` por sua ID da assinatura do Azure.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-193">Replace `<subscription id>` with your Azure subscription ID.</span></span>
   
    <span data-ttu-id="d5ebe-194">Para `<location>`, especifique uma região do Azure, como `eastus` ou `westus`.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-194">For `<location>`, specify an Azure region, such as `eastus` or `westus`.</span></span>
   
    <span data-ttu-id="d5ebe-195">O parâmetro `<mode>` controla a granularidade da implantação e pode ser um dos seguintes valores:</span><span class="sxs-lookup"><span data-stu-id="d5ebe-195">The `<mode>` parameter controls the granularity of the deployment, and can be one of the following values:</span></span>
   
   * <span data-ttu-id="d5ebe-196">`Onpremise`: implanta o ambiente local simulado.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-196">`Onpremise`: deploys the simulated on-premises environment.</span></span>
   * <span data-ttu-id="d5ebe-197">`Infrastructure`: implanta a infraestrutura e jump box da VNet no Azure.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-197">`Infrastructure`: deploys the VNet infrastructure and jump box in Azure.</span></span>
   * <span data-ttu-id="d5ebe-198">`CreateVpn`: implanta o gateway de rede virtual do Azure e conecta-o à rede local simulada.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-198">`CreateVpn`: deploys the Azure virtual network gateway and connects it to the simulated on-premises network.</span></span>
   * <span data-ttu-id="d5ebe-199">`AzureADDS`: implanta as VMs que atuam como servidores do Active Directory DS, implante o Active Directory nessas VMs e implanta o domínio no Azure.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-199">`AzureADDS`: deploys the VMs acting as Active Directory DS servers, deploys Active Directory to these VMs, and deploys the domain in Azure.</span></span>
   * <span data-ttu-id="d5ebe-200">`WebTier`: implanta as VMs e o balanceador de carga na camada da Web.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-200">`WebTier`: deploys the web tier VMs and load balancer.</span></span>
   * <span data-ttu-id="d5ebe-201">`Prepare`: implanta todas as implantações anteriores.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-201">`Prepare`: deploys all of the preceding deployments.</span></span> <span data-ttu-id="d5ebe-202">**Essa é a opção recomendada se você não tem uma rede local existente, mas deseja implantar a arquitetura de referência completa descrita acima para teste ou avaliação.**</span><span class="sxs-lookup"><span data-stu-id="d5ebe-202">**This is the recommended option if If you do not have an existing on-premises network but you want to deploy the complete reference architecture described above for testing or evaluation.**</span></span> 
   * <span data-ttu-id="d5ebe-203">`Workload`: implanta as VMs e o balanceador de carga na camada de dados e comercial.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-203">`Workload`: deploys the business and data tier VMs and load balancers.</span></span> <span data-ttu-id="d5ebe-204">Observe que essas VMs não são incluídas na implantação `Prepare`.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-204">Note that these VMs are not included in the `Prepare` deployment.</span></span>

4. <span data-ttu-id="d5ebe-205">Aguarde até que a implantação seja concluída.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-205">Wait for the deployment to complete.</span></span> <span data-ttu-id="d5ebe-206">Se você estiver realizando a implantação de `Prepare`, isso levará várias horas.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-206">If you are deploying the `Prepare` deployment, it will take several hours.</span></span>
     
5. <span data-ttu-id="d5ebe-207">Se você estiver usando a configuração local simulada, defina a relação de confiança de entrada:</span><span class="sxs-lookup"><span data-stu-id="d5ebe-207">If you are using the simulated on-premises configuration, configure the incoming trust relationship:</span></span>
   
   1. <span data-ttu-id="d5ebe-208">Conecte-se ao jump box (<em>ra-adtrust-mgmt-vm1</em> no grupo de recursos <em>ra-adtrust-security-rg</em>).</span><span class="sxs-lookup"><span data-stu-id="d5ebe-208">Connect to the jump box (<em>ra-adtrust-mgmt-vm1</em> in the <em>ra-adtrust-security-rg</em> resource group).</span></span> <span data-ttu-id="d5ebe-209">Faça logon como <em>testuser</em> com a senha <em>AweS0me@PW</em>.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-209">Log in as <em>testuser</em> with password <em>AweS0me@PW</em>.</span></span>
   2. <span data-ttu-id="d5ebe-210">No jump box, abra uma sessão RDP na primeira VM no domínio <em>contoso.com</em> (o domínio local).</span><span class="sxs-lookup"><span data-stu-id="d5ebe-210">On the jump box open an RDP session on the first VM in the <em>contoso.com</em> domain (the on-premises domain).</span></span> <span data-ttu-id="d5ebe-211">Essa VM tem o endereço IP 192.168.0.4.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-211">This VM has the IP address 192.168.0.4.</span></span> <span data-ttu-id="d5ebe-212">O nome de usuário é <em>contoso\testuser</em> com a senha <em>AweS0me@PW</em>.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-212">The username is <em>contoso\testuser</em> with password <em>AweS0me@PW</em>.</span></span>
   3. <span data-ttu-id="d5ebe-213">Baixe o script [incoming-trust.ps1][incoming-trust] e execute-o para criar a relação de confiança de entrada do *treyresearch.com*.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-213">Download the [incoming-trust.ps1][incoming-trust] script and run it to create the incoming trust from the *treyresearch.com* domain.</span></span>

6. <span data-ttu-id="d5ebe-214">Se você estiver usando sua própria infraestrutura local:</span><span class="sxs-lookup"><span data-stu-id="d5ebe-214">If you are using your own on-premises infrastructure:</span></span>
   
   1. <span data-ttu-id="d5ebe-215">Baixe o script [incoming-trust.ps1][incoming-trust].</span><span class="sxs-lookup"><span data-stu-id="d5ebe-215">Download the [incoming-trust.ps1][incoming-trust] script.</span></span>
   2. <span data-ttu-id="d5ebe-216">Edite o script e substitua o valor da variável `$TrustedDomainName` pelo nome do seu próprio domínio.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-216">Edit the script and replace the value of the `$TrustedDomainName` variable with the name of your own domain.</span></span>
   3. <span data-ttu-id="d5ebe-217">Execute o script.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-217">Run the script.</span></span>

7. <span data-ttu-id="d5ebe-218">No jump-box, conecte-se à primeira VM no domínio <em>treyresearch.com</em> (o domínio na nuvem).</span><span class="sxs-lookup"><span data-stu-id="d5ebe-218">From the jump-box, connect to the first VM in the <em>treyresearch.com</em> domain (the domain in the cloud).</span></span> <span data-ttu-id="d5ebe-219">Essa VM tem o endereço IP 10.0.4.4.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-219">This VM has the IP address 10.0.4.4.</span></span> <span data-ttu-id="d5ebe-220">O nome de usuário é <em>treyresearch\testuser</em> com a senha <em>AweS0me@PW</em>.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-220">The username is <em>treyresearch\testuser</em> with password <em>AweS0me@PW</em>.</span></span>

8. <span data-ttu-id="d5ebe-221">Baixe o script [outgoing-trust.ps1][outgoing-trust] e execute-o para criar a relação de confiança de entrada do *treyresearch.com*.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-221">Download the [outgoing-trust.ps1][outgoing-trust] script and run it to create the incoming trust from the *treyresearch.com* domain.</span></span> <span data-ttu-id="d5ebe-222">Se você estiver usando seus próprios computadores locais, edite o script primeiro.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-222">If you are using your own on-premises machines, then edit the script first.</span></span> <span data-ttu-id="d5ebe-223">Definir a variável `$TrustedDomainName` para o nome do seu domínio local e especifique os endereços IP dos servidores do Active Directory DS para esse domínio na variável `$TrustedDomainDnsIpAddresses`.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-223">Set the `$TrustedDomainName` variable to the name of your on-premises domain, and specify the IP addresses of the Active Directory DS servers for this domain in the `$TrustedDomainDnsIpAddresses` variable.</span></span>

9. <span data-ttu-id="d5ebe-224">Aguarde alguns minutos para que as etapas anteriores sejam concluídas, conecte-se a uma VM local e execute as etapas descritas no artigo [Verificar uma relação de confiança][verify-a-trust] para determinar se a relação de confiança entre os domínios *contoso.com* e *treyresearch.com* está configurada corretamente.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-224">Wait a few minutes for the previous steps to complete, then connect to an on-premises VM and perform the steps outlined in the article [Verify a Trust][verify-a-trust] to determine whether the trust relationship between the *contoso.com* and *treyresearch.com* domains is correctly configured.</span></span>

## <a name="next-steps"></a><span data-ttu-id="d5ebe-225">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="d5ebe-225">Next steps</span></span>

* <span data-ttu-id="d5ebe-226">Conheça as práticas recomendadas para [estender seu domínio do AD DS local para o Azure][adds-extend-domain]</span><span class="sxs-lookup"><span data-stu-id="d5ebe-226">Learn the best practices for [extending your on-premises AD DS domain to Azure][adds-extend-domain]</span></span>
* <span data-ttu-id="d5ebe-227">Conheça as práticas recomendadas para [criar uma infraestrutura do AD FS][adfs] no Azure.</span><span class="sxs-lookup"><span data-stu-id="d5ebe-227">Learn the best practices for [creating an AD FS infrastructure][adfs] in Azure.</span></span>

<!-- links -->
[adds-extend-domain]: adds-extend-domain.md
[adfs]: adfs.md

[implementing-a-secure-hybrid-network-architecture]: ../dmz/secure-vnet-hybrid.md
[implementing-a-secure-hybrid-network-architecture-with-internet-access]: ../dmz/secure-vnet-dmz.md

[running-VMs-for-an-N-tier-architecture-on-Azure]: ../virtual-machines-windows/n-tier.md

[ad-azure-guidelines]: https://msdn.microsoft.com/library/azure/jj156090.aspx
[azure-expressroute]: https://azure.microsoft.com/documentation/articles/expressroute-introduction/
[azure-vpn-gateway]: https://azure.microsoft.com/documentation/articles/vpn-gateway-about-vpngateways/
[considerations]: ./considerations.md
[creating-external-trusts]: https://technet.microsoft.com/library/cc816837(v=ws.10).aspx
[creating-forest-trusts]: https://technet.microsoft.com/library/cc816810(v=ws.10).aspx
[github]: https://github.com/mspnp/reference-architectures/tree/master/identity/adds-forest
[incoming-trust]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/identity/adds-forest/extensions/incoming-trust.ps1
[microsoft_systems_center]: https://www.microsoft.com/server-cloud/products/system-center-2016/
[monitoring_ad]: https://msdn.microsoft.com/library/bb727046.aspx
[resource-manager-overview]: /azure/azure-resource-manager/resource-group-overview
[solution-script]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/identity/adds-forest/Deploy-ReferenceArchitecture.ps1
[standby-operations-masters]: https://technet.microsoft.com/library/cc794737(v=ws.10).aspx
[outgoing-trust]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/identity/adds-forest/extensions/outgoing-trust.ps1
[verify-a-trust]: https://technet.microsoft.com/library/cc753821.aspx
[visio-download]: https://archcenter.blob.core.windows.net/cdn/identity-architectures.vsdx
[0]: ./images/adds-forest.png "Proteger a arquitetura de rede híbrida com domínios separados do Active Directory"