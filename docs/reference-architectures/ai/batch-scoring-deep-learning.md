---
title: Pontuação em lote para modelos de aprendizado profundo
titleSuffix: Azure Reference Architectures
description: Essa arquitetura de referência mostra como aplicar a transferência de estilo neural a um vídeo usando o Azure Machine Learning.
author: jiata
ms.date: 02/06/2019
ms.topic: reference-architecture
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: azcat-ai
ms.openlocfilehash: 3459f7895b7b57833da5853a77b2641dc7c85a9e
ms.sourcegitcommit: 579c39ff4b776704ead17a006bf24cd4cdc65edd
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/17/2019
ms.locfileid: "59639709"
---
# <a name="batch-scoring-of-deep-learning-models-on-azure"></a><span data-ttu-id="6f666-103">Lote de pontuação de modelos de aprendizado aprofundado no Azure</span><span class="sxs-lookup"><span data-stu-id="6f666-103">Batch scoring of deep learning models on Azure</span></span>

<span data-ttu-id="6f666-104">Essa arquitetura de referência mostra como aplicar a transferência de estilo neural a um vídeo usando o Azure Machine Learning.</span><span class="sxs-lookup"><span data-stu-id="6f666-104">This reference architecture shows how to apply neural style transfer to a video, using Azure Machine Learning.</span></span> <span data-ttu-id="6f666-105">A *Transferência de estilo* é uma técnica de aprendizado profundo que compõe uma imagem existente no estilo de outra imagem.</span><span class="sxs-lookup"><span data-stu-id="6f666-105">*Style transfer* is a deep learning technique that composes an existing image in the style of another image.</span></span> <span data-ttu-id="6f666-106">Essa arquitetura pode ser generalizada para qualquer cenário que usa a pontuação do lote com aprendizado profundo.</span><span class="sxs-lookup"><span data-stu-id="6f666-106">This architecture can be generalized for any scenario that uses batch scoring with deep learning.</span></span> <span data-ttu-id="6f666-107">[**Implantar esta solução**](#deploy-the-solution).</span><span class="sxs-lookup"><span data-stu-id="6f666-107">[**Deploy this solution**](#deploy-the-solution).</span></span>

![Diagrama da arquitetura para modelos de aprendizado profundo usando o Azure Machine Learning](./_images/aml-scoring-deep-learning.png)

<span data-ttu-id="6f666-109">**Cenário**: uma organização de mídia tem um vídeo cujo estilo ela quer alterar para procurar uma pintura específica.</span><span class="sxs-lookup"><span data-stu-id="6f666-109">**Scenario**: A media organization has a video whose style they want to change to look like a specific painting.</span></span> <span data-ttu-id="6f666-110">A organização quer ser capaz de aplicar esse estilo a todos os quadros do vídeo em tempo hábil e de uma forma automatizada.</span><span class="sxs-lookup"><span data-stu-id="6f666-110">The organization wants to be able to apply this style to all frames of the video in a timely manner and in an automated fashion.</span></span> <span data-ttu-id="6f666-111">Para saber mais sobre os algoritmos de transferência de estilo neural, consulte [Transferência de estilo de imagem usando redes neurais convolucionais neurais][image-style-transfer] (PDF).</span><span class="sxs-lookup"><span data-stu-id="6f666-111">For more background about neural style transfer algorithms, see [Image Style Transfer Using Convolutional Neural Networks][image-style-transfer] (PDF).</span></span>

<!-- markdownlint-disable MD033 -->

| <span data-ttu-id="6f666-112">Imagem do estilo:</span><span class="sxs-lookup"><span data-stu-id="6f666-112">Style image:</span></span> | <span data-ttu-id="6f666-113">Vídeo de entrada/conteúdo:</span><span class="sxs-lookup"><span data-stu-id="6f666-113">Input/content video:</span></span> | <span data-ttu-id="6f666-114">Vídeo de saída:</span><span class="sxs-lookup"><span data-stu-id="6f666-114">Output video:</span></span> |
|--------|--------|---------|
| <img src="https://happypathspublic.blob.core.windows.net/assets/batch_scoring_for_dl/style_image.jpg" width="300"> | <span data-ttu-id="6f666-115">[<img src="https://happypathspublic.blob.core.windows.net/assets/batch_scoring_for_dl/input_video_image_0.jpg" width="300" height="300">](https://happypathspublic.blob.core.windows.net/assets/batch_scoring_for_dl/input_video.mp4 "Vídeo de entrada") *clique para ver o vídeo*</span><span class="sxs-lookup"><span data-stu-id="6f666-115">[<img src="https://happypathspublic.blob.core.windows.net/assets/batch_scoring_for_dl/input_video_image_0.jpg" width="300" height="300">](https://happypathspublic.blob.core.windows.net/assets/batch_scoring_for_dl/input_video.mp4 "Input Video") *click to view video*</span></span> | <span data-ttu-id="6f666-116">[<img src="https://happypathspublic.blob.core.windows.net/assets/batch_scoring_for_dl/output_video_image_0.jpg" width="300" height="300">](https://happypathspublic.blob.core.windows.net/assets/batch_scoring_for_dl/output_video.mp4 "Vídeo de saída") *clique para ver o vídeo*</span><span class="sxs-lookup"><span data-stu-id="6f666-116">[<img src="https://happypathspublic.blob.core.windows.net/assets/batch_scoring_for_dl/output_video_image_0.jpg" width="300" height="300">](https://happypathspublic.blob.core.windows.net/assets/batch_scoring_for_dl/output_video.mp4 "Output Video") *click to view video*</span></span> |

<!-- markdownlint-enable MD033 -->

<span data-ttu-id="6f666-117">Essa arquitetura de referência foi projetada para cargas de trabalho que são disparadas pela presença da nova mídia no Armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="6f666-117">This reference architecture is designed for workloads that are triggered by the presence of new media in Azure storage.</span></span>

<span data-ttu-id="6f666-118">O processamento envolve as seguintes etapas:</span><span class="sxs-lookup"><span data-stu-id="6f666-118">Processing involves the following steps:</span></span>

1. <span data-ttu-id="6f666-119">Carregar um arquivo de vídeo no armazenamento.</span><span class="sxs-lookup"><span data-stu-id="6f666-119">Upload a video file to storage.</span></span>
1. <span data-ttu-id="6f666-120">O arquivo de vídeo dispara um Aplicativo Lógico que envia uma solicitação para o pipeline de ponto de extremidade publicado do Azure Machine Learning.</span><span class="sxs-lookup"><span data-stu-id="6f666-120">The video file triggers a Logic App to send a request to the Azure Machine Learning pipeline published endpoint.</span></span>
1. <span data-ttu-id="6f666-121">O pipeline processa o vídeo, aplica a transferência de estilo com o MPI e faz o pós-processamento do vídeo.</span><span class="sxs-lookup"><span data-stu-id="6f666-121">The pipeline processes the video, applies style transfer with MPI, and postprocesses the video.</span></span>
1. <span data-ttu-id="6f666-122">A saída é salva novamente no armazenamento de blobs depois que o pipeline é concluído.</span><span class="sxs-lookup"><span data-stu-id="6f666-122">The output is saved back to blob storage once the pipeline is completed.</span></span>

## <a name="architecture"></a><span data-ttu-id="6f666-123">Arquitetura</span><span class="sxs-lookup"><span data-stu-id="6f666-123">Architecture</span></span>

<span data-ttu-id="6f666-124">Essa arquitetura é formada pelos componentes a seguir.</span><span class="sxs-lookup"><span data-stu-id="6f666-124">This architecture consists of the following components.</span></span>

### <a name="compute"></a><span data-ttu-id="6f666-125">Computação</span><span class="sxs-lookup"><span data-stu-id="6f666-125">Compute</span></span>

<span data-ttu-id="6f666-126">**[O Serviço Azure Machine Learning][amls]** utiliza pipelines do Azure Machine Learning para criar sequências de computação reproduzíveis e fáceis de gerenciar.</span><span class="sxs-lookup"><span data-stu-id="6f666-126">**[Azure Machine Learning Service][amls]** uses Azure Machine Learning Pipelines to create reproducible and easy-to-manage sequences of computation.</span></span> <span data-ttu-id="6f666-127">Ele também oferece um destino de computação gerenciado (no qual um cálculo de pipeline pode ser executado) chamado [Computação do Azure Machine Learning][aml-compute] para treinamento, implantação e pontuação de modelos de machine learning.</span><span class="sxs-lookup"><span data-stu-id="6f666-127">It also offers a managed compute target (on which a pipeline computation can run) called [Azure Machine Learning Compute][aml-compute] for training, deploying, and scoring machine learning models.</span></span>

### <a name="storage"></a><span data-ttu-id="6f666-128">Armazenamento</span><span class="sxs-lookup"><span data-stu-id="6f666-128">Storage</span></span>

<span data-ttu-id="6f666-129">O **[armazenamento de Blobs][blob-storage]** é usado para armazenar todas as imagens (imagens de entrada, imagens de estilo e imagens de saída).</span><span class="sxs-lookup"><span data-stu-id="6f666-129">**[Blob storage][blob-storage]** is used to store all images (input images, style images, and output images).</span></span> <span data-ttu-id="6f666-130">O Serviço Azure Machine Learning integra-se com o armazenamento de blobs para que os usuários não precisem mover manualmente os dados entre as plataformas de computação e o armazenamento de blobs.</span><span class="sxs-lookup"><span data-stu-id="6f666-130">Azure Machine Learning Service integrates with Blob storage so that users do not have to manually move data across compute platforms and Blob storage.</span></span> <span data-ttu-id="6f666-131">O Armazenamento de Blobs também é muito econômico para o desempenho exigido por essa carga de trabalho.</span><span class="sxs-lookup"><span data-stu-id="6f666-131">Blob storage is also very cost-effective for the performance that this workload requires.</span></span>

### <a name="trigger--scheduling"></a><span data-ttu-id="6f666-132">Gatilho/agendamento</span><span class="sxs-lookup"><span data-stu-id="6f666-132">Trigger / scheduling</span></span>

<span data-ttu-id="6f666-133">**[Aplicativos Lógicos do Azure][logic-apps]** são usados para disparar o fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="6f666-133">**[Azure Logic Apps][logic-apps]** is used to trigger the workflow.</span></span> <span data-ttu-id="6f666-134">Quando o Aplicativo Lógico detecta que um blob foi adicionado ao contêiner, ele dispara o pipeline do Azure Machine Learning.</span><span class="sxs-lookup"><span data-stu-id="6f666-134">When the Logic App detects that a blob has been added to the container, it triggers the Azure Machine Learning Pipeline.</span></span> <span data-ttu-id="6f666-135">O Aplicativo Lógico é ótimo para esta arquitetura de referência porque é uma maneira fácil de detectar alterações no armazenamento de blobs e fornece um processo fácil para alterar o gatilho.</span><span class="sxs-lookup"><span data-stu-id="6f666-135">Logic Apps is a good fit for this reference architecture because it's an easy way to detect changes to blob storage and provides an easy process for changing the trigger.</span></span>

### <a name="preprocessing-and-postprocessing-our-data"></a><span data-ttu-id="6f666-136">Pré-processamento e pós-processamento de nossos dados</span><span class="sxs-lookup"><span data-stu-id="6f666-136">Preprocessing and postprocessing our data</span></span>

<span data-ttu-id="6f666-137">Essa arquitetura de referência usa filmagens de um orangotango em uma árvore.</span><span class="sxs-lookup"><span data-stu-id="6f666-137">This reference architecture uses video footage of an orangutan in a tree.</span></span> <span data-ttu-id="6f666-138">Você pode fazer o download das filmagens [aqui][source-video].</span><span class="sxs-lookup"><span data-stu-id="6f666-138">You can download the footage from [here][source-video].</span></span>

1. <span data-ttu-id="6f666-139">Use [FFmpeg][ffmpeg] para extrair o arquivo de áudio das filmagens em vídeo para poder inseri-lo de volta posteriormente no vídeo de saída.</span><span class="sxs-lookup"><span data-stu-id="6f666-139">Use [FFmpeg][ffmpeg] to extract the audio file from the video footage, so that the audio file can be stitched back into the output video later.</span></span>
1. <span data-ttu-id="6f666-140">Use o FFmpeg para dividir o vídeo em quadros individuais.</span><span class="sxs-lookup"><span data-stu-id="6f666-140">Use FFmpeg to break the video into individual frames.</span></span> <span data-ttu-id="6f666-141">Os quadros serão processados de forma independente, em paralelo.</span><span class="sxs-lookup"><span data-stu-id="6f666-141">The frames will be processed independently, in parallel.</span></span>
1. <span data-ttu-id="6f666-142">Neste ponto, podemos aplicar a transferência de estilo neural para cada quadro individual em paralelo.</span><span class="sxs-lookup"><span data-stu-id="6f666-142">At this point, we can apply neural style transfer to each individual frame in parallel.</span></span>
1. <span data-ttu-id="6f666-143">Quando cada quadro tiver sido processado, é preciso usar o FFmpeg para juntar os quadros novamente.</span><span class="sxs-lookup"><span data-stu-id="6f666-143">One each frame has been processed, we need to use FFmpeg to restitch the frames back together.</span></span>
1. <span data-ttu-id="6f666-144">E, por último, anexe o arquivo de áudio novamente às filmagens reconstituídas.</span><span class="sxs-lookup"><span data-stu-id="6f666-144">Finally we reattach the audio file to the restitched footage.</span></span>

## <a name="performance-considerations"></a><span data-ttu-id="6f666-145">Considerações sobre o desempenho</span><span class="sxs-lookup"><span data-stu-id="6f666-145">Performance considerations</span></span>

### <a name="gpu-versus-cpu"></a><span data-ttu-id="6f666-146">GPU em vez de CPU</span><span class="sxs-lookup"><span data-stu-id="6f666-146">GPU versus CPU</span></span>

<span data-ttu-id="6f666-147">Para cargas de trabalho de aprendizado profundo, as GPUs geralmente superam bastante as CPUs, chegando até a exigir um cluster considerável de CPUs para obter um desempenho comparável.</span><span class="sxs-lookup"><span data-stu-id="6f666-147">For deep learning workloads, GPUs will generally out-perform CPUs by a considerable amount, to the extent that a sizeable cluster of CPUs is usually needed to get comparable performance.</span></span> <span data-ttu-id="6f666-148">Embora seja uma opção usar apenas CPUs nessa arquitetura, as GPUs fornecerão um perfil de custo/desempenho muito melhor.</span><span class="sxs-lookup"><span data-stu-id="6f666-148">While it's an option to use only CPUs in this architecture, GPUs will provide a much better cost/performance profile.</span></span> <span data-ttu-id="6f666-149">Recomendamos o uso de VMs otimizadas para GPU mais recentes [série NCv3]vm-sizes-gpu.</span><span class="sxs-lookup"><span data-stu-id="6f666-149">We recommend using the latest [NCv3 series]vm-sizes-gpu of GPU optimized VMs.</span></span>

<span data-ttu-id="6f666-150">As GPUs não estão habilitadas por padrão em todas as regiões.</span><span class="sxs-lookup"><span data-stu-id="6f666-150">GPUs are not enabled by default in all regions.</span></span> <span data-ttu-id="6f666-151">Selecione uma região com GPUs habilitadas.</span><span class="sxs-lookup"><span data-stu-id="6f666-151">Make sure to select a region with GPUs enabled.</span></span> <span data-ttu-id="6f666-152">Além disso, as assinaturas têm uma cota padrão de zero núcleos para VMs otimizadas para GPU.</span><span class="sxs-lookup"><span data-stu-id="6f666-152">In addition, subscriptions have a default quota of zero cores for GPU-optimized VMs.</span></span> <span data-ttu-id="6f666-153">Eleve essa cota abrindo uma solicitação de suporte.</span><span class="sxs-lookup"><span data-stu-id="6f666-153">You can raise this quota by opening a support request.</span></span> <span data-ttu-id="6f666-154">Verifique se a sua assinatura tem cota suficiente para executar sua carga de trabalho.</span><span class="sxs-lookup"><span data-stu-id="6f666-154">Make sure that your subscription has enough quota to run your workload.</span></span>

### <a name="parallelizing-across-vms-versus-cores"></a><span data-ttu-id="6f666-155">Paralelização entre VMs em vez de núcleos</span><span class="sxs-lookup"><span data-stu-id="6f666-155">Parallelizing across VMs versus cores</span></span>

<span data-ttu-id="6f666-156">Ao executar um processo de transferência de estilo como um trabalho em lotes, será necessário paralelizar entre VMs os trabalhos executadas principalmente em GPUs.</span><span class="sxs-lookup"><span data-stu-id="6f666-156">When running a style transfer process as a batch job, the jobs that run primarily on GPUs will have to be parallelized across VMs.</span></span> <span data-ttu-id="6f666-157">Há duas abordagens possíveis: você pode criar um cluster maior usando VMs que têm uma única GPU, ou criar um cluster menor usando VMs com várias GPUs.</span><span class="sxs-lookup"><span data-stu-id="6f666-157">Two approaches are possible: You can create a larger cluster using VMs that have a single GPU, or create a smaller cluster using VMs with many GPUs.</span></span>

<span data-ttu-id="6f666-158">Para essa carga de trabalho, essas duas opções terão um desempenho comparável.</span><span class="sxs-lookup"><span data-stu-id="6f666-158">For this workload, these two options will have comparable performance.</span></span> <span data-ttu-id="6f666-159">Usar menos VMs com mais GPUs por VM pode ajudar a reduzir a movimentação de dados.</span><span class="sxs-lookup"><span data-stu-id="6f666-159">Using fewer VMs with more GPUs per VM can help to reduce data movement.</span></span> <span data-ttu-id="6f666-160">No entanto, o volume de dados por trabalho para essa carga de trabalho não é muito grande, portanto, você não observará muita limitação por Armazenamento de Blobs.</span><span class="sxs-lookup"><span data-stu-id="6f666-160">However, the data volume per job for this workload is not very big, so you won't observe much throttling by blob storage.</span></span>

### <a name="mpi-step"></a><span data-ttu-id="6f666-161">Etapa de MPI</span><span class="sxs-lookup"><span data-stu-id="6f666-161">MPI step</span></span>

<span data-ttu-id="6f666-162">Ao criar o pipeline no Azure Machine Learning, uma das etapas usadas para executar a computação paralela é a etapa de MPI.</span><span class="sxs-lookup"><span data-stu-id="6f666-162">When creating the pipeline in Azure Machine Learning, one of the steps used to perform parallel computation is the MPI step.</span></span> <span data-ttu-id="6f666-163">A etapa de MPI ajudará a dividir os dados uniformemente entre os nós disponíveis.</span><span class="sxs-lookup"><span data-stu-id="6f666-163">The MPI step will help split the data evenly across the available nodes.</span></span> <span data-ttu-id="6f666-164">A etapa de MPI não será executada até que todos os nós solicitados estejam prontos.</span><span class="sxs-lookup"><span data-stu-id="6f666-164">The MPI step will not executed until all the requested nodes are ready.</span></span> <span data-ttu-id="6f666-165">Se um nó falhar, ou for esvaziado previamente (se for uma máquina virtual de baixa prioridade), a etapa de MPI precisará ser executada novamente.</span><span class="sxs-lookup"><span data-stu-id="6f666-165">Should one node fail or get pre-empted (if it is a low-priority virtual machine), the MPI step will have to be re-run.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="6f666-166">Considerações de segurança</span><span class="sxs-lookup"><span data-stu-id="6f666-166">Security considerations</span></span>

### <a name="restricting-access-to-azure-blob-storage"></a><span data-ttu-id="6f666-167">Restrição do acesso ao Armazenamento de Blobs do Azure</span><span class="sxs-lookup"><span data-stu-id="6f666-167">Restricting access to Azure blob storage</span></span>

<span data-ttu-id="6f666-168">Nessa arquitetura de referência, o Armazenamento de Blobs do Azure é o componente de armazenamento principal que precisa ser protegido.</span><span class="sxs-lookup"><span data-stu-id="6f666-168">In this reference architecture, Azure blob storage is the main storage component that needs to be protected.</span></span> <span data-ttu-id="6f666-169">A implantação de linha de base mostrada no repositório do GitHub usa chaves da conta de armazenamento para acessar o Armazenamento de Blobs.</span><span class="sxs-lookup"><span data-stu-id="6f666-169">The baseline deployment shown in the GitHub repo uses storage account keys to access the blob storage.</span></span> <span data-ttu-id="6f666-170">Para obter mais controle e proteção, considere o uso de uma SAS (Assinatura de Acesso Compartilhado).</span><span class="sxs-lookup"><span data-stu-id="6f666-170">For further control and protection, consider using a shared access signature (SAS) instead.</span></span> <span data-ttu-id="6f666-171">Isso concede acesso limitado a objetos no armazenamento, sem a necessidade de codificar as chaves da conta ou salvá-las em um texto não criptografado.</span><span class="sxs-lookup"><span data-stu-id="6f666-171">This grants limited access to objects in storage, without needing to hard code the account keys or save them in plaintext.</span></span> <span data-ttu-id="6f666-172">Essa abordagem é especialmente útil porque as chaves da conta são visíveis em texto não criptografado dentro da interface do designer do Aplicativo Lógico.</span><span class="sxs-lookup"><span data-stu-id="6f666-172">This approach is especially useful because account keys are visible in plaintext inside of Logic App's designer interface.</span></span> <span data-ttu-id="6f666-173">Usar uma SAS também ajuda a garantir que a conta de armazenamento tenha uma governança adequada, e que o acesso seja concedido somente para as pessoas certas.</span><span class="sxs-lookup"><span data-stu-id="6f666-173">Using an SAS also helps to ensure that the storage account has proper governance, and that access is granted only to the people intended to have it.</span></span>

<span data-ttu-id="6f666-174">Para cenários com os dados mais confidenciais, verifique se todas as chaves de armazenamento estão protegidas, pois essas chaves concedem acesso completo a todos os dados de entrada e de saída da carga de trabalho.</span><span class="sxs-lookup"><span data-stu-id="6f666-174">For scenarios with more sensitive data, make sure that all of your storage keys are protected, because these keys grant full access to all input and output data from the workload.</span></span>

### <a name="data-encryption-and-data-movement"></a><span data-ttu-id="6f666-175">Criptografia de dados e movimentação de dados</span><span class="sxs-lookup"><span data-stu-id="6f666-175">Data encryption and data movement</span></span>

<span data-ttu-id="6f666-176">Essa arquitetura de referência usa transferência de estilo como um exemplo de um processo de pontuação do lote.</span><span class="sxs-lookup"><span data-stu-id="6f666-176">This reference architecture uses style transfer as an example of a batch scoring process.</span></span> <span data-ttu-id="6f666-177">Para cenários com dados mais confidenciais, os dados no armazenamento devem ser criptografados em repouso.</span><span class="sxs-lookup"><span data-stu-id="6f666-177">For more data-sensitive scenarios, the data in storage should be encrypted at rest.</span></span> <span data-ttu-id="6f666-178">Sempre que os dados são movidos de um local para o próximo, use SSL para proteger a transferência de dados.</span><span class="sxs-lookup"><span data-stu-id="6f666-178">Each time data is moved from one location to the next, use SSL to secure the data transfer.</span></span> <span data-ttu-id="6f666-179">Para saber mais, confira o [Guia de segurança de Armazenamento do Azure][storage-security].</span><span class="sxs-lookup"><span data-stu-id="6f666-179">For more information, see [Azure Storage security guide][storage-security].</span></span>

### <a name="securing-your-computation-in-a-virtual-network"></a><span data-ttu-id="6f666-180">Proteger seu cálculo em uma rede virtual</span><span class="sxs-lookup"><span data-stu-id="6f666-180">Securing your computation in a virtual network</span></span>

<span data-ttu-id="6f666-181">Ao implantar o cluster de computação do Machine Learning, você pode configurar seu cluster para provisionamento dentro de uma sub-rede de uma [rede virtual][virtual-network].</span><span class="sxs-lookup"><span data-stu-id="6f666-181">When deploying your Machine Learning compute cluster, you can configure your cluster to be provisioned inside a subnet of a [virtual network][virtual-network].</span></span> <span data-ttu-id="6f666-182">Isso permite que os nós de computação no cluster se comuniquem com segurança com outras máquinas virtuais.</span><span class="sxs-lookup"><span data-stu-id="6f666-182">This allows the compute nodes in the cluster to communicate securely with other virtual machines.</span></span>

### <a name="protecting-against-malicious-activity"></a><span data-ttu-id="6f666-183">Proteção contra atividades mal-intencionadas</span><span class="sxs-lookup"><span data-stu-id="6f666-183">Protecting against malicious activity</span></span>

<span data-ttu-id="6f666-184">Em cenários com vários usuários, proteja os dados confidenciais contra atividades mal-intencionadas.</span><span class="sxs-lookup"><span data-stu-id="6f666-184">In scenarios where there are multiple users, make sure that sensitive data is protected against malicious activity.</span></span> <span data-ttu-id="6f666-185">Se outros usuários receberem acesso a essa implantação para personalizar os dados de entrada, observe as seguintes precauções e considerações:</span><span class="sxs-lookup"><span data-stu-id="6f666-185">If other users are given access to this deployment to customize the input data, take note of the following precautions and considerations:</span></span>

- <span data-ttu-id="6f666-186">Use o RBAC para limitar o acesso de usuários somente aos recursos necessários.</span><span class="sxs-lookup"><span data-stu-id="6f666-186">Use RBAC to limit users' access to only the resources they need.</span></span>
- <span data-ttu-id="6f666-187">Provisione duas contas de armazenamento separadas.</span><span class="sxs-lookup"><span data-stu-id="6f666-187">Provision two separate storage accounts.</span></span> <span data-ttu-id="6f666-188">Armazene dados de entrada e saída na primeira conta.</span><span class="sxs-lookup"><span data-stu-id="6f666-188">Store input and output data in the first account.</span></span> <span data-ttu-id="6f666-189">Os usuários externos podem obter acesso a essa conta.</span><span class="sxs-lookup"><span data-stu-id="6f666-189">External users can be given access to this account.</span></span> <span data-ttu-id="6f666-190">Armazene scripts executáveis e arquivos de log de saída na outra conta.</span><span class="sxs-lookup"><span data-stu-id="6f666-190">Store executable scripts and output log files in the other account.</span></span> <span data-ttu-id="6f666-191">Os usuários externos não devem ter acesso a essa conta.</span><span class="sxs-lookup"><span data-stu-id="6f666-191">External users should not have access to this account.</span></span> <span data-ttu-id="6f666-192">Isso garantirá que os usuários externos não possam modificar os arquivos executáveis (para injetar código mal-intencionado) e não tenham acesso a arquivos de log, que podem conter informações confidenciais.</span><span class="sxs-lookup"><span data-stu-id="6f666-192">This will ensure that external users cannot modify any executable files (to inject malicious code), and don't have access to logfiles, which could hold sensitive information.</span></span>
- <span data-ttu-id="6f666-193">Os usuários mal-intencionados podem executar DDOS na fila de trabalho ou injetar mensagens suspeitas malformadas na fila de trabalho, fazendo com que o sistema trave ou causando erros de remoção da fila.</span><span class="sxs-lookup"><span data-stu-id="6f666-193">Malicious users can DDOS the job queue or inject malformed poison messages in the job queue, causing the system to lock up or causing dequeuing errors.</span></span>

## <a name="monitoring-and-logging"></a><span data-ttu-id="6f666-194">Monitoramento e registro em log</span><span class="sxs-lookup"><span data-stu-id="6f666-194">Monitoring and logging</span></span>

### <a name="monitoring-batch-jobs"></a><span data-ttu-id="6f666-195">Monitoramento de trabalhos do Lote</span><span class="sxs-lookup"><span data-stu-id="6f666-195">Monitoring Batch jobs</span></span>

<span data-ttu-id="6f666-196">Durante a execução do seu trabalho, é importante monitorar o progresso e certificar-se de que as coisas estão funcionando conforme o esperado.</span><span class="sxs-lookup"><span data-stu-id="6f666-196">While running your job, it's important to monitor the progress and make sure that things are working as expected.</span></span> <span data-ttu-id="6f666-197">No entanto, pode ser um desafio monitorar um cluster de nós ativos.</span><span class="sxs-lookup"><span data-stu-id="6f666-197">However, it can be a challenge to monitor across a cluster of active nodes.</span></span>

<span data-ttu-id="6f666-198">Para ter uma ideia do estado geral do cluster, vá até a folha de Machine Learning do Portal do Azure para inspecionar o estado dos nós no cluster.</span><span class="sxs-lookup"><span data-stu-id="6f666-198">To get a sense of the overall state of the cluster, go to the Machine Learning blade of the Azure Portal to inspect the state of the nodes in the cluster.</span></span> <span data-ttu-id="6f666-199">Se um nó estiver inativo ou se um trabalho falhar, os logs de erro serão salvos no armazenamento de blobs e também poderão ser acessados no portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="6f666-199">If a node is inactive or a job has failed, the error logs are saved to blob storage, and are also accessible in the Azure Portal.</span></span>

<span data-ttu-id="6f666-200">É possível melhorar ainda mais o monitoramento conectando os logs ao Application Insights ou executando processos separados para sondar o estado do cluster e seus trabalhos.</span><span class="sxs-lookup"><span data-stu-id="6f666-200">Monitoring can be further enriched by connecting logs to Application Insights or by running separate processes to poll for the state of the cluster and its jobs.</span></span>

### <a name="logging-with-azure-machine-learning"></a><span data-ttu-id="6f666-201">Registrar em log com o Azure Machine Learning</span><span class="sxs-lookup"><span data-stu-id="6f666-201">Logging with Azure Machine Learning</span></span>

<span data-ttu-id="6f666-202">O Azure Machine Learning registrará automaticamente todos os stdout/stderr para a conta de armazenamento de blob associado.</span><span class="sxs-lookup"><span data-stu-id="6f666-202">Azure Machine Learning will automatically log all stdout/stderr to the associate blob storage account.</span></span> <span data-ttu-id="6f666-203">Salvo indicação em contrário, seu Workspace do Azure Machine Learning provisionará automaticamente uma conta de armazenamento e despejará os logs nela.</span><span class="sxs-lookup"><span data-stu-id="6f666-203">Unless otherwise specified, your Azure Machine Learning Workspace will automatically provision a storage account and dump your logs into it.</span></span> <span data-ttu-id="6f666-204">Também é possível usar uma ferramenta de navegação de armazenamento, como o Gerenciador de Armazenamento, que fornecerá uma experiência muito mais fácil para navegação em arquivos de log.</span><span class="sxs-lookup"><span data-stu-id="6f666-204">You can also use a storage navigation tool such as Storage Explorer which will provide a much easier experience for navigating log files.</span></span>

## <a name="cost-considerations"></a><span data-ttu-id="6f666-205">Considerações de custo</span><span class="sxs-lookup"><span data-stu-id="6f666-205">Cost considerations</span></span>

<span data-ttu-id="6f666-206">Em comparação com os componentes de armazenamento e agendamento, os recursos de computação usados nesta arquitetura de referência dominam em termos de custos.</span><span class="sxs-lookup"><span data-stu-id="6f666-206">Compared to the storage and scheduling components, the compute resources used in this reference architecture by far dominate in terms of costs.</span></span> <span data-ttu-id="6f666-207">Um dos principais desafios é paralelizar com eficiência o trabalho em um cluster de computadores habilitados para GPU.</span><span class="sxs-lookup"><span data-stu-id="6f666-207">One of the main challenges is effectively parallelizing the work across a cluster of GPU-enabled machines.</span></span>

<span data-ttu-id="6f666-208">O tamanho do cluster de Computação do Machine Learning pode aumentar e diminuir automaticamente dependendo dos trabalhos na fila.</span><span class="sxs-lookup"><span data-stu-id="6f666-208">The Machine Learning Compute cluster size can automatically scale up and down depending on the jobs in the queue.</span></span> <span data-ttu-id="6f666-209">Você pode habilitar o dimensionamento automático por meio de programação, definindo os números mínimo e máximo de nós.</span><span class="sxs-lookup"><span data-stu-id="6f666-209">You can enable auto-scale programmatically by setting the minimum and maximum nodes.</span></span>

<span data-ttu-id="6f666-210">Para o trabalho que não exige processamento imediato, configure o dimensionamento automático para que o estado padrão (mínimo) seja um cluster sem nós.</span><span class="sxs-lookup"><span data-stu-id="6f666-210">For work that doesn't require immediate processing, configure auto-scale so the default state (minimum) is a cluster of zero nodes.</span></span> <span data-ttu-id="6f666-211">Com essa configuração, o cluster começa com zero nós e só pode ser escalado verticalmente quando detecta os trabalhos na fila.</span><span class="sxs-lookup"><span data-stu-id="6f666-211">With this configuration, the cluster starts with zero nodes and only scales up when it detects jobs in the queue.</span></span> <span data-ttu-id="6f666-212">Se o processo de pontuação do lote acontecer apenas algumas vezes por dia, essa configuração permitirá uma economia considerável.</span><span class="sxs-lookup"><span data-stu-id="6f666-212">If the batch scoring process only happens a few times a day or less, this setting enables significant cost savings.</span></span>

<span data-ttu-id="6f666-213">Talvez o dimensionamento automático não seja apropriado para trabalhos em lote que aconteçam muito próximos uns dos outros.</span><span class="sxs-lookup"><span data-stu-id="6f666-213">Auto-scaling may not be appropriate for batch jobs that happen too close to each other.</span></span> <span data-ttu-id="6f666-214">O tempo de ativação e desativação de um cluster também incorre em um custo, portanto, se uma carga de trabalho do lote começar apenas alguns minutos após o término do trabalho anterior, talvez seja mais econômico manter o cluster em execução entre os trabalhos.</span><span class="sxs-lookup"><span data-stu-id="6f666-214">The time that it takes for a cluster to spin up and spin down also incur a cost, so if a batch workload begins only a few minutes after the previous job ends, it might be more cost effective to keep the cluster running between jobs.</span></span>

<span data-ttu-id="6f666-215">A Computação do Machine Learning também oferece suporte a máquinas virtuais de baixa prioridade.</span><span class="sxs-lookup"><span data-stu-id="6f666-215">Machine Learning Compute also supports low-priority virtual machines.</span></span> <span data-ttu-id="6f666-216">Isso permite executar a computação em máquinas virtuais com desconto, com a ressalva de que elas podem ser previamente esvaziadas a qualquer momento.</span><span class="sxs-lookup"><span data-stu-id="6f666-216">This allows you to run your computation on discounted virtual machines, with the caveat that they may be pre-empted at any time.</span></span> <span data-ttu-id="6f666-217">As máquinas virtuais de baixa prioridade são ideais para cargas de trabalho de pontuação de lote não críticas.</span><span class="sxs-lookup"><span data-stu-id="6f666-217">Low-priority virtual machines are ideal for non-critical batch scoring workloads.</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="6f666-218">Implantar a solução</span><span class="sxs-lookup"><span data-stu-id="6f666-218">Deploy the solution</span></span>

<span data-ttu-id="6f666-219">Para implantar essa arquitetura de referência, execute as etapas descritas no [repositório do GitHub][deployment].</span><span class="sxs-lookup"><span data-stu-id="6f666-219">To deploy this reference architecture, follow the steps described in the [GitHub repo][deployment].</span></span>

> [!NOTE]
> <span data-ttu-id="6f666-220">Também é possível implantar uma arquitetura de pontuação de lote para modelos de aprendizado profundo usando o Serviço de Kubernetes do Azure.</span><span class="sxs-lookup"><span data-stu-id="6f666-220">You can also deploy a batch scoring architecture for deep learning models using the Azure Kubernetes Service.</span></span> <span data-ttu-id="6f666-221">Execute as etapas descritas neste [Repositório do GitHub][deployment2].</span><span class="sxs-lookup"><span data-stu-id="6f666-221">Follow the steps described in this [Github repo][deployment2].</span></span>

<!-- links -->

[aml-compute]: /azure/machine-learning/service/how-to-set-up-training-targets#amlcompute
[amls]: /azure/machine-learning/service/overview-what-is-azure-ml
[azcopy]: /azure/storage/common/storage-use-azcopy-linux
[blob-storage]: /azure/storage/blobs/storage-blobs-introduction
[container-instances]: /azure/container-instances/
[container-registry]: /azure/container-registry/
[deployment]: https://github.com/Azure/Batch-Scoring-Deep-Learning-Models-With-AML
[deployment2]: https://github.com/Azure/Batch-Scoring-Deep-Learning-Models-With-AKS
[ffmpeg]: https://www.ffmpeg.org/
[image-style-transfer]: https://www.cv-foundation.org/openaccess/content_cvpr_2016/papers/Gatys_Image_Style_Transfer_CVPR_2016_paper.pdf
[logic-apps]: /azure/logic-apps/
[source-video]: https://happypathspublic.blob.core.windows.net/videos/orangutan.mp4
[storage-security]: /azure/storage/common/storage-security-guide
[vm-sizes-gpu]: /azure/virtual-machines/windows/sizes-gpu
[virtual-network]: /azure/machine-learning/service/how-to-enable-virtual-network
