---
title: Pontuação em tempo real dos modelos do Python
titleSuffix: Azure Reference Architectures
description: Essa arquitetura de referência mostra como implantar modelos de Python como serviços Web no Azure para fazer previsões em tempo real.
author: msalvaris
ms.date: 01/28/2019
ms.topic: reference-architecture
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: azcat-ai
ms.openlocfilehash: ba2d9a295e5a231f0ffca9e3cf2d53ace4deddfe
ms.sourcegitcommit: 1ee873aaf40010eb2a38314ac56974bc9e227736
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/28/2019
ms.locfileid: "55141026"
---
# <a name="real-time-scoring-of-python-scikit-learn-and-deep-learning-models-on-azure"></a><span data-ttu-id="2e72d-103">Pontuação em tempo real de Python Scikit-Learn e modelos de aprendizado profundo (deep learning) no Azure</span><span class="sxs-lookup"><span data-stu-id="2e72d-103">Real-time scoring of Python Scikit-Learn and deep learning models on Azure</span></span>

<span data-ttu-id="2e72d-104">Esta arquitetura de referência mostra como implantar modelos em Python como serviços Web para fazer previsões em tempo real usando o Serviço do Azure Machine Learning.</span><span class="sxs-lookup"><span data-stu-id="2e72d-104">This reference architecture shows how to deploy Python models as web services to make real-time predictions using the Azure Machine Learning service.</span></span> <span data-ttu-id="2e72d-105">Dois cenários são abordados: implantar modelos de Python normais e os requisitos específicos de implantação de modelos de aprendizado profundo.</span><span class="sxs-lookup"><span data-stu-id="2e72d-105">Two scenarios are covered: deploying regular Python models, and the specific requirements of deploying deep learning models.</span></span> <span data-ttu-id="2e72d-106">Ambos os cenários usam a arquitetura mostrada.</span><span class="sxs-lookup"><span data-stu-id="2e72d-106">Both scenarios use the architecture shown.</span></span>

<span data-ttu-id="2e72d-107">Duas implementações de referência para essa arquitetura estão disponíveis no GitHub, uma para [modelos normais de Python][github-python] e outro para [modelos de aprendizado profundo][github-dl].</span><span class="sxs-lookup"><span data-stu-id="2e72d-107">Two reference implementations for this architecture are available on GitHub, one for [regular Python models][github-python] and one for [deep learning models][github-dl].</span></span>

![Diagrama da arquitetura para pontuação em tempo real dos modelos em Python no Azure](./_images/python-model-architecture.png)

## <a name="scenarios"></a><span data-ttu-id="2e72d-109">Cenários</span><span class="sxs-lookup"><span data-stu-id="2e72d-109">Scenarios</span></span>

<span data-ttu-id="2e72d-110">As implementações de referência demonstram dois cenários usando essa arquitetura.</span><span class="sxs-lookup"><span data-stu-id="2e72d-110">The reference implementations demonstrate two scenarios using this architecture.</span></span>

<span data-ttu-id="2e72d-111">**Cenário 1: Correspondência de perguntas frequentes**.</span><span class="sxs-lookup"><span data-stu-id="2e72d-111">**Scenario 1: FAQ matching**.</span></span> <span data-ttu-id="2e72d-112">Este cenário mostra como implantar um modelo de correspondência de perguntas frequentes (FAQ) como um serviço Web para fornecer previsões para as perguntas do usuário.</span><span class="sxs-lookup"><span data-stu-id="2e72d-112">This scenario shows how to deploy a frequently asked questions (FAQ) matching model as a web service to provide predictions for user questions.</span></span> <span data-ttu-id="2e72d-113">Para este cenário, os “Dados de entrada” no diagrama da arquitetura referem-se a cadeias de caracteres de texto contendo perguntas do usuário que devem ser associadas a uma lista de perguntas frequentes.</span><span class="sxs-lookup"><span data-stu-id="2e72d-113">For this scenario, "Input Data" in the architecture diagram refers to text strings containing user questions to match with a list of FAQs.</span></span> <span data-ttu-id="2e72d-114">Esse cenário foi desenvolvido para a biblioteca de Machine Learning [scikit-learn][scikit] para Python, mas pode ser generalizada para qualquer cenário que use modelos de Python para fazer previsões em tempo real.</span><span class="sxs-lookup"><span data-stu-id="2e72d-114">This scenario is designed for the [scikit-learn][scikit] machine learning library for Python, but can be generalized to any scenario that uses Python models to make real-time predictions.</span></span>

<span data-ttu-id="2e72d-115">Esse cenário usa um subconjunto dos dados de pergunta do Stack Overflow que inclui perguntas originais marcadas como JavaScript, suas perguntas duplicadas e suas respostas.</span><span class="sxs-lookup"><span data-stu-id="2e72d-115">This scenario uses a subset of Stack Overflow question data that includes original questions tagged as JavaScript, their duplicate questions, and their answers.</span></span> <span data-ttu-id="2e72d-116">Ele treina um pipeline de scikit-learn para prever a probabilidade de correspondência de uma pergunta duplicada com cada uma das perguntas originais.</span><span class="sxs-lookup"><span data-stu-id="2e72d-116">It trains a scikit-learn pipeline to predict the match probability of a duplicate question with each of the original questions.</span></span> <span data-ttu-id="2e72d-117">Essas previsões são feitas em tempo real usando um ponto de extremidade da API REST.</span><span class="sxs-lookup"><span data-stu-id="2e72d-117">These predictions are made in real time using a REST API endpoint.</span></span>

<span data-ttu-id="2e72d-118">O fluxo de aplicativo para essa arquitetura é o seguinte:</span><span class="sxs-lookup"><span data-stu-id="2e72d-118">The application flow for this architecture is as follows:</span></span>

1. <span data-ttu-id="2e72d-119">O modelo treinado é registrado no Registro de modelo de machine learning.</span><span class="sxs-lookup"><span data-stu-id="2e72d-119">The trained model is registered to the Machine Learning model registry.</span></span>
2. <span data-ttu-id="2e72d-120">O Serviço do Machine Learning cria uma imagem do Docker que inclui o modelo e o script de pontuação.</span><span class="sxs-lookup"><span data-stu-id="2e72d-120">The Machine Learning service creates a Docker image that includes the model and scoring script.</span></span>
3. <span data-ttu-id="2e72d-121">O Machine Learning implanta a imagem de pontuação no AKS (Serviço de Kubernetes do Azure) como um serviço Web.</span><span class="sxs-lookup"><span data-stu-id="2e72d-121">Machine Learning deploys the scoring image on Azure Kubernetes Service (AKS) as a web service.</span></span>
4. <span data-ttu-id="2e72d-122">O cliente envia uma solicitação HTTP POST com os dados codificados da pergunta.</span><span class="sxs-lookup"><span data-stu-id="2e72d-122">The client sends an HTTP POST request with the encoded question data.</span></span>
5. <span data-ttu-id="2e72d-123">O serviço Web criado pelo Machine Learning extrai a pergunta da solicitação.</span><span class="sxs-lookup"><span data-stu-id="2e72d-123">The web service created by Machine Learning extracts the question from the request.</span></span>
6. <span data-ttu-id="2e72d-124">A questão é enviada para o modelo de pipeline de Scikit-learn para personalização e pontuação.</span><span class="sxs-lookup"><span data-stu-id="2e72d-124">The question is sent to the Scikit-learn pipeline model for featurization and scoring.</span></span> 
7. <span data-ttu-id="2e72d-125">As perguntas frequentes correspondentes, com suas pontuações, são retornadas ao cliente.</span><span class="sxs-lookup"><span data-stu-id="2e72d-125">The matching FAQ questions with their scores are returned to the client.</span></span>

<span data-ttu-id="2e72d-126">Aqui está uma captura de tela do aplicativo de exemplo que consome os resultados:</span><span class="sxs-lookup"><span data-stu-id="2e72d-126">Here is a screenshot of the example app that consumes the results:</span></span>

![Captura de tela do aplicativo de exemplo](./_images/python-faq-matches.png)

<span data-ttu-id="2e72d-128">**Cenário 2: Classificação de imagens**.</span><span class="sxs-lookup"><span data-stu-id="2e72d-128">**Scenario 2: Image classification**.</span></span> <span data-ttu-id="2e72d-129">Este cenário mostra como implantar um modelo de Rede Neural Convolucional (CNN) como um serviço Web para fornecer previsões em imagens.</span><span class="sxs-lookup"><span data-stu-id="2e72d-129">This scenario shows how to deploy a Convolutional Neural Network (CNN) model as a web service to provide predictions on images.</span></span> <span data-ttu-id="2e72d-130">Para este cenário, os “Dados de entrada” no diagrama da arquitetura referem-se aos arquivos de imagem.</span><span class="sxs-lookup"><span data-stu-id="2e72d-130">For this scenario, "Input Data" in the architecture diagram refers to image files.</span></span> <span data-ttu-id="2e72d-131">CNNs são muito eficazes em pesquisa visual computacional para tarefas como classificação de imagem e detecção de objetos.</span><span class="sxs-lookup"><span data-stu-id="2e72d-131">CNNs are very effective in computer vision for tasks such as image classification and object detection.</span></span> <span data-ttu-id="2e72d-132">Este cenário foi desenvolvido para as estruturas TensorFlow, Keras (com back-end do TensorFlow) e PyTorch.</span><span class="sxs-lookup"><span data-stu-id="2e72d-132">This scenario is designed for the frameworks TensorFlow, Keras (with the TensorFlow back end), and PyTorch.</span></span> <span data-ttu-id="2e72d-133">No entanto, ele pode ser generalizado para qualquer cenário que use modelos de aprendizado profundo para fazer previsões em tempo real.</span><span class="sxs-lookup"><span data-stu-id="2e72d-133">However, it can be generalized to any scenario that uses deep learning models to make real-time predictions.</span></span>

<span data-ttu-id="2e72d-134">Esse cenário usa um modelo ResNet-152 pré-treinado no conjunto de dados ImageNet-1K (1.000 classes) para prever a qual categoria (veja a figura abaixo) uma imagem pertence.</span><span class="sxs-lookup"><span data-stu-id="2e72d-134">This scenario uses a pre-trained ResNet-152 model trained on ImageNet-1K (1,000 classes) dataset to predict which category (see figure below) an image belongs to.</span></span> <span data-ttu-id="2e72d-135">Essas previsões são feitas em tempo real usando um ponto de extremidade da API REST.</span><span class="sxs-lookup"><span data-stu-id="2e72d-135">These predictions are made in real time using a REST API endpoint.</span></span>

![Exemplo de previsões](./_images/python-example-predictions.png)

<span data-ttu-id="2e72d-137">O fluxo do aplicativo para o modelo de aprendizado profundo é o seguinte:</span><span class="sxs-lookup"><span data-stu-id="2e72d-137">The application flow for the deep learning model is as follows:</span></span>

1. <span data-ttu-id="2e72d-138">O modelo de aprendizado profundo é registrado no Registro de modelo de machine learning.</span><span class="sxs-lookup"><span data-stu-id="2e72d-138">The deep learning model is registered to the Machine Learning model registry.</span></span>
2. <span data-ttu-id="2e72d-139">O Serviço do Machine Learning cria uma imagem do Docker que inclui o modelo e o script de pontuação.</span><span class="sxs-lookup"><span data-stu-id="2e72d-139">The Machine Learning service creates a docker image including the model and scoring script.</span></span>
3. <span data-ttu-id="2e72d-140">O Machine Learning implanta a imagem de pontuação no AKS (Serviço de Kubernetes do Azure) como um serviço Web.</span><span class="sxs-lookup"><span data-stu-id="2e72d-140">Machine Learning deploys the scoring image on Azure Kubernetes Service (AKS) as a web service.</span></span>
4. <span data-ttu-id="2e72d-141">O cliente envia uma solicitação HTTP POST com os dados de imagem codificados.</span><span class="sxs-lookup"><span data-stu-id="2e72d-141">The client sends an HTTP POST request with the encoded image data.</span></span>
5. <span data-ttu-id="2e72d-142">O serviço Web criado pelo Machine Learning processa os dados de imagem previamente e os envia ao modelo para pontuação.</span><span class="sxs-lookup"><span data-stu-id="2e72d-142">The web service created by Machine Learning preprocesses the image data and sends it to the model for scoring.</span></span> 
6. <span data-ttu-id="2e72d-143">As categorias previstas, com suas pontuações, são retornadas ao cliente.</span><span class="sxs-lookup"><span data-stu-id="2e72d-143">The predicted categories with their scores are returned to the client.</span></span>

## <a name="architecture"></a><span data-ttu-id="2e72d-144">Arquitetura</span><span class="sxs-lookup"><span data-stu-id="2e72d-144">Architecture</span></span>

<span data-ttu-id="2e72d-145">Essa arquitetura é formada pelos componentes a seguir.</span><span class="sxs-lookup"><span data-stu-id="2e72d-145">This architecture consists of the following components.</span></span>

<span data-ttu-id="2e72d-146">O **[Serviço do Azure Machine Learning][aml]** é um serviço de nuvem usado para treinar, implantar, automatizar e gerenciar modelos de aprendizado de máquina, tudo na ampla escala que a nuvem oferece.</span><span class="sxs-lookup"><span data-stu-id="2e72d-146">**[Azure Machine Learning service][aml]** is a cloud service that is used to train, deploy, automate and manage machine learning models, all at the broad scale that the cloud provides.</span></span> <span data-ttu-id="2e72d-147">Ele é usado nesta arquitetura para gerenciar a implantação de modelos e a autenticação, o roteamento e o balanceamento de carga do serviço Web.</span><span class="sxs-lookup"><span data-stu-id="2e72d-147">It is used in this architecture to manage the deployment of models as well as authentication, routing, and load balancing of the web service.</span></span>

<span data-ttu-id="2e72d-148">**[Máquina virtual][vm]** (VM).</span><span class="sxs-lookup"><span data-stu-id="2e72d-148">**[Virtual machine][vm]** (VM).</span></span> <span data-ttu-id="2e72d-149">A VM é mostrada como um exemplo de um dispositivo &mdash; local ou na nuvem &mdash; que pode enviar uma solicitação HTTP.</span><span class="sxs-lookup"><span data-stu-id="2e72d-149">The VM is shown as an example of a device &mdash; local or in the cloud &mdash; that can send an HTTP request.</span></span>

<span data-ttu-id="2e72d-150">O **[Serviço de Kubernetes do Azure][aks]** (AKS) é usado para implantar o aplicativo em um cluster Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="2e72d-150">**[Azure Kubernetes Service][aks]** (AKS) is used to deploy the application on a Kubernetes cluster.</span></span> <span data-ttu-id="2e72d-151">O AKS simplifica a implantação e as operações do Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="2e72d-151">AKS simplifies the deployment and operations of Kubernetes.</span></span> <span data-ttu-id="2e72d-152">O cluster pode ser configurado usando VMs somente de CPU para modelos de Python normais ou VMs habilitadas para GPU para modelos de aprendizado profundo.</span><span class="sxs-lookup"><span data-stu-id="2e72d-152">The cluster can be configured using CPU-only VMs for regular Python models or GPU-enabled VMs for deep learning models.</span></span>

<span data-ttu-id="2e72d-153">O **[Registro de Contêiner do Azure][acr]** permite o armazenamento de imagens para todos os tipos de implantações de contêiner do Docker, incluindo DC/OS, Docker Swarm e Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="2e72d-153">**[Azure Container Registry][acr]** enables storage of images for all types of Docker container deployments including DC/OS, Docker Swarm and Kubernetes.</span></span> <span data-ttu-id="2e72d-154">As imagens de pontuação são implantadas como contêineres no Serviço de Kubernetes do Azure e usadas para executar o script de pontuação.</span><span class="sxs-lookup"><span data-stu-id="2e72d-154">The scoring images are deployed as containers on Azure Kubernetes Service and used to run the scoring script.</span></span> <span data-ttu-id="2e72d-155">A imagem usada aqui é criada pelo Machine Learning a partir do modelo treinado e do script de pontuação e, em seguida, enviada por push para o Registro de Contêiner do Azure.</span><span class="sxs-lookup"><span data-stu-id="2e72d-155">The image used here is created by Machine Learning from the trained model and scoring script, and then is pushed to the Azure Container Registry.</span></span>

## <a name="performance-considerations"></a><span data-ttu-id="2e72d-156">Considerações sobre o desempenho</span><span class="sxs-lookup"><span data-stu-id="2e72d-156">Performance considerations</span></span>

<span data-ttu-id="2e72d-157">Para arquiteturas de pontuação em tempo real, o desempenho de taxa de transferência se torna uma consideração dominante.</span><span class="sxs-lookup"><span data-stu-id="2e72d-157">For real-time scoring architectures, throughput performance becomes a dominant consideration.</span></span> <span data-ttu-id="2e72d-158">Para modelos de Python normais, é geralmente aceito que CPUs são suficientes para lidar com a carga de trabalho.</span><span class="sxs-lookup"><span data-stu-id="2e72d-158">For regular Python models, it's generally accepted that CPUs are sufficient to handle the workload.</span></span>

<span data-ttu-id="2e72d-159">No entanto, para cargas de trabalho de aprendizado profundo, quando a velocidade é um gargalo, GPUs geralmente fornecem melhor [desempenho][gpus-vs-cpus] em comparação com CPUs.</span><span class="sxs-lookup"><span data-stu-id="2e72d-159">However for deep learning workloads, when speed is a bottleneck, GPUs generally provide better [performance][gpus-vs-cpus] compared to CPUs.</span></span> <span data-ttu-id="2e72d-160">Para corresponder ao desempenho de GPU usando CPUs, geralmente é necessário um cluster com um grande número de CPUs.</span><span class="sxs-lookup"><span data-stu-id="2e72d-160">To match GPU performance using CPUs, a cluster with large number of CPUs is usually needed.</span></span>

<span data-ttu-id="2e72d-161">Você pode usar as CPUs para essa arquitetura em qualquer cenário, mas para modelos de aprendizado profundo, as GPUs fornecem valores de taxa de transferência significativamente superiores em comparação com um cluster de CPU de custo semelhante.</span><span class="sxs-lookup"><span data-stu-id="2e72d-161">You can use CPUs for this architecture in either scenario, but for deep learning models, GPUs provide significantly higher throughput values compared to a CPU cluster of similar cost.</span></span> <span data-ttu-id="2e72d-162">O AKS oferece suporte ao uso de GPUs, que é uma das vantagens de usar AKS para essa arquitetura.</span><span class="sxs-lookup"><span data-stu-id="2e72d-162">AKS supports the use of GPUs, which is one advantage of using AKS for this architecture.</span></span> <span data-ttu-id="2e72d-163">Além disso, as implantações de aprendizado profundo geralmente usam modelos com um grande número de parâmetros.</span><span class="sxs-lookup"><span data-stu-id="2e72d-163">Also, deep learning deployments typically use models with a high number of parameters.</span></span> <span data-ttu-id="2e72d-164">Usar GPUs impede a contenção de recursos entre o modelo e o serviço Web, que é um problema em implantações somente de CPU.</span><span class="sxs-lookup"><span data-stu-id="2e72d-164">Using GPUs prevents contention for resources between the model and the web service, which is an issue in CPU-only deployments.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="2e72d-165">Considerações sobre escalabilidade</span><span class="sxs-lookup"><span data-stu-id="2e72d-165">Scalability considerations</span></span>

<span data-ttu-id="2e72d-166">Para modelos de Python normais, em que o cluster do AKS é provisionado com VMs de CPU, tome cuidado quando [aumentar o número de pods][manually-scale-pods].</span><span class="sxs-lookup"><span data-stu-id="2e72d-166">For regular Python models, where the AKS cluster is provisioned with CPU-only VMs, take care when [scaling out the number of pods][manually-scale-pods].</span></span> <span data-ttu-id="2e72d-167">O objetivo é utilizar totalmente o cluster.</span><span class="sxs-lookup"><span data-stu-id="2e72d-167">The goal is to fully utilize the cluster.</span></span> <span data-ttu-id="2e72d-168">O dimensionamento depende das solicitações de CPU e dos limites definidos para os pods.</span><span class="sxs-lookup"><span data-stu-id="2e72d-168">Scaling depends on the CPU requests and limits defined for the pods.</span></span> <span data-ttu-id="2e72d-169">O Machine Learning por Kubernetes também dá suporte ao [dimensionamento automático de pod] [ autoscale-pods] com base na utilização da CPU ou em outras métricas.</span><span class="sxs-lookup"><span data-stu-id="2e72d-169">Machine Learning through Kubernetes also supports [pod autoscaling][autoscale-pods] based on CPU utilization or other metrics.</span></span> <span data-ttu-id="2e72d-170">O [dimensionador automático de cluster][autoscaler] (em versão prévia) pode dimensionar nós de agente com base em pods pendentes.</span><span class="sxs-lookup"><span data-stu-id="2e72d-170">The [cluster autoscaler][autoscaler] (in preview) can scale agent nodes based on the pending pods.</span></span>

<span data-ttu-id="2e72d-171">Para cenários de aprendizado profundo, usando as máquinas virtuais habilitadas para GPU, os limites de recursos nos pods fazem com que uma GPU seja atribuída a um pod.</span><span class="sxs-lookup"><span data-stu-id="2e72d-171">For deep learning scenarios, using GPU-enabled VMs, resource limits on pods are such that one GPU is assigned to one pod.</span></span> <span data-ttu-id="2e72d-172">Dependendo do tipo de VM usado, você deve [dimensionar os nós do cluster][scale-cluster] para atender à demanda para o serviço.</span><span class="sxs-lookup"><span data-stu-id="2e72d-172">Depending on the type of VM used, you must [scale the nodes of the cluster][scale-cluster] to meet the demand for the service.</span></span> <span data-ttu-id="2e72d-173">Você pode fazer isso facilmente usando a CLI do Azure e o kubectl.</span><span class="sxs-lookup"><span data-stu-id="2e72d-173">You can do this easily using the Azure CLI and kubectl.</span></span>

## <a name="monitoring-and-logging-considerations"></a><span data-ttu-id="2e72d-174">Considerações de monitoramento e registro em log</span><span class="sxs-lookup"><span data-stu-id="2e72d-174">Monitoring and logging considerations</span></span>

### <a name="aks-monitoring"></a><span data-ttu-id="2e72d-175">Monitoramento do AKS</span><span class="sxs-lookup"><span data-stu-id="2e72d-175">AKS monitoring</span></span>

<span data-ttu-id="2e72d-176">Para visibilidade sobre o desempenho do AKS, use o recurso de [Azure Monitor para contêineres][monitor-containers].</span><span class="sxs-lookup"><span data-stu-id="2e72d-176">For visibility into AKS performance, use the [Azure Monitor for containers][monitor-containers] feature.</span></span> <span data-ttu-id="2e72d-177">Ele coleta métricas de processador e memória de controladores, nós e contêineres disponíveis no Kubernetes por meio da API Métricas.</span><span class="sxs-lookup"><span data-stu-id="2e72d-177">It collects memory and processor metrics from controllers, nodes, and containers that are available in Kubernetes through the Metrics API.</span></span>

<span data-ttu-id="2e72d-178">Ao implantar seu aplicativo, monitore o cluster do AKS para verificar se ele está funcionando conforme o esperado, se todos os nós estão operacionais e se todos os pods estão em execução.</span><span class="sxs-lookup"><span data-stu-id="2e72d-178">While deploying your application, monitor the AKS cluster to make sure it's working as expected, all the nodes are operational, and all pods are running.</span></span> <span data-ttu-id="2e72d-179">Embora você possa usar a ferramenta de linha de comando [kubectl][kubectl] para recuperar o status de pod, o Kubernetes também inclui um painel Web para o monitoramento básico do status do cluster e gerenciamento.</span><span class="sxs-lookup"><span data-stu-id="2e72d-179">Although you can use the [kubectl][kubectl] command-line tool to retrieve pod status, Kubernetes also includes a web dashboard for basic monitoring of the cluster status and management.</span></span>

![Captura de tela do painel do Kubernetes](./_images/python-kubernetes-dashboard.png)

<span data-ttu-id="2e72d-181">Para ver o estado geral do cluster e dos nós, vá até a seção **Nós** no painel do Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="2e72d-181">To see the overall state of the cluster and nodes, go to the **Nodes** section of the Kubernetes dashboard.</span></span> <span data-ttu-id="2e72d-182">Se um nó está inativo ou falhou, você pode exibir os logs de erros nessa página.</span><span class="sxs-lookup"><span data-stu-id="2e72d-182">If a node is inactive or has failed, you can display the error logs from that page.</span></span> <span data-ttu-id="2e72d-183">Da mesma forma, vá até as seções **Pods** e **Implantações** para obter informações sobre o número de pods e o status da implantação.</span><span class="sxs-lookup"><span data-stu-id="2e72d-183">Similarly, go to the **Pods** and **Deployments** sections for information about the number of pods and status of your deployment.</span></span>

### <a name="aks-logs"></a><span data-ttu-id="2e72d-184">Logs do AKS</span><span class="sxs-lookup"><span data-stu-id="2e72d-184">AKS logs</span></span>

<span data-ttu-id="2e72d-185">O AKS registra automaticamente todos os stdout/stderr para os logs dos pods no cluster.</span><span class="sxs-lookup"><span data-stu-id="2e72d-185">AKS automatically logs all stdout/stderr to the logs of the pods in the cluster.</span></span> <span data-ttu-id="2e72d-186">Use kubectl para vê-los e ver também os eventos de nível de nó e logs.</span><span class="sxs-lookup"><span data-stu-id="2e72d-186">Use kubectl to see these and also node-level events and logs.</span></span> <span data-ttu-id="2e72d-187">Para obter detalhes, confira as etapas de implantação.</span><span class="sxs-lookup"><span data-stu-id="2e72d-187">For details, see the deployment steps.</span></span>

<span data-ttu-id="2e72d-188">Use o [Azure Monitor para contêineres][monitor-containers] para coletar métricas e logs por meio de uma versão em contêineres do agente do Log Analytics para o Linux, que é armazenado em seu workspace do Log Analytics.</span><span class="sxs-lookup"><span data-stu-id="2e72d-188">Use [Azure Monitor for containers][monitor-containers] to collect metrics and logs through a containerized version of the Log Analytics agent for Linux, which is stored in your Log Analytics workspace.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="2e72d-189">Considerações de segurança</span><span class="sxs-lookup"><span data-stu-id="2e72d-189">Security considerations</span></span>

<span data-ttu-id="2e72d-190">Use a [Central de Segurança do Azure][security-center] para obter uma exibição central do estado da segurança de seus recursos do Azure.</span><span class="sxs-lookup"><span data-stu-id="2e72d-190">Use [Azure Security Center][security-center] to get a central view of the security state of your Azure resources.</span></span> <span data-ttu-id="2e72d-191">A Central de Segurança monitora problemas de segurança potenciais e fornece uma visão abrangente da integridade de segurança de sua implantação, mas ela não monitora os nós do agente do AKS.</span><span class="sxs-lookup"><span data-stu-id="2e72d-191">Security Center monitors potential security issues and provides a comprehensive picture of the security health of your deployment, although it doesn't monitor AKS agent nodes.</span></span> <span data-ttu-id="2e72d-192">A Central de Segurança é configurada por assinatura do Azure.</span><span class="sxs-lookup"><span data-stu-id="2e72d-192">Security Center is configured per Azure subscription.</span></span> <span data-ttu-id="2e72d-193">Habilite a coleta de dados de segurança conforme descrito em [Integrar a assinatura do Azure à Central de Segurança Standard][get-started].</span><span class="sxs-lookup"><span data-stu-id="2e72d-193">Enable security data collection as described in [Onboard your Azure subscription to Security Center Standard][get-started].</span></span> <span data-ttu-id="2e72d-194">Depois que a coleta de dados for habilitada, a Central de Segurança examinará automaticamente todas as VMs criadas nessa assinatura.</span><span class="sxs-lookup"><span data-stu-id="2e72d-194">When data collection is enabled, Security Center automatically scans any VMs created under that subscription.</span></span>

<span data-ttu-id="2e72d-195">**Operações**.</span><span class="sxs-lookup"><span data-stu-id="2e72d-195">**Operations**.</span></span> <span data-ttu-id="2e72d-196">Para se conectar a um cluster AKS usando o token de autenticação do Azure Active Directory (Azure AD), configure o AKS para usar o Azure AD para [autenticação do usuário][aad-auth].</span><span class="sxs-lookup"><span data-stu-id="2e72d-196">To sign in to an AKS cluster using your Azure Active Directory (Azure AD) authentication token, configure AKS to use Azure AD for [user authentication][aad-auth].</span></span> <span data-ttu-id="2e72d-197">Os administradores de cluster também podem configurar o controle de acesso baseado em função (RBAC) do Kubernetes com base na identidade de um usuário ou associação no grupo de diretórios.</span><span class="sxs-lookup"><span data-stu-id="2e72d-197">Cluster administrators can also configure Kubernetes role-based access control (RBAC) based on a user's identity or directory group membership.</span></span>

<span data-ttu-id="2e72d-198">Use o [RBAC][rbac] para controlar o acesso aos recursos do Azure que você implanta.</span><span class="sxs-lookup"><span data-stu-id="2e72d-198">Use [RBAC][rbac] to control access to the Azure resources that you deploy.</span></span> <span data-ttu-id="2e72d-199">O RBAC permite atribuir funções de autorização aos membros de sua equipe de DevOps.</span><span class="sxs-lookup"><span data-stu-id="2e72d-199">RBAC lets you assign authorization roles to members of your DevOps team.</span></span> <span data-ttu-id="2e72d-200">Um usuário pode ser atribuído a várias funções, e você pode criar funções personalizadas para [permissões] ainda mais refinadas.</span><span class="sxs-lookup"><span data-stu-id="2e72d-200">A user can be assigned to multiple roles, and you can create custom roles for even more fine-grained [permissions].</span></span>

<span data-ttu-id="2e72d-201">**HTTPS**.</span><span class="sxs-lookup"><span data-stu-id="2e72d-201">**HTTPS**.</span></span> <span data-ttu-id="2e72d-202">Como prática recomendada de segurança, o aplicativo deve impor HTTPS e redirecionar as solicitações HTTP.</span><span class="sxs-lookup"><span data-stu-id="2e72d-202">As a security best practice, the application should enforce HTTPS and redirect HTTP requests.</span></span> <span data-ttu-id="2e72d-203">Use um [controlador de entrada][ingress-controller] para implantar um proxy reverso que termina o SSL e redireciona as solicitações HTTP.</span><span class="sxs-lookup"><span data-stu-id="2e72d-203">Use an [ingress controller][ingress-controller] to deploy a reverse proxy that terminates SSL and redirects HTTP requests.</span></span> <span data-ttu-id="2e72d-204">Para obter mais informações, confira [Criar um controlador de ingresso HTTPS no Serviço de Kubernetes do Azure (AKS)][https-ingress].</span><span class="sxs-lookup"><span data-stu-id="2e72d-204">For more information, see [Create an HTTPS ingress controller on Azure Kubernetes Service (AKS)][https-ingress].</span></span>

<span data-ttu-id="2e72d-205">**Autenticação**.</span><span class="sxs-lookup"><span data-stu-id="2e72d-205">**Authentication**.</span></span> <span data-ttu-id="2e72d-206">Essa solução não restringe o acesso aos pontos de extremidade.</span><span class="sxs-lookup"><span data-stu-id="2e72d-206">This solution doesn't restrict access to the endpoints.</span></span> <span data-ttu-id="2e72d-207">Para implantar a arquitetura em uma configuração empresarial, proteja os pontos de extremidade por meio de chaves de API e adicione alguma forma de autenticação do usuário para o aplicativo cliente.</span><span class="sxs-lookup"><span data-stu-id="2e72d-207">To deploy the architecture in an enterprise setting, secure the endpoints through API keys and add some form of user authentication to the client application.</span></span>

<span data-ttu-id="2e72d-208">**Registro de contêiner**.</span><span class="sxs-lookup"><span data-stu-id="2e72d-208">**Container registry**.</span></span> <span data-ttu-id="2e72d-209">Essa solução usa o Registro de Contêiner do Azure para armazenar a imagem do Docker.</span><span class="sxs-lookup"><span data-stu-id="2e72d-209">This solution uses Azure Container Registry to store the Docker image.</span></span> <span data-ttu-id="2e72d-210">O código do qual o aplicativo depende, bem como o modelo, estão contidos dentro dessa imagem.</span><span class="sxs-lookup"><span data-stu-id="2e72d-210">The code that the application depends on, and the model, are contained within this image.</span></span> <span data-ttu-id="2e72d-211">Aplicativos empresariais devem usar um registro privado para ajudar na proteção contra a execução de código mal-intencionado e para ajudar a impedir que as informações dentro do contêiner sejam comprometidas.</span><span class="sxs-lookup"><span data-stu-id="2e72d-211">Enterprise applications should use a private registry to help guard against running malicious code and to help keep the information inside the container from being compromised.</span></span>

<span data-ttu-id="2e72d-212">**Proteção contra DDoS**.</span><span class="sxs-lookup"><span data-stu-id="2e72d-212">**DDoS protection**.</span></span> <span data-ttu-id="2e72d-213">Considere habilitar a [Proteção contra DDoS Standard][ddos].</span><span class="sxs-lookup"><span data-stu-id="2e72d-213">Consider enabling [DDoS Protection Standard][ddos].</span></span> <span data-ttu-id="2e72d-214">Embora a proteção contra DDoS básica seja habilitada como parte da plataforma Azure, a Proteção contra DDoS Standard fornece funcionalidades de mitigação ajustadas especificamente para os recursos da rede virtual do Azure.</span><span class="sxs-lookup"><span data-stu-id="2e72d-214">Although basic DDoS protection is enabled as part of the Azure platform, DDoS Protection Standard provides mitigation capabilities that are tuned specifically to Azure virtual network resources.</span></span>

<span data-ttu-id="2e72d-215">**Registro em log**.</span><span class="sxs-lookup"><span data-stu-id="2e72d-215">**Logging**.</span></span> <span data-ttu-id="2e72d-216">Use as práticas recomendadas antes de armazenar dados de log, como remover as senhas de usuário e outras informações que podem ser usadas para cometer fraudes de segurança.</span><span class="sxs-lookup"><span data-stu-id="2e72d-216">Use best practices before storing log data, such as scrubbing user passwords and other information that could be used to commit security fraud.</span></span>

## <a name="deployment"></a><span data-ttu-id="2e72d-217">Implantação</span><span class="sxs-lookup"><span data-stu-id="2e72d-217">Deployment</span></span>

<span data-ttu-id="2e72d-218">Para implantar essa arquitetura de referência, execute as etapas descritas no repositório do GitHub:</span><span class="sxs-lookup"><span data-stu-id="2e72d-218">To deploy this reference architecture, follow the steps described in the GitHub repos:</span></span>

- <span data-ttu-id="2e72d-219">[Modelos de Python normais][github-python]</span><span class="sxs-lookup"><span data-stu-id="2e72d-219">[Regular Python models][github-python]</span></span>
- <span data-ttu-id="2e72d-220">[Modelos de aprendizado profundo][github-dl]</span><span class="sxs-lookup"><span data-stu-id="2e72d-220">[Deep learning models][github-dl]</span></span>

<!-- links -->

[aad-auth]: /azure/aks/aad-integration
[acr]: /azure/container-registry/
[something]: https://kubernetes.io/docs/reference/access-authn-authz/authentication/
[aks]: /azure/aks/intro-kubernetes
[autoscaler]: /azure/aks/autoscaler
[autoscale-pods]: /azure/aks/tutorial-kubernetes-scale#autoscale-pods
[azcopy]: /azure/storage/common/storage-use-azcopy-linux
[ddos]: /azure/virtual-network/ddos-protection-overview
[get-started]: /azure/security-center/security-center-get-started
[github-python]: https://github.com/Microsoft/MLAKSDeployAML
[github-dl]: https://github.com/Microsoft/AKSDeploymentTutorial_AML
[gpus-vs-cpus]: https://azure.microsoft.com/en-us/blog/gpus-vs-cpus-for-deployment-of-deep-learning-models/
[https-ingress]: /azure/aks/ingress-tls
[ingress-controller]: https://kubernetes.io/docs/concepts/services-networking/ingress/
[kubectl]: https://kubernetes.io/docs/tasks/tools/install-kubectl/
[aml]: /azure/machine-learning/service/overview-what-is-azure-ml
[manually-scale-pods]: /azure/aks/tutorial-kubernetes-scale#manually-scale-pods
[monitor-containers]: /azure/monitoring/monitoring-container-insights-overview
[permissões]: /azure/aks/concepts-identity
[permissions]: /azure/aks/concepts-identity
[rbac]: /azure/active-directory/role-based-access-control-what-is
[scale-cluster]: /azure/aks/scale-cluster
[scikit]: https://pypi.org/project/scikit-learn/
[security-center]: /azure/security-center/security-center-intro
[vm]: /azure/virtual-machines/
