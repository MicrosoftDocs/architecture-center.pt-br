---
title: Pontuação em tempo real de Python Scikit-Learn e modelos de aprendizado profundo (deep learning) no Azure
description: Essa arquitetura de referência mostra como implantar modelos de Python como serviços Web no Azure para fazer previsões em tempo real.
author: njray
ms.date: 11/09/2018
ms.author: njray
ms.openlocfilehash: 860eb83f248c2a9f2a96065c6c4cdd02715e7ce1
ms.sourcegitcommit: cc234a522b7fc35af3bcacdc044c2e2b529e54ed
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/09/2018
ms.locfileid: "51347741"
---
# <a name="real-time-scoring-of-python-scikit-learn-and-deep-learning-models-on-azure"></a><span data-ttu-id="f1832-103">Pontuação em tempo real de Python Scikit-Learn e modelos de aprendizado profundo (deep learning) no Azure</span><span class="sxs-lookup"><span data-stu-id="f1832-103">Real-time scoring of Python Scikit-Learn and Deep Learning Models on Azure</span></span>

<span data-ttu-id="f1832-104">Essa arquitetura de referência mostra como implantar modelos de Python como serviços Web para fazer previsões em tempo real.</span><span class="sxs-lookup"><span data-stu-id="f1832-104">This reference architecture shows how to deploy Python models as web services to make real-time predictions.</span></span> <span data-ttu-id="f1832-105">Dois cenários são abordados: implantar modelos de Python normais e os requisitos específicos de implantação de modelos de aprendizado profundo.</span><span class="sxs-lookup"><span data-stu-id="f1832-105">Two scenarios are covered: deploying regular Python models, and the specific requirements of deploying deep learning models.</span></span> <span data-ttu-id="f1832-106">Ambos os cenários usam a arquitetura mostrada.</span><span class="sxs-lookup"><span data-stu-id="f1832-106">Both scenarios use the architecture shown.</span></span>

<span data-ttu-id="f1832-107">Duas implementações de referência para essa arquitetura estão disponíveis no GitHub, uma para [modelos normais de Python][github-python] e outro para [modelos de aprendizado profundo][github-dl].</span><span class="sxs-lookup"><span data-stu-id="f1832-107">Two reference implementations for this architecture are available on GitHub, one for [regular Python models][github-python] and one for [deep learning models][github-dl].</span></span>

![](./_images/python-model-architecture.png)

## <a name="scenarios"></a><span data-ttu-id="f1832-108">Cenários</span><span class="sxs-lookup"><span data-stu-id="f1832-108">Scenarios</span></span>

<span data-ttu-id="f1832-109">As implementações de referência demonstram dois cenários usando essa arquitetura.</span><span class="sxs-lookup"><span data-stu-id="f1832-109">The reference implementations demonstrate two scenarios using this architecture.</span></span>

<span data-ttu-id="f1832-110">**Cenário 1: Correspondência de perguntas frequentes**.</span><span class="sxs-lookup"><span data-stu-id="f1832-110">**Scenario 1: FAQ matching**.</span></span> <span data-ttu-id="f1832-111">Este cenário mostra como implantar um modelo de correspondência de perguntas frequentes (FAQ) como um serviço Web para fornecer previsões para as perguntas do usuário.</span><span class="sxs-lookup"><span data-stu-id="f1832-111">This scenario shows how to deploy a frequently asked questions (FAQ) matching model as a web service to provide predictions for user questions.</span></span> <span data-ttu-id="f1832-112">Para este cenário, os “Dados de entrada” no diagrama da arquitetura referem-se a cadeias de caracteres de texto contendo perguntas do usuário que devem ser associadas a uma lista de perguntas frequentes.</span><span class="sxs-lookup"><span data-stu-id="f1832-112">For this scenario, "Input Data" in the architecture diagram refers to text strings containing user questions to match with a list of FAQs.</span></span> <span data-ttu-id="f1832-113">Esse cenário foi desenvolvido para a biblioteca de Machine Learning [scikit-learn][scikit] para Python, mas pode ser generalizada para qualquer cenário que use modelos de Python para fazer previsões em tempo real.</span><span class="sxs-lookup"><span data-stu-id="f1832-113">This scenario is designed for the [scikit-learn][scikit] machine learning library for Python, but can be generalized to any scenario that uses Python models to make real-time predictions.</span></span>

<span data-ttu-id="f1832-114">Esse cenário usa um subconjunto dos dados de pergunta do Stack Overflow que inclui perguntas originais marcadas como JavaScript, suas perguntas duplicadas e suas respostas.</span><span class="sxs-lookup"><span data-stu-id="f1832-114">This scenario uses a subset of Stack Overflow question data that includes original questions tagged as JavaScript, their duplicate questions, and their answers.</span></span> <span data-ttu-id="f1832-115">Ele treina um pipeline de scikit-learn para prever a probabilidade de correspondência de uma pergunta duplicada com cada uma das perguntas originais.</span><span class="sxs-lookup"><span data-stu-id="f1832-115">It trains a scikit-learn pipeline to predict the match probability of a duplicate question with each of the original questions.</span></span> <span data-ttu-id="f1832-116">Essas previsões são feitas em tempo real usando um ponto de extremidade de API REST.</span><span class="sxs-lookup"><span data-stu-id="f1832-116">These predictions are made in real time using a REST API  endpoint.</span></span>

<span data-ttu-id="f1832-117">O fluxo de aplicativo para essa arquitetura é o seguinte:</span><span class="sxs-lookup"><span data-stu-id="f1832-117">The application flow for this architecture is as follows:</span></span>

1.  <span data-ttu-id="f1832-118">O cliente envia uma solicitação HTTP POST com os dados codificados da pergunta.</span><span class="sxs-lookup"><span data-stu-id="f1832-118">The client sends an HTTP POST request with the encoded question data.</span></span>

2.  <span data-ttu-id="f1832-119">O aplicativo Flask extrai a pergunta da solicitação.</span><span class="sxs-lookup"><span data-stu-id="f1832-119">The Flask app extracts the question from the request.</span></span>

3.  <span data-ttu-id="f1832-120">A questão é enviada para o modelo de pipeline de scikit-learn para personalização e pontuação.</span><span class="sxs-lookup"><span data-stu-id="f1832-120">The question is sent to the scikit-learn pipeline model for featurization and scoring.</span></span>

4.  <span data-ttu-id="f1832-121">As perguntas mais frequentes correspondentes às suas pontuações são redirecionadas para um objeto JSON e retornadas ao cliente.</span><span class="sxs-lookup"><span data-stu-id="f1832-121">The matching FAQ questions with their scores are piped into a JSON object and returned to the client.</span></span>

<span data-ttu-id="f1832-122">Aqui está uma captura de tela do aplicativo de exemplo que consome os resultados:</span><span class="sxs-lookup"><span data-stu-id="f1832-122">Here is a screenshot of the example app that consumes the results:</span></span>

![](./_images/python-faq-matches.png)

<span data-ttu-id="f1832-123">**Cenário 2: Classificação de imagens.**</span><span class="sxs-lookup"><span data-stu-id="f1832-123">**Scenario 2: Image classification.**</span></span> <span data-ttu-id="f1832-124">Este cenário mostra como implantar um modelo de Rede Neural Convolucional (CNN) como um serviço Web para fornecer previsões em imagens.</span><span class="sxs-lookup"><span data-stu-id="f1832-124">This scenario shows how to deploy a Convolutional Neural Network (CNN) model as a web service to provide predictions on images.</span></span> <span data-ttu-id="f1832-125">Para este cenário, os “Dados de entrada” no diagrama da arquitetura referem-se aos arquivos de imagem.</span><span class="sxs-lookup"><span data-stu-id="f1832-125">For this scenario, "Input Data" in the architecture diagram refers to image files.</span></span> <span data-ttu-id="f1832-126">CNNs são muito eficazes em pesquisa visual computacional para tarefas como classificação de imagem e detecção de objetos.</span><span class="sxs-lookup"><span data-stu-id="f1832-126">CNNs are very effective in computer vision for tasks such as image classification and object detection.</span></span> <span data-ttu-id="f1832-127">Este cenário foi desenvolvido para as estruturas TensorFlow, Keras (com back-end do TensorFlow) e PyTorch.</span><span class="sxs-lookup"><span data-stu-id="f1832-127">This scenario is designed for the frameworks TensorFlow, Keras (with the TensorFlow back end), and PyTorch.</span></span> <span data-ttu-id="f1832-128">No entanto, ele pode ser generalizado para qualquer cenário que use modelos de aprendizado profundo para fazer previsões em tempo real.</span><span class="sxs-lookup"><span data-stu-id="f1832-128">However, it can be generalized to any scenario that uses deep learning models to make real-time predictions.</span></span>

<span data-ttu-id="f1832-129">Esse cenário usa um modelo ResNet-152 pré-treinado no conjunto de dados ImageNet-1K (1.000 classes) para prever a qual categoria (veja a figura abaixo) uma imagem pertence.</span><span class="sxs-lookup"><span data-stu-id="f1832-129">This scenario uses a pre-trained ResNet-152 model trained on ImageNet-1K (1,000 classes) dataset to predict which category (see figure below) an image belongs to.</span></span> <span data-ttu-id="f1832-130">Essas previsões são feitas em tempo real usando um ponto de extremidade da API REST.</span><span class="sxs-lookup"><span data-stu-id="f1832-130">These predictions are made in real time using a REST API endpoint.</span></span>

![](./_images/python-example-predictions.png)

<span data-ttu-id="f1832-131">O fluxo do aplicativo para o modelo de aprendizado profundo é o seguinte:</span><span class="sxs-lookup"><span data-stu-id="f1832-131">The application flow for the deep learning model is as follows:</span></span>

1.  <span data-ttu-id="f1832-132">O cliente envia uma solicitação HTTP POST com os dados de imagem codificados.</span><span class="sxs-lookup"><span data-stu-id="f1832-132">The client sends an HTTP POST request with the encoded image data.</span></span>

2.  <span data-ttu-id="f1832-133">O aplicativo Flask extrai a imagem da solicitação.</span><span class="sxs-lookup"><span data-stu-id="f1832-133">The Flask app extracts the image from the request.</span></span>

3.  <span data-ttu-id="f1832-134">A imagem é pré-processada e enviada para o modelo de pontuação.</span><span class="sxs-lookup"><span data-stu-id="f1832-134">The image is preprocessed and sent to the model for scoring.</span></span>

4.  <span data-ttu-id="f1832-135">O resultado da pontuação é redirecionado para um objeto JSON e retornado ao cliente.</span><span class="sxs-lookup"><span data-stu-id="f1832-135">The scoring result is piped into a JSON object and returned to the client.</span></span>

## <a name="architecture"></a><span data-ttu-id="f1832-136">Arquitetura</span><span class="sxs-lookup"><span data-stu-id="f1832-136">Architecture</span></span>

<span data-ttu-id="f1832-137">Essa arquitetura é formada pelos componentes a seguir.</span><span class="sxs-lookup"><span data-stu-id="f1832-137">This architecture consists of the following components.</span></span>

<span data-ttu-id="f1832-138">**[Máquina virtual][vm]** (VM).</span><span class="sxs-lookup"><span data-stu-id="f1832-138">**[Virtual machine][vm]** (VM).</span></span> <span data-ttu-id="f1832-139">A VM é mostrada como um exemplo de um dispositivo &mdash; local ou na nuvem &mdash; que pode enviar uma solicitação HTTP.</span><span class="sxs-lookup"><span data-stu-id="f1832-139">The VM is shown as an example of a device &mdash; local or in the cloud &mdash; that can send an HTTP request.</span></span>

<span data-ttu-id="f1832-140">O **[Serviço de Kubernetes do Azure][aks]** (AKS) é usado para implantar o aplicativo em um cluster Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="f1832-140">**[Azure Kubernetes Service][aks]** (AKS) is used to deploy the application on a Kubernetes cluster.</span></span> <span data-ttu-id="f1832-141">O AKS simplifica a implantação e as operações do Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="f1832-141">AKS simplifies the deployment and operations of Kubernetes.</span></span> <span data-ttu-id="f1832-142">O cluster pode ser configurado usando VMs somente de CPU para modelos de Python normais ou VMs habilitadas para GPU para modelos de aprendizado profundo.</span><span class="sxs-lookup"><span data-stu-id="f1832-142">The cluster can be configured using CPU-only VMs for regular Python models or GPU-enabled VMs for deep learning models.</span></span>

<span data-ttu-id="f1832-143">**[Balanceador de carga][lb]**.</span><span class="sxs-lookup"><span data-stu-id="f1832-143">**[Load balancer][lb]**.</span></span> <span data-ttu-id="f1832-144">Um balanceador de carga provisionado pelo AKS é usado para expor o serviço externamente.</span><span class="sxs-lookup"><span data-stu-id="f1832-144">A load balancer, provisioned by AKS, is used to expose the service externally.</span></span> <span data-ttu-id="f1832-145">O tráfego do balanceador de carga é direcionado para os pods de back-end.</span><span class="sxs-lookup"><span data-stu-id="f1832-145">Traffic from the load balancer is directed to the back-end pods.</span></span>

<span data-ttu-id="f1832-146">O **[Docker Hub][docker]** é usado para armazenar a imagem do Docker que é implantada no cluster Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="f1832-146">**[Docker Hub][docker]** is used to store the Docker image that is deployed on Kubernetes cluster.</span></span> <span data-ttu-id="f1832-147">O Docker Hub foi escolhido para essa arquitetura por ser fácil de usar e ser o repositório de imagens padrão para usuários do Docker.</span><span class="sxs-lookup"><span data-stu-id="f1832-147">Docker Hub was chosen for this architecture because it's easy to use and is the default image repository for Docker users.</span></span> <span data-ttu-id="f1832-148">O [Registro de Contêiner do Azure][acr] também pode ser usado para essa arquitetura.</span><span class="sxs-lookup"><span data-stu-id="f1832-148">[Azure Container Registry][acr] can also be used for this architecture.</span></span>

## <a name="performance-considerations"></a><span data-ttu-id="f1832-149">Considerações sobre o desempenho</span><span class="sxs-lookup"><span data-stu-id="f1832-149">Performance considerations</span></span>

<span data-ttu-id="f1832-150">Para arquiteturas de pontuação em tempo real, o desempenho de taxa de transferência se torna uma consideração dominante.</span><span class="sxs-lookup"><span data-stu-id="f1832-150">For real-time scoring architectures, throughput performance becomes a dominant consideration.</span></span> <span data-ttu-id="f1832-151">Para modelos de Python normais, é geralmente aceito que CPUs são suficientes para lidar com a carga de trabalho.</span><span class="sxs-lookup"><span data-stu-id="f1832-151">For regular Python models, it's generally accepted that CPUs are sufficient to handle the workload.</span></span> 

<span data-ttu-id="f1832-152">No entanto, para cargas de trabalho de aprendizado profundo, quando a velocidade é um gargalo, GPUs geralmente fornecem melhor [desempenho][gpus-vs-cpus] em comparação com CPUs.</span><span class="sxs-lookup"><span data-stu-id="f1832-152">However for deep learning workloads, when speed is a bottleneck, GPUs generally provide better [performance][gpus-vs-cpus] compared to CPUs.</span></span> <span data-ttu-id="f1832-153">Para corresponder ao desempenho de GPU usando CPUs, geralmente é necessário um cluster com um grande número de CPUs.</span><span class="sxs-lookup"><span data-stu-id="f1832-153">To match GPU performance using CPUs, a cluster with large number of CPUs is usually needed.</span></span>

<span data-ttu-id="f1832-154">Você pode usar as CPUs para essa arquitetura em qualquer cenário, mas para modelos de aprendizado profundo, as GPUs fornecem valores de taxa de transferência significativamente superiores em comparação com um cluster de CPU de custo semelhante.</span><span class="sxs-lookup"><span data-stu-id="f1832-154">You can use CPUs for this architecture in either scenario, but for deep learning models, GPUs provide significantly higher throughput values compared to a CPU cluster of similar cost.</span></span> <span data-ttu-id="f1832-155">O AKS oferece suporte ao uso de GPUs, que é uma das vantagens de usar AKS para essa arquitetura.</span><span class="sxs-lookup"><span data-stu-id="f1832-155">AKS supports the use of GPUs, which is one advantage of using AKS for this architecture.</span></span> <span data-ttu-id="f1832-156">Além disso, as implantações de aprendizado profundo geralmente usam modelos com um grande número de parâmetros.</span><span class="sxs-lookup"><span data-stu-id="f1832-156">Also, deep learning deployments typically use models with a high number of parameters.</span></span> <span data-ttu-id="f1832-157">Usar GPUs impede a contenção de recursos entre o modelo e o serviço Web, que é um problema em implantações somente de CPU.</span><span class="sxs-lookup"><span data-stu-id="f1832-157">Using GPUs prevents contention for resources between the model and the web service, which is an issue in CPU-only deployments.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="f1832-158">Considerações sobre escalabilidade</span><span class="sxs-lookup"><span data-stu-id="f1832-158">Scalability considerations</span></span>

<span data-ttu-id="f1832-159">Para modelos de Python normais, em que o cluster do AKS é provisionado com VMs de CPU, tome cuidado quando [aumentar o número de pods][manually-scale-pods].</span><span class="sxs-lookup"><span data-stu-id="f1832-159">For regular Python models, where AKS cluster is provisioned with CPU-only VMs, take care when [scaling out the number of pods][manually-scale-pods].</span></span> <span data-ttu-id="f1832-160">O objetivo é utilizar totalmente o cluster.</span><span class="sxs-lookup"><span data-stu-id="f1832-160">The goal is to fully utilize the cluster.</span></span> <span data-ttu-id="f1832-161">O dimensionamento depende das solicitações de CPU e dos limites definidos para os pods.</span><span class="sxs-lookup"><span data-stu-id="f1832-161">Scaling depends on the CPU requests and limits defined for the pods.</span></span> <span data-ttu-id="f1832-162">O Kubernetes dá suporte ao [dimensionamento automático][autoscale-pods] de pods para ajustar o número de pods em uma implantação, dependendo da utilização da CPU ou de outras métricas selecionadas.</span><span class="sxs-lookup"><span data-stu-id="f1832-162">Kubernetes also supports [autoscaling][autoscale-pods] of the pods to adjust the number of pods in a deployment depending on CPU utilization or other select metrics.</span></span> <span data-ttu-id="f1832-163">O [dimensionador automático de cluster][autoscaler] (em versão prévia) faz isso colocando em escala seus nós de agente com base em pods pendentes.</span><span class="sxs-lookup"><span data-stu-id="f1832-163">The [cluster autoscaler][autoscaler] (in preview) can scale agent nodes based on pending pods.</span></span>

<span data-ttu-id="f1832-164">Para cenários de aprendizado profundo, usando as máquinas virtuais habilitadas para GPU, os limites de recursos nos pods fazem com que uma GPU seja atribuída a um pod.</span><span class="sxs-lookup"><span data-stu-id="f1832-164">For deep learning scenarios, using GPU-enabled VMs, resource limits on pods are such that one GPU is assigned to one pod.</span></span> <span data-ttu-id="f1832-165">Dependendo do tipo de VM usado, você deve [dimensionar os nós do cluster][scale-cluster] para atender à demanda para o serviço.</span><span class="sxs-lookup"><span data-stu-id="f1832-165">Depending on the type of VM used, you must [scale the nodes of the cluster][scale-cluster] to meet the demand for the service.</span></span> <span data-ttu-id="f1832-166">Você pode fazer isso facilmente usando a CLI do Azure e o kubectl.</span><span class="sxs-lookup"><span data-stu-id="f1832-166">You can do this easily using the Azure CLI and kubectl.</span></span>

## <a name="monitoring-and-logging-considerations"></a><span data-ttu-id="f1832-167">Considerações de monitoramento e registro em log</span><span class="sxs-lookup"><span data-stu-id="f1832-167">Monitoring and logging considerations</span></span>

### <a name="aks-monitoring"></a><span data-ttu-id="f1832-168">Monitoramento do AKS</span><span class="sxs-lookup"><span data-stu-id="f1832-168">AKS monitoring</span></span>

<span data-ttu-id="f1832-169">Para visibilidade sobre o desempenho do AKS, use o recurso de [Azure Monitor para contêineres][monitor-containers].</span><span class="sxs-lookup"><span data-stu-id="f1832-169">For visibility into AKS performance, use the [Azure Monitor for containers][monitor-containers] feature.</span></span> <span data-ttu-id="f1832-170">Ele coleta métricas de processador e memória de controladores, nós e contêineres disponíveis no Kubernetes por meio da API Métricas.</span><span class="sxs-lookup"><span data-stu-id="f1832-170">It collects memory and processor metrics from controllers, nodes, and containers that are available in Kubernetes through the Metrics API.</span></span>

<span data-ttu-id="f1832-171">Ao implantar seu aplicativo, monitore o cluster do AKS para verificar se ele está funcionando conforme o esperado, se todos os nós estão operacionais e se todos os pods estão em execução.</span><span class="sxs-lookup"><span data-stu-id="f1832-171">While deploying your application, monitor the AKS cluster to make sure it's working as expected, all the nodes are operational, and all pods are running.</span></span> <span data-ttu-id="f1832-172">Embora você possa usar a ferramenta de linha de comando [kubectl][kubectl] para recuperar o status de pod, o Kubernetes também inclui um painel Web para o monitoramento básico do status do cluster e gerenciamento.</span><span class="sxs-lookup"><span data-stu-id="f1832-172">Although you can use the [kubectl][kubectl] command-line tool to retrieve pod status, Kubernetes also includes a web dashboard for basic monitoring of the cluster status and management.</span></span>

![](./_images/python-kubernetes-dashboard.png)

<span data-ttu-id="f1832-173">Para ver o estado geral do cluster e dos nós, vá até a seção **Nós** no painel do Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="f1832-173">To see the overall state of the cluster and nodes, go to the **Nodes** section of the Kubernetes dashboard.</span></span> <span data-ttu-id="f1832-174">Se um nó está inativo ou falhou, você pode exibir os logs de erros nessa página.</span><span class="sxs-lookup"><span data-stu-id="f1832-174">If a node is inactive or has failed, you can display the error logs from that page.</span></span> <span data-ttu-id="f1832-175">Da mesma forma, vá até as seções **Pods** e **Implantações** para obter informações sobre o número de pods e o status da implantação.</span><span class="sxs-lookup"><span data-stu-id="f1832-175">Similarly, go to the **Pods** and **Deployments** sections for information about the number of pods and status of your deployment.</span></span>

### <a name="aks-logs"></a><span data-ttu-id="f1832-176">Logs do AKS</span><span class="sxs-lookup"><span data-stu-id="f1832-176">AKS logs</span></span> 

<span data-ttu-id="f1832-177">O AKS registra automaticamente todos os stdout/stderr para os logs dos pods no cluster.</span><span class="sxs-lookup"><span data-stu-id="f1832-177">AKS automatically logs all stdout/stderr to the logs of the pods in the cluster.</span></span> <span data-ttu-id="f1832-178">Use kubectl para vê-los e ver também os eventos de nível de nó e logs.</span><span class="sxs-lookup"><span data-stu-id="f1832-178">Use kubectl to see these and also node-level events and logs.</span></span> <span data-ttu-id="f1832-179">Para obter detalhes, confira as etapas de implantação.</span><span class="sxs-lookup"><span data-stu-id="f1832-179">For details, see the deployment steps.</span></span>

<span data-ttu-id="f1832-180">Use o [Azure Monitor para contêineres][monitor-containers] para coletar métricas e logs por meio de uma versão em contêineres do agente do Log Analytics para o Linux, que é armazenado em seu workspace do Log Analytics.</span><span class="sxs-lookup"><span data-stu-id="f1832-180">Use [Azure Monitor for containers][monitor-containers] to collect metrics and logs through a containerized version of the Log Analytics agent for Linux, which is stored in your Log Analytics workspace.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="f1832-181">Considerações de segurança</span><span class="sxs-lookup"><span data-stu-id="f1832-181">Security considerations</span></span>

<span data-ttu-id="f1832-182">Use a [Central de Segurança do Azure][security-center] para obter uma exibição central do estado da segurança de seus recursos do Azure.</span><span class="sxs-lookup"><span data-stu-id="f1832-182">Use [Azure Security Center][security-center] to get a central view of the security state of your Azure resources.</span></span> <span data-ttu-id="f1832-183">A Central de Segurança monitora problemas de segurança potenciais e fornece uma visão abrangente da integridade de segurança de sua implantação, mas ela não monitora os nós do agente do AKS.</span><span class="sxs-lookup"><span data-stu-id="f1832-183">Security Center monitors potential security issues and provides a comprehensive picture of the security health of your deployment, although it doesn't monitor AKS agent nodes.</span></span> <span data-ttu-id="f1832-184">A Central de Segurança é configurada por assinatura do Azure.</span><span class="sxs-lookup"><span data-stu-id="f1832-184">Security Center is configured per Azure subscription.</span></span> <span data-ttu-id="f1832-185">Habilite a coleta de dados de segurança conforme descrito em [Integrar a assinatura do Azure à Central de Segurança Standard][get-started].</span><span class="sxs-lookup"><span data-stu-id="f1832-185">Enable security data collection as described in [Onboard your Azure subscription to Security Center Standard][get-started].</span></span> <span data-ttu-id="f1832-186">Depois que a coleta de dados for habilitada, a Central de Segurança examinará automaticamente todas as VMs criadas nessa assinatura.</span><span class="sxs-lookup"><span data-stu-id="f1832-186">When data collection is enabled, Security Center automatically scans any VMs created under that subscription.</span></span>

<span data-ttu-id="f1832-187">**Operações**.</span><span class="sxs-lookup"><span data-stu-id="f1832-187">**Operations**.</span></span> <span data-ttu-id="f1832-188">Para se conectar a um cluster AKS usando o token de autenticação do Azure Active Directory (Azure AD), configure o AKS para usar o Azure AD para [autenticação do usuário][aad-auth].</span><span class="sxs-lookup"><span data-stu-id="f1832-188">To sign in to an AKS cluster using your Azure Active Directory (Azure AD) authentication token, configure AKS to use Azure AD for [user authentication][aad-auth].</span></span> <span data-ttu-id="f1832-189">Os administradores de cluster também podem configurar o controle de acesso baseado em função (RBAC) do Kubernetes com base na identidade de um usuário ou associação no grupo de diretórios.</span><span class="sxs-lookup"><span data-stu-id="f1832-189">Cluster administrators can also configure Kubernetes role-based access control (RBAC) based on a user's identity or directory group membership.</span></span>

<span data-ttu-id="f1832-190">Use o [RBAC][rbac] para controlar o acesso aos recursos do Azure que você implanta.</span><span class="sxs-lookup"><span data-stu-id="f1832-190">Use [RBAC][rbac] to control access to the Azure resources that you deploy.</span></span> <span data-ttu-id="f1832-191">O RBAC permite atribuir funções de autorização aos membros de sua equipe de DevOps.</span><span class="sxs-lookup"><span data-stu-id="f1832-191">RBAC lets you assign authorization roles to members of your DevOps team.</span></span> <span data-ttu-id="f1832-192">Um usuário pode ser atribuído a várias funções, e você pode criar funções personalizadas para [permissões] ainda mais refinadas.</span><span class="sxs-lookup"><span data-stu-id="f1832-192">A user can be assigned to multiple roles, and you can create custom roles for even more fine-grained [permissions].</span></span>

<span data-ttu-id="f1832-193">**HTTPS**.</span><span class="sxs-lookup"><span data-stu-id="f1832-193">**HTTPS**.</span></span> <span data-ttu-id="f1832-194">Como prática recomendada de segurança, o aplicativo deve impor HTTPS e redirecionar as solicitações HTTP.</span><span class="sxs-lookup"><span data-stu-id="f1832-194">As a security best practice, the application should enforce HTTPS and redirect HTTP requests.</span></span> <span data-ttu-id="f1832-195">Use um [controlador de entrada][ingress-controller] para implantar um proxy reverso que termina o SSL e redireciona as solicitações HTTP.</span><span class="sxs-lookup"><span data-stu-id="f1832-195">Use an [ingress controller][ingress-controller] to deploy a reverse proxy that terminates SSL and redirects HTTP requests.</span></span> <span data-ttu-id="f1832-196">Para obter mais informações, confira [Criar um controlador de ingresso HTTPS no Serviço de Kubernetes do Azure (AKS)][https-ingress].</span><span class="sxs-lookup"><span data-stu-id="f1832-196">For more information, see [Create an HTTPS ingress controller on Azure Kubernetes Service (AKS)][https-ingress].</span></span>

<span data-ttu-id="f1832-197">**Autenticação**.</span><span class="sxs-lookup"><span data-stu-id="f1832-197">**Authentication**.</span></span> <span data-ttu-id="f1832-198">Essa solução não restringe o acesso aos pontos de extremidade.</span><span class="sxs-lookup"><span data-stu-id="f1832-198">This solution doesn't restrict access to the endpoints.</span></span> <span data-ttu-id="f1832-199">Para implantar a arquitetura em uma configuração empresarial, proteja os pontos de extremidade por meio de chaves de API e adicione alguma forma de autenticação do usuário para o aplicativo cliente.</span><span class="sxs-lookup"><span data-stu-id="f1832-199">To deploy the architecture in an enterprise setting, secure the endpoints through API keys and add some form of user authentication to the client application.</span></span>

<span data-ttu-id="f1832-200">**Registro de contêiner**.</span><span class="sxs-lookup"><span data-stu-id="f1832-200">**Container registry**.</span></span> <span data-ttu-id="f1832-201">Essa solução usa um registro público para armazenar a imagem do Docker.</span><span class="sxs-lookup"><span data-stu-id="f1832-201">This solution uses a public registry to store the Docker image.</span></span> <span data-ttu-id="f1832-202">O código do qual o aplicativo depende, bem como o modelo, estão contidos dentro dessa imagem.</span><span class="sxs-lookup"><span data-stu-id="f1832-202">The code that the application depends on, and the model, are contained within this image.</span></span> <span data-ttu-id="f1832-203">Aplicativos empresariais devem usar um registro privado para ajudar na proteção contra a execução de código mal-intencionado e para ajudar a impedir que as informações dentro do contêiner sejam comprometidas.</span><span class="sxs-lookup"><span data-stu-id="f1832-203">Enterprise applications should use a private registry to help guard against running malicious code and to help keep the information inside the container from being compromised.</span></span>

<span data-ttu-id="f1832-204">**Proteção contra DDoS**.</span><span class="sxs-lookup"><span data-stu-id="f1832-204">**DDoS protection**.</span></span> <span data-ttu-id="f1832-205">Considere habilitar a [Proteção contra DDoS Standard][ddos].</span><span class="sxs-lookup"><span data-stu-id="f1832-205">Consider enabling [DDoS Protection Standard][ddos].</span></span> <span data-ttu-id="f1832-206">Embora a proteção contra DDoS básica seja habilitada como parte da plataforma Azure, a Proteção contra DDoS Standard fornece funcionalidades de mitigação ajustadas especificamente para os recursos da rede virtual do Azure.</span><span class="sxs-lookup"><span data-stu-id="f1832-206">Although basic DDoS protection is enabled as part of the Azure platform, DDoS Protection Standard provides mitigation capabilities that are tuned specifically to Azure virtual network resources.</span></span>

<span data-ttu-id="f1832-207">**Registro em log**.</span><span class="sxs-lookup"><span data-stu-id="f1832-207">**Logging**.</span></span> <span data-ttu-id="f1832-208">Use as práticas recomendadas antes de armazenar dados de log, como remover as senhas de usuário e outras informações que podem ser usadas para cometer fraudes de segurança.</span><span class="sxs-lookup"><span data-stu-id="f1832-208">Use best practices before storing log data, such as scrubbing user passwords and other information that could be used to commit security fraud.</span></span>

## <a name="deployment"></a><span data-ttu-id="f1832-209">Implantação</span><span class="sxs-lookup"><span data-stu-id="f1832-209">Deployment</span></span>

<span data-ttu-id="f1832-210">Para implantar essa arquitetura de referência, execute as etapas descritas no repositório do GitHub:</span><span class="sxs-lookup"><span data-stu-id="f1832-210">To deploy this reference architecture, follow the steps described in the GitHub repos:</span></span> 

  - <span data-ttu-id="f1832-211">[Modelos de Python normais][github-python]</span><span class="sxs-lookup"><span data-stu-id="f1832-211">[Regular Python models][github-python]</span></span>
  - <span data-ttu-id="f1832-212">[Modelos de aprendizado profundo][github-dl]</span><span class="sxs-lookup"><span data-stu-id="f1832-212">[Deep learning models][github-dl]</span></span>

[aad-auth]: /azure/aks/aad-integration
[acr]: /azure/container-registry/
[something]: https://kubernetes.io/docs/reference/access-authn-authz/authentication/
[aks]: /azure/aks/intro-kubernetes
[autoscaler]: /azure/aks/autoscaler
[autoscale-pods]: /azure/aks/tutorial-kubernetes-scale#autoscale-pods
[azcopy]: /azure/storage/common/storage-use-azcopy-linux
[ddos]: /azure/virtual-network/ddos-protection-overview
[docker]: https://hub.docker.com/
[get-started]: /azure/security-center/security-center-get-started
[github-python]: https://github.com/Azure/MLAKSDeployment
[github-dl]: https://github.com/Microsoft/AKSDeploymentTutorial
[gpus-vs-cpus]: https://azure.microsoft.com/en-us/blog/gpus-vs-cpus-for-deployment-of-deep-learning-models/
[https-ingress]: /azure/aks/ingress-tls
[ingress-controller]: https://kubernetes.io/docs/concepts/services-networking/ingress/
[kubectl]: https://kubernetes.io/docs/tasks/tools/install-kubectl/
[lb]: /azure/load-balancer/load-balancer-overview
[manually-scale-pods]: /azure/aks/tutorial-kubernetes-scale#manually-scale-pods
[monitor-containers]: /azure/monitoring/monitoring-container-insights-overview
[permissões]: /azure/aks/concepts-identity
[permissions]: /azure/aks/concepts-identity
[rbac]: /azure/active-directory/role-based-access-control-what-is
[scale-cluster]: /azure/aks/scale-cluster
[scikit]: https://pypi.org/project/scikit-learn/
[security-center]: /azure/security-center/security-center-intro
[vm]: /azure/virtual-machines/

