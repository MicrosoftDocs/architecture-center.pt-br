---
title: Enterprise BI com o SQL Data Warehouse
description: Use o Azure para obter insights de negócios de dados relacionais armazenados localmente
author: alexbuckgit
ms.date: 04/13/2018
ms.openlocfilehash: b5e5aa32fc9cc8c7b8b5a42c9a4fc3e0216b2f72
ms.sourcegitcommit: f665226cec96ec818ca06ac6c2d83edb23c9f29c
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/16/2018
ms.locfileid: "31012832"
---
# <a name="enterprise-bi-with-sql-data-warehouse"></a><span data-ttu-id="7de30-103">Enterprise BI com o SQL Data Warehouse</span><span class="sxs-lookup"><span data-stu-id="7de30-103">Enterprise BI with SQL Data Warehouse</span></span>
 
<span data-ttu-id="7de30-104">Essa arquitetura de referência implementa um pipeline [ELT](../../data-guide/relational-data/etl.md#extract-load-and-transform-elt) (extrair-carregar-transformar) que move os dados de um banco de dados SQL Server local para o SQL Data Warehouse e os transforma para análise.</span><span class="sxs-lookup"><span data-stu-id="7de30-104">This reference architecture implements an [ELT](../../data-guide/relational-data/etl.md#extract-load-and-transform-elt) (extract-load-transform) pipeline that moves data from an on-premises SQL Server database into SQL Data Warehouse and transforms the data for analysis.</span></span> [<span data-ttu-id="7de30-105">**Implante essa solução**.</span><span class="sxs-lookup"><span data-stu-id="7de30-105">**Deploy this solution**.</span></span>](#deploy-the-solution)

![](./images/enterprise-bi-sqldw.png)

<span data-ttu-id="7de30-106">**Cenário**: uma organização tem um grande conjunto de dados OLTP armazenado em um banco de dados SQL Server local.</span><span class="sxs-lookup"><span data-stu-id="7de30-106">**Scenario**: An organization has a large OLTP data set stored in a SQL Server database on premises.</span></span> <span data-ttu-id="7de30-107">A organização deseja usar o SQL Data Warehouse para fazer análise usando o Power BI.</span><span class="sxs-lookup"><span data-stu-id="7de30-107">The organization wants to use SQL Data Warehouse to perform analysis using Power BI.</span></span> 

<span data-ttu-id="7de30-108">Essa arquitetura de referência serve para trabalhos únicos ou sob demanda.</span><span class="sxs-lookup"><span data-stu-id="7de30-108">This reference architecture is designed for one-time or on-demand jobs.</span></span> <span data-ttu-id="7de30-109">Se você precisa mover os dados de forma contínua (por hora ou diariamente), recomendamos usar o Azure Data Factory para definir um fluxo de trabalho automatizado.</span><span class="sxs-lookup"><span data-stu-id="7de30-109">If you need to move data on a continuing basis (hourly or daily), we recommend using Azure Data Factory to define an automated workflow.</span></span>

## <a name="architecture"></a><span data-ttu-id="7de30-110">Arquitetura</span><span class="sxs-lookup"><span data-stu-id="7de30-110">Architecture</span></span>

<span data-ttu-id="7de30-111">A arquitetura consiste nos componentes a seguir.</span><span class="sxs-lookup"><span data-stu-id="7de30-111">The architecture consists of the following components.</span></span>

<span data-ttu-id="7de30-112">**SQL Server**.</span><span class="sxs-lookup"><span data-stu-id="7de30-112">**SQL Server**.</span></span> <span data-ttu-id="7de30-113">A fonte de dados está localizada em um banco de dados SQL Server local.</span><span class="sxs-lookup"><span data-stu-id="7de30-113">The source data is located in a SQL Server database on premises.</span></span> <span data-ttu-id="7de30-114">Para simular o ambiente local, os scripts de implantação dessa arquitetura provisionam uma máquina virtual no Azure com o SQL Server instalado.</span><span class="sxs-lookup"><span data-stu-id="7de30-114">To simulate the on-premises environment, the deployment scripts for this architecture provision a virtual machine in Azure with SQL Server installed.</span></span> 

<span data-ttu-id="7de30-115">**Armazenamento de Blobs**.</span><span class="sxs-lookup"><span data-stu-id="7de30-115">**Blob Storage**.</span></span> <span data-ttu-id="7de30-116">O armazenamento de blobs é usado como uma área de transferência para copiar os dados antes de carregá-los no SQL Data Warehouse.</span><span class="sxs-lookup"><span data-stu-id="7de30-116">Blob storage is used as a staging area to copy the data before loading it into SQL Data Warehouse.</span></span>

<span data-ttu-id="7de30-117">**SQL Data Warehouse do Azure**.</span><span class="sxs-lookup"><span data-stu-id="7de30-117">**Azure SQL Data Warehouse**.</span></span> <span data-ttu-id="7de30-118">O [SQL Data Warehouse](/azure/sql-data-warehouse/) é um sistema distribuído projetado para executar uma análise em grandes quantidades de dados.</span><span class="sxs-lookup"><span data-stu-id="7de30-118">[SQL Data Warehouse](/azure/sql-data-warehouse/) is a distributed system designed to perform analytics on large data.</span></span> <span data-ttu-id="7de30-119">Ele dá suporte a MPP (processamento altamente paralelo), que o torna adequado para executar análise de alto desempenho.</span><span class="sxs-lookup"><span data-stu-id="7de30-119">It supports massive parallel processing (MPP), which makes it suitable for running high-performance analytics.</span></span> 

<span data-ttu-id="7de30-120">**Azure Analysis Services**.</span><span class="sxs-lookup"><span data-stu-id="7de30-120">**Azure Analysis Services**.</span></span> <span data-ttu-id="7de30-121">O [Analysis Services](/azure/analysis-services/) é um serviço totalmente gerenciado que fornece recursos de modelagem de dados.</span><span class="sxs-lookup"><span data-stu-id="7de30-121">[Analysis Services](/azure/analysis-services/) is a fully managed service that provides data modeling capabilities.</span></span> <span data-ttu-id="7de30-122">Use o Analysis Services para criar um modelo semântico de que os usuários podem consultar.</span><span class="sxs-lookup"><span data-stu-id="7de30-122">Use Analysis Services to create a semantic model that users can query.</span></span> <span data-ttu-id="7de30-123">O Analysis Services é especialmente útil em um cenário de painel de BI.</span><span class="sxs-lookup"><span data-stu-id="7de30-123">Analysis Services is especially useful in a BI dashboard scenario.</span></span> <span data-ttu-id="7de30-124">Nessa arquitetura, o Analysis Services lê dados do data warehouse para processar o modelo semântico e atende a consultas ao painel de maneira eficiente.</span><span class="sxs-lookup"><span data-stu-id="7de30-124">In this architecture, Analysis Services reads data from the data warehouse to process the semantic model, and efficiently serves dashboard queries.</span></span> <span data-ttu-id="7de30-125">Ele também dá suporte à simultaneidade elástica, expandindo réplicas para acelerar o processamento das consultas.</span><span class="sxs-lookup"><span data-stu-id="7de30-125">It also supports elastic concurrency, by scaling out replicas for faster query processing.</span></span>

<span data-ttu-id="7de30-126">Atualmente, o Azure Analysis Services dá suporte a modelos tabulares, mas não a modelos multidimensionais.</span><span class="sxs-lookup"><span data-stu-id="7de30-126">Currently, Azure Analysis Services supports tabular models but not multidimensional models.</span></span> <span data-ttu-id="7de30-127">Os modelos tabulares usam constructos de modelagem relacional (tabelas e colunas), ao passo que os modelos multidimensionais utilizam constructos de modelagem OLAP (cubos, dimensões e medidas).</span><span class="sxs-lookup"><span data-stu-id="7de30-127">Tabular models use relational modeling constructs (tables and columns), whereas multidimensional models use OLAP modeling constructs (cubes, dimensions, and measures).</span></span> <span data-ttu-id="7de30-128">Se você precisar de modelos multidimensionais, use o SSAS (SQL Server Analysis Services).</span><span class="sxs-lookup"><span data-stu-id="7de30-128">If you require multidimensional models, use SQL Server Analysis Services (SSAS).</span></span> <span data-ttu-id="7de30-129">Para saber mais, confira [Comparando soluções tabulares e multidimensionais](/sql/analysis-services/comparing-tabular-and-multidimensional-solutions-ssas).</span><span class="sxs-lookup"><span data-stu-id="7de30-129">For more information, see [Comparing tabular and multidimensional solutions](/sql/analysis-services/comparing-tabular-and-multidimensional-solutions-ssas).</span></span>

<span data-ttu-id="7de30-130">**Power BI**.</span><span class="sxs-lookup"><span data-stu-id="7de30-130">**Power BI**.</span></span> <span data-ttu-id="7de30-131">O Power BI é um conjunto de ferramentas de análise de negócios para analisar dados a fim de obter informações comerciais.</span><span class="sxs-lookup"><span data-stu-id="7de30-131">Power BI is a suite of business analytics tools to analyze data for business insights.</span></span> <span data-ttu-id="7de30-132">Nessa arquitetura, ele consulta o modelo semântico armazenado no Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="7de30-132">In this architecture, it queries the semantic model stored in Analysis Services.</span></span>

<span data-ttu-id="7de30-133">O **Azure AD** (Azure Active Directory) autentica os usuários que se conectam ao servidor do Analysis Services por meio do Power BI.</span><span class="sxs-lookup"><span data-stu-id="7de30-133">**Azure Active Directory** (Azure AD) authenticates users who connect to the Analysis Services server through Power BI.</span></span>

## <a name="data-pipeline"></a><span data-ttu-id="7de30-134">Pipeline de dados</span><span class="sxs-lookup"><span data-stu-id="7de30-134">Data Pipeline</span></span>
 
<span data-ttu-id="7de30-135">Essa arquitetura de referência usa o banco de dados de exemplo [WorldWideImporters](/sql/sample/world-wide-importers/wide-world-importers-oltp-database) como fonte de dados.</span><span class="sxs-lookup"><span data-stu-id="7de30-135">This reference architecture uses the [WorldWideImporters](/sql/sample/world-wide-importers/wide-world-importers-oltp-database) sample database as data source.</span></span> <span data-ttu-id="7de30-136">O pipeline de dados tem os seguintes estágios:</span><span class="sxs-lookup"><span data-stu-id="7de30-136">The data pipeline has the following stages:</span></span>

1. <span data-ttu-id="7de30-137">Exporte os dados do SQL Server para arquivos simples (utilitário bcp).</span><span class="sxs-lookup"><span data-stu-id="7de30-137">Export the data from SQL Server to flat files (bcp utility).</span></span>
2. <span data-ttu-id="7de30-138">Copie os arquivos simples para o Armazenamento de Blobs do Azure (AzCopy).</span><span class="sxs-lookup"><span data-stu-id="7de30-138">Copy the flat files to Azure Blob Storage (AzCopy).</span></span>
3. <span data-ttu-id="7de30-139">Carregue os dados no SQL Data Warehouse (PolyBase).</span><span class="sxs-lookup"><span data-stu-id="7de30-139">Load the data into SQL Data Warehouse (PolyBase).</span></span>
4. <span data-ttu-id="7de30-140">Transforme os dados em um esquema em estrela (T-SQL).</span><span class="sxs-lookup"><span data-stu-id="7de30-140">Transform the data into a star schema (T-SQL).</span></span>
5. <span data-ttu-id="7de30-141">Carregue um modelo semântico no Analysis Services (SQL Server Data Tools).</span><span class="sxs-lookup"><span data-stu-id="7de30-141">Load a semantic model into Analysis Services (SQL Server Data Tools).</span></span>

![](./images/enterprise-bi-sqldw-pipeline.png)
 
> [!NOTE]
> <span data-ttu-id="7de30-142">Para obter as etapas 1 &ndash; 3, considere o uso do Data Platform Studio da Redgate.</span><span class="sxs-lookup"><span data-stu-id="7de30-142">For steps 1 &ndash; 3, consider using Redgate Data Platform Studio.</span></span> <span data-ttu-id="7de30-143">O Data Platform Studio aplica-se as correções de compatibilidade e otimizações mais apropriada, portanto, é a maneira mais rápida de começar a usar o SQL Data Warehouse.</span><span class="sxs-lookup"><span data-stu-id="7de30-143">Data Platform Studio applies the most appropriate compatibility fixes and optimizations, so it's the quickest way to get started with SQL Data Warehouse.</span></span> <span data-ttu-id="7de30-144">Para saber mais, confira [Carregar dados com o Data Platform Studio da Redgate](/azure/sql-data-warehouse/sql-data-warehouse-load-with-redgate).</span><span class="sxs-lookup"><span data-stu-id="7de30-144">For more information, see [Load data with Redgate Data Platform Studio](/azure/sql-data-warehouse/sql-data-warehouse-load-with-redgate).</span></span> 

<span data-ttu-id="7de30-145">As seções a seguir descrevem esses estágios mais detalhadamente.</span><span class="sxs-lookup"><span data-stu-id="7de30-145">The next sections describe these stages in more detail.</span></span>

### <a name="export-data-from-sql-server"></a><span data-ttu-id="7de30-146">Exportar dados do SQL Server</span><span class="sxs-lookup"><span data-stu-id="7de30-146">Export data from SQL Server</span></span>

<span data-ttu-id="7de30-147">O utilitário [bcp](/sql/tools/bcp-utility) (programa de cópia em massa) é uma maneira rápida de criar arquivos de texto simples de tabelas SQL.</span><span class="sxs-lookup"><span data-stu-id="7de30-147">The [bcp](/sql/tools/bcp-utility) (bulk copy program) utility is a fast way to create flat text files from SQL tables.</span></span> <span data-ttu-id="7de30-148">Nesta etapa, você seleciona as colunas que você deseja exportar, mas não transforma os dados.</span><span class="sxs-lookup"><span data-stu-id="7de30-148">In this step, you select the columns that you want to export, but don't transform the data.</span></span> <span data-ttu-id="7de30-149">As transformações de dados devem ocorrer no SQL Data Warehouse.</span><span class="sxs-lookup"><span data-stu-id="7de30-149">Any data transformations should happen in SQL Data Warehouse.</span></span>

<span data-ttu-id="7de30-150">**Recomendações**</span><span class="sxs-lookup"><span data-stu-id="7de30-150">**Recommendations**</span></span>

<span data-ttu-id="7de30-151">Se possível, agende a extração de dados fora do horário de pico para minimizar a contenção de recursos no ambiente de produção.</span><span class="sxs-lookup"><span data-stu-id="7de30-151">If possible, schedule data extraction during off-peak hours, to minimize resource contention in the production environment.</span></span> 

<span data-ttu-id="7de30-152">Evite executar bcp no servidor de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="7de30-152">Avoid running bcp on the database server.</span></span> <span data-ttu-id="7de30-153">Em vez disso, execute-o em outro computador.</span><span class="sxs-lookup"><span data-stu-id="7de30-153">Instead, run it from another machine.</span></span> <span data-ttu-id="7de30-154">Grave os arquivos em uma unidade local.</span><span class="sxs-lookup"><span data-stu-id="7de30-154">Write the files to a local drive.</span></span> <span data-ttu-id="7de30-155">Verifique se você te, recursos de E/S suficientes para lidar com as gravações simultâneas.</span><span class="sxs-lookup"><span data-stu-id="7de30-155">Ensure that you have sufficient I/O resources to handle the concurrent writes.</span></span> <span data-ttu-id="7de30-156">Para um melhor desempenho, exporte os arquivos para unidades de armazenamento rápido dedicadas.</span><span class="sxs-lookup"><span data-stu-id="7de30-156">For best performance, export the files to dedicated fast storage drives.</span></span>

<span data-ttu-id="7de30-157">Você pode acelerar a transferência de rede salvando os dados exportados no formato compactado Gzip.</span><span class="sxs-lookup"><span data-stu-id="7de30-157">You can speed up the network transfer by saving the exported data in Gzip compressed format.</span></span> <span data-ttu-id="7de30-158">No entanto, o carregamento de arquivos compactados no warehouse é mais lento do que o carregamento de arquivos descompactados e, portanto, há uma compensação entre a transferência de rede mais rápida em comparação com o carregamento mais rápido.</span><span class="sxs-lookup"><span data-stu-id="7de30-158">However, loading compressed files into the warehouse is slower than loading uncompressed files, so there is a tradeoff between faster network transfer versus faster loading.</span></span> <span data-ttu-id="7de30-159">Se você decidir usar compactação Gzip, não crie um arquivo Gzip único.</span><span class="sxs-lookup"><span data-stu-id="7de30-159">If you decide to use Gzip compression, don't create a single Gzip file.</span></span> <span data-ttu-id="7de30-160">Em vez disso, divida os dados em vários arquivos compactados.</span><span class="sxs-lookup"><span data-stu-id="7de30-160">Instead, split the data into multiple compressed files.</span></span>

### <a name="copy-flat-files-into-blob-storage"></a><span data-ttu-id="7de30-161">Copiar arquivos simples no armazenamento de blobs</span><span class="sxs-lookup"><span data-stu-id="7de30-161">Copy flat files into blob storage</span></span>

<span data-ttu-id="7de30-162">O utilitário [AzCopy](/azure/storage/common/storage-use-azcopy) foi projetado para cópia de alto desempenho dos dados no armazenamento de blobs do Azure.</span><span class="sxs-lookup"><span data-stu-id="7de30-162">The [AzCopy](/azure/storage/common/storage-use-azcopy) utility is designed for high-performance copying of data into Azure blob storage.</span></span>

<span data-ttu-id="7de30-163">**Recomendações**</span><span class="sxs-lookup"><span data-stu-id="7de30-163">**Recommendations**</span></span>

<span data-ttu-id="7de30-164">Crie a conta de armazenamento em uma região perto do local da fonte de dados.</span><span class="sxs-lookup"><span data-stu-id="7de30-164">Create the storage account in a region near the location of the source data.</span></span> <span data-ttu-id="7de30-165">Implante a conta de armazenamento e a instância do SQL Data Warehouse na mesma região.</span><span class="sxs-lookup"><span data-stu-id="7de30-165">Deploy the storage account and the SQL Data Warehouse instance in the same region.</span></span> 

<span data-ttu-id="7de30-166">Não execute o AzCopy no mesmo computador que executa suas cargas de trabalho de produção, pois o consumo de CPU e E/S pode interferir na carga de trabalho de produção.</span><span class="sxs-lookup"><span data-stu-id="7de30-166">Don't run AzCopy on the same machine that runs your production workloads, because the CPU and I/O consumption can interfere with the production workload.</span></span> 

<span data-ttu-id="7de30-167">Teste o carregamento primeiro para ver como está a velocidade de upload.</span><span class="sxs-lookup"><span data-stu-id="7de30-167">Test the upload first to see what the upload speed is like.</span></span> <span data-ttu-id="7de30-168">Você pode usar a opção /NC no AzCopy para especificar o número de operações de cópia simultâneas.</span><span class="sxs-lookup"><span data-stu-id="7de30-168">You can use the /NC option in AzCopy to specify the number of concurrent copy operations.</span></span> <span data-ttu-id="7de30-169">Comece com o valor padrão e faça experiências com essa configuração para ajustar o desempenho.</span><span class="sxs-lookup"><span data-stu-id="7de30-169">Start with the default value, then experiment with this setting to tune the performance.</span></span> <span data-ttu-id="7de30-170">Em um ambiente com pouca largura de banda, o grande número de operações simultâneas pode sobrecarregar a conexão de rede, evitando que as operações sejam concluídas.</span><span class="sxs-lookup"><span data-stu-id="7de30-170">In a low-bandwidth environment, too many concurrent operations can overwhelm the network connection and prevent the operations from completing successfully.</span></span>  

<span data-ttu-id="7de30-171">O AzCopy move os dados para o armazenamento pela Internet pública.</span><span class="sxs-lookup"><span data-stu-id="7de30-171">AzCopy moves data to storage over the public internet.</span></span> <span data-ttu-id="7de30-172">Se isso não for rápido o suficiente, considere configurar um circuito [ExpressRoute](/azure/expressroute/).</span><span class="sxs-lookup"><span data-stu-id="7de30-172">If this isn't fast enough, consider setting up an [ExpressRoute](/azure/expressroute/) circuit.</span></span> <span data-ttu-id="7de30-173">O ExpressRoute é um serviço que encaminha os dados por uma conexão privada dedicada para o Azure.</span><span class="sxs-lookup"><span data-stu-id="7de30-173">ExpressRoute is a service that routes your data through a dedicated private connection to Azure.</span></span> <span data-ttu-id="7de30-174">Outra opção, se sua conexão de rede estiver lenta, é enviar os dados em disco fisicamente para um datacenter do Azure.</span><span class="sxs-lookup"><span data-stu-id="7de30-174">Another option, if your network connection is too slow, is to physically ship the data on disk to an Azure datacenter.</span></span> <span data-ttu-id="7de30-175">Para saber mais, confira [Transferindo dados bidirecionalmente no Azure](/azure/architecture/data-guide/scenarios/data-transfer).</span><span class="sxs-lookup"><span data-stu-id="7de30-175">For more information, see [Transferring data to and from Azure](/azure/architecture/data-guide/scenarios/data-transfer).</span></span>

<span data-ttu-id="7de30-176">Durante uma operação de cópia, o AzCopy cria um arquivo de diário temporário, que permite a ele reiniciar a operação se for interrompido (por exemplo, devido a um erro de rede).</span><span class="sxs-lookup"><span data-stu-id="7de30-176">During a copy operation, AzCopy creates a temporary journal file, which enables AzCopy to restart the operation if it gets interrupted (for example, due to a network error).</span></span> <span data-ttu-id="7de30-177">Verifique se há espaço em disco suficiente para armazenar os arquivos de diário.</span><span class="sxs-lookup"><span data-stu-id="7de30-177">Make sure there is enough disk space to store the journal files.</span></span> <span data-ttu-id="7de30-178">Você pode usar a opção /Z para especificar onde os arquivos de diário serão gravados.</span><span class="sxs-lookup"><span data-stu-id="7de30-178">You can use the /Z option to specify where the journal files are written.</span></span>

### <a name="load-data-into-sql-data-warehouse"></a><span data-ttu-id="7de30-179">Carregar dados no SQL Data Warehouse</span><span class="sxs-lookup"><span data-stu-id="7de30-179">Load data into SQL Data Warehouse</span></span>

<span data-ttu-id="7de30-180">Use [PolyBase](/sql/relational-databases/polybase/polybase-guide) para carregar os arquivos do armazenamento de blobs no data warehouse.</span><span class="sxs-lookup"><span data-stu-id="7de30-180">Use [PolyBase](/sql/relational-databases/polybase/polybase-guide) to load the files from blob storage into the data warehouse.</span></span> <span data-ttu-id="7de30-181">O PolyBase foi projetado para aproveitar a arquitetura MPP (processamento altamente paralelo) do SQL Data Warehouse, o que o torna a maneira mais rápida de carregar dados no SQL Data Warehouse.</span><span class="sxs-lookup"><span data-stu-id="7de30-181">PolyBase is designed to leverage the MPP (Massively Parallel Processing) architecture of SQL Data Warehouse, which makes it the fastest way to load data into SQL Data Warehouse.</span></span> 

<span data-ttu-id="7de30-182">O carregamento de dados é um processo de duas etapas:</span><span class="sxs-lookup"><span data-stu-id="7de30-182">Loading the data is a two-step process:</span></span>

1. <span data-ttu-id="7de30-183">Crie um conjunto de tabelas externas para os dados.</span><span class="sxs-lookup"><span data-stu-id="7de30-183">Create a set of external tables for the data.</span></span> <span data-ttu-id="7de30-184">Uma tabela externa é uma definição de tabela que aponta para dados armazenados fora do warehouse &mdash;, neste caso, os arquivos simples no armazenamento de blobs.</span><span class="sxs-lookup"><span data-stu-id="7de30-184">An external table is a table definition that points to data stored outside of the warehouse &mdash; in this case, the flat files in blob storage.</span></span> <span data-ttu-id="7de30-185">Essa etapa não move os dados para o warehouse.</span><span class="sxs-lookup"><span data-stu-id="7de30-185">This step does not move any data into the warehouse.</span></span>
2. <span data-ttu-id="7de30-186">Crie tabelas de preparo e carregue os dados nas tabelas de preparo.</span><span class="sxs-lookup"><span data-stu-id="7de30-186">Create staging tables, and load the data into the staging tables.</span></span> <span data-ttu-id="7de30-187">Essa etapa copia os dados para o warehouse.</span><span class="sxs-lookup"><span data-stu-id="7de30-187">This step copies the data into the warehouse.</span></span>

<span data-ttu-id="7de30-188">**Recomendações**</span><span class="sxs-lookup"><span data-stu-id="7de30-188">**Recommendations**</span></span>

<span data-ttu-id="7de30-189">Quando você tiver grandes quantidades de dados (mais de 1 TB) e estiver executando uma carga de trabalho de análise que se beneficiam de paralelismo, considere o SQL Data Warehouse.</span><span class="sxs-lookup"><span data-stu-id="7de30-189">Consider SQL Data Warehouse when you have large amounts of data (more than 1 TB) and are running an analytics workload that will benefit from parallelism.</span></span> <span data-ttu-id="7de30-190">O SQL Data Warehouse não é uma boa opção para cargas de trabalho OLTP ou conjuntos de dados menores (< 250GB).</span><span class="sxs-lookup"><span data-stu-id="7de30-190">SQL Data Warehouse is not a good fit for OLTP workloads or smaller data sets (< 250GB).</span></span> <span data-ttu-id="7de30-191">Para conjuntos de dados menores que 250GB, considere o Banco de Dados SQL ou o SQL Server.</span><span class="sxs-lookup"><span data-stu-id="7de30-191">For data sets less than 250GB, consider Azure SQL Database or SQL Server.</span></span> <span data-ttu-id="7de30-192">Para saber mais, confira [Armazenagem de Dados](../../data-guide/relational-data/data-warehousing.md).</span><span class="sxs-lookup"><span data-stu-id="7de30-192">For more information, see [Data warehousing](../../data-guide/relational-data/data-warehousing.md).</span></span>

<span data-ttu-id="7de30-193">Crie as tabelas de preparo como tabelas de heap, que não são indexadas.</span><span class="sxs-lookup"><span data-stu-id="7de30-193">Create the staging tables as heap tables, which are not indexed.</span></span> <span data-ttu-id="7de30-194">As consultas que criam as tabelas de produção resultarão em uma verificação completa e, portanto, não há motivo para indexar as tabelas de preparo.</span><span class="sxs-lookup"><span data-stu-id="7de30-194">The queries that create the production tables will result in a full table scan, so there is no reason to index the staging tables.</span></span>

<span data-ttu-id="7de30-195">O PolyBase se beneficia do paralelismo no warehouse automaticamente.</span><span class="sxs-lookup"><span data-stu-id="7de30-195">PolyBase automatically takes advantage of parallelism in the warehouse.</span></span> <span data-ttu-id="7de30-196">O desempenho de carga é dimensionado conforme você aumenta as DWUs.</span><span class="sxs-lookup"><span data-stu-id="7de30-196">The load performance scales as you increase DWUs.</span></span> <span data-ttu-id="7de30-197">Para um melhor desempenho, use uma única operação de carregamento.</span><span class="sxs-lookup"><span data-stu-id="7de30-197">For best performance, use a single load operation.</span></span> <span data-ttu-id="7de30-198">Não há nenhum benefício de desempenho em dividir os dados de entrada em partes e executar vários carregamentos simultâneos.</span><span class="sxs-lookup"><span data-stu-id="7de30-198">There is no performance benefit to breaking the input data into chunks and running multiple concurrent loads.</span></span>

<span data-ttu-id="7de30-199">O PolyBase pode ler arquivos compactados em Gzip.</span><span class="sxs-lookup"><span data-stu-id="7de30-199">PolyBase can read Gzip compressed files.</span></span> <span data-ttu-id="7de30-200">No entanto, somente um único leitor é usado por arquivo compactado, já que a descompactação do arquivo é uma operação de thread único.</span><span class="sxs-lookup"><span data-stu-id="7de30-200">However, only a single reader is used per compressed file, because uncompressing the file is a single-threaded operation.</span></span> <span data-ttu-id="7de30-201">Portanto, evite o carregamento de um único arquivo compactado grande.</span><span class="sxs-lookup"><span data-stu-id="7de30-201">Therefore, avoid loading a single large compressed file.</span></span> <span data-ttu-id="7de30-202">Em vez disso, divida os dados em vários arquivos compactados, para se beneficiar do paralelismo.</span><span class="sxs-lookup"><span data-stu-id="7de30-202">Instead, split the data into multiple compressed files, in order to take advantage of parallelism.</span></span> 

<span data-ttu-id="7de30-203">Esteja ciente das seguintes limitações:</span><span class="sxs-lookup"><span data-stu-id="7de30-203">Be aware of the following limitations:</span></span>

- <span data-ttu-id="7de30-204">O PolyBase dá suporte a um tamanho máximo de coluna de `varchar(8000)`, `nvarchar(4000)` ou `varbinary(8000)`.</span><span class="sxs-lookup"><span data-stu-id="7de30-204">PolyBase supports a maximum column size of `varchar(8000)`, `nvarchar(4000)`, or `varbinary(8000)`.</span></span> <span data-ttu-id="7de30-205">Se você tiver dados que excedem esses limites, uma opção é dividir os dados em partes quando exportá-los e remontar os fragmentos após a importação.</span><span class="sxs-lookup"><span data-stu-id="7de30-205">If you have data that exceeds these limits, one option is to break the data up into chunks when you export it, and then reassemble the chunks after import.</span></span> 

- <span data-ttu-id="7de30-206">O PolyBase usa um terminador de linha fixo de \n ou newline.</span><span class="sxs-lookup"><span data-stu-id="7de30-206">PolyBase uses a fixed row terminator of \n or newline.</span></span> <span data-ttu-id="7de30-207">Isso poderá causar problemas se houver caracteres de newline na fonte de dados.</span><span class="sxs-lookup"><span data-stu-id="7de30-207">This can cause problems if newline characters appear in the source data.</span></span>

- <span data-ttu-id="7de30-208">A esquema da fonte de dados pode conter tipos de dados que não têm suporte no SQL Data Warehouse.</span><span class="sxs-lookup"><span data-stu-id="7de30-208">Your source data schema might contain data types that are not supported in SQL Data Warehouse.</span></span>

<span data-ttu-id="7de30-209">Para contornar essas limitações, você pode criar um procedimento armazenado que realiza as conversões necessárias.</span><span class="sxs-lookup"><span data-stu-id="7de30-209">To work around these limitations, you can create a stored procedure that performs the necessary conversions.</span></span> <span data-ttu-id="7de30-210">Faça referência a esse procedimento armazenado ao executar o bcp.</span><span class="sxs-lookup"><span data-stu-id="7de30-210">Reference this stored procedure when you run bcp.</span></span> <span data-ttu-id="7de30-211">Como alternativa, o [Data Platform Studio da Redgate](/azure/sql-data-warehouse/sql-data-warehouse-load-with-redgate) converte automaticamente os tipos de dados que não têm suporte no SQL Data Warehouse.</span><span class="sxs-lookup"><span data-stu-id="7de30-211">Alternatively, [Redgate Data Platform Studio](/azure/sql-data-warehouse/sql-data-warehouse-load-with-redgate) automatically converts data types that aren’t supported in SQL Data Warehouse.</span></span>

<span data-ttu-id="7de30-212">Para obter mais informações, consulte os seguintes artigos:</span><span class="sxs-lookup"><span data-stu-id="7de30-212">For more information, see the following articles:</span></span>

- <span data-ttu-id="7de30-213">[Melhores práticas para carregar dados no SQL Data Warehouse do Azure](/azure/sql-data-warehouse/guidance-for-loading-data).</span><span class="sxs-lookup"><span data-stu-id="7de30-213">[Best practices for loading data into Azure SQL Data Warehouse](/azure/sql-data-warehouse/guidance-for-loading-data).</span></span>
- [<span data-ttu-id="7de30-214">Migrar seus esquemas para o SQL Data Warehouse</span><span class="sxs-lookup"><span data-stu-id="7de30-214">Migrate your schemas to SQL Data Warehouse</span></span>](/azure/sql-data-warehouse/sql-data-warehouse-migrate-schema)
- [<span data-ttu-id="7de30-215">Diretrizes para definir tipos de dados para tabelas no SQL Data Warehouse</span><span class="sxs-lookup"><span data-stu-id="7de30-215">Guidance for defining data types for tables in SQL Data Warehouse</span></span>](/azure/sql-data-warehouse/sql-data-warehouse-tables-data-types)

### <a name="transform-the-data"></a><span data-ttu-id="7de30-216">Transformar os dados</span><span class="sxs-lookup"><span data-stu-id="7de30-216">Transform the data</span></span>

<span data-ttu-id="7de30-217">Transforme os dados e mova-os para tabelas de produção.</span><span class="sxs-lookup"><span data-stu-id="7de30-217">Transform the data and move it into production tables.</span></span> <span data-ttu-id="7de30-218">Nesta etapa, os dados são transformados em um esquema em estrela com tabelas de dimensões e tabelas de fatos, adequadas para modelagem semântica.</span><span class="sxs-lookup"><span data-stu-id="7de30-218">In this step, the data is transformed into a star schema with dimension tables and fact tables, suitable for semantic modeling.</span></span>

<span data-ttu-id="7de30-219">Crie as tabelas de produção com índices columnstore clusterizados, que oferecem o melhor desempenho geral de consulta.</span><span class="sxs-lookup"><span data-stu-id="7de30-219">Create the production tables with clustered columnstore indexes, which offer the best overall query performance.</span></span> <span data-ttu-id="7de30-220">Os índices ColumnStore são otimizados para consultas que examinam muitos registros.</span><span class="sxs-lookup"><span data-stu-id="7de30-220">Columnstore indexes are optimized for queries that scan many records.</span></span> <span data-ttu-id="7de30-221">Os índices ColumnStore não tem o mesmo desempenho em pesquisas singleton (isto é, pesquisa de uma única linha).</span><span class="sxs-lookup"><span data-stu-id="7de30-221">Columnstore indexes don't perform as well for singleton lookups (that is, looking up a single row).</span></span> <span data-ttu-id="7de30-222">Se você precisar realizar pesquisas singleton frequentes, adicione um índice não clusterizado a uma tabela.</span><span class="sxs-lookup"><span data-stu-id="7de30-222">If you need to perform frequent singleton lookups, you can add a non-clustered index to a table.</span></span> <span data-ttu-id="7de30-223">As pesquisas singleton podem ficar significativamente mais rápidas usando um índice não clusterizado.</span><span class="sxs-lookup"><span data-stu-id="7de30-223">Singleton lookups can run significantly faster using a non-clustered index.</span></span> <span data-ttu-id="7de30-224">No entanto, as pesquisas singleton são geralmente menos comuns em cenários de data warehouse do que as cargas de trabalho OLTP.</span><span class="sxs-lookup"><span data-stu-id="7de30-224">However, singleton lookups are typically less common in data warehouse scenarios than OLTP workloads.</span></span> <span data-ttu-id="7de30-225">Para saber mais, confira [Indexando tabelas no SQL Data Warehouse](/azure/sql-data-warehouse/sql-data-warehouse-tables-index).</span><span class="sxs-lookup"><span data-stu-id="7de30-225">For more information, see [Indexing tables in SQL Data Warehouse](/azure/sql-data-warehouse/sql-data-warehouse-tables-index).</span></span>

> [!NOTE]
> <span data-ttu-id="7de30-226">As tabelas columnstore clusterizadas não dão suporte aos tipos de dados `varchar(max)`, `nvarchar(max)` ou `varbinary(max)`.</span><span class="sxs-lookup"><span data-stu-id="7de30-226">Clustered columnstore tables do not support `varchar(max)`, `nvarchar(max)`, or `varbinary(max)` data types.</span></span> <span data-ttu-id="7de30-227">Nesse caso, considere a possibilidade de usar um heap ou índice clusterizado.</span><span class="sxs-lookup"><span data-stu-id="7de30-227">In that case, consider a heap or clustered index.</span></span> <span data-ttu-id="7de30-228">Você pode colocar essas colunas em uma tabela separada.</span><span class="sxs-lookup"><span data-stu-id="7de30-228">You might put those columns into a separate table.</span></span>

<span data-ttu-id="7de30-229">Como o banco de dados de exemplo não é muito grande, criamos tabelas replicadas sem partições.</span><span class="sxs-lookup"><span data-stu-id="7de30-229">Because the sample database is not very large, we created replicated tables with no partitions.</span></span> <span data-ttu-id="7de30-230">Para cargas de trabalho de produção, o uso de tabelas distribuídas provavelmente melhorará o desempenho da consulta.</span><span class="sxs-lookup"><span data-stu-id="7de30-230">For production workloads, using distributed tables is likely to improve query performance.</span></span> <span data-ttu-id="7de30-231">Confira [Diretrizes para criar tabelas distribuídas no SQL Data Warehouse do Azure](/azure/sql-data-warehouse/sql-data-warehouse-tables-distribute).</span><span class="sxs-lookup"><span data-stu-id="7de30-231">See [Guidance for designing distributed tables in Azure SQL Data Warehouse](/azure/sql-data-warehouse/sql-data-warehouse-tables-distribute).</span></span> <span data-ttu-id="7de30-232">Os scripts de exemplo executam as consultas usando uma [classe de recurso](/azure/sql-data-warehouse/resource-classes-for-workload-management) estática.</span><span class="sxs-lookup"><span data-stu-id="7de30-232">Our example scripts run the queries using a static [resource class](/azure/sql-data-warehouse/resource-classes-for-workload-management).</span></span>

### <a name="load-the-semantic-model"></a><span data-ttu-id="7de30-233">Carregar o modelo semântico</span><span class="sxs-lookup"><span data-stu-id="7de30-233">Load the semantic model</span></span>

<span data-ttu-id="7de30-234">Carregue os dados em um modelo tabular no Azure Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="7de30-234">Load the data into a tabular model in Azure Analysis Services.</span></span> <span data-ttu-id="7de30-235">Nesta etapa, você pode criar um modelo de dados semântico usando o SSDT (SQL Server Data Tools).</span><span class="sxs-lookup"><span data-stu-id="7de30-235">In this step, you create a semantic data model by using SQL Server Data Tools (SSDT).</span></span> <span data-ttu-id="7de30-236">Você também pode criar um modelo importando-o de um arquivo do Power BI Desktop.</span><span class="sxs-lookup"><span data-stu-id="7de30-236">You can also create a model by importing it from a Power BI Desktop file.</span></span> <span data-ttu-id="7de30-237">Como o SQL Data Warehouse não dá suporte a chaves estrangeiras, você deve adicionar as relações ao modelo semântico para poder unir entre tabelas.</span><span class="sxs-lookup"><span data-stu-id="7de30-237">Because SQL Data Warehouse does not support foreign keys, you must add the relationships to the semantic model, so that you can join across tables.</span></span>

### <a name="use-power-bi-to-visualize-the-data"></a><span data-ttu-id="7de30-238">Usar o Power BI para visualizar os dados</span><span class="sxs-lookup"><span data-stu-id="7de30-238">Use Power BI to visualize the data</span></span>

<span data-ttu-id="7de30-239">O Power BI dá suporte a duas opções de conexão com o Azure Analysis Services:</span><span class="sxs-lookup"><span data-stu-id="7de30-239">Power BI supports two options for connecting to Azure Analysis Services:</span></span>

- <span data-ttu-id="7de30-240">Importação.</span><span class="sxs-lookup"><span data-stu-id="7de30-240">Import.</span></span> <span data-ttu-id="7de30-241">Os dados são importados para o modelo do Power BI.</span><span class="sxs-lookup"><span data-stu-id="7de30-241">The data is imported into the Power BI model.</span></span>
- <span data-ttu-id="7de30-242">Conexão dinâmica.</span><span class="sxs-lookup"><span data-stu-id="7de30-242">Live Connection.</span></span> <span data-ttu-id="7de30-243">Os dados são recuperados diretamente do Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="7de30-243">Data is pulled directly from Analysis Services.</span></span>

<span data-ttu-id="7de30-244">Recomendamos a Conexão dinâmica porque ela não requer a cópia de dados no modelo do Power BI.</span><span class="sxs-lookup"><span data-stu-id="7de30-244">We recommend Live Connection because it doesn't require copying data into the Power BI model.</span></span> <span data-ttu-id="7de30-245">Além disso, o uso do DirectQuery garante que os resultados sejam sempre consistentes com os dados de origem mais recentes.</span><span class="sxs-lookup"><span data-stu-id="7de30-245">Also, using DirectQuery ensures that results are always consistent with the latest source data.</span></span> <span data-ttu-id="7de30-246">Para saber mais, confira [Conectar com o Power BI](/azure/analysis-services/analysis-services-connect-pbi).</span><span class="sxs-lookup"><span data-stu-id="7de30-246">For more information, see [Connect with Power BI](/azure/analysis-services/analysis-services-connect-pbi).</span></span>

<span data-ttu-id="7de30-247">**Recomendações**</span><span class="sxs-lookup"><span data-stu-id="7de30-247">**Recommendations**</span></span>

<span data-ttu-id="7de30-248">Evite executar consultas ao painel de BI diretamente no data warehouse.</span><span class="sxs-lookup"><span data-stu-id="7de30-248">Avoid running BI dashboard queries directly against the data warehouse.</span></span> <span data-ttu-id="7de30-249">Os painéis de BI exigem tempos de resposta muito baixos, que as consultas diretas ao warehouse poderão não conseguir atender.</span><span class="sxs-lookup"><span data-stu-id="7de30-249">BI dashboards require very low response times, which direct queries against the warehouse may be unable to satisfy.</span></span> <span data-ttu-id="7de30-250">Além disso, a atualização do painel afetará o número de consultas simultâneas, o que pode afetar o desempenho.</span><span class="sxs-lookup"><span data-stu-id="7de30-250">Also, refreshing the dashboard will count against the number of concurrent queries, which could impact performance.</span></span> 

<span data-ttu-id="7de30-251">O Azure Analysis Services foi projetado para lidar com os requisitos de consulta de um painel de BI e, portanto, a prática recomendada é consultar o Analysis Services do Power BI.</span><span class="sxs-lookup"><span data-stu-id="7de30-251">Azure Analysis Services is designed to handle the query requirements of a BI dashboard, so the recommended practice is to query Analysis Services from Power BI.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="7de30-252">Considerações sobre escalabilidade</span><span class="sxs-lookup"><span data-stu-id="7de30-252">Scalability Considerations</span></span>

### <a name="sql-data-warehouse"></a><span data-ttu-id="7de30-253">SQL Data Warehouse</span><span class="sxs-lookup"><span data-stu-id="7de30-253">SQL Data Warehouse</span></span>

<span data-ttu-id="7de30-254">Com o SQL Data warehouse, você pode expandir seus recursos de computação sob demanda.</span><span class="sxs-lookup"><span data-stu-id="7de30-254">With SQL Data Warehouse, you can scale out your compute resources on demand.</span></span> <span data-ttu-id="7de30-255">O mecanismo de consulta otimiza as consultas para processamento paralelo com base no número de nós de computação e move dados entre os nós conforme a necessidade.</span><span class="sxs-lookup"><span data-stu-id="7de30-255">The query engine optimizes queries for parallel processing based on the number of compute nodes, and moves data between nodes as necessary.</span></span> <span data-ttu-id="7de30-256">Para saber mais, confira [Gerenciar computação no SQL Data Warehouse do Azure](/azure/sql-data-warehouse/sql-data-warehouse-manage-compute-overview).</span><span class="sxs-lookup"><span data-stu-id="7de30-256">For more information, see [Manage compute in Azure SQL Data Warehouse](/azure/sql-data-warehouse/sql-data-warehouse-manage-compute-overview).</span></span>

### <a name="analysis-services"></a><span data-ttu-id="7de30-257">Serviços de análise</span><span class="sxs-lookup"><span data-stu-id="7de30-257">Analysis Services</span></span>

<span data-ttu-id="7de30-258">Para cargas de trabalho de produção, recomendamos a camada Standard do Azure Analysis Services, pois ele dá suporte a particionamento e DirectQuery.</span><span class="sxs-lookup"><span data-stu-id="7de30-258">For production workloads, we recommend the Standard Tier for Azure Analysis Services, because it supports partitioning and DirectQuery.</span></span> <span data-ttu-id="7de30-259">Dentro de uma camada, o tamanho da instância determina a memória e a potência de processamento.</span><span class="sxs-lookup"><span data-stu-id="7de30-259">Within a tier, the instance size determines the memory and processing power.</span></span> <span data-ttu-id="7de30-260">A capacidade de processamento é medida em QPUs (unidades de processamento de consulta).</span><span class="sxs-lookup"><span data-stu-id="7de30-260">Processing power is measured in Query Processing Units (QPUs).</span></span> <span data-ttu-id="7de30-261">Monitore o uso de QPUs para selecionar o tamanho apropriado.</span><span class="sxs-lookup"><span data-stu-id="7de30-261">Monitor your QPU usage to select the appropriate size.</span></span> <span data-ttu-id="7de30-262">Para saber mais, confira [Monitorar métricas do servidor](/azure/analysis-services/analysis-services-monitor).</span><span class="sxs-lookup"><span data-stu-id="7de30-262">For more information, see [Monitor server metrics](/azure/analysis-services/analysis-services-monitor).</span></span>

<span data-ttu-id="7de30-263">Com uma alta carga, o desempenho de consulta pode se degradar devido à simultaneidade de consultas.</span><span class="sxs-lookup"><span data-stu-id="7de30-263">Under high load, query performance can become degraded due to query concurrency.</span></span> <span data-ttu-id="7de30-264">Você pode expandir o Analysis Services criando um conjunto de réplicas para processar consultas, para que mais consultas possam ser executadas simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="7de30-264">You can scale out Analysis Services by creating a pool of replicas to process queries, so that more queries can be performed concurrently.</span></span> <span data-ttu-id="7de30-265">O trabalho de processamento do modelo de dados sempre ocorre no servidor primário.</span><span class="sxs-lookup"><span data-stu-id="7de30-265">The work of processing the data model always happens on the primary server.</span></span> <span data-ttu-id="7de30-266">Por padrão, o servidor primário também lida com consultas.</span><span class="sxs-lookup"><span data-stu-id="7de30-266">By default, the primary server also handles queries.</span></span> <span data-ttu-id="7de30-267">Opcionalmente, você pode designar o servidor primário para executar o processamento de modo exclusivo, para que o pool de consultas lide com todas as consultas.</span><span class="sxs-lookup"><span data-stu-id="7de30-267">Optionally, you can designate the primary server to run processing exclusively, so that the query pool handles all queries.</span></span> <span data-ttu-id="7de30-268">Se você tiver altos requisitos de processamento, separe o processamento do pool de consultas.</span><span class="sxs-lookup"><span data-stu-id="7de30-268">If you have high processing requirements, you should separate the processing from the query pool.</span></span> <span data-ttu-id="7de30-269">Se você tiver cargas de consulta pesadas e processamento relativamente leve, poderá incluir o servidor primário no pool de consultas.</span><span class="sxs-lookup"><span data-stu-id="7de30-269">If you have high query loads, and relatively light processing, you can include the primary server in the query pool.</span></span> <span data-ttu-id="7de30-270">Para saber mais, confira [Expansão do Azure Analysis Services](/azure/analysis-services/analysis-services-scale-out).</span><span class="sxs-lookup"><span data-stu-id="7de30-270">For more information, see [Azure Analysis Services scale-out](/azure/analysis-services/analysis-services-scale-out).</span></span> 

<span data-ttu-id="7de30-271">Para reduzir a quantidade de processamento desnecessária, considere usar partições para dividir o modelo tabular em partes lógicas.</span><span class="sxs-lookup"><span data-stu-id="7de30-271">To reduce the amount of unnecessary processing, consider using partitions to divide the tabular model into logical parts.</span></span> <span data-ttu-id="7de30-272">Cada partição pode ser processada separadamente.</span><span class="sxs-lookup"><span data-stu-id="7de30-272">Each partition can be processed separately.</span></span> <span data-ttu-id="7de30-273">Para saber mais, confira [Partições](/sql/analysis-services/tabular-models/partitions-ssas-tabular).</span><span class="sxs-lookup"><span data-stu-id="7de30-273">For more information, see [Partitions](/sql/analysis-services/tabular-models/partitions-ssas-tabular).</span></span>

## <a name="security-considerations"></a><span data-ttu-id="7de30-274">Considerações de segurança</span><span class="sxs-lookup"><span data-stu-id="7de30-274">Security Considerations</span></span>

### <a name="ip-whitelisting-of-analysis-services-clients"></a><span data-ttu-id="7de30-275">Lista de permissões de IPs de clientes do Analysis Services</span><span class="sxs-lookup"><span data-stu-id="7de30-275">IP whitelisting of Analysis Services clients</span></span>

<span data-ttu-id="7de30-276">Considere usar o recurso de firewall do Analysis Services para colocar endereços IP do cliente na lista de permissões.</span><span class="sxs-lookup"><span data-stu-id="7de30-276">Consider using the Analysis Services firewall feature to whitelist client IP addresses.</span></span> <span data-ttu-id="7de30-277">Se habilitada, o firewall bloqueará todas as conexões de cliente que não sejam as especificadas nas regras de firewall.</span><span class="sxs-lookup"><span data-stu-id="7de30-277">If enabled, the firewall blocks all client connections other than those specified in the firewall rules.</span></span> <span data-ttu-id="7de30-278">As regras padrão colocam o serviço Power BI na lista de permissões, mas você poderá desabilitar essa regra se desejar.</span><span class="sxs-lookup"><span data-stu-id="7de30-278">The default rules whitelist the Power BI service, but you can disable this rule if desired.</span></span> <span data-ttu-id="7de30-279">Para saber mais, confira [Aumentar a proteção do Azure Analysis Services com o novo recurso de firewall](https://azure.microsoft.com/blog/hardening-azure-analysis-services-with-the-new-firewall-capability/).</span><span class="sxs-lookup"><span data-stu-id="7de30-279">For more information, see [Hardening Azure Analysis Services with the new firewall capability](https://azure.microsoft.com/blog/hardening-azure-analysis-services-with-the-new-firewall-capability/).</span></span>

### <a name="authorization"></a><span data-ttu-id="7de30-280">Autorização</span><span class="sxs-lookup"><span data-stu-id="7de30-280">Authorization</span></span>

<span data-ttu-id="7de30-281">O Azure Analysis Services usa o Azure AD (Azure Active Directory) para autenticar usuários que se conectam a um servidor do Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="7de30-281">Azure Analysis Services uses Azure Active Directory (Azure AD) to authenticate users who connect to an Analysis Services server.</span></span> <span data-ttu-id="7de30-282">Você pode restringir quais dados um usuário específico é capaz de exibir criando funções e atribuindo os usuários ou grupos do Azure AD a essas funções.</span><span class="sxs-lookup"><span data-stu-id="7de30-282">You can restrict what data a particular user is able to view, by creating roles and then assigning Azure AD users or groups to those roles.</span></span> <span data-ttu-id="7de30-283">Para cada função, você pode:</span><span class="sxs-lookup"><span data-stu-id="7de30-283">For each role, you can:</span></span> 

- <span data-ttu-id="7de30-284">Proteger tabelas ou colunas individualmente.</span><span class="sxs-lookup"><span data-stu-id="7de30-284">Protect tables or individual columns.</span></span> 
- <span data-ttu-id="7de30-285">Proteger linhas individualmente com base em expressões de filtro.</span><span class="sxs-lookup"><span data-stu-id="7de30-285">Protect individual rows based on filter expressions.</span></span> 

<span data-ttu-id="7de30-286">Para saber mais, confira [Gerenciar usuários e funções de banco de dados](/azure/analysis-services/analysis-services-database-users).</span><span class="sxs-lookup"><span data-stu-id="7de30-286">For more information, see [Manage database roles and users](/azure/analysis-services/analysis-services-database-users).</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="7de30-287">Implantar a solução</span><span class="sxs-lookup"><span data-stu-id="7de30-287">Deploy the solution</span></span>

<span data-ttu-id="7de30-288">Uma implantação para essa arquitetura de referência está disponível no [GitHub][ref-arch-repo-folder].</span><span class="sxs-lookup"><span data-stu-id="7de30-288">A deployment for this reference architecture is available on [GitHub][ref-arch-repo-folder].</span></span> <span data-ttu-id="7de30-289">Ela implanta o seguinte:</span><span class="sxs-lookup"><span data-stu-id="7de30-289">It deploys the following:</span></span>

  * <span data-ttu-id="7de30-290">Uma VM Windows para simular um servidor de banco de dados local.</span><span class="sxs-lookup"><span data-stu-id="7de30-290">A Windows VM to simulate an on-premises database server.</span></span> <span data-ttu-id="7de30-291">Ela inclui o SQL Server 2017 e ferramentas relacionadas, juntamente com o Power BI Desktop.</span><span class="sxs-lookup"><span data-stu-id="7de30-291">It includes SQL Server 2017 and related tools, along with Power BI Desktop.</span></span>
  * <span data-ttu-id="7de30-292">Uma conta de armazenamento do Azure que fornece armazenamento de blobs para armazenar os dados exportados do banco de dados SQL Server.</span><span class="sxs-lookup"><span data-stu-id="7de30-292">An Azure storage account that provides Blob storage to hold data exported from the SQL Server database.</span></span>
  * <span data-ttu-id="7de30-293">Uma instância do SQL Data Warehouse do Azure.</span><span class="sxs-lookup"><span data-stu-id="7de30-293">An Azure SQL Data Warehouse instance.</span></span>
  * <span data-ttu-id="7de30-294">Uma instância do Azure Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="7de30-294">An Azure Analysis Services instance.</span></span>

### <a name="prerequisites"></a><span data-ttu-id="7de30-295">pré-requisitos</span><span class="sxs-lookup"><span data-stu-id="7de30-295">Prerequisites</span></span>

1. <span data-ttu-id="7de30-296">Clone, crie fork ou baixe o arquivo zip para as [arquiteturas de referência  do Azure][ref-arch-repo] no repositório GitHub.</span><span class="sxs-lookup"><span data-stu-id="7de30-296">Clone, fork, or download the zip file for the [Azure reference architectures][ref-arch-repo] GitHub repository.</span></span>

2. <span data-ttu-id="7de30-297">Instale os [Blocos de Construção do Azure][azbb-wiki] (azbb).</span><span class="sxs-lookup"><span data-stu-id="7de30-297">Install the [Azure Building Blocks][azbb-wiki] (azbb).</span></span>

3. <span data-ttu-id="7de30-298">Em um prompt de comando, prompt do bash ou prompt do PowerShell, faça logon na sua conta do Azure usando o comando abaixo e siga as instruções.</span><span class="sxs-lookup"><span data-stu-id="7de30-298">From a command prompt, bash prompt, or PowerShell prompt, login to your Azure account by using the command below and following the instructions.</span></span>

  ```bash
  az login  
  ```

### <a name="deploy-the-simulated-on-premises-server"></a><span data-ttu-id="7de30-299">Implantar o servidor local simulado</span><span class="sxs-lookup"><span data-stu-id="7de30-299">Deploy the simulated on-premises server</span></span>

<span data-ttu-id="7de30-300">Primeiro, você implantará uma VM como um servidor local simulado, que inclui o SQL Server 2017 e as ferramentas relacionadas.</span><span class="sxs-lookup"><span data-stu-id="7de30-300">First you'll deploy a VM as a simulated on-premises server, which includes SQL Server 2017 and related tools.</span></span> <span data-ttu-id="7de30-301">Essa etapa também carrega o exemplo de [banco de dados OLTP da Wide World Importers](/sql/sample/world-wide-importers/wide-world-importers-oltp-database) no SQL Server.</span><span class="sxs-lookup"><span data-stu-id="7de30-301">This step also loads the sample [Wide World Importers OLTP database](/sql/sample/world-wide-importers/wide-world-importers-oltp-database) into SQL Server.</span></span>

1. <span data-ttu-id="7de30-302">Navegue até a pasta `data\enterprise-bi-sqldw\onprem\templates` do repositório que você baixou nos pré-requisitos acima.</span><span class="sxs-lookup"><span data-stu-id="7de30-302">Navigate to the `data\enterprise-bi-sqldw\onprem\templates` folder of the repository you downloaded in the prerequisites above.</span></span>

2. <span data-ttu-id="7de30-303">No arquivo `onprem.parameters.json`, substitua os valores de `adminUsername` e `adminPassword`.</span><span class="sxs-lookup"><span data-stu-id="7de30-303">In the `onprem.parameters.json` file, replace the values for `adminUsername` and `adminPassword`.</span></span> <span data-ttu-id="7de30-304">Altere também os valores da seção `SqlUserCredentials` para corresponder ao nome de usuário e à senha.</span><span class="sxs-lookup"><span data-stu-id="7de30-304">Also change the values in the `SqlUserCredentials` section to match the user name and password.</span></span> <span data-ttu-id="7de30-305">Observe o prefixo `.\\` na propriedade userName.</span><span class="sxs-lookup"><span data-stu-id="7de30-305">Note the `.\\` prefix in the userName property.</span></span>
    
    ```bash
    "SqlUserCredentials": {
      "userName": ".\\username",
      "password": "password"
    }
    ```

3. <span data-ttu-id="7de30-306">Execute `azbb` conforme mostrado a seguir para implantar o servidor local.</span><span class="sxs-lookup"><span data-stu-id="7de30-306">Run `azbb` as shown below to deploy the on-premises server.</span></span>

    ```bash
    azbb -s <subscription_id> -g <resource_group_name> -l <location> -p onprem.parameters.json --deploy
    ```

4. <span data-ttu-id="7de30-307">A implantação pode levar 20 a 30 minutos para ser concluída, o que inclui a execução do script [DSC](/powershell/dsc/overview) para instalar as ferramentas e restaurar o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="7de30-307">The deployment may take 20 to 30 minutes to complete, which includes running the [DSC](/powershell/dsc/overview) script to install the tools and restore the database.</span></span> <span data-ttu-id="7de30-308">Verifique a implantação no portal do Azure revendo os recursos no grupo de recursos.</span><span class="sxs-lookup"><span data-stu-id="7de30-308">Verify the deployment in the Azure portal by reviewing the resources in the resource group.</span></span> <span data-ttu-id="7de30-309">Você deve ver a máquina virtual `sql-vm1` e seus recursos associados.</span><span class="sxs-lookup"><span data-stu-id="7de30-309">You should see the `sql-vm1` virtual machine and its associated resources.</span></span>

### <a name="deploy-the-azure-resources"></a><span data-ttu-id="7de30-310">Implantar os recursos do Azure</span><span class="sxs-lookup"><span data-stu-id="7de30-310">Deploy the Azure resources</span></span>

<span data-ttu-id="7de30-311">Esta etapa provisiona o SQL Data Warehouse do Azure o Azure Analysis Services, junto com uma conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="7de30-311">This step provisions Azure SQL Data Warehouse and Azure Analysis Services, along with a Storage account.</span></span> <span data-ttu-id="7de30-312">Se desejar, você pode executar esta etapa em paralelo com a etapa anterior.</span><span class="sxs-lookup"><span data-stu-id="7de30-312">If you want, you can run this step in parallel with the previous step.</span></span>

1. <span data-ttu-id="7de30-313">Navegue até a pasta `data\enterprise-bi-sqldw\azure\templates` do repositório que você baixou nos pré-requisitos acima.</span><span class="sxs-lookup"><span data-stu-id="7de30-313">Navigate to the `data\enterprise-bi-sqldw\azure\templates` folder of the repository you downloaded in the prerequisites above.</span></span>

2. <span data-ttu-id="7de30-314">Execute o comando da CLI do Azure a seguir para criar um grupo de recursos, substituindo os parâmetros entre colchetes especificados.</span><span class="sxs-lookup"><span data-stu-id="7de30-314">Run the following Azure CLI command to create a resource group, replacing the bracketed parameters specified.</span></span> <span data-ttu-id="7de30-315">Observe que você pode implantar em um grupo de recursos diferente do usado para o servidor local na etapa anterior.</span><span class="sxs-lookup"><span data-stu-id="7de30-315">Note that you can deploy to a different resource group than you used for the on-premises server in the previous step.</span></span> 

    ```bash
    az group create --name <resource_group_name> --location <location>  
    ```

3. <span data-ttu-id="7de30-316">Execute o comando da CLI do Azure a seguir para implantar os recursos do Azure, substituindo os parâmetros entre colchetes especificados.</span><span class="sxs-lookup"><span data-stu-id="7de30-316">Run the following Azure CLI command to deploy the Azure resources, replacing the bracketed parameters specified.</span></span> <span data-ttu-id="7de30-317">O parâmetro `storageAccountName` deve seguir as [regras de nomenclatura](../../best-practices/naming-conventions.md#naming-rules-and-restrictions) de contas de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="7de30-317">The `storageAccountName` parameter must follow the [naming rules](../../best-practices/naming-conventions.md#naming-rules-and-restrictions) for Storage accounts.</span></span> <span data-ttu-id="7de30-318">Para o parâmetro `analysisServerAdmin`, use seu nome UPN do Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="7de30-318">For the `analysisServerAdmin` parameter, use your Azure Active Directory user principal name (UPN).</span></span>

    ```bash
    az group deployment create --resource-group <resource_group_name> --template-file azure-resources-deploy.json --parameters "dwServerName"="<server_name>" "dwAdminLogin"="<admin_username>" "dwAdminPassword"="<password>" "storageAccountName"="<storage_account_name>" "analysisServerName"="<analysis_server_name>" "analysisServerAdmin"="user@contoso.com"
    ```

4. <span data-ttu-id="7de30-319">Verifique a implantação no portal do Azure revendo os recursos no grupo de recursos.</span><span class="sxs-lookup"><span data-stu-id="7de30-319">Verify the deployment in the Azure portal by reviewing the resources in the resource group.</span></span> <span data-ttu-id="7de30-320">Você verá uma conta de armazenamento, a instância do SQL Data Warehouse do Azure e a instância do Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="7de30-320">You should see a storage account, Azure SQL Data Warehouse instance, and Analysis Services instance.</span></span>

5. <span data-ttu-id="7de30-321">Use o portal do Azure para obter a chave de acesso da conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="7de30-321">Use the Azure portal to get the access key for the storage account.</span></span> <span data-ttu-id="7de30-322">Selecione a conta de armazenamento para abrir.</span><span class="sxs-lookup"><span data-stu-id="7de30-322">Select the storage account to open it.</span></span> <span data-ttu-id="7de30-323">Em **Configurações**, selecione **Chaves de acesso**.</span><span class="sxs-lookup"><span data-stu-id="7de30-323">Under **Settings**, select **Access keys**.</span></span> <span data-ttu-id="7de30-324">Copie o valor da chave primária.</span><span class="sxs-lookup"><span data-stu-id="7de30-324">Copy the primary key value.</span></span> <span data-ttu-id="7de30-325">Você o usará na próxima seção.</span><span class="sxs-lookup"><span data-stu-id="7de30-325">You will use it in the next step.</span></span>

### <a name="export-the-source-data-to-azure-blob-storage"></a><span data-ttu-id="7de30-326">Exportar os dados de origem para o Armazenamento de Blobs do Azure</span><span class="sxs-lookup"><span data-stu-id="7de30-326">Export the source data to Azure Blob storage</span></span> 

<span data-ttu-id="7de30-327">Nesta etapa, você executará um script do PowerShell que usa o bcp para exportar o banco de dados SQL para arquivos simples na máquina virtual e, em seguida, usará o AzCopy para copiar os arquivos no Armazenamento de Blobs do Azure.</span><span class="sxs-lookup"><span data-stu-id="7de30-327">In this step, you will run a PowerShell script that uses bcp to export the SQL database to flat files on the VM, and then uses AzCopy to copy those files into Azure Blob Storage.</span></span>

1. <span data-ttu-id="7de30-328">Use a Área de Trabalho Remota para se conectar à VM local simulada.</span><span class="sxs-lookup"><span data-stu-id="7de30-328">Use Remote Desktop to connect to the simulated on-premises VM.</span></span>

2. <span data-ttu-id="7de30-329">Enquanto estiver conectado à VM, execute os comandos a seguir em uma janela do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="7de30-329">While logged into the VM, run the following commands from a PowerShell window.</span></span>  

    ```powershell
    cd 'C:\SampleDataFiles\reference-architectures\data\enterprise_bi_sqldw\onprem'

    .\Load_SourceData_To_Blob.ps1 -File .\sql_scripts\db_objects.txt -Destination 'https://<storage_account_name>.blob.core.windows.net/wwi' -StorageAccountKey '<storage_account_key>'
    ```

    <span data-ttu-id="7de30-330">Para o parâmetro `Destination`, substitua `<storage_account_name>` pelo nome da conta de armazenamento criada anteriormente.</span><span class="sxs-lookup"><span data-stu-id="7de30-330">For the `Destination` parameter, replace `<storage_account_name>` with the name the Storage account that you created previously.</span></span> <span data-ttu-id="7de30-331">Para o parâmetro `StorageAccountKey`, use a chave de acesso para essa conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="7de30-331">For the `StorageAccountKey` parameter, use the access key for that Storage account.</span></span>

3. <span data-ttu-id="7de30-332">No portal do Azure, verifique se a fonte de dados foi copiada para o armazenamento de blobs navegando para a conta de armazenamento, selecionando o serviço Blob e abrindo o contêiner `wwi`.</span><span class="sxs-lookup"><span data-stu-id="7de30-332">In the Azure portal, verify that the source data was copied to Blob storage by navigating to the storage account, selecting the Blob service, and opening the `wwi` container.</span></span> <span data-ttu-id="7de30-333">Você deve ver uma lista de tabelas precedida de `WorldWideImporters_Application_*`.</span><span class="sxs-lookup"><span data-stu-id="7de30-333">You should see a list of tables prefaced with `WorldWideImporters_Application_*`.</span></span>

### <a name="execute-the-data-warehouse-scripts"></a><span data-ttu-id="7de30-334">Executar os scripts de data warehouse</span><span class="sxs-lookup"><span data-stu-id="7de30-334">Execute the data warehouse scripts</span></span>

1. <span data-ttu-id="7de30-335">Inicie o SSMS (SQL Server Management Studio) da sua sessão da Área de Trabalho Remota.</span><span class="sxs-lookup"><span data-stu-id="7de30-335">From your Remote Desktop session, launch SQL Server Management Studio (SSMS).</span></span> 

2. <span data-ttu-id="7de30-336">Conectar ao SQL Data Warehouse</span><span class="sxs-lookup"><span data-stu-id="7de30-336">Connect to SQL Data Warehouse</span></span>

    - <span data-ttu-id="7de30-337">Tipo de servidor: mecanismo de banco de dados</span><span class="sxs-lookup"><span data-stu-id="7de30-337">Server type: Database Engine</span></span>
    
    - <span data-ttu-id="7de30-338">Nome do servidor: `<dwServerName>.database.windows.net`, em que `<dwServerName>` é o nome que você especificou quando implantou os recursos do Azure.</span><span class="sxs-lookup"><span data-stu-id="7de30-338">Server name: `<dwServerName>.database.windows.net`, where `<dwServerName>` is the name that you specified when you deployed the Azure resources.</span></span> <span data-ttu-id="7de30-339">Você pode obter esse nome no Portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="7de30-339">You can get this name from the Azure portal.</span></span>
    
    - <span data-ttu-id="7de30-340">Autenticação: autenticação do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="7de30-340">Authentication: SQL Server Authentication.</span></span> <span data-ttu-id="7de30-341">Use as credenciais que você especificou quando implantou os recursos do Azure nos parâmetros `dwAdminLogin` e `dwAdminPassword`.</span><span class="sxs-lookup"><span data-stu-id="7de30-341">Use the credentials that you specified when you deployed the Azure resources, in the `dwAdminLogin` and `dwAdminPassword` parameters.</span></span>

2. <span data-ttu-id="7de30-342">Navegue até a pasta `C:\SampleDataFiles\reference-architectures\data\enterprise_bi_sqldw\azure\sqldw_scripts` na VM.</span><span class="sxs-lookup"><span data-stu-id="7de30-342">Navigate to the `C:\SampleDataFiles\reference-architectures\data\enterprise_bi_sqldw\azure\sqldw_scripts` folder on the VM.</span></span> <span data-ttu-id="7de30-343">Execute os scripts nesta pasta em ordem numérica, da `STEP_1` à `STEP_7`.</span><span class="sxs-lookup"><span data-stu-id="7de30-343">You will execute the scripts in this folder in numerical order, `STEP_1` through `STEP_7`.</span></span>

3. <span data-ttu-id="7de30-344">Selecione o banco de dados `master` no SSMS e abra o script `STEP_1`.</span><span class="sxs-lookup"><span data-stu-id="7de30-344">Select the `master` database in SSMS and open the `STEP_1` script.</span></span> <span data-ttu-id="7de30-345">Altere o valor da senha na linha a seguir e execute o script.</span><span class="sxs-lookup"><span data-stu-id="7de30-345">Change the value of the password in the following line, then execute the script.</span></span>

    ```sql
    CREATE LOGIN LoaderRC20 WITH PASSWORD = '<change this value>';
    ```

4. <span data-ttu-id="7de30-346">Selecione o banco de dados `wwi` no SSMS.</span><span class="sxs-lookup"><span data-stu-id="7de30-346">Select the `wwi` database in SSMS.</span></span> <span data-ttu-id="7de30-347">Abra o script `STEP_2` e execute-o.</span><span class="sxs-lookup"><span data-stu-id="7de30-347">Open the `STEP_2` script and execute the script.</span></span> <span data-ttu-id="7de30-348">Se você receber um erro, verifique se está executando o script em relação ao banco de dados `wwi` e não ao `master`.</span><span class="sxs-lookup"><span data-stu-id="7de30-348">If you get an error, make sure you are running the script against the `wwi` database and not `master`.</span></span>

5. <span data-ttu-id="7de30-349">Abra uma nova conexão com o SQL Data Warehouse usando o usuário e a senha `LoaderRC20` indicados no script `STEP_1`.</span><span class="sxs-lookup"><span data-stu-id="7de30-349">Open a new connection to SQL Data Warehouse, using the `LoaderRC20` user and the password indicated in the `STEP_1` script.</span></span>

6. <span data-ttu-id="7de30-350">Usando essa conexão, abra o script `STEP_3`.</span><span class="sxs-lookup"><span data-stu-id="7de30-350">Using this connection, open the `STEP_3` script.</span></span> <span data-ttu-id="7de30-351">Defina os seguintes valores no script:</span><span class="sxs-lookup"><span data-stu-id="7de30-351">Set the following values in the script:</span></span>

    - <span data-ttu-id="7de30-352">SECRET: use a chave de acesso da sua conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="7de30-352">SECRET: Use the access key for your storage account.</span></span>
    - <span data-ttu-id="7de30-353">LOCATION: use o nome da conta de armazenamento da seguinte maneira: `wasbs://wwi@<storage_account_name>.blob.core.windows.net`.</span><span class="sxs-lookup"><span data-stu-id="7de30-353">LOCATION: Use the name of the storage account as follows: `wasbs://wwi@<storage_account_name>.blob.core.windows.net`.</span></span>

7. <span data-ttu-id="7de30-354">Usando a mesma conexão, execute os scripts `STEP_4` a `STEP_7` sequencialmente.</span><span class="sxs-lookup"><span data-stu-id="7de30-354">Using the same connection, execute scripts `STEP_4` through `STEP_7` sequentially.</span></span> <span data-ttu-id="7de30-355">Verifique se cada script foi concluído com êxito antes de executar o seguinte.</span><span class="sxs-lookup"><span data-stu-id="7de30-355">Verify that each script completes successfully before running the next.</span></span>

<span data-ttu-id="7de30-356">No SMSS, você deve ver um conjunto de tabelas `prd.*` no banco de dados `wwi`.</span><span class="sxs-lookup"><span data-stu-id="7de30-356">In SMSS, you should see a set of `prd.*` tables in the `wwi` database.</span></span> <span data-ttu-id="7de30-357">Para verificar se os dados foram gerados, execute a seguinte consulta:</span><span class="sxs-lookup"><span data-stu-id="7de30-357">To verify that the data was generated, run the following query:</span></span> 

```sql
SELECT TOP 10 * FROM prd.CityDimensions
```

### <a name="build-the-azure-analysis-services-model"></a><span data-ttu-id="7de30-358">Criar o modelo do Azure Analysis Services</span><span class="sxs-lookup"><span data-stu-id="7de30-358">Build the Azure Analysis Services model</span></span>

<span data-ttu-id="7de30-359">Nesta etapa, você criará um modelo tabular que importa dados do data warehouse.</span><span class="sxs-lookup"><span data-stu-id="7de30-359">In this step, you will create a tabular model that imports data from the data warehouse.</span></span> <span data-ttu-id="7de30-360">Em seguida, você implantará o modelo no Azure Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="7de30-360">Then you will deploy the model to Azure Analysis Services.</span></span>

1. <span data-ttu-id="7de30-361">Inicie o SQL Server Data Tools 2015 na sua sessão da Área de Trabalho Remota.</span><span class="sxs-lookup"><span data-stu-id="7de30-361">From your Remote Desktop session, launch SQL Server Data Tools 2015.</span></span>

2. <span data-ttu-id="7de30-362">Selecione **Arquivo** > **Novo** > **Projeto**.</span><span class="sxs-lookup"><span data-stu-id="7de30-362">Select **File** > **New** > **Project**.</span></span>

3. <span data-ttu-id="7de30-363">No diálogo **Novo Projeto**, em **Modelos**, selecione **Business Intelligence** > **Analysis Services**  >  **Projeto Tabular do Analysis Services**.</span><span class="sxs-lookup"><span data-stu-id="7de30-363">In the **New Project** dialog, under **Templates**, select  **Business Intelligence** > **Analysis Services** > **Analysis Services Tabular Project**.</span></span> 

4. <span data-ttu-id="7de30-364">Nomeie o projeto e clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="7de30-364">Name the project and click **OK**.</span></span>

5. <span data-ttu-id="7de30-365">No diálogo **Designer de modelo tabular**, selecione **Espaço de trabalho integrado** e defina o **Nível de compatibilidade** como `SQL Server 2017 / Azure Analysis Services (1400)`.</span><span class="sxs-lookup"><span data-stu-id="7de30-365">In the **Tabular model designer** dialog, select **Integrated workspace**  and set **Compatibility level** to `SQL Server 2017 / Azure Analysis Services (1400)`.</span></span> <span data-ttu-id="7de30-366">Clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="7de30-366">Click **OK**.</span></span>

6. <span data-ttu-id="7de30-367">Na janela **Gerenciador de Modelos Tabulares** janela, clique com o botão direito do mouse e selecione **Importar da Fonte de Dados**.</span><span class="sxs-lookup"><span data-stu-id="7de30-367">In the **Tabular Model Explorer** window, right-click the project and select **Import from Data Source**.</span></span>

7. <span data-ttu-id="7de30-368">Selecione **SQL Data Warehouse do Azure** e clique em **Conectar**.</span><span class="sxs-lookup"><span data-stu-id="7de30-368">Select **Azure SQL Data Warehouse** and click **Connect**.</span></span>

8. <span data-ttu-id="7de30-369">Para **Servidor**, digite o nome totalmente qualificado do seu servidor do SQL Data Warehouse do Azure.</span><span class="sxs-lookup"><span data-stu-id="7de30-369">For **Server**, enter the fully qualified name of your Azure SQL Data Warehouse server.</span></span> <span data-ttu-id="7de30-370">Para **Banco de Dados**, digite `wwi`.</span><span class="sxs-lookup"><span data-stu-id="7de30-370">For **Database**, enter `wwi`.</span></span> <span data-ttu-id="7de30-371">Clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="7de30-371">Click **OK**.</span></span>

9. <span data-ttu-id="7de30-372">No próximo diálogo, escolha a autenticação de **Banco de Dados**, insira seu nome de usuário e senha do SQL Data Warehouse do Azure e clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="7de30-372">In the next dialog, choose **Database** authentication and enter your Azure SQL Data Warehouse user name and password, and click **OK**.</span></span>

10. <span data-ttu-id="7de30-373">No diálogo **Navegador**, marque as caixas de seleção **prd. CityDimensions**, **prd. DateDimensions** e **prd. SalesFact**.</span><span class="sxs-lookup"><span data-stu-id="7de30-373">In the **Navigator** dialog, select the checkboxes for **prd.CityDimensions**, **prd.DateDimensions**, and **prd.SalesFact**.</span></span> 

    ![](./images/analysis-services-import.png)

11. <span data-ttu-id="7de30-374">Clique em **Carregar**.</span><span class="sxs-lookup"><span data-stu-id="7de30-374">Click **Load**.</span></span> <span data-ttu-id="7de30-375">Quando o processamento for concluído, clique em **Fechar**.</span><span class="sxs-lookup"><span data-stu-id="7de30-375">When processing is complete, click **Close**.</span></span> <span data-ttu-id="7de30-376">Agora você deve ver uma exibição tabular dos dados.</span><span class="sxs-lookup"><span data-stu-id="7de30-376">You should now see a tabular view of the data.</span></span>

12. <span data-ttu-id="7de30-377">Na janela **Gerenciador de Modelos Tabulares**, clique com o botão direito do mouse e selecione **Exibição do Modelo** > **Exibição de Diagrama**.</span><span class="sxs-lookup"><span data-stu-id="7de30-377">In the **Tabular Model Explorer** window, right-click the project and select **Model View** > **Diagram View**.</span></span>

13. <span data-ttu-id="7de30-378">Arraste o campo **[prd.SalesFact].[WWI City ID]**  para o campo **[prd.CityDimensions].[WWI City ID]**  a fim de criar uma relação.</span><span class="sxs-lookup"><span data-stu-id="7de30-378">Drag the **[prd.SalesFact].[WWI City ID]** field to the **[prd.CityDimensions].[WWI City ID]** field to create a relationship.</span></span>  

14. <span data-ttu-id="7de30-379">Arraste o campo **[prd.SalesFact].[Invoice Date Key]** para o campo **[prd.DateDimensions].[Date]** .</span><span class="sxs-lookup"><span data-stu-id="7de30-379">Drag the **[prd.SalesFact].[Invoice Date Key]** field to the **[prd.DateDimensions].[Date]** field.</span></span>  
    ![](./images/analysis-services-relations.png)

15. <span data-ttu-id="7de30-380">No menu **Arquivo**, escolha **Salvar Tudo**.</span><span class="sxs-lookup"><span data-stu-id="7de30-380">From the **File** menu, choose **Save All**.</span></span>  

16. <span data-ttu-id="7de30-381">No **Gerenciador de Soluções**, clique com o botão direito do mouse no projeto e selecione **Propriedades**.</span><span class="sxs-lookup"><span data-stu-id="7de30-381">In **Solution Explorer**, right-click the project and select **Properties**.</span></span> 

17. <span data-ttu-id="7de30-382">Em **Server**, insira a URL da sua instância do Azure Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="7de30-382">Under **Server**, enter the URL of your Azure Analysis Services instance.</span></span> <span data-ttu-id="7de30-383">Você pode obter esse valor no Portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="7de30-383">You can get this value from the Azure Portal.</span></span> <span data-ttu-id="7de30-384">No portal, selecione o recurso Analysis Services, clique no painel Visão geral e procure a propriedade **Nome do Servidor**.</span><span class="sxs-lookup"><span data-stu-id="7de30-384">In the portal, select the Analysis Services resource, click the Overview pane, and look for the **Server Name** property.</span></span> <span data-ttu-id="7de30-385">Ele será semelhante a `asazure://westus.asazure.windows.net/contoso`.</span><span class="sxs-lookup"><span data-stu-id="7de30-385">It will be similar to `asazure://westus.asazure.windows.net/contoso`.</span></span> <span data-ttu-id="7de30-386">Clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="7de30-386">Click **OK**.</span></span>

    ![](./images/analysis-services-properties.png)

18. <span data-ttu-id="7de30-387">No **Gerenciador de Soluções**, clique com o botão direito do mouse no nome do projeto e selecione **Implantar**.</span><span class="sxs-lookup"><span data-stu-id="7de30-387">In **Solution Explorer**, right-click the project and select **Deploy**.</span></span> <span data-ttu-id="7de30-388">Entre no Azure, se solicitado.</span><span class="sxs-lookup"><span data-stu-id="7de30-388">Sign into Azure if prompted.</span></span> <span data-ttu-id="7de30-389">Quando o processamento for concluído, clique em **Fechar**.</span><span class="sxs-lookup"><span data-stu-id="7de30-389">When processing is complete, click **Close**.</span></span>

19. <span data-ttu-id="7de30-390">No portal do Azure, exiba os detalhes da sua instância do Azure Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="7de30-390">In the Azure portal, view the details for your Azure Analysis Services instance.</span></span> <span data-ttu-id="7de30-391">Verifique se seu modelo aparece na lista de modelos.</span><span class="sxs-lookup"><span data-stu-id="7de30-391">Verify that your model appears in the list of models.</span></span>

    ![](./images/analysis-services-models.png)

### <a name="analyze-the-data-in-power-bi-desktop"></a><span data-ttu-id="7de30-392">Analisar os dados no Power BI Desktop</span><span class="sxs-lookup"><span data-stu-id="7de30-392">Analyze the data in Power BI Desktop</span></span>

<span data-ttu-id="7de30-393">Nesta etapa, você usará o Power BI para criar um relatório com os dados no Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="7de30-393">In this step, you will use Power BI to create a report from the data in Analysis Services.</span></span>

1. <span data-ttu-id="7de30-394">Inicie o Power BI Desktop na sua sessão de Área de Trabalho Remota.</span><span class="sxs-lookup"><span data-stu-id="7de30-394">From your Remote Desktop session, launch Power BI Desktop.</span></span>

2. <span data-ttu-id="7de30-395">Na tela de boas-vindas, clique em **Obter Dados**.</span><span class="sxs-lookup"><span data-stu-id="7de30-395">In the Welcome Scren, click **Get Data**.</span></span>

3. <span data-ttu-id="7de30-396">Selecione **Azure** > **Banco de dados do Azure Analysis Services**.</span><span class="sxs-lookup"><span data-stu-id="7de30-396">Select **Azure** > **Azure Analysis Services database**.</span></span> <span data-ttu-id="7de30-397">Clique em **Conectar**</span><span class="sxs-lookup"><span data-stu-id="7de30-397">Click **Connect**</span></span>

    ![](./images/power-bi-get-data.png)

4. <span data-ttu-id="7de30-398">Insira a URL da instância do Analysis Services e clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="7de30-398">Enter the URL of your Analysis Services instance, then click **OK**.</span></span> <span data-ttu-id="7de30-399">Entre no Azure, se solicitado.</span><span class="sxs-lookup"><span data-stu-id="7de30-399">Sign into Azure if prompted.</span></span>

5. <span data-ttu-id="7de30-400">No diálogo **Navegador**, expanda o projeto tabular implantado, selecione o modelo que você criou e clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="7de30-400">In the **Navigator** dialog, expand the tabular project that you deployed, select the model that you created, and click **OK**.</span></span>

2. <span data-ttu-id="7de30-401">No painel **Visualizações**, selecione o ícone **Gráfico de Barras Empilhadas**.</span><span class="sxs-lookup"><span data-stu-id="7de30-401">In the **Visualizations** pane, select the **Stacked Bar Chart** icon.</span></span> <span data-ttu-id="7de30-402">No modo de exibição Relatório, redimensione a visualização para aumentá-la.</span><span class="sxs-lookup"><span data-stu-id="7de30-402">In the Report view, resize the visualization to make it larger.</span></span>

6. <span data-ttu-id="7de30-403">No painel **Campos**, expanda **prd.CityDimensions**.</span><span class="sxs-lookup"><span data-stu-id="7de30-403">In the **Fields** pane, expand **prd.CityDimensions**.</span></span>

7. <span data-ttu-id="7de30-404">Arraste **prd.CityDimensions** > **WWI City ID** para o **poço Eixo**.</span><span class="sxs-lookup"><span data-stu-id="7de30-404">Drag **prd.CityDimensions** > **WWI City ID** to the **Axis well**.</span></span>

8. <span data-ttu-id="7de30-405">Arraste **prd.CityDimensions** > **City** para o poço **Legenda**.</span><span class="sxs-lookup"><span data-stu-id="7de30-405">Drag **prd.CityDimensions** > **City** to the **Legend** well.</span></span>

9. <span data-ttu-id="7de30-406">No painel Campos, expanda **prd.SalesFact**.</span><span class="sxs-lookup"><span data-stu-id="7de30-406">In the Fields pane, expand **prd.SalesFact**.</span></span>

10. <span data-ttu-id="7de30-407">Arraste **prd.SalesFact** > **Total com Dedução de Imposto** para o poço **Valor**.</span><span class="sxs-lookup"><span data-stu-id="7de30-407">Drag **prd.SalesFact** > **Total Excluding Tax** to the **Value** well.</span></span>

    ![](./images/power-bi-visualization.png)

11. <span data-ttu-id="7de30-408">Em **Filtros no Nível Visual**, selecione **WWI City ID**.</span><span class="sxs-lookup"><span data-stu-id="7de30-408">Under **Visual Level Filters**, select **WWI City ID**.</span></span>

12. <span data-ttu-id="7de30-409">Defina o **Tipo de Filtro** como `Top N`e defina **Mostrar Itens** como `Top 10`.</span><span class="sxs-lookup"><span data-stu-id="7de30-409">Set the **Filter Type** to `Top N`, and set **Show Items** to `Top 10`.</span></span>

13. <span data-ttu-id="7de30-410">Arraste **prd.SalesFact** > **Total com Dedução de Imposto** para o poço **Por Valor**</span><span class="sxs-lookup"><span data-stu-id="7de30-410">Drag **prd.SalesFact** > **Total Excluding Tax** to the **By Value** well</span></span>

    ![](./images/power-bi-visualization2.png)

14. <span data-ttu-id="7de30-411">Clique em **Aplicar Filtro**.</span><span class="sxs-lookup"><span data-stu-id="7de30-411">Click **Apply Filter**.</span></span> <span data-ttu-id="7de30-412">A visualização mostra os dez principais totais de vendas por cidade.</span><span class="sxs-lookup"><span data-stu-id="7de30-412">The visualization shows the top 10 total sales by city.</span></span>

    ![](./images/power-bi-report.png)

<span data-ttu-id="7de30-413">Para saber mais sobre como usar o Power BI Desktop, confira [Introdução ao Power BI Desktop](/power-bi/desktop-getting-started).</span><span class="sxs-lookup"><span data-stu-id="7de30-413">To learn more about Power BI Desktop, see [Getting started with Power BI Desktop](/power-bi/desktop-getting-started).</span></span>

## <a name="next-steps"></a><span data-ttu-id="7de30-414">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="7de30-414">Next steps</span></span>

- <span data-ttu-id="7de30-415">Para saber mais sobre como implantar essa arquitetura de referência, visite nosso [Repositório GitHub][ref-arch-repo-folder].</span><span class="sxs-lookup"><span data-stu-id="7de30-415">For more information about this reference architecture, visit our [GitHub repository][ref-arch-repo-folder].</span></span>
- <span data-ttu-id="7de30-416">Saiba mais sobre os [Blocos de Construção do Azure][azbb-repo].</span><span class="sxs-lookup"><span data-stu-id="7de30-416">Learn about the [Azure Building Blocks][azbb-repo].</span></span>

<!-- links -->

[azure-cli-2]: /azure/install-azure-cli
[azbb-repo]: https://github.com/mspnp/template-building-blocks
[azbb-wiki]: https://github.com/mspnp/template-building-blocks/wiki/Install-Azure-Building-Blocks
[github-folder]: https://github.com/mspnp/reference-architectures/tree/master/data/enterprise_bi_sqldw
[ref-arch-repo]: https://github.com/mspnp/reference-architectures
[ref-arch-repo-folder]: https://github.com/mspnp/reference-architectures/tree/master/data/enterprise_bi_sqldw

