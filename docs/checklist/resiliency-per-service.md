---
title: Lista de verificação de resiliência para serviços do Azure
titleSuffix: Azure Design Review Framework
description: Lista de verificação que fornece orientação de resiliência para vários serviços do Azure.
author: petertaylor9999
ms.date: 11/26/2018
ms.custom: resiliency, checklist
ms.openlocfilehash: 55f17d3b24af4be4f313c66923f4153296041545
ms.sourcegitcommit: 4ba3304eebaa8c493c3e5307bdd9d723cd90b655
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 12/12/2018
ms.locfileid: "53307173"
---
# <a name="resiliency-checklist-for-specific-azure-services"></a><span data-ttu-id="c09e0-103">Lista de verificação de resiliência para serviços específicos do Azure</span><span class="sxs-lookup"><span data-stu-id="c09e0-103">Resiliency checklist for specific Azure services</span></span>

<span data-ttu-id="c09e0-104">Resiliência é a capacidade de um sistema de se recuperar de falhas e continuar funcionando, além de ser um dos [pilares da qualidade de software](../guide/pillars.md).</span><span class="sxs-lookup"><span data-stu-id="c09e0-104">Resiliency is the ability of a system to recover from failures and continue to function, and is one of the [pillars of software quality](../guide/pillars.md).</span></span> <span data-ttu-id="c09e0-105">Cada tecnologia tem seus próprios modos de falha específicos, o que você deve considerar ao projetar e implementar seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c09e0-105">Every technology has its own particular failure modes, which you must consider when designing and implementing your application.</span></span> <span data-ttu-id="c09e0-106">Use esta lista de verificação para revisar as considerações de resiliência para serviços específicos do Azure.</span><span class="sxs-lookup"><span data-stu-id="c09e0-106">Use this checklist to review the resiliency considerations for specific Azure services.</span></span> <span data-ttu-id="c09e0-107">Revise também a [lista de verificação de resiliência geral](./resiliency.md).</span><span class="sxs-lookup"><span data-stu-id="c09e0-107">Also review the [general resiliency checklist](./resiliency.md).</span></span>

## <a name="app-service"></a><span data-ttu-id="c09e0-108">Serviço de Aplicativo</span><span class="sxs-lookup"><span data-stu-id="c09e0-108">App Service</span></span>

<span data-ttu-id="c09e0-109">**Use a camada Standard ou Premium.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-109">**Use Standard or Premium tier.**</span></span> <span data-ttu-id="c09e0-110">Essas camadas dão suporte a slots de preparo e backups automáticos.</span><span class="sxs-lookup"><span data-stu-id="c09e0-110">These tiers support staging slots and automated backups.</span></span> <span data-ttu-id="c09e0-111">Para obter mais informações, consulte [Visão geral aprofundada de planos do Serviço de Aplicativo do Azure](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/)</span><span class="sxs-lookup"><span data-stu-id="c09e0-111">For more information, see [Azure App Service plans in-depth overview](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/)</span></span>

<span data-ttu-id="c09e0-112">**Evite expandir ou reduzir verticalmente.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-112">**Avoid scaling up or down.**</span></span> <span data-ttu-id="c09e0-113">Em vez disso, selecione uma camada e o tamanho de instância que atendem aos seus requisitos de desempenho sob carga típica e, em seguida, [aumente](/azure/app-service-web/web-sites-scale/) as instâncias para manipular as alterações no volume de tráfego.</span><span class="sxs-lookup"><span data-stu-id="c09e0-113">Instead, select a tier and instance size that meet your performance requirements under typical load, and then [scale out](/azure/app-service-web/web-sites-scale/) the instances to handle changes in traffic volume.</span></span> <span data-ttu-id="c09e0-114">Expandir e reduzir verticalmente pode disparar uma reinicialização do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c09e0-114">Scaling up and down may trigger an application restart.</span></span>

<span data-ttu-id="c09e0-115">**Armazene a configuração como configurações de aplicativo.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-115">**Store configuration as app settings.**</span></span> <span data-ttu-id="c09e0-116">Use as configurações de aplicativo para manter definições de configuração como configurações de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c09e0-116">Use app settings to hold configuration settings as app settings.</span></span> <span data-ttu-id="c09e0-117">Defina as configurações em seus modelos do Resource Manager ou usando o PowerShell, para que você possa aplicá-las como parte de um processo automatizado de implantação/atualização, que é mais confiável.</span><span class="sxs-lookup"><span data-stu-id="c09e0-117">Define the settings in your Resource Manager templates, or using PowerShell, so that you can apply them as part of an automated deployment / update process, which is more reliable.</span></span> <span data-ttu-id="c09e0-118">Para obter mais informações, consulte [Configurar aplicativos Web no Serviço de Aplicativo do Azure](/azure/app-service-web/web-sites-configure/).</span><span class="sxs-lookup"><span data-stu-id="c09e0-118">For more information, see [Configure web apps in Azure App Service](/azure/app-service-web/web-sites-configure/).</span></span>

<span data-ttu-id="c09e0-119">**Crie Planos do Serviço de Aplicativo separados para produção e teste.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-119">**Create separate App Service plans for production and test.**</span></span> <span data-ttu-id="c09e0-120">Não use slots em sua implantação de produção para teste.</span><span class="sxs-lookup"><span data-stu-id="c09e0-120">Don't use slots on your production deployment for testing.</span></span>  <span data-ttu-id="c09e0-121">Todos os aplicativos dentro do mesmo Plano do Serviço de Aplicativo compartilham as mesmas instâncias de VM.</span><span class="sxs-lookup"><span data-stu-id="c09e0-121">All apps within the same App Service plan share the same VM instances.</span></span> <span data-ttu-id="c09e0-122">Se você colocar a produção e implantações de teste no mesmo plano, isso poderá afetar negativamente a implantação de produção.</span><span class="sxs-lookup"><span data-stu-id="c09e0-122">If you put production and test deployments in the same plan, it can negatively affect the production deployment.</span></span> <span data-ttu-id="c09e0-123">Por exemplo, testes de carga podem prejudicar o site de produção dinâmica.</span><span class="sxs-lookup"><span data-stu-id="c09e0-123">For example, load tests might degrade the live production site.</span></span> <span data-ttu-id="c09e0-124">Colocando as implantações de teste em um plano separado, você as isola da versão de produção.</span><span class="sxs-lookup"><span data-stu-id="c09e0-124">By putting test deployments into a separate plan, you isolate them from the production version.</span></span>

<span data-ttu-id="c09e0-125">**Separe aplicativos Web de APIs da Web.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-125">**Separate web apps from web APIs.**</span></span> <span data-ttu-id="c09e0-126">Se sua solução tem um front-end da Web e uma API da Web, considere a possibilidade de decompô-los em aplicativos de Serviço de Aplicativo separados.</span><span class="sxs-lookup"><span data-stu-id="c09e0-126">If your solution has both a web front-end and a web API, consider decomposing them into separate App Service apps.</span></span> <span data-ttu-id="c09e0-127">Esse design torna mais fácil para decompor a solução pela carga de trabalho.</span><span class="sxs-lookup"><span data-stu-id="c09e0-127">This design makes it easier to decompose the solution by workload.</span></span> <span data-ttu-id="c09e0-128">Você pode executar o aplicativo Web e a API em Planos do Serviço de Aplicativo separados, de modo que eles possam ser dimensionados de forma independente.</span><span class="sxs-lookup"><span data-stu-id="c09e0-128">You can run the web app and the API in separate App Service plans, so they can be scaled independently.</span></span> <span data-ttu-id="c09e0-129">Se você não precisar desse nível de escalabilidade inicialmente, poderá implantar os aplicativos no mesmo plano e movê-los para planos separados posteriormente, se necessário.</span><span class="sxs-lookup"><span data-stu-id="c09e0-129">If you don't need that level of scalability at first, you can deploy the apps into the same plan, and move them into separate plans later, if needed.</span></span>

<span data-ttu-id="c09e0-130">**Evite usar o recurso de Serviço de Aplicativo de backup para fazer backup de Bancos de Dados SQL do Azure.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-130">**Avoid using the App Service backup feature to back up Azure SQL databases.**</span></span> <span data-ttu-id="c09e0-131">Em vez disso, use os [Backups automatizados do Banco de Dados SQL][sql-backup].</span><span class="sxs-lookup"><span data-stu-id="c09e0-131">Instead, use [SQL Database automated backups][sql-backup].</span></span> <span data-ttu-id="c09e0-132">O backup do Serviço de Aplicativo exporta o banco de dados para um arquivo .bacpac do SQL, que custa DTUs.</span><span class="sxs-lookup"><span data-stu-id="c09e0-132">App Service backup exports the database to a SQL .bacpac file, which costs DTUs.</span></span>

<span data-ttu-id="c09e0-133">**Implante em um slot de preparo.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-133">**Deploy to a staging slot.**</span></span> <span data-ttu-id="c09e0-134">Crie um slot de implantação para preparo.</span><span class="sxs-lookup"><span data-stu-id="c09e0-134">Create a deployment slot for staging.</span></span> <span data-ttu-id="c09e0-135">Implante atualizações de aplicativo para o slot de preparo e verifique a implantação antes de trocá-la para produção.</span><span class="sxs-lookup"><span data-stu-id="c09e0-135">Deploy application updates to the staging slot, and verify the deployment before swapping it into production.</span></span> <span data-ttu-id="c09e0-136">Isso reduz a chance de uma atualização inválida em produção.</span><span class="sxs-lookup"><span data-stu-id="c09e0-136">This reduces the chance of a bad update in production.</span></span> <span data-ttu-id="c09e0-137">Isso também garante que todas as instâncias sejam aquecidas antes de serem trocadas para produção.</span><span class="sxs-lookup"><span data-stu-id="c09e0-137">It also ensures that all instances are warmed up before being swapped into production.</span></span> <span data-ttu-id="c09e0-138">Muitos aplicativos têm um tempo significativo de aquecimento e de resfriamento.</span><span class="sxs-lookup"><span data-stu-id="c09e0-138">Many applications have a significant warmup and cold-start time.</span></span> <span data-ttu-id="c09e0-139">Para obter mais informações, consulte [Configurar ambientes de preparo para aplicativos Web no Serviço de Aplicativo do Azure](/azure/app-service-web/web-sites-staged-publishing/).</span><span class="sxs-lookup"><span data-stu-id="c09e0-139">For more information, see [Set up staging environments for web apps in Azure App Service](/azure/app-service-web/web-sites-staged-publishing/).</span></span>

<span data-ttu-id="c09e0-140">**Crie um slot de implantação para conter a LKG (última implantação válida).**</span><span class="sxs-lookup"><span data-stu-id="c09e0-140">**Create a deployment slot to hold the last-known-good (LKG) deployment.**</span></span> <span data-ttu-id="c09e0-141">Quando você implanta uma atualização para produção, mova a implantação de produção anterior para o slot da LKG.</span><span class="sxs-lookup"><span data-stu-id="c09e0-141">When you deploy an update to production, move the previous production deployment into the LKG slot.</span></span> <span data-ttu-id="c09e0-142">Isso torna mais fácil reverter uma implantação incorreta.</span><span class="sxs-lookup"><span data-stu-id="c09e0-142">This makes it easier to roll back a bad deployment.</span></span> <span data-ttu-id="c09e0-143">Se você descobrir um problema posteriormente, você poderá reverter rapidamente para a versão LKG.</span><span class="sxs-lookup"><span data-stu-id="c09e0-143">If you discover a problem later, you can quickly revert to the LKG version.</span></span> <span data-ttu-id="c09e0-144">Para obter mais informações, veja [Basic web application](../reference-architectures/app-service-web-app/basic-web-app.md) (Aplicativo Web básico).</span><span class="sxs-lookup"><span data-stu-id="c09e0-144">For more information, see [Basic web application](../reference-architectures/app-service-web-app/basic-web-app.md).</span></span>

<span data-ttu-id="c09e0-145">**Habilite o log de diagnósticos**, incluindo o log de aplicativo e o log do servidor Web.</span><span class="sxs-lookup"><span data-stu-id="c09e0-145">**Enable diagnostics logging**, including application logging and web server logging.</span></span> <span data-ttu-id="c09e0-146">O registro em log é importante para monitoramento e diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="c09e0-146">Logging is important for monitoring and diagnostics.</span></span> <span data-ttu-id="c09e0-147">Consulte [Habilitar o registro de log de diagnóstico para aplicativos Web no Serviço de Aplicativo do Azure](/azure/app-service-web/web-sites-enable-diagnostic-log/)</span><span class="sxs-lookup"><span data-stu-id="c09e0-147">See [Enable diagnostics logging for web apps in Azure App Service](/azure/app-service-web/web-sites-enable-diagnostic-log/)</span></span>

<span data-ttu-id="c09e0-148">**Registre em log para o Armazenamento de Blobs.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-148">**Log to blob storage.**</span></span> <span data-ttu-id="c09e0-149">Isso torna mais fácil coletar e analisar os dados.</span><span class="sxs-lookup"><span data-stu-id="c09e0-149">This makes it easier to collect and analyze the data.</span></span>

<span data-ttu-id="c09e0-150">**Criar uma conta de armazenamento separada para logs.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-150">**Create a separate storage account for logs.**</span></span> <span data-ttu-id="c09e0-151">Não use a mesma conta de armazenamento para logs e dados de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c09e0-151">Don't use the same storage account for logs and application data.</span></span> <span data-ttu-id="c09e0-152">Isso ajuda a impedir o registro em log de reduzir o desempenho do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c09e0-152">This helps to prevent logging from reducing application performance.</span></span>

<span data-ttu-id="c09e0-153">**Monitore o desempenho.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-153">**Monitor performance.**</span></span> <span data-ttu-id="c09e0-154">Use um serviço de monitoramento de desempenho como o [New Relic](https://newrelic.com/) ou o [Application Insights](/azure/application-insights/app-insights-overview/) para monitorar o desempenho e o comportamento do aplicativo sob carga.</span><span class="sxs-lookup"><span data-stu-id="c09e0-154">Use a performance monitoring service such as [New Relic](https://newrelic.com/) or [Application Insights](/azure/application-insights/app-insights-overview/) to monitor application performance and behavior under load.</span></span>  <span data-ttu-id="c09e0-155">O monitoramento de desempenho fornece informações sobre o aplicativo em tempo real.</span><span class="sxs-lookup"><span data-stu-id="c09e0-155">Performance monitoring gives you real-time insight into the application.</span></span> <span data-ttu-id="c09e0-156">Ele permite a você diagnosticar problemas e executar a análise de causa raiz de falhas.</span><span class="sxs-lookup"><span data-stu-id="c09e0-156">It enables you to diagnose issues and perform root-cause analysis of failures.</span></span>

## <a name="application-gateway"></a><span data-ttu-id="c09e0-157">Gateway de Aplicativo</span><span class="sxs-lookup"><span data-stu-id="c09e0-157">Application Gateway</span></span>

<span data-ttu-id="c09e0-158">**Provisione pelo menos duas instâncias.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-158">**Provision at least two instances.**</span></span> <span data-ttu-id="c09e0-159">Implante um Gateway de Aplicativo com pelo menos duas instâncias.</span><span class="sxs-lookup"><span data-stu-id="c09e0-159">Deploy Application Gateway with at least two instances.</span></span> <span data-ttu-id="c09e0-160">Uma única instância é um ponto único de falha.</span><span class="sxs-lookup"><span data-stu-id="c09e0-160">A single instance is a single point of failure.</span></span> <span data-ttu-id="c09e0-161">Use duas ou mais instâncias para redundância e escalabilidade.</span><span class="sxs-lookup"><span data-stu-id="c09e0-161">Use two or more instances for redundancy and scalability.</span></span> <span data-ttu-id="c09e0-162">Para se qualificar para o [SLA](https://azure.microsoft.com/support/legal/sla/application-gateway), você deverá provisionar duas ou mais instâncias médias ou maiores.</span><span class="sxs-lookup"><span data-stu-id="c09e0-162">In order to qualify for the [SLA](https://azure.microsoft.com/support/legal/sla/application-gateway), you must provision two or more medium or larger instances.</span></span>

## <a name="cosmos-db"></a><span data-ttu-id="c09e0-163">Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="c09e0-163">Cosmos DB</span></span>

<span data-ttu-id="c09e0-164">**Replique o banco de dados entre regiões.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-164">**Replicate the database across regions.**</span></span> <span data-ttu-id="c09e0-165">O Cosmos DB permite associar qualquer número de regiões do Azure a uma conta de banco de dados do Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="c09e0-165">Cosmos DB allows you to associate any number of Azure regions with a Cosmos DB database account.</span></span> <span data-ttu-id="c09e0-166">Um banco de dados do Azure Cosmos DB pode ter várias regiões de leitura e uma de gravação.</span><span class="sxs-lookup"><span data-stu-id="c09e0-166">A Cosmos DB database can have one write region and multiple read regions.</span></span> <span data-ttu-id="c09e0-167">Se houver uma falha na região de gravação, você poderá ler de outra réplica.</span><span class="sxs-lookup"><span data-stu-id="c09e0-167">If there is a failure in the write region, you can read from another replica.</span></span> <span data-ttu-id="c09e0-168">O SDK do cliente lida com isso automaticamente.</span><span class="sxs-lookup"><span data-stu-id="c09e0-168">The Client SDK handles this automatically.</span></span> <span data-ttu-id="c09e0-169">Você também pode fazer failover da região de gravação para outra região.</span><span class="sxs-lookup"><span data-stu-id="c09e0-169">You can also fail over the write region to another region.</span></span> <span data-ttu-id="c09e0-170">Para obter mais informações, confira [Como distribuir os dados globalmente com o Azure Cosmos DB](/azure/cosmos-db/distribute-data-globally).</span><span class="sxs-lookup"><span data-stu-id="c09e0-170">For more information, see [How to distribute data globally with Azure Cosmos DB](/azure/cosmos-db/distribute-data-globally).</span></span>

## <a name="event-hubs"></a><span data-ttu-id="c09e0-171">Hubs de Eventos</span><span class="sxs-lookup"><span data-stu-id="c09e0-171">Event Hubs</span></span>

<span data-ttu-id="c09e0-172">**Usar pontos de verificação**.</span><span class="sxs-lookup"><span data-stu-id="c09e0-172">**Use checkpoints**.</span></span>  <span data-ttu-id="c09e0-173">Um consumidor de evento deve gravar sua posição atual no armazenamento persistente em um intervalo predefinido.</span><span class="sxs-lookup"><span data-stu-id="c09e0-173">An event consumer should write its current position to persistent storage at some predefined interval.</span></span> <span data-ttu-id="c09e0-174">Dessa forma, se o consumidor apresentar uma falha (por exemplo, falhas do consumidor ou do host), uma nova instância poderá retomar a leitura do fluxo da última posição gravada.</span><span class="sxs-lookup"><span data-stu-id="c09e0-174">That way, if the consumer experiences a fault (for example, the consumer crashes, or the host fails), then a new instance can resume reading the stream from the last recorded position.</span></span> <span data-ttu-id="c09e0-175">Para obter mais informações, consulte [Consumidores de evento](/azure/event-hubs/event-hubs-features#event-consumers).</span><span class="sxs-lookup"><span data-stu-id="c09e0-175">For more information, see [Event consumers](/azure/event-hubs/event-hubs-features#event-consumers).</span></span>

<span data-ttu-id="c09e0-176">**Tratar mensagens duplicadas.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-176">**Handle duplicate messages.**</span></span> <span data-ttu-id="c09e0-177">Se um consumidor de evento falhar, o processamento de mensagem é retomado do último ponto de verificação gravado.</span><span class="sxs-lookup"><span data-stu-id="c09e0-177">If an event consumer fails, message processing is resumed from the last recorded checkpoint.</span></span> <span data-ttu-id="c09e0-178">As mensagens que já foram processadas após o último ponto de verificação serão processadas novamente.</span><span class="sxs-lookup"><span data-stu-id="c09e0-178">Any messages that were already processed after the last checkpoint will be processed again.</span></span> <span data-ttu-id="c09e0-179">Portanto, sua lógica de processamento de mensagem deve ser idempotente, ou o aplicativo deve ser capaz de eliminar a duplicação de mensagens.</span><span class="sxs-lookup"><span data-stu-id="c09e0-179">Therefore, your message processing logic must be idempotent, or the application must be able to deduplicate messages.</span></span>

<span data-ttu-id="c09e0-180">**Tratar exceções.** .</span><span class="sxs-lookup"><span data-stu-id="c09e0-180">**Handle exceptions.**.</span></span> <span data-ttu-id="c09e0-181">Um consumidor de evento normalmente processa um lote de mensagens em um loop.</span><span class="sxs-lookup"><span data-stu-id="c09e0-181">An event consumer typically processes a batch of messages in a loop.</span></span> <span data-ttu-id="c09e0-182">Você deve tratar exceções neste loop de processamento para evitar a perda de um lote inteiro de mensagens se uma única mensagem causar uma exceção.</span><span class="sxs-lookup"><span data-stu-id="c09e0-182">You should handle exceptions within this processing loop to avoid losing an entire batch of messages if a single message causes an exception.</span></span>

<span data-ttu-id="c09e0-183">**Use uma fila de mensagens mortas.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-183">**Use a dead-letter queue.**</span></span> <span data-ttu-id="c09e0-184">Se o processamento de uma mensagem resultar em uma falha não transitória, coloque a mensagem sobre uma fila de mensagens mortas, para que você possa acompanhar o status.</span><span class="sxs-lookup"><span data-stu-id="c09e0-184">If processing a message results in a non-transient failure, put the message onto a dead-letter queue, so that you can track the status.</span></span> <span data-ttu-id="c09e0-185">Dependendo do cenário, você pode tentar novamente a mensagem mais tarde, aplicar uma transação de compensação ou executar alguma outra ação.</span><span class="sxs-lookup"><span data-stu-id="c09e0-185">Depending on the scenario, you might retry the message later, apply a compensating transaction, or take some other action.</span></span> <span data-ttu-id="c09e0-186">Observe que os Hubs de Eventos não têm nenhuma funcionalidade interna de fila de mensagens mortas.</span><span class="sxs-lookup"><span data-stu-id="c09e0-186">Note that Event Hubs does not have any built-in dead-letter queue functionality.</span></span> <span data-ttu-id="c09e0-187">Você pode usar o Armazenamento de Filas do Azure ou o Barramento de Serviço para implementar uma fila de mensagens mortas ou usar o Azure Functions ou outro mecanismo de eventos.</span><span class="sxs-lookup"><span data-stu-id="c09e0-187">You can use Azure Queue Storage or Service Bus to implement a dead-letter queue, or use Azure Functions or some other eventing mechanism.</span></span>

<span data-ttu-id="c09e0-188">**Implementar recuperação de desastres efetuando failover para um namespace secundário de Hubs de Eventos.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-188">**Implement disaster recovery by failing over to a secondary Event Hubs namespace.**</span></span> <span data-ttu-id="c09e0-189">Para mais informações consulte [Recuperação de desastre em área geográfica dos Hubs de Eventos](/azure/event-hubs/event-hubs-geo-dr).</span><span class="sxs-lookup"><span data-stu-id="c09e0-189">For more information, see [Azure Event Hubs Geo-disaster recovery](/azure/event-hubs/event-hubs-geo-dr).</span></span>

## <a name="redis-cache"></a><span data-ttu-id="c09e0-190">Cache Redis</span><span class="sxs-lookup"><span data-stu-id="c09e0-190">Redis Cache</span></span>

<span data-ttu-id="c09e0-191">**Configurar a replicação geográfica**.</span><span class="sxs-lookup"><span data-stu-id="c09e0-191">**Configure Geo-replication**.</span></span> <span data-ttu-id="c09e0-192">A Replicação geográfica fornece um mecanismo para vincular duas instâncias de Cache Redis do Azure de camada Premium.</span><span class="sxs-lookup"><span data-stu-id="c09e0-192">Geo-replication provides a mechanism for linking two Premium tier Azure Redis Cache instances.</span></span> <span data-ttu-id="c09e0-193">Os dados gravados no cache primário são replicados para um cache secundário de somente leitura.</span><span class="sxs-lookup"><span data-stu-id="c09e0-193">Data written to the primary cache is replicated to a secondary read-only cache.</span></span> <span data-ttu-id="c09e0-194">Para obter mais informações, consulte [Como configurar a replicação geográfica do Cache Redis do Azure](/azure/redis-cache/cache-how-to-geo-replication)</span><span class="sxs-lookup"><span data-stu-id="c09e0-194">For more information, see [How to configure Geo-replication for Azure Redis Cache](/azure/redis-cache/cache-how-to-geo-replication)</span></span>

<span data-ttu-id="c09e0-195">**Configurar a persistência de dados.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-195">**Configure data persistence.**</span></span> <span data-ttu-id="c09e0-196">A persistência do Redis permite persistir os dados armazenados no Redis.</span><span class="sxs-lookup"><span data-stu-id="c09e0-196">Redis persistence allows you to persist data stored in Redis.</span></span> <span data-ttu-id="c09e0-197">Você também pode tirar instantâneos e fazer backup dos dados, que podem ser carregados em caso de falha de hardware.</span><span class="sxs-lookup"><span data-stu-id="c09e0-197">You can also take snapshots and back up the data, which you can load in case of a hardware failure.</span></span> <span data-ttu-id="c09e0-198">Para obter mais informações, consulte [Como configurar a persistência de dados para um Cache Redis do Azure Premium](/azure/redis-cache/cache-how-to-premium-persistence)</span><span class="sxs-lookup"><span data-stu-id="c09e0-198">For more information, see [How to configure data persistence for a Premium Azure Redis Cache](/azure/redis-cache/cache-how-to-premium-persistence)</span></span>

<span data-ttu-id="c09e0-199">Caso esteja usando o Cache Redis como um cache de dados temporário e não como um armazenamento persistente, essas recomendações podem não ser aplicadas.</span><span class="sxs-lookup"><span data-stu-id="c09e0-199">If you are using Redis Cache as a temporary data cache and not as a persistent store, these recommendations may not apply.</span></span>

## <a name="search"></a><span data-ttu-id="c09e0-200">Search</span><span class="sxs-lookup"><span data-stu-id="c09e0-200">Search</span></span>

<span data-ttu-id="c09e0-201">**Provisione mais de uma réplica.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-201">**Provision more than one replica.**</span></span> <span data-ttu-id="c09e0-202">Use pelo menos duas réplicas para alta disponibilidade de leitura ou três para alta disponibilidade de leitura/gravação.</span><span class="sxs-lookup"><span data-stu-id="c09e0-202">Use at least two replicas for read high-availability, or three for read-write high-availability.</span></span>

<span data-ttu-id="c09e0-203">**Configure indexadores para implantações de várias regiões.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-203">**Configure indexers for multi-region deployments.**</span></span> <span data-ttu-id="c09e0-204">Se você tiver uma implantação de várias regiões, considere as opções para a continuidade na indexação.</span><span class="sxs-lookup"><span data-stu-id="c09e0-204">If you have a multi-region deployment, consider your options for continuity in indexing.</span></span>

- <span data-ttu-id="c09e0-205">Se a fonte de dados é com replicação geográfica, você geralmente deve apontar cada indexador de cada serviço do Azure Search regional para a respectiva réplica de fonte de dados local.</span><span class="sxs-lookup"><span data-stu-id="c09e0-205">If the data source is geo-replicated, you should generally point each indexer of each regional Azure Search service to its local data source replica.</span></span> <span data-ttu-id="c09e0-206">No entanto, essa abordagem não é recomendada para grandes conjuntos de dados armazenados no Banco de Dados SQL do Azure.</span><span class="sxs-lookup"><span data-stu-id="c09e0-206">However, that approach is not recommended for large datasets stored in Azure SQL Database.</span></span> <span data-ttu-id="c09e0-207">O motivo é que o Azure Search não pode executar a indexação incremental de réplicas de Banco de Dados SQL secundárias, somente de réplicas primárias.</span><span class="sxs-lookup"><span data-stu-id="c09e0-207">The reason is that Azure Search cannot perform incremental indexing from secondary SQL Database replicas, only from primary replicas.</span></span> <span data-ttu-id="c09e0-208">Em vez disso, aponte todos os indexadores para a réplica primária.</span><span class="sxs-lookup"><span data-stu-id="c09e0-208">Instead, point all indexers to the primary replica.</span></span> <span data-ttu-id="c09e0-209">Após um failover, aponte os indexadores do Azure Search para a nova réplica primária.</span><span class="sxs-lookup"><span data-stu-id="c09e0-209">After a failover, point the Azure Search indexers at the new primary replica.</span></span>

- <span data-ttu-id="c09e0-210">Se a fonte de dados não é com replicação geográfica, aponte vários indexadores na fonte de dados, de forma que os serviços do Azure Search façam a indexação da fonte de dados de modo contínuo e independente.</span><span class="sxs-lookup"><span data-stu-id="c09e0-210">If the data source is not geo-replicated, point multiple indexers at the same data source, so that Azure Search services in multiple regions continuously and independently index from the data source.</span></span> <span data-ttu-id="c09e0-211">Para obter mais informações, consulte [Considerações de desempenho e otimização do Azure Search][search-optimization].</span><span class="sxs-lookup"><span data-stu-id="c09e0-211">For more information, see [Azure Search performance and optimization considerations][search-optimization].</span></span>

## <a name="service-bus"></a><span data-ttu-id="c09e0-212">Barramento de Serviço</span><span class="sxs-lookup"><span data-stu-id="c09e0-212">Service Bus</span></span>

<span data-ttu-id="c09e0-213">**Use a camada Premium para cargas de trabalho de produção**.</span><span class="sxs-lookup"><span data-stu-id="c09e0-213">**Use Premium tier for production workloads**.</span></span> <span data-ttu-id="c09e0-214">[Mensagens Premium do Barramento de Serviço](/azure/service-bus-messaging/service-bus-premium-messaging) fornecem recursos de processamento dedicado e reservado e a capacidade de memória para dar suporte a desempenho e taxa de transferência previsíveis.</span><span class="sxs-lookup"><span data-stu-id="c09e0-214">[Service Bus Premium Messaging](/azure/service-bus-messaging/service-bus-premium-messaging) provides dedicated and reserved processing resources, and memory capacity to support predictable performance and throughput.</span></span> <span data-ttu-id="c09e0-215">A camada de Mensagens Premium também oferece acesso a novos recursos que estão disponíveis somente para clientes Premium no início.</span><span class="sxs-lookup"><span data-stu-id="c09e0-215">Premium Messaging tier also gives you access to new features that are available only to premium customers at first.</span></span> <span data-ttu-id="c09e0-216">Você pode decidir o número de unidades do sistema de mensagens com base em cargas de trabalho esperadas.</span><span class="sxs-lookup"><span data-stu-id="c09e0-216">You can decide the number of messaging units based on expected workloads.</span></span>

<span data-ttu-id="c09e0-217">**Tratar mensagens duplicadas**.</span><span class="sxs-lookup"><span data-stu-id="c09e0-217">**Handle duplicate messages**.</span></span> <span data-ttu-id="c09e0-218">Se um editor falha imediatamente após enviar uma mensagem ou enfrenta problemas de rede ou do sistema, pode deixar de registrar erroneamente que a mensagem foi entregue e pode enviar a mesma mensagem ao sistema duas vezes.</span><span class="sxs-lookup"><span data-stu-id="c09e0-218">If a publisher fails immediately after sending a message, or experiences network or system issues, it may erroneously fail to record that the message was delivered, and may send the same message to the system twice.</span></span> <span data-ttu-id="c09e0-219">O Barramento de Serviço pode lidar com esse problema habilitando a detecção de duplicatas.</span><span class="sxs-lookup"><span data-stu-id="c09e0-219">Service Bus can handle this issue by enabling duplicate detection.</span></span> <span data-ttu-id="c09e0-220">Para saber mais, confira [Detecção de duplicatas](/azure/service-bus-messaging/duplicate-detection).</span><span class="sxs-lookup"><span data-stu-id="c09e0-220">For more information, see [Duplicate detection](/azure/service-bus-messaging/duplicate-detection).</span></span>

<span data-ttu-id="c09e0-221">**Tratar exceções**.</span><span class="sxs-lookup"><span data-stu-id="c09e0-221">**Handle exceptions**.</span></span> <span data-ttu-id="c09e0-222">As APIs de mensagens geram exceções quando ocorre um erro de usuário, um erro de configuração ou outro erro.</span><span class="sxs-lookup"><span data-stu-id="c09e0-222">Messaging APIs generate exceptions when a user error, configuration error, or other error occurs.</span></span> <span data-ttu-id="c09e0-223">O código do cliente (remetentes e receptores) deve tratar essas exceções em seu código.</span><span class="sxs-lookup"><span data-stu-id="c09e0-223">The client code (senders and receivers) should handle these exceptions in their code.</span></span> <span data-ttu-id="c09e0-224">Isso é especialmente importante no processamento em lotes, em que o tratamento de exceção pode ser usado para evitar a perda de um lote inteiro de mensagens.</span><span class="sxs-lookup"><span data-stu-id="c09e0-224">This is especially important in batch processing, where exception handling can be used to avoid losing an entire batch of messages.</span></span> <span data-ttu-id="c09e0-225">Para saber mais, veja [Exceções de mensagens do Barramento de Serviço](/azure/service-bus-messaging/service-bus-messaging-exceptions).</span><span class="sxs-lookup"><span data-stu-id="c09e0-225">For more information, see [Service Bus messaging exceptions](/azure/service-bus-messaging/service-bus-messaging-exceptions).</span></span>

<span data-ttu-id="c09e0-226">**Política de repetição**.</span><span class="sxs-lookup"><span data-stu-id="c09e0-226">**Retry policy**.</span></span> <span data-ttu-id="c09e0-227">O Barramento de Serviço permite que você escolha a melhor política de repetição para os aplicativos.</span><span class="sxs-lookup"><span data-stu-id="c09e0-227">Service Bus allows you to pick the best retry policy for your applications.</span></span> <span data-ttu-id="c09e0-228">A política padrão é permitir no máximo nove tentativas de repetição e aguardar 30 segundos, mas isso pode ser ajustado.</span><span class="sxs-lookup"><span data-stu-id="c09e0-228">The default policy is to allow 9 maximum retry attempts, and wait for 30 seconds but this can be further adjusted.</span></span> <span data-ttu-id="c09e0-229">Para saber mais, confira [Política de repetição – Barramento de Serviço](/azure/architecture/best-practices/retry-service-specific#service-bus).</span><span class="sxs-lookup"><span data-stu-id="c09e0-229">For more information, see [Retry policy – Service Bus](/azure/architecture/best-practices/retry-service-specific#service-bus).</span></span>

<span data-ttu-id="c09e0-230">**Use uma fila de mensagens mortas**.</span><span class="sxs-lookup"><span data-stu-id="c09e0-230">**Use a dead-letter queue**.</span></span> <span data-ttu-id="c09e0-231">Se uma mensagem não pode ser processada ou entregue a nenhum receptor após várias tentativas, é movida para uma fila de mensagens mortas.</span><span class="sxs-lookup"><span data-stu-id="c09e0-231">If a message cannot be processed or delivered to any receiver after multiple retries, it is moved to a dead letter queue.</span></span> <span data-ttu-id="c09e0-232">Implemente um processo para ler mensagens da fila de mensagens mortas, inspecioná-las e corrigir o problema.</span><span class="sxs-lookup"><span data-stu-id="c09e0-232">Implement a process to read messages from the dead letter queue, inspect them, and remediate the problem.</span></span> <span data-ttu-id="c09e0-233">Dependendo do cenário, você pode repetir a mensagem como está, fazer alterações e tentar novamente ou descartar a mensagem.</span><span class="sxs-lookup"><span data-stu-id="c09e0-233">Depending on the scenario, you might retry the message as-is, make changes and retry, or discard the message.</span></span> <span data-ttu-id="c09e0-234">Para saber mais, confira [Visão geral das filas de mensagens mortas do Barramento de Serviço](/azure/service-bus-messaging/service-bus-dead-letter-queues).</span><span class="sxs-lookup"><span data-stu-id="c09e0-234">For more information, see [Overview of Service Bus dead-letter queues](/azure/service-bus-messaging/service-bus-dead-letter-queues).</span></span>

<span data-ttu-id="c09e0-235">**Usar a recuperação de desastre em área geográfica**.</span><span class="sxs-lookup"><span data-stu-id="c09e0-235">**Use Geo-Disaster Recovery**.</span></span> <span data-ttu-id="c09e0-236">A recuperação de desastre em área geográfica garante que o processamento de dados continue a operar em uma região ou datacenter diferente, se uma região inteira do Azure ou o datacenter se tornar indisponível devido a um desastre.</span><span class="sxs-lookup"><span data-stu-id="c09e0-236">Geo-disaster recovery ensures that data processing continues to operate in a different region or datacenter if an entire Azure region or datacenter becomes unavailable due to a disaster.</span></span> <span data-ttu-id="c09e0-237">Para mais informações consulte [Recuperação de desastre em área geográfica do Barramento de Serviço do Azure](/azure/service-bus-messaging/service-bus-geo-dr).</span><span class="sxs-lookup"><span data-stu-id="c09e0-237">For more information, see [Azure Service Bus Geo-disaster recovery](/azure/service-bus-messaging/service-bus-geo-dr).</span></span>

## <a name="storage"></a><span data-ttu-id="c09e0-238">Armazenamento</span><span class="sxs-lookup"><span data-stu-id="c09e0-238">Storage</span></span>

<span data-ttu-id="c09e0-239">**Para dados de aplicativo, use RA-GRS (armazenamento com redundância geográfica com acesso de leitura).**</span><span class="sxs-lookup"><span data-stu-id="c09e0-239">**For application data, use read-access geo-redundant storage (RA-GRS).**</span></span> <span data-ttu-id="c09e0-240">O armazenamento de RA-GRS replica os dados para uma região secundária e fornece acesso somente leitura da região secundária.</span><span class="sxs-lookup"><span data-stu-id="c09e0-240">RA-GRS storage replicates the data to a secondary region, and provides read-only access from the secondary region.</span></span> <span data-ttu-id="c09e0-241">Se há uma interrupção de armazenamento na região primária, o aplicativo pode ler os dados da região secundária.</span><span class="sxs-lookup"><span data-stu-id="c09e0-241">If there is a storage outage in the primary region, the application can read the data from the secondary region.</span></span> <span data-ttu-id="c09e0-242">Para obter mais informações, consulte [Replicação do Armazenamento do Azure](/azure/storage/storage-redundancy/).</span><span class="sxs-lookup"><span data-stu-id="c09e0-242">For more information, see [Azure Storage replication](/azure/storage/storage-redundancy/).</span></span>

<span data-ttu-id="c09e0-243">**Para discos de VM, use os Managed Disks.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-243">**For VM disks, use Managed Disks.**</span></span> <span data-ttu-id="c09e0-244">Os [Managed Disks][managed-disks] fornecem melhor confiabilidade para as VMs em um conjunto de disponibilidade porque os discos ficam suficientemente isolados entre si para evitar pontos únicos de falha.</span><span class="sxs-lookup"><span data-stu-id="c09e0-244">[Managed Disks][managed-disks] provide better reliability for VMs in an availability set, because the disks are sufficiently isolated from each other to avoid single points of failure.</span></span> <span data-ttu-id="c09e0-245">Além disso, os Managed Disks não estão sujeitos a limites de IOPS de VHDs criados em uma conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c09e0-245">Also, Managed Disks aren't subject to the IOPS limits of VHDs created in a storage account.</span></span> <span data-ttu-id="c09e0-246">Para saber mais, consulte [Gerenciar a disponibilidade de máquinas virtuais Windows no Azure][vm-manage-availability].</span><span class="sxs-lookup"><span data-stu-id="c09e0-246">For more information, see [Manage the availability of Windows virtual machines in Azure][vm-manage-availability].</span></span>

<span data-ttu-id="c09e0-247">**Para o Armazenamento de Filas, crie uma fila de backup em outra região.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-247">**For Queue storage, create a backup queue in another region.**</span></span> <span data-ttu-id="c09e0-248">Para o armazenamento de fila, a utilidade de uma réplica somente leitura é limitada, porque não é possível enfileirar itens nem removê-los da fila.</span><span class="sxs-lookup"><span data-stu-id="c09e0-248">For Queue storage, a read-only replica has limited use, because you can't queue or dequeue items.</span></span> <span data-ttu-id="c09e0-249">Em vez disso, crie uma fila de backup em uma conta de armazenamento em outra região.</span><span class="sxs-lookup"><span data-stu-id="c09e0-249">Instead, create a backup queue in a storage account in another region.</span></span> <span data-ttu-id="c09e0-250">Se houver uma interrupção de armazenamento, o aplicativo poderá usar a fila de backup até que a região primária fique disponível novamente.</span><span class="sxs-lookup"><span data-stu-id="c09e0-250">If there is a storage outage, the application can use the backup queue, until the primary region becomes available again.</span></span> <span data-ttu-id="c09e0-251">Dessa forma, o aplicativo ainda poderá processar novas solicitações.</span><span class="sxs-lookup"><span data-stu-id="c09e0-251">That way, the application can still process new requests.</span></span>

## <a name="sql-database"></a><span data-ttu-id="c09e0-252">Banco de dados SQL</span><span class="sxs-lookup"><span data-stu-id="c09e0-252">SQL Database</span></span>

<span data-ttu-id="c09e0-253">**Use a camada Standard ou Premium.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-253">**Use Standard or Premium tier.**</span></span> <span data-ttu-id="c09e0-254">Essas camadas fornecem um período de Recuperação Pontual mais longo (35 dias).</span><span class="sxs-lookup"><span data-stu-id="c09e0-254">These tiers provide a longer point-in-time restore period (35 days).</span></span> <span data-ttu-id="c09e0-255">Para obter mais informações, consulte [Opções e desempenho de Banco de Dados SQL](/azure/sql-database/sql-database-service-tiers/).</span><span class="sxs-lookup"><span data-stu-id="c09e0-255">For more information, see [SQL Database options and performance](/azure/sql-database/sql-database-service-tiers/).</span></span>

<span data-ttu-id="c09e0-256">**Habilite a auditoria do Banco de Dados SQL.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-256">**Enable SQL Database auditing.**</span></span> <span data-ttu-id="c09e0-257">A auditoria pode ser usada para diagnosticar erros humanos ou ataques mal-intencionados.</span><span class="sxs-lookup"><span data-stu-id="c09e0-257">Auditing can be used to diagnose malicious attacks or human error.</span></span> <span data-ttu-id="c09e0-258">Para saber mais, confira [Introdução à Auditoria do Banco de Dados SQL](/azure/sql-database/sql-database-auditing-get-started/).</span><span class="sxs-lookup"><span data-stu-id="c09e0-258">For more information, see [Get started with SQL database auditing](/azure/sql-database/sql-database-auditing-get-started/).</span></span>

<span data-ttu-id="c09e0-259">**Use a Replicação Geográfica Ativa**. Use a replicação geográfica ativa para criar uma réplica secundária legível em uma região diferente.</span><span class="sxs-lookup"><span data-stu-id="c09e0-259">**Use Active Geo-Replication** Use Active Geo-Replication to create a readable secondary in a different region.</span></span>  <span data-ttu-id="c09e0-260">Se o seu banco de dados primário falhar ou simplesmente precisar ser colocado offline, faça um failover manual para qualquer o banco de dados secundário.</span><span class="sxs-lookup"><span data-stu-id="c09e0-260">If your primary database fails, or simply needs to be taken offline, perform a manual failover to the secondary database.</span></span>  <span data-ttu-id="c09e0-261">O banco de dados secundário permanece somente leitura até você fazer o failover.</span><span class="sxs-lookup"><span data-stu-id="c09e0-261">Until you fail over, the secondary database remains read-only.</span></span>  <span data-ttu-id="c09e0-262">Para saber mais, confira [Replicação Geográfica Ativa para o Banco de Dados SQL](/azure/sql-database/sql-database-geo-replication-overview/).</span><span class="sxs-lookup"><span data-stu-id="c09e0-262">For more information, see [SQL Database Active Geo-Replication](/azure/sql-database/sql-database-geo-replication-overview/).</span></span>

<span data-ttu-id="c09e0-263">**Use fragmentação.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-263">**Use sharding.**</span></span> <span data-ttu-id="c09e0-264">Considere o uso de fragmentação para particionar o banco de dados horizontalmente.</span><span class="sxs-lookup"><span data-stu-id="c09e0-264">Consider using sharding to partition the database horizontally.</span></span> <span data-ttu-id="c09e0-265">A fragmentação pode proporcionar o isolamento de falhas.</span><span class="sxs-lookup"><span data-stu-id="c09e0-265">Sharding can provide fault isolation.</span></span> <span data-ttu-id="c09e0-266">Para saber mais, confira [Expansão com o Banco de Dados SQL do Azure](/azure/sql-database/sql-database-elastic-scale-introduction/).</span><span class="sxs-lookup"><span data-stu-id="c09e0-266">For more information, see [Scaling out with Azure SQL Database](/azure/sql-database/sql-database-elastic-scale-introduction/).</span></span>

<span data-ttu-id="c09e0-267">**Use a Recuperação Pontual para se recuperar de erro humano.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-267">**Use point-in-time restore to recover from human error.**</span></span>  <span data-ttu-id="c09e0-268">A Recuperação Pontual retorna seu banco de dados para um ponto anterior no tempo.</span><span class="sxs-lookup"><span data-stu-id="c09e0-268">Point-in-time restore returns your database to an earlier point in time.</span></span> <span data-ttu-id="c09e0-269">Para obter mais informações, consulte [Recuperar um Banco de Dados SQL do Azure usando backups de banco de dados automatizados][sql-restore].</span><span class="sxs-lookup"><span data-stu-id="c09e0-269">For more information, see [Recover an Azure SQL database using automated database backups][sql-restore].</span></span>

<span data-ttu-id="c09e0-270">**Use a restauração geográfica para recuperar-se de uma interrupção de serviço.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-270">**Use geo-restore to recover from a service outage.**</span></span> <span data-ttu-id="c09e0-271">A restauração geográfica restaura um banco de dados de um backup com redundância geográfica.</span><span class="sxs-lookup"><span data-stu-id="c09e0-271">Geo-restore restores a database from a geo-redundant backup.</span></span>  <span data-ttu-id="c09e0-272">Para obter mais informações, consulte [Recuperar um Banco de Dados SQL do Azure usando backups de banco de dados automatizados][sql-restore].</span><span class="sxs-lookup"><span data-stu-id="c09e0-272">For more information, see [Recover an Azure SQL database using automated database backups][sql-restore].</span></span>

## <a name="sql-data-warehouse"></a><span data-ttu-id="c09e0-273">SQL Data Warehouse</span><span class="sxs-lookup"><span data-stu-id="c09e0-273">SQL Data Warehouse</span></span>

<span data-ttu-id="c09e0-274">**Não desabilite o backup geográfico.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-274">**Do not disable geo-backup.**</span></span> <span data-ttu-id="c09e0-275">Por padrão, o SQL Data Warehouse usa um backup completo de seus dados a cada 24 horas para a recuperação de desastres.</span><span class="sxs-lookup"><span data-stu-id="c09e0-275">By default, SQL Data Warehouse takes a full backup of your data every 24 hours for disaster recovery.</span></span> <span data-ttu-id="c09e0-276">Não é recomendável desativar esse recurso.</span><span class="sxs-lookup"><span data-stu-id="c09e0-276">It is not recommended to turn this feature off.</span></span> <span data-ttu-id="c09e0-277">Para obter mais informações, veja [Backups geográficos](/azure/sql-data-warehouse/backup-and-restore#geo-backups).</span><span class="sxs-lookup"><span data-stu-id="c09e0-277">For more information, see [Geo-backups](/azure/sql-data-warehouse/backup-and-restore#geo-backups).</span></span>

## <a name="sql-server-running-in-a-vm"></a><span data-ttu-id="c09e0-278">SQL Server em execução em uma VM</span><span class="sxs-lookup"><span data-stu-id="c09e0-278">SQL Server running in a VM</span></span>

<span data-ttu-id="c09e0-279">**Replicar o banco de dados.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-279">**Replicate the database.**</span></span> <span data-ttu-id="c09e0-280">Use os Grupos de Disponibilidade Always On do SQL Server para replicar o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="c09e0-280">Use SQL Server Always On Availability Groups to replicate the database.</span></span> <span data-ttu-id="c09e0-281">Fornece alta disponibilidade se uma instância do SQL Server falha.</span><span class="sxs-lookup"><span data-stu-id="c09e0-281">Provides high availability if one SQL Server instance fails.</span></span> <span data-ttu-id="c09e0-282">Para obter mais informações, consulte [Executar VMs do Windows para um aplicativo de N camadas](../reference-architectures/virtual-machines-windows/n-tier.md)</span><span class="sxs-lookup"><span data-stu-id="c09e0-282">For more information, see [Run Windows VMs for an N-tier application](../reference-architectures/virtual-machines-windows/n-tier.md)</span></span>

<span data-ttu-id="c09e0-283">**Fazer backup do banco de dados**.</span><span class="sxs-lookup"><span data-stu-id="c09e0-283">**Back up the database**.</span></span> <span data-ttu-id="c09e0-284">Se você já estiver usando [Backup do Azure](https://azure.microsoft.com/documentation/services/backup/) para fazer backup de suas VMs, considere usar o [Backup do Azure para cargas de trabalho do SQL Server usando o DPM](/azure/backup/backup-azure-backup-sql/).</span><span class="sxs-lookup"><span data-stu-id="c09e0-284">If you are already using [Azure Backup](https://azure.microsoft.com/documentation/services/backup/) to back up your VMs, consider using [Azure Backup for SQL Server workloads using DPM](/azure/backup/backup-azure-backup-sql/).</span></span> <span data-ttu-id="c09e0-285">Com essa abordagem, há uma função de administrador de backup para a organização e um procedimento de recuperação unificado para as VMs e o SQL Server.</span><span class="sxs-lookup"><span data-stu-id="c09e0-285">With this approach, there is one backup administrator role for the organization and a unified recovery procedure for VMs and SQL Server.</span></span> <span data-ttu-id="c09e0-286">Caso contrário, use o [Backup gerenciado pelo SQL Server para o Microsoft Azure](https://msdn.microsoft.com/library/dn449496.aspx).</span><span class="sxs-lookup"><span data-stu-id="c09e0-286">Otherwise, use [SQL Server Managed Backup to Microsoft Azure](https://msdn.microsoft.com/library/dn449496.aspx).</span></span>

## <a name="traffic-manager"></a><span data-ttu-id="c09e0-287">Gerenciador de Tráfego</span><span class="sxs-lookup"><span data-stu-id="c09e0-287">Traffic Manager</span></span>

<span data-ttu-id="c09e0-288">**Faça o failback manual.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-288">**Perform manual failback.**</span></span> <span data-ttu-id="c09e0-289">Após um failover do Gerenciador de Tráfego, faça o failback manual em vez de automaticamente.</span><span class="sxs-lookup"><span data-stu-id="c09e0-289">After a Traffic Manager failover, perform manual failback, rather than automatically failing back.</span></span> <span data-ttu-id="c09e0-290">Verifique se todos os subsistemas de aplicativo estão íntegros antes de fazer o failback.</span><span class="sxs-lookup"><span data-stu-id="c09e0-290">Before failing back, verify that all application subsystems are healthy.</span></span>  <span data-ttu-id="c09e0-291">Caso contrário, você pode criar uma situação em que o aplicativo fica alternando entre os data centers.</span><span class="sxs-lookup"><span data-stu-id="c09e0-291">Otherwise, you can create a situation where the application flips back and forth between data centers.</span></span> <span data-ttu-id="c09e0-292">Para obter mais informações, consulte [Executar VMs em várias regiões para ter alta disponibilidade](../reference-architectures/virtual-machines-windows/multi-region-application.md).</span><span class="sxs-lookup"><span data-stu-id="c09e0-292">For more information, see [Run VMs in multiple regions for high availability](../reference-architectures/virtual-machines-windows/multi-region-application.md).</span></span>

<span data-ttu-id="c09e0-293">**Criar um ponto de extremidade de investigação de integridade.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-293">**Create a health probe endpoint.**</span></span> <span data-ttu-id="c09e0-294">Crie um ponto de extremidade personalizado que relata a integridade geral do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c09e0-294">Create a custom endpoint that reports on the overall health of the application.</span></span> <span data-ttu-id="c09e0-295">Isso permite que o Gerenciador de Tráfego faça failover se qualquer caminho crítico falha, não apenas o front-end.</span><span class="sxs-lookup"><span data-stu-id="c09e0-295">This enables Traffic Manager to fail over if any critical path fails, not just the front end.</span></span> <span data-ttu-id="c09e0-296">O ponto de extremidade deve retornar um código de erro HTTP se qualquer dependência crítica está não íntegra ou inacessível.</span><span class="sxs-lookup"><span data-stu-id="c09e0-296">The endpoint should return an HTTP error code if any critical dependency is unhealthy or unreachable.</span></span> <span data-ttu-id="c09e0-297">No entanto, não relate erros para serviços não críticos.</span><span class="sxs-lookup"><span data-stu-id="c09e0-297">Don't report errors for non-critical services, however.</span></span> <span data-ttu-id="c09e0-298">Caso contrário, a investigação de integridade poderá disparar o failover quando ele não for necessário, criando falsos positivos.</span><span class="sxs-lookup"><span data-stu-id="c09e0-298">Otherwise, the health probe might trigger failover when it's not needed, creating false positives.</span></span> <span data-ttu-id="c09e0-299">Para obter mais informações, consulte [Monitoramento e failover do ponto de extremidade do Gerenciador de Tráfego](/azure/traffic-manager/traffic-manager-monitoring/).</span><span class="sxs-lookup"><span data-stu-id="c09e0-299">For more information, see [Traffic Manager endpoint monitoring and failover](/azure/traffic-manager/traffic-manager-monitoring/).</span></span>

## <a name="virtual-machines"></a><span data-ttu-id="c09e0-300">Máquinas Virtuais</span><span class="sxs-lookup"><span data-stu-id="c09e0-300">Virtual Machines</span></span>

<span data-ttu-id="c09e0-301">**Evite executar uma carga de trabalho de produção em uma única VM.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-301">**Avoid running a production workload on a single VM.**</span></span> <span data-ttu-id="c09e0-302">Uma única implantação de VM não é resiliente para manutenção (planejada ou não).</span><span class="sxs-lookup"><span data-stu-id="c09e0-302">A single VM deployment is not resilient to planned or unplanned maintenance.</span></span> <span data-ttu-id="c09e0-303">Em vez disso, coloque várias VMs em um conjunto de disponibilidade ou [conjunto de dimensionamento de VM](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview/), com um balanceador de carga na frente.</span><span class="sxs-lookup"><span data-stu-id="c09e0-303">Instead, put multiple VMs in an availability set or [VM scale set](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview/), with a load balancer in front.</span></span>

<span data-ttu-id="c09e0-304">**Especifique um conjunto de disponibilidade ao provisionar a VM.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-304">**Specify an availability set when you provision the VM.**</span></span> <span data-ttu-id="c09e0-305">Atualmente, não há nenhuma maneira de adicionar uma VM a um conjunto de disponibilidade depois que a VM é provisionada.</span><span class="sxs-lookup"><span data-stu-id="c09e0-305">Currently, there is no way to add a VM to an availability set after the VM is provisioned.</span></span> <span data-ttu-id="c09e0-306">Quando você adiciona uma nova VM a um conjunto de disponibilidade existente, verifique se você criou um adaptador de rede para a VM e adicione o adaptador de rede ao pool de endereços de back-end no balanceador de carga.</span><span class="sxs-lookup"><span data-stu-id="c09e0-306">When you add a new VM to an existing availability set, make sure to create a NIC for the VM, and add the NIC to the back-end address pool on the load balancer.</span></span> <span data-ttu-id="c09e0-307">Caso contrário, o balanceador de carga não roteará o tráfego de rede para essa VM.</span><span class="sxs-lookup"><span data-stu-id="c09e0-307">Otherwise, the load balancer won't route network traffic to that VM.</span></span>

<span data-ttu-id="c09e0-308">**Coloque cada camada de aplicativo em um conjunto de disponibilidade separado.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-308">**Put each application tier into a separate Availability Set.**</span></span> <span data-ttu-id="c09e0-309">Em um aplicativo de N camadas, não coloque as VMs de camadas diferentes no mesmo conjunto de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="c09e0-309">In an N-tier application, don't put VMs from different tiers into the same availability set.</span></span> <span data-ttu-id="c09e0-310">VMs em um conjunto de disponibilidade são colocadas em FDs (domínios de falha) e UDs (domínios de atualização).</span><span class="sxs-lookup"><span data-stu-id="c09e0-310">VMs in an availability set are placed across fault domains (FDs) and update domains (UD).</span></span> <span data-ttu-id="c09e0-311">No entanto, para obter o benefício de redundância de FDs e UDs, todas as VMs no conjunto de disponibilidade devem ser capazes de lidar com as mesmas solicitações de cliente.</span><span class="sxs-lookup"><span data-stu-id="c09e0-311">However, to get the redundancy benefit of FDs and UDs, every VM in the availability set must be able to handle the same client requests.</span></span>

<span data-ttu-id="c09e0-312">**Replique VMs usando o Azure Site Recovery.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-312">**Replicate VMs using Azure Site Recovery.**</span></span> <span data-ttu-id="c09e0-313">Quando você replicar VMs do Azure usando a [Recuperação de Site][site-recovery], todos os discos de VM serão replicados continuamente para a região de destino assincronamente.</span><span class="sxs-lookup"><span data-stu-id="c09e0-313">When you replicate Azure VMs using [Site Recovery][site-recovery], all the VM disks are continuously replicated to the target region asynchronously.</span></span> <span data-ttu-id="c09e0-314">Os pontos de replicação são criados a cada poucos minutos.</span><span class="sxs-lookup"><span data-stu-id="c09e0-314">The recovery points are created every few minutes.</span></span> <span data-ttu-id="c09e0-315">Isso fornece um RPO (Objetivo de Ponto de Recuperação) na ordem de minutos.</span><span class="sxs-lookup"><span data-stu-id="c09e0-315">This gives you a Recovery Point Objective (RPO) in the order of minutes.</span></span> <span data-ttu-id="c09e0-316">Realize a recuperação de desastre quantas vezes quiser sem afetar o aplicativo de produção ou a replicação contínua.</span><span class="sxs-lookup"><span data-stu-id="c09e0-316">You can conduct disaster recovery drills as many times as you want, without impacting the production application or the ongoing replication.</span></span> <span data-ttu-id="c09e0-317">Para saber mais, confira [Realizar uma análise detalhada da recuperação de desastre para o Azure][site-recovery-test].</span><span class="sxs-lookup"><span data-stu-id="c09e0-317">For more information, see [Run a disaster recovery drill to Azure][site-recovery-test].</span></span>

<span data-ttu-id="c09e0-318">**Escolha o tamanho de VM correto com base nos requisitos de desempenho.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-318">**Choose the right VM size based on performance requirements.**</span></span> <span data-ttu-id="c09e0-319">Ao mover uma carga de trabalho existente para o Azure, comece com o tamanho da VM que mais se aproxima de seus servidores locais.</span><span class="sxs-lookup"><span data-stu-id="c09e0-319">When moving an existing workload to Azure, start with the VM size that's the closest match to your on-premises servers.</span></span> <span data-ttu-id="c09e0-320">Em seguida, meça o desempenho da carga de trabalho real com relação à CPU, memória e IOPS e ajuste o tamanho, se necessário.</span><span class="sxs-lookup"><span data-stu-id="c09e0-320">Then measure the performance of your actual workload with respect to CPU, memory, and disk IOPS, and adjust the size if needed.</span></span> <span data-ttu-id="c09e0-321">Isso ajuda a garantir que o aplicativo se comporte como esperado em um ambiente de nuvem.</span><span class="sxs-lookup"><span data-stu-id="c09e0-321">This helps to ensure the application behaves as expected in a cloud environment.</span></span> <span data-ttu-id="c09e0-322">Além disso, se você precisar de várias NICs, esteja ciente do limite de NIC para cada tamanho.</span><span class="sxs-lookup"><span data-stu-id="c09e0-322">Also, if you need multiple NICs, be aware of the NIC limit for each size.</span></span>

<span data-ttu-id="c09e0-323">**Use Managed Disks para VHDs.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-323">**Use Managed Disks for VHDs.**</span></span> <span data-ttu-id="c09e0-324">Os [Managed Disks][managed-disks] fornecem melhor confiabilidade para as VMs em um conjunto de disponibilidade porque os discos ficam suficientemente isolados entre si para evitar pontos únicos de falha.</span><span class="sxs-lookup"><span data-stu-id="c09e0-324">[Managed Disks][managed-disks] provide better reliability for VMs in an availability set, because the disks are sufficiently isolated from each other to avoid single points of failure.</span></span> <span data-ttu-id="c09e0-325">Além disso, os Managed Disks não estão sujeitos a limites de IOPS de VHDs criados em uma conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c09e0-325">Also, Managed Disks aren't subject to the IOPS limits of VHDs created in a storage account.</span></span> <span data-ttu-id="c09e0-326">Para saber mais, consulte [Gerenciar a disponibilidade de máquinas virtuais Windows no Azure][vm-manage-availability].</span><span class="sxs-lookup"><span data-stu-id="c09e0-326">For more information, see [Manage the availability of Windows virtual machines in Azure][vm-manage-availability].</span></span>

<span data-ttu-id="c09e0-327">**Instale aplicativos em um disco de dados, não no disco de SO.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-327">**Install applications on a data disk, not the OS disk.**</span></span> <span data-ttu-id="c09e0-328">Caso contrário, você poderá atingir o limite de tamanho do disco.</span><span class="sxs-lookup"><span data-stu-id="c09e0-328">Otherwise, you may reach the disk size limit.</span></span>

<span data-ttu-id="c09e0-329">**Use o Backup do Azure para fazer backup de VMs.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-329">**Use Azure Backup to back up VMs.**</span></span> <span data-ttu-id="c09e0-330">Os backups protegem contra perda de dados acidental.</span><span class="sxs-lookup"><span data-stu-id="c09e0-330">Backups protect against accidental data loss.</span></span> <span data-ttu-id="c09e0-331">Para obter mais informações, consulte [Proteger VMs do Azure com um cofre de serviços de recuperação](/azure/backup/backup-azure-vms-first-look-arm/).</span><span class="sxs-lookup"><span data-stu-id="c09e0-331">For more information, see [Protect Azure VMs with a recovery services vault](/azure/backup/backup-azure-vms-first-look-arm/).</span></span>

<span data-ttu-id="c09e0-332">**Habilite logs de diagnóstico**, incluindo métricas de integridade básicas, logs de infraestrutura e [diagnóstico de inicialização][boot-diagnostics].</span><span class="sxs-lookup"><span data-stu-id="c09e0-332">**Enable diagnostic logs**, including basic health metrics, infrastructure logs, and [boot diagnostics][boot-diagnostics].</span></span> <span data-ttu-id="c09e0-333">O diagnóstico de inicialização poderá ajudar a diagnosticar uma falha de inicialização se sua VM entrar em um estado não inicializável.</span><span class="sxs-lookup"><span data-stu-id="c09e0-333">Boot diagnostics can help you diagnose a boot failure if your VM gets into a non-bootable state.</span></span> <span data-ttu-id="c09e0-334">Para obter mais informações, consulte [Visão Geral dos Logs de Diagnóstico do Azure][diagnostics-logs].</span><span class="sxs-lookup"><span data-stu-id="c09e0-334">For more information, see [Overview of Azure Diagnostic Logs][diagnostics-logs].</span></span>

<span data-ttu-id="c09e0-335">**Use a Extensão AzureLogCollector.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-335">**Use the AzureLogCollector extension.**</span></span> <span data-ttu-id="c09e0-336">(Somente VMs do Windows.) Essa extensão agrega logs da plataforma do Azure e carrega-os no Armazenamento do Azure, sem que o operador faça logon remotamente na VM.</span><span class="sxs-lookup"><span data-stu-id="c09e0-336">(Windows VMs only.) This extension aggregates Azure platform logs and uploads them to Azure storage, without the operator remotely logging into the VM.</span></span> <span data-ttu-id="c09e0-337">Para obter mais informações, consulte [Extensão do AzureLogCollector](/azure/virtual-machines/virtual-machines-windows-log-collector-extension/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="c09e0-337">For more information, see [AzureLogCollector Extension](/azure/virtual-machines/virtual-machines-windows-log-collector-extension/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span>

## <a name="virtual-network"></a><span data-ttu-id="c09e0-338">Rede Virtual</span><span class="sxs-lookup"><span data-stu-id="c09e0-338">Virtual Network</span></span>

<span data-ttu-id="c09e0-339">**Para incluir endereços IP públicos na lista de permissões ou bloqueá-los, adicione um NSG à sub-rede.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-339">**To whitelist or block public IP addresses, add an NSG to the subnet.**</span></span> <span data-ttu-id="c09e0-340">Bloqueie o acesso de usuários mal-intencionados ou permita o acesso somente de usuários que têm o privilégio de acessar o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c09e0-340">Block access from malicious users, or allow access only from users who have privilege to access the application.</span></span>

<span data-ttu-id="c09e0-341">**Crie uma investigação de integridade personalizada.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-341">**Create a custom health probe.**</span></span> <span data-ttu-id="c09e0-342">As investigações de integridade do balanceador de carga podem testar HTTP ou TCP.</span><span class="sxs-lookup"><span data-stu-id="c09e0-342">Load Balancer Health Probes can test either HTTP or TCP.</span></span> <span data-ttu-id="c09e0-343">Se uma VM for executada em um servidor HTTP, a investigação HTTP será um melhor indicador do status de integridade do que uma investigação TCP.</span><span class="sxs-lookup"><span data-stu-id="c09e0-343">If a VM runs an HTTP server, the HTTP probe is a better indicator of health status than a TCP probe.</span></span> <span data-ttu-id="c09e0-344">Para uma investigação HTTP, use um ponto de extremidade personalizado que relata a integridade geral do aplicativo, incluindo todas as dependências críticas.</span><span class="sxs-lookup"><span data-stu-id="c09e0-344">For an HTTP probe, use a custom endpoint that reports the overall health of the application, including all critical dependencies.</span></span> <span data-ttu-id="c09e0-345">Para obter mais informações, veja [Visão geral do Azure Load Balancer](/azure/load-balancer/load-balancer-overview/).</span><span class="sxs-lookup"><span data-stu-id="c09e0-345">For more information, see [Azure Load Balancer overview](/azure/load-balancer/load-balancer-overview/).</span></span>

<span data-ttu-id="c09e0-346">**Não bloqueie a investigação de integridade.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-346">**Don't block the health probe.**</span></span> <span data-ttu-id="c09e0-347">A investigação de integridade do balanceador de carga é enviada de um endereço IP conhecido, 168.63.129.16.</span><span class="sxs-lookup"><span data-stu-id="c09e0-347">The Load Balancer Health probe is sent from a known IP address, 168.63.129.16.</span></span> <span data-ttu-id="c09e0-348">Não bloqueie o tráfego de ou para esse IP em nenhuma política de firewall ou regra de NSG (Grupo de Segurança de Rede).</span><span class="sxs-lookup"><span data-stu-id="c09e0-348">Don't block traffic to or from this IP in any firewall policies or network security group (NSG) rules.</span></span> <span data-ttu-id="c09e0-349">Bloquear a investigação de integridade faria com que o balanceador de carga remova a VM da rotação.</span><span class="sxs-lookup"><span data-stu-id="c09e0-349">Blocking the health probe would cause the load balancer to remove the VM from rotation.</span></span>

<span data-ttu-id="c09e0-350">**Habilite o registro em log do balanceador de carga.**</span><span class="sxs-lookup"><span data-stu-id="c09e0-350">**Enable Load Balancer logging.**</span></span> <span data-ttu-id="c09e0-351">Os logs de mostram quantas muitas VMs no back-end não estão recebendo o tráfego de rede devido a respostas de investigação com falha.</span><span class="sxs-lookup"><span data-stu-id="c09e0-351">The logs show how many VMs on the back-end are not receiving network traffic due to failed probe responses.</span></span> <span data-ttu-id="c09e0-352">Para obter mais informações, consulte [Log Analytics para o Azure Load Balancer](/azure/load-balancer/load-balancer-monitor-log/).</span><span class="sxs-lookup"><span data-stu-id="c09e0-352">For more information, see [Log analytics for Azure Load Balancer](/azure/load-balancer/load-balancer-monitor-log/).</span></span>

<!-- links -->
[boot-diagnostics]: https://azure.microsoft.com/blog/boot-diagnostics-for-virtual-machines-v2/
[diagnostics-logs]: /azure/monitoring-and-diagnostics/monitoring-overview-of-diagnostic-logs/
[managed-disks]: /azure/storage/storage-managed-disks-overview
[search-optimization]: /azure/search/search-performance-optimization/
[site-recovery]: /azure/site-recovery/
[site-recovery-test]: /azure/site-recovery/site-recovery-test-failover-to-azure
[sql-backup]: /azure/sql-database/sql-database-automated-backups/
[sql-restore]: /azure/sql-database/sql-database-recovery-using-backups/
[vm-manage-availability]: /azure/virtual-machines/windows/manage-availability#use-managed-disks-for-vms-in-an-availability-set
