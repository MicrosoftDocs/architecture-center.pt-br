---
title: Lista de verificação de disponibilidade
titleSuffix: Azure Design Review Framework
description: Lista de verificação que fornece orientação para questões de disponibilidade durante a criação.
author: dragon119
ms.date: 11/26/2018
ms.custom: checklist
ms.openlocfilehash: 37e61b35d73007b9bac1ebaecfbf42792ae3903b
ms.sourcegitcommit: 4ba3304eebaa8c493c3e5307bdd9d723cd90b655
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 12/12/2018
ms.locfileid: "53307224"
---
# <a name="availability-checklist"></a>Lista de verificação de disponibilidade

Disponibilidade é a proporção de tempo na qual um sistema é funcional e está operando, e é um dos [pilares da qualidade de software](../guide/pillars.md). Use essa lista de verificação para analisar a arquitetura do aplicativo sob um ponto de vista de disponibilidade.

## <a name="application-design"></a>Design do aplicativo

**Evite quaisquer pontos únicos de falha.**  Todos os componentes, serviços, recursos e instâncias de computação devem ser implantados como várias instâncias para impedir que um ponto único de falha afete a disponibilidade. Isso inclui os mecanismos de autenticação. Projete o aplicativo de modo que ele seja configurável, para usar várias instâncias e para, automaticamente, detectar falhas e redirecionar solicitações para instâncias sem falha sempre que a plataforma não fizer isso automaticamente.

**Decompor as cargas de trabalho por objetivo de nível de serviço.**  Se um serviço for composto por cargas de trabalho críticas e outras menos críticas, gerencie-as de maneira diferente e especifique os recursos de serviço e o número de instâncias para atender aos requisitos de disponibilidade dessas cargas de trabalho.

**Minimize e entenda as dependências de serviço.**  Minimize o número de serviços diferentes usados sempre que possível e certifique-se de compreender todas as dependências de recurso e de serviço que existem no sistema. Isso inclui a natureza dessas dependências e o impacto da falha ou redução do desempenho em cada uma delas, no aplicativo como um todo.

**Criar tarefas e mensagens para serem idempotentes onde for possível**. Uma operação é idempotente caso possa ser repetida várias vezes e produzir o mesmo resultado. A idempotência pode garantir que solicitações duplicadas não causem problemas. Consumidores de mensagens e as operações que eles realizam devem ser idempotentes de modo que repetir uma operação executada anteriormente não torne os resultados inválidos. Isso pode significar detecção duplicada de mensagens, ou garantir a consistência usando uma abordagem otimista para tratar dos conflitos.

**Use um agente de mensagem que implemente alta disponibilidade para transações críticas.** Muitos aplicativos de nuvem usam sistemas de mensagens para iniciar tarefas que são executadas de forma assíncrona. Para garantir a entrega de mensagens, o sistema de mensagens deve oferecer alta disponibilidade. O [Sistema de Mensagens do Barramento de Serviço do Azure](/azure/service-bus-messaging) implementa a semântica *pelo menos uma vez*. Isso significa que uma mensagem publicada em uma fila não será perdida, embora possa ocorrer entrega de cópias duplicadas em determinadas circunstâncias. Se o processamento de mensagens for idempotente (consulte o item anterior), a repetição na entrega não deverá ser um problema.

**Criar aplicativos que degradem normalmente.** A carga em um aplicativo pode exceder a capacidade de uma ou mais partes, causando disponibilidade reduzida e conexões com falha. O dimensionamento pode ajudar a minimizar esse problema, mas ele pode atingir um limite imposto por outros fatores como disponibilidade de recursos ou custo. Quando um aplicativo atinge o limite de um recurso, ele deve tomar uma ação apropriada para minimizar o impacto para o usuário. Por exemplo, em um sistema de comércio eletrônico, se o subsistema de processamento de pedidos estiver sobrecarregado ou falhar, ele poderá ser desabilitado temporariamente, enquanto permite outras funcionalidades, como procurar no catálogo de produtos. Pode ser apropriado adiar solicitações a um subsistema com falha permitindo ainda, por exemplo, que os clientes enviem pedidos, mas salvando-os para processamento posterior, quando o subsistema de pedidos estiver disponível novamente.

**Tratar eventos rápidos de intermitência normalmente.** A maioria dos aplicativos precisa lidar com cargas de trabalho que variam ao longo do tempo. O dimensionamento automático pode ajudar a lidar com a carga, mas pode levar algum tempo para instâncias adicionais ficarem online e tratarem das solicitações. Evite que picos de atividade repentinos e inesperados sobrecarreguem o aplicativo: projete-o de modo que coloque em fila as solicitações para os serviços que usa e diminua normalmente o processamento quando as filas estiverem próximas da capacidade total. Verifique se há desempenho e capacidade disponível suficientes sob condições sem intermitência para esvaziar as filas e tratar de solicitações pendentes. Para saber mais, confira [Padrão de nivelamento de carga baseado em fila](../patterns/queue-based-load-leveling.md).

## <a name="deployment-and-maintenance"></a>Implantação e manutenção

**Implante várias instâncias de serviços.** Se seu aplicativo depender de uma única instância de um serviço, ele criará um único ponto de falha. O provisionamento de várias instâncias melhora a resiliência e a escalabilidade. Para o [Serviço de Aplicativo do Azure](/azure/app-service/app-service-value-prop-what-is/), selecione um [Plano do Serviço de Aplicativo](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/) que oferece várias instâncias. Para Serviços de Nuvem do Azure, configure cada uma das suas funções para usar [várias instâncias](/azure/cloud-services/cloud-services-choose-me/#scaling-and-management). Para [VMs (Máquinas Virtuais) do Azure](/azure/virtual-machines/virtual-machines-windows-about/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json), verifique se sua arquitetura de VM inclui mais de uma VM e se cada VM está incluída em um [conjunto de disponibilidade][availability-sets].

**Considere implantar o aplicativo entre várias regiões.** Se seu aplicativo é implantado em uma única região, no caso raro de toda a região ficar não disponível, o aplicativo também fica não disponível. Isso pode ser inaceitável segundo os termos do SLA do aplicativo. Nesse caso, considere implantar o aplicativo e os respectivos serviços entre várias regiões.

**Automatizar e testar tarefas de implantação e manutenção.**  Aplicativos distribuídos consistem em várias partes que devem trabalhar em conjunto. A implantação deve ser automatizada, usando mecanismos testados e aprovados como scripts. Eles podem atualizar e validar a configuração e automatizar o processo de implantação. Use [Modelos do Azure Resource Manager](/azure/azure-resource-manager/resource-group-authoring-templates) para provisionar recursos do Azure. Use também técnicas automatizadas para executar atualizações de aplicativo. É fundamental testar todos esses processos integralmente, para garantir que não existirá tempo de inatividade adicional devido a erros. Todas as ferramentas de implantação devem ter restrições de segurança adequadas, para proteger o aplicativo implantado; defina e imponha políticas de implantação cuidadosamente e minimize a necessidade de intervenção humana.

**Use recursos de preparo e produção da plataforma**. Por exemplo, o Serviço de Aplicativo do Azure oferece suporte a [slots de implantação](/azure/app-service/web-sites-staged-publishing), os quais você pode usar para preparar uma implantação antes de trocar para produção. O Azure Service Fabric oferece suporte a [atualizações sem interrupção](/azure/service-fabric/service-fabric-application-upgrade) para serviços de aplicativo.

**Colocar máquinas virtuais (VMs) em um conjunto de disponibilidade.** Para maximizar a disponibilidade, crie várias instâncias de cada função VM e coloque essas instâncias no mesmo conjunto de disponibilidade. Caso tenha várias VMs que servem a funções diferentes, como diferentes camadas do aplicativo, crie um conjunto de disponibilidade para cada função VM. Por exemplo, crie um conjunto de disponibilidade para a camada da Web e outro para a camada de dados.

**Replique VMs usando o Azure Site Recovery.** Para maximizar a disponibilidade, replique todas as máquinas virtuais em outra região do Azure usando a [Recuperação de Site][site-recovery]. Certifique-se de que todas as VMs em todas as camadas de seu aplicativo sejam replicadas. Se houver uma interrupção na região de origem, faça o failover das VMs em outra região em questão de minutos.

## <a name="data-management"></a>Gerenciamento de dados

**Dados de replicação geográfica no Armazenamento do Azure**. Os dados no Armazenamento do Azure são replicados automaticamente em um data center. Para obter uma disponibilidade ainda maior, use o armazenamento com redundância geográfica com acesso de Leitura (-RAGRS), que replica os dados para uma região secundária e fornece acesso somente leitura aos dados no local secundário. Os dados são duráveis mesmo no caso de uma interrupção regional completa ou de um desastre. Para saber mais, veja [Replicação do Armazenamento do Azure](/azure/storage/storage-redundancy).

**Bancos de dados de replicação geográfica**. O Banco de Dados SQL do Azure e o Cosmos DB dão suporte à replicação geográfica, o que permite que você configure as réplicas de banco de dados secundário em outras regiões. Os bancos de dados secundários estão disponíveis para consulta e failover no caso de uma paralisação do data center ou da incapacidade de conectar ao banco de dados primário. Para saber mais, confira [Grupos de failover e replicação geográfica ativa](/azure/sql-database/sql-database-geo-replication-overview) (Banco de Dados SQL) e [Como distribuir dados globalmente com o Azure Cosmos DB](/azure/cosmos-db/distribute-data-globally).

**Use simultaneidade otimista e consistência eventual**. Transações que impedem o acesso a recursos por meio de bloqueio (simultaneidade pessimista) podem causar baixo desempenho e reduzir consideravelmente a disponibilidade. Esses problemas podem se tornar especialmente críticos em sistemas distribuídos. Em muitos casos, um design cuidadoso e técnicas como particionamento podem minimizar a possibilidade de ocorrência de atualizações conflitantes. Quando os dados forem replicados, ou lidos a partir de um repositório atualizado separadamente, serão consistentes apenas eventualmente. Mas as vantagens normalmente compensam o impacto na disponibilidade do uso de transações, a fim de garantir consistência imediata.

**Use backup periódico e restauração pontual**. Faça regularmente e automaticamente o backup de dados que não são preservados em outro local; além disso, verifique se é possível restaurar de modo confiável tanto os dados quanto o aplicativo em si caso uma falha ocorra. Verifique se os backups atendem ao seu Objetivo de Ponto de Recuperação (RPO). A replicação de dados não é um recurso de backup porque o erro humano ou operações maliciosas podem corromper dados em todas as réplicas. O processo de backup deve ser seguro, para proteger os dados em trânsito e em armazenamento. Bancos de dados ou partes de um repositório de dados podem geralmente ser recuperados para seu estado em um ponto anterior no tempo, usando logs de transação. Para obter mais informações, confira [Recuperação de dados corrompidos ou exclusão acidental](../resiliency/recovery-data-corruption.md)

**Replique discos de VMs usando o Azure Site Recovery.** Quando você replicar VMs do Azure usando a [Recuperação de Site][site-recovery], todos os discos de VM serão replicados continuamente para a região de destino assincronamente. Os pontos de replicação são criados a cada poucos minutos. Isso fornece um RPO na ordem de minutos.

## <a name="errors-and-failures"></a>Erros e falhas

**Configure o tempo limite de solicitações.** Serviços e recursos podem tornar-se indisponíveis, fazendo com que determinadas solicitações falhem. Certifique-se de que os tempos limite aplicados sejam apropriados a cada serviço ou recurso, bem como ao cliente que o acessa. Em alguns casos, você pode permitir um tempo limite maior para uma instância específica de um cliente, dependendo do contexto e de outras ações que o cliente esteja realizando. Um tempo limite muito curto pode causar uma quantidade excessiva de operações de nova tentativa para serviços e recursos com uma latência considerável. Tempos limite muito longos pode causar um bloqueio se uma grande quantidade de solicitações for enfileirada, aguardando a resposta de um serviço ou recurso.

**Repita operações com falha causadas por falhas transitórias.**  Crie uma estratégia de repetição para acessar todos os serviços e recursos nos casos em que eles não oferecem suporte inerente a repetição automática de conexão. Use uma estratégia que inclui um atraso cada vez maior entre as repetições à medida que o número de falhas aumenta, a fim de evitar a sobrecarga do recurso e permitir que ele se recupere normalmente e processe as solicitações em fila. Repetições contínuas com atrasos muito curtos provavelmente agravarão o problema. Para saber mais, consulte [Diretrizes de repetição para serviços específicos](../best-practices/retry-service-specific.md).

**Implemente a interrupção de circuito para evitar falhas em cascata.** Pode haver situações nas quais falhas transitórias ou de outro tipo, que variam quanto à severidade desde uma perda parcial de conectividade até falha total de um serviço, demoram muito mais que o esperado para retornar ao normal. Se um serviço estiver muito ocupado, uma falha em uma parte do sistema pode levar a falhas em cascata e resultar no bloqueio de muitas operações, além de ocupar, simultaneamente, recursos críticos do sistema, como memória, threads e conexões de banco de dados. Em vez de repetir continuamente uma operação com pouca probabilidade de êxito, o aplicativo deve aceitar rapidamente que a operação falhou e lidar normalmente com essa falha. Use o Padrão de Disjuntor para rejeitar as solicitações para operações específicas por períodos definidos. Para saber mais, confira [Padrão de disjuntor](../patterns/circuit-breaker.md).

**Componha ou faça fallback para vários componentes.** Crie aplicativos para usar múltiplas instâncias sem afetar a operação e as conexões existentes, sempre que possível. Use múltiplas instâncias e distribua solicitações entre elas. Além disso, detecte instâncias com falha e evite enviar solicitações a elas, para maximizar a disponibilidade.

**Faça fallback para um serviço ou fluxo de trabalho diferente.** Por exemplo, se a gravação no Banco de Dados SQL falhar, armazene temporariamente os dados no armazenamento de blobs ou Cache Redis. Forneça uma forma para repetir as gravações no Banco de Dados SQL quando o serviço ficar disponível. Em alguns casos, uma operação com falha pode ter uma ação alternativa que permite que o aplicativo continue a funcionar mesmo quando um componente ou serviço falha. Se possível, detecte as falhas e redirecione as solicitações para outros serviços que possam oferecer uma funcionalidade alternativa adequada, ou então para instâncias de backup ou redução de funcionalidade, que possam manter as operações principais enquanto o serviço primário estiver offline.

## <a name="monitoring-and-disaster-recovery"></a>Monitoramento e recuperação de desastres

**Forneça instrumentação avançada para falhas prováveis e eventos de falha** , para reportar a situação à equipe de operações. Para falhas que provavelmente ocorrerão mas ainda não ocorreram, forneça dados suficientes para permitir que a equipe de operações determine a causa, atenue a situação e garanta que o sistema permaneça disponível. Para falhas que já ocorreram, o aplicativo deve retornar uma mensagem de erro apropriada para o usuário mas tentar continuar em execução, mesmo que com funcionalidade reduzida. Em todos os casos, o sistema de monitoramento deve capturar detalhes abrangentes para permitir que a equipe de operações efetue uma recuperação rápida e, se necessário, para que designers e desenvolvedores modifiquem o sistema para impedir que a situação ocorra novamente.

**Monitore a integridade do sistema implementando funções de verificação.**  A integridade e o desempenho de um aplicativo podem diminuir ao longo do tempo sem que essa mudança seja perceptível, até o aplicativo falhar. Implemente investigações ou verifique funções que são executadas regularmente de fora do aplicativo. Essas verificações podem ser tão simples quanto medir o tempo de resposta para o aplicativo como um todo, para partes individuais do aplicativo, para os serviços individuais que o aplicativo usa ou para componentes individuais. Funções de verificação podem executar processos para garantir que eles produzem resultados válidos, medir a latência e verificar a disponibilidade, além de extrair informações do sistema.

**Teste regularmente todos os sistemas de failover e fallback.** As alterações aos sistemas e operações podem afetar as funções de failover e fallback, mas o impacto pode não ser detectado até que o sistema principal falhe ou fique sobrecarregado. Teste-o antes que ele seja exigido para compensar um problema em tempo real e em tempo de execução. Se você estiver usando o [Azure Site Recovery][site-recovery] para replicar máquinas virtuais, execute as análises de recuperação de desastres periodicamente ao fazer um failover de teste. Para saber mais, confira [Realizar uma análise detalhada da recuperação de desastre para o Azure][site-recovery-test].

**Teste os sistemas de monitoramento.**  Sistemas automatizados de failover e fallback e visualização manual de desempenho e integridade do sistema pelo uso de painéis dependem, todos, do funcionamento correto da instrumentação e do monitoramento. Se esses elementos falharem, perderem informações essenciais ou relatarem dados imprecisos, um operador poderá deixar de perceber que o sistema não está íntegro ou que está falhando.

**Acompanhe o progresso de fluxos de trabalho de longa execução e tente novamente em caso de falha.** Fluxos de trabalho de longa execução geralmente são compostos de várias etapas. Certifique-se de que cada etapa seja independente e possa ser repetida para minimizar a chance de que todo o fluxo de trabalho precise ser revertido, ou que várias transações de compensação precisem ser executadas. Monitore e gerencie o progresso de fluxos de trabalho de longa duração implementando um padrão como o [Padrão de supervisor de agente do agendador](../patterns/scheduler-agent-supervisor.md).

**Planeje-se para a eventualidade de uma recuperação de desastre.** Crie um plano totalmente testado e aceito para a recuperação de qualquer tipo de falha que possa afetar a disponibilidade do sistema. Escolha uma arquitetura de recuperação de desastres em vários locais para os aplicativos de missão crítica. Identifique um proprietário específico do plano de recuperação de desastres, incluindo automação e testes. Certifique-se de que o plano esteja bem documentado e automatize o processo tanto quanto possível. Estabeleça uma estratégia de backup para todos os dados de referência e transacionais e teste a restauração desses backups regularmente. Treine a equipe de operações para executar o plano e executar regularmente simulações de desastres para validar e aprimorar o plano. Se você estiver usando o [Azure Site Recovery][site-recovery] para replicar máquinas virtuais, crie um plano de recuperação totalmente automatizado para fazer o failover de todo o aplicativo em questão de minutos.

<!-- links -->
[availability-sets]:/azure/virtual-machines/virtual-machines-windows-manage-availability/
[site-recovery]: /azure/site-recovery/
[site-recovery-test]: /azure/site-recovery/site-recovery-test-failover-to-azure
