---
title: Trabalhar com identidades baseadas em declarações em aplicativos multilocatários
description: Como usar declarações para autorização e validação de emissor
author: MikeWasson
ms:date: 07/21/2017
pnp.series.title: Manage Identity in Multitenant Applications
pnp.series.prev: authenticate
pnp.series.next: signup
ms.openlocfilehash: 46c43c9bfa4514f206b5e7eabd9223ad4c61628b
ms.sourcegitcommit: 94d50043db63416c4d00cebe927a0c88f78c3219
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/28/2018
ms.locfileid: "47429359"
---
# <a name="work-with-claims-based-identities"></a><span data-ttu-id="dabaf-103">Trabalhar com identidades baseadas em declarações</span><span class="sxs-lookup"><span data-stu-id="dabaf-103">Work with claims-based identities</span></span>

<span data-ttu-id="dabaf-104">[Código de exemplo do ![GitHub](../_images/github.png)][sample application]</span><span class="sxs-lookup"><span data-stu-id="dabaf-104">[![GitHub](../_images/github.png) Sample code][sample application]</span></span>

## <a name="claims-in-azure-ad"></a><span data-ttu-id="dabaf-105">Declarações no Azure AD</span><span class="sxs-lookup"><span data-stu-id="dabaf-105">Claims in Azure AD</span></span>
<span data-ttu-id="dabaf-106">Quando um usuário faz logon, o Microsoft Azure AD envia um token de ID que contém um conjunto de declarações sobre o usuário.</span><span class="sxs-lookup"><span data-stu-id="dabaf-106">When a user signs in, Azure AD sends an ID token that contains a set of claims about the user.</span></span> <span data-ttu-id="dabaf-107">Uma declaração é simplesmente uma informação expressada como um par chave/valor.</span><span class="sxs-lookup"><span data-stu-id="dabaf-107">A claim is simply a piece of information, expressed as a key/value pair.</span></span> <span data-ttu-id="dabaf-108">Por exemplo, `email`=`bob@contoso.com`.</span><span class="sxs-lookup"><span data-stu-id="dabaf-108">For example, `email`=`bob@contoso.com`.</span></span>  <span data-ttu-id="dabaf-109">Declarações têm um emissor &mdash; nesse caso, o Azure AD &mdash;, que é a entidade que autentica o usuário e cria as declarações.</span><span class="sxs-lookup"><span data-stu-id="dabaf-109">Claims have an issuer &mdash; in this case, Azure AD &mdash; which is the entity that authenticates the user and creates the claims.</span></span> <span data-ttu-id="dabaf-110">Você confia nas declarações porque confia no emissor.</span><span class="sxs-lookup"><span data-stu-id="dabaf-110">You trust the claims because you trust the issuer.</span></span> <span data-ttu-id="dabaf-111">(Por outro lado, se você não confiar o emissor, não confiará nas declarações.)</span><span class="sxs-lookup"><span data-stu-id="dabaf-111">(Conversely, if you don't trust the issuer, don't trust the claims!)</span></span>

<span data-ttu-id="dabaf-112">Em um alto nível:</span><span class="sxs-lookup"><span data-stu-id="dabaf-112">At a high level:</span></span>

1. <span data-ttu-id="dabaf-113">O usuário é autenticado.</span><span class="sxs-lookup"><span data-stu-id="dabaf-113">The user authenticates.</span></span>
2. <span data-ttu-id="dabaf-114">O IDP envia um conjunto de declarações.</span><span class="sxs-lookup"><span data-stu-id="dabaf-114">The IDP sends a set of claims.</span></span>
3. <span data-ttu-id="dabaf-115">O aplicativo normaliza ou amplia as declarações (opcional).</span><span class="sxs-lookup"><span data-stu-id="dabaf-115">The app normalizes or augments the claims (optional).</span></span>
4. <span data-ttu-id="dabaf-116">O aplicativo usa as declarações para tomar decisões sobre a autorização.</span><span class="sxs-lookup"><span data-stu-id="dabaf-116">The app uses the claims to make authorization decisions.</span></span>

<span data-ttu-id="dabaf-117">No OpenID Connect, o conjunto de declarações que você obtém é controlado pelo [parâmetro de escopo] da solicitação de autenticação.</span><span class="sxs-lookup"><span data-stu-id="dabaf-117">In OpenID Connect, the set of claims that you get is controlled by the [scope parameter] of the authentication request.</span></span> <span data-ttu-id="dabaf-118">No entanto, o Azure AD emite um conjunto limitado de declarações por meio do OpenID Connect; consulte [Tipos de declaração e token com suporte].</span><span class="sxs-lookup"><span data-stu-id="dabaf-118">However, Azure AD issues a limited set of claims through OpenID Connect; see [Supported Token and Claim Types].</span></span> <span data-ttu-id="dabaf-119">Se você quiser mais informações sobre o usuário, será preciso usar a API do Graph do Microsoft Azure AD.</span><span class="sxs-lookup"><span data-stu-id="dabaf-119">If you want more information about the user, you'll need to use the Azure AD Graph API.</span></span>

<span data-ttu-id="dabaf-120">Eis algumas declarações do AAD que normalmente são relevantes para um aplicativo:</span><span class="sxs-lookup"><span data-stu-id="dabaf-120">Here are some of the claims from AAD that an app might typically care about:</span></span>

| <span data-ttu-id="dabaf-121">Tipo de declaração no token de ID</span><span class="sxs-lookup"><span data-stu-id="dabaf-121">Claim type in ID token</span></span> | <span data-ttu-id="dabaf-122">DESCRIÇÃO</span><span class="sxs-lookup"><span data-stu-id="dabaf-122">Description</span></span> |
| --- | --- |
| <span data-ttu-id="dabaf-123">aud</span><span class="sxs-lookup"><span data-stu-id="dabaf-123">aud</span></span> |<span data-ttu-id="dabaf-124">A pessoa para quem o token foi emitido.</span><span class="sxs-lookup"><span data-stu-id="dabaf-124">Who the token was issued for.</span></span> <span data-ttu-id="dabaf-125">Essa será a ID de cliente do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="dabaf-125">This will be the application's client ID.</span></span> <span data-ttu-id="dabaf-126">Em geral, você não deve se preocupar com essa declaração, pois o middleware a valida automaticamente.</span><span class="sxs-lookup"><span data-stu-id="dabaf-126">Generally, you shouldn't need to worry about this claim, because the middleware automatically validates it.</span></span> <span data-ttu-id="dabaf-127">Exemplo: `"91464657-d17a-4327-91f3-2ed99386406f"`</span><span class="sxs-lookup"><span data-stu-id="dabaf-127">Example:  `"91464657-d17a-4327-91f3-2ed99386406f"`</span></span> |
| <span data-ttu-id="dabaf-128">groups</span><span class="sxs-lookup"><span data-stu-id="dabaf-128">groups</span></span> |<span data-ttu-id="dabaf-129">Uma lista de grupos do AAD dos quais o usuário é membro.</span><span class="sxs-lookup"><span data-stu-id="dabaf-129">A list of AAD groups of which the user is a member.</span></span> <span data-ttu-id="dabaf-130">Exemplo: `["93e8f556-8661-4955-87b6-890bc043c30f", "fc781505-18ef-4a31-a7d5-7d931d7b857e"]`</span><span class="sxs-lookup"><span data-stu-id="dabaf-130">Example: `["93e8f556-8661-4955-87b6-890bc043c30f", "fc781505-18ef-4a31-a7d5-7d931d7b857e"]`</span></span> |
| <span data-ttu-id="dabaf-131">iss</span><span class="sxs-lookup"><span data-stu-id="dabaf-131">iss</span></span> |<span data-ttu-id="dabaf-132">O [emissor] do token OIDC.</span><span class="sxs-lookup"><span data-stu-id="dabaf-132">The [issuer] of the OIDC token.</span></span> <span data-ttu-id="dabaf-133">Exemplo: `https://sts.windows.net/b9bd2162-77ac-4fb2-8254-5c36e9c0a9c4/`</span><span class="sxs-lookup"><span data-stu-id="dabaf-133">Example: `https://sts.windows.net/b9bd2162-77ac-4fb2-8254-5c36e9c0a9c4/`</span></span> |
| <span data-ttu-id="dabaf-134">Nome</span><span class="sxs-lookup"><span data-stu-id="dabaf-134">name</span></span> |<span data-ttu-id="dabaf-135">O nome de exibição do usuário.</span><span class="sxs-lookup"><span data-stu-id="dabaf-135">The user's display name.</span></span> <span data-ttu-id="dabaf-136">Exemplo: `"Alice A."`</span><span class="sxs-lookup"><span data-stu-id="dabaf-136">Example: `"Alice A."`</span></span> |
| <span data-ttu-id="dabaf-137">oid</span><span class="sxs-lookup"><span data-stu-id="dabaf-137">oid</span></span> |<span data-ttu-id="dabaf-138">O identificador do objeto para o usuário no AAD.</span><span class="sxs-lookup"><span data-stu-id="dabaf-138">The object identifier for the user in AAD.</span></span> <span data-ttu-id="dabaf-139">Esse valor é o identificador imutável e não reutilizável do usuário.</span><span class="sxs-lookup"><span data-stu-id="dabaf-139">This value is the immutable and non-reusable identifier of the user.</span></span> <span data-ttu-id="dabaf-140">Use esse valor e não o email, como um identificador exclusivo para os usuários, pois endereços de email podem mudar.</span><span class="sxs-lookup"><span data-stu-id="dabaf-140">Use this value, not email, as a unique identifier for users; email addresses can change.</span></span> <span data-ttu-id="dabaf-141">Se você usar a API do Graph do Microsoft Azure AD no seu aplicativo, a ID de objeto é o valor usado para consultar informações do perfil.</span><span class="sxs-lookup"><span data-stu-id="dabaf-141">If you use the Azure AD Graph API in your app, object ID is that value used to query profile information.</span></span> <span data-ttu-id="dabaf-142">Exemplo: `"59f9d2dc-995a-4ddf-915e-b3bb314a7fa4"`</span><span class="sxs-lookup"><span data-stu-id="dabaf-142">Example: `"59f9d2dc-995a-4ddf-915e-b3bb314a7fa4"`</span></span> |
| <span data-ttu-id="dabaf-143">roles</span><span class="sxs-lookup"><span data-stu-id="dabaf-143">roles</span></span> |<span data-ttu-id="dabaf-144">Uma lista de funções de aplicativo para o usuário.</span><span class="sxs-lookup"><span data-stu-id="dabaf-144">A list of app roles for the user.</span></span>    <span data-ttu-id="dabaf-145">Exemplo: `["SurveyCreator"]`</span><span class="sxs-lookup"><span data-stu-id="dabaf-145">Example: `["SurveyCreator"]`</span></span> |
| <span data-ttu-id="dabaf-146">tid</span><span class="sxs-lookup"><span data-stu-id="dabaf-146">tid</span></span> |<span data-ttu-id="dabaf-147">ID do locatário.</span><span class="sxs-lookup"><span data-stu-id="dabaf-147">Tenant ID.</span></span> <span data-ttu-id="dabaf-148">Esse valor é um identificador exclusivo do locatário no Azure AD.</span><span class="sxs-lookup"><span data-stu-id="dabaf-148">This value is a unique identifier for the tenant in Azure AD.</span></span> <span data-ttu-id="dabaf-149">Exemplo: `"b9bd2162-77ac-4fb2-8254-5c36e9c0a9c4"`</span><span class="sxs-lookup"><span data-stu-id="dabaf-149">Example: `"b9bd2162-77ac-4fb2-8254-5c36e9c0a9c4"`</span></span> |
| <span data-ttu-id="dabaf-150">unique_name</span><span class="sxs-lookup"><span data-stu-id="dabaf-150">unique_name</span></span> |<span data-ttu-id="dabaf-151">Um nome de exibição do usuário que pode ser lido por humanos.</span><span class="sxs-lookup"><span data-stu-id="dabaf-151">A human readable display name of the user.</span></span> <span data-ttu-id="dabaf-152">Exemplo: `"alice@contoso.com"`</span><span class="sxs-lookup"><span data-stu-id="dabaf-152">Example: `"alice@contoso.com"`</span></span> |
| <span data-ttu-id="dabaf-153">upn</span><span class="sxs-lookup"><span data-stu-id="dabaf-153">upn</span></span> |<span data-ttu-id="dabaf-154">Nome do usuário principal.</span><span class="sxs-lookup"><span data-stu-id="dabaf-154">User principal name.</span></span> <span data-ttu-id="dabaf-155">Exemplo: `"alice@contoso.com"`</span><span class="sxs-lookup"><span data-stu-id="dabaf-155">Example: `"alice@contoso.com"`</span></span> |

<span data-ttu-id="dabaf-156">Essa tabela lista os tipos de declaração que aparecem no token de ID.</span><span class="sxs-lookup"><span data-stu-id="dabaf-156">This table lists the claim types as they appear in the ID token.</span></span> <span data-ttu-id="dabaf-157">No ASP.NET Core, o middleware do OpenID Connect converte alguns dos tipos de declaração quando popula a coleção Declarações do usuário principal:</span><span class="sxs-lookup"><span data-stu-id="dabaf-157">In ASP.NET Core, the OpenID Connect middleware converts some of the claim types when it populates the Claims collection for the user principal:</span></span>

* <span data-ttu-id="dabaf-158">oid > `http://schemas.microsoft.com/identity/claims/objectidentifier`</span><span class="sxs-lookup"><span data-stu-id="dabaf-158">oid > `http://schemas.microsoft.com/identity/claims/objectidentifier`</span></span>
* <span data-ttu-id="dabaf-159">tid > `http://schemas.microsoft.com/identity/claims/tenantid`</span><span class="sxs-lookup"><span data-stu-id="dabaf-159">tid > `http://schemas.microsoft.com/identity/claims/tenantid`</span></span>
* <span data-ttu-id="dabaf-160">unique_name > `http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name`</span><span class="sxs-lookup"><span data-stu-id="dabaf-160">unique_name > `http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name`</span></span>
* <span data-ttu-id="dabaf-161">upn > `http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn`</span><span class="sxs-lookup"><span data-stu-id="dabaf-161">upn > `http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn`</span></span>

## <a name="claims-transformations"></a><span data-ttu-id="dabaf-162">Transformações de declarações</span><span class="sxs-lookup"><span data-stu-id="dabaf-162">Claims transformations</span></span>
<span data-ttu-id="dabaf-163">Durante o fluxo de autenticação, talvez você queira modificar as declarações obtidas do IDP.</span><span class="sxs-lookup"><span data-stu-id="dabaf-163">During the authentication flow, you might want to modify the claims that you get from the IDP.</span></span> <span data-ttu-id="dabaf-164">No ASP.NET Core, você pode executar a transformação de declarações dentro do evento **AuthenticationValidated** no middleware do OpenID Connect.</span><span class="sxs-lookup"><span data-stu-id="dabaf-164">In ASP.NET Core, you can perform claims transformation inside of the **AuthenticationValidated** event from the OpenID Connect middleware.</span></span> <span data-ttu-id="dabaf-165">(Confira [Eventos de autenticação].)</span><span class="sxs-lookup"><span data-stu-id="dabaf-165">(See [Authentication events].)</span></span>

<span data-ttu-id="dabaf-166">As declarações que você adicionar durante **AuthenticationValidated** serão armazenadas no cookie de autenticação de sessão.</span><span class="sxs-lookup"><span data-stu-id="dabaf-166">Any claims that you add during **AuthenticationValidated** are stored in the session authentication cookie.</span></span> <span data-ttu-id="dabaf-167">Elas não serão enviadas por push de volta ao Azure AD.</span><span class="sxs-lookup"><span data-stu-id="dabaf-167">They don't get pushed back to Azure AD.</span></span>

<span data-ttu-id="dabaf-168">Veja alguns exemplos de transformação de declarações:</span><span class="sxs-lookup"><span data-stu-id="dabaf-168">Here are some examples of claims transformation:</span></span>

* <span data-ttu-id="dabaf-169">**Normalização de declarações normalização**ou uniformizar as declarações entre os usuários.</span><span class="sxs-lookup"><span data-stu-id="dabaf-169">**Claims normalization**, or making claims consistent across users.</span></span> <span data-ttu-id="dabaf-170">Isso é especialmente relevante se você estiver obtendo declarações de vários IDPs que podem usar tipos de declaração diferentes para informações semelhantes.</span><span class="sxs-lookup"><span data-stu-id="dabaf-170">This is particularly relevant if you are getting claims from multiple IDPs, which might use different claim types for similar information.</span></span>
  <span data-ttu-id="dabaf-171">Por exemplo, o Azure AD envia uma declaração "upn" que contém o email do usuário.</span><span class="sxs-lookup"><span data-stu-id="dabaf-171">For example, Azure AD sends a "upn" claim that contains the user's email.</span></span> <span data-ttu-id="dabaf-172">Outros IDPs podem enviar uma declaração "email".</span><span class="sxs-lookup"><span data-stu-id="dabaf-172">Other IDPs might send an "email" claim.</span></span> <span data-ttu-id="dabaf-173">O código abaixo converte a declaração "upn" em uma declaração "email":</span><span class="sxs-lookup"><span data-stu-id="dabaf-173">The following code converts the "upn" claim into an "email" claim:</span></span>
  
  ```csharp
  var email = principal.FindFirst(ClaimTypes.Upn)?.Value;
  if (!string.IsNullOrWhiteSpace(email))
  {
      identity.AddClaim(new Claim(ClaimTypes.Email, email));
  }
  ```
* <span data-ttu-id="dabaf-174">Adicione **valores de declaração padrão** para declarações que não estão presentes &mdash; por exemplo, atribuir um usuário a uma função padrão.</span><span class="sxs-lookup"><span data-stu-id="dabaf-174">Add **default claim values** for claims that aren't present &mdash; for example, assigning a user to a default role.</span></span> <span data-ttu-id="dabaf-175">Em alguns casos, isso pode simplificar a lógica da autorização.</span><span class="sxs-lookup"><span data-stu-id="dabaf-175">In some cases this can simplify authorization logic.</span></span>
* <span data-ttu-id="dabaf-176">Adicione **tipos de declaração personalizada** com informações específicas do aplicativo sobre o usuário.</span><span class="sxs-lookup"><span data-stu-id="dabaf-176">Add **custom claim types** with application-specific information about the user.</span></span> <span data-ttu-id="dabaf-177">Por exemplo, você pode armazenar informações sobre o usuário em um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="dabaf-177">For example, you might store some information about the user in a database.</span></span> <span data-ttu-id="dabaf-178">Você poderia adicionar uma declaração personalizada com essas informações ao tíquete de autenticação.</span><span class="sxs-lookup"><span data-stu-id="dabaf-178">You could add a custom claim with this information to the authentication ticket.</span></span> <span data-ttu-id="dabaf-179">A declaração é armazenada em um cookie, por isso basta obtê-la no banco de dados uma vez por sessão de logon.</span><span class="sxs-lookup"><span data-stu-id="dabaf-179">The claim is stored in a cookie, so you only need to get it from the database once per login session.</span></span> <span data-ttu-id="dabaf-180">Por outro lado, também é recomendável evitar a criação de cookies excessivamente grandes, portanto você precisa considerar o equilíbrio entre o tamanho do cookie e as pesquisas de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="dabaf-180">On the other hand, you also want to avoid creating excessively large cookies, so you need to consider the trade-off between cookie size versus database lookups.</span></span>   

<span data-ttu-id="dabaf-181">Depois que o fluxo de autenticação for concluído, as declarações estarão disponíveis em `HttpContext.User`.</span><span class="sxs-lookup"><span data-stu-id="dabaf-181">After the authentication flow is complete, the claims are available in `HttpContext.User`.</span></span> <span data-ttu-id="dabaf-182">Nesse ponto, você deve tratá-los como uma coleção &mdash; somente leitura, por exemplo, usando-os para tomar decisões de autorização.</span><span class="sxs-lookup"><span data-stu-id="dabaf-182">At that point, you should treat them as a read-only collection &mdash; e.g., use them to make authorization decisions.</span></span>

## <a name="issuer-validation"></a><span data-ttu-id="dabaf-183">Validação do emissor</span><span class="sxs-lookup"><span data-stu-id="dabaf-183">Issuer validation</span></span>
<span data-ttu-id="dabaf-184">No OpenID Connect, a declaração do emissor ("iss") identifica o IDP que emitiu o token de ID.</span><span class="sxs-lookup"><span data-stu-id="dabaf-184">In OpenID Connect, the issuer claim ("iss") identifies the IDP that issued the ID token.</span></span> <span data-ttu-id="dabaf-185">Parte do fluxo de autenticação OIDC serve para verificar se a declaração do emissor corresponde ao emissor verdadeiro.</span><span class="sxs-lookup"><span data-stu-id="dabaf-185">Part of the OIDC authentication flow is to verify that the issuer claim matches the actual issuer.</span></span> <span data-ttu-id="dabaf-186">O middleware OIDC lida com isso para você.</span><span class="sxs-lookup"><span data-stu-id="dabaf-186">The OIDC middleware handles this for you.</span></span>

<span data-ttu-id="dabaf-187">No Azure AD, o valor de emissor é exclusivo por locatário do AD (`https://sts.windows.net/<tenantID>`).</span><span class="sxs-lookup"><span data-stu-id="dabaf-187">In Azure AD, the issuer value is unique per AD tenant (`https://sts.windows.net/<tenantID>`).</span></span> <span data-ttu-id="dabaf-188">Portanto, o aplicativo deve fazer uma verificação adicional para ter certeza de que o emissor representa um locatário que tem permissão para entrar no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="dabaf-188">Therefore, an application should do an additional check, to make sure the issuer represents a tenant that is allowed to sign in to the app.</span></span>

<span data-ttu-id="dabaf-189">Para um aplicativo de locatário único, você pode apenas verificar se o emissor é seu próprio locatário.</span><span class="sxs-lookup"><span data-stu-id="dabaf-189">For a single-tenant application, you can just check that the issuer is your own tenant.</span></span> <span data-ttu-id="dabaf-190">Na verdade, o middleware OIDC faz isso automaticamente por padrão.</span><span class="sxs-lookup"><span data-stu-id="dabaf-190">In fact, the OIDC middleware does this automatically by default.</span></span> <span data-ttu-id="dabaf-191">Em um aplicativo multilocatário, você precisa permitir vários emissores que correspondem a locatários diferentes.</span><span class="sxs-lookup"><span data-stu-id="dabaf-191">In a multi-tenant app, you need to allow for multiple issuers, corresponding to the different tenants.</span></span> <span data-ttu-id="dabaf-192">Veja uma abordagem geral que pode ser usada:</span><span class="sxs-lookup"><span data-stu-id="dabaf-192">Here is a general approach to use:</span></span>

* <span data-ttu-id="dabaf-193">Nas opções de middleware OIDC, defina **ValidateIssuer** como false.</span><span class="sxs-lookup"><span data-stu-id="dabaf-193">In the OIDC middleware options, set **ValidateIssuer** to false.</span></span> <span data-ttu-id="dabaf-194">Isso desliga a verificação automática.</span><span class="sxs-lookup"><span data-stu-id="dabaf-194">This turns off the automatic check.</span></span>
* <span data-ttu-id="dabaf-195">Quando um locatário se inscrever, armazene o locatário e o emissor em seu banco de dados do usuário.</span><span class="sxs-lookup"><span data-stu-id="dabaf-195">When a tenant signs up, store the tenant and the issuer in your user DB.</span></span>
* <span data-ttu-id="dabaf-196">Sempre que um usuário fizer logon, pesquise o emissor no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="dabaf-196">Whenever a user signs in, look up the issuer in the database.</span></span> <span data-ttu-id="dabaf-197">Se o emissor não for encontrado, significa que o locatário ainda não se inscreveu.</span><span class="sxs-lookup"><span data-stu-id="dabaf-197">If the issuer isn't found, it means that tenant hasn't signed up.</span></span> <span data-ttu-id="dabaf-198">Você pode redirecioná-lo para uma página de inscrição.</span><span class="sxs-lookup"><span data-stu-id="dabaf-198">You can redirect them to a sign up page.</span></span>
* <span data-ttu-id="dabaf-199">Você também pode colocar determinados locatários na lista negra, por exemplo, clientes que não pagaram suas assinaturas.</span><span class="sxs-lookup"><span data-stu-id="dabaf-199">You could also blacklist certain tenants; for example, for customers that didn't pay their subscription.</span></span>

<span data-ttu-id="dabaf-200">Para ver uma discussão mais detalhada, confira [Inscrição e integração de locatário em aplicativos multilocatário][signup].</span><span class="sxs-lookup"><span data-stu-id="dabaf-200">For a more detailed discussion, see [Sign-up and tenant onboarding in a multitenant application][signup].</span></span>

## <a name="using-claims-for-authorization"></a><span data-ttu-id="dabaf-201">Usando declarações para autorização</span><span class="sxs-lookup"><span data-stu-id="dabaf-201">Using claims for authorization</span></span>
<span data-ttu-id="dabaf-202">Com declarações, a identidade de um usuário não é uma entidade monolítica.</span><span class="sxs-lookup"><span data-stu-id="dabaf-202">With claims, a user's identity is no longer a monolithic entity.</span></span> <span data-ttu-id="dabaf-203">Por exemplo, um usuário pode ter um endereço de email, número de telefone, aniversário, sexo, etc. O IDP do usuário pode armazenar todas essas informações.</span><span class="sxs-lookup"><span data-stu-id="dabaf-203">For example, a user might have an email address, phone number, birthday, gender, etc. Maybe the user's IDP stores all of this information.</span></span> <span data-ttu-id="dabaf-204">Porém, ao autenticar o usuário, você normalmente obtém um subconjunto dessas declarações.</span><span class="sxs-lookup"><span data-stu-id="dabaf-204">But when you authenticate the user, you'll typically get a subset of these as claims.</span></span> <span data-ttu-id="dabaf-205">Neste modelo, a identidade do usuário é simplesmente um pacote de declarações.</span><span class="sxs-lookup"><span data-stu-id="dabaf-205">In this model, the user's identity is simply a bundle of claims.</span></span> <span data-ttu-id="dabaf-206">Ao tomar decisões de autorização sobre um usuário, você procura por determinados conjuntos de declarações.</span><span class="sxs-lookup"><span data-stu-id="dabaf-206">When you make authorization decisions about a user, you will look for particular sets of claims.</span></span> <span data-ttu-id="dabaf-207">Em outras palavras, a pergunta “O usuário X pode executar a ação Y?” se torna “O usuário X tem a declaração Z?”.</span><span class="sxs-lookup"><span data-stu-id="dabaf-207">In other words, the question "Can user X perform action Y" ultimately becomes "Does user X have claim Z".</span></span>

<span data-ttu-id="dabaf-208">Veja alguns padrões básicos para verificar declarações.</span><span class="sxs-lookup"><span data-stu-id="dabaf-208">Here are some basic patterns for checking claims.</span></span>

* <span data-ttu-id="dabaf-209">Para verificar se o usuário tem uma declaração específica com um valor específico:</span><span class="sxs-lookup"><span data-stu-id="dabaf-209">To check that the user has a particular claim with a particular value:</span></span>
  
   ```csharp
   if (User.HasClaim(ClaimTypes.Role, "Admin")) { ... }
   ```
   <span data-ttu-id="dabaf-210">Esse código verifica se o usuário tem uma declaração Função com o valor "Admin".</span><span class="sxs-lookup"><span data-stu-id="dabaf-210">This code checks whether the user has a Role claim with the value "Admin".</span></span> <span data-ttu-id="dabaf-211">Ele aborda corretamente o caso de usuários que não tenham a declaração Função ou tenham várias declarações Função.</span><span class="sxs-lookup"><span data-stu-id="dabaf-211">It correctly handles the case where the user has no Role claim or multiple Role claims.</span></span>
  
   <span data-ttu-id="dabaf-212">A classe **ClaimTypes** define constantes para tipos de declaração comuns.</span><span class="sxs-lookup"><span data-stu-id="dabaf-212">The **ClaimTypes** class defines constants for commonly-used claim types.</span></span> <span data-ttu-id="dabaf-213">No entanto, você pode usar qualquer valor da cadeia de caracteres para o tipo de declaração.</span><span class="sxs-lookup"><span data-stu-id="dabaf-213">However, you can use any string value for the claim type.</span></span>
* <span data-ttu-id="dabaf-214">Para obter um único valor de um tipo de declaração, quando você espera que haja no máximo um valor:</span><span class="sxs-lookup"><span data-stu-id="dabaf-214">To get a single value for a claim type, when you expect there to be at most one value:</span></span>
  
  ```csharp
  string email = User.FindFirst(ClaimTypes.Email)?.Value;
  ```
* <span data-ttu-id="dabaf-215">Para obter todos os valores de um tipo de declaração:</span><span class="sxs-lookup"><span data-stu-id="dabaf-215">To get all the values for a claim type:</span></span>
  
  ```csharp
  IEnumerable<Claim> groups = User.FindAll("groups");
  ```

<span data-ttu-id="dabaf-216">Para obter mais informações, consulte [Autorização baseada em recursos e em funções em aplicativos multilocatários][authorization].</span><span class="sxs-lookup"><span data-stu-id="dabaf-216">For more information, see [Role-based and resource-based authorization in multitenant applications][authorization].</span></span>

<span data-ttu-id="dabaf-217">[**Avançar**][signup]</span><span class="sxs-lookup"><span data-stu-id="dabaf-217">[**Next**][signup]</span></span>


<!-- Links -->

[parâmetro de escopo]: https://nat.sakimura.org/2012/01/26/scopes-and-claims-in-openid-connect/
[scope parameter]: https://nat.sakimura.org/2012/01/26/scopes-and-claims-in-openid-connect/
[Tipos de declaração e token com suporte]: /azure/active-directory/active-directory-token-and-claims/
[Supported Token and Claim Types]: /azure/active-directory/active-directory-token-and-claims/
[emissor]: https://openid.net/specs/openid-connect-core-1_0.html#IDToken
[issuer]: https://openid.net/specs/openid-connect-core-1_0.html#IDToken
[Eventos de autenticação]: authenticate.md#authentication-events
[Authentication events]: authenticate.md#authentication-events
[signup]: signup.md
[Claims-Based Authorization]: /aspnet/core/security/authorization/claims
[sample application]: https://github.com/mspnp/multitenant-saas-guidance
[authorization]: authorize.md
