---
title: CI/CD para microsserviços
description: Integração contínua e a entrega contínua para microsserviços.
author: MikeWasson
ms.date: 03/27/2019
ms.topic: guide
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: microservices
ms.openlocfilehash: f7f3f3d48087db51c40f134e3e4cf11ec58501bb
ms.sourcegitcommit: d58e6b2b891c9c99e951c59f15fce71addcb96b1
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/12/2019
ms.locfileid: "59533083"
---
# <a name="cicd-for-microservices-architectures"></a><span data-ttu-id="fcc8f-103">CI/CD para arquiteturas de microsserviços</span><span class="sxs-lookup"><span data-stu-id="fcc8f-103">CI/CD for microservices architectures</span></span>

<span data-ttu-id="fcc8f-104">Ciclos de lançamento mais rápidos são uma das principais vantagens de arquiteturas de microsserviços.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-104">Faster release cycles are one of the major advantages of microservices architectures.</span></span> <span data-ttu-id="fcc8f-105">Mas, sem um bom processo de CI/CD, você não obterá a agilidade que os microsserviços prometem.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-105">But without a good CI/CD process, you won't achieve the agility that microservices promise.</span></span> <span data-ttu-id="fcc8f-106">Este artigo descreve os desafios e recomenda algumas abordagens para o problema.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-106">This article describes the challenges and recommends some approaches to the problem.</span></span>

## <a name="what-is-cicd"></a><span data-ttu-id="fcc8f-107">O que é o CI/CD?</span><span class="sxs-lookup"><span data-stu-id="fcc8f-107">What is CI/CD?</span></span>

<span data-ttu-id="fcc8f-108">Quando falamos sobre CI/CD, realmente falamos vários processos relacionados: Integração contínua, entrega contínua e implantação contínua.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-108">When we talk about CI/CD, we're really talking about several related processes: Continuous integration, continuous delivery, and continuous deployment.</span></span>

- <span data-ttu-id="fcc8f-109">**Integração contínua**.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-109">**Continuous integration**.</span></span> <span data-ttu-id="fcc8f-110">Alterações de código são frequentemente mescladas à ramificação principal.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-110">Code changes are frequently merged into the main branch.</span></span> <span data-ttu-id="fcc8f-111">Automated build e processos de teste Certifique-se de que o código na ramificação principal é sempre qualidade de produção.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-111">Automated build and test processes ensure that code in the main branch is always production-quality.</span></span>

- <span data-ttu-id="fcc8f-112">**Entrega contínua**.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-112">**Continuous delivery**.</span></span> <span data-ttu-id="fcc8f-113">Nenhuma alteração de código que passam pelo processo de CI é publicadas automaticamente em um ambiente de produção.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-113">Any code changes that pass the CI process are automatically published to a production-like environment.</span></span> <span data-ttu-id="fcc8f-114">A implantação no ambiente de produção dinâmico pode exigir aprovação manual, mas caso contrário, é automatizada.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-114">Deployment into the live production environment may require manual approval, but is otherwise automated.</span></span> <span data-ttu-id="fcc8f-115">A meta é que o seu código esteja sempre *pronto* para implantação na produção.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-115">The goal is that your code should always be *ready* to deploy into production.</span></span>

- <span data-ttu-id="fcc8f-116">**Implantação contínua**.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-116">**Continuous deployment**.</span></span> <span data-ttu-id="fcc8f-117">Alterações de código que passe as duas etapas anteriores são automaticamente implantadas *em produção*.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-117">Code changes that pass the previous two steps are automatically deployed *into production*.</span></span>

<span data-ttu-id="fcc8f-118">Aqui estão algumas metas de um processo de CI/CD robusto para uma arquitetura de microsserviços:</span><span class="sxs-lookup"><span data-stu-id="fcc8f-118">Here are some goals of a robust CI/CD process for a microservices architecture:</span></span>

- <span data-ttu-id="fcc8f-119">Cada equipe pode criar e implantar os serviços que ela possui independentemente, sem afetar ou interromper outras equipes.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-119">Each team can build and deploy the services that it owns independently, without affecting or disrupting other teams.</span></span>

- <span data-ttu-id="fcc8f-120">Antes de uma nova versão de um serviço ser implantada na produção, ela é implantada em ambientes de desenvolvimento/teste/garantia de qualidade para validação.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-120">Before a new version of a service is deployed to production, it gets deployed to dev/test/QA environments for validation.</span></span> <span data-ttu-id="fcc8f-121">Há restrições de qualidade impostas em cada estágio.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-121">Quality gates are enforced at each stage.</span></span>

- <span data-ttu-id="fcc8f-122">Uma nova versão de um serviço pode ser implantada lado a lado com a versão anterior.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-122">A new version of a service can be deployed side by side with the previous version.</span></span>

- <span data-ttu-id="fcc8f-123">Há políticas de controle de acesso suficientes em vigor.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-123">Sufficient access control policies are in place.</span></span>

- <span data-ttu-id="fcc8f-124">Para cargas de trabalho em contêineres, você pode confiar as imagens de contêiner que são implantadas em produção.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-124">For containerized workloads, you can trust the container images that are deployed to production.</span></span>

## <a name="why-a-robust-cicd-pipeline-matters"></a><span data-ttu-id="fcc8f-125">Por que é importante de um pipeline de CI/CD robusto</span><span class="sxs-lookup"><span data-stu-id="fcc8f-125">Why a robust CI/CD pipeline matters</span></span>

<span data-ttu-id="fcc8f-126">Em um aplicativo monolítico tradicional, há um único pipeline de build cuja saída é o executável do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-126">In a traditional monolithic application, there is a single build pipeline whose output is the application executable.</span></span> <span data-ttu-id="fcc8f-127">Todo o trabalho de desenvolvimento alimenta este pipeline.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-127">All development work feeds into this pipeline.</span></span> <span data-ttu-id="fcc8f-128">Se for encontrado um bug de alta prioridade, uma correção deverá ser integrada, testada e publicada, o que poderá atrasar o lançamento dos novos recursos.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-128">If a high-priority bug is found, a fix must be integrated, tested, and published, which can delay the release of new features.</span></span> <span data-ttu-id="fcc8f-129">Você pode atenuar esses problemas com módulos bem fatorados e usando ramificações recursos para minimizar o impacto de alterações de código.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-129">You can mitigate these problems by having well-factored modules and using feature branches to minimize the impact of code changes.</span></span> <span data-ttu-id="fcc8f-130">Mas conforme o aplicativo se torna mais complexo e mais recursos são adicionados, o processo de liberação para um monolito tende a se tornar mais frágil e suscetível a interrupção.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-130">But as the application grows more complex, and more features are added, the release process for a monolith tends to become more brittle and likely to break.</span></span>

<span data-ttu-id="fcc8f-131">Seguindo a filosofia de microsserviços, nunca deverá haver uma versão de treinamento longa em que todas as equipes precisam se mobilizar.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-131">Following the microservices philosophy, there should never be a long release train where every team has to get in line.</span></span> <span data-ttu-id="fcc8f-132">A equipe que cria o serviço "A" pode lançar uma atualização a qualquer momento, sem esperar que as alterações no serviço "B" sejam mescladas, testadas e implantadas.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-132">The team that builds service "A" can release an update at any time, without waiting for changes in service "B" to be merged, tested, and deployed.</span></span>

![Diagrama de um monólito de CI/CD](./images/cicd-monolith.png)

<span data-ttu-id="fcc8f-134">Para obter uma versão de alta velocidade, o pipeline de lançamento deve ser automatizado e altamente confiável, para minimizar o risco.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-134">To achieve a high release velocity, your release pipeline must be automated and highly reliable, to minimize risk.</span></span> <span data-ttu-id="fcc8f-135">Se você liberar para produção diariamente ou várias vezes ao dia, as regressões ou interrupções de serviço devem ser muito raras.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-135">If you release to production daily or multiple times a day, regressions or service disruptions must be very rare.</span></span> <span data-ttu-id="fcc8f-136">Ao mesmo tempo, se uma atualização inválida é implantada, você deve ter uma maneira confiável de reverter ou efetuar roll forward rapidamente para uma versão anterior de um serviço.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-136">At the same time, if a bad update does get deployed, you must have a reliable way to quickly roll back or roll forward to a previous version of a service.</span></span>

## <a name="challenges"></a><span data-ttu-id="fcc8f-137">Desafios</span><span class="sxs-lookup"><span data-stu-id="fcc8f-137">Challenges</span></span>

- <span data-ttu-id="fcc8f-138">**Várias bases de código pequenas independentes**.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-138">**Many small independent code bases**.</span></span> <span data-ttu-id="fcc8f-139">Cada equipe é responsável por criar seu próprio serviço, com seu próprio pipeline de build.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-139">Each team is responsible for building its own service, with its own build pipeline.</span></span> <span data-ttu-id="fcc8f-140">Em algumas organizações, as equipes podem usar repositórios de código separados.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-140">In some organizations, teams may use separate code repositories.</span></span> <span data-ttu-id="fcc8f-141">Repositórios separados podem levar a uma situação em que o conhecimento de como criar o sistema é disseminado entre equipes e ninguém na organização sabe como implantar o aplicativo inteiro.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-141">Separate repositories can lead to a situation where the knowledge of how to build the system is spread across teams, and nobody in the organization knows how to deploy the entire application.</span></span> <span data-ttu-id="fcc8f-142">Por exemplo, o que acontecerá em um cenário de recuperação de desastre, se você precisar implantar rapidamente para um novo cluster?</span><span class="sxs-lookup"><span data-stu-id="fcc8f-142">For example, what happens in a disaster recovery scenario, if you need to quickly deploy to a new cluster?</span></span>

    <span data-ttu-id="fcc8f-143">**Atenuação**: Tem um pipeline automatizado e unificado para compilar e implantar os serviços, para que esse conhecimento não estiver "oculto" dentro de cada equipe.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-143">**Mitigation**: Have a unified and automated pipeline to build and deploy services, so that this knowledge is not "hidden" within each team.</span></span>

- <span data-ttu-id="fcc8f-144">**Múltiplas linguagens de programação e estruturas**.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-144">**Multiple languages and frameworks**.</span></span> <span data-ttu-id="fcc8f-145">Com cada equipe usando seu próprio conjunto de tecnologias, pode ser difícil criar um processo de build único que funcione em toda a organização.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-145">With each team using its own mix of technologies, it can be difficult to create a single build process that works across the organization.</span></span> <span data-ttu-id="fcc8f-146">O processo de build deve ser flexível o suficiente para que cada equipe possa adaptá-lo para sua linguagem de programação ou estrutura de preferência.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-146">The build process must be flexible enough that every team can adapt it for their choice of language or framework.</span></span>

    <span data-ttu-id="fcc8f-147">**Atenuação**: Colocar em contêiner o processo de compilação para cada serviço.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-147">**Mitigation**: Containerize the build process for each service.</span></span> <span data-ttu-id="fcc8f-148">Dessa forma, o sistema de compilação apenas precisa ser capaz de executar os contêineres.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-148">That way, the build system just needs to be able to run the containers.</span></span>

- <span data-ttu-id="fcc8f-149">**Integração e teste de carga**.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-149">**Integration and load testing**.</span></span> <span data-ttu-id="fcc8f-150">Com as equipes de liberação de atualizações em seu próprio ritmo, pode ser difícil projetar testes de ponta a ponta robustos, especialmente quando os serviços têm dependências em outros serviços.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-150">With teams releasing updates at their own pace, it can be challenging to design robust end-to-end testing, especially when services have dependencies on other services.</span></span> <span data-ttu-id="fcc8f-151">Além disso, a execução de um cluster de produção completo pode ser cara, portanto, é improvável que todas as equipes executará seu próprio cluster completo em escalas de produção, apenas para teste.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-151">Moreover, running a full production cluster can be expensive, so it's unlikely that every team will run its own full cluster at production scales, just for testing.</span></span>

- <span data-ttu-id="fcc8f-152">**Gerenciamento de versão**.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-152">**Release management**.</span></span> <span data-ttu-id="fcc8f-153">Cada equipe deve ser capaz de implantar uma atualização para a produção.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-153">Every team should be able to deploy an update to production.</span></span> <span data-ttu-id="fcc8f-154">Isso não significa que cada membro da equipe tem permissões para fazer isso.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-154">That doesn't mean that every team member has permissions to do so.</span></span> <span data-ttu-id="fcc8f-155">Mas ter uma função de Gerenciador de Versão centralizada pode reduzir a velocidade das implantações.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-155">But having a centralized Release Manager role can reduce the velocity of deployments.</span></span>

    <span data-ttu-id="fcc8f-156">**Migitation**: Quanto mais o processo de CI/CD for automatizado e confiável, menos deverá haver necessidade de uma autoridade central.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-156">**Migitation**: The more that your CI/CD process is automated and reliable, the less there should be a need for a central authority.</span></span> <span data-ttu-id="fcc8f-157">Dito isso, você pode ter diferentes políticas para liberar atualizações dos principais recursos e correções de bugs secundários.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-157">That said, you might have different policies for releasing major feature updates versus minor bug fixes.</span></span> <span data-ttu-id="fcc8f-158">Ser descentralizado não significa zero governança.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-158">Being decentralized doesn't mean zero governance.</span></span>

- <span data-ttu-id="fcc8f-159">**Atualizações de serviço**.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-159">**Service updates**.</span></span> <span data-ttu-id="fcc8f-160">Quando você atualizar um serviço para uma nova versão, ele não deverá interromper outros serviços que dependem dele.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-160">When you update a service to a new version, it shouldn't break other services that depend on it.</span></span>

    <span data-ttu-id="fcc8f-161">**Atenuação**: Use técnicas de implantação, como lançamento canário ou azul verde para alterações sem interrupções.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-161">**Mitigation**: Use deployment techniques such as blue-green or canary release for non-breaking changes.</span></span> <span data-ttu-id="fcc8f-162">Para alterações da API, implante a nova versão lado a lado com a versão anterior.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-162">For breaking API changes, deploy the new version side by side with the previous version.</span></span> <span data-ttu-id="fcc8f-163">Dessa forma, os serviços que consomem a API anterior seja atualizados e testados para a nova API.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-163">That way, services that consume the previous API can be updated and tested for the new API.</span></span> <span data-ttu-id="fcc8f-164">Ver [serviços de atualização](#updating-services), abaixo.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-164">See [Updating services](#updating-services), below.</span></span>

## <a name="monorepo-vs-multi-repo"></a><span data-ttu-id="fcc8f-165">Vários repositórios do Monorepo vs</span><span class="sxs-lookup"><span data-stu-id="fcc8f-165">Monorepo vs multi-repo</span></span>

<span data-ttu-id="fcc8f-166">Antes de criar um fluxo de trabalho de CI/CD, você precisa saber como a base de código será estruturada e gerenciada.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-166">Before creating a CI/CD workflow, you must know how the code base will be structured and managed.</span></span>

- <span data-ttu-id="fcc8f-167">As equipes funcionam em repositórios separados ou em um repositório único?</span><span class="sxs-lookup"><span data-stu-id="fcc8f-167">Do teams work in separate respositories or in a monorepo (single respository)?</span></span>
- <span data-ttu-id="fcc8f-168">Qual é sua estratégia de ramificação?</span><span class="sxs-lookup"><span data-stu-id="fcc8f-168">What is your branching strategy?</span></span>
- <span data-ttu-id="fcc8f-169">Quem pode efetuar push do código para a produção?</span><span class="sxs-lookup"><span data-stu-id="fcc8f-169">Who can push code to production?</span></span> <span data-ttu-id="fcc8f-170">Existe uma função de gerente de versão?</span><span class="sxs-lookup"><span data-stu-id="fcc8f-170">Is there a release manager role?</span></span>

<span data-ttu-id="fcc8f-171">A abordagem de repositório único tem tido mais aceitação, mas há vantagens e desvantagens em ambas.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-171">The monorepo approach has been gaining favor but there are advantages and disadvantages to both.</span></span>

| &nbsp; | <span data-ttu-id="fcc8f-172">Repositório único</span><span class="sxs-lookup"><span data-stu-id="fcc8f-172">Monorepo</span></span> | <span data-ttu-id="fcc8f-173">Vários repositórios</span><span class="sxs-lookup"><span data-stu-id="fcc8f-173">Multiple repos</span></span> |
|--------|----------|----------------|
| <span data-ttu-id="fcc8f-174">**Vantagens**</span><span class="sxs-lookup"><span data-stu-id="fcc8f-174">**Advantages**</span></span> | <span data-ttu-id="fcc8f-175">Compartilhamento de código</span><span class="sxs-lookup"><span data-stu-id="fcc8f-175">Code sharing</span></span><br/><span data-ttu-id="fcc8f-176">Maior facilidade em padronizar o código e as ferramentas</span><span class="sxs-lookup"><span data-stu-id="fcc8f-176">Easier to standardize code and tooling</span></span><br/><span data-ttu-id="fcc8f-177">Maior facilidade em refatorar o código</span><span class="sxs-lookup"><span data-stu-id="fcc8f-177">Easier to refactor code</span></span><br/><span data-ttu-id="fcc8f-178">Detectabilidade – modo de exibição único do código</span><span class="sxs-lookup"><span data-stu-id="fcc8f-178">Discoverability - single view of the code</span></span><br/> | <span data-ttu-id="fcc8f-179">Propriedade clara por equipe</span><span class="sxs-lookup"><span data-stu-id="fcc8f-179">Clear ownership per team</span></span><br/><span data-ttu-id="fcc8f-180">Possivelmente menos conflitos de mesclagem</span><span class="sxs-lookup"><span data-stu-id="fcc8f-180">Potentially fewer merge conflicts</span></span><br/><span data-ttu-id="fcc8f-181">Ajuda a impor o desacoplamento de microsserviços</span><span class="sxs-lookup"><span data-stu-id="fcc8f-181">Helps to enforce decoupling of microservices</span></span> |
| <span data-ttu-id="fcc8f-182">**Desafios**</span><span class="sxs-lookup"><span data-stu-id="fcc8f-182">**Challenges**</span></span> | <span data-ttu-id="fcc8f-183">As alterações no código compartilhado podem afetar vários microsserviços</span><span class="sxs-lookup"><span data-stu-id="fcc8f-183">Changes to shared code can affect multiple microservices</span></span><br/><span data-ttu-id="fcc8f-184">Maior potencial de conflitos de mesclagem</span><span class="sxs-lookup"><span data-stu-id="fcc8f-184">Greater potential for merge conflicts</span></span><br/><span data-ttu-id="fcc8f-185">As ferramentas devem ser dimensionadas para uma base de código grande</span><span class="sxs-lookup"><span data-stu-id="fcc8f-185">Tooling must scale to a large code base</span></span><br/><span data-ttu-id="fcc8f-186">Controle de acesso</span><span class="sxs-lookup"><span data-stu-id="fcc8f-186">Access control</span></span><br/><span data-ttu-id="fcc8f-187">Processo de implantação mais complexo</span><span class="sxs-lookup"><span data-stu-id="fcc8f-187">More complex deployment process</span></span> | <span data-ttu-id="fcc8f-188">Mais difícil de compartilhar o código</span><span class="sxs-lookup"><span data-stu-id="fcc8f-188">Harder to share code</span></span><br/><span data-ttu-id="fcc8f-189">Mais difícil de impor padrões de codificação</span><span class="sxs-lookup"><span data-stu-id="fcc8f-189">Harder to enforce coding standards</span></span><br/><span data-ttu-id="fcc8f-190">Gerenciamento de dependências</span><span class="sxs-lookup"><span data-stu-id="fcc8f-190">Dependency management</span></span><br/><span data-ttu-id="fcc8f-191">Base de código difusa, baixa detectabilidade</span><span class="sxs-lookup"><span data-stu-id="fcc8f-191">Diffuse code base, poor discoverability</span></span><br/><span data-ttu-id="fcc8f-192">Falta de infraestrutura compartilhada</span><span class="sxs-lookup"><span data-stu-id="fcc8f-192">Lack of shared infrastructure</span></span>

## <a name="updating-services"></a><span data-ttu-id="fcc8f-193">Atualizando serviços</span><span class="sxs-lookup"><span data-stu-id="fcc8f-193">Updating services</span></span>

<span data-ttu-id="fcc8f-194">Há várias estratégias para atualizar um serviço que já está em produção.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-194">There are various strategies for updating a service that's already in production.</span></span> <span data-ttu-id="fcc8f-195">Aqui, abordamos três opções comuns: Atualização sem interrupção, implantação "blue-green" e versão canário.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-195">Here we discuss three common options: Rolling update, blue-green deployment, and canary release.</span></span>

### <a name="rolling-updates"></a><span data-ttu-id="fcc8f-196">Atualizações sem interrupção</span><span class="sxs-lookup"><span data-stu-id="fcc8f-196">Rolling updates</span></span>

<span data-ttu-id="fcc8f-197">Em uma atualização sem interrupção, você implanta novas instâncias de um serviço e as novas instâncias começam a receber solicitações imediatamente.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-197">In a rolling update, you deploy new instances of a service, and the new instances start receiving requests right away.</span></span> <span data-ttu-id="fcc8f-198">À medida que as novas instâncias chegam, as anteriores são removidas.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-198">As the new instances come up, the previous instances are removed.</span></span>

<span data-ttu-id="fcc8f-199">**Exemplo:**</span><span class="sxs-lookup"><span data-stu-id="fcc8f-199">**Example.**</span></span> <span data-ttu-id="fcc8f-200">No Kubernetes, atualizações sem interrupção são o comportamento padrão quando você atualiza a especificação de pod para uma implantação.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-200">In Kubernetes, rolling updates are the default behavior when you update the pod spec for a Deployment.</span></span> <span data-ttu-id="fcc8f-201">O controlador de implantação cria um novo ReplicaSet para os pods atualizados.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-201">The Deployment controller creates a new ReplicaSet for the updated pods.</span></span> <span data-ttu-id="fcc8f-202">Em seguida, ele expande o novo ReplicaSet e reduz simultaneamente o antigo, para manter a contagem de réplicas desejada.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-202">Then it scales up the new ReplicaSet while scaling down the old one, to maintain the desired replica count.</span></span> <span data-ttu-id="fcc8f-203">Ela não exclui os pods antigos até que os novos estejam prontos.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-203">It doesn't delete old pods until the new ones are ready.</span></span> <span data-ttu-id="fcc8f-204">Kubernetes mantém um histórico da atualização, portanto, você pode reverter uma atualização se necessário.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-204">Kubernetes keeps a history of the update, so you can roll back an update if needed.</span></span>

<span data-ttu-id="fcc8f-205">Um desafio de reverter atualizações é que durante o processo de atualização uma mistura das versões antiga e nova estão em execução e recebendo tráfego.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-205">One challenge of rolling updates is that during the update process, a mix of old and new versions are running and receiving traffic.</span></span> <span data-ttu-id="fcc8f-206">Durante esse período, qualquer solicitação poderia ser roteada para qualquer uma das duas versões.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-206">During this period, any request could get routed to either of the two versions.</span></span>

<span data-ttu-id="fcc8f-207">Para alterações da API, uma prática recomendada é dar suporte a ambas as versões lado a lado, até que todos os clientes da versão anterior são atualizados.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-207">For breaking API changes, a good practice is to support both versions side by side, until all clients of the previous version are updated.</span></span> <span data-ttu-id="fcc8f-208">Ver [controle de versão de API](./design/api-design.md#api-versioning).</span><span class="sxs-lookup"><span data-stu-id="fcc8f-208">See [API versioning](./design/api-design.md#api-versioning).</span></span>

### <a name="blue-green-deployment"></a><span data-ttu-id="fcc8f-209">Implantação "blue-green"</span><span class="sxs-lookup"><span data-stu-id="fcc8f-209">Blue-green deployment</span></span>

<span data-ttu-id="fcc8f-210">Em uma implantação "blue-green", você deve implantar a nova versão juntamente com a versão anterior.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-210">In a blue-green deployment, you deploy the new version alongside the previous version.</span></span> <span data-ttu-id="fcc8f-211">Depois de validar a nova versão, você pode mudar todo o tráfego da versão anterior para a nova versão, de uma só vez.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-211">After you validate the new version, you switch all traffic at once from the previous version to the new version.</span></span> <span data-ttu-id="fcc8f-212">Após a troca, você deve monitorar o aplicativo para quaisquer problemas.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-212">After the switch, you monitor the application for any problems.</span></span> <span data-ttu-id="fcc8f-213">Se algo der errado, você poderá retornar à versão antiga.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-213">If something goes wrong, you can swap back to the old version.</span></span> <span data-ttu-id="fcc8f-214">Se nenhum problema ocorrer, você poderá excluir a versão antiga.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-214">Assuming there are no problems, you can delete the old version.</span></span>

<span data-ttu-id="fcc8f-215">Com um aplicativo monolítico ou de N camadas mais tradicional, a implantação "blue-green" geralmente significa provisionar dois ambientes idênticos.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-215">With a more traditional monolithic or N-tier application, blue-green deployment generally meant provisioning two identical environments.</span></span> <span data-ttu-id="fcc8f-216">Você implantaria a nova versão em um ambiente de preparo e então redirecionaria o tráfego de cliente para o ambiente de preparo &mdash; por exemplo, alternando VIPs.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-216">You would deploy the new version to a staging environment, then redirect client traffic to the staging environment &mdash; for example, by swapping VIP addresses.</span></span> <span data-ttu-id="fcc8f-217">Em uma arquitetura de microsserviços, as atualizações ocorrem no nível do microsserviço, portanto, você normalmente seria implantar a atualização no mesmo ambiente e usar um mecanismo de descoberta de serviço para trocar.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-217">In a microservices architecture, updates happen at the microservice level, so you would typically deploy the update into the same environment and use a service discovery mechanism to swap.</span></span>

<span data-ttu-id="fcc8f-218">**Exemplo**.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-218">**Example**.</span></span> <span data-ttu-id="fcc8f-219">No Kubernetes, você não precisa provisionar um cluster separado para fazer implantações "blue-green".</span><span class="sxs-lookup"><span data-stu-id="fcc8f-219">In Kubernetes, you don't need to provision a separate cluster to do blue-green deployments.</span></span> <span data-ttu-id="fcc8f-220">Em vez disso, você pode tirar proveito de seletores.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-220">Instead, you can take advantage of selectors.</span></span> <span data-ttu-id="fcc8f-221">Crie um novo recurso de implantação com uma nova especificação de pod e um conjunto diferente de rótulos.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-221">Create a new Deployment resource with a new pod spec and a different set of labels.</span></span> <span data-ttu-id="fcc8f-222">Crie essa implantação sem excluir a implantação anterior nem modificar o serviço que aponta para ela.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-222">Create this deployment, without deleting the previous deployment or modifying the service that points to it.</span></span> <span data-ttu-id="fcc8f-223">Quando os novo pods estiverem em execução, você poderá atualizar o seletor do serviço para corresponder à nova implantação.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-223">Once the new pods are running, you can update the service's selector to match the new deployment.</span></span>

<span data-ttu-id="fcc8f-224">Uma desvantagem de implantação "blue-green" é que durante a atualização, você está executando dobro pods para o serviço (atual e a próxima).</span><span class="sxs-lookup"><span data-stu-id="fcc8f-224">One drawback of blue-green deployment is that during the update, you are running twice as many pods for the service (current and next).</span></span> <span data-ttu-id="fcc8f-225">Se os pods exigirem muitos recursos de CPU ou de memória, talvez você precisará expandir o cluster temporariamente para dar conta do consumo de recursos.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-225">If the pods require a lot of CPU or memory resources, you may need to scale out the cluster temporarily to handle the resource consumption.</span></span>

### <a name="canary-release"></a><span data-ttu-id="fcc8f-226">Versão canário</span><span class="sxs-lookup"><span data-stu-id="fcc8f-226">Canary release</span></span>

<span data-ttu-id="fcc8f-227">Em uma versão canário, você distribui uma versão atualizada para um número pequeno de clientes.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-227">In a canary release, you roll out an updated version to a small number of clients.</span></span> <span data-ttu-id="fcc8f-228">Em seguida, você monitora o comportamento do novo serviço antes de implantá-lo em todos os clientes.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-228">Then you monitor the behavior of the new service before rolling it out to all clients.</span></span> <span data-ttu-id="fcc8f-229">Isso lhe permite fazer uma distribuição lenta de forma controlada, observar dados reais e identificar problemas antes que todos os clientes sejam afetados.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-229">This lets you do a slow rollout in a controlled fashion, observe real data, and spot problems before all customers are affected.</span></span>

<span data-ttu-id="fcc8f-230">Uma versão canário é mais complexa de gerenciar do que a atualização sem interrupção ou "blue-green", porque você deve rotear solicitações dinamicamente para diferentes versões do serviço.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-230">A canary release is more complex to manage than either blue-green or rolling update, because you must dynamically route requests to different versions of the service.</span></span>

<span data-ttu-id="fcc8f-231">**Exemplo**.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-231">**Example**.</span></span> <span data-ttu-id="fcc8f-232">No Kubernetes, você pode configurar um serviço para abranger dois conjuntos de réplicas (um para cada versão) e ajustar as contagens de réplicas manualmente.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-232">In Kubernetes, you can configure a Service to span two replica sets (one for each version) and adjust the replica counts manually.</span></span> <span data-ttu-id="fcc8f-233">No entanto, essa abordagem tem uma granularidade bastante alta devido ao modo como o Kubernetes balanceia a carga entre os pods.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-233">However, this approach is rather coarse-grained, because of the way Kubernetes load balances across pods.</span></span> <span data-ttu-id="fcc8f-234">Por exemplo, se você tiver um total de 10 réplicas, você só poderá realizar deslocamentos tráfego em incrementos de 10%.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-234">For example, if you have a total of 10 replicas, you can only shift traffic in 10% increments.</span></span> <span data-ttu-id="fcc8f-235">Se você estiver usando uma malha de serviço, poderá usar as regras de roteamento de malha do serviço para implementar uma estratégia de versão canário mais sofisticada.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-235">If you are using a service mesh, you can use the service mesh routing rules to implement a more sophisticated canary release strategy.</span></span>

## <a name="next-steps"></a><span data-ttu-id="fcc8f-236">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="fcc8f-236">Next steps</span></span>

<span data-ttu-id="fcc8f-237">Aprenda as práticas específicas de CI/CD para microsserviços em execução no Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="fcc8f-237">Learn specific CI/CD practices for microservices running on Kubernetes.</span></span>

- [<span data-ttu-id="fcc8f-238">CI/CD para microsserviços no Kubernetes</span><span class="sxs-lookup"><span data-stu-id="fcc8f-238">CI/CD for microservices on Kubernetes</span></span>](./ci-cd-kubernetes.md)