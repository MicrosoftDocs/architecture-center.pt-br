---
title: Análise de domínio para microsserviços
description: Análise de domínio para microsserviços.
author: MikeWasson
ms.date: 10/23/2018
ms.topic: guide
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: microservices
ms.openlocfilehash: cc265aabf401f56a1a81a630e143b2c59986a8e2
ms.sourcegitcommit: 1b50810208354577b00e89e5c031b774b02736e2
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/23/2019
ms.locfileid: "54482707"
---
# <a name="designing-microservices-domain-analysis"></a><span data-ttu-id="f3c07-103">Como criar microsserviços: Análise de domínio</span><span class="sxs-lookup"><span data-stu-id="f3c07-103">Designing microservices: Domain analysis</span></span>

<span data-ttu-id="f3c07-104">Um dos maiores desafios de microsserviços é definir os limites de serviços individuais.</span><span class="sxs-lookup"><span data-stu-id="f3c07-104">One of the biggest challenges of microservices is to define the boundaries of individual services.</span></span> <span data-ttu-id="f3c07-105">A regra geral é que um serviço deve fazer "algo" &mdash; mas colocar essa regra em prática requer uma consideração cuidadosa.</span><span class="sxs-lookup"><span data-stu-id="f3c07-105">The general rule is that a service should do "one thing" &mdash; but putting that rule into practice requires careful thought.</span></span> <span data-ttu-id="f3c07-106">Não há nenhum processo mecânico que produz o design "certo".</span><span class="sxs-lookup"><span data-stu-id="f3c07-106">There is no mechanical process that will produce the "right" design.</span></span> <span data-ttu-id="f3c07-107">Você precisa pensar profundamente em suas metas, requisitos e domínio de negócios.</span><span class="sxs-lookup"><span data-stu-id="f3c07-107">You have to think deeply about your business domain, requirements, and goals.</span></span> <span data-ttu-id="f3c07-108">Caso contrário, você pode terminar com um design aleatório que exibe algumas características indesejáveis, como dependências ocultas entre serviços, acoplamento rígido ou então interfaces mal projetadas.</span><span class="sxs-lookup"><span data-stu-id="f3c07-108">Otherwise, you can end up with a haphazard design that exhibits some undesirable characteristics, such as hidden dependencies between services, tight coupling, or poorly designed interfaces.</span></span> <span data-ttu-id="f3c07-109">Neste capítulo, usamos uma abordagem orientada por domínio para criar microsserviços.</span><span class="sxs-lookup"><span data-stu-id="f3c07-109">In this chapter, we take a domain-driven approach to designing microservices.</span></span>

<span data-ttu-id="f3c07-110">Microsserviços devem ser criados em torno de capacidades comerciais, não de camadas horizontais como acesso a dados ou mensagens.</span><span class="sxs-lookup"><span data-stu-id="f3c07-110">Microservices should be designed around business capabilities, not horizontal layers such as data access or messaging.</span></span> <span data-ttu-id="f3c07-111">Além disso, eles devem ter um acoplamento flexível e alta coesão funcional.</span><span class="sxs-lookup"><span data-stu-id="f3c07-111">In addition, they should have loose coupling and high functional cohesion.</span></span> <span data-ttu-id="f3c07-112">Os microsserviços serão *acoplados flexivelmente* se você puder alterar um serviço sem a necessidade de outros serviços serem atualizados simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="f3c07-112">Microservices are *loosely coupled* if you can change one service without requiring other services to be updated at the same time.</span></span> <span data-ttu-id="f3c07-113">Um microsserviço é *coeso* se ele tem uma finalidade única e bem definida, como gerenciar contas de usuário ou acompanhar o histórico de entrega.</span><span class="sxs-lookup"><span data-stu-id="f3c07-113">A microservice is *cohesive* if it has a single, well-defined purpose, such as managing user accounts or tracking delivery history.</span></span> <span data-ttu-id="f3c07-114">Um serviço deve encapsular o conhecimento do domínio e abstrair esse conhecimento de clientes.</span><span class="sxs-lookup"><span data-stu-id="f3c07-114">A service should encapsulate domain knowledge and abstract that knowledge from clients.</span></span> <span data-ttu-id="f3c07-115">Por exemplo, um cliente deve ser capaz de agendar um zumbido sem conhecer os detalhes do algoritmo de agendamento ou como a frota de drones é gerenciada.</span><span class="sxs-lookup"><span data-stu-id="f3c07-115">For example, a client should be able to schedule a drone without knowing the details of the scheduling algorithm or how the drone fleet is managed.</span></span>

<span data-ttu-id="f3c07-116">O DDD (design orientado a domínio) fornece uma estrutura que pode ajudar você pela maior parte do processo de obtenção de um conjunto de microsserviços bem projetado.</span><span class="sxs-lookup"><span data-stu-id="f3c07-116">Domain-driven design (DDD) provides a framework that can get you most of the way to a set of well-designed microservices.</span></span> <span data-ttu-id="f3c07-117">O DDD tem duas fases diferentes, a estratégica e a tática.</span><span class="sxs-lookup"><span data-stu-id="f3c07-117">DDD has two distinct phases, strategic and tactical.</span></span> <span data-ttu-id="f3c07-118">No DDD estratégico, você está definindo a estrutura em grande escala do sistema.</span><span class="sxs-lookup"><span data-stu-id="f3c07-118">In strategic DDD, you are defining the large-scale structure of the system.</span></span> <span data-ttu-id="f3c07-119">O DDD estratégico ajuda a garantir que sua arquitetura permaneça concentrada em capacidades comerciais.</span><span class="sxs-lookup"><span data-stu-id="f3c07-119">Strategic DDD helps to ensure that your architecture remains focused on business capabilities.</span></span> <span data-ttu-id="f3c07-120">O DDD tático fornece um conjunto de padrões de design que você pode usar para criar o modelo de domínio.</span><span class="sxs-lookup"><span data-stu-id="f3c07-120">Tactical DDD provides a set of design patterns that you can use to create the domain model.</span></span> <span data-ttu-id="f3c07-121">Esses padrões incluem entidades, agregações e serviços de domínio.</span><span class="sxs-lookup"><span data-stu-id="f3c07-121">These patterns include entities, aggregates, and domain services.</span></span> <span data-ttu-id="f3c07-122">Esses padrões táticos lhe ajudarão a criar microsserviços que são acoplados flexivelmente e também coesos.</span><span class="sxs-lookup"><span data-stu-id="f3c07-122">These tactical patterns will help you to design microservices that are both loosely coupled and cohesive.</span></span>

![Diagrama de um processo de design orientado por domínio (DDD)](./images/ddd-process.png)

<span data-ttu-id="f3c07-124">Neste capítulo e no próximo, examinaremos as etapas a seguir, as aplicaremos ao aplicativo de Entrega por Drone:</span><span class="sxs-lookup"><span data-stu-id="f3c07-124">In this chapter and the next, we'll walk through the following steps, applying them to the Drone Delivery application:</span></span>

1. <span data-ttu-id="f3c07-125">Comece analisando o domínio corporativo para entender os requisitos funcionais do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f3c07-125">Start by analyzing the business domain to understand the application's functional requirements.</span></span> <span data-ttu-id="f3c07-126">A saída desta etapa é uma descrição informal do domínio, que pode ser redefinido em um conjunto mais formal de modelos de domínio.</span><span class="sxs-lookup"><span data-stu-id="f3c07-126">The output of this step is an informal description of the domain, which can be refined into a more formal set of domain models.</span></span>

2. <span data-ttu-id="f3c07-127">Em seguida, defina os *contextos limitados* do domínio.</span><span class="sxs-lookup"><span data-stu-id="f3c07-127">Next, define the *bounded contexts* of the domain.</span></span> <span data-ttu-id="f3c07-128">Cada contexto limitado contém um modelo de domínio que representa um subdomínio específico do aplicativo maior.</span><span class="sxs-lookup"><span data-stu-id="f3c07-128">Each bounded context contains a domain model that represents a particular subdomain of the larger application.</span></span>

3. <span data-ttu-id="f3c07-129">Dentro de um contexto limitado, aplique padrões DDD táticos para definir entidades, agregações e serviços de domínio.</span><span class="sxs-lookup"><span data-stu-id="f3c07-129">Within a bounded context, apply tactical DDD patterns to define entities, aggregates, and domain services.</span></span>

4. <span data-ttu-id="f3c07-130">Use os resultados da etapa anterior para identificar os microsserviços em seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f3c07-130">Use the results from the previous step to identify the microservices in your application.</span></span>

<span data-ttu-id="f3c07-131">Neste capítulo, abordaremos as três primeiras etapas, que se relacionam principalmente com DDD.</span><span class="sxs-lookup"><span data-stu-id="f3c07-131">In this chapter, we cover the first three steps, which are primarily concerned with DDD.</span></span> <span data-ttu-id="f3c07-132">No próximo capítulo, identificaremos os microsserviços.</span><span class="sxs-lookup"><span data-stu-id="f3c07-132">In the next chapter, we will identify the microservices.</span></span> <span data-ttu-id="f3c07-133">No entanto, é importante lembrar que DDD é um processo iterativo e em andamento.</span><span class="sxs-lookup"><span data-stu-id="f3c07-133">However, it's important to remember that DDD is an iterative, ongoing process.</span></span> <span data-ttu-id="f3c07-134">Limites de serviço não são fixos de forma imutável.</span><span class="sxs-lookup"><span data-stu-id="f3c07-134">Service boundaries aren't fixed in stone.</span></span> <span data-ttu-id="f3c07-135">Conforme um aplicativo evolui, você pode decidir dividir um serviço em vários serviços menores.</span><span class="sxs-lookup"><span data-stu-id="f3c07-135">As an application evolves, you may decide to break apart a service into several smaller services.</span></span>

> [!NOTE]
> <span data-ttu-id="f3c07-136">Este capítulo não é destinado a mostrar uma análise de domínio completa e abrangente.</span><span class="sxs-lookup"><span data-stu-id="f3c07-136">This chapter is not meant to show a complete and comprehensive domain analysis.</span></span> <span data-ttu-id="f3c07-137">Mantivemos o exemplo breve propositalmente para ilustrar os pontos principais.</span><span class="sxs-lookup"><span data-stu-id="f3c07-137">We deliberately kept the example brief, in order to illustrate the main points.</span></span> <span data-ttu-id="f3c07-138">Para obter mais informações sobre DDD, recomendamos o livro *Domain-Driven Design* de Eric Evans, o livro que introduziu o termo pela primeira vez.</span><span class="sxs-lookup"><span data-stu-id="f3c07-138">For more background on DDD, we recommend Eric Evans' *Domain-Driven Design*, the book that first introduced the term.</span></span> <span data-ttu-id="f3c07-139">Outra boa referência é *Implementando Domain-Driven Design* por Vaughn Vernon.</span><span class="sxs-lookup"><span data-stu-id="f3c07-139">Another good reference is *Implementing Domain-Driven Design* by Vaughn Vernon.</span></span>

## <a name="analyze-the-domain"></a><span data-ttu-id="f3c07-140">Analisar o domínio</span><span class="sxs-lookup"><span data-stu-id="f3c07-140">Analyze the domain</span></span>

<span data-ttu-id="f3c07-141">Usar uma abordagem DDD lhe ajudará a criar microsserviços de modo que cada serviço se adeque naturalmente a um requisito de negócios funcional.</span><span class="sxs-lookup"><span data-stu-id="f3c07-141">Using a DDD approach will help you to design microservices so that every service forms a natural fit to a functional business requirement.</span></span> <span data-ttu-id="f3c07-142">Ele pode lhe ajudar a evitar a armadilha de permitir que os limites organizacionais ou opções de tecnologia ditem o seu design.</span><span class="sxs-lookup"><span data-stu-id="f3c07-142">It can help you to avoid the trap of letting organizational boundaries or technology choices dictate your design.</span></span>

<span data-ttu-id="f3c07-143">Antes de gravar qualquer código, será necessária uma vista panorâmica do sistema que você está criando.</span><span class="sxs-lookup"><span data-stu-id="f3c07-143">Before writing any code, you need a bird's eye view of the system that you are creating.</span></span> <span data-ttu-id="f3c07-144">O DDD começa modelando o domínio corporativo e criando uma *modelo de domínio*.</span><span class="sxs-lookup"><span data-stu-id="f3c07-144">DDD starts by modeling the business domain and creating a *domain model*.</span></span> <span data-ttu-id="f3c07-145">O modelo de domínio é um modelo abstrato do domínio corporativo.</span><span class="sxs-lookup"><span data-stu-id="f3c07-145">The domain model is an abstract model of the business domain.</span></span> <span data-ttu-id="f3c07-146">Destila e organiza os dados de conhecimento do domínio e fornece uma linguagem comum para desenvolvedores e especialistas de domínio.</span><span class="sxs-lookup"><span data-stu-id="f3c07-146">It distills and organizes domain knowledge, and provides a common language for developers and domain experts.</span></span>

<span data-ttu-id="f3c07-147">Iniciar o mapeamento de todas as funções de negócios e as respectivas conexões.</span><span class="sxs-lookup"><span data-stu-id="f3c07-147">Start by mapping all of the business functions and their connections.</span></span> <span data-ttu-id="f3c07-148">Isso provavelmente será um esforço colaborativo envolvendo especialistas de domínio, arquitetos de software e outros stakeholders.</span><span class="sxs-lookup"><span data-stu-id="f3c07-148">This will likely be a collaborative effort that involves domain experts, software architects, and other stakeholders.</span></span> <span data-ttu-id="f3c07-149">Você não precisa usar nenhum formalismo específico.</span><span class="sxs-lookup"><span data-stu-id="f3c07-149">You don't need to use any particular formalism.</span></span>  <span data-ttu-id="f3c07-150">Esboce um diagrama ou desenhe em quadro de comunicações.</span><span class="sxs-lookup"><span data-stu-id="f3c07-150">Sketch a diagram or draw on whiteboard.</span></span>

<span data-ttu-id="f3c07-151">Conforme você preencher o diagrama, poderá começar a identificar subdomínios discretos.</span><span class="sxs-lookup"><span data-stu-id="f3c07-151">As you fill in the diagram, you may start to identify discrete subdomains.</span></span> <span data-ttu-id="f3c07-152">Quais funções estão intimamente relacionadas?</span><span class="sxs-lookup"><span data-stu-id="f3c07-152">Which functions are closely related?</span></span> <span data-ttu-id="f3c07-153">Quais funções são essenciais para os negócios e quais fornecem serviços complementares?</span><span class="sxs-lookup"><span data-stu-id="f3c07-153">Which functions are core to the business, and which provide ancillary services?</span></span> <span data-ttu-id="f3c07-154">O que é o grafo de dependência?</span><span class="sxs-lookup"><span data-stu-id="f3c07-154">What is the dependency graph?</span></span> <span data-ttu-id="f3c07-155">Durante a fase inicial, você não se importa com tecnologias ou detalhes de implementação.</span><span class="sxs-lookup"><span data-stu-id="f3c07-155">During this initial phase, you aren't concerned with technologies or implementation details.</span></span> <span data-ttu-id="f3c07-156">Dito isso, você deverá tomar nota do local em que o aplicativo precisará se integrar com sistemas externos como CRM, processamento do pagamento ou sistemas de cobrança.</span><span class="sxs-lookup"><span data-stu-id="f3c07-156">That said, you should note the place where the application will need to integrate with external systems, such as CRM, payment processing, or billing systems.</span></span>

## <a name="drone-delivery-analyzing-the-business-domain"></a><span data-ttu-id="f3c07-157">Entrega por Drones: analisando o domínio corporativo</span><span class="sxs-lookup"><span data-stu-id="f3c07-157">Drone Delivery: Analyzing the business domain</span></span>

<span data-ttu-id="f3c07-158">Após algumas análises de domínio iniciais, a equipe da Fabrikam criou um esboço aproximado que representa o domínio de Entrega por Drones.</span><span class="sxs-lookup"><span data-stu-id="f3c07-158">After some initial domain analysis, the Fabrikam team came up with a rough sketch that depicts the Drone Delivery domain.</span></span>

![Diagrama de um domínio de Entrega por Drones](./images/ddd1.svg)

- <span data-ttu-id="f3c07-160">**Envio** é colocado no centro do diagrama, já que é essencial para os negócios.</span><span class="sxs-lookup"><span data-stu-id="f3c07-160">**Shipping** is placed in the center of the diagram, because it's core to the business.</span></span> <span data-ttu-id="f3c07-161">Tudo no diagrama existe para habilitar essa funcionalidade.</span><span class="sxs-lookup"><span data-stu-id="f3c07-161">Everything else in the diagram exists to enable this functionality.</span></span>
- <span data-ttu-id="f3c07-162">**Gerenciamento de drones** também é importante para os negócios.</span><span class="sxs-lookup"><span data-stu-id="f3c07-162">**Drone management** is also core to the business.</span></span> <span data-ttu-id="f3c07-163">Funcionalidades que estão intimamente relacionada ao gerenciamento de drones incluem o **reparo de drones** e o uso de **análise preditiva** para prever quando drones precisam de manutenção e reparo.</span><span class="sxs-lookup"><span data-stu-id="f3c07-163">Functionality that is closely related to drone management includes **drone repair** and using **predictive analysis** to predict when drones need servicing and maintenance.</span></span>
- <span data-ttu-id="f3c07-164">A **análise de ETA** fornece estimativas de tempo para coleta e entrega.</span><span class="sxs-lookup"><span data-stu-id="f3c07-164">**ETA analysis** provides time estimates for pickup and delivery.</span></span>
- <span data-ttu-id="f3c07-165">O **transporte de terceiros** permitirá que o aplicativo agende métodos de transporte alternativos se um pacote não puder ser enviado inteiramente por drone.</span><span class="sxs-lookup"><span data-stu-id="f3c07-165">**Third-party transportation** will enable the application to schedule alternative transportation methods if a package cannot be shipped entirely by drone.</span></span>
- <span data-ttu-id="f3c07-166">**Compartilhamento de drones** é uma possível extensão do negócio principal.</span><span class="sxs-lookup"><span data-stu-id="f3c07-166">**Drone sharing** is a possible extension of the core business.</span></span> <span data-ttu-id="f3c07-167">A empresa pode ter capacidade de drones excedente durante determinadas horas e pode alugar drones que, caso contrário, ficariam ociosos.</span><span class="sxs-lookup"><span data-stu-id="f3c07-167">The company may have excess drone capacity during certain hours, and could rent out drones that would otherwise be idle.</span></span> <span data-ttu-id="f3c07-168">Este recurso não estará na versão inicial.</span><span class="sxs-lookup"><span data-stu-id="f3c07-168">This feature will not be in the initial release.</span></span>
- <span data-ttu-id="f3c07-169">**Vigilância por vídeo** é outra área para a qual empresa pode expandir mais tarde.</span><span class="sxs-lookup"><span data-stu-id="f3c07-169">**Video surveillance** is another area that the company might expand into later.</span></span>
- <span data-ttu-id="f3c07-170">**Contas de usuário**, **Faturamento** e **Call center** são subdomínios que dão suporte ao negócio principal.</span><span class="sxs-lookup"><span data-stu-id="f3c07-170">**User accounts**, **Invoicing**, and **Call center** are subdomains that support the core business.</span></span>

<span data-ttu-id="f3c07-171">Observe que neste momento no processo, não tomamos nenhuma decisão sobre implementação ou tecnologias.</span><span class="sxs-lookup"><span data-stu-id="f3c07-171">Notice that at this point in the process, we haven't made any decisions about implementation or technologies.</span></span> <span data-ttu-id="f3c07-172">Alguns dos subsistemas podem envolver sistemas externos de software ou serviços de terceiros.</span><span class="sxs-lookup"><span data-stu-id="f3c07-172">Some of the subsystems may involve external software systems or third-party services.</span></span> <span data-ttu-id="f3c07-173">Mesmo assim, o aplicativo deve interagir com esses sistemas e serviços, portanto, é importante incluí-los no modelo de domínio.</span><span class="sxs-lookup"><span data-stu-id="f3c07-173">Even so, the application needs to interact with these systems and services, so it's important to include them in the domain model.</span></span>

> [!NOTE]
> <span data-ttu-id="f3c07-174">Quando um aplicativo depende de um sistema externo, há um risco de que a API ou o esquema de dados do sistema externo vaze dados para seu aplicativo, comprometendo consequentemente o design de arquitetura.</span><span class="sxs-lookup"><span data-stu-id="f3c07-174">When an application depends on an external system, there is a risk that the external system's data schema or API will leak into your application, ultimately compromising the architectural design.</span></span> <span data-ttu-id="f3c07-175">Isso é especialmente verdadeiro com sistemas herdados que podem não seguir práticas recomendadas modernas e que podem usar esquemas de dados complicados ou APIs obsoletas.</span><span class="sxs-lookup"><span data-stu-id="f3c07-175">This is particularly true with legacy systems that may not follow modern best practices, and may use convoluted data schemas or obsolete APIs.</span></span> <span data-ttu-id="f3c07-176">Nesse caso, é importante ter um limite bem definido entre esses sistemas externos e o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f3c07-176">In that case, it's important to have a well-defined boundary between these external systems and the application.</span></span> <span data-ttu-id="f3c07-177">Considere o uso do [Padrão do Estrangulador](../patterns/strangler.md) ou [Padrão de Camada Anticorrupção](../patterns/anti-corruption-layer.md) para essa finalidade.</span><span class="sxs-lookup"><span data-stu-id="f3c07-177">Consider using the [Strangler pattern](../patterns/strangler.md) or the [Anti-Corruption Layer pattern](../patterns/anti-corruption-layer.md) for this purpose.</span></span>

## <a name="define-bounded-contexts"></a><span data-ttu-id="f3c07-178">Definir contextos limitados</span><span class="sxs-lookup"><span data-stu-id="f3c07-178">Define bounded contexts</span></span>

<span data-ttu-id="f3c07-179">O modelo de domínio inclui representações de objetos reais no mundo &mdash; usuários, drones, pacotes e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="f3c07-179">The domain model will include representations of real things in the world &mdash; users, drones, packages, and so forth.</span></span> <span data-ttu-id="f3c07-180">Mas isso não significa que todas as partes do sistema precisam usar as mesmas representações para as mesmas coisas.</span><span class="sxs-lookup"><span data-stu-id="f3c07-180">But that doesn't mean that every part of the system needs to use the same representations for the same things.</span></span>

<span data-ttu-id="f3c07-181">Por exemplo, subsistemas que manipulam análise preditiva e reparo de drones precisarão representar muitas características físicas dos drones, como seu histórico de manutenção, quilometragem, idade, número do modelo, características de desempenho e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="f3c07-181">For example, subsystems that handle drone repair and predictive analysis will need to represent many physical characteristics drones, such as their maintenance history, mileage, age, model number, performance characteristics, and so on.</span></span> <span data-ttu-id="f3c07-182">Porém, quando é hora de agendar uma entrega, esses elementos não importam.</span><span class="sxs-lookup"><span data-stu-id="f3c07-182">But when it's time to schedule a delivery, we don't care about those things.</span></span> <span data-ttu-id="f3c07-183">O subsistema de agendamento só precisa saber se um drone está disponível e o ETA para coleta e entrega.</span><span class="sxs-lookup"><span data-stu-id="f3c07-183">The scheduling subsystem only needs to know whether a drone is available, and the ETA for pickup and delivery.</span></span>

<span data-ttu-id="f3c07-184">Se tentássemos criar um único modelo para ambos esses subsistemas, ele seria desnecessariamente complexo.</span><span class="sxs-lookup"><span data-stu-id="f3c07-184">If we tried to create a single model for both of these subsystems, it would be unnecessarily complex.</span></span> <span data-ttu-id="f3c07-185">Também seria mais difícil para o modelo evoluir ao longo do tempo, porque as alterações precisariam atender a várias equipes trabalhando em subsistemas separados.</span><span class="sxs-lookup"><span data-stu-id="f3c07-185">It would also become harder for the model to evolve over time, because any changes will need to satisfy multiple teams working on separate subsystems.</span></span> <span data-ttu-id="f3c07-186">Portanto, geralmente é melhor criar modelos separados que representam a mesma entidade do mundo real (nesse caso, um drone) em dois contextos diferentes.</span><span class="sxs-lookup"><span data-stu-id="f3c07-186">Therefore, it's often better to design separate models that represent the same real-world entity (in this case, a drone) in two different contexts.</span></span> <span data-ttu-id="f3c07-187">Cada modelo contém apenas os recursos e os atributos que são relevantes no contexto específico dele.</span><span class="sxs-lookup"><span data-stu-id="f3c07-187">Each model contains only the features and attributes that are relevant within its particular context.</span></span>

<span data-ttu-id="f3c07-188">É aqui que o conceito DDD de *contextos limitados* entra em cena.</span><span class="sxs-lookup"><span data-stu-id="f3c07-188">This is where the DDD concept of *bounded contexts* comes into play.</span></span> <span data-ttu-id="f3c07-189">Um contexto limitado é simplesmente o limite em um domínio em que um modelo de domínio específico se aplica.</span><span class="sxs-lookup"><span data-stu-id="f3c07-189">A bounded context is simply the boundary within a domain where a particular domain model applies.</span></span> <span data-ttu-id="f3c07-190">Examinando o diagrama anterior, é possível agrupar as funcionalidades dependendo de várias funções compartilharem ou não um único modelo de domínio.</span><span class="sxs-lookup"><span data-stu-id="f3c07-190">Looking at the previous diagram, we can group functionality according to whether various functions will share a single domain model.</span></span>

![Diagrama de contextos limitados](./images/ddd2.svg)

<span data-ttu-id="f3c07-192">Contextos limitados não são necessariamente isolados uns dos outros.</span><span class="sxs-lookup"><span data-stu-id="f3c07-192">Bounded contexts are not necessarily isolated from one another.</span></span> <span data-ttu-id="f3c07-193">Neste diagrama, as linhas sólidas, conectando os contextos limitados representam lugares onde dois contextos limitados interagem.</span><span class="sxs-lookup"><span data-stu-id="f3c07-193">In this diagram, the solid lines connecting the bounded contexts represent places where two bounded contexts interact.</span></span> <span data-ttu-id="f3c07-194">Por exemplo, a Remessa depende de contas de usuário obterem informações sobre os clientes e do gerenciamento de drones agendar drones da frota.</span><span class="sxs-lookup"><span data-stu-id="f3c07-194">For example, Shipping depends on User Accounts to get information about customers, and on Drone Management to schedule drones from the fleet.</span></span>

<span data-ttu-id="f3c07-195">No livro *Domain Driven Design*, Eric Evans descreve vários padrões para manter a integridade de um modelo de domínio quando ele interage com outro contexto limitado.</span><span class="sxs-lookup"><span data-stu-id="f3c07-195">In the book *Domain Driven Design*, Eric Evans describes several patterns for maintaining the integrity of a domain model when it interacts with another bounded context.</span></span> <span data-ttu-id="f3c07-196">Um dos principais princípios de microsserviços é que os serviços se comunicam por meio de APIs bem definidas.</span><span class="sxs-lookup"><span data-stu-id="f3c07-196">One of the main principles of microservices is that services communicate through well-defined APIs.</span></span> <span data-ttu-id="f3c07-197">Essa abordagem corresponde a dois padrões que Evans chama de serviço de host aberto e linguagem de programação publicada.</span><span class="sxs-lookup"><span data-stu-id="f3c07-197">This approach corresponds to two patterns that Evans calls Open Host Service and Published Language.</span></span> <span data-ttu-id="f3c07-198">A ideia de serviço de host aberto é que um subsistema define um protocolo formal (API) para outros subsistemas se comunicarem com ele.</span><span class="sxs-lookup"><span data-stu-id="f3c07-198">The idea of Open Host Service is that a subsystem defines a formal protocol (API) for other subsystems to communicate with it.</span></span> <span data-ttu-id="f3c07-199">A linguagem de programação publicada estende essa ideia publicando a API de uma forma que outras equipes podem usar para escrever código de clientes.</span><span class="sxs-lookup"><span data-stu-id="f3c07-199">Published Language extends this idea by publishing the API in a form that other teams can use to write clients.</span></span> <span data-ttu-id="f3c07-200">No capítulo sobre [design de API](./api-design.md), discutiremos usando a [especificação de OpenAPI](https://www.openapis.org/specification/repo) (anteriormente conhecida como Swagger) para definir as descrições da interface independente de linguagem para APIs REST, expressa em formato JSON ou YAML.</span><span class="sxs-lookup"><span data-stu-id="f3c07-200">In the chapter on [API Design](./api-design.md), we discuss using [OpenAPI Specification](https://www.openapis.org/specification/repo) (formerly known as Swagger) to define language-agnostic interface descriptions for REST APIs, expressed in JSON or YAML format.</span></span>

<span data-ttu-id="f3c07-201">Para o restante dessa jornada, nos concentraremos no contexto limitado de remessa.</span><span class="sxs-lookup"><span data-stu-id="f3c07-201">For the rest of this journey, we will focus on the Shipping bounded context.</span></span>

## <a name="tactical-ddd"></a><span data-ttu-id="f3c07-202">DDD tático</span><span class="sxs-lookup"><span data-stu-id="f3c07-202">Tactical DDD</span></span>

<span data-ttu-id="f3c07-203">Durante a fase estratégica de DDD, você está mapeando fora do domínio corporativo e definindo contextos limitados para seus modelos de domínio.</span><span class="sxs-lookup"><span data-stu-id="f3c07-203">During the strategic phase of DDD, you are mapping out the business domain and defining bounded contexts for your domain models.</span></span> <span data-ttu-id="f3c07-204">DDD tático é quando você define os modelos de domínio com mais precisão.</span><span class="sxs-lookup"><span data-stu-id="f3c07-204">Tactical DDD is when you define your domain models with more precision.</span></span> <span data-ttu-id="f3c07-205">Os padrões táticos são aplicados dentro de um único contexto limitado.</span><span class="sxs-lookup"><span data-stu-id="f3c07-205">The tactical patterns are applied within a single bounded context.</span></span> <span data-ttu-id="f3c07-206">Em uma arquitetura de microsserviços, estamos interessados principalmente nos padrões de entidade e de agregação.</span><span class="sxs-lookup"><span data-stu-id="f3c07-206">In a microservices architecture, we are particularly interested in the entity and aggregate patterns.</span></span> <span data-ttu-id="f3c07-207">Aplicar esses padrões nos ajudará a identificar limites naturais para os serviços em nosso aplicativo (consulte [próximo capítulo](./microservice-boundaries.md)).</span><span class="sxs-lookup"><span data-stu-id="f3c07-207">Applying these patterns will help us to identify natural boundaries for the services in our application (see [next chapter](./microservice-boundaries.md)).</span></span> <span data-ttu-id="f3c07-208">Como um princípio geral, um microsserviço não deve ser menor do que uma agregação e não pode exceder um contexto limitado.</span><span class="sxs-lookup"><span data-stu-id="f3c07-208">As a general principle, a microservice should be no smaller than an aggregate, and no larger than a bounded context.</span></span> <span data-ttu-id="f3c07-209">Primeiro, examinaremos os padrões táticos.</span><span class="sxs-lookup"><span data-stu-id="f3c07-209">First, we'll review the tactical patterns.</span></span> <span data-ttu-id="f3c07-210">Em seguida, os aplicaremos ao contexto limitado de remessa no aplicativo de entrega por drones.</span><span class="sxs-lookup"><span data-stu-id="f3c07-210">Then we'll apply them to the Shipping bounded context in the Drone Delivery application.</span></span>

### <a name="overview-of-the-tactical-patterns"></a><span data-ttu-id="f3c07-211">Visão geral dos padrões táticos</span><span class="sxs-lookup"><span data-stu-id="f3c07-211">Overview of the tactical patterns</span></span>

<span data-ttu-id="f3c07-212">Esta seção fornece um breve resumo sobre os padrões táticos de DDD, portanto, se você já está familiarizado com DDD, provavelmente, pode ignorar esta seção.</span><span class="sxs-lookup"><span data-stu-id="f3c07-212">This section provides a brief summary of the tactical DDD patterns, so if you are already familiar with DDD, you can probably skip this section.</span></span> <span data-ttu-id="f3c07-213">Os padrões são descritos mais detalhadamente nos capítulos 5 &ndash; 6 do livro de Eric Evans e em *Implementando Domain-Driven Design* por Vaughn Vernon.</span><span class="sxs-lookup"><span data-stu-id="f3c07-213">The patterns are described in more detail in chapters 5 &ndash; 6 of Eric Evans' book, and in *Implementing Domain-Driven Design* by Vaughn Vernon.</span></span>

![Diagrama de padrões táticos no design orientado por domínio](./images/ddd-patterns.png)

<span data-ttu-id="f3c07-215">**Entidades**.</span><span class="sxs-lookup"><span data-stu-id="f3c07-215">**Entities**.</span></span> <span data-ttu-id="f3c07-216">Uma entidade é um objeto com uma identidade exclusiva que persiste ao longo do tempo.</span><span class="sxs-lookup"><span data-stu-id="f3c07-216">An entity is an object with a unique identity that persists over time.</span></span> <span data-ttu-id="f3c07-217">Por exemplo, em um aplicativo de serviços bancários, clientes e contas seriam entidades.</span><span class="sxs-lookup"><span data-stu-id="f3c07-217">For example, in a banking application, customers and accounts would be entities.</span></span>

- <span data-ttu-id="f3c07-218">Uma entidade tem um identificador exclusivo no sistema, que pode ser usado para pesquisar pela entidade ou recuperá-la.</span><span class="sxs-lookup"><span data-stu-id="f3c07-218">An entity has a unique identifier in the system, which can be used to look up or retrieve the entity.</span></span> <span data-ttu-id="f3c07-219">Isso não significa que o identificador é sempre exposto diretamente aos usuários.</span><span class="sxs-lookup"><span data-stu-id="f3c07-219">That doesn't mean the identifier is always exposed directly to users.</span></span> <span data-ttu-id="f3c07-220">Ele pode ser um GUID ou uma chave primária em um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="f3c07-220">It could be a GUID or a primary key in a database.</span></span>
- <span data-ttu-id="f3c07-221">Uma identidade pode abranger vários contextos limitados e pode durar mais que o tempo de vida do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f3c07-221">An identity may span multiple bounded contexts, and may endure beyond the lifetime of the application.</span></span> <span data-ttu-id="f3c07-222">Por exemplo, números de conta bancária ou IDs emitidas pelo governo não estão vinculados ao tempo de vida de um aplicativo específico.</span><span class="sxs-lookup"><span data-stu-id="f3c07-222">For example, bank account numbers or government-issued IDs are not tied to the lifetime of a particular application.</span></span>
- <span data-ttu-id="f3c07-223">Os atributos de uma entidade podem se alterar ao longo do tempo.</span><span class="sxs-lookup"><span data-stu-id="f3c07-223">The attributes of an entity may change over time.</span></span> <span data-ttu-id="f3c07-224">Por exemplo, o nome ou endereço de uma pessoa pode ser alterado, mas ela ainda é a mesma pessoa.</span><span class="sxs-lookup"><span data-stu-id="f3c07-224">For example, a person's name or address might change, but they are still the same person.</span></span>
- <span data-ttu-id="f3c07-225">Uma entidade pode conter referências a outras entidades.</span><span class="sxs-lookup"><span data-stu-id="f3c07-225">An entity can hold references to other entities.</span></span>

<span data-ttu-id="f3c07-226">**Objetos de valor**.</span><span class="sxs-lookup"><span data-stu-id="f3c07-226">**Value objects**.</span></span> <span data-ttu-id="f3c07-227">Um objeto de valor não tem identidade.</span><span class="sxs-lookup"><span data-stu-id="f3c07-227">A value object has no identity.</span></span> <span data-ttu-id="f3c07-228">Ele é definido somente pelos valores de seus atributos.</span><span class="sxs-lookup"><span data-stu-id="f3c07-228">It is defined only by the values of its attributes.</span></span> <span data-ttu-id="f3c07-229">Objetos de valor também são imutáveis.</span><span class="sxs-lookup"><span data-stu-id="f3c07-229">Value objects are also immutable.</span></span> <span data-ttu-id="f3c07-230">Para atualizar um objeto de valor, você sempre cria uma nova instância para substituir a antiga.</span><span class="sxs-lookup"><span data-stu-id="f3c07-230">To update a value object, you always create a new instance to replace the old one.</span></span> <span data-ttu-id="f3c07-231">Objetos de valor podem ter métodos que encapsulam a lógica do domínio, mas esses métodos não devem ter efeitos colaterais sobre o estado do objeto.</span><span class="sxs-lookup"><span data-stu-id="f3c07-231">Value objects can have methods that encapsulate domain logic, but those methods should have no side-effects on the object's state.</span></span> <span data-ttu-id="f3c07-232">Exemplos comuns de objetos de valor incluem valores de datas e horas, moedas e cores.</span><span class="sxs-lookup"><span data-stu-id="f3c07-232">Typical examples of value objects include colors, dates and times, and currency values.</span></span>

<span data-ttu-id="f3c07-233">**Agregações**.</span><span class="sxs-lookup"><span data-stu-id="f3c07-233">**Aggregates**.</span></span> <span data-ttu-id="f3c07-234">Uma agregação define um limite de consistência em torno de uma ou mais entidades.</span><span class="sxs-lookup"><span data-stu-id="f3c07-234">An aggregate defines a consistency boundary around one or more entities.</span></span> <span data-ttu-id="f3c07-235">Exatamente uma entidade em uma agregação é a raiz.</span><span class="sxs-lookup"><span data-stu-id="f3c07-235">Exactly one entity in an aggregate is the root.</span></span> <span data-ttu-id="f3c07-236">A pesquisa é feita usando o identificador da entidade raiz.</span><span class="sxs-lookup"><span data-stu-id="f3c07-236">Lookup is done using the root entity's identifier.</span></span> <span data-ttu-id="f3c07-237">Quaisquer outras entidades na agregação são filhas da raiz e são referenciadas da raiz pelos ponteiros a seguir.</span><span class="sxs-lookup"><span data-stu-id="f3c07-237">Any other entities in the aggregate are children of the root, and are referenced by following pointers from the root.</span></span>

<span data-ttu-id="f3c07-238">A finalidade de uma agregação é modelar invariáveis transacionais.</span><span class="sxs-lookup"><span data-stu-id="f3c07-238">The purpose of an aggregate is to model transactional invariants.</span></span> <span data-ttu-id="f3c07-239">Coisas no mundo real têm redes de relações complexas.</span><span class="sxs-lookup"><span data-stu-id="f3c07-239">Things in the real world have complex webs of relationships.</span></span> <span data-ttu-id="f3c07-240">Os clientes criam ordens, as ordens contém produtos, os produtos têm fornecedores e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="f3c07-240">Customers create orders, orders contain products, products have suppliers, and so on.</span></span> <span data-ttu-id="f3c07-241">Se o aplicativo modifica vários objetos relacionados, como ele garante a consistência?</span><span class="sxs-lookup"><span data-stu-id="f3c07-241">If the application modifies several related objects, how does it guarantee consistency?</span></span> <span data-ttu-id="f3c07-242">Como manter o controle de invariáveis e impô-las?</span><span class="sxs-lookup"><span data-stu-id="f3c07-242">How do we keep track of invariants and enforce them?</span></span>  

<span data-ttu-id="f3c07-243">Aplicativos tradicionais têm usado frequentemente transações de banco de dados para impor a consistência.</span><span class="sxs-lookup"><span data-stu-id="f3c07-243">Traditional applications have often used database transactions to enforce consistency.</span></span> <span data-ttu-id="f3c07-244">Em um aplicativo distribuído, no entanto, isso muitas vezes não é viável.</span><span class="sxs-lookup"><span data-stu-id="f3c07-244">In a distributed application, however, that's often not feasible.</span></span> <span data-ttu-id="f3c07-245">Uma única transação empresarial pode abranger vários repositórios de dados, ser demorada ou envolver serviços de terceiros.</span><span class="sxs-lookup"><span data-stu-id="f3c07-245">A single business transaction may span multiple data stores, or may be long running, or may involve third-party services.</span></span> <span data-ttu-id="f3c07-246">Por fim, cabe ao aplicativo, não à camada de dados, impor as invariáveis necessárias para o domínio.</span><span class="sxs-lookup"><span data-stu-id="f3c07-246">Ultimately it's up to the application, not the data layer, to enforce the invariants required for the domain.</span></span> <span data-ttu-id="f3c07-247">É isso que as agregações destinam-se a modelar.</span><span class="sxs-lookup"><span data-stu-id="f3c07-247">That's what aggregates are meant to model.</span></span>

> [!NOTE]
> <span data-ttu-id="f3c07-248">Um agregado pode consistir em uma única entidade, sem entidades filho.</span><span class="sxs-lookup"><span data-stu-id="f3c07-248">An aggregate might consist of a single entity, without child entities.</span></span> <span data-ttu-id="f3c07-249">O que compõe uma agregação é o limite transacional.</span><span class="sxs-lookup"><span data-stu-id="f3c07-249">What makes it an aggregate is the transactional boundary.</span></span>

<span data-ttu-id="f3c07-250">**Domínio e serviços de aplicativo**.</span><span class="sxs-lookup"><span data-stu-id="f3c07-250">**Domain and application services**.</span></span> <span data-ttu-id="f3c07-251">Na terminologia DDD, um serviço é um objeto que implementa uma lógica sem conter nenhum estado.</span><span class="sxs-lookup"><span data-stu-id="f3c07-251">In DDD terminology, a service is an object that implements some logic without holding any state.</span></span> <span data-ttu-id="f3c07-252">Evans faz distinção entre *serviços de domínio*, que encapsulam a lógica do domínio, e *serviços de aplicativo*, que fornecem funcionalidades técnicas como autenticação de usuário ou envio de uma mensagem SMS.</span><span class="sxs-lookup"><span data-stu-id="f3c07-252">Evans distinguishes between *domain services*, which encapsulate domain logic, and *application services*, which provide technical functionality, such as user authentication or sending an SMS message.</span></span> <span data-ttu-id="f3c07-253">Serviços de domínio geralmente são usados para modelar comportamento que abrange várias entidades.</span><span class="sxs-lookup"><span data-stu-id="f3c07-253">Domain services are often used to model behavior that spans multiple entities.</span></span>

> [!NOTE]
> <span data-ttu-id="f3c07-254">O termo *serviço* está sobrecarregado no desenvolvimento de software.</span><span class="sxs-lookup"><span data-stu-id="f3c07-254">The term *service* is overloaded in software development.</span></span> <span data-ttu-id="f3c07-255">Aqui a definição não está diretamente relacionada a microsserviços.</span><span class="sxs-lookup"><span data-stu-id="f3c07-255">The definition here is not directly related to microservices.</span></span>

<span data-ttu-id="f3c07-256">**Eventos de domínio**.</span><span class="sxs-lookup"><span data-stu-id="f3c07-256">**Domain events**.</span></span> <span data-ttu-id="f3c07-257">Eventos de domínio podem ser usados para notificar outras partes do sistema quando algo acontece.</span><span class="sxs-lookup"><span data-stu-id="f3c07-257">Domain events can be used to notify other parts of the system when something happens.</span></span> <span data-ttu-id="f3c07-258">Como o nome sugere, eventos de domínio devem significar algo dentro do domínio.</span><span class="sxs-lookup"><span data-stu-id="f3c07-258">As the name suggests, domain events should mean something within the domain.</span></span> <span data-ttu-id="f3c07-259">Por exemplo, "um registro foi inserido em uma tabela" não é um evento de domínio.</span><span class="sxs-lookup"><span data-stu-id="f3c07-259">For example, "a record was inserted into a table" is not a domain event.</span></span> <span data-ttu-id="f3c07-260">"Uma entrega foi cancelada" é um evento de domínio.</span><span class="sxs-lookup"><span data-stu-id="f3c07-260">"A delivery was cancelled" is a domain event.</span></span> <span data-ttu-id="f3c07-261">Eventos de domínio são especialmente relevantes em uma arquitetura de microsserviços.</span><span class="sxs-lookup"><span data-stu-id="f3c07-261">Domain events are especially relevant in a microservices architecture.</span></span> <span data-ttu-id="f3c07-262">Já que microsserviços são distribuídos e não compartilham armazenamentos de dados, eventos de domínio fornecem uma maneira para os microsserviços se coordenarem entre si.</span><span class="sxs-lookup"><span data-stu-id="f3c07-262">Because microservices are distributed and don't share data stores, domain events provide a way for microservices to coordinate with each other.</span></span> <span data-ttu-id="f3c07-263">O capítulo [Comunicação entre serviços](./interservice-communication.md) discute mensagens assíncronas em mais detalhes.</span><span class="sxs-lookup"><span data-stu-id="f3c07-263">The chapter [Interservice communication](./interservice-communication.md) discusses asynchronous messaging in more detail.</span></span>

<span data-ttu-id="f3c07-264">Há alguns outros padrões de DDD não listados aqui, incluindo módulos, repositórios e fábricas.</span><span class="sxs-lookup"><span data-stu-id="f3c07-264">There are a few other DDD patterns not listed here, including factories, repositories, and modules.</span></span> <span data-ttu-id="f3c07-265">Eles poderão ser padrões úteis para quando você estiver implementando um microsserviço, mas eles são menos relevantes ao projetar os limites entre microsserviços.</span><span class="sxs-lookup"><span data-stu-id="f3c07-265">These can be useful patterns for when you are implementing a microservice, but they are less relevant when designing the boundaries between microservice.</span></span>

## <a name="drone-delivery-applying-the-patterns"></a><span data-ttu-id="f3c07-266">Entrega por Drones: Explorando os padrões</span><span class="sxs-lookup"><span data-stu-id="f3c07-266">Drone delivery: Applying the patterns</span></span>

<span data-ttu-id="f3c07-267">Começaremos com os cenários com os quais o contexto limitado de remessa deve lidar.</span><span class="sxs-lookup"><span data-stu-id="f3c07-267">We start with the scenarios that the Shipping bounded context must handle.</span></span>

- <span data-ttu-id="f3c07-268">Um cliente pode solicitar que um drone colete os produtos de uma empresa que está registrada com o serviço de entrega por drones.</span><span class="sxs-lookup"><span data-stu-id="f3c07-268">A customer can request a drone to pick up goods from a business that is registered with the drone delivery service.</span></span>
- <span data-ttu-id="f3c07-269">O remetente gera uma marcação (código de barras ou RFID) para colocar no pacote.</span><span class="sxs-lookup"><span data-stu-id="f3c07-269">The sender generates a tag (barcode or RFID) to put on the package.</span></span>
- <span data-ttu-id="f3c07-270">Um drone coletará um pacote no local de origem e o entregará no local de destino.</span><span class="sxs-lookup"><span data-stu-id="f3c07-270">A drone will pick up and deliver a package from the source location to the destination location.</span></span>
- <span data-ttu-id="f3c07-271">Quando um cliente agenda uma entrega, o sistema fornece um ETA com base em informações de rota, condições climáticas e dados históricos.</span><span class="sxs-lookup"><span data-stu-id="f3c07-271">When a customer schedules a delivery, the system provides an ETA based on route information, weather conditions, and historical data.</span></span>
- <span data-ttu-id="f3c07-272">Quando o drone está em trânsito, um usuário pode acompanhar a localização atual e a ETA mais recente.</span><span class="sxs-lookup"><span data-stu-id="f3c07-272">When the drone is in flight, a user can track the current location and the latest ETA.</span></span>
- <span data-ttu-id="f3c07-273">Até que um drone tenha coletado o pacote, o cliente pode cancelar uma entrega.</span><span class="sxs-lookup"><span data-stu-id="f3c07-273">Until a drone has picked up the package, the customer can cancel a delivery.</span></span>
- <span data-ttu-id="f3c07-274">O cliente é notificado quando a entrega é concluída.</span><span class="sxs-lookup"><span data-stu-id="f3c07-274">The customer is notified when the delivery is completed.</span></span>
- <span data-ttu-id="f3c07-275">O remetente pode solicitar confirmação de entrega do cliente, na forma de uma assinatura ou impressão digital.</span><span class="sxs-lookup"><span data-stu-id="f3c07-275">The sender can request delivery confirmation from the customer, in the form of a signature or finger print.</span></span>
- <span data-ttu-id="f3c07-276">Os usuários podem pesquisar o histórico de uma entrega concluída.</span><span class="sxs-lookup"><span data-stu-id="f3c07-276">Users can look up the history of a completed delivery.</span></span>

<span data-ttu-id="f3c07-277">Desses cenários, a equipe de desenvolvimento identificou as **entidades** a seguir.</span><span class="sxs-lookup"><span data-stu-id="f3c07-277">From these scenarios, the development team identified the following **entities**.</span></span>

- <span data-ttu-id="f3c07-278">Entrega</span><span class="sxs-lookup"><span data-stu-id="f3c07-278">Delivery</span></span>
- <span data-ttu-id="f3c07-279">Pacote</span><span class="sxs-lookup"><span data-stu-id="f3c07-279">Package</span></span>
- <span data-ttu-id="f3c07-280">Drone</span><span class="sxs-lookup"><span data-stu-id="f3c07-280">Drone</span></span>
- <span data-ttu-id="f3c07-281">Conta</span><span class="sxs-lookup"><span data-stu-id="f3c07-281">Account</span></span>
- <span data-ttu-id="f3c07-282">Confirmação</span><span class="sxs-lookup"><span data-stu-id="f3c07-282">Confirmation</span></span>
- <span data-ttu-id="f3c07-283">Notificação</span><span class="sxs-lookup"><span data-stu-id="f3c07-283">Notification</span></span>
- <span data-ttu-id="f3c07-284">Marca</span><span class="sxs-lookup"><span data-stu-id="f3c07-284">Tag</span></span>

<span data-ttu-id="f3c07-285">Os quatro primeiros, entrega, pacote, drone e conta, são todos **agregações** que representam limites de consistência transacional.</span><span class="sxs-lookup"><span data-stu-id="f3c07-285">The first four, Delivery, Package, Drone, and Account, are all **aggregates** that represent transactional consistency boundaries.</span></span> <span data-ttu-id="f3c07-286">Confirmações e Notificações são entidades filho de Entregas e Marcações são entidades filho de Pacotes.</span><span class="sxs-lookup"><span data-stu-id="f3c07-286">Confirmations and Notifications are child entities of Deliveries, and Tags are child entities of Packages.</span></span>

<span data-ttu-id="f3c07-287">Os **objetos de valor** neste projeto incluem Localização, ETA, PackageWeight e PackageSize.</span><span class="sxs-lookup"><span data-stu-id="f3c07-287">The **value objects** in this design include Location, ETA, PackageWeight, and PackageSize.</span></span>

<span data-ttu-id="f3c07-288">Para ilustrar, aqui está um diagrama UML da agregação de Entrega.</span><span class="sxs-lookup"><span data-stu-id="f3c07-288">To illustrate, here is a UML diagram of the Delivery aggregate.</span></span> <span data-ttu-id="f3c07-289">Observe que ele contém referências a outras agregações, incluindo Conta, Pacote e Drone.</span><span class="sxs-lookup"><span data-stu-id="f3c07-289">Notice that it holds references to other aggregates, including Account, Package, and Drone.</span></span>

![Diagrama UML da agregação de Entrega](./images/delivery-entity.png)

<span data-ttu-id="f3c07-291">Há dois eventos de domínio:</span><span class="sxs-lookup"><span data-stu-id="f3c07-291">There are two domain events:</span></span>

- <span data-ttu-id="f3c07-292">Enquanto um drone está em trânsito, a entidade Drone envia eventos DroneStatus que descrevem a localização do drone e seu status (em curso, descarregou).</span><span class="sxs-lookup"><span data-stu-id="f3c07-292">While a drone is in flight, the Drone entity sends DroneStatus events that describe the drone's location and status (in-flight, landed).</span></span>

- <span data-ttu-id="f3c07-293">A entidade Entrega envia eventos DeliveryTracking sempre que o estágio de uma entrega é alterado.</span><span class="sxs-lookup"><span data-stu-id="f3c07-293">The Delivery entity sends DeliveryTracking events whenever the stage of a delivery changes.</span></span> <span data-ttu-id="f3c07-294">Isso inclui DeliveryCreated, DeliveryRescheduled, DeliveryHeadedToDropoff e DeliveryCompleted.</span><span class="sxs-lookup"><span data-stu-id="f3c07-294">These include DeliveryCreated, DeliveryRescheduled, DeliveryHeadedToDropoff, and DeliveryCompleted.</span></span>

<span data-ttu-id="f3c07-295">Observe que esses eventos descrevem itens que são significativos no modelo de domínio.</span><span class="sxs-lookup"><span data-stu-id="f3c07-295">Notice that these events describe things that are meaningful within the domain model.</span></span> <span data-ttu-id="f3c07-296">Eles descrevem algo sobre o domínio e não estão ligados a um constructo de linguagem de programação específico.</span><span class="sxs-lookup"><span data-stu-id="f3c07-296">They describe something about the domain, and aren't tied to a particular programming language construct.</span></span>

<span data-ttu-id="f3c07-297">A equipe de desenvolvimento identificou mais uma área de funcionalidade que não se adéqua a nenhuma das entidades descritas até agora.</span><span class="sxs-lookup"><span data-stu-id="f3c07-297">The development team identified one more area of functionality, which doesn't fit neatly into any of the entities described so far.</span></span> <span data-ttu-id="f3c07-298">Alguma parte do sistema precisa coordenar todas as etapas envolvidas no agendamento ou atualização de uma entrega.</span><span class="sxs-lookup"><span data-stu-id="f3c07-298">Some part of the system must coordinate all of the steps involved in scheduling or updating a delivery.</span></span> <span data-ttu-id="f3c07-299">Portanto, a equipe de desenvolvimento adicionou dois **serviços de domínio** ao design: um *Agendador* que coordena as etapas e um *Supervisor* que monitora o status de cada etapa para detectar se alguma etapas falhou ou atingiu o tempo limite. Essa é uma variação do [Padrão de Supervisor de Agente do Agendador](../patterns/scheduler-agent-supervisor.md).</span><span class="sxs-lookup"><span data-stu-id="f3c07-299">Therefore, the development team added two **domain services** to the design: a *Scheduler* that coordinates the steps, and a *Supervisor* that monitors the status of each step, in order to detect whether any steps have failed or timed out. This is a variation of the [Scheduler Agent Supervisor pattern](../patterns/scheduler-agent-supervisor.md).</span></span>

![Diagrama do modelo de domínio revisado](./images/drone-ddd.png)

> [!div class="nextstepaction"]
> [<span data-ttu-id="f3c07-301">Identificando limites de microsserviço</span><span class="sxs-lookup"><span data-stu-id="f3c07-301">Identifying microservice boundaries</span></span>](./microservice-boundaries.md)
