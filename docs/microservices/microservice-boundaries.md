---
title: Identificando limites de microsserviço
description: Identificando limites de microsserviço
author: MikeWasson
ms.date: 10/23/2018
ms.openlocfilehash: 679696818d50b70a5116916bd9198a390abfd7fe
ms.sourcegitcommit: fdcacbfdc77370532a4dde776c5d9b82227dff2d
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/24/2018
ms.locfileid: "49962782"
---
# <a name="designing-microservices-identifying-microservice-boundaries"></a><span data-ttu-id="71178-103">Criando microsserviços: identificando limites de microsserviço</span><span class="sxs-lookup"><span data-stu-id="71178-103">Designing microservices: Identifying microservice boundaries</span></span>

<span data-ttu-id="71178-104">Qual é o tamanho correto de um microsserviço?</span><span class="sxs-lookup"><span data-stu-id="71178-104">What is the right size for a microservice?</span></span> <span data-ttu-id="71178-105">Muitas vezes você ouve algo como, "não muito grande e não muito pequeno" &mdash; e, embora isso seja correto, não é muito útil, na prática.</span><span class="sxs-lookup"><span data-stu-id="71178-105">You often hear something to the effect of, "not too big and not too small" &mdash; and while that's certainly correct, it's not very helpful in practice.</span></span> <span data-ttu-id="71178-106">Mas, se você iniciar de um modelo de domínio cuidadosamente desenvolvido, será mais fácil pensar sobre microsserviços.</span><span class="sxs-lookup"><span data-stu-id="71178-106">But if you start from a carefully designed domain model, it's much easier to reason about microservices.</span></span>

![](./images/bounded-contexts.png)

## <a name="from-domain-model-to-microservices"></a><span data-ttu-id="71178-107">Do modelo de domínio a microsserviços</span><span class="sxs-lookup"><span data-stu-id="71178-107">From domain model to microservices</span></span>

<span data-ttu-id="71178-108">No [capítulo anterior](./domain-analysis.md), definimos um conjunto de contextos limitados para o aplicativo de entrega por drone.</span><span class="sxs-lookup"><span data-stu-id="71178-108">In the [previous chapter](./domain-analysis.md), we defined a set of bounded contexts for the Drone Delivery application.</span></span> <span data-ttu-id="71178-109">Então, analisamos mais de perto um desses contextos limitados, o contexto limitado de Envio, e identificamos um conjunto de entidades, agregados e serviços de domínio para esse contexto limitado.</span><span class="sxs-lookup"><span data-stu-id="71178-109">Then we looked more closely at one of these bounded contexts, the Shipping bounded context, and identified a set of entities, aggregates, and domain services for that bounded context.</span></span>

<span data-ttu-id="71178-110">Agora estamos prontos para passar do modelo de domínio para o design do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="71178-110">Now we're ready to go from domain model to application design.</span></span> <span data-ttu-id="71178-111">Aqui está uma abordagem que você pode usar para derivar microsserviços do modelo de domínio.</span><span class="sxs-lookup"><span data-stu-id="71178-111">Here's an approach that you can use to derive microservices from the domain model.</span></span>

1. <span data-ttu-id="71178-112">Comece com um contexto limitado.</span><span class="sxs-lookup"><span data-stu-id="71178-112">Start with a bounded context.</span></span> <span data-ttu-id="71178-113">Em geral, a funcionalidade em um microsserviço não deve abranger mais de um contexto limitado.</span><span class="sxs-lookup"><span data-stu-id="71178-113">In general, the functionality in a microservice should not span more than one bounded context.</span></span> <span data-ttu-id="71178-114">Por definição, um contexto limitado marca o limite de um modelo de domínio específico.</span><span class="sxs-lookup"><span data-stu-id="71178-114">By definition, a bounded context marks the boundary of a particular domain model.</span></span> <span data-ttu-id="71178-115">Se você achar que um microsserviço combina diferentes modelos de domínio, é sinal de que precisa voltar e refinar sua análise de domínio.</span><span class="sxs-lookup"><span data-stu-id="71178-115">If you find that a microservice mixes different domain models together, that's a sign that you may need to go back and refine your domain analysis.</span></span>

2. <span data-ttu-id="71178-116">Em seguida, examine os agregados no seu modelo de domínio.</span><span class="sxs-lookup"><span data-stu-id="71178-116">Next, look at the aggregates in your domain model.</span></span> <span data-ttu-id="71178-117">Agregados são, frequentemente, bons candidatos a microsserviços.</span><span class="sxs-lookup"><span data-stu-id="71178-117">Aggregates are often good candidates for microservices.</span></span> <span data-ttu-id="71178-118">Um agregado bem projetado exibe muitas das características de um microsserviço bem projetado, por exemplo:</span><span class="sxs-lookup"><span data-stu-id="71178-118">A well-designed aggregate exhibits many of the characteristics of a well-designed microservice, such as:</span></span>

    - <span data-ttu-id="71178-119">Agregados são derivados de requisitos de negócios, e não de questões técnicas, como acesso a dados ou mensagens.</span><span class="sxs-lookup"><span data-stu-id="71178-119">An aggregate is derived from business requirements, rather than technical concerns such as data access or messaging.</span></span>  
    - <span data-ttu-id="71178-120">Um agregado deve ter alta coesão funcional.</span><span class="sxs-lookup"><span data-stu-id="71178-120">An aggregate should have high functional cohesion.</span></span>
    - <span data-ttu-id="71178-121">Um agregado é um limite de persistência.</span><span class="sxs-lookup"><span data-stu-id="71178-121">An aggregate is a boundary of persistence.</span></span>
    - <span data-ttu-id="71178-122">Agregados devem ser acoplados de forma flexível.</span><span class="sxs-lookup"><span data-stu-id="71178-122">Aggregates should be loosely coupled.</span></span> 
    
3. <span data-ttu-id="71178-123">Serviços de domínio também são bons candidatos a microsserviços.</span><span class="sxs-lookup"><span data-stu-id="71178-123">Domain services are also good candidates for microservices.</span></span> <span data-ttu-id="71178-124">Serviços de domínio são operações sem estado entre vários agregados.</span><span class="sxs-lookup"><span data-stu-id="71178-124">Domain services are stateless operations across multiple aggregates.</span></span> <span data-ttu-id="71178-125">Um exemplo típico é um fluxo de trabalho que envolve vários microsserviços.</span><span class="sxs-lookup"><span data-stu-id="71178-125">A typical example is a workflow that involves several microservices.</span></span> <span data-ttu-id="71178-126">Veremos um exemplo disso no aplicativo de entrega por drone.</span><span class="sxs-lookup"><span data-stu-id="71178-126">We'll see an example of this in the Drone Delivery application.</span></span>

4. <span data-ttu-id="71178-127">Finalmente, considere os requisitos não funcionais.</span><span class="sxs-lookup"><span data-stu-id="71178-127">Finally, consider non-functional requirements.</span></span> <span data-ttu-id="71178-128">Observe fatores como tamanho da equipe, tipos de dados, tecnologias, requisitos de escalabilidade, requisitos de disponibilidade e requisitos de segurança.</span><span class="sxs-lookup"><span data-stu-id="71178-128">Look at factors such as team size, data types, technologies, scalability requirements, availability requirements, and security requirements.</span></span> <span data-ttu-id="71178-129">Esses fatores podem levá-lo a decompor ainda mais um microsserviço em dois ou mais serviços menores, ou fazer o contrário e combinar vários microsserviços em um.</span><span class="sxs-lookup"><span data-stu-id="71178-129">These factors may lead you to further decompose a microservice into two or more smaller services, or do the opposite and combine several microservices into one.</span></span> 

<span data-ttu-id="71178-130">Depois de identificar os microsserviços em seu aplicativo, valide o design conforme os seguintes critérios:</span><span class="sxs-lookup"><span data-stu-id="71178-130">After you identify the microservices in your application, validate your design against the following criteria:</span></span>

- <span data-ttu-id="71178-131">Cada serviço tem uma única responsabilidade.</span><span class="sxs-lookup"><span data-stu-id="71178-131">Each service has a single responsibility.</span></span>
- <span data-ttu-id="71178-132">Não há nenhuma chamada de conversa entre os serviços.</span><span class="sxs-lookup"><span data-stu-id="71178-132">There are no chatty calls between services.</span></span> <span data-ttu-id="71178-133">Se a divisão da funcionalidade em dois serviços gerar excesso de conversas, isso poderá ser um sintoma de que essas funções pertencem ao mesmo serviço.</span><span class="sxs-lookup"><span data-stu-id="71178-133">If splitting functionality into two services causes them to be overly chatty, it may be a symptom that these functions belong in the same service.</span></span>
- <span data-ttu-id="71178-134">Cada serviço é pequeno o suficiente para ser criado por uma pequena equipe trabalhando de forma independente.</span><span class="sxs-lookup"><span data-stu-id="71178-134">Each service is small enough that it can be built by a small team working independently.</span></span>
- <span data-ttu-id="71178-135">Não há nenhuma interdependência que exige que dois ou mais serviços sejam implantados em sincronia.</span><span class="sxs-lookup"><span data-stu-id="71178-135">There are no inter-dependencies that will require two or more services to be deployed in lock-step.</span></span> <span data-ttu-id="71178-136">Deve ser sempre possível implantar um serviço sem redistribuir outros serviços.</span><span class="sxs-lookup"><span data-stu-id="71178-136">It should always be possible to deploy a service without redeploying any other services.</span></span>
- <span data-ttu-id="71178-137">Os serviços não estão acoplados de forma firme e podem evoluir de forma independente.</span><span class="sxs-lookup"><span data-stu-id="71178-137">Services are not tightly coupled, and can evolve independently.</span></span>
- <span data-ttu-id="71178-138">Os limites do serviço não criarão problemas de consistência ou integridade de dados.</span><span class="sxs-lookup"><span data-stu-id="71178-138">Your service boundaries will not create problems with data consistency or integrity.</span></span> <span data-ttu-id="71178-139">Às vezes, é importante manter a consistência dos dados colocando a funcionalidade em um único microsserviço.</span><span class="sxs-lookup"><span data-stu-id="71178-139">Sometimes it's important to maintain data consistency by putting functionality into a single microservice.</span></span> <span data-ttu-id="71178-140">Dito isto, considere se você realmente precisa de consistência forte.</span><span class="sxs-lookup"><span data-stu-id="71178-140">That said, consider whether you really need strong consistency.</span></span> <span data-ttu-id="71178-141">Existem estratégias para abordar a eventual consistência em um sistema distribuído, e os benefícios dos serviços de decomposição geralmente superam os desafios de gerenciar a consistência eventual.</span><span class="sxs-lookup"><span data-stu-id="71178-141">There are strategies for addressing eventual consistency in a distributed system, and the benefits of decomposing services often outweigh the challenges of managing eventual consistency.</span></span>

<span data-ttu-id="71178-142">Acima de tudo, é importante ser pragmático e lembrar-se de que o design orientado por domínio é um processo iterativo.</span><span class="sxs-lookup"><span data-stu-id="71178-142">Above all, it's important to be pragmatic, and remember that domain-driven design is an iterative process.</span></span> <span data-ttu-id="71178-143">Em caso de dúvida, comece com microsserviços de granulação grosseira.</span><span class="sxs-lookup"><span data-stu-id="71178-143">When in doubt, start with more coarse-grained microservices.</span></span> <span data-ttu-id="71178-144">É mais fácil dividir um microsserviço em dois serviços menores do que refatorar a funcionalidade em vários microsserviços existentes.</span><span class="sxs-lookup"><span data-stu-id="71178-144">Splitting a microservice into two smaller services is easier than refactoring functionality across several existing microservices.</span></span>
  
## <a name="drone-delivery-defining-the-microservices"></a><span data-ttu-id="71178-145">Entrega por drone: definindo a microsserviços</span><span class="sxs-lookup"><span data-stu-id="71178-145">Drone Delivery: Defining the microservices</span></span>

<span data-ttu-id="71178-146">Lembre-se de que a equipe de desenvolvimento identificou as quatro agregações &mdash; Entrega, Pacote, Drone e Conta &mdash; e dois serviços de domínio, Agendador e o Supervisor.</span><span class="sxs-lookup"><span data-stu-id="71178-146">Recall that the development team had identified the four aggregates &mdash; Delivery, Package, Drone, and Account &mdash; and two domain services, Scheduler and Supervisor.</span></span> 

<span data-ttu-id="71178-147">Entrega e Pacote são candidatos óbvios a microsserviços.</span><span class="sxs-lookup"><span data-stu-id="71178-147">Delivery and Package are obvious candidates for microservices.</span></span> <span data-ttu-id="71178-148">O Agendador e o Supervisor coordenam as atividades executadas por outros microsserviços, então, faz sentido implementar esses serviços de domínio como microsserviços.</span><span class="sxs-lookup"><span data-stu-id="71178-148">The Scheduler and Supervisor coordinate the activities performed by other microservices, so it makes sense to implement these domain services as microservices.</span></span>  

<span data-ttu-id="71178-149">Drone e Conta são interessantes porque pertencem a outros contextos limitados.</span><span class="sxs-lookup"><span data-stu-id="71178-149">Drone and Account are interesting because they belong to other bounded contexts.</span></span> <span data-ttu-id="71178-150">Uma opção é Agendador chamar contextos limitados de Drone e Conta diretamente.</span><span class="sxs-lookup"><span data-stu-id="71178-150">One option is for the Scheduler to call the Drone and Account bounded contexts directly.</span></span> <span data-ttu-id="71178-151">Outra opção é criar microsserviços de Drone e Conta dentro do contexto de envio limitado.</span><span class="sxs-lookup"><span data-stu-id="71178-151">Another option is to create Drone and Account microservices inside the Shipping bounded context.</span></span> <span data-ttu-id="71178-152">Esses microsserviços fariam a mediação entre os contextos delimitados, expondo as APIs ou os esquemas de dados mais adequados ao contexto de Envio.</span><span class="sxs-lookup"><span data-stu-id="71178-152">These microservices would mediate between the bounded contexts, by exposing APIs or data schemas that are more suited to the Shipping context.</span></span>

<span data-ttu-id="71178-153">Os detalhes dos contextos limitados de Drone e Conta estão além do escopo desta orientação, portanto, criamos serviços fictícios para eles em nossa implementação de referência.</span><span class="sxs-lookup"><span data-stu-id="71178-153">The details of the Drone and Account bounded contexts are beyond the scope of this guidance, so we created mock services for them in our reference implementation.</span></span> <span data-ttu-id="71178-154">Mas, aqui estão alguns fatores a considerar nessa situação:</span><span class="sxs-lookup"><span data-stu-id="71178-154">But here are some factors to consider in this situation:</span></span>

- <span data-ttu-id="71178-155">Qual é a sobrecarga de rede ao chamar diretamente outro contexto limitado?</span><span class="sxs-lookup"><span data-stu-id="71178-155">What is the network overhead of calling directly into the other bounded context?</span></span> 

- <span data-ttu-id="71178-156">O esquema de dados para o outro contexto limitado é adequado para esse contexto ou é melhor ter um esquema adaptado a esse contexto limitado?</span><span class="sxs-lookup"><span data-stu-id="71178-156">Is the data schema for the other bounded context suitable for this context, or is it better to have a schema that's tailored to this bounded context?</span></span> 

- <span data-ttu-id="71178-157">O outro contexto limitado é sistema herdado?</span><span class="sxs-lookup"><span data-stu-id="71178-157">Is the other bounded context a legacy system?</span></span> <span data-ttu-id="71178-158">Em caso afirmativo, crie um serviço que atue como [camada anticorrupção](../patterns/anti-corruption-layer.md) para converter entre o sistema herdado e o aplicativo moderno.</span><span class="sxs-lookup"><span data-stu-id="71178-158">If so, you might create a service that acts as an [anti-corruption layer](../patterns/anti-corruption-layer.md) to translate between the legacy system and the modern application.</span></span> 

- <span data-ttu-id="71178-159">O que é a estrutura de equipe?</span><span class="sxs-lookup"><span data-stu-id="71178-159">What is the team structure?</span></span> <span data-ttu-id="71178-160">É fácil se comunicar com a equipe responsável pelo outro contexto limitado?</span><span class="sxs-lookup"><span data-stu-id="71178-160">Is it easy to communicate with the team that's responsible for the other bounded context?</span></span> <span data-ttu-id="71178-161">Se não for fácil, a criação de um serviço que faça a mediação entre os dois contextos pode ajudar a atenuar o custo da comunicação entre equipes.</span><span class="sxs-lookup"><span data-stu-id="71178-161">If not, creating a service that mediates between the two contexts can help to mitigate the cost of cross-team communication.</span></span>

<span data-ttu-id="71178-162">Até agora, não consideramos nenhum requisito não funcional.</span><span class="sxs-lookup"><span data-stu-id="71178-162">So far, we haven't considered any non-functional requirements.</span></span> <span data-ttu-id="71178-163">Pensando nos requisitos de taxa de transferência do aplicativo, a equipe de desenvolvimento decidiu criar um microsserviço de Ingestão separado, responsável pela ingestão de solicitações do cliente.</span><span class="sxs-lookup"><span data-stu-id="71178-163">Thinking about the application's throughput requirements, the development team decided to create a separate Ingestion microservice that is responsible for ingesting client requests.</span></span> <span data-ttu-id="71178-164">Esse microsserviço implementará o [nivelamento de carga](../patterns/queue-based-load-leveling.md), colocando as solicitações recebidas em um buffer para processamento.</span><span class="sxs-lookup"><span data-stu-id="71178-164">This microservice will implement [load leveling](../patterns/queue-based-load-leveling.md) by putting incoming requests into a buffer for processing.</span></span> <span data-ttu-id="71178-165">O Agendador fará a leitura das solicitações do buffer e executará o fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="71178-165">The Scheduler will read the requests from the buffer and execute the workflow.</span></span> 

<span data-ttu-id="71178-166">Requisitos não funcionais levaram a equipe a criar um serviço adicional.</span><span class="sxs-lookup"><span data-stu-id="71178-166">Non-functional requirements led the team to create one additional service.</span></span> <span data-ttu-id="71178-167">Todos os serviços até agora foram sobre o processo de agendamento e entrega de pacotes em tempo real.</span><span class="sxs-lookup"><span data-stu-id="71178-167">All of the services so far have been about the process of scheduling and delivering packages in real time.</span></span> <span data-ttu-id="71178-168">Mas o sistema também precisa armazenar o histórico de cada entrega no armazenamento de longo prazo para análise dos dados.</span><span class="sxs-lookup"><span data-stu-id="71178-168">But the system also needs to store the history of every delivery in long-term storage for data analysis.</span></span> <span data-ttu-id="71178-169">A equipe considerou atribuir essa responsabilidade ao serviço de Entrega.</span><span class="sxs-lookup"><span data-stu-id="71178-169">The team considered making this the responsibility of the Delivery service.</span></span> <span data-ttu-id="71178-170">No entanto, os requisitos de armazenamento de dados são muito diferentes para a análise histórica versus operações em andamento (consulte [Considerações sobre dados](./data-considerations.md)).</span><span class="sxs-lookup"><span data-stu-id="71178-170">However, the data storage requirements are quite different for historical analysis versus in-flight operations (see [Data considerations](./data-considerations.md)).</span></span> <span data-ttu-id="71178-171">Portanto, a equipe decidiu criar um serviço de Histórico de Entrega separado, que escutará eventos DeliveryTracking do serviço de Entrega e gravará os eventos no armazenamento de longo prazo.</span><span class="sxs-lookup"><span data-stu-id="71178-171">Therefore, the team decided to create a separate Delivery History service, which will listen for DeliveryTracking events from the Delivery service and write the events into long-term storage.</span></span>

<span data-ttu-id="71178-172">O diagrama a seguir mostra o design neste ponto:</span><span class="sxs-lookup"><span data-stu-id="71178-172">The following diagram shows the design at this point:</span></span>
 
![](./images/microservices.png)

## <a name="choosing-a-compute-option"></a><span data-ttu-id="71178-173">Escolhendo um opção de computação</span><span class="sxs-lookup"><span data-stu-id="71178-173">Choosing a compute option</span></span>

<span data-ttu-id="71178-174">O termo *computação* refere-se ao modelo de hospedagem para os recursos de computação em que seu aplicativo é executado.</span><span class="sxs-lookup"><span data-stu-id="71178-174">The term *compute* refers to the hosting model for the computing resources that your application runs on.</span></span> <span data-ttu-id="71178-175">Para uma arquitetura de microsserviços, duas abordagens são especialmente populares:</span><span class="sxs-lookup"><span data-stu-id="71178-175">For a microservices architecture, two approaches are especially popular:</span></span>

- <span data-ttu-id="71178-176">Um orquestrador de serviços que gerencia serviços em execução em nós dedicado (VMs).</span><span class="sxs-lookup"><span data-stu-id="71178-176">A service orchestrator that manages services running on dedicated nodes (VMs).</span></span>
- <span data-ttu-id="71178-177">Uma arquitetura sem servidor que funciona como um serviço (FaaS).</span><span class="sxs-lookup"><span data-stu-id="71178-177">A serverless architecture using functions as a service (FaaS).</span></span> 

<span data-ttu-id="71178-178">Embora essas não sejam as únicas opções, são abordagens comprovadas para criação de microsserviços.</span><span class="sxs-lookup"><span data-stu-id="71178-178">While these aren't the only options, they are both proven approaches to building microservices.</span></span> <span data-ttu-id="71178-179">Um aplicativo pode incluir ambas as abordagens.</span><span class="sxs-lookup"><span data-stu-id="71178-179">An application might include both approaches.</span></span>

### <a name="service-orchestrators"></a><span data-ttu-id="71178-180">Orquestradores de serviço</span><span class="sxs-lookup"><span data-stu-id="71178-180">Service orchestrators</span></span>

<span data-ttu-id="71178-181">Um orquestrador manipula tarefas relacionadas à implantação e ao gerenciamento de um conjunto de serviços.</span><span class="sxs-lookup"><span data-stu-id="71178-181">An orchestrator handles tasks related to deploying and managing a set of services.</span></span> <span data-ttu-id="71178-182">Essas tarefas incluem a colocação de serviços em nós, monitoramento da integridade dos serviços, reinicialização de serviços não íntegros, balanceamento de carga de tráfego de rede em instâncias de serviço, descoberta de serviço, dimensionamento do número de instâncias de um serviço e aplicação das atualizações de configuração.</span><span class="sxs-lookup"><span data-stu-id="71178-182">These tasks include placing services on nodes, monitoring the health of services, restarting unhealthy services, load balancing network traffic across service instances, service discovery, scaling the number of instances of a service, and applying configuration updates.</span></span> <span data-ttu-id="71178-183">Entre os orquestradores populares estão Kubernetes, DC/OS, Docker Swarm e Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="71178-183">Popular orchestrators include Kubernetes, Service Fabric, DC/OS, and Docker Swarm.</span></span>

<span data-ttu-id="71178-184">Na plataforma do Azure, considere as seguintes opções:</span><span class="sxs-lookup"><span data-stu-id="71178-184">On the Azure platform, consider the following options:</span></span>

- <span data-ttu-id="71178-185">O AKS ([Serviço de Kubernetes do Azure](/azure/aks/)) é um serviço Kubernetes gerenciado.</span><span class="sxs-lookup"><span data-stu-id="71178-185">[Azure Kubernetes Service](/azure/aks/) (AKS) is a managed Kubernetes service.</span></span> <span data-ttu-id="71178-186">O AKS provisiona Kubernetes e expõe os pontos de extremidade da API Kubernetes, mas hospeda e gerencia o plano de controle Kubernetes, realizando atualizações automatizadas, patches automatizados, dimensionamento automático e outras tarefas de gerenciamento.</span><span class="sxs-lookup"><span data-stu-id="71178-186">AKS provisions Kubernetes and exposes the Kubernetes API endpoints, but hosts and manages the Kubernetes control plane, performing automated upgrades, automated patching, autoscaling, and other management tasks.</span></span> <span data-ttu-id="71178-187">Pense em AKS como "API Kubernetes como um serviço".</span><span class="sxs-lookup"><span data-stu-id="71178-187">You can think of AKS as being "Kubernetes APIs as a service."</span></span> 

- <span data-ttu-id="71178-188">[Service Fabric](/azure/service-fabric/) é uma plataforma de sistemas distribuídos para empacotamento, implantação e gerenciamento de microsserviços.</span><span class="sxs-lookup"><span data-stu-id="71178-188">[Service Fabric](/azure/service-fabric/) is a distributed systems platform for packaging, deploying, and managing microservices.</span></span> <span data-ttu-id="71178-189">Os microsserviços podem ser implantados no Service Fabric como contêineres, executáveis binários ou [Reliable Services](/azure/service-fabric/service-fabric-reliable-services-introduction).</span><span class="sxs-lookup"><span data-stu-id="71178-189">Microservices can be deployed to Service Fabric as containers, as binary executables, or as [Reliable Services](/azure/service-fabric/service-fabric-reliable-services-introduction).</span></span> <span data-ttu-id="71178-190">Usando o modelo de programação de Reliable Services, os serviços podem usar diretamente as APIs de programação do Service Fabric para consultar o sistema, informar sobre integridade, receber notificações sobre alterações na configuração e no código e descobrir outros serviços.</span><span class="sxs-lookup"><span data-stu-id="71178-190">Using the Reliable Services programming model, services can directly use Service Fabric programming APIs to query the system, report health, receive notifications about configuration and code changes, and discover other services.</span></span> <span data-ttu-id="71178-191">Uma diferencial importante do Service Fabric é o seu forte foco na criação de serviços com estado, usando [Coleções Confiáveis](/azure/service-fabric/service-fabric-reliable-services-reliable-collections).</span><span class="sxs-lookup"><span data-stu-id="71178-191">A key differentiation with Service Fabric is its strong focus on building stateful services using [Reliable Collections](/azure/service-fabric/service-fabric-reliable-services-reliable-collections).</span></span>

- <span data-ttu-id="71178-192">ACS [(Serviço de Contêiner do Azure)](/azure/container-service/) é um serviço Azure que permite implantar um cluster Kubernetes, DC/OS ou Docker Swarm preparado para produção.</span><span class="sxs-lookup"><span data-stu-id="71178-192">[Azure Container Service](/azure/container-service/) (ACS) is an Azure service that lets you deploy a production-ready DC/OS, Docker Swarm, or Kubernetes cluster.</span></span> 

  > [!NOTE]
  > <span data-ttu-id="71178-193">Embora o Kubernetes tenha suporte do ACS, recomendamos o AKS para executar o Kubernetes no Azure.</span><span class="sxs-lookup"><span data-stu-id="71178-193">Although Kubernetes is supported by ACS, we recommended AKS for running Kubernetes on Azure.</span></span> <span data-ttu-id="71178-194">O AKS fornece recursos aprimorados de gerenciamento e bom custo-benefício.</span><span class="sxs-lookup"><span data-stu-id="71178-194">AKS provides enhanced management capabilities and cost benefits.</span></span>

### <a name="containers"></a><span data-ttu-id="71178-195">Contêineres</span><span class="sxs-lookup"><span data-stu-id="71178-195">Containers</span></span>

<span data-ttu-id="71178-196">Às vezes, as pessoas falam sobre contêineres e microsserviços como se fossem a mesma coisa.</span><span class="sxs-lookup"><span data-stu-id="71178-196">Sometimes people talk about containers and microservices as if they were the same thing.</span></span> <span data-ttu-id="71178-197">Embora isso não seja verdade &mdash; você não precisa de contêineres para criar microsserviços &mdash; os contêineres têm alguns benefícios particularmente relevantes para microsserviços, como:</span><span class="sxs-lookup"><span data-stu-id="71178-197">While that's not true &mdash; you don't need containers to build microservices &mdash; containers do have some benefits that are particularly relevant to microservices, such as:</span></span>

- <span data-ttu-id="71178-198">**Portabilidade**.</span><span class="sxs-lookup"><span data-stu-id="71178-198">**Portability**.</span></span> <span data-ttu-id="71178-199">Uma imagem de contêiner é um pacote autônomo, que é executado sem a necessidade de instalar bibliotecas ou outras dependências.</span><span class="sxs-lookup"><span data-stu-id="71178-199">A container image is a standalone package that runs without needing to install libraries or other dependencies.</span></span> <span data-ttu-id="71178-200">Isso facilita a implantação.</span><span class="sxs-lookup"><span data-stu-id="71178-200">That makes them easy to deploy.</span></span> <span data-ttu-id="71178-201">Contêineres podem ser iniciados e interrompidos rapidamente, portanto, você pode criar novas instâncias para lidar com mais carga ou para se recuperar de falhas de nó.</span><span class="sxs-lookup"><span data-stu-id="71178-201">Containers can be started and stopped quickly, so you can spin up new instances to handle more load or to recover from node failures.</span></span> 

- <span data-ttu-id="71178-202">**Densidade**.</span><span class="sxs-lookup"><span data-stu-id="71178-202">**Density**.</span></span> <span data-ttu-id="71178-203">Contêineres são leves em comparação com a execução de uma máquina virtual, porque eles compartilham os recursos do sistema operacional.</span><span class="sxs-lookup"><span data-stu-id="71178-203">Containers are lightweight compared with running a virtual machine, because they share OS resources.</span></span> <span data-ttu-id="71178-204">Isso possibilita empacotar vários contêineres em um único nó, o que é especialmente útil quando o aplicativo é composto por muitos pequenos serviços.</span><span class="sxs-lookup"><span data-stu-id="71178-204">That makes it possible to pack multiple containers onto a single node, which is especially useful when the application consists of many small services.</span></span>

- <span data-ttu-id="71178-205">**Isolamento de recurso**.</span><span class="sxs-lookup"><span data-stu-id="71178-205">**Resource isolation**.</span></span> <span data-ttu-id="71178-206">Você pode limitar a quantidade de memória e a CPU disponível para um contêiner, o que ajuda a garantir que um processo sem controle não esgote os recursos do host.</span><span class="sxs-lookup"><span data-stu-id="71178-206">You can limit the amount of memory and CPU that is available to a container, which can help to ensure that a runaway process doesn't exhaust the host resources.</span></span> <span data-ttu-id="71178-207">Consulte o [padrão de Bulkhead](../patterns/bulkhead.md) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="71178-207">See the [Bulkhead Pattern](../patterns/bulkhead.md) for more information.</span></span>

### <a name="serverless-functions-as-a-service"></a><span data-ttu-id="71178-208">Sem Servidor (Funções como um serviço)</span><span class="sxs-lookup"><span data-stu-id="71178-208">Serverless (Functions as a Service)</span></span>

<span data-ttu-id="71178-209">Com uma arquitetura [sem servidor](https://azure.microsoft.com/solutions/serverless/), não é possível administrar VMs nem a infraestrutura de rede virtual.</span><span class="sxs-lookup"><span data-stu-id="71178-209">With a [serverless](https://azure.microsoft.com/solutions/serverless/) architecture, you don't manage the VMs or the virtual network infrastructure.</span></span> <span data-ttu-id="71178-210">Em vez disso, você implanta o código, e o serviço de hospedagem coloca esse código em uma VM e o executa.</span><span class="sxs-lookup"><span data-stu-id="71178-210">Instead, you deploy code and the hosting service handles putting that code onto a VM and executing it.</span></span> <span data-ttu-id="71178-211">Essa abordagem tende a favorecer pequenas funções granulares que sejam coordenadas usando gatilhos baseados em eventos.</span><span class="sxs-lookup"><span data-stu-id="71178-211">This approach tends to favor small granular functions that are coordinated using event-based triggers.</span></span> <span data-ttu-id="71178-212">Por exemplo, uma mensagem colocada em uma fila pode disparar uma função que lê da fila e processa a mensagem.</span><span class="sxs-lookup"><span data-stu-id="71178-212">For example, a message being placed onto a queue might trigger a function that reads from the queue and processes the message.</span></span>

<span data-ttu-id="71178-213">[Azure Functions] [ functions] é um serviço de computação sem servidor, compatível com vários gatilhos de função, incluindo solicitações de HTTP, filas de barramento de serviço e eventos de Hubs de Eventos.</span><span class="sxs-lookup"><span data-stu-id="71178-213">[Azure Functions][functions] is a serverless compute service that supports various function triggers, including HTTP requests, Service Bus queues, and Event Hubs events.</span></span> <span data-ttu-id="71178-214">Para obter uma lista completa, consulte [Gatilhos e conceitos de ligação do Azure Functions][functions-triggers].</span><span class="sxs-lookup"><span data-stu-id="71178-214">For a complete list, see [Azure Functions triggers and bindings concepts][functions-triggers].</span></span> <span data-ttu-id="71178-215">Além disso, considere a [Grade de Eventos do Azure][event-grid], que é um serviço de roteamento de eventos gerenciados no Azure.</span><span class="sxs-lookup"><span data-stu-id="71178-215">Also consider [Azure Event Grid][event-grid], which is a managed event routing service in Azure.</span></span>

### <a name="orchestrator-or-serverless"></a><span data-ttu-id="71178-216">Orchestrator ou sem servidor?</span><span class="sxs-lookup"><span data-stu-id="71178-216">Orchestrator or serverless?</span></span>

<span data-ttu-id="71178-217">Aqui estão alguns fatores a considerar ao escolher entre uma abordagem de orquestrador e uma abordagem sem servidor.</span><span class="sxs-lookup"><span data-stu-id="71178-217">Here are some factors to consider when choosing between an orchestrator approach and a serverless approach.</span></span>

<span data-ttu-id="71178-218">**Capacidade de gerenciamento** um aplicativo sem servidor é fácil de gerenciar, porque a plataforma gerencia todos os de recursos de computação por você.</span><span class="sxs-lookup"><span data-stu-id="71178-218">**Manageability** A serverless application is easy to manage, because the platform manages all the of compute resources for you.</span></span> <span data-ttu-id="71178-219">Um orquestrador abstrai alguns aspectos de gerenciamento e configuração de um cluster, mas ele não oculta completamente as VMs subjacentes.</span><span class="sxs-lookup"><span data-stu-id="71178-219">While an orchestrator abstracts some aspects of managing and configuring a cluster, it does not completely hide the underlying VMs.</span></span> <span data-ttu-id="71178-220">Com um orquestrador, você terá de pensar sobre problemas como, balanceamento de carga, uso de CPU e de memória e rede.</span><span class="sxs-lookup"><span data-stu-id="71178-220">With an orchestrator, you will need to think about issues such as load balancing, CPU and memory usage, and networking.</span></span>

<span data-ttu-id="71178-221">**Flexibilidade e controle**.</span><span class="sxs-lookup"><span data-stu-id="71178-221">**Flexibility and control**.</span></span> <span data-ttu-id="71178-222">Um orquestrador fornece muito controle sobre como configurar e gerenciar seus serviços e o cluster.</span><span class="sxs-lookup"><span data-stu-id="71178-222">An orchestrator gives you a great deal of control over configuring and managing your services and the cluster.</span></span> <span data-ttu-id="71178-223">A desvantagem é a complexidade adicional.</span><span class="sxs-lookup"><span data-stu-id="71178-223">The tradeoff is additional complexity.</span></span> <span data-ttu-id="71178-224">Com uma arquitetura sem servidor, você perde um pouco do controle porque esses detalhes são abstraídos.</span><span class="sxs-lookup"><span data-stu-id="71178-224">With a serverless architecture, you give up some degree of control because these details are abstracted.</span></span>

<span data-ttu-id="71178-225">**Portabilidade**.</span><span class="sxs-lookup"><span data-stu-id="71178-225">**Portability**.</span></span> <span data-ttu-id="71178-226">Todos os orquestradores listados aqui (Kubernetes, DC/OS, Docker Swarm e Service Fabric) podem ser executados localmente ou em várias nuvens publicas.</span><span class="sxs-lookup"><span data-stu-id="71178-226">All of the orchestrators listed here (Kubernetes, DC/OS, Docker Swarm, and Service Fabric) can run on-premises or in multiple public clouds.</span></span> 

<span data-ttu-id="71178-227">**Integração de aplicativos**.</span><span class="sxs-lookup"><span data-stu-id="71178-227">**Application integration**.</span></span> <span data-ttu-id="71178-228">Pode ser um desafio criar um aplicativo complexo usando uma arquitetura sem servidor.</span><span class="sxs-lookup"><span data-stu-id="71178-228">It can be challenging to build a complex application using a serverless architecture.</span></span> <span data-ttu-id="71178-229">Uma opção no Azure é usar [Aplicativos Lógicos do Azure](/azure/logic-apps/) para coordenar um conjunto do Azure Functions.</span><span class="sxs-lookup"><span data-stu-id="71178-229">One option in Azure is to use [Azure Logic Apps](/azure/logic-apps/) to coordinate a set of Azure Functions.</span></span> <span data-ttu-id="71178-230">Para um exemplo dessa abordagem, consulte [Criar uma função que se integre aos Aplicativos Lógicos do Azure](/azure/azure-functions/functions-twitter-email).</span><span class="sxs-lookup"><span data-stu-id="71178-230">For an example of this approach, see [Create a function that integrates with Azure Logic Apps](/azure/azure-functions/functions-twitter-email).</span></span>

<span data-ttu-id="71178-231">**Custo**.</span><span class="sxs-lookup"><span data-stu-id="71178-231">**Cost**.</span></span> <span data-ttu-id="71178-232">Com um orquestrador, você paga pelas VMs em execução no cluster.</span><span class="sxs-lookup"><span data-stu-id="71178-232">With an orchestrator, you pay for the VMs that are running in the cluster.</span></span> <span data-ttu-id="71178-233">Com um aplicativo sem servidor, você paga apenas pelos recursos de computação real consumidos.</span><span class="sxs-lookup"><span data-stu-id="71178-233">With a serverless application, you pay only for the actual compute resources consumed.</span></span> <span data-ttu-id="71178-234">Em ambos os casos, você precisa considerar o custo dos serviços adicionais, como armazenamento, bancos de dados e serviços de mensagens.</span><span class="sxs-lookup"><span data-stu-id="71178-234">In both cases, you need to factor in the cost of any additional services, such as storage, databases, and messaging services.</span></span>

<span data-ttu-id="71178-235">**Escalabilidade**.</span><span class="sxs-lookup"><span data-stu-id="71178-235">**Scalability**.</span></span> <span data-ttu-id="71178-236">O Azure Functions é dimensionado automaticamente para atender à demanda, com base no número de eventos recebidos.</span><span class="sxs-lookup"><span data-stu-id="71178-236">Azure Functions scales automatically to meet demand, based on the number of incoming events.</span></span> <span data-ttu-id="71178-237">Com um orquestrador, você pode expandir, aumentando o número de instâncias de serviço em execução no cluster.</span><span class="sxs-lookup"><span data-stu-id="71178-237">With an orchestrator, you can scale out by increasing the number of service instances running in the cluster.</span></span> <span data-ttu-id="71178-238">Você também pode dimensionar adicionando VMs ao cluster.</span><span class="sxs-lookup"><span data-stu-id="71178-238">You can also scale by adding additional VMs to the cluster.</span></span>

<span data-ttu-id="71178-239">Nossa implementação da referência usa principalmente Kubernetes, mas nós usamos o Azure Functions para um serviço, ou seja, o serviço de histórico de entrega.</span><span class="sxs-lookup"><span data-stu-id="71178-239">Our reference implementation primarily uses Kubernetes, but we did use Azure Functions for one service, namely the Delivery History service.</span></span> <span data-ttu-id="71178-240">O Azure Functions foi uma boa opção para esse serviço em particular, porque é uma carga de trabalho baseada em eventos.</span><span class="sxs-lookup"><span data-stu-id="71178-240">Azure Functions was a good fit for this particular service, because it's is an event-driven workload.</span></span> <span data-ttu-id="71178-241">Usando um gatilho de Hubs de Eventos para chamar a função, o serviço precisou de uma quantidade mínima de código.</span><span class="sxs-lookup"><span data-stu-id="71178-241">By using an Event Hubs trigger to invoke the function, the service needed a minimal amount of code.</span></span> <span data-ttu-id="71178-242">Além disso, o serviço de Histórico de Entrega não faz parte do fluxo de trabalho principal, portanto, executá-lo fora do cluster Kubernetes não afeta a latência ponta a ponta de operações iniciadas pelo usuário.</span><span class="sxs-lookup"><span data-stu-id="71178-242">Also, the Delivery History service is not part of the main workflow, so running it outside of the Kubernetes cluster doesn't affect the end-to-end latency of user-initiated operations.</span></span> 

> [!div class="nextstepaction"]
> [<span data-ttu-id="71178-243">Considerações sobre dados</span><span class="sxs-lookup"><span data-stu-id="71178-243">Data considerations</span></span>](./data-considerations.md)

<!-- links -->

[acs-engine]: https://github.com/Azure/acs-engine
[acs-faq]: /azure/container-service/dcos-swarm/container-service-faq
[event-grid]: /azure/event-grid/
[functions]: /azure/azure-functions/functions-overview
[functions-triggers]: /azure/azure-functions/functions-triggers-bindings
