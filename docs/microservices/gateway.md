---
title: Gateways de API
description: "Gateway de API em microsserviços"
author: MikeWasson
ms.date: 12/08/2017
ms.openlocfilehash: 6483d416363e24f4084d6b856847a740bf4054d9
ms.sourcegitcommit: a8453c4bc7c870fa1a12bb3c02e3b310db87530c
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 12/29/2017
---
# <a name="designing-microservices-api-gateways"></a><span data-ttu-id="5c20d-103">Criando microsserviços: gateways de API</span><span class="sxs-lookup"><span data-stu-id="5c20d-103">Designing microservices: API gateways</span></span>

<span data-ttu-id="5c20d-104">Em uma arquitetura de microsserviços, um cliente pode interagir com mais de um serviço front-end.</span><span class="sxs-lookup"><span data-stu-id="5c20d-104">In a microservices architecture, a client might interact with more than one front-end service.</span></span> <span data-ttu-id="5c20d-105">Em razão disso, como um cliente sabe quais pontos de extremidade a serem chamados?</span><span class="sxs-lookup"><span data-stu-id="5c20d-105">Given this fact, how does a client know what endpoints to call?</span></span> <span data-ttu-id="5c20d-106">O que acontece quando são introduzidos novos serviços ou serviços existentes são refatorados?</span><span class="sxs-lookup"><span data-stu-id="5c20d-106">What happens when new services are introduced, or existing services are refactored?</span></span> <span data-ttu-id="5c20d-107">Como os serviços processam terminação SSL, autenticação e outras questões?</span><span class="sxs-lookup"><span data-stu-id="5c20d-107">How do services handle SSL termination, authentication, and other concerns?</span></span> <span data-ttu-id="5c20d-108">Um *gateway API* pode ajudar a enfrentar esses desafios.</span><span class="sxs-lookup"><span data-stu-id="5c20d-108">An *API gateway* can help to address these challenges.</span></span> 

![](./images/gateway.png)

## <a name="what-is-an-api-gateway"></a><span data-ttu-id="5c20d-109">O que é um gateway de API?</span><span class="sxs-lookup"><span data-stu-id="5c20d-109">What is an API gateway?</span></span>

<span data-ttu-id="5c20d-110">Um gateway de API fica entre clientes e serviços.</span><span class="sxs-lookup"><span data-stu-id="5c20d-110">An API gateway sits between clients and services.</span></span> <span data-ttu-id="5c20d-111">Ele atua como um proxy reverso, encaminhando as solicitações de clientes para serviços.</span><span class="sxs-lookup"><span data-stu-id="5c20d-111">It acts as a reverse proxy, routing requests from clients to services.</span></span> <span data-ttu-id="5c20d-112">Ele também pode executar várias tarefas detalhadas, como autenticação, terminação de SSL e a limitação de taxa.</span><span class="sxs-lookup"><span data-stu-id="5c20d-112">It may also perform various cross-cutting tasks such as authentication, SSL termination, and rate limiting.</span></span> <span data-ttu-id="5c20d-113">Se você não implantar um gateway, os clientes deverão enviar solicitações diretamente aos serviços front-end.</span><span class="sxs-lookup"><span data-stu-id="5c20d-113">If you don't deploy a gateway, clients must send requests directly to front-end services.</span></span> <span data-ttu-id="5c20d-114">No entanto, há alguns possíveis problemas com a exposição de serviços diretamente aos clientes:</span><span class="sxs-lookup"><span data-stu-id="5c20d-114">However, there are some potential problems with exposing services directly to clients:</span></span>

- <span data-ttu-id="5c20d-115">Isso pode resultar em código de cliente complexo.</span><span class="sxs-lookup"><span data-stu-id="5c20d-115">It can result in complex client code.</span></span> <span data-ttu-id="5c20d-116">O cliente deve manter o controle dos vários pontos de extremidade e lidar com falhas de forma resiliente.</span><span class="sxs-lookup"><span data-stu-id="5c20d-116">The client must keep track of multiple endpoints, and handle failures in a resilient way.</span></span> 
- <span data-ttu-id="5c20d-117">Ele cria um acoplamento entre o cliente e o back-end.</span><span class="sxs-lookup"><span data-stu-id="5c20d-117">It creates coupling between the client and the backend.</span></span> <span data-ttu-id="5c20d-118">O cliente precisa saber como os serviços individuais são decompostos.</span><span class="sxs-lookup"><span data-stu-id="5c20d-118">The client needs to know how the individual services are decomposed.</span></span> <span data-ttu-id="5c20d-119">Isso torna mais difícil manter o cliente e também mais difícil refatorar serviços.</span><span class="sxs-lookup"><span data-stu-id="5c20d-119">That makes it harder to maintain the client and also harder to refactor services.</span></span>
- <span data-ttu-id="5c20d-120">Uma única operação pode exigir chamadas para vários serviços.</span><span class="sxs-lookup"><span data-stu-id="5c20d-120">A single operation might require calls to multiple services.</span></span> <span data-ttu-id="5c20d-121">Isso pode resultar em várias viagem de ida e volta na rede entre o cliente e o servidor, adicionando latência significativa.</span><span class="sxs-lookup"><span data-stu-id="5c20d-121">That can result in multiple network round trips between the client and the server, adding significant latency.</span></span> 
- <span data-ttu-id="5c20d-122">Cada serviço voltado ao público deve lidar com preocupações como autenticação, SSL e limite de taxa do cliente.</span><span class="sxs-lookup"><span data-stu-id="5c20d-122">Each public-facing service must handle concerns such as authentication, SSL, and client rate limiting.</span></span> 
- <span data-ttu-id="5c20d-123">Serviços devem expor um protocolo de cliente amigável, como HTTP ou WebSocket.</span><span class="sxs-lookup"><span data-stu-id="5c20d-123">Services must expose a client-friendly protocol such as HTTP or WebSocket.</span></span> <span data-ttu-id="5c20d-124">Isso limita a escolha de [protocolos de comunicação](./interservice-communication.md).</span><span class="sxs-lookup"><span data-stu-id="5c20d-124">This limits the choice of [communication protocols](./interservice-communication.md).</span></span> 
- <span data-ttu-id="5c20d-125">Serviços com pontos de extremidade públicos são uma superfície de ataque potencial e devem ser protegidos.</span><span class="sxs-lookup"><span data-stu-id="5c20d-125">Services with public endpoints are a potential attack surface, and must be hardened.</span></span>

<span data-ttu-id="5c20d-126">Um gateway ajuda a resolver esses problemas, separando clientes de serviços.</span><span class="sxs-lookup"><span data-stu-id="5c20d-126">A gateway helps to address these issues by decoupling clients from services.</span></span> <span data-ttu-id="5c20d-127">Gateways podem executar várias funções diferentes, e você pode não precisar de todas elas.</span><span class="sxs-lookup"><span data-stu-id="5c20d-127">Gateways can perform a number of different functions, and you may not need all of them.</span></span> <span data-ttu-id="5c20d-128">As funções podem ser agrupadas nos seguintes padrões de design:</span><span class="sxs-lookup"><span data-stu-id="5c20d-128">The functions can be grouped into the following design patterns:</span></span>

<span data-ttu-id="5c20d-129">[Roteamento de Gateway](../patterns/gateway-routing.md).</span><span class="sxs-lookup"><span data-stu-id="5c20d-129">[Gateway Routing](../patterns/gateway-routing.md).</span></span> <span data-ttu-id="5c20d-130">Use o gateway como um proxy reverso para encaminhar solicitações para um ou mais serviços de back-end, usando o roteamento de 7 camadas.</span><span class="sxs-lookup"><span data-stu-id="5c20d-130">Use the gateway as a reverse proxy to route requests to one or more backend services, using layer 7 routing.</span></span> <span data-ttu-id="5c20d-131">O gateway fornece um ponto de extremidade único para os clientes e ajuda a separar clientes de serviços.</span><span class="sxs-lookup"><span data-stu-id="5c20d-131">The gateway provides a single endpoint for clients, and helps to decouple clients from services.</span></span> 

<span data-ttu-id="5c20d-132">[Agregação de Gateway](../patterns/gateway-aggregation.md).</span><span class="sxs-lookup"><span data-stu-id="5c20d-132">[Gateway Aggregation](../patterns/gateway-aggregation.md).</span></span> <span data-ttu-id="5c20d-133">Use o gateway para agregar várias solicitações individuais em uma única solicitação.</span><span class="sxs-lookup"><span data-stu-id="5c20d-133">Use the gateway to aggregate multiple individual requests into a single request.</span></span> <span data-ttu-id="5c20d-134">Esse padrão se aplica quando uma única operação exige chamadas para vários serviços de back-end.</span><span class="sxs-lookup"><span data-stu-id="5c20d-134">This pattern applies when a single operation requires calls to multiple backend services.</span></span> <span data-ttu-id="5c20d-135">O cliente envia uma solicitação para o gateway.</span><span class="sxs-lookup"><span data-stu-id="5c20d-135">The client sends one request to the gateway.</span></span> <span data-ttu-id="5c20d-136">O gateway envia solicitações para os vários serviços de back-end, agrega os resultados e os envia de volta ao cliente.</span><span class="sxs-lookup"><span data-stu-id="5c20d-136">The gateway dispatches requests to the various backend services, and then aggregates the results and sends them back to the client.</span></span> <span data-ttu-id="5c20d-137">Isso ajuda a reduzir conversas entre o cliente e o back-end.</span><span class="sxs-lookup"><span data-stu-id="5c20d-137">This helps to reduce chattiness between the client and the backend.</span></span> 

<span data-ttu-id="5c20d-138">[Descarregamento de gateway](../patterns/gateway-offloading.md).</span><span class="sxs-lookup"><span data-stu-id="5c20d-138">[Gateway Offloading](../patterns/gateway-offloading.md).</span></span> <span data-ttu-id="5c20d-139">Use o gateway para descarregar funcionalidade de serviços individuais no gateway, particularmente questões transversais.</span><span class="sxs-lookup"><span data-stu-id="5c20d-139">Use the gateway to offload functionality from individual services to the gateway, particularly cross-cutting concerns.</span></span> <span data-ttu-id="5c20d-140">Pode ser útil consolidar essas funções em um único local, em vez de responsabilizar cada serviço por implementá-las.</span><span class="sxs-lookup"><span data-stu-id="5c20d-140">It can be useful to consolidate these functions into one place, rather than making every service responsible for implementing them.</span></span> <span data-ttu-id="5c20d-141">Isso é especialmente verdadeiro para recursos que exigem habilidades especializadas para implementação correta, como autenticação e autorização.</span><span class="sxs-lookup"><span data-stu-id="5c20d-141">This is particularly true for features that requires specialized skills to implement correctly, such as authentication and authorization.</span></span> 

<span data-ttu-id="5c20d-142">Aqui estão alguns exemplos de funcionalidade que pode ser transferida para um gateway:</span><span class="sxs-lookup"><span data-stu-id="5c20d-142">Here are some examples of functionality that could be offloaded to a gateway:</span></span>

- <span data-ttu-id="5c20d-143">Terminação SSL</span><span class="sxs-lookup"><span data-stu-id="5c20d-143">SSL termination</span></span>
- <span data-ttu-id="5c20d-144">Autenticação</span><span class="sxs-lookup"><span data-stu-id="5c20d-144">Authentication</span></span>
- <span data-ttu-id="5c20d-145">Lista de permissões de IP</span><span class="sxs-lookup"><span data-stu-id="5c20d-145">IP whitelisting</span></span>
- <span data-ttu-id="5c20d-146">Limitação de taxa do cliente (limitação)</span><span class="sxs-lookup"><span data-stu-id="5c20d-146">Client rate limiting (throttling)</span></span>
- <span data-ttu-id="5c20d-147">Log e monitoramento</span><span class="sxs-lookup"><span data-stu-id="5c20d-147">Logging and monitoring</span></span>
- <span data-ttu-id="5c20d-148">Cache de resposta</span><span class="sxs-lookup"><span data-stu-id="5c20d-148">Response caching</span></span>
- <span data-ttu-id="5c20d-149">Firewall do aplicativo Web</span><span class="sxs-lookup"><span data-stu-id="5c20d-149">Web application firewall</span></span>
- <span data-ttu-id="5c20d-150">Compactação GZIP</span><span class="sxs-lookup"><span data-stu-id="5c20d-150">GZIP compression</span></span>
- <span data-ttu-id="5c20d-151">Manutenção de conteúdo estático</span><span class="sxs-lookup"><span data-stu-id="5c20d-151">Servicing static content</span></span>

## <a name="choosing-a-gateway-technology"></a><span data-ttu-id="5c20d-152">Escolhendo uma tecnologia de gateway</span><span class="sxs-lookup"><span data-stu-id="5c20d-152">Choosing a gateway technology</span></span>

<span data-ttu-id="5c20d-153">Aqui estão algumas opções para a implementação de um gateway de API em seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="5c20d-153">Here are some options for implementing an API gateway in your application.</span></span>

- <span data-ttu-id="5c20d-154">**Servidor proxy reverso**.</span><span class="sxs-lookup"><span data-stu-id="5c20d-154">**Reverse proxy server**.</span></span> <span data-ttu-id="5c20d-155">Nginx e HAProxy são servidores de proxy reverso populares compatíveis com recursos como balanceamento de carga, SSL e roteamento de 7 camadas.</span><span class="sxs-lookup"><span data-stu-id="5c20d-155">Nginx and HAProxy are popular reverse proxy servers that support features such as load balancing, SSL, and layer 7 routing.</span></span> <span data-ttu-id="5c20d-156">Os dois são produtos de software livre, com edições pagas que fornecem recursos adicionais e opções de suporte.</span><span class="sxs-lookup"><span data-stu-id="5c20d-156">They are both free, open-source products, with paid editions that provide additional features and support options.</span></span> <span data-ttu-id="5c20d-157">Nginx e HAProxy são ambos produtos desenvolvidos com conjuntos de recursos avançados e alto desempenho.</span><span class="sxs-lookup"><span data-stu-id="5c20d-157">Nginx and HAProxy are both mature products with rich feature sets and high performance.</span></span> <span data-ttu-id="5c20d-158">Você pode estendê-las com módulos de terceiros ou gravar scripts personalizados em Lua.</span><span class="sxs-lookup"><span data-stu-id="5c20d-158">You can extend them with third-party modules or by writing custom scripts in Lua.</span></span> <span data-ttu-id="5c20d-159">O Nginx também é compatível um módulo de script baseado em JavaScript, chamado NginScript.</span><span class="sxs-lookup"><span data-stu-id="5c20d-159">Nginx also supports a JavaScript-based scripting module called NginScript.</span></span>

- <span data-ttu-id="5c20d-160">**Controlador de entrada de malha de serviços**.</span><span class="sxs-lookup"><span data-stu-id="5c20d-160">**Service mesh ingress controller**.</span></span> <span data-ttu-id="5c20d-161">Se você estiver usando uma malha de serviços como linkerd ou Istio, considere os recursos fornecidos pelo controlador de entrada dessa malha de serviços.</span><span class="sxs-lookup"><span data-stu-id="5c20d-161">If you are using a service mesh such as linkerd or Istio, consider the features that are provided by the ingress controller for that service mesh.</span></span> <span data-ttu-id="5c20d-162">Por exemplo, o controlador de entrada Istio é compatível com roteamento de 7 camadas, redirecionamentos de HTTP, repetições e outros recursos.</span><span class="sxs-lookup"><span data-stu-id="5c20d-162">For example, the Istio ingress controller supports layer 7 routing, HTTP redirects, retries, and other features.</span></span> 

- <span data-ttu-id="5c20d-163">[Gateway de Aplicativo do Azure](/azure/application-gateway/).</span><span class="sxs-lookup"><span data-stu-id="5c20d-163">[Azure Application Gateway](/azure/application-gateway/).</span></span> <span data-ttu-id="5c20d-164">O Gateway de Aplicativo é um serviço de balanceamento de carga gerenciado que pode executar roteamento de 7 camadas e terminação SSL.</span><span class="sxs-lookup"><span data-stu-id="5c20d-164">Application Gateway is a managed load balancing service that can perform layer-7 routing and SSL termination.</span></span> <span data-ttu-id="5c20d-165">Ele também fornece um WAF (Firewall de Aplicativo Web).</span><span class="sxs-lookup"><span data-stu-id="5c20d-165">It also provides a web application firewall (WAF).</span></span>

- <span data-ttu-id="5c20d-166">[Gerenciamento de API do Azure](/azure/api-management/).</span><span class="sxs-lookup"><span data-stu-id="5c20d-166">[Azure API Management](/azure/api-management/).</span></span> <span data-ttu-id="5c20d-167">Gerenciamento de API é uma solução completa para publicar APIs para clientes externos e internos.</span><span class="sxs-lookup"><span data-stu-id="5c20d-167">API Management is a turnkey solution for publishing APIs to external and internal customers.</span></span> <span data-ttu-id="5c20d-168">Ela oferece recursos que são úteis para gerenciar uma API voltado ao público, incluindo limitação de taxa, permissão de IP e autenticação usando o Azure Active Directory ou outros provedores de identidade.</span><span class="sxs-lookup"><span data-stu-id="5c20d-168">It provides features that are useful for managing a public-facing API, including rate limiting, IP white listing, and authentication using Azure Active Directory or other identity providers.</span></span> <span data-ttu-id="5c20d-169">Gerenciamento de API não executa balanceamento de carga, portanto deve ser usado em conjunto com um balanceador de carga, como um proxy reverso ou Gateway de Aplicativo.</span><span class="sxs-lookup"><span data-stu-id="5c20d-169">API Management doesn't perform any load balancing, so it should be used in conjunction with a load balancer such as Application Gateway or a reverse proxy.</span></span>

<span data-ttu-id="5c20d-170">Ao escolher uma tecnologia de gateway, considere o seguinte:</span><span class="sxs-lookup"><span data-stu-id="5c20d-170">When choosing a gateway technology, consider the following:</span></span>

<span data-ttu-id="5c20d-171">**Recursos**.</span><span class="sxs-lookup"><span data-stu-id="5c20d-171">**Features**.</span></span> <span data-ttu-id="5c20d-172">As opções listadas acima são compatíveis com roteamento de 7 camadas, mas o suporte a outros recursos vai variar.</span><span class="sxs-lookup"><span data-stu-id="5c20d-172">The options listed above all support layer 7 routing, but support for other features will vary.</span></span> <span data-ttu-id="5c20d-173">Dependendo dos recursos que você precisa, poderá implantar mais de um gateway.</span><span class="sxs-lookup"><span data-stu-id="5c20d-173">Depending on the features that you need, you might deploy more than one gateway.</span></span> 

<span data-ttu-id="5c20d-174">**Implantação**.</span><span class="sxs-lookup"><span data-stu-id="5c20d-174">**Deployment**.</span></span> <span data-ttu-id="5c20d-175">Gateway de Aplicativo do Azure e Gerenciamento de API são serviços gerenciados.</span><span class="sxs-lookup"><span data-stu-id="5c20d-175">Azure Application Gateway and API Management are managed services.</span></span> <span data-ttu-id="5c20d-176">Nginx e HAProxy serão executado normalmente em contêineres dentro do cluster, mas também podem ser implantados em VMs dedicadas fora do cluster.</span><span class="sxs-lookup"><span data-stu-id="5c20d-176">Nginx and HAProxy will typically run in containers inside the cluster, but can also be deployed to dedicated VMs outside of the cluster.</span></span> <span data-ttu-id="5c20d-177">Isso isola o gateway do restante da carga de trabalho, mas resulta em maior sobrecarga de gerenciamento.</span><span class="sxs-lookup"><span data-stu-id="5c20d-177">This isolates the gateway from the rest of the workload, but incurs higher management overhead.</span></span>

<span data-ttu-id="5c20d-178">**Gerenciamento**.</span><span class="sxs-lookup"><span data-stu-id="5c20d-178">**Management**.</span></span> <span data-ttu-id="5c20d-179">Talvez seja necessário atualizar as regras de roteamento de gateway quando novos serviços são atualizados ou adicionados.</span><span class="sxs-lookup"><span data-stu-id="5c20d-179">When services are updated or new services are added, the gateway routing rules may need to be updated.</span></span> <span data-ttu-id="5c20d-180">Considere como esse processo será gerenciado.</span><span class="sxs-lookup"><span data-stu-id="5c20d-180">Consider how this process will be managed.</span></span> <span data-ttu-id="5c20d-181">Considerações semelhantes aplicam-se ao gerenciamento de certificados SSL, listas de permissões IP e outros aspectos da configuração.</span><span class="sxs-lookup"><span data-stu-id="5c20d-181">Similar considerations apply to managing SSL certificates, IP whitelists, and other aspects of configuration.</span></span>

## <a name="deployment-considerations"></a><span data-ttu-id="5c20d-182">Considerações de implantação</span><span class="sxs-lookup"><span data-stu-id="5c20d-182">Deployment considerations</span></span>

### <a name="deploying-nginx-or-haproxy-to-kubernetes"></a><span data-ttu-id="5c20d-183">Implantando o Nginx ou HAProxy no Kubernetes</span><span class="sxs-lookup"><span data-stu-id="5c20d-183">Deploying Nginx or HAProxy to Kubernetes</span></span>

<span data-ttu-id="5c20d-184">Você pode implantar Nginx ou HAProxy no Kubernetes como um [ReplicaSet](https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/) ou [DaemonSet](https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/) que especifica a imagem de contêiner Nginx ou HAProxy.</span><span class="sxs-lookup"><span data-stu-id="5c20d-184">You can deploy Nginx or HAProxy to Kubernetes as a [ReplicaSet](https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/) or [DaemonSet](https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/) that specifies the Nginx or HAProxy container image.</span></span> <span data-ttu-id="5c20d-185">Use um ConfigMap para armazenar o arquivo de configuração no proxy e monte o ConfigMap como um volume.</span><span class="sxs-lookup"><span data-stu-id="5c20d-185">Use a ConfigMap to store the configuration file for the proxy, and mount the ConfigMap as a volume.</span></span> <span data-ttu-id="5c20d-186">Crie um serviço do tipo LoadBalancer para expor o gateway por meio do Azure Load Balancer.</span><span class="sxs-lookup"><span data-stu-id="5c20d-186">Create a service of type LoadBalancer to expose the gateway through an Azure Load Balancer.</span></span> 

<!-- - Configure a readiness probe that serves a static file from the gateway (rather than routing to another service). -->

<span data-ttu-id="5c20d-187">Uma alternativa é criar um controlador de entrada.</span><span class="sxs-lookup"><span data-stu-id="5c20d-187">An alternative is to create an Ingress Controller.</span></span> <span data-ttu-id="5c20d-188">Um controlador de entrada é um recurso Kubernetes que implanta um servidor proxy reverso ou um balanceador de carga.</span><span class="sxs-lookup"><span data-stu-id="5c20d-188">An Ingress Controller is a Kubernetes resource that deploys a load balancer or reverse proxy server.</span></span> <span data-ttu-id="5c20d-189">Existem várias implementações, incluindo Nginx e HAProxy.</span><span class="sxs-lookup"><span data-stu-id="5c20d-189">Several implementations exist, including Nginx and HAProxy.</span></span> <span data-ttu-id="5c20d-190">Um recurso separado chamado uma entrada define as configurações para o controlador de entrada, como regras de roteamento e certificados TLS.</span><span class="sxs-lookup"><span data-stu-id="5c20d-190">A separate resource called an Ingress defines settings for the Ingress Controller, such as routing rules and TLS certificates.</span></span> <span data-ttu-id="5c20d-191">Dessa forma, você não precisa gerenciar arquivos de configuração complexos, específicos de uma tecnologia de servidor proxy.</span><span class="sxs-lookup"><span data-stu-id="5c20d-191">That way, you don't need to manage complex configuration files that are specific to a particular proxy server technology.</span></span> <span data-ttu-id="5c20d-192">Controladores de entrada ainda são um recurso beta do Kubernetes no momento deste artigo, e o recurso continuará a evoluir.</span><span class="sxs-lookup"><span data-stu-id="5c20d-192">Ingress Controllers are still a beta feature of Kubernetes at the time of this writing, and the feature will continue to evolve.</span></span>

<span data-ttu-id="5c20d-193">O gateway é um gargalo potencial ou um ponto único de falha no sistema, portanto, sempre implante pelo menos duas réplicas para alta disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="5c20d-193">The gateway is a potential bottleneck or single point of failure in the system, so always deploy at least two replicas for high availability.</span></span> <span data-ttu-id="5c20d-194">Talvez seja necessário expandir as réplicas ainda mais, dependendo da carga.</span><span class="sxs-lookup"><span data-stu-id="5c20d-194">You may need to scale out the replicas further, depending on the load.</span></span> 

<span data-ttu-id="5c20d-195">Além disso, considere a execução do gateway em um conjunto dedicado de nós no cluster.</span><span class="sxs-lookup"><span data-stu-id="5c20d-195">Also consider running the gateway on a dedicated set of nodes in the cluster.</span></span> <span data-ttu-id="5c20d-196">Benefícios dessa abordagem:</span><span class="sxs-lookup"><span data-stu-id="5c20d-196">Benefits to this approach include:</span></span>

- <span data-ttu-id="5c20d-197">Isolamento.</span><span class="sxs-lookup"><span data-stu-id="5c20d-197">Isolation.</span></span> <span data-ttu-id="5c20d-198">Todo o tráfego vai para um conjunto fixo de nós, que pode ser isolado de serviços back-end.</span><span class="sxs-lookup"><span data-stu-id="5c20d-198">All inbound traffic goes to a fixed set of nodes, which can be isolated from backend services.</span></span>

- <span data-ttu-id="5c20d-199">Configuração estável.</span><span class="sxs-lookup"><span data-stu-id="5c20d-199">Stable configuration.</span></span> <span data-ttu-id="5c20d-200">Se o gateway estiver mal configurado, todo o aplicativo poderá se tornar indisponível.</span><span class="sxs-lookup"><span data-stu-id="5c20d-200">If the gateway is misconfigured, the entire application may become unavailable.</span></span> 

- <span data-ttu-id="5c20d-201">Desempenho.</span><span class="sxs-lookup"><span data-stu-id="5c20d-201">Performance.</span></span> <span data-ttu-id="5c20d-202">Use uma configuração de VM específica ao gateway por motivos de desempenho.</span><span class="sxs-lookup"><span data-stu-id="5c20d-202">You may want to use a specific VM configuration for the gateway for performance reasons.</span></span>

<!-- - Load balancing. You can configure the external load balancer so that requests always go to a gateway node. That can save a network hop, which would otherwise happen whenever a request lands on a node that isn't running a gateway pod. This consideration applies mainly to large clusters, where the gateway runs on a relatively small fraction of the total nodes. In Azure Container Service (ACS), this approach currently requires [ACS Engine](https://github.com/Azure/acs-engine)) which allows you to create multiple agent pools. Then you can deploy the gateway as a DaemonSet to the front-end pool. -->

### <a name="azure-application-gateway"></a><span data-ttu-id="5c20d-203">Gateway de Aplicativo do Azure</span><span class="sxs-lookup"><span data-stu-id="5c20d-203">Azure Application Gateway</span></span>

<span data-ttu-id="5c20d-204">Para conectar o Gateway de Aplicativo a um cluster Kubernetes no Azure:</span><span class="sxs-lookup"><span data-stu-id="5c20d-204">To connect Application Gateway to a Kubernetes cluster in Azure:</span></span>

1. <span data-ttu-id="5c20d-205">Crie uma sub-rede vazia na rede virtual do cluster.</span><span class="sxs-lookup"><span data-stu-id="5c20d-205">Create an empty subnet in the cluster VNet.</span></span>
2. <span data-ttu-id="5c20d-206">Implante o Gateway de Aplicativo.</span><span class="sxs-lookup"><span data-stu-id="5c20d-206">Deploy Application Gateway.</span></span>
3. <span data-ttu-id="5c20d-207">Crie um serviço Kubernetes com tipo =[NodePort](https://kubernetes.io/docs/concepts/services-networking/service/#type-nodeport).</span><span class="sxs-lookup"><span data-stu-id="5c20d-207">Create a Kubernetes service with type=[NodePort](https://kubernetes.io/docs/concepts/services-networking/service/#type-nodeport).</span></span> <span data-ttu-id="5c20d-208">Isso expõe o serviço em cada nó para que possa ser acessado de fora do cluster.</span><span class="sxs-lookup"><span data-stu-id="5c20d-208">This exposes the service on each node so that it can be reached from outside the cluster.</span></span> <span data-ttu-id="5c20d-209">Ele não cria um balanceador de carga.</span><span class="sxs-lookup"><span data-stu-id="5c20d-209">It does not create a load balancer.</span></span>
5. <span data-ttu-id="5c20d-210">Obtém o número da porta atribuída ao serviço.</span><span class="sxs-lookup"><span data-stu-id="5c20d-210">Get the assigned port number for the service.</span></span>
6. <span data-ttu-id="5c20d-211">Adicione uma regra de Gateway de Aplicativo, em que:</span><span class="sxs-lookup"><span data-stu-id="5c20d-211">Add an Application Gateway rule where:</span></span>
    - <span data-ttu-id="5c20d-212">O pool de back-end contenha as VMs do agente.</span><span class="sxs-lookup"><span data-stu-id="5c20d-212">The backend pool contains the agent VMs.</span></span>
    - <span data-ttu-id="5c20d-213">A configuração HTTP especifica o número da porta de serviço.</span><span class="sxs-lookup"><span data-stu-id="5c20d-213">The HTTP setting specifies the service port number.</span></span>
    - <span data-ttu-id="5c20d-214">O ouvinte de gateway escuta nas portas 80/443</span><span class="sxs-lookup"><span data-stu-id="5c20d-214">The gateway listener listens on ports 80/443</span></span>
    
<span data-ttu-id="5c20d-215">Defina a contagem de instância como 2 ou mais para alta disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="5c20d-215">Set the instance count to 2 or more for high availability.</span></span>

### <a name="azure-api-management"></a><span data-ttu-id="5c20d-216">Gerenciamento de API do Azure</span><span class="sxs-lookup"><span data-stu-id="5c20d-216">Azure API Management</span></span> 

<span data-ttu-id="5c20d-217">Para conectar Gerenciamento de API a um cluster Kubernetes no Azure:</span><span class="sxs-lookup"><span data-stu-id="5c20d-217">To connect API Management to a Kubernetes cluster in Azure:</span></span>

1. <span data-ttu-id="5c20d-218">Crie uma sub-rede vazia na rede virtual do cluster.</span><span class="sxs-lookup"><span data-stu-id="5c20d-218">Create an empty subnet in the cluster VNet.</span></span>
2. <span data-ttu-id="5c20d-219">Implante o Gerenciamento de API nessa sub-rede.</span><span class="sxs-lookup"><span data-stu-id="5c20d-219">Deploy API Management to that subnet.</span></span>
3. <span data-ttu-id="5c20d-220">Crie um serviço Kubernetes do tipo LoadBalancer.</span><span class="sxs-lookup"><span data-stu-id="5c20d-220">Create a Kubernetes service of type LoadBalancer.</span></span> <span data-ttu-id="5c20d-221">Use a anotação do [balanceador de carga interno](https://kubernetes.io/docs/concepts/services-networking/service/#internal-load-balancer) para criar um balanceador de carga interno, em vez de um balanceador de carga para a Internet, que é o padrão.</span><span class="sxs-lookup"><span data-stu-id="5c20d-221">Use the [internal load balancer](https://kubernetes.io/docs/concepts/services-networking/service/#internal-load-balancer) annotation to create an internal load balancer, instead of an Internet-facing load balancer, which is the default.</span></span>
4. <span data-ttu-id="5c20d-222">Localize IP privado de balanceador de carga interno, usando kubectl ou a CLI do Azure.</span><span class="sxs-lookup"><span data-stu-id="5c20d-222">Find the private IP of the internal load balancer, using kubectl or the Azure CLI.</span></span>
5. <span data-ttu-id="5c20d-223">Use o Gerenciamento de API para criar uma API que encaminha para o endereço IP particular do balanceador de carga.</span><span class="sxs-lookup"><span data-stu-id="5c20d-223">Use API Management to create an API that directs to the private IP address of the load balancer.</span></span>

<span data-ttu-id="5c20d-224">Considere a combinação de Gerenciamento de API com um proxy reverso, seja Nginx, HAProxy ou Gateway de Aplicativo do Azure.</span><span class="sxs-lookup"><span data-stu-id="5c20d-224">Consider combining API Management with a reverse proxy, whether Nginx, HAProxy, or Azure Application Gateway.</span></span> <span data-ttu-id="5c20d-225">Para obter informações sobre como usar o Gerenciamento de API com o Gateway de Aplicativo, consulte [Integrar o Gerenciamento de API em uma VNET interna com o Gateway de Aplicativo](/azure/api-management/api-management-howto-integrate-internal-vnet-appgateway).</span><span class="sxs-lookup"><span data-stu-id="5c20d-225">For information about using API Management with Application Gateway, see [Integrate API Management in an internal VNET with Application Gateway](/azure/api-management/api-management-howto-integrate-internal-vnet-appgateway).</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="5c20d-226">Monitoramento e registro em log</span><span class="sxs-lookup"><span data-stu-id="5c20d-226">Logging and monitoring</span></span>](./logging-monitoring.md)
