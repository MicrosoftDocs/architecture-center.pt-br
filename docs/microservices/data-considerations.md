---
title: Considerações de dados para microsserviços
description: Considerações de dados para microsserviços.
author: MikeWasson
ms.date: 10/23/2018
ms.topic: guide
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: microservices
ms.openlocfilehash: c2090ec2cbb37db87e87c0e91e6e6ee8314c14a4
ms.sourcegitcommit: 1b50810208354577b00e89e5c031b774b02736e2
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/23/2019
ms.locfileid: "54488368"
---
# <a name="designing-microservices-data-considerations"></a><span data-ttu-id="e5c3a-103">Como criar microsserviços: Considerações de dados</span><span class="sxs-lookup"><span data-stu-id="e5c3a-103">Designing microservices: Data considerations</span></span>

<span data-ttu-id="e5c3a-104">Este capítulo descreve as considerações para gerenciar dados em uma arquitetura de microsserviços.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-104">This chapter describes considerations for managing data in a microservices architecture.</span></span> <span data-ttu-id="e5c3a-105">Os principais desafios são como cada microsserviço gerencia os próprios dados, a integridade e a consistência de dados.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-105">Because every microservice manages its own data, data integrity and data consistency are critical challenges.</span></span>

![Diagrama das considerações de dados](./images/data-considerations.png)

<span data-ttu-id="e5c3a-107">Um princípio básico dos microsserviços é que cada serviço gerencia seus próprios dados.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-107">A basic principle of microservices is that each service manages its own data.</span></span> <span data-ttu-id="e5c3a-108">Dois serviços não devem compartilhar um armazenamento de dados.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-108">Two services should not share a data store.</span></span> <span data-ttu-id="e5c3a-109">Em vez disso, cada serviço é responsável pelo próprio armazenamento de dados particular, que não pode ser acessado diretamente por outros serviços.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-109">Instead, each service is responsible for its own private data store, which other services cannot access directly.</span></span>

<span data-ttu-id="e5c3a-110">O motivo para essa regra é evitar acoplamento não intencional entre serviços, que poderá ocorrer se os serviços compartilharem os mesmos esquemas de dados subjacentes.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-110">The reason for this rule is to avoid unintentional coupling between services, which can result if services share the same underlying data schemas.</span></span> <span data-ttu-id="e5c3a-111">Se houver alteração de esquema de dados, a alteração deverá ser coordenada em cada serviço que dependa desse banco de dados.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-111">If there is a change to the data schema, the change must be coordinated across every service that relies on that database.</span></span> <span data-ttu-id="e5c3a-112">Ao isolar o armazenamento de dados de cada serviço, podemos limitar o escopo da alteração e preservar a agilidade de implantações verdadeiramente independentes.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-112">By isolating each service's data store, we can limit the scope of change, and preserve the agility of truly independent deployments.</span></span> <span data-ttu-id="e5c3a-113">Outro motivo é que cada microsserviço pode ter seus próprios modelos de dados, consultas ou padrões de leitura/gravação.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-113">Another reason is that each microservice may have its own data models, queries, or read/write patterns.</span></span> <span data-ttu-id="e5c3a-114">O uso de um armazenamento de dados compartilhado limita a capacidade de cada equipe de otimizar o armazenamento para seu serviço específico.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-114">Using a shared data store limits each team's ability to optimize data storage for their particular service.</span></span>

![Diagrama de uma abordagem errada para CQRS](../guide/architecture-styles/images/cqrs-microservices-wrong.png)

<span data-ttu-id="e5c3a-116">Essa abordagem leva naturalmente a uma [persistência poliglota](https://martinfowler.com/bliki/PolyglotPersistence.html) &mdash; o uso de várias tecnologias de armazenamento de dados em um único aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-116">This approach naturally leads to [polyglot persistence](https://martinfowler.com/bliki/PolyglotPersistence.html) &mdash; the use of multiple data storage technologies within a single application.</span></span> <span data-ttu-id="e5c3a-117">Um serviço pode exigir os recursos de esquema na leitura de um banco de dados do documento.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-117">One service might require the schema-on-read capabilities of a document database.</span></span> <span data-ttu-id="e5c3a-118">Outro pode precisar da integridade referencial fornecida por um RDBMS.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-118">Another might need the referential integrity provided by an RDBMS.</span></span> <span data-ttu-id="e5c3a-119">Cada equipe pode fazer a melhor escolha para seu serviço.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-119">Each team is free to make the best choice for their service.</span></span> <span data-ttu-id="e5c3a-120">Para obter mais informações sobre os princípios gerais da persistência poliglota, consulte [Usar o melhor armazenamento de dados para o trabalho](../guide/design-principles/use-the-best-data-store.md).</span><span class="sxs-lookup"><span data-stu-id="e5c3a-120">For more about the general principle of polyglot persistence, see [Use the best data store for the job](../guide/design-principles/use-the-best-data-store.md).</span></span>

> [!NOTE]
> <span data-ttu-id="e5c3a-121">Não há problema em os serviços compartilharem o mesmo servidor de banco de dados físico.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-121">It's fine for services to share the same physical database server.</span></span> <span data-ttu-id="e5c3a-122">O problema ocorre quando os serviços compartilham o mesmo esquema ou a leitura e a gravação para o mesmo conjunto de tabelas de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-122">The problem occurs when services share the same schema, or read and write to the same set of database tables.</span></span>

## <a name="challenges"></a><span data-ttu-id="e5c3a-123">Desafios</span><span class="sxs-lookup"><span data-stu-id="e5c3a-123">Challenges</span></span>

<span data-ttu-id="e5c3a-124">Alguns desafios são provenientes dessa abordagem distribuída ao gerenciamento de dados.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-124">Some challenges arise from this distributed approach to managing data.</span></span> <span data-ttu-id="e5c3a-125">Primeiro, pode haver redundância entre os armazenamentos de dados, com o mesmo item de dados aparecendo em vários lugares.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-125">First, there may be redundancy across the data stores, with the same item of data appearing in multiple places.</span></span> <span data-ttu-id="e5c3a-126">Por exemplo, dados podem ser armazenados como parte de uma transação, armazenados em outro local para análise, geração de relatórios ou arquivamento.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-126">For example, data might be stored as part of a transaction, then stored elsewhere for analytics, reporting, or archiving.</span></span> <span data-ttu-id="e5c3a-127">Dados duplicados ou particionados podem levar a problemas de integridade e consistência.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-127">Duplicated or partitioned data can lead to issues of data integrity and consistency.</span></span> <span data-ttu-id="e5c3a-128">Quando as relações de dados abrangem vários serviços, não é possível usar técnicas de gerenciamento de dados tradicionais para impor as relações.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-128">When data relationships span multiple services, you can't use traditional data management techniques to enforce the relationships.</span></span>

<span data-ttu-id="e5c3a-129">A modelagem de dados tradicional usa a regra "um fato em um único local".</span><span class="sxs-lookup"><span data-stu-id="e5c3a-129">Traditional data modeling uses the rule of "one fact in one place."</span></span> <span data-ttu-id="e5c3a-130">Cada entidade aparece exatamente uma vez no esquema.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-130">Every entity appears exactly once in the schema.</span></span> <span data-ttu-id="e5c3a-131">Outras entidades podem manter referências a ele, mas não duplicá-lo.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-131">Other entities may hold references to it but not duplicate it.</span></span> <span data-ttu-id="e5c3a-132">A vantagem óbvia à abordagem tradicional é que as atualizações são feitas em um único local, o que evita problemas com consistência de dados.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-132">The obvious advantage to the traditional approach is that updates are made in a single place, which avoids problems with data consistency.</span></span> <span data-ttu-id="e5c3a-133">Em uma arquitetura de microsserviços, considere como as atualizações são propagadas entre os serviços e como gerenciar eventual consistência quando os dados aparecem em vários locais sem uma consistência forte.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-133">In a microservices architecture, you have to consider how updates are propagated across services, and how to manage eventual consistency when data appears in multiple places without strong consistency.</span></span>

## <a name="approaches-to-managing-data"></a><span data-ttu-id="e5c3a-134">Abordagens ao gerenciamento de dados</span><span class="sxs-lookup"><span data-stu-id="e5c3a-134">Approaches to managing data</span></span>

<span data-ttu-id="e5c3a-135">Não há uma abordagem adequada para todos os casos, mas, a seguir, temos algumas diretrizes gerais que podem ajudá-lo no gerenciamento de dados em uma arquitetura de microsserviços.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-135">There is no single approach that's correct in all cases, but here are some general guidelines for managing data in a microservices architecture.</span></span>

- <span data-ttu-id="e5c3a-136">Adote consistência eventual quando possível.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-136">Embrace eventual consistency where possible.</span></span> <span data-ttu-id="e5c3a-137">Entenda os lugares no sistema onde uma consistência forte ou as transações ACID são necessárias e os locais onde a consistência eventual é aceitável.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-137">Understand the places in the system where you need strong consistency or ACID transactions, and the places where eventual consistency is acceptable.</span></span>

- <span data-ttu-id="e5c3a-138">Quando você precisa de garantias de consistência forte, um serviço pode representar a fonte de verdade para determinada entidade, exposta por meio de uma API.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-138">When you need strong consistency guarantees, one service may represent the source of truth for a given entity, which is exposed through an API.</span></span> <span data-ttu-id="e5c3a-139">Outros serviços podem conter sua própria cópia ou um subconjunto de dados, que eventualmente são consistente com os dados mestres, mas não são considerados como fonte da verdade.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-139">Other services might hold their own copy of the data, or a subset of the data, that is eventually consistent with the master data but not considered the source of truth.</span></span> <span data-ttu-id="e5c3a-140">Por exemplo, imagine um sistema de comércio eletrônico com um serviço de pedido de cliente e um serviço de recomendação.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-140">For example, imagine an e-commerce system with a customer order service and a recommendation service.</span></span> <span data-ttu-id="e5c3a-141">O serviço de recomendação pode escutar eventos do serviço de pedidos, mas se um cliente solicitar reembolso, será o serviço de pedidos, e não o serviço de recomendação, que terá todo o histórico da transação.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-141">The recommendation service might listen to events from the order service, but if a customer requests a refund, it is the order service, not the recommendation service, that has the complete transaction history.</span></span>

- <span data-ttu-id="e5c3a-142">Para transações, use padrões como [Supervisor de Agente do Agendador](../patterns/scheduler-agent-supervisor.md) e [transações de compensação](../patterns/compensating-transaction.md) para manter os dados consistentes em vários serviços.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-142">For transactions, use patterns such as [Scheduler Agent Supervisor](../patterns/scheduler-agent-supervisor.md) and [Compensating Transaction](../patterns/compensating-transaction.md) to keep data consistent across several services.</span></span>  <span data-ttu-id="e5c3a-143">Talvez seja necessário armazenar dados adicionais que capturem o estado de uma unidade de trabalho que abrange vários serviços, para evitar uma falha parcial entre os serviços.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-143">You may need to store an additional piece of data that captures the state of a unit of work that spans multiple services, to avoid partial failure among multiple services.</span></span> <span data-ttu-id="e5c3a-144">Por exemplo, manter um item de trabalho em uma fila durável, enquanto uma transação de várias etapas está em andamento.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-144">For example, keep a work item on a durable queue while a multi-step transaction is in progress.</span></span>

- <span data-ttu-id="e5c3a-145">Armazene apenas os dados que um serviço precisa.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-145">Store only the data that a service needs.</span></span> <span data-ttu-id="e5c3a-146">Um serviço pode precisar apenas de um subconjunto de informações sobre uma entidade de domínio.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-146">A service might only need a subset of information about a domain entity.</span></span> <span data-ttu-id="e5c3a-147">Por exemplo, no contexto de envio limitado, precisamos saber qual cliente está associado a uma entrega específica.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-147">For example, in the Shipping bounded context, we need to know which customer is associated to a particular delivery.</span></span> <span data-ttu-id="e5c3a-148">Mas não precisamos do endereço de cobrança do cliente &mdash; que é gerenciado pelo contexto limitado de Contas.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-148">But we don't need the customer's billing address &mdash; that's managed by the Accounts bounded context.</span></span> <span data-ttu-id="e5c3a-149">Pensar cuidadosamente o domínio e usar uma abordagem DDD, pode ajudar.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-149">Thinking carefully about the domain, and using a DDD approach, can help here.</span></span>

- <span data-ttu-id="e5c3a-150">Considere se os serviços são coerentes e acoplados de forma flexível.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-150">Consider whether your services are coherent and loosely coupled.</span></span> <span data-ttu-id="e5c3a-151">Se dois serviços trocam informações continuamente entre si, resultando em APIs de conversa, será necessário redigir os limites do serviço, mesclando dois serviços ou refatorando suas funcionalidades.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-151">If two services are continually exchanging information with each other, resulting in chatty APIs, you may need to redraw your service boundaries, by merging two services or refactoring their functionality.</span></span>

- <span data-ttu-id="e5c3a-152">Use um [estilo de arquitetura baseado em eventos](../guide/architecture-styles/event-driven.md).</span><span class="sxs-lookup"><span data-stu-id="e5c3a-152">Use an [event driven architecture style](../guide/architecture-styles/event-driven.md).</span></span> <span data-ttu-id="e5c3a-153">Nesse estilo de arquitetura, um serviço publica um evento quando há alterações em suas entidades ou modelos públicos.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-153">In this architecture style, a service publishes an event when there are changes to its public models or entities.</span></span> <span data-ttu-id="e5c3a-154">Serviços interessados podem assinar esses eventos.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-154">Interested services can subscribe to these events.</span></span> <span data-ttu-id="e5c3a-155">Por exemplo, outro serviço pode usar os eventos para construir uma visão materializada dos dados que seja mais adequada a consultas.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-155">For example, another service could use the events to construct a materialized view of the data that is more suitable for querying.</span></span>

- <span data-ttu-id="e5c3a-156">Um serviço que tem eventos deve publicar um esquema que pode ser usado para automatizar a serialização e desserialização de eventos, para evitar acoplamento entre publicadores e assinantes.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-156">A service that owns events should publish a schema that can be used to automate serializing and deserializing the events, to avoid tight coupling between publishers and subscribers.</span></span> <span data-ttu-id="e5c3a-157">Considere o esquema JSON ou uma estrutura como [Microsoft Bond](https://github.com/Microsoft/bond), Protobuf ou Avro.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-157">Consider JSON schema or a framework like [Microsoft Bond](https://github.com/Microsoft/bond), Protobuf, or Avro.</span></span>

- <span data-ttu-id="e5c3a-158">Em grande escala, os eventos podem se tornar um gargalo no sistema, portanto, considere usar agregação ou processamento em lote para reduzir a carga total.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-158">At high scale, events can become a bottleneck on the system, so consider using aggregation or batching to reduce the total load.</span></span>

## <a name="drone-delivery-choosing-the-data-stores"></a><span data-ttu-id="e5c3a-159">Entrega por Drones: Escolhendo os repositórios de dados</span><span class="sxs-lookup"><span data-stu-id="e5c3a-159">Drone Delivery: Choosing the data stores</span></span>

<span data-ttu-id="e5c3a-160">Mesmo com apenas alguns serviços, o contexto de envio limitado ilustra vários dos pontos abordados nesta seção.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-160">Even with only a few services, the Shipping bounded context illustrates several of the points discussed in this section.</span></span>

<span data-ttu-id="e5c3a-161">Quando um usuário agenda uma nova entrega, a solicitação do cliente inclui informações sobre a entrega, como locais de retirada e entrega, e sobre o pacote, como tamanho e peso.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-161">When a user schedules a new delivery, the client request includes information about the both the delivery, such as the pickup and dropoff locations, and about the package, such as the size and weight.</span></span> <span data-ttu-id="e5c3a-162">Essas informações definem uma unidade de trabalho, que o serviço de ingestão envia para os Hubs de Eventos.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-162">This information defines a unit of work, which the Ingestion service sends to Event Hubs.</span></span> <span data-ttu-id="e5c3a-163">É importante que a unidade de trabalho permaneça no armazenamento persistente enquanto o serviço do Agendador executa o fluxo de trabalho, para que nenhuma solicitação de entrega seja perdida.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-163">It's important that the unit of work stays in persistent storage while the Scheduler service is executing the workflow, so that no delivery requests are lost.</span></span> <span data-ttu-id="e5c3a-164">Para mais discussões sobre o fluxo de trabalho, consulte [Ingestão e fluxo de trabalho](./ingestion-workflow.md).</span><span class="sxs-lookup"><span data-stu-id="e5c3a-164">For more discussion of the workflow, see [Ingestion and workflow](./ingestion-workflow.md).</span></span>

<span data-ttu-id="e5c3a-165">Os vários serviços de back-end cuidam de diferentes partes da informação na solicitação e também têm diferentes perfis de leitura e gravação.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-165">The various backend services care about different portions of the information in the request, and also have different read and write profiles.</span></span>

### <a name="delivery-service"></a><span data-ttu-id="e5c3a-166">Serviço de Entrega</span><span class="sxs-lookup"><span data-stu-id="e5c3a-166">Delivery service</span></span>

<span data-ttu-id="e5c3a-167">O serviço de Entrega armazena informações sobre cada entrega agendada no momento ou em andamento.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-167">The Delivery service stores information about every delivery that is currently scheduled or in progress.</span></span> <span data-ttu-id="e5c3a-168">Ele escuta eventos de drone e acompanha o status das entregas em andamento.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-168">It listens for events from the drones, and tracks the status of deliveries that are in progress.</span></span> <span data-ttu-id="e5c3a-169">Ele também envia eventos de domínio com atualizações de status da entrega.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-169">It also sends domain events with delivery status updates.</span></span>

<span data-ttu-id="e5c3a-170">Espera-se que os usuários verifiquem com frequência o status de uma entrega enquanto aguardam o pacote.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-170">It's expected that users will frequently check the status of a delivery while they are waiting for their package.</span></span> <span data-ttu-id="e5c3a-171">Portanto, o serviço de Entrega exige um armazenamento de dados que enfatize a taxa de transferência (leitura e gravação) em um armazenamento de longo prazo.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-171">Therefore, the Delivery service requires a data store that emphasizes throughput (read and write) over long-term storage.</span></span> <span data-ttu-id="e5c3a-172">Além disso, o serviço de Entrega não realiza consultas nem análises complexas, simplesmente busca o status mais recente de determinada entrega.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-172">Also, the Delivery service does not perform any complex queries or analysis, it simply fetches the latest status for a given delivery.</span></span> <span data-ttu-id="e5c3a-173">A equipe do serviço de Entrega escolheu o Cache Redis do Azure por seu alto desempenho de leitura e gravação.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-173">The Delivery service team chose Azure Redis Cache for its high read-write performance.</span></span> <span data-ttu-id="e5c3a-174">As informações armazenadas no Redis têm duração relativamente curta.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-174">The information stored in Redis is relatively short-lived.</span></span> <span data-ttu-id="e5c3a-175">Quando uma entrega é concluída, o serviço de histórico da entrega é o sistema de registro.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-175">Once a delivery is complete, the Delivery History service is the system of record.</span></span>

### <a name="delivery-history-service"></a><span data-ttu-id="e5c3a-176">Serviço de histórico da entrega</span><span class="sxs-lookup"><span data-stu-id="e5c3a-176">Delivery History service</span></span>

<span data-ttu-id="e5c3a-177">O serviço de histórico da entrega escuta os eventos de status do serviço de entrega.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-177">The Delivery History service listens for delivery status events from the Delivery service.</span></span> <span data-ttu-id="e5c3a-178">Ele armazena esses dados em armazenamento de longo prazo.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-178">It stores this data in long-term storage.</span></span> <span data-ttu-id="e5c3a-179">Há dois diferentes casos de uso de dados históricos, com diferentes requisitos de armazenamento de dados.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-179">There are two different use-cases for this historical data, which have different data storage requirements.</span></span>

<span data-ttu-id="e5c3a-180">O primeiro cenário é a agregação de dados com o objetivo de análise, a fim de otimizar os negócios ou melhorar a qualidade do serviço.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-180">The first scenario is aggregating the data for the purpose of data analytics, in order to optimize the business or improve the quality of the service.</span></span> <span data-ttu-id="e5c3a-181">Observe que o serviço de histórico de entrega não executa análise real dos dados.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-181">Note that the Delivery History service doesn't perform the actual analysis of the data.</span></span> <span data-ttu-id="e5c3a-182">Só é responsável pela inclusão e pelo armazenamento.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-182">It's only responsible for the ingestion and storage.</span></span> <span data-ttu-id="e5c3a-183">Para este cenário, o armazenamento deve ser otimizado para análise de dados em um grande conjunto de dados, usando uma abordagem de esquema na leitura para acomodar uma variedade de fontes de dados.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-183">For this scenario, the storage must be optimized for data analysis over a large set of data, using a schema-on-read approach to accommodate a variety of data sources.</span></span> <span data-ttu-id="e5c3a-184">[Azure Data Lake Store](/azure/data-lake-store/) é uma boa opção para esse cenário.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-184">[Azure Data Lake Store](/azure/data-lake-store/) is a good fit for this scenario.</span></span> <span data-ttu-id="e5c3a-185">O Data Lake Store é um sistema de arquivos Apache Hadoop compatível com HDFS (Sistema de Arquivos Distribuído Hadoop), ajustado para desempenho em cenários de análise de dados.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-185">Data Lake Store is an Apache Hadoop file system compatible with Hadoop Distributed File System (HDFS), and is tuned for performance for data analytics scenarios.</span></span>

<span data-ttu-id="e5c3a-186">O outro cenário é permitir que os usuários pesquisem o histórico de uma entrega após a entrega.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-186">The other scenario is enabling users to look up the history of a delivery after the delivery is completed.</span></span> <span data-ttu-id="e5c3a-187">Particularmente, o Azure Data Lake não é otimizado para esse cenário.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-187">Azure Data Lake is not particularly optimized for this scenario.</span></span> <span data-ttu-id="e5c3a-188">Para otimizar o desempenho, a Microsoft recomenda armazenar dados de série temporal em Data Lake em pastas particionadas por data.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-188">For optimal performance, Microsoft recommends storing time-series data in Data Lake in folders partitioned by date.</span></span> <span data-ttu-id="e5c3a-189">(Consulte [Ajustando o desempenho do Azure Data Lake Store](/azure/data-lake-store/data-lake-store-performance-tuning-guidance)).</span><span class="sxs-lookup"><span data-stu-id="e5c3a-189">(See [Tuning Azure Data Lake Store for performance](/azure/data-lake-store/data-lake-store-performance-tuning-guidance)).</span></span> <span data-ttu-id="e5c3a-190">No entanto, a estrutura não é ideal para procurar registros individuais por ID.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-190">However, that structure is not optimal for looking up individual records by ID.</span></span> <span data-ttu-id="e5c3a-191">A menos que você também conheça a data/hora, uma pesquisa por ID exige a verificação de toda a coleção.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-191">Unless you also know the timestamp, a lookup by ID requires scanning the entire collection.</span></span> <span data-ttu-id="e5c3a-192">Portanto, o serviço de histórico de entrega também armazena um subconjunto dos dados históricos no Cosmos DB para uma pesquisa mais rápida.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-192">Therefore, the Delivery History service also stores a subset of the historical data in Cosmos DB for quicker lookup.</span></span> <span data-ttu-id="e5c3a-193">Os registros não precisam permanecer no Cosmos DB indefinidamente.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-193">The records don't need to stay in Cosmos DB indefinitely.</span></span> <span data-ttu-id="e5c3a-194">Entregas mais antigas podem ser arquivadas &mdash; após um mês.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-194">Older deliveries can be archived &mdash; say, after a month.</span></span> <span data-ttu-id="e5c3a-195">Isso pode ser feito executando um processo em lote ocasional.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-195">This could be done by running an occasional batch process.</span></span>

### <a name="package-service"></a><span data-ttu-id="e5c3a-196">Serviço de pacote</span><span class="sxs-lookup"><span data-stu-id="e5c3a-196">Package service</span></span>

<span data-ttu-id="e5c3a-197">O serviço do pacote armazena informações sobre todos os pacotes.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-197">The Package service stores information about all of the packages.</span></span> <span data-ttu-id="e5c3a-198">Os requisitos de armazenamento para o pacote são:</span><span class="sxs-lookup"><span data-stu-id="e5c3a-198">The storage requirements for the Package are:</span></span>

- <span data-ttu-id="e5c3a-199">Armazenamento de longo prazo.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-199">Long-term storage.</span></span>
- <span data-ttu-id="e5c3a-200">Capaz de lidar com um alto volume de pacotes, que requerem alta taxa de transferência de gravação.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-200">Able to handle a high volume of packages, requiring high write throughput.</span></span>
- <span data-ttu-id="e5c3a-201">Suporte a consultas simples por ID do pacote.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-201">Support simple queries by package ID.</span></span> <span data-ttu-id="e5c3a-202">Nenhum requisito de integridade referencial ou junções complexas.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-202">No complex joins or requirements for referential integrity.</span></span>

<span data-ttu-id="e5c3a-203">Como os dados do pacote não são relacionais, um banco de dados orientado a documentos é apropriado e o Cosmos DB pode alcançar taxa de transferência bem alta, usando coleções fragmentadas.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-203">Because the package data is not relational, a document oriented database is appropriate, and Cosmos DB can achieve very high throughput by using sharded collections.</span></span> <span data-ttu-id="e5c3a-204">A equipe que trabalha no serviço de Pacote está familiarizada com a pilha MEAN (MongoDB, Express.js, AngularJS e Node.js), então, a [API MongoDB](/azure/cosmos-db/mongodb-introduction) é selecionada para o Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-204">The team that works on the Package service is familiar with the MEAN stack (MongoDB, Express.js, AngularJS, and Node.js), so they select the [MongoDB API](/azure/cosmos-db/mongodb-introduction) for Cosmos DB.</span></span> <span data-ttu-id="e5c3a-205">Isso permite que eles aproveitem sua experiência existente com o MongoDB, enquanto obtém os benefícios do Cosmos DB, que é um serviço gerenciado do Azure.</span><span class="sxs-lookup"><span data-stu-id="e5c3a-205">That lets them leverage their existing experience with MongoDB, while getting the benefits of Cosmos DB, which is a managed Azure service.</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="e5c3a-206">Comunicação entre serviços</span><span class="sxs-lookup"><span data-stu-id="e5c3a-206">Interservice communication</span></span>](./interservice-communication.md)