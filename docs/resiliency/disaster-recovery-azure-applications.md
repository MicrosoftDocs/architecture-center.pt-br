---
title: "Recuperação de desastre para aplicativos do Azure"
description: "Visão geral técnica e informações detalhadas sobre como projetar aplicativos para recuperação de desastre no Microsoft Azure."
author: adamglick
ms.date: 05/26/2017
ms.openlocfilehash: d415b27dd7928996e2a6dc7fd8fcf6a77c835768
ms.sourcegitcommit: b0482d49aab0526be386837702e7724c61232c60
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/14/2017
---
[!INCLUDE [header](../_includes/header.md)]
# <a name="disaster-recovery-for-azure-applications"></a><span data-ttu-id="f80ec-103">Recuperação de desastre para aplicativos do Azure</span><span class="sxs-lookup"><span data-stu-id="f80ec-103">Disaster recovery for Azure applications</span></span>
<span data-ttu-id="f80ec-104">Estratégias de resiliência e alta disponibilidade tem como objetivo lidar com condições de falha temporária.</span><span class="sxs-lookup"><span data-stu-id="f80ec-104">Resiliency and high availability strategies are intended to handling temporary failure conditions.</span></span> <span data-ttu-id="f80ec-105">A recuperação de desastres (DR) tem como foco a recuperação após uma perda catastrófica de funcionalidade do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f80ec-105">Disaster recovery (DR) is focused on recovering from a catastrophic loss of application functionality.</span></span> <span data-ttu-id="f80ec-106">Por exemplo, se uma região do Azure que hospeda o aplicativo ficar indisponível, você precisa de um plano para executar seu aplicativo ou acessar os dados em outra região.</span><span class="sxs-lookup"><span data-stu-id="f80ec-106">For example, if an Azure region hosting your application becomes unavailable, you need a plan for running your application or accessing your data in another region.</span></span> <span data-ttu-id="f80ec-107">A execução desse plano envolve pessoas, processos e aplicativos de suporte que permitem que o sistema continue funcionando.</span><span class="sxs-lookup"><span data-stu-id="f80ec-107">Executing this plan involves people, processes, and supporting applications that allow the system to continue functioning.</span></span> <span data-ttu-id="f80ec-108">Seu plano deve incluir ensaio de falhas e testes de recuperação de bancos de dados para garantir que o plano é sólido.</span><span class="sxs-lookup"><span data-stu-id="f80ec-108">Your plan should include rehearsing failures and testing the recovery of databases to ensure the plan is sound.</span></span> <span data-ttu-id="f80ec-109">Os responsáveis pelos negócios e pela tecnologia que definem o modo operacional do sistema para um desastre também determinam o nível de funcionalidade do serviço necessário durante um desastre.</span><span class="sxs-lookup"><span data-stu-id="f80ec-109">The business and technology owners who define the system's operational mode for a disaster also determine the level of service functionality required during a disaster.</span></span> <span data-ttu-id="f80ec-110">Esse nível de funcionalidade apresenta-se destas formas: totalmente indisponível, parcialmente disponível, por funcionalidade reduzida ou processamento com atraso, ou totalmente disponível.</span><span class="sxs-lookup"><span data-stu-id="f80ec-110">This level of functionality can take a few forms: completely unavailable, partially available via reduced functionality or delayed processing, or fully available.</span></span>

## <a name="azure-disaster-recovery-features"></a><span data-ttu-id="f80ec-111">Recursos de recuperação de desastre do Azure</span><span class="sxs-lookup"><span data-stu-id="f80ec-111">Azure disaster recovery features</span></span>
<span data-ttu-id="f80ec-112">Assim como nas considerações de disponibilidade, o Azure oferece [orientações técnicas de resiliência](./index.md) desenvolvidas para lidar com a recuperação de desastre.</span><span class="sxs-lookup"><span data-stu-id="f80ec-112">As with availability considerations, Azure provides [resiliency technical guidance](./index.md) designed to support disaster recovery.</span></span> <span data-ttu-id="f80ec-113">Também há uma relação entre recursos de disponibilidade do Azure e a recuperação de desastre.</span><span class="sxs-lookup"><span data-stu-id="f80ec-113">There is also a relationship between availability features of Azure and disaster recovery.</span></span> <span data-ttu-id="f80ec-114">Por exemplo, o gerenciamento de funções entre domínios de falha aumenta a disponibilidade de um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f80ec-114">For example, the management of roles across fault domains increases the availability of an application.</span></span> <span data-ttu-id="f80ec-115">Sem esse gerenciamento, uma falha de hardware sem tratamento se tornaria um cenário de "desastre".</span><span class="sxs-lookup"><span data-stu-id="f80ec-115">Without that management, an unhandled hardware failure would become a “disaster” scenario.</span></span> <span data-ttu-id="f80ec-116">O aproveitamento desses recursos e estratégias de disponibilidade é uma parte importante da blindagem de seu aplicativo contra desastres.</span><span class="sxs-lookup"><span data-stu-id="f80ec-116">Leveraging these availability features and strategies is an important part of disaster-proofing your application.</span></span> <span data-ttu-id="f80ec-117">No entanto, este artigo vai além de problemas gerais de disponibilidade e aborda eventos de desastre mais graves (e mais raros).</span><span class="sxs-lookup"><span data-stu-id="f80ec-117">However, this article goes beyond general availability issues to more serious (and rarer) disaster events.</span></span>

## <a name="multiple-datacenter-regions"></a><span data-ttu-id="f80ec-118">Múltiplas regiões de datacenter</span><span class="sxs-lookup"><span data-stu-id="f80ec-118">Multiple datacenter regions</span></span>
<span data-ttu-id="f80ec-119">O Azure mantém datacenters em muitas regiões ao redor do mundo.</span><span class="sxs-lookup"><span data-stu-id="f80ec-119">Azure maintains datacenters in many regions around the world.</span></span> <span data-ttu-id="f80ec-120">Essa infraestrutura é compatível com vários cenários de recuperação de desastre, como a replicação geográfica, fornecida pelo sistema, do Armazenamento do Microsoft Azure para regiões secundárias.</span><span class="sxs-lookup"><span data-stu-id="f80ec-120">This infrastructure supports several disaster recovery scenarios, such as system-provided geo-replication of Azure Storage to secondary regions.</span></span> <span data-ttu-id="f80ec-121">Você também pode implantar, de forma fácil e com baixo custo, um serviço de nuvem em vários locais do mundo.</span><span class="sxs-lookup"><span data-stu-id="f80ec-121">You can also easily and inexpensively deploy a cloud service to multiple locations around the world.</span></span> <span data-ttu-id="f80ec-122">Compare isso com o custo e a dificuldade de criar e manter seus próprios datacenters em várias regiões.</span><span class="sxs-lookup"><span data-stu-id="f80ec-122">Compare this with the cost and difficulty of building and maintaining your own datacenters in multiple regions.</span></span> <span data-ttu-id="f80ec-123">Implantar serviços e dados em várias regiões ajuda a proteger o aplicativo contra uma grande interrupção em uma única região.</span><span class="sxs-lookup"><span data-stu-id="f80ec-123">Deploying data and services to multiple regions helps protect your application from a major outage in a single region.</span></span> <span data-ttu-id="f80ec-124">Ao projetar seu plano de recuperação de desastres, é importante compreender o conceito de regiões emparelhadas.</span><span class="sxs-lookup"><span data-stu-id="f80ec-124">As you design your disaster recovery plan, it’s important to understand the concept of paired regions.</span></span> <span data-ttu-id="f80ec-125">Para saber mais, consulte [Continuidade dos negócios e recuperação de desastres (BCDR): Regiões Emparelhadas do Azure](/azure/best-practices-availability-paired-regions).</span><span class="sxs-lookup"><span data-stu-id="f80ec-125">For more information, see [Business continuity and disaster recovery (BCDR): Azure Paired Regions](/azure/best-practices-availability-paired-regions).</span></span>

## <a name="azure-traffic-manager"></a><span data-ttu-id="f80ec-126">Gerenciador de Tráfego do Azure</span><span class="sxs-lookup"><span data-stu-id="f80ec-126">Azure Traffic Manager</span></span>
<span data-ttu-id="f80ec-127">Quando ocorre uma falha específica de região, você deve redirecionar o tráfego para serviços ou implantações em outra região.</span><span class="sxs-lookup"><span data-stu-id="f80ec-127">When a region-specific failure occurs, you must redirect traffic to services or deployments in another region.</span></span> <span data-ttu-id="f80ec-128">É mais eficaz lidar com isso por meio de serviços como o Gerenciador de Tráfego do Microsoft Azure, que automatiza o failover de tráfego de usuários para outra região se a região principal falhar.</span><span class="sxs-lookup"><span data-stu-id="f80ec-128">It is most effective to handle this via services such as Azure Traffic Manager, which automates the failover of user traffic to another region if the primary region fails.</span></span> <span data-ttu-id="f80ec-129">É importante entender as noções básicas sobre o Gerenciador de Tráfego ao projetar uma estratégia de recuperação de desastres eficiente.</span><span class="sxs-lookup"><span data-stu-id="f80ec-129">Understanding the fundamentals of Traffic Manager is important when designing an effective DR strategy.</span></span>

<span data-ttu-id="f80ec-130">O Gerenciador de Tráfego usa o DNS (Sistema de Nomes de Domínio) para direcionar solicitações de cliente ao ponto de extremidade mais apropriado com base em um método de roteamento de tráfego e na integridade dos pontos de extremidade.</span><span class="sxs-lookup"><span data-stu-id="f80ec-130">Traffic Manager uses the Domain Name System (DNS) to direct client requests to the most appropriate endpoint based on a traffic-routing method and the health of the endpoints.</span></span> <span data-ttu-id="f80ec-131">No diagrama a seguir, os usuários se conectam a uma URL do Gerenciador de Tráfego (`http://myATMURL.trafficmanager.net`) que abstrai as URLs do site real (`http://app1URL.cloudapp.net` e `http://app2URL.cloudapp.net`).</span><span class="sxs-lookup"><span data-stu-id="f80ec-131">In the following diagram, users connect to a Traffic Manager URL (`http://myATMURL.trafficmanager.net`) which abstracts the actual site URLs (`http://app1URL.cloudapp.net` and `http://app2URL.cloudapp.net`).</span></span> <span data-ttu-id="f80ec-132">As solicitações do usuário são roteadas para a URL subjacente adequada com base no [método de roteamento do Gerenciador de Tráfego](/azure/traffic-manager/traffic-manager-routing-methods) configurado.</span><span class="sxs-lookup"><span data-stu-id="f80ec-132">User requests are routed to the proper underlying URL based on your configured [Traffic Manager routing method](/azure/traffic-manager/traffic-manager-routing-methods).</span></span> <span data-ttu-id="f80ec-133">Neste artigo, abordaremos somente a opção de failover.</span><span class="sxs-lookup"><span data-stu-id="f80ec-133">For the sake of this article, we will be concerned with only the failover option.</span></span>

![Roteamento por meio do Gerenciador de Tráfego do Azure](./images/disaster-recovery-azure-applications/routing-using-azure-traffic-manager.png)

<span data-ttu-id="f80ec-135">Ao configurar o Gerenciador de Tráfego, você fornece um novo prefixo DNS de Gerenciador de Tráfego, que será usado pelos usuários para acessar o seu serviço.</span><span class="sxs-lookup"><span data-stu-id="f80ec-135">When configuring Traffic Manager, you provide a new Traffic Manager DNS prefix, which users will use to access your service.</span></span> <span data-ttu-id="f80ec-136">Agora, o Gerenciador de Tráfego abstrai o balanceamento de carga um nível acima do que o nível da região.</span><span class="sxs-lookup"><span data-stu-id="f80ec-136">Traffic Manager now abstracts load balancing one level higher that the regional level.</span></span> <span data-ttu-id="f80ec-137">O DNS do Gerenciador de Tráfego é mapeado para um CNAME para todas as implantações que gerencia.</span><span class="sxs-lookup"><span data-stu-id="f80ec-137">The Traffic Manager DNS maps to a CNAME for all the deployments that it manages.</span></span>

<span data-ttu-id="f80ec-138">No Gerenciador de Tráfego, você especifica uma lista priorizada de implantações para as quais os usuários serão roteados quando ocorrer uma falha.</span><span class="sxs-lookup"><span data-stu-id="f80ec-138">Within Traffic Manager, you specify a prioritized list of deployments that users will be routed to when failure occurs.</span></span> <span data-ttu-id="f80ec-139">O Gerenciador de Tráfego monitora os pontos de extremidade de implantação.</span><span class="sxs-lookup"><span data-stu-id="f80ec-139">Traffic Manager monitors the deployment endpoints.</span></span> <span data-ttu-id="f80ec-140">Se a implantação primária ficar indisponível, o Gerenciador de Tráfego roteia usuários para a implantação seguinte na lista de prioridades.</span><span class="sxs-lookup"><span data-stu-id="f80ec-140">If the primary deployment becomes unavailable, Traffic Manager routes users to the next deployment on the priority list.</span></span>

<span data-ttu-id="f80ec-141">Embora o Gerenciador de Tráfego decida para onde ir durante um failover, você pode decidir se o domínio do failover estará inativo ou ativo enquanto você não estiver no modo de failover (que não tem relação com o Gerenciador de Tráfego).</span><span class="sxs-lookup"><span data-stu-id="f80ec-141">Although Traffic Manager decides where to go during a failover, you can decide whether your failover domain is dormant or active while you're not in failover mode (which is unrelated to Traffic Manager).</span></span> <span data-ttu-id="f80ec-142">O Gerenciador de Tráfego detecta uma falha no site primário e passa para o site de failover, independente de o site estar atendendo aos usuários no momento.</span><span class="sxs-lookup"><span data-stu-id="f80ec-142">Traffic Manager detects a failure in the primary site and rolls over to the failover site, regardless of whether that site is currently serving users.</span></span>

<span data-ttu-id="f80ec-143">Para saber mais sobre o funcionamento do Gerenciador de Tráfego do Azure, consulte:</span><span class="sxs-lookup"><span data-stu-id="f80ec-143">For more information on how Azure Traffic Manager works, refer to:</span></span>

* [<span data-ttu-id="f80ec-144">Visão geral do Gerenciador de Tráfego</span><span class="sxs-lookup"><span data-stu-id="f80ec-144">Traffic Manager overview</span></span>](/azure/traffic-manager/traffic-manager-overview/)
* [<span data-ttu-id="f80ec-145">Métodos de roteamento do Gerenciador de Tráfego</span><span class="sxs-lookup"><span data-stu-id="f80ec-145">Traffic Manager routing methods</span></span>](/azure/traffic-manager/traffic-manager-routing-methods)
* [<span data-ttu-id="f80ec-146">Configurar o método de roteamento de failover</span><span class="sxs-lookup"><span data-stu-id="f80ec-146">Configure failover routing method</span></span>](/azure/traffic-manager/traffic-manager-configure-failover-routing-method/)

## <a name="azure-disaster-scenarios"></a><span data-ttu-id="f80ec-147">Cenários de desastre do Azure</span><span class="sxs-lookup"><span data-stu-id="f80ec-147">Azure disaster scenarios</span></span>
<span data-ttu-id="f80ec-148">As seções a seguir abrangem vários tipos diferentes de cenários de desastre.</span><span class="sxs-lookup"><span data-stu-id="f80ec-148">The following sections cover several different types of disaster scenarios.</span></span> <span data-ttu-id="f80ec-149">Interrupções de serviço que afetam toda a região não são a única causa de falhas que afetam todo o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f80ec-149">Region-wide service disruptions are not the only cause of application-wide failures.</span></span> <span data-ttu-id="f80ec-150">Design inadequado e erros administrativos também podem levar a interrupções.</span><span class="sxs-lookup"><span data-stu-id="f80ec-150">Poor design and administrative errors can also lead to outages.</span></span> <span data-ttu-id="f80ec-151">É importante levar em consideração as possíveis causas de uma falha durante as fases de design e teste de seu plano de recuperação.</span><span class="sxs-lookup"><span data-stu-id="f80ec-151">It's important to consider the possible causes of a failure during both the design and testing phases of your recovery plan.</span></span> <span data-ttu-id="f80ec-152">Um bom plano aproveita os recursos do Azure e os aperfeiçoa com estratégias específicas ao aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f80ec-152">A good plan takes advantage of Azure features and augments them with application-specific strategies.</span></span> <span data-ttu-id="f80ec-153">A resposta escolhida é determinada pela importância do aplicativo, o objetivo do ponto de recuperação (RPO) e o objetivo do tempo de recuperação (RTO).</span><span class="sxs-lookup"><span data-stu-id="f80ec-153">The chosen response is determined by the importance of the application, the recovery point objective (RPO), and the recovery time objective (RTO).</span></span>

### <a name="application-failure"></a><span data-ttu-id="f80ec-154">Falha do aplicativo</span><span class="sxs-lookup"><span data-stu-id="f80ec-154">Application failure</span></span>
<span data-ttu-id="f80ec-155">O Gerenciador de Tráfego trata automaticamente das falhas que resultam do software do sistema operacional ou do hardware subjacente na máquina virtual do host.</span><span class="sxs-lookup"><span data-stu-id="f80ec-155">Azure Traffic Manager automatically handles failures that result from the underlying hardware or operating system software in the host virtual machine.</span></span> <span data-ttu-id="f80ec-156">O Azure cria uma nova instância de função e a adiciona ao pool disponível.</span><span class="sxs-lookup"><span data-stu-id="f80ec-156">Azure creates a new role instance and adds it to the available pool.</span></span> <span data-ttu-id="f80ec-157">Se mais de uma instância de função já estiver em execução, o Azure passará o processamento para as outras instâncias de função em execução enquanto substitui o nó com falha.</span><span class="sxs-lookup"><span data-stu-id="f80ec-157">If  more than one role instance was already running, Azure shifts processing to the other running role instances while replacing the failed node.</span></span>

<span data-ttu-id="f80ec-158">Erros graves do aplicativo podem ocorrer sem nenhuma falha subjacente do hardware ou sistema operacional.</span><span class="sxs-lookup"><span data-stu-id="f80ec-158">Serious application errors can occur without any underlying failure of the hardware or operating system.</span></span> <span data-ttu-id="f80ec-159">O aplicativo pode falhar devido às exceções catastróficas causadas por problemas de integridade de dados ou lógica incorreta.</span><span class="sxs-lookup"><span data-stu-id="f80ec-159">The application might fail due to catastrophic exceptions caused by bad logic or data integrity issues.</span></span> <span data-ttu-id="f80ec-160">Você precisa incluir telemetria suficiente ao código do aplicativo para que um sistema de monitoramento possa detectar condições de falha e notificar um administrador do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f80ec-160">You must include sufficient telemetry in the application code so that a monitoring system can detect failure conditions and notify an application administrator.</span></span> <span data-ttu-id="f80ec-161">Um administrador com total conhecimento dos processos de recuperação de desastres pode decidir o acionamento de um processo de failover ou aceitar uma interrupção de disponibilidade ao resolver os erros críticos.</span><span class="sxs-lookup"><span data-stu-id="f80ec-161">An administrator who has full knowledge of the disaster recovery processes can decide whether to trigger a failover process or accept an availability outage while resolving the critical errors.</span></span>

### <a name="data-corruption"></a><span data-ttu-id="f80ec-162">Dados corrompidos</span><span class="sxs-lookup"><span data-stu-id="f80ec-162">Data corruption</span></span>
<span data-ttu-id="f80ec-163">O Azure armazena automaticamente os dados do Banco de Dados SQL do Azure e do Armazenamento do Microsoft Azure três vezes, de forma redundante, em diferentes domínios de falha na mesma região.</span><span class="sxs-lookup"><span data-stu-id="f80ec-163">Azure automatically stores Azure SQL Database and Azure Storage data three times redundantly within different fault domains in the same region.</span></span> <span data-ttu-id="f80ec-164">Se você usar a replicação geográfica, os dados serão armazenados mais três vezes em uma região diferente.</span><span class="sxs-lookup"><span data-stu-id="f80ec-164">If you use geo-replication, the data is stored three additional times in a different region.</span></span> <span data-ttu-id="f80ec-165">No entanto, se os usuários ou o aplicativo corromperem esses dados na cópia primária, os dados serão replicados rapidamente para as outras cópias.</span><span class="sxs-lookup"><span data-stu-id="f80ec-165">However, if your users or your application corrupts that data in the primary copy, the data quickly replicates to the other copies.</span></span> <span data-ttu-id="f80ec-166">Infelizmente, isso resulta em várias cópias de dados corrompidos.</span><span class="sxs-lookup"><span data-stu-id="f80ec-166">Unfortunately, this results in multiple copies of corrupt data.</span></span>

<span data-ttu-id="f80ec-167">Para gerenciar a possível corrupção dos dados, você tem duas opções.</span><span class="sxs-lookup"><span data-stu-id="f80ec-167">To manage potential corruption of your data, you have two options.</span></span> <span data-ttu-id="f80ec-168">Primeiro, você pode gerenciar uma estratégia de backup personalizada.</span><span class="sxs-lookup"><span data-stu-id="f80ec-168">First, you can manage a custom backup strategy.</span></span> <span data-ttu-id="f80ec-169">Você pode armazenar seus backups no Azure ou localmente, dependendo de seus requisitos de negócios ou das normas governamentais.</span><span class="sxs-lookup"><span data-stu-id="f80ec-169">You can store your backups in Azure or on-premises, depending on your business requirements or governance regulations.</span></span> <span data-ttu-id="f80ec-170">Outra opção é usar a opção de restauração pontual para recuperar um banco de dados SQL.</span><span class="sxs-lookup"><span data-stu-id="f80ec-170">Another option is to use the point-in-time restore option to recover a SQL database.</span></span> <span data-ttu-id="f80ec-171">Para obter mais informações, consulte a seção [Estratégias de dados para recuperação de desastre](#data-strategies-for-disaster-recovery) abaixo.</span><span class="sxs-lookup"><span data-stu-id="f80ec-171">For more information, see the [data strategies for disaster recovery](#data-strategies-for-disaster-recovery) section below.</span></span>

### <a name="network-outage"></a><span data-ttu-id="f80ec-172">Interrupção de rede</span><span class="sxs-lookup"><span data-stu-id="f80ec-172">Network outage</span></span>
<span data-ttu-id="f80ec-173">Quando partes da rede do Azure estiverem inacessíveis, talvez você não consiga acessar o aplicativo ou os dados.</span><span class="sxs-lookup"><span data-stu-id="f80ec-173">When parts of the Azure network are inaccessible, you may be unable to access your application or data.</span></span> <span data-ttu-id="f80ec-174">Se uma ou mais instâncias de função estiverem indisponíveis devido a problemas de rede, o Azure usará as instâncias disponíveis restantes do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f80ec-174">If one or more role instances are unavailable due to network issues, Azure uses the remaining available instances of your application.</span></span> <span data-ttu-id="f80ec-175">Se o aplicativo não puder acessar os respectivos dados devido a uma interrupção de rede do Azure, você poderá operar localmente com funcionalidade reduzida do aplicativo usando dados armazenados em cache.</span><span class="sxs-lookup"><span data-stu-id="f80ec-175">If your application cannot access its data because of an Azure network outage, you can potentially run with reduced application functionality locally by using cached data.</span></span> <span data-ttu-id="f80ec-176">Você precisa criar a estratégia de recuperação de desastres a ser executada com funcionalidade reduzida no seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f80ec-176">You need to design the disaster recovery strategy to run with reduced functionality in your application.</span></span> <span data-ttu-id="f80ec-177">Para alguns aplicativos, talvez isso não seja prático.</span><span class="sxs-lookup"><span data-stu-id="f80ec-177">For some applications, this might not be practical.</span></span>

<span data-ttu-id="f80ec-178">Outra opção é armazenar dados em um local alternativo até que a conectividade seja restaurada.</span><span class="sxs-lookup"><span data-stu-id="f80ec-178">Another option is to store data in an alternate location until connectivity is restored.</span></span> <span data-ttu-id="f80ec-179">Se a redução da funcionalidade não for uma opção, as opções restantes serão o tempo de inatividade do aplicativo ou o failover para uma região alternativa.</span><span class="sxs-lookup"><span data-stu-id="f80ec-179">If reducing functionality is not an option, the remaining options are application downtime or failover to an alternate region.</span></span> <span data-ttu-id="f80ec-180">O design de um aplicativo que é executado com funcionalidade reduzida é tanto uma decisão de negócios quanto técnica.</span><span class="sxs-lookup"><span data-stu-id="f80ec-180">The design of an application running with reduced functionality is as much a business decision as a technical one.</span></span> <span data-ttu-id="f80ec-181">Isso é discutido com mais detalhes na seção [funcionalidade reduzida do aplicativo](#reduced-application-functionality).</span><span class="sxs-lookup"><span data-stu-id="f80ec-181">This is discussed further in the section on [reduced application functionality](#reduced-application-functionality).</span></span>

### <a name="failure-of-a-dependent-service"></a><span data-ttu-id="f80ec-182">Falha de um serviço dependente</span><span class="sxs-lookup"><span data-stu-id="f80ec-182">Failure of a dependent service</span></span>
<span data-ttu-id="f80ec-183">O Azure fornece muitos serviços que podem passar por tempo de inatividade periodicamente.</span><span class="sxs-lookup"><span data-stu-id="f80ec-183">Azure provides many services that can experience periodic downtime.</span></span> <span data-ttu-id="f80ec-184">Por exemplo, [Cache Redis do Azure](https://azure.microsoft.com/services/cache/) é um serviço multilocatário que fornece recursos de cache para seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f80ec-184">For example, [Azure Redis Cache](https://azure.microsoft.com/services/cache/) is a multi-tenant service which provides caching capabilities to your application.</span></span> <span data-ttu-id="f80ec-185">Será importante levar em consideração o que acontece em seu aplicativo se o serviço dependente ficar indisponível.</span><span class="sxs-lookup"><span data-stu-id="f80ec-185">It's important to consider what happens in your application if the dependent service is unavailable.</span></span> <span data-ttu-id="f80ec-186">Em muitos aspectos, esse cenário é semelhante ao cenário de interrupção da rede.</span><span class="sxs-lookup"><span data-stu-id="f80ec-186">In many ways, this scenario is similar to the network outage scenario.</span></span> <span data-ttu-id="f80ec-187">No entanto, considerar cada serviço de forma independente resulta em potenciais melhorias no plano geral.</span><span class="sxs-lookup"><span data-stu-id="f80ec-187">However, considering each service independently results in potential improvements to your overall plan.</span></span>

<span data-ttu-id="f80ec-188">O Cache Redis do Azure fornece cache ao seu aplicativo de dentro da implantação do serviço de nuvem, o que é benéfico para a recuperação de desastre.</span><span class="sxs-lookup"><span data-stu-id="f80ec-188">Azure Redis Cache provides caching to your application from within your cloud service deployment, which provides disaster recovery benefits.</span></span> <span data-ttu-id="f80ec-189">Primeiro, o serviço agora é executado em funções que são locais com relação à sua implantação.</span><span class="sxs-lookup"><span data-stu-id="f80ec-189">First, the service now runs on roles that are local to your deployment.</span></span> <span data-ttu-id="f80ec-190">Portanto, você conseguirá monitorar e gerenciar melhor o status do cache como parte dos processos de gerenciamento geral do serviço de nuvem.</span><span class="sxs-lookup"><span data-stu-id="f80ec-190">Therefore, you're better able to monitor and manage the status of the cache as part of your overall management processes for the cloud service.</span></span> <span data-ttu-id="f80ec-191">Esse tipo de armazenamento em cache também apresenta novos recursos, como alta disponibilidade para os dados armazenados em cache, o que preserva os dados armazenados em cache caso um único nó falhe, mantendo cópias duplicadas em outros nós.</span><span class="sxs-lookup"><span data-stu-id="f80ec-191">This type of caching also exposes new features such as high availability for cached data, which preserves cached data if a single node fails by maintaining duplicate copies on other nodes.</span></span>

<span data-ttu-id="f80ec-192">Observe que a alta disponibilidade diminui a taxa de transferência e aumenta a latência, pois as operações de gravação também precisam atualizar as cópias secundárias.</span><span class="sxs-lookup"><span data-stu-id="f80ec-192">Note that high availability decreases throughput and increases latency because write operations must also upedate any secondary copies.</span></span> <span data-ttu-id="f80ec-193">A quantidade de memória necessária para armazenar os dados em cache é efetivamente duplicada, o que deve ser levado em conta durante o planejamento de capacidade.</span><span class="sxs-lookup"><span data-stu-id="f80ec-193">The amount of memory required to store the cached data is effectively doubled, which must be taken into account during capacity planning.</span></span>  <span data-ttu-id="f80ec-194">Esse exemplo demonstra que cada serviço dependente pode ter recursos que melhoram a disponibilidade e a resistência geral a falhas catastróficas.</span><span class="sxs-lookup"><span data-stu-id="f80ec-194">This example demonstrates that each dependent service might have capabilities that improve your overall availability and resistance to catastrophic failures.</span></span>

<span data-ttu-id="f80ec-195">Com cada serviço dependente, você precisa entender as implicações de uma interrupção do serviço.</span><span class="sxs-lookup"><span data-stu-id="f80ec-195">With each dependent service, you should understand the implications of a service disruption.</span></span> <span data-ttu-id="f80ec-196">No exemplo do cache, talvez seja possível acessar os dados diretamente por meio de um banco de dados até que você restaure seu cache.</span><span class="sxs-lookup"><span data-stu-id="f80ec-196">In the caching example, it might be possible to access the data directly from a database until you restore your cache.</span></span> <span data-ttu-id="f80ec-197">Isso resultaria em desempenho reduzido ao fornecer acesso completo aos dados do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f80ec-197">This would result in reduced performance while providing full access to application data.</span></span>

### <a name="region-wide-service-disruption"></a><span data-ttu-id="f80ec-198">Interrupção do serviço em toda uma região</span><span class="sxs-lookup"><span data-stu-id="f80ec-198">Region-wide service disruption</span></span>
<span data-ttu-id="f80ec-199">As falhas anteriores foram, principalmente, falhas que poderiam ser gerenciadas dentro de uma mesma região do Azure.</span><span class="sxs-lookup"><span data-stu-id="f80ec-199">The previous failures have primarily been failures that can be managed within the same Azure region.</span></span> <span data-ttu-id="f80ec-200">No entanto, você também deve se preparar para a possibilidade de que haja uma interrupção do serviço em toda a região.</span><span class="sxs-lookup"><span data-stu-id="f80ec-200">However, you must also prepare for the possibility that there is a service disruption of the entire region.</span></span> <span data-ttu-id="f80ec-201">Se ocorrer uma interrupção do serviço em toda a região, as cópias dos seus dados que forem redundantes localmente não ficarão disponíveis.</span><span class="sxs-lookup"><span data-stu-id="f80ec-201">If a region-wide service disruption occurs, the locally redundant copies of your data are not available.</span></span> <span data-ttu-id="f80ec-202">Se você tiver habilitado a replicação geográfica, haverá três cópias adicionais dos seus blobs e tabelas em uma região diferente.</span><span class="sxs-lookup"><span data-stu-id="f80ec-202">If you have enabled geo-replication, there are three additional copies of your blobs and tables in a different region.</span></span> <span data-ttu-id="f80ec-203">Se a Microsoft declarar a região como perdida, o Azure remapeará todas as entradas DNS para a região da replicação geográfica.</span><span class="sxs-lookup"><span data-stu-id="f80ec-203">If Microsoft declares the region lost, Azure remaps all of the DNS entries to the geo-replicated region.</span></span>

> [!NOTE]
> <span data-ttu-id="f80ec-204">Lembre-se de que você não tem nenhum controle sobre esse processo e de que ele ocorrerá apenas em caso de interrupção do serviço em toda uma região.</span><span class="sxs-lookup"><span data-stu-id="f80ec-204">Be aware that you don't have any control over this process, and it will occur only for region-wide service disruption.</span></span> <span data-ttu-id="f80ec-205">Por isso, você deve contar com outras estratégias de backup específicas ao aplicativo para chegar ao nível mais alto de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="f80ec-205">Because of this, you must rely on other application-specific backup strategies to achieve the highest level of availability.</span></span> <span data-ttu-id="f80ec-206">Para saber mais, consulte a seção sobre [estratégias de dados para recuperação de desastre](#data-strategies-for-disaster-recovery).</span><span class="sxs-lookup"><span data-stu-id="f80ec-206">For more information, see the section on [data strategies for disaster recovery](#data-strategies-for-disaster-recovery).</span></span>
> 
> 

### <a name="azure-wide-service-disruption"></a><span data-ttu-id="f80ec-207">Interrupção do serviço em todo o Azure</span><span class="sxs-lookup"><span data-stu-id="f80ec-207">Azure-wide service disruption</span></span>
<span data-ttu-id="f80ec-208">No planejamento para desastres, você deve levar em consideração toda a gama de possíveis desastres.</span><span class="sxs-lookup"><span data-stu-id="f80ec-208">In disaster planning, you must consider the entire range of possible disasters.</span></span> <span data-ttu-id="f80ec-209">Uma das interrupções de serviço mais graves envolveria todas as regiões do Azure simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="f80ec-209">One of the most severe service disruptions would involve all Azure regions simultaneously.</span></span> <span data-ttu-id="f80ec-210">Assim como em outros tipos de interrupção de serviço, você pode optar por aceitar o risco de que haja um tempo de inatividade temporário caso a situação ocorra.</span><span class="sxs-lookup"><span data-stu-id="f80ec-210">As with other service disruptions, you might decide to accept the risk of temporary downtime in that event.</span></span> <span data-ttu-id="f80ec-211">Interrupções de serviço amplas que afetam várias regiões são muito mais raras do que interrupções de serviço isoladas envolvendo serviços dependentes ou regiões únicas.</span><span class="sxs-lookup"><span data-stu-id="f80ec-211">Widespread service disruptions that span regions are much rarer than isolated service disruptions involving dependent services or single regions.</span></span>

<span data-ttu-id="f80ec-212">No entanto, você pode decidir que determinados aplicativos essenciais exigem um plano de backup para uma interrupção do serviço em várias regiões.</span><span class="sxs-lookup"><span data-stu-id="f80ec-212">However, you may decide that certain mission-critical applications require a backup plan for a multi-region service disruption.</span></span> <span data-ttu-id="f80ec-213">Esse plano poderia incluir failover para serviços em uma [nuvem alternativa](#alternative-cloud) ou uma [solução híbrida local e na nuvem](#hybrid-on-premises-and-cloud-solution).</span><span class="sxs-lookup"><span data-stu-id="f80ec-213">This plan might include failing over to services in an [alternative cloud](#alternative-cloud) or a [hybrid on-premises and cloud solution](#hybrid-on-premises-and-cloud-solution).</span></span>

### <a name="reduced-application-functionality"></a><span data-ttu-id="f80ec-214">Funcionalidade reduzida do aplicativo</span><span class="sxs-lookup"><span data-stu-id="f80ec-214">Reduced application functionality</span></span>
<span data-ttu-id="f80ec-215">Um aplicativo bem projetado normalmente usa serviços que se comunicam uns com os outros por meio da implementação de padrões de troca de informações com acoplamento pouco rígido.</span><span class="sxs-lookup"><span data-stu-id="f80ec-215">A well-designed application typically uses services that communicate with each other though the implementation of loosely coupled information-interchange patterns.</span></span> <span data-ttu-id="f80ec-216">Um aplicativo adequado à DR requer a separação de responsabilidades no nível de serviço.</span><span class="sxs-lookup"><span data-stu-id="f80ec-216">A DR-friendly application requires separation of responsibilities at the service level.</span></span> <span data-ttu-id="f80ec-217">Isso impede que a interrupção de um serviço dependente faça com que o aplicativo inteiro fique inativo.</span><span class="sxs-lookup"><span data-stu-id="f80ec-217">This prevents the disruption of a dependent service from bringing down the entire application.</span></span> <span data-ttu-id="f80ec-218">Por exemplo, considere o aplicativo de comércio eletrônico da Empresa Y. Os seguintes módulos podem constituir o aplicativo:</span><span class="sxs-lookup"><span data-stu-id="f80ec-218">For example, consider a web commerce application for Company Y. The following modules might constitute the application:</span></span>

* <span data-ttu-id="f80ec-219">**Catálogo de Produtos** permite que os usuários procurem produtos.</span><span class="sxs-lookup"><span data-stu-id="f80ec-219">**Product Catalog** allows users to browse products.</span></span>
* <span data-ttu-id="f80ec-220">**Carrinho de Compras** permite que os usuários adicionem/removam produtos de seu carrinho de compras.</span><span class="sxs-lookup"><span data-stu-id="f80ec-220">**Shopping Cart** allows users to add/remove products in their shopping cart.</span></span>
* <span data-ttu-id="f80ec-221">**Status do Pedido** mostra o status de envio dos pedidos dos usuários.</span><span class="sxs-lookup"><span data-stu-id="f80ec-221">**Order Status** shows the shipping status of user orders.</span></span>
* <span data-ttu-id="f80ec-222">**Envio de Pedidos** finaliza a sessão de compras enviando o pedido com o pagamento.</span><span class="sxs-lookup"><span data-stu-id="f80ec-222">**Order Submission** finalizes the shopping session by submitting the order with payment.</span></span>
* <span data-ttu-id="f80ec-223">**Processamento de Pedidos** valida o pedido com relação à integridade de dados e executa a verificação de disponibilidade de quantidade.</span><span class="sxs-lookup"><span data-stu-id="f80ec-223">**Order Processing** validates the order for data integrity and performs a quantity availability check.</span></span>

<span data-ttu-id="f80ec-224">Quando uma dependência do serviço neste aplicativo fica indisponível, como o serviço funciona até que a dependência seja recuperada?</span><span class="sxs-lookup"><span data-stu-id="f80ec-224">When a service dependency in this application becomes unavailable, how does the service function until the dependency recovers?</span></span> <span data-ttu-id="f80ec-225">Um sistema bem projetado implementa limites de isolamento por meio da separação de responsabilidades no momento do design e no momento da execução.</span><span class="sxs-lookup"><span data-stu-id="f80ec-225">A well-designed system implements isolation boundaries through separation of responsibilities, both at design time and at runtime.</span></span> <span data-ttu-id="f80ec-226">Você pode categorizar cada falha como recuperável e não recuperável.</span><span class="sxs-lookup"><span data-stu-id="f80ec-226">You can categorize every failure as recoverable and non-recoverable.</span></span> <span data-ttu-id="f80ec-227">Erros não recuperáveis desativarão o serviço, mas é possível atenuar erros recuperáveis com alternativas.</span><span class="sxs-lookup"><span data-stu-id="f80ec-227">Non-recoverable errors will bring down the service, but you can mitigate a recoverable error through alternatives.</span></span> <span data-ttu-id="f80ec-228">Determinados problemas resolvidos automaticamente tratando falhas e adotando ações alternativas são transparentes para o usuário.</span><span class="sxs-lookup"><span data-stu-id="f80ec-228">Certain problems addressed by automatically handling faults and taking alternate actions are transparent to the user.</span></span> <span data-ttu-id="f80ec-229">Durante uma interrupção de serviço mais grave, o aplicativo pode ficar completamente indisponível.</span><span class="sxs-lookup"><span data-stu-id="f80ec-229">During a more serious service disruption, the application might be completely unavailable.</span></span> <span data-ttu-id="f80ec-230">Uma terceira opção é continuar a tratar as solicitações do usuário com funcionalidade reduzida.</span><span class="sxs-lookup"><span data-stu-id="f80ec-230">A third option is to continue handling user requests with reduced functionality.</span></span>

<span data-ttu-id="f80ec-231">Por exemplo, se o banco de dados que hospeda pedidos ficar inativo, o serviço de Processamento de pedidos perderá a capacidade de processar transações de vendas.</span><span class="sxs-lookup"><span data-stu-id="f80ec-231">For instance, if the database for hosting orders goes down, the Order Processing service loses its ability to process sales transactions.</span></span> <span data-ttu-id="f80ec-232">Dependendo da arquitetura, pode ser difícil ou impossível que os serviços de Envio de pedidos e Processamento de pedidos do aplicativo continuem.</span><span class="sxs-lookup"><span data-stu-id="f80ec-232">Depending on the architecture, it might be difficult or impossible for the Order Submission and Order Processing services of the application to continue.</span></span> <span data-ttu-id="f80ec-233">Se o aplicativo não tiver sido projetado para lidar com esse cenário, o aplicativo inteiro poderá ficar offline.</span><span class="sxs-lookup"><span data-stu-id="f80ec-233">If the application is not designed to handle this scenario, the entire application might go offline.</span></span> <span data-ttu-id="f80ec-234">No entanto, se os dados de produto são armazenados em um local diferente, o módulo de Catálogo de produtos ainda pode ser usado para exibir produtos.</span><span class="sxs-lookup"><span data-stu-id="f80ec-234">However, if the product data is stored in a different location, then the Product Catalog module can still be used for viewing products.</span></span> <span data-ttu-id="f80ec-235">No entanto, outras partes do aplicativo ficarão indisponíveis, como a realização de pedidos ou consultas de estoque.</span><span class="sxs-lookup"><span data-stu-id="f80ec-235">However, other parts of the application are unavailable, such as ordering or inventory queries.</span></span>

<span data-ttu-id="f80ec-236">A decisão de qual funcionalidade reduzida do aplicativo estará disponível é uma decisão de negócios e uma decisão técnica.</span><span class="sxs-lookup"><span data-stu-id="f80ec-236">Deciding what reduced application functionality is available is both a business decision and a technical decision.</span></span> <span data-ttu-id="f80ec-237">Você deve decidir como o aplicativo vai informar os usuários sobre problemas temporários.</span><span class="sxs-lookup"><span data-stu-id="f80ec-237">You must decide how the application will inform the users of any temporary problems.</span></span> <span data-ttu-id="f80ec-238">No exemplo acima, o aplicativo poderia permitir a exibição de produtos e a adição deles a um carrinho de compras.</span><span class="sxs-lookup"><span data-stu-id="f80ec-238">In the example above, the application might allow viewing products and adding them to a shopping cart.</span></span> <span data-ttu-id="f80ec-239">No entanto, quando o usuário tentasse fazer uma compra, o aplicativo o notificaria de que a funcionalidade de realização de pedidos está indisponível temporariamente.</span><span class="sxs-lookup"><span data-stu-id="f80ec-239">However, when the user attempts to make a purchase, the application notifies the user that the ordering functionality is temporarily unavailable.</span></span> <span data-ttu-id="f80ec-240">Isso não é ideal para o cliente, mas evita a interrupção do serviço de todo o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f80ec-240">This isn't ideal for the customer, but it does prevent an application-wide service disruption.</span></span>

## <a name="data-strategies-for-disaster-recovery"></a><span data-ttu-id="f80ec-241">estratégias de dados para recuperação de desastre</span><span class="sxs-lookup"><span data-stu-id="f80ec-241">Data strategies for disaster recovery</span></span>
<span data-ttu-id="f80ec-242">O tratamento adequado dos dados é um aspecto desafiador de um plano de recuperação de desastres.</span><span class="sxs-lookup"><span data-stu-id="f80ec-242">Proper data handling is a challenging aspect of a disaster recovery plan.</span></span> <span data-ttu-id="f80ec-243">Durante o processo de recuperação, a restauração de dados geralmente leva mais tempo.</span><span class="sxs-lookup"><span data-stu-id="f80ec-243">During the recovery process, data restoration typically takes the most time.</span></span> <span data-ttu-id="f80ec-244">Escolhas diferentes para funcionalidades reduzidas levam a desafios difíceis em termos de recuperação de dados após uma falha e consistência após uma falha.</span><span class="sxs-lookup"><span data-stu-id="f80ec-244">Different choices for reducing functionality result in difficult challenges for data recovery from failure and consistency after failure.</span></span>

<span data-ttu-id="f80ec-245">Uma consideração é a necessidade de restaurar ou manter uma cópia dos dados do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f80ec-245">One consideration is the need to restore or maintain a copy of the application’s data.</span></span> <span data-ttu-id="f80ec-246">Você usará esses dados para fins de referência e transacionais em um site secundário.</span><span class="sxs-lookup"><span data-stu-id="f80ec-246">You will use this data for reference and transactional purposes at a secondary site.</span></span> <span data-ttu-id="f80ec-247">Uma implantação local requer um processo de planejamento caro e longo para implementar uma estratégia de recuperação de desastre envolvendo várias regiões.</span><span class="sxs-lookup"><span data-stu-id="f80ec-247">An on-premises deployment requires an expensive and lengthy planning process to implement a multiple-region disaster recovery strategy.</span></span> <span data-ttu-id="f80ec-248">De foma conveniente, a maioria dos provedores de nuvem, incluindo o Azure, permitem prontamente a implantação de aplicativos em várias regiões.</span><span class="sxs-lookup"><span data-stu-id="f80ec-248">Conveniently, most cloud providers, including Azure, readily allow the deployment of applications to multiple regions.</span></span> <span data-ttu-id="f80ec-249">Essas regiões são distribuídas geograficamente de forma que a interrupção do serviço em várias regiões deve ser extremamente rara.</span><span class="sxs-lookup"><span data-stu-id="f80ec-249">These regions are geographically distributed in such a way that multiple-region service disruption should be extremely rare.</span></span> <span data-ttu-id="f80ec-250">A estratégia para lidar com dados entre regiões é um dos fatores que contribuem para o sucesso de qualquer plano de recuperação de desastre.</span><span class="sxs-lookup"><span data-stu-id="f80ec-250">The strategy for handling data across regions is one of the contributing factors for the success of any disaster recovery plan.</span></span>

<span data-ttu-id="f80ec-251">As seções a seguir discutem as técnicas de recuperação de desastre relacionadas a backups de dados, dados de referência e dados transacionais.</span><span class="sxs-lookup"><span data-stu-id="f80ec-251">The following sections discuss disaster recovery techniques related to data backups, reference data, and transactional data.</span></span>

### <a name="backup-and-restore"></a><span data-ttu-id="f80ec-252">Backup e restauração</span><span class="sxs-lookup"><span data-stu-id="f80ec-252">Backup and restore</span></span>
<span data-ttu-id="f80ec-253">Backups regulares dos dados do aplicativo podem dar suporte a alguns cenários de recuperação de desastre.</span><span class="sxs-lookup"><span data-stu-id="f80ec-253">Regular backups of application data can support some disaster recovery scenarios.</span></span> <span data-ttu-id="f80ec-254">Diferentes recursos de armazenamento requerem diferentes técnicas.</span><span class="sxs-lookup"><span data-stu-id="f80ec-254">Different storage resources require different techniques.</span></span>

#### <a name="sql-database"></a><span data-ttu-id="f80ec-255">Banco de dados SQL</span><span class="sxs-lookup"><span data-stu-id="f80ec-255">SQL Database</span></span>
<span data-ttu-id="f80ec-256">Para as camadas Basic, Standard e Premium do Banco de Dados SQL, você pode aproveitar a restauração pontual para recuperar o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="f80ec-256">For the Basic, Standard, and Premium SQL Database tiers, you can take advantage of point-in-time restore to recover your database.</span></span> <span data-ttu-id="f80ec-257">Para saber mais, confira [Visão geral: continuidade de negócios em nuvem e recuperação de desastre do banco de dados com o banco de dados SQL](/azure/sql-database/sql-database-business-continuity/).</span><span class="sxs-lookup"><span data-stu-id="f80ec-257">For more information, see [Overview: Cloud business continuity and database disaster recovery with SQL Database](/azure/sql-database/sql-database-business-continuity/).</span></span> <span data-ttu-id="f80ec-258">Outra opção é usar a Replicação Geográfica Ativa para o Banco de Dados SQL.</span><span class="sxs-lookup"><span data-stu-id="f80ec-258">Another option is to use Active Geo-Replication for SQL Database.</span></span> <span data-ttu-id="f80ec-259">Ela replica automaticamente alterações no banco de dados para bancos de dados secundários na mesma região ou até mesmo em uma região diferente do Azure.</span><span class="sxs-lookup"><span data-stu-id="f80ec-259">This automatically replicates database changes to secondary databases in the same Azure region or even in a different Azure region.</span></span> <span data-ttu-id="f80ec-260">Isso oferece uma alternativa potencial para algumas das técnicas de sincronização de dados mais manuais apresentadas neste artigo.</span><span class="sxs-lookup"><span data-stu-id="f80ec-260">This provides a potential alternative to some of the more manual data synchronization techniques presented in this article.</span></span> <span data-ttu-id="f80ec-261">Para saber mais, confira [Visão geral: Replicação Geográfica Ativa para o Banco de Dados SQL](/azure/sql-database/sql-database-geo-replication-overview/).</span><span class="sxs-lookup"><span data-stu-id="f80ec-261">For more information, see [Overview: SQL Database Active Geo-Replication](/azure/sql-database/sql-database-geo-replication-overview/).</span></span>

<span data-ttu-id="f80ec-262">Você também pode usar uma abordagem mais manual para o backup e restauração.</span><span class="sxs-lookup"><span data-stu-id="f80ec-262">You can also use a more manual approach for backup and restore.</span></span> <span data-ttu-id="f80ec-263">Use o comando CÓPIA DE BANCO DE DADOS para criar uma cópia de backup do banco de dados com consistência transacional.</span><span class="sxs-lookup"><span data-stu-id="f80ec-263">Use the DATABASE COPY command to create a backup copy of the database with transactional consistency.</span></span> <span data-ttu-id="f80ec-264">Você também pode usar o serviço de importação/exportação do Banco de Dados SQL do Azure, que oferece suporte à exportação de bancos de dados para arquivos BACPAC (arquivos compactados contendo o esquema de banco de dados e dados associados) que são armazenados no armazenamento de Blobs do Azure.</span><span class="sxs-lookup"><span data-stu-id="f80ec-264">You can also use the import/export service of Azure SQL Database, which supports exporting databases to BACPAC files (compressed files containing your database schema and associated data) that are stored in Azure Blob storage.</span></span>

<span data-ttu-id="f80ec-265">A redundância interna do Armazenamento do Azure cria duas réplicas do arquivo de backup na mesma região.</span><span class="sxs-lookup"><span data-stu-id="f80ec-265">The built-in redundancy of Azure Storage creates two replicas of the backup file in the same region.</span></span> <span data-ttu-id="f80ec-266">No entanto, a frequência de execução do processo de backup determina o RPO, que é a quantidade de dados que você pode perder em cenários de desastre.</span><span class="sxs-lookup"><span data-stu-id="f80ec-266">However, the frequency of running the backup process determines your RPO, which is the amount of data you might lose in disaster scenarios.</span></span> <span data-ttu-id="f80ec-267">Por exemplo, imagine que você execute um backup no início de cada hora e um desastre ocorre dois minutos antes do início da hora.</span><span class="sxs-lookup"><span data-stu-id="f80ec-267">For example, imagine that you perform a backup at the top of each hour, and a disaster occurs two minutes before the top of the hour.</span></span> <span data-ttu-id="f80ec-268">Você perde 58 minutos de dados gravados após o último backup ter sido executado.</span><span class="sxs-lookup"><span data-stu-id="f80ec-268">You lose 58 minutes of data recorded after the last backup was performed.</span></span> <span data-ttu-id="f80ec-269">Além disso, para se proteger de uma interrupção do serviço de toda a região, você deve copiar os arquivos BACPAC para uma região alternativa.</span><span class="sxs-lookup"><span data-stu-id="f80ec-269">Also, to protect against a region-wide service disruption, you should copy the BACPAC files to an alternate region.</span></span> <span data-ttu-id="f80ec-270">Depois, você tem a opção de restaurar esses backups na região alternativa.</span><span class="sxs-lookup"><span data-stu-id="f80ec-270">You then have the option of restoring those backups in the alternate region.</span></span> <span data-ttu-id="f80ec-271">Para obter mais detalhes, confira [Visão geral: continuidade de negócios em nuvem e recuperação de desastre do banco de dados com o banco de dados SQL](/azure/sql-database/sql-database-business-continuity/).</span><span class="sxs-lookup"><span data-stu-id="f80ec-271">For more details, see [Overview: Cloud business continuity and database disaster recovery with SQL Database](/azure/sql-database/sql-database-business-continuity/).</span></span>

#### <a name="azure-storage"></a><span data-ttu-id="f80ec-272">Armazenamento do Azure</span><span class="sxs-lookup"><span data-stu-id="f80ec-272">Azure Storage</span></span>
<span data-ttu-id="f80ec-273">Para o Armazenamento do Azure, você pode desenvolver um processo de backup personalizado ou usar uma das diversas ferramentas de backup de terceiros.</span><span class="sxs-lookup"><span data-stu-id="f80ec-273">For Azure Storage, you can develop a custom backup process or use one of many third-party backup tools.</span></span> <span data-ttu-id="f80ec-274">Observe que a maioria dos designs de aplicativo tem complexidades adicionais em que os recursos de armazenamento fazem referência um ao outro.</span><span class="sxs-lookup"><span data-stu-id="f80ec-274">Note that most application designs have additional complexities where storage resources reference each other.</span></span> <span data-ttu-id="f80ec-275">Por exemplo, considere um banco de dados SQL que tem uma coluna com vínculo a um blob no Armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="f80ec-275">For example, consider a SQL database that has a column that links to a blob in Azure Storage.</span></span> <span data-ttu-id="f80ec-276">Se os backups não acontecerem simultaneamente, o banco de dados poderá ter um ponteiro voltado a um blob do qual não foi feito backup antes da falha.</span><span class="sxs-lookup"><span data-stu-id="f80ec-276">If the backups do not happen simultaneously, the database might have a pointer to a blob that was not backed up before the failure.</span></span> <span data-ttu-id="f80ec-277">O plano de recuperação de desastre ou aplicativo deve implementar processos para tratar dessa inconsistência após uma recuperação.</span><span class="sxs-lookup"><span data-stu-id="f80ec-277">The application or disaster recovery plan must implement processes to handle this inconsistency after a recovery.</span></span>

#### <a name="other-data-platforms"></a><span data-ttu-id="f80ec-278">Outras plataformas de dados</span><span class="sxs-lookup"><span data-stu-id="f80ec-278">Other data platforms</span></span>
<span data-ttu-id="f80ec-279">Outras plataformas hospedadas em infraestrutura como serviço (IaaS), como Elasticsearch ou MongoDB, têm seus próprios recursos e considerações ao criar um processo de restauração e backup integrado.</span><span class="sxs-lookup"><span data-stu-id="f80ec-279">Other infrastructure-as-a-service (IaaS) hosted data platforms, such as Elasticsearch or MongoDB, have their own capabilities and considerations when creating an integrated backup and restore process.</span></span> <span data-ttu-id="f80ec-280">Para essas plataformas de dados, a recomendação geral é usar quaisquer recursos de instantâneo ou replicação baseada em integração nativa ou disponível.</span><span class="sxs-lookup"><span data-stu-id="f80ec-280">For these data platforms, the general recommendation is to use any native or available integration-based replication or snapshotting capabilities.</span></span> <span data-ttu-id="f80ec-281">Se esses recursos não existem ou não são adequados, considere usar o Serviço de Backup do Azure ou instantâneos de disco gerenciado/não gerenciado para criar uma cópia pontual dos dados do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f80ec-281">If those capabilities do not exist or are not suitable, then consider using Azure Backup Service or managed/unmanaged disk snapshots to create a point-in-time copy of application data.</span></span> <span data-ttu-id="f80ec-282">Em todos os casos, é importante determinar como realizar backups consistentes, especialmente quando os dados do aplicativo se estendem por vários sistemas de arquivos, ou quando várias unidades são combinadas em um único sistema de arquivos usando os gerenciadores de volumes ou RAID com base em software.</span><span class="sxs-lookup"><span data-stu-id="f80ec-282">In all cases, it’s important to determine how to achieve consistent backups, especially when application data spans multiple files systems, or when multiple drives are combined into a single file system using volume managers or software-based RAID.</span></span>

### <a name="reference-data-pattern-for-disaster-recovery"></a><span data-ttu-id="f80ec-283">Padrão de dados de referência para a recuperação de desastre</span><span class="sxs-lookup"><span data-stu-id="f80ec-283">Reference data pattern for disaster recovery</span></span>
<span data-ttu-id="f80ec-284">Os dados de referência são somente leitura e compatíveis com a funcionalidade do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f80ec-284">Reference data is read-only data that supports application functionality.</span></span> <span data-ttu-id="f80ec-285">Normalmente, eles não mudam com muita frequência.</span><span class="sxs-lookup"><span data-stu-id="f80ec-285">It typically does not change frequently.</span></span> <span data-ttu-id="f80ec-286">Embora o backup e restauração seja um método para lidar com interrupções de serviço em toda uma região, o RTO é relativamente longo.</span><span class="sxs-lookup"><span data-stu-id="f80ec-286">Although backup and restore is one method to handle region-wide service disruptions, the RTO is relatively long.</span></span> <span data-ttu-id="f80ec-287">Quando você implanta o aplicativo em uma região secundária, algumas estratégias podem melhorar o RTO para dados de referência.</span><span class="sxs-lookup"><span data-stu-id="f80ec-287">When you deploy the application to a secondary region, some strategies can improve the RTO for reference data.</span></span>

<span data-ttu-id="f80ec-288">Como os dados de referência mudam com pouca frequência, você pode melhorar o RTO mantendo uma cópia permanente dos dados de referência na região secundária.</span><span class="sxs-lookup"><span data-stu-id="f80ec-288">Because reference data changes infrequently, you can improve the RTO by maintaining a permanent copy of the reference data in the secondary region.</span></span> <span data-ttu-id="f80ec-289">Isso elimina o tempo necessário para restaurar backups no caso de um desastre.</span><span class="sxs-lookup"><span data-stu-id="f80ec-289">This eliminates the time required to restore backups in the event of a disaster.</span></span> <span data-ttu-id="f80ec-290">Para atender aos requisitos de recuperação de desastre em várias regiões, você deve implantar o aplicativo e os dados de referência juntos em várias regiões.</span><span class="sxs-lookup"><span data-stu-id="f80ec-290">To meet the multiple-region disaster recovery requirements, you must deploy the application and the reference data together in multiple regions.</span></span> <span data-ttu-id="f80ec-291">Conforme mencionado no [Padrão de dados de referência para alta disponibilidade](high-availability-azure-applications.md#reference-data-pattern-for-high-availability), você pode implantar dados de referência na própria função, no armazenamento externo ou em uma combinação de ambos.</span><span class="sxs-lookup"><span data-stu-id="f80ec-291">As mentioned in [Reference data pattern for high availability](high-availability-azure-applications.md#reference-data-pattern-for-high-availability), you can deploy reference data to the role itself, to external storage, or to a combination of both.</span></span>

<span data-ttu-id="f80ec-292">O modelo de implantação de dados de referência em nós de computação atende implicitamente aos requisitos de recuperação de desastre.</span><span class="sxs-lookup"><span data-stu-id="f80ec-292">The reference data deployment model within compute nodes implicitly satisfies the disaster recovery requirements.</span></span> <span data-ttu-id="f80ec-293">A implantação de dados de referência no Banco de Dados SQL requer que você implante uma cópia dos dados de referência em cada região.</span><span class="sxs-lookup"><span data-stu-id="f80ec-293">Reference data deployment to SQL Database requires that you deploy a copy of the reference data to each region.</span></span> <span data-ttu-id="f80ec-294">A mesma estratégia se aplica ao Armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="f80ec-294">The same strategy applies to Azure Storage.</span></span> <span data-ttu-id="f80ec-295">Você deve implantar uma cópia de todos os dados de referência que são armazenados no Armazenamento do Azure nas regiões primária e secundária.</span><span class="sxs-lookup"><span data-stu-id="f80ec-295">You must deploy a copy of any reference data that's stored in Azure Storage to the primary and secondary regions.</span></span>

![Publicação de dados de referência nas regiões primária e secundária](./images/disaster-recovery-azure-applications/reference-data-publication-to-both-primary-and-secondary-regions.png)

<span data-ttu-id="f80ec-297">É preciso implementar suas próprias rotinas de backup específicas ao aplicativo para todos os dados, incluindo dados de referência.</span><span class="sxs-lookup"><span data-stu-id="f80ec-297">You must implement your own application-specific backup routines for all data, including reference data.</span></span> <span data-ttu-id="f80ec-298">As cópias com replicação geográfica entre regiões são usadas somente em uma interrupção de serviço que afete toda uma região.</span><span class="sxs-lookup"><span data-stu-id="f80ec-298">Geo-replicated copies across regions are used only in a region-wide service disruption.</span></span> <span data-ttu-id="f80ec-299">Para evitar um tempo de inatividade estendido, implante as partes críticas dos dados do aplicativo na região secundária.</span><span class="sxs-lookup"><span data-stu-id="f80ec-299">To prevent extended downtime, deploy the mission-critical parts of the application’s data to the secondary region.</span></span> <span data-ttu-id="f80ec-300">Para ver um exemplo dessa topologia, veja o [modelo ativo-passivo](#active-passive).</span><span class="sxs-lookup"><span data-stu-id="f80ec-300">For an example of this topology, see the [active-passive model](#active-passive).</span></span>

### <a name="transactional-data-pattern-for-disaster-recovery"></a><span data-ttu-id="f80ec-301">Padrão de dados transacionais para a recuperação de desastre</span><span class="sxs-lookup"><span data-stu-id="f80ec-301">Transactional data pattern for disaster recovery</span></span>
<span data-ttu-id="f80ec-302">A implementação de uma estratégia de modo de desastre totalmente funcional exige a replicação assíncrona dos dados transacionais para a região secundária.</span><span class="sxs-lookup"><span data-stu-id="f80ec-302">Implementation of a fully functional disaster mode strategy requires asynchronous replication of the transactional data to the secondary region.</span></span> <span data-ttu-id="f80ec-303">As janelas de tempo práticas em que a replicação pode ocorrer determinarão as características de RPO do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f80ec-303">The practical time windows within which the replication can occur will determine the RPO characteristics of the application.</span></span> <span data-ttu-id="f80ec-304">Você ainda pode recuperar os dados que foram perdidos da região primária durante a janela de replicação.</span><span class="sxs-lookup"><span data-stu-id="f80ec-304">You might still recover the data that was lost from the primary region during the replication window.</span></span> <span data-ttu-id="f80ec-305">Também é possível mesclar com a região secundária posteriormente.</span><span class="sxs-lookup"><span data-stu-id="f80ec-305">You might also be able to merge with the secondary region later.</span></span>

<span data-ttu-id="f80ec-306">Os exemplos de arquitetura a seguir fornecem algumas ideias sobre diferentes maneiras de lidar com dados transacionais em um cenário de failover.</span><span class="sxs-lookup"><span data-stu-id="f80ec-306">The following architecture examples provide some ideas on different ways of handling transactional data in a failover scenario.</span></span> <span data-ttu-id="f80ec-307">É importante observar que esses exemplos não são exaustivos.</span><span class="sxs-lookup"><span data-stu-id="f80ec-307">It's important to note that these examples are not exhaustive.</span></span> <span data-ttu-id="f80ec-308">Por exemplo, locais de armazenamento intermediários, como filas, podem ser substituídos pelo Banco de Dados SQL do Azure.</span><span class="sxs-lookup"><span data-stu-id="f80ec-308">For example, intermediate storage locations such as queues might be replaced with Azure SQL Database.</span></span> <span data-ttu-id="f80ec-309">As próprias filas podem ser filas do Barramento de Serviço ou do Armazenamento do Microsoft Azure (confira [Filas do Azure e filas do Barramento de Serviço - comparações e contrastes](/azure/service-bus-messaging/service-bus-azure-and-service-bus-queues-compared-contrasted/)).</span><span class="sxs-lookup"><span data-stu-id="f80ec-309">The queues themselves might be either Azure Storage or Azure Service Bus queues (see [Azure queues and Service Bus queues - compared and contrasted](/azure/service-bus-messaging/service-bus-azure-and-service-bus-queues-compared-contrasted/)).</span></span> <span data-ttu-id="f80ec-310">Os destinos de armazenamento do servidor também podem variar, como tabelas do Azure em vez de Banco de Dados SQL.</span><span class="sxs-lookup"><span data-stu-id="f80ec-310">Server storage destinations might also vary, such as Azure tables instead of SQL Database.</span></span> <span data-ttu-id="f80ec-311">Além disso, funções de trabalho podem ser inseridas como intermediárias em várias etapas.</span><span class="sxs-lookup"><span data-stu-id="f80ec-311">In addition, worker roles might be inserted as intermediaries in various steps.</span></span> <span data-ttu-id="f80ec-312">O objetivo não é emular exatamente essas arquiteturas, mas levar em consideração várias alternativas na recuperação de dados transacionais e módulos relacionados.</span><span class="sxs-lookup"><span data-stu-id="f80ec-312">The intent is not to emulate these architectures exactly, but to consider various alternatives in the recovery of transactional data and related modules.</span></span>

#### <a name="replication-of-transactional-data-in-preparation-for-disaster-recovery"></a><span data-ttu-id="f80ec-313">Replicação de dados transacionais na preparação para recuperação de desastre</span><span class="sxs-lookup"><span data-stu-id="f80ec-313">Replication of transactional data in preparation for disaster recovery</span></span>
<span data-ttu-id="f80ec-314">Considere um aplicativo que usa filas do Armazenamento do Azure para manter dados transacionais.</span><span class="sxs-lookup"><span data-stu-id="f80ec-314">Consider an application that uses Azure Storage queues to hold transactional data.</span></span> <span data-ttu-id="f80ec-315">Isso permite que as funções de trabalho processem os dados transacionais no banco de dados do servidor em uma arquitetura desacoplada.</span><span class="sxs-lookup"><span data-stu-id="f80ec-315">This allows worker roles to process the transactional data to the server database in a decoupled architecture.</span></span> <span data-ttu-id="f80ec-316">Isso exige que as transações usem alguma forma de cache temporário se as funções front-end exigirem a consulta imediata desses dados.</span><span class="sxs-lookup"><span data-stu-id="f80ec-316">This requires the transactions to use some form of temporary caching if the front-end roles require the immediate query of that data.</span></span> <span data-ttu-id="f80ec-317">Dependendo do nível de tolerância à perda de dados, você pode optar por replicar as filas, o banco de dados ou todos os recursos de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="f80ec-317">Depending on the level of data-loss tolerance, you might choose to replicate the queues, the database, or all of the storage resources.</span></span> <span data-ttu-id="f80ec-318">Com apenas a replicação do banco de dados, se a região primária ficar inativa, você ainda poderá recuperar os dados nas filas quando a região primária voltar.</span><span class="sxs-lookup"><span data-stu-id="f80ec-318">With only database replication, if the primary region goes down, you can still recover the data in the queues when the primary region comes back.</span></span>

<span data-ttu-id="f80ec-319">O diagrama a seguir mostra uma arquitetura em que o banco de dados do servidor é sincronizado entre regiões.</span><span class="sxs-lookup"><span data-stu-id="f80ec-319">The following diagram shows an architecture where the server database is synchronized across regions.</span></span>

![Replicação de dados transacionais na preparação para recuperação de desastre](./images/disaster-recovery-azure-applications/replicate-transactional-data-in-preparation-for-disaster-recovery.png)

<span data-ttu-id="f80ec-321">O maior desafio para implementar essa arquitetura é a estratégia de replicação entre regiões.</span><span class="sxs-lookup"><span data-stu-id="f80ec-321">The biggest challenge to implementing this architecture is the replication strategy between regions.</span></span> <span data-ttu-id="f80ec-322">O serviço de [Sincronização de Dados SQL do Azure](/azure/sql-database/sql-database-get-started-sql-data-sync/) permite esse tipo de replicação.</span><span class="sxs-lookup"><span data-stu-id="f80ec-322">The [Azure SQL Data Sync](/azure/sql-database/sql-database-get-started-sql-data-sync/) service enables this type of replication.</span></span> <span data-ttu-id="f80ec-323">No momento em que este artigo foi escrito, o serviço está em versão prévia e não é recomendado para ambientes de produção.</span><span class="sxs-lookup"><span data-stu-id="f80ec-323">As of this writing, the service is in preview and is not yet recommended for production environments.</span></span> <span data-ttu-id="f80ec-324">Para saber mais, confira [Visão geral: continuidade de negócios em nuvem e recuperação de desastre do banco de dados com o banco de dados SQL](/azure/sql-database/sql-database-business-continuity/).</span><span class="sxs-lookup"><span data-stu-id="f80ec-324">For more information, see [Overview: Cloud business continuity and database disaster recovery with SQL Database](/azure/sql-database/sql-database-business-continuity/).</span></span> <span data-ttu-id="f80ec-325">Para aplicativos de produção, você deve investir em uma solução de terceiros ou criar sua própria lógica de replicação no código.</span><span class="sxs-lookup"><span data-stu-id="f80ec-325">For production applications, you must invest in a third-party solution or create your own replication logic in code.</span></span> <span data-ttu-id="f80ec-326">Dependendo da arquitetura, a replicação pode ser bidirecional, o que é mais complexo.</span><span class="sxs-lookup"><span data-stu-id="f80ec-326">Depending on the architecture, the replication might be bidirectional, which is more complex.</span></span>

<span data-ttu-id="f80ec-327">Uma implementação potencial pode fazer uso da fila intermediária no exemplo anterior.</span><span class="sxs-lookup"><span data-stu-id="f80ec-327">One potential implementation might make use of the intermediate queue in the previous example.</span></span> <span data-ttu-id="f80ec-328">A função de trabalho que processa os dados para o destino de armazenamento final pode fazer a alteração nas regiões primária e secundária.</span><span class="sxs-lookup"><span data-stu-id="f80ec-328">The worker role that processes the data to the final storage destination might make the change in both the primary region and the secondary region.</span></span> <span data-ttu-id="f80ec-329">Essas tarefas não são triviais e uma orientação completa para o código de replicação vai além do escopo deste artigo.</span><span class="sxs-lookup"><span data-stu-id="f80ec-329">These are not trivial tasks, and complete guidance for replication code is beyond the scope of this article.</span></span> <span data-ttu-id="f80ec-330">Invista tempo adequado e realize testes na abordagem para replicar dados para a região secundária.</span><span class="sxs-lookup"><span data-stu-id="f80ec-330">Invest significant time and testing into the approach for replicating data to the secondary region.</span></span> <span data-ttu-id="f80ec-331">Processamento e testes adicionais podem ajudar a garantir que os processos de failover e recuperação tratem corretamente quaisquer inconsistências de dados ou transações duplicadas possíveis.</span><span class="sxs-lookup"><span data-stu-id="f80ec-331">Additional processing and testing can help ensure that the failover and recovery processes correctly handle any possible data inconsistencies or duplicate transactions.</span></span>

> [!NOTE]
> <span data-ttu-id="f80ec-332">A maior parte deste documento se concentra na PaaS (plataforma como serviço).</span><span class="sxs-lookup"><span data-stu-id="f80ec-332">Most of this paper focuses on platform as a service (PaaS).</span></span> <span data-ttu-id="f80ec-333">No entanto, opções adicionais de replicação e disponibilidade para aplicativos híbridos usam as Máquinas Virtuais do Azure.</span><span class="sxs-lookup"><span data-stu-id="f80ec-333">However, additional replication and availability options for hybrid applications use Azure Virtual Machines.</span></span> <span data-ttu-id="f80ec-334">Esses aplicativos híbridos usam IaaS (infraestrutura como serviço) para hospedar o SQL Server em máquinas virtuais no Azure.</span><span class="sxs-lookup"><span data-stu-id="f80ec-334">These hybrid applications use infrastructure as a service (IaaS) to host SQL Server on virtual machines in Azure.</span></span> <span data-ttu-id="f80ec-335">Isso permite abordagens tradicionais de disponibilidade no SQL Server, como Grupos de Disponibilidade AlwaysOn ou Envio de Logs.</span><span class="sxs-lookup"><span data-stu-id="f80ec-335">This allows traditional availability approaches in SQL Server, such as AlwaysOn Availability Groups or Log Shipping.</span></span> <span data-ttu-id="f80ec-336">Algumas técnicas, como o AlwaysOn, funcionam apenas entre instâncias locais do SQL Server e máquinas virtuais do Azure.</span><span class="sxs-lookup"><span data-stu-id="f80ec-336">Some techniques, such as AlwaysOn, work only between on-premises SQL Server instances and Azure virtual machines.</span></span> <span data-ttu-id="f80ec-337">Para saber mais, confira [Alta disponibilidade e recuperação de desastres para o SQL Server em Máquinas Virtuais do Azure](/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr/).</span><span class="sxs-lookup"><span data-stu-id="f80ec-337">For more information, see [High availability and disaster recovery for SQL Server in Azure Virtual Machines](/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr/).</span></span>
> 
> 

#### <a name="reduced-application-functionality-for-transaction-capture"></a><span data-ttu-id="f80ec-338">Funcionalidade reduzida do aplicativo para a captura de transação</span><span class="sxs-lookup"><span data-stu-id="f80ec-338">Reduced application functionality for transaction capture</span></span>
<span data-ttu-id="f80ec-339">Considere uma segunda arquitetura que opera com funcionalidade reduzida.</span><span class="sxs-lookup"><span data-stu-id="f80ec-339">Consider a second architecture that operates with reduced functionality.</span></span> <span data-ttu-id="f80ec-340">O aplicativo na região secundária desativa toda a funcionalidade, como relatórios, BI (business intelligence) ou filas de drenagem.</span><span class="sxs-lookup"><span data-stu-id="f80ec-340">The application in the secondary region deactivates all the functionality, such as reporting, business intelligence (BI), or draining queues.</span></span> <span data-ttu-id="f80ec-341">Ele aceita apenas os tipos mais importantes de fluxos de trabalho transacionais, conforme definido pelos requisitos de negócios.</span><span class="sxs-lookup"><span data-stu-id="f80ec-341">It accepts only the most important types of transactional workflows, as defined by business requirements.</span></span> <span data-ttu-id="f80ec-342">O sistema captura as transações e as grava em filas.</span><span class="sxs-lookup"><span data-stu-id="f80ec-342">The system captures the transactions and writes them to queues.</span></span> <span data-ttu-id="f80ec-343">O sistema pode adiar o processamento de dados durante a fase inicial da interrupção do serviço.</span><span class="sxs-lookup"><span data-stu-id="f80ec-343">The system might postpone processing the data during the initial stage of the service disruption.</span></span> <span data-ttu-id="f80ec-344">Se o sistema na região primária for reativado dentro da janela de tempo esperada, as funções de trabalho na região primária poderão drenar as filas.</span><span class="sxs-lookup"><span data-stu-id="f80ec-344">If the system on the primary region is reactivated within the expected time window, the worker roles in the primary region can drain the queues.</span></span> <span data-ttu-id="f80ec-345">Esse processo elimina a necessidade de mesclar o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="f80ec-345">This process eliminates the need for database merging.</span></span> <span data-ttu-id="f80ec-346">Se a interrupção do serviço na região primária for além da janela tolerável, o aplicativo poderá iniciar o processamento das filas.</span><span class="sxs-lookup"><span data-stu-id="f80ec-346">If the primary region service disruption goes beyond the tolerable window, the application can start processing the queues.</span></span>

<span data-ttu-id="f80ec-347">Nesse cenário, o banco de dados na região secundária contém dados transacionais incrementais que devem ser mesclados depois que a região primária é reativada.</span><span class="sxs-lookup"><span data-stu-id="f80ec-347">In this scenario, the database in the secondary region contains incremental transactional data that must be merged after the primary is reactivated.</span></span> <span data-ttu-id="f80ec-348">O diagrama a seguir mostra essa estratégia para armazenar temporariamente dados transacionais até que a região primária seja restaurada.</span><span class="sxs-lookup"><span data-stu-id="f80ec-348">The following diagram shows this strategy for temporarily storing transactional data until the primary region is restored.</span></span>

![Funcionalidade reduzida do aplicativo para a captura de transação](./images/disaster-recovery-azure-applications/reduced-application-functionality-for-transaction-capture.png)

<span data-ttu-id="f80ec-350">Para saber mais sobre técnicas de gerenciamento de dados para aplicativos resilientes do Azure, confira [Failsafe: Guidance for Resilient Cloud Architectures](https://channel9.msdn.com/Series/FailSafe)(À prova de falhas: orientação para arquiteturas de nuvem resilientes).</span><span class="sxs-lookup"><span data-stu-id="f80ec-350">For more discussion of data management techniques for resilient Azure applications, see [Failsafe: Guidance for Resilient Cloud Architectures](https://channel9.msdn.com/Series/FailSafe).</span></span>

## <a name="deployment-topologies-for-disaster-recovery"></a><span data-ttu-id="f80ec-351">Topologias de implantação para recuperação de desastre</span><span class="sxs-lookup"><span data-stu-id="f80ec-351">Deployment topologies for disaster recovery</span></span>
<span data-ttu-id="f80ec-352">Você deve preparar aplicativos essenciais para lidar com interrupções de serviço em toda a região.</span><span class="sxs-lookup"><span data-stu-id="f80ec-352">You must prepare mission-critical applications to handle region-wide service disruptions.</span></span> <span data-ttu-id="f80ec-353">Incorpore uma estratégia de implantação em várias regiões ao planejamento operacional.</span><span class="sxs-lookup"><span data-stu-id="f80ec-353">Incorporate a multiple-region deployment strategy into the operational planning.</span></span>

<span data-ttu-id="f80ec-354">Implantações em várias regiões podem envolver processos de TI para publicar o aplicativo e os dados de referência na região secundária após um desastre.</span><span class="sxs-lookup"><span data-stu-id="f80ec-354">Multiple-region deployments might involve IT processes to publish the application and reference data to the secondary region after a disaster.</span></span> <span data-ttu-id="f80ec-355">Se o aplicativo exigir um failover instantâneo, o processo de implantação poderá envolver uma configuração ativo/passivo ou ativo/ativo.</span><span class="sxs-lookup"><span data-stu-id="f80ec-355">If the application requires instant failover, the deployment process might involve an active/passive setup or an active/active setup.</span></span> <span data-ttu-id="f80ec-356">Esse tipo de implantação tem instâncias existentes do aplicativo em execução na região alternativa.</span><span class="sxs-lookup"><span data-stu-id="f80ec-356">This type of deployment has existing instances of the application running in the alternate region.</span></span> <span data-ttu-id="f80ec-357">Um serviço de roteamento como o Gerenciador de Tráfego do Azure fornece serviços de balanceamento de carga no nível do DNS.</span><span class="sxs-lookup"><span data-stu-id="f80ec-357">A routing service such as Azure Traffic Manager provides load-balancing services at the DNS level.</span></span> <span data-ttu-id="f80ec-358">Ela pode detectar interrupções de serviço e encaminhar os usuários para diferentes regiões quando for necessário.</span><span class="sxs-lookup"><span data-stu-id="f80ec-358">It can detect service disruptions and route the users to different regions when needed.</span></span>

<span data-ttu-id="f80ec-359">Uma recuperação de desastre bem-sucedida no Azure inclui desenvolver essa recuperação na solução desde o início.</span><span class="sxs-lookup"><span data-stu-id="f80ec-359">A successful Azure disaster recovery includes building that recovery into the solution from the start.</span></span> <span data-ttu-id="f80ec-360">A nuvem oferece opções adicionais para se recuperar de falhas durante um desastre que não estão disponíveis em um provedor de hospedagem tradicional.</span><span class="sxs-lookup"><span data-stu-id="f80ec-360">The cloud provides additional options for recovering from failures during a disaster that are not available in a traditional hosting provider.</span></span> <span data-ttu-id="f80ec-361">Especificamente, você pode rápida e dinamicamente alocar recursos em uma região diferente, evitando o custo de recursos ociosos antes de uma falha.</span><span class="sxs-lookup"><span data-stu-id="f80ec-361">Specifically, you can dynamically and quickly allocate resources in a different region, avoiding the cost of idle resources prior to a failure.</span></span>

<span data-ttu-id="f80ec-362">As seções a seguir abrangem diferentes topologias de implantação para recuperação de desastre.</span><span class="sxs-lookup"><span data-stu-id="f80ec-362">The following sections cover different deployment topologies for disaster recovery.</span></span> <span data-ttu-id="f80ec-363">Normalmente, a disponibilidade adicional acarreta custos mais altos ou maior complexidade.</span><span class="sxs-lookup"><span data-stu-id="f80ec-363">Typically, there's a tradeoff in increased cost or complexity for additional availability.</span></span>

### <a name="single-region-deployment"></a><span data-ttu-id="f80ec-364">Implantação em uma região</span><span class="sxs-lookup"><span data-stu-id="f80ec-364">Single-region deployment</span></span>
<span data-ttu-id="f80ec-365">Uma implantação em uma região não é de fato uma topologia de recuperação de desastre, mas a finalidade é contrastar com as outras arquiteturas.</span><span class="sxs-lookup"><span data-stu-id="f80ec-365">A single-region deployment is not really a disaster recovery topology, but is meant to contrast with the other architectures.</span></span> <span data-ttu-id="f80ec-366">Implantações em regiões únicas são comuns para aplicativos no Azure. No entanto, elas não atendem os requisitos de uma topologia de recuperação de desastres.</span><span class="sxs-lookup"><span data-stu-id="f80ec-366">Single-region deployments are common for applications in Azure; however, they do not meet the requirements of a disaster recovery topology.</span></span>

<span data-ttu-id="f80ec-367">O diagrama a seguir mostra um aplicativo em execução em uma única região do Azure.</span><span class="sxs-lookup"><span data-stu-id="f80ec-367">The following diagram depicts an application running in a single Azure region.</span></span> <span data-ttu-id="f80ec-368">O Gerenciador de Tráfego do Azure e o uso de domínios de atualização e falha aumentam a disponibilidade do aplicativo na região.</span><span class="sxs-lookup"><span data-stu-id="f80ec-368">Azure Traffic Manager and the use of fault and upgrade domains increase availability of the application within the region.</span></span>

![Implantação em uma região](./images/disaster-recovery-azure-applications/single-region-deployment.png)

<span data-ttu-id="f80ec-370">Nesse cenário, o banco de dados é um único ponto de falha.</span><span class="sxs-lookup"><span data-stu-id="f80ec-370">In this scenario, the database is a single point of failure.</span></span> <span data-ttu-id="f80ec-371">Embora o Azure replique os dados em diferentes domínios de falha para réplicas internas, essa replicação ocorre apenas na mesma região.</span><span class="sxs-lookup"><span data-stu-id="f80ec-371">Though Azure replicates the data across different fault domains to internal replicas, this replication occurs only within the same region.</span></span> <span data-ttu-id="f80ec-372">O aplicativo não pode resistir a uma falha catastrófica.</span><span class="sxs-lookup"><span data-stu-id="f80ec-372">The application cannot withstand a catastrophic failure.</span></span> <span data-ttu-id="f80ec-373">Se a região tornar-se indisponível, todos os domínios de falha também ficarão, incluindo todas as instâncias de serviço e os recursos de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="f80ec-373">If the region becomes unavailable, then so do the fault domains, including all service instances and storage resources.</span></span>

<span data-ttu-id="f80ec-374">Para todos os aplicativos, exceto pelos menos críticos, você deve desenvolver um plano para implantar o aplicativo em várias regiões.</span><span class="sxs-lookup"><span data-stu-id="f80ec-374">For all but the least critical applications, you must devise a plan to deploy your applications across multiple regions.</span></span> <span data-ttu-id="f80ec-375">Você também deve levar em consideração as restrições de custo e RTO ao avaliar qual topologia de implantação usar.</span><span class="sxs-lookup"><span data-stu-id="f80ec-375">You should also consider RTO and cost constraints in considering which deployment topology to use.</span></span>

<span data-ttu-id="f80ec-376">Agora, vamos ver abordagens específicos para oferecer suporte ao failover em regiões diferentes.</span><span class="sxs-lookup"><span data-stu-id="f80ec-376">Let’s take a look now at specific approaches to supporting failover across different regions.</span></span> <span data-ttu-id="f80ec-377">Todos estes exemplos usam duas regiões para descrever o processo.</span><span class="sxs-lookup"><span data-stu-id="f80ec-377">These examples all use two regions to describe the process.</span></span>

### <a name="redeployment-to-a-secondary-azure-region"></a><span data-ttu-id="f80ec-378">Reimplantação em uma região secundária do Azure</span><span class="sxs-lookup"><span data-stu-id="f80ec-378">Redeployment to a secondary Azure region</span></span>
<span data-ttu-id="f80ec-379">Na abordagem de reimplantação em uma região secundária, somente a região primária tem aplicativos e bancos de dados em execução.</span><span class="sxs-lookup"><span data-stu-id="f80ec-379">For the approach of redeployment to a secondary region, only the primary region has applications and databases running.</span></span> <span data-ttu-id="f80ec-380">A região secundária não está configurada para um failover automático.</span><span class="sxs-lookup"><span data-stu-id="f80ec-380">The secondary region is not set up for an automatic failover.</span></span> <span data-ttu-id="f80ec-381">Assim, quando um desastre ocorrer, você precisará acionar todas as partes do serviço na nova região.</span><span class="sxs-lookup"><span data-stu-id="f80ec-381">So when a disaster occurs, you must spin up all the parts of the service in the new region.</span></span> <span data-ttu-id="f80ec-382">Isso inclui carregar um serviço de nuvem no Azure, implantar o serviço de nuvem, restaurar os dados e modificar o DNS para redirecionar o tráfego.</span><span class="sxs-lookup"><span data-stu-id="f80ec-382">This includes uploading a cloud service to Azure, deploying the cloud service, restoring the data, and changing DNS to reroute the traffic.</span></span>

<span data-ttu-id="f80ec-383">Embora se trate da mais acessível entre as opções de várias regiões, ela tem as piores características de RTO.</span><span class="sxs-lookup"><span data-stu-id="f80ec-383">Although this is the most affordable of the multiple-region options, it has the worst RTO characteristics.</span></span> <span data-ttu-id="f80ec-384">Nesse modelo, os backups de banco de dados e o pacote de serviço são armazenados localmente ou na instância de Armazenamento de Blobs do Azure da região secundária.</span><span class="sxs-lookup"><span data-stu-id="f80ec-384">In this model, the service package and database backups are stored either on-premises or in the Azure Blob storage instance of the secondary region.</span></span> <span data-ttu-id="f80ec-385">No entanto, você precisa implantar um novo serviço e restaurar os dados antes de retomar a operação.</span><span class="sxs-lookup"><span data-stu-id="f80ec-385">However, you must deploy a new service and restore the data before it resumes operation.</span></span> <span data-ttu-id="f80ec-386">Mesmo com total automação da transferência de dados do armazenamento de backup, o provisionamento de um novo ambiente de banco de dados consome muito tempo.</span><span class="sxs-lookup"><span data-stu-id="f80ec-386">Even with full automation of the data transfer from backup storage, provisioning a new database environment consumes a lot of time.</span></span> <span data-ttu-id="f80ec-387">A parte mais cara do processo de restauração é mover os dados do armazenamento de backup em disco para o banco de dados vazio na região secundária.</span><span class="sxs-lookup"><span data-stu-id="f80ec-387">Moving data from the backup disk storage to the empty database on the secondary region is the most expensive part of the restore process.</span></span> <span data-ttu-id="f80ec-388">No entanto, você precisa fazer isso para colocar o novo banco de dados em um estado operacional, pois ele não é replicado.</span><span class="sxs-lookup"><span data-stu-id="f80ec-388">You must do this, however, to bring the new database to an operational state because it isn't replicated.</span></span>

<span data-ttu-id="f80ec-389">A melhor abordagem é armazenar os pacotes de serviço no armazenamento de Blobs na região secundária.</span><span class="sxs-lookup"><span data-stu-id="f80ec-389">The best approach is to store the service packages in Blob storage in the secondary region.</span></span> <span data-ttu-id="f80ec-390">Isso elimina a necessidade de carregar o pacote no Azure, que é o que acontece quando você implanta por meio de uma máquina de desenvolvimento local.</span><span class="sxs-lookup"><span data-stu-id="f80ec-390">This eliminates the need to upload the package to Azure, which is what happens when you deploy from an on-premises development machine.</span></span> <span data-ttu-id="f80ec-391">Você pode implantar rapidamente os pacotes de serviço em um novo serviço de nuvem por meio do armazenamento de blobs usando scripts do PowerShell.</span><span class="sxs-lookup"><span data-stu-id="f80ec-391">You can quickly deploy the service packages to a new cloud service from Blob storage by using PowerShell scripts.</span></span>

<span data-ttu-id="f80ec-392">Essa opção é prática apenas para aplicativos não críticos que podem tolerar um RTO alto.</span><span class="sxs-lookup"><span data-stu-id="f80ec-392">This option is practical only for non-critical applications that can tolerate a high RTO.</span></span> <span data-ttu-id="f80ec-393">Por exemplo, pode funcionar para um aplicativo que pode ficar inativo por várias horas, mas precisa estar disponível dentro de 24 horas.</span><span class="sxs-lookup"><span data-stu-id="f80ec-393">For instance, this might work for an application that can be down for several hours but is required to be available within 24 hours.</span></span>

![Reimplantação em uma região secundária do Azure](./images/disaster-recovery-azure-applications/redeploy-to-a-secondary-azure-region.png)

### <a name="active-passive"></a><span data-ttu-id="f80ec-395">Ativo-passivo</span><span class="sxs-lookup"><span data-stu-id="f80ec-395">Active-passive</span></span>
<span data-ttu-id="f80ec-396">Uma topologia ativo-passivo é a opção preferida por muitas empresas.</span><span class="sxs-lookup"><span data-stu-id="f80ec-396">An active-passive topology is the choice that many companies favor.</span></span> <span data-ttu-id="f80ec-397">Essa topologia traz melhorias ao RTO com um aumento relativamente pequeno do custo com relação à abordagem de reimplantação.</span><span class="sxs-lookup"><span data-stu-id="f80ec-397">This topology provides improvements to the RTO with a relatively small increase in cost over the redeployment approach.</span></span> <span data-ttu-id="f80ec-398">Nesse cenário, há novamente uma região principal e uma região secundária do Azure.</span><span class="sxs-lookup"><span data-stu-id="f80ec-398">In this scenario, there is again a primary and a secondary Azure region.</span></span> <span data-ttu-id="f80ec-399">Todo o tráfego vai para a implantação ativa na região primária.</span><span class="sxs-lookup"><span data-stu-id="f80ec-399">All of the traffic goes to the active deployment on the primary region.</span></span> <span data-ttu-id="f80ec-400">A região secundária está melhor preparada para recuperação de desastre, pois o banco de dados está sendo executado em ambas as regiões.</span><span class="sxs-lookup"><span data-stu-id="f80ec-400">The secondary region is better prepared for disaster recovery because the database is running on both regions.</span></span> <span data-ttu-id="f80ec-401">Além disso, um mecanismo de sincronização está definido entre elas.</span><span class="sxs-lookup"><span data-stu-id="f80ec-401">Additionally, a synchronization mechanism is in place between them.</span></span> <span data-ttu-id="f80ec-402">Essa abordagem de espera pode envolver duas variações: uma abordagem apenas de banco de dados ou uma implantação completa na região secundária.</span><span class="sxs-lookup"><span data-stu-id="f80ec-402">This standby approach can involve two variations: a database-only approach or a complete deployment in the secondary region.</span></span>

#### <a name="database-only"></a><span data-ttu-id="f80ec-403">Apenas banco de dados</span><span class="sxs-lookup"><span data-stu-id="f80ec-403">Database only</span></span>
<span data-ttu-id="f80ec-404">Na primeira variação da topologia ativo-passivo, somente a região primária tem um aplicativo de serviço de nuvem implantado.</span><span class="sxs-lookup"><span data-stu-id="f80ec-404">In the first variation of the active-passive topology, only the primary region has a deployed cloud service application.</span></span> <span data-ttu-id="f80ec-405">No entanto, diferentemente da topologia de reimplantação, ambas as regiões são sincronizadas com o conteúdo do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="f80ec-405">However, unlike the redeployment approach, both regions are synchronized with the contents of the database.</span></span> <span data-ttu-id="f80ec-406">(Para saber mais, confira a seção sobre o [padrão de dados transacionais para recuperação de desastre](#transactional-data-pattern-for-disaster-recovery)). Quando ocorre um desastre, há menos requisitos de ativação.</span><span class="sxs-lookup"><span data-stu-id="f80ec-406">(For more information, see the section on [transactional data pattern for disaster recovery](#transactional-data-pattern-for-disaster-recovery).) When a disaster occurs, there are fewer activation requirements.</span></span> <span data-ttu-id="f80ec-407">Você iniciar o aplicativo na região secundária, muda cadeias de conexão para o novo banco de dados e altera as entradas DNS para redirecionar o tráfego.</span><span class="sxs-lookup"><span data-stu-id="f80ec-407">You start the application in the secondary region, change connection strings to the new database, and change the DNS entries to reroute traffic.</span></span>

<span data-ttu-id="f80ec-408">Assim como a abordagem de reimplantação, você já deve ter armazenado os pacotes de serviço no armazenamento de Blobs do Azure na região secundária para uma implantação mais rápida.</span><span class="sxs-lookup"><span data-stu-id="f80ec-408">Like the redeployment approach, you should have already stored the service packages in Azure Blob storage in the secondary region for faster deployment.</span></span> <span data-ttu-id="f80ec-409">No entanto, você não sofre a maioria da sobrecarga que as operações de restauração de banco de dados requerem, porque o banco de dados está pronto e em operação.</span><span class="sxs-lookup"><span data-stu-id="f80ec-409">However, you don’t incur the majority of the overhead that database restore operation requires, because the database is ready and running.</span></span> <span data-ttu-id="f80ec-410">Isso economiza um tempo significativo, o que faz desse um padrão de DR acessível (e o usado com mais frequência).</span><span class="sxs-lookup"><span data-stu-id="f80ec-410">This saves a significant amount of time, making this an affordable DR pattern (and the one most frequently used).</span></span>

![Ativo-passivo, somente banco de dados](./images/disaster-recovery-azure-applications/active-passive-database-only.png)

#### <a name="full-replica"></a><span data-ttu-id="f80ec-412">Réplica completa</span><span class="sxs-lookup"><span data-stu-id="f80ec-412">Full replica</span></span>
<span data-ttu-id="f80ec-413">Na segunda variação da topologia ativo-passivo, a região principal e a secundária têm uma implantação completa.</span><span class="sxs-lookup"><span data-stu-id="f80ec-413">In the second variation of the active-passive topology, both the primary region and the secondary region have a full deployment.</span></span> <span data-ttu-id="f80ec-414">Essa implantação inclui os serviços de nuvem e um banco de dados sincronizado.</span><span class="sxs-lookup"><span data-stu-id="f80ec-414">This deployment includes the cloud services and a synchronized database.</span></span> <span data-ttu-id="f80ec-415">No entanto, somente a região primária processa ativamente solicitações de rede dos usuários.</span><span class="sxs-lookup"><span data-stu-id="f80ec-415">However, only the primary region is actively handling network requests from the users.</span></span> <span data-ttu-id="f80ec-416">A região secundária se torna ativa apenas quando a região primária apresentar uma interrupção do serviço.</span><span class="sxs-lookup"><span data-stu-id="f80ec-416">The secondary region becomes active only when the primary region experiences a service disruption.</span></span> <span data-ttu-id="f80ec-417">Nesse caso, todas as novas solicitações de rede são encaminhadas para a região secundária.</span><span class="sxs-lookup"><span data-stu-id="f80ec-417">In that case, all new network requests route to the secondary region.</span></span> <span data-ttu-id="f80ec-418">O Gerenciador de Tráfego do Azure pode gerenciar esse failover automaticamente.</span><span class="sxs-lookup"><span data-stu-id="f80ec-418">Azure Traffic Manager can manage this failover automatically.</span></span>

<span data-ttu-id="f80ec-419">O failover ocorre mais rapidamente do que na variação apenas de banco de dados, pois os serviços já foram implantados.</span><span class="sxs-lookup"><span data-stu-id="f80ec-419">Failover occurs faster than the database-only variation because the services are already deployed.</span></span> <span data-ttu-id="f80ec-420">Essa topologia fornece um RTO muito baixo.</span><span class="sxs-lookup"><span data-stu-id="f80ec-420">This topology provides a very low RTO.</span></span> <span data-ttu-id="f80ec-421">A região secundária do failover deve estar pronta para entrar em atividade imediatamente após a falha da região primária.</span><span class="sxs-lookup"><span data-stu-id="f80ec-421">The secondary failover region must be ready to go immediately after failure of the primary region.</span></span>

<span data-ttu-id="f80ec-422">Juntamente com um tempo de resposta mais rápido, essa topologia pré-aloca e implanta serviços de backup, evitando a possibilidade de falta de espaço para alocar novas instâncias durante um desastre.</span><span class="sxs-lookup"><span data-stu-id="f80ec-422">Along with a quicker response time, this topology pre-allocates and deploys backup services, avoiding the possibility of a lack of space to allocate new instances during a disaster.</span></span> <span data-ttu-id="f80ec-423">Isso é importante se a sua região secundária do Azure está se aproximando da capacidade total.</span><span class="sxs-lookup"><span data-stu-id="f80ec-423">This is important if your secondary Azure region is nearing capacity.</span></span> <span data-ttu-id="f80ec-424">Nenhum contrato de nível de serviço (SLA) garante que você possa imediatamente implantar um ou mais novos serviços em nuvem em qualquer região.</span><span class="sxs-lookup"><span data-stu-id="f80ec-424">No service-level agreement (SLA) guarantees that you can instantly deploy one or more new cloud services in any region.</span></span>

<span data-ttu-id="f80ec-425">Para ter tempo de resposta mais rápido com esse modelo, você precisa ter escalas (número de instâncias de função) semelhantes nas regiões primária e secundária.</span><span class="sxs-lookup"><span data-stu-id="f80ec-425">For the fastest response time with this model, you must have similar scale (number of role instances) in the primary and secondary regions.</span></span> <span data-ttu-id="f80ec-426">Apesar das vantagens, pagar por instâncias de computação não utilizadas é caro, e pode não ser a opção financeira mais aconselhável.</span><span class="sxs-lookup"><span data-stu-id="f80ec-426">Despite the advantages, paying for unused compute instances is costly, and this might not be the most prudent financial choice.</span></span> <span data-ttu-id="f80ec-427">Por isso, é mais comum usar uma versão um pouco reduzida dos serviços de nuvem na região secundária.</span><span class="sxs-lookup"><span data-stu-id="f80ec-427">Because of this, it's more common to use a slightly scaled-down version of cloud services on the secondary region.</span></span> <span data-ttu-id="f80ec-428">Dessa forma, você poderá fazer o failover rapidamente e escalar horizontalmente a implantação secundária se for necessário.</span><span class="sxs-lookup"><span data-stu-id="f80ec-428">Then you can quickly fail over and scale out the secondary deployment if necessary.</span></span> <span data-ttu-id="f80ec-429">Você deve automatizar o processo de failover para que, depois que a região primária estiver inacessível, seja possível ativar instâncias adicionais, dependendo da carga.</span><span class="sxs-lookup"><span data-stu-id="f80ec-429">You should automate the failover process so that after the primary region is inaccessible, you activate additional instances, depending on the load.</span></span> <span data-ttu-id="f80ec-430">Isso pode envolver o uso de um mecanismo de dimensionamento automático, como os [conjuntos de escalas de máquina virtual](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview/).</span><span class="sxs-lookup"><span data-stu-id="f80ec-430">This might involve the use of an autoscaling mechanism like [virtual machine scale sets](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview/).</span></span>

<span data-ttu-id="f80ec-431">O diagrama a seguir mostra o modelo em que as regiões primária e secundária contêm um serviço de nuvem totalmente implantado em uma topologia de ativo-passivo.</span><span class="sxs-lookup"><span data-stu-id="f80ec-431">The following diagram shows the model where the primary and secondary regions contain a fully deployed cloud service in an active-passive topology.</span></span>

![Ativo-passivo, réplica completa](./images/disaster-recovery-azure-applications/active-passive-full-replica.png)

### <a name="active-active"></a><span data-ttu-id="f80ec-433">Ativo-ativo</span><span class="sxs-lookup"><span data-stu-id="f80ec-433">Active-active</span></span>
<span data-ttu-id="f80ec-434">Em uma topologia de ativo-ativo, o banco de dados e os serviços de nuvem são totalmente implantados nas duas regiões.</span><span class="sxs-lookup"><span data-stu-id="f80ec-434">In an active-active topology, the cloud services and database are fully deployed in both regions.</span></span> <span data-ttu-id="f80ec-435">Diferente do modelo ativo-passivo, as duas regiões recebem tráfego de usuários.</span><span class="sxs-lookup"><span data-stu-id="f80ec-435">Unlike the active-passive model, both regions receive user traffic.</span></span> <span data-ttu-id="f80ec-436">Esta opção gera o tempo de recuperação mais rápido.</span><span class="sxs-lookup"><span data-stu-id="f80ec-436">This option yields the quickest recovery time.</span></span> <span data-ttu-id="f80ec-437">Os serviços já estão dimensionados para lidar com parte da carga em cada região.</span><span class="sxs-lookup"><span data-stu-id="f80ec-437">The services are already scaled to handle a portion of the load at each region.</span></span> <span data-ttu-id="f80ec-438">O DNS já está habilitado para usar a região secundária.</span><span class="sxs-lookup"><span data-stu-id="f80ec-438">DNS is already enabled to use the secondary region.</span></span> <span data-ttu-id="f80ec-439">Há uma complexidade adicional para determinar como encaminhar os usuários para a região apropriada.</span><span class="sxs-lookup"><span data-stu-id="f80ec-439">There's additional complexity in determining how to route users to the appropriate region.</span></span> <span data-ttu-id="f80ec-440">O agendamento em round robin pode ser possível.</span><span class="sxs-lookup"><span data-stu-id="f80ec-440">Round-robin scheduling might be possible.</span></span> <span data-ttu-id="f80ec-441">É mais provável que determinados usuários usem uma região específica onde reside a cópia primária de seus dados.</span><span class="sxs-lookup"><span data-stu-id="f80ec-441">It's more likely that certain users would use a specific region where the primary copy of their data resides.</span></span>

<span data-ttu-id="f80ec-442">No caso de failover, basta desabilitar o DNS para a região primária.</span><span class="sxs-lookup"><span data-stu-id="f80ec-442">In case of failover, simply disable DNS to the primary region.</span></span> <span data-ttu-id="f80ec-443">Isso roteia todo o tráfego para a região secundária.</span><span class="sxs-lookup"><span data-stu-id="f80ec-443">This routes all traffic to the secondary region.</span></span>

<span data-ttu-id="f80ec-444">Mesmo nesse modelo, há algumas variações.</span><span class="sxs-lookup"><span data-stu-id="f80ec-444">Even in this model, there are some variations.</span></span> <span data-ttu-id="f80ec-445">Por exemplo, o diagrama a seguir ilustra uma região primária que possui a cópia mestra do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="f80ec-445">For example, the following diagram depicts a primary region which owns the master copy of the database.</span></span> <span data-ttu-id="f80ec-446">Os serviços de nuvem nas duas regiões são gravados nesse banco de dados primário.</span><span class="sxs-lookup"><span data-stu-id="f80ec-446">The cloud services in both regions write to that primary database.</span></span> <span data-ttu-id="f80ec-447">A implantação secundária pode ler do banco de dados primário ou do replicado.</span><span class="sxs-lookup"><span data-stu-id="f80ec-447">The secondary deployment can read from the primary or replicated database.</span></span> <span data-ttu-id="f80ec-448">A replicação neste exemplo é unidirecional.</span><span class="sxs-lookup"><span data-stu-id="f80ec-448">Replication in this example is one-way.</span></span>

![Ativo-ativo](./images/disaster-recovery-azure-applications/active-active.png)

<span data-ttu-id="f80ec-450">Há uma desvantagem na arquitetura com padrão ativo-ativo no diagrama anterior.</span><span class="sxs-lookup"><span data-stu-id="f80ec-450">There is a downside to the active-active architecture in the preceding diagram.</span></span> <span data-ttu-id="f80ec-451">A segunda região precisa acessar o banco de dados na primeira região porque a cópia mestra reside nele.</span><span class="sxs-lookup"><span data-stu-id="f80ec-451">The second region must access the database in the first region because the master copy resides there.</span></span> <span data-ttu-id="f80ec-452">O desempenho é reduzido significativamente quando você acessa dados fora de uma região.</span><span class="sxs-lookup"><span data-stu-id="f80ec-452">Performance significantly drops off when you access data from outside a region.</span></span> <span data-ttu-id="f80ec-453">Em chamadas de banco de dados entre regiões, você precisa considerar algum tipo de estratégia de envio em lote para melhorar o desempenho dessas chamadas.</span><span class="sxs-lookup"><span data-stu-id="f80ec-453">In cross-region database calls, you should consider some type of batching strategy to improve the performance of these calls.</span></span> <span data-ttu-id="f80ec-454">Para saber mais, confira [Como usar o envio em lote para melhorar o desempenho do aplicativo Banco de Dados SQL](/azure/sql-database/sql-database-use-batching-to-improve-performance/).</span><span class="sxs-lookup"><span data-stu-id="f80ec-454">For more information, see [How to use batching to improve SQL Database application performance](/azure/sql-database/sql-database-use-batching-to-improve-performance/).</span></span>

<span data-ttu-id="f80ec-455">Uma arquitetura alternativa pode envolver cada região acessando seu próprio banco de dados diretamente.</span><span class="sxs-lookup"><span data-stu-id="f80ec-455">An alternative architecture might involve each region accessing its own database directly.</span></span> <span data-ttu-id="f80ec-456">Nesse modelo, é necessário algum tipo de replicação bidirecional para sincronizar os bancos de dados em cada região.</span><span class="sxs-lookup"><span data-stu-id="f80ec-456">In that model, some type of bidirectional replication is required to synchronize the databases in each region.</span></span>

<span data-ttu-id="f80ec-457">Com as topologias anteriores, a diminuição do RTO geralmente aumenta a complexidade e os custos.</span><span class="sxs-lookup"><span data-stu-id="f80ec-457">With the previous topologies, decreasing RTO generally increases costs and complexity.</span></span> <span data-ttu-id="f80ec-458">A topologia de ativo-ativo desvia desse padrão de custo.</span><span class="sxs-lookup"><span data-stu-id="f80ec-458">The active-active topology deviates from this cost pattern.</span></span> <span data-ttu-id="f80ec-459">Na topologia de ativo-ativo, talvez não sejam necessárias tantas instâncias na região primária quanto seriam necessárias na topologia de ativo-passivo.</span><span class="sxs-lookup"><span data-stu-id="f80ec-459">In the active-active topology, you might not need as many instances on the primary region as you would in the active-passive topology.</span></span> <span data-ttu-id="f80ec-460">Se você tiver 10 instâncias na região primária em uma arquitetura com padrão ativo-passivo, talvez seja preciso apenas 5 em cada região em uma arquitetura com padrão ativo-ativo.</span><span class="sxs-lookup"><span data-stu-id="f80ec-460">If you have 10 instances on the primary region in an active-passive architecture, you might need only 5 in each region in an active-active architecture.</span></span> <span data-ttu-id="f80ec-461">Agora, as duas regiões compartilham a carga.</span><span class="sxs-lookup"><span data-stu-id="f80ec-461">Both regions now share the load.</span></span> <span data-ttu-id="f80ec-462">Isso pode representar uma economia de custos em relação à topologia de ativo-passivo se você mantiver uma espera passiva na região passiva, com 10 instâncias esperando o failover.</span><span class="sxs-lookup"><span data-stu-id="f80ec-462">This might be a cost savings over the active-passive topology if you keep a warm standby on the passive region with 10 instances waiting for failover.</span></span>

<span data-ttu-id="f80ec-463">Observe que, até que você restaure a região primária, a região secundária pode receber um aumento repentino de novos usuários.</span><span class="sxs-lookup"><span data-stu-id="f80ec-463">Realize that until you restore the primary region, the secondary region might receive a sudden surge of new users.</span></span> <span data-ttu-id="f80ec-464">Se houver 10.000 usuários em cada servidor quando a região primária sofrer uma interrupção do serviço, a região secundária subitamente precisará lidar com 20.000 usuários.</span><span class="sxs-lookup"><span data-stu-id="f80ec-464">If there are 10,000 users on each server when the primary region experiences a service disruption, the secondary region suddenly has to handle 20,000 users.</span></span> <span data-ttu-id="f80ec-465">Regras de monitoramento na região secundária devem detectar esse aumento e dobrar as instâncias na região secundária.</span><span class="sxs-lookup"><span data-stu-id="f80ec-465">Monitoring rules on the secondary region must detect this increase and double the instances in the secondary region.</span></span> <span data-ttu-id="f80ec-466">Para saber mais sobre isso, confira a seção sobre [detecção de falhas](#failure-detection).</span><span class="sxs-lookup"><span data-stu-id="f80ec-466">For more information on this, see the section on [failure detection](#failure-detection).</span></span>

## <a name="hybrid-on-premises-and-cloud-solution"></a><span data-ttu-id="f80ec-467">solução híbrida local e na nuvem</span><span class="sxs-lookup"><span data-stu-id="f80ec-467">Hybrid on-premises and cloud solution</span></span>
<span data-ttu-id="f80ec-468">Uma estratégia adicional para a recuperação de desastres é criar um aplicativo híbrido que é executado localmente e na nuvem.</span><span class="sxs-lookup"><span data-stu-id="f80ec-468">One additional strategy for disaster recovery is to architect a hybrid application that runs on-premises and in the cloud.</span></span> <span data-ttu-id="f80ec-469">Dependendo do aplicativo, a região primária pode ser qualquer um desses locais.</span><span class="sxs-lookup"><span data-stu-id="f80ec-469">Depending on the application, the primary region might be either location.</span></span> <span data-ttu-id="f80ec-470">Considere as arquiteturas anteriores e imagine a região primária ou secundária como local.</span><span class="sxs-lookup"><span data-stu-id="f80ec-470">Consider the previous architectures and imagine the primary or secondary region as an on-premises location.</span></span>

<span data-ttu-id="f80ec-471">Há alguns desafios nessas arquiteturas híbridas.</span><span class="sxs-lookup"><span data-stu-id="f80ec-471">There are some challenges in these hybrid architectures.</span></span> <span data-ttu-id="f80ec-472">Em primeiro lugar, a maior parte deste artigo abordou padrões da arquitetura PaaS.</span><span class="sxs-lookup"><span data-stu-id="f80ec-472">First, most of this article has addressed PaaS architecture patterns.</span></span> <span data-ttu-id="f80ec-473">Aplicativos típicos de PaaS no Azure dependem de construções específicas do Azure, como funções, serviços de nuvem e Gerenciador de Tráfego.</span><span class="sxs-lookup"><span data-stu-id="f80ec-473">Typical PaaS applications in Azure rely on Azure-specific constructs such as roles, cloud services, and Traffic Manager.</span></span> <span data-ttu-id="f80ec-474">A criação de uma solução local para esse tipo de aplicativo PaaS exigiria uma arquitetura consideravelmente diferente.</span><span class="sxs-lookup"><span data-stu-id="f80ec-474">Creating an on-premises solution for this type of PaaS application would require a significantly different architecture.</span></span> <span data-ttu-id="f80ec-475">Isso pode não ser viável do ponto de vista do gerenciamento ou do custo.</span><span class="sxs-lookup"><span data-stu-id="f80ec-475">This might not be feasible from a management or cost perspective.</span></span>

<span data-ttu-id="f80ec-476">No entanto, uma solução híbrida para recuperação de desastre tem menos desafios para arquiteturas tradicionais que foram movidas para a nuvem, como arquiteturas baseadas em IaaS.</span><span class="sxs-lookup"><span data-stu-id="f80ec-476">However, a hybrid solution for disaster recovery has fewer challenges for traditional architectures that have been migrated to the cloud, such as IaaS-based architectures.</span></span> <span data-ttu-id="f80ec-477">Aplicativos de IaaS usam máquinas virtuais na nuvem que podem ter equivalentes diretos locais.</span><span class="sxs-lookup"><span data-stu-id="f80ec-477">IaaS applications use virtual machines in the cloud that can have direct on-premises equivalents.</span></span> <span data-ttu-id="f80ec-478">Você também pode usar redes virtuais para conectar computadores na nuvem com os recursos de rede locais.</span><span class="sxs-lookup"><span data-stu-id="f80ec-478">You can also use virtual networks to connect machines in the cloud with on-premises network resources.</span></span> <span data-ttu-id="f80ec-479">Isso permite que haja várias possibilidades que não são possíveis com aplicativos somente PaaS.</span><span class="sxs-lookup"><span data-stu-id="f80ec-479">This allows several possibilities that are not possible with PaaS-only applications.</span></span> <span data-ttu-id="f80ec-480">Por exemplo, o SQL Server aproveitar soluções de recuperação de desastre como os Grupos de Disponibilidade AlwaysOn e o espelhamento de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="f80ec-480">For example, SQL Server can take advantage of disaster recovery solutions such as AlwaysOn Availability Groups and database mirroring.</span></span> <span data-ttu-id="f80ec-481">Para obter detalhes, confira [Alta disponibilidade e recuperação de desastre para SQL Server nas Máquinas Virtuais do Azure](/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr/).</span><span class="sxs-lookup"><span data-stu-id="f80ec-481">For details, see [High availability and disaster recovery for SQL Server in Azure virtual machines](/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr/).</span></span>

<span data-ttu-id="f80ec-482">Soluções de IaaS também oferecem um caminho mais fácil para aplicativos locais usarem o Azure como a opção de failover.</span><span class="sxs-lookup"><span data-stu-id="f80ec-482">IaaS solutions also provide an easier path for on-premises applications to use Azure as the failover option.</span></span> <span data-ttu-id="f80ec-483">Você pode ter um aplicativo totalmente funcional em uma região local existente.</span><span class="sxs-lookup"><span data-stu-id="f80ec-483">You might have a fully functioning application in an existing on-premises region.</span></span> <span data-ttu-id="f80ec-484">No entanto, o que acontecerá se você não tiver os recursos para manter uma região separada geograficamente para failover?</span><span class="sxs-lookup"><span data-stu-id="f80ec-484">However, what if you lack the resources to maintain a geographically separate region for failover?</span></span> <span data-ttu-id="f80ec-485">Você pode optar por usar redes virtuais e máquinas virtuais para executar seu aplicativo no Azure.</span><span class="sxs-lookup"><span data-stu-id="f80ec-485">You might decide to use virtual machines and virtual networks to get your application running in Azure.</span></span> <span data-ttu-id="f80ec-486">Nesse caso, defina processos que sincronizem os dados com a nuvem.</span><span class="sxs-lookup"><span data-stu-id="f80ec-486">In that case, define processes that synchronize data to the cloud.</span></span> <span data-ttu-id="f80ec-487">A implantação do Azure se torna a região secundária a ser usada para failover.</span><span class="sxs-lookup"><span data-stu-id="f80ec-487">The Azure deployment then becomes the secondary region to use for failover.</span></span> <span data-ttu-id="f80ec-488">A região primária permanece como o aplicativo local.</span><span class="sxs-lookup"><span data-stu-id="f80ec-488">The primary region remains the on-premises application.</span></span> <span data-ttu-id="f80ec-489">Para saber mais sobre os recursos e arquiteturas de IaaS, confira a [documentação das Máquinas Virtuais](https://azure.microsoft.com/documentation/services/virtual-machines/).</span><span class="sxs-lookup"><span data-stu-id="f80ec-489">For more information about IaaS architectures and capabilities, see the [Virtual Machines documentation](https://azure.microsoft.com/documentation/services/virtual-machines/).</span></span>

## <a name="alternative-cloud"></a><span data-ttu-id="f80ec-490">Nuvem alternativa</span><span class="sxs-lookup"><span data-stu-id="f80ec-490">Alternative cloud</span></span>
<span data-ttu-id="f80ec-491">Há situações em que os recursos abrangentes do Microsoft Azure ainda não conseguem atender às regras ou políticas internas de conformidade exigidas pela sua organização.</span><span class="sxs-lookup"><span data-stu-id="f80ec-491">There are situations where the broad capabilities of Microsoft Azure still may not meet internal compliance rules or policies required by your organization.</span></span> <span data-ttu-id="f80ec-492">Até mesmo a melhor preparação e o melhor design para implementar sistemas de backup durante um desastre são inadequadas durante uma interrupção global do serviço de um provedor de serviços de nuvem.</span><span class="sxs-lookup"><span data-stu-id="f80ec-492">Even the best preparation and design to implement backup systems during a disaster are inadequate during a global service disruption of a cloud service provider.</span></span>

<span data-ttu-id="f80ec-493">É recomendável comparar os requisitos de disponibilidade com o custo e a complexidade da maior disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="f80ec-493">You should compare availability requirements with the cost and complexity of increased availability.</span></span> <span data-ttu-id="f80ec-494">Faça uma análise de risco e definia o RTO e o RPO para sua solução.</span><span class="sxs-lookup"><span data-stu-id="f80ec-494">Perform a risk analysis, and define the RTO and RPO for your solution.</span></span> <span data-ttu-id="f80ec-495">Se seu aplicativo não puder tolerar nenhum tempo de inatividade, é recomendável considerar uma solução de nuvem adicional.</span><span class="sxs-lookup"><span data-stu-id="f80ec-495">If your application cannot tolerate any downtime, you might consider using an additional cloud solution.</span></span> <span data-ttu-id="f80ec-496">A menos que a Internet inteira fique inativa, outra solução de nuvem ainda poderá estar disponível se o Azure se tornar inacessível globalmente.</span><span class="sxs-lookup"><span data-stu-id="f80ec-496">Unless the entire Internet goes down, another cloud solution might still be available if Azure becomes globally inaccessible.</span></span>

<span data-ttu-id="f80ec-497">Assim como no cenário híbrido, as implantações de failover nas arquiteturas de recuperação de desastre anteriores também podem existir em outra solução de nuvem.</span><span class="sxs-lookup"><span data-stu-id="f80ec-497">As with the hybrid scenario, the failover deployments in the previous disaster recovery architectures can also exist within another cloud solution.</span></span> <span data-ttu-id="f80ec-498">Sites alternativos de DR de nuvem devem ser usados para soluções com um RTO que permita muito pouco, se algum, tempo de inatividade.</span><span class="sxs-lookup"><span data-stu-id="f80ec-498">Alternative cloud DR sites should be used only for solutions whose RTO allows very little, if any, downtime.</span></span> <span data-ttu-id="f80ec-499">Observe que uma solução que usa um site de DR fora do Azure exigirá mais trabalho para ser configurada, desenvolvida, implantada e mantida.</span><span class="sxs-lookup"><span data-stu-id="f80ec-499">Note that a solution that uses a DR site outside Azure will require more work to configure, develop, deploy, and maintain.</span></span> <span data-ttu-id="f80ec-500">Também é mais difícil implementar práticas comprovadas em arquiteturas entre nuvens.</span><span class="sxs-lookup"><span data-stu-id="f80ec-500">It's also more difficult to implement proven practices in a cross-cloud architecture.</span></span> <span data-ttu-id="f80ec-501">Embora plataformas de nuvem tenham conceitos gerais semelhantes, as APIs e arquiteturas são diferentes.</span><span class="sxs-lookup"><span data-stu-id="f80ec-501">Although cloud platforms have similar high-level concepts, the APIs and architectures are different.</span></span>

<span data-ttu-id="f80ec-502">Se sua estratégia de recuperação de desastres depende de várias plataformas de nuvem, é importante incluir camadas de abstração no design da solução.</span><span class="sxs-lookup"><span data-stu-id="f80ec-502">If your DR strategy relies upon multiple cloud platforms, it's valuable to include abstraction layers in the design of the solution.</span></span> <span data-ttu-id="f80ec-503">Isso elimina a necessidade de desenvolver e manter duas versões diferentes do mesmo aplicativo para diferentes plataformas de nuvem em caso de desastre.</span><span class="sxs-lookup"><span data-stu-id="f80ec-503">This eliminates the need to develop and maintain two different versions of the same application for different cloud platforms in case of disaster.</span></span> <span data-ttu-id="f80ec-504">Assim como no cenário híbrido, nesses casos, o uso das Máquinas Virtuais do Azure ou do Serviço de Contêiner do Azure pode ser mais fácil que o uso de designs de PaaS específicos de nuvem.</span><span class="sxs-lookup"><span data-stu-id="f80ec-504">As with the hybrid scenario, the use of Azure Virtual Machines or Azure Container Service might be easier in these cases than the use of cloud-specific PaaS designs.</span></span>

## <a name="automation"></a><span data-ttu-id="f80ec-505">Automação</span><span class="sxs-lookup"><span data-stu-id="f80ec-505">Automation</span></span>
<span data-ttu-id="f80ec-506">Alguns dos padrões que acabamos de discutir exigem ativação rápida de implantações offline, bem como restauração de partes específicas de um sistema.</span><span class="sxs-lookup"><span data-stu-id="f80ec-506">Some of the patterns that we just discussed require quick activation of offline deployments as well as restoration of specific parts of a system.</span></span> <span data-ttu-id="f80ec-507">Scripts de automação podem ativar recursos sob demanda e implantar soluções rapidamente.</span><span class="sxs-lookup"><span data-stu-id="f80ec-507">Automation scripts can activate resources on demand and deploy solutions rapidly.</span></span> <span data-ttu-id="f80ec-508">Os exemplos de automação relacionados à recuperação de desastres abaixo usam o [Azure PowerShell](https://msdn.microsoft.com/library/azure/jj156055.aspx), mas usar a [CLI do Azure](https://docs.microsoft.com/en-us/cli/azure/get-started-with-azure-cli) ou a [API REST de gerenciamento de serviços](https://msdn.microsoft.com/library/azure/ee460799.aspx) também são boas opções.</span><span class="sxs-lookup"><span data-stu-id="f80ec-508">The DR-related automation examples below use [Azure PowerShell](https://msdn.microsoft.com/library/azure/jj156055.aspx), but using the [Azure CLI](https://docs.microsoft.com/en-us/cli/azure/get-started-with-azure-cli) or the [Service Management REST API](https://msdn.microsoft.com/library/azure/ee460799.aspx) are also good options.</span></span>

<span data-ttu-id="f80ec-509">Os scripts de automação gerenciam os aspectos da recuperação de desastres que não são tratados de forma transparente pelo Azure.</span><span class="sxs-lookup"><span data-stu-id="f80ec-509">Automation scripts manage aspects of DR not transparently handled by Azure.</span></span> <span data-ttu-id="f80ec-510">Isso produz resultados consistentes e reproduzíveis, minimizando o erro humano.</span><span class="sxs-lookup"><span data-stu-id="f80ec-510">This produces consistent and repeatable results, minimizing human error.</span></span> <span data-ttu-id="f80ec-511">Os scripts de recuperação de desastres predefinidos também reduz o tempo para recriação de um sistema e suas partes constituintes durante um desastre.</span><span class="sxs-lookup"><span data-stu-id="f80ec-511">Predefined DR scripts also reduce the time to rebuild a system and its constituent parts during a disaster.</span></span> <span data-ttu-id="f80ec-512">Você não quer tentar descobrir manualmente como restaurar seu site enquanto ele está inativo e perdendo dinheiro a cada minuto.</span><span class="sxs-lookup"><span data-stu-id="f80ec-512">You don’t want to try to manually figure out how to restore your site while it's down and losing money every minute.</span></span>

<span data-ttu-id="f80ec-513">Teste seus scripts repetidamente do início ao fim.</span><span class="sxs-lookup"><span data-stu-id="f80ec-513">Test your scripts repeatedly from start to finish.</span></span> <span data-ttu-id="f80ec-514">Após verificar a funcionalidade básica, certifique-se de testá-los em uma [simulação de desastre](#disaster-simulation).</span><span class="sxs-lookup"><span data-stu-id="f80ec-514">After verifying their basic functionality, make sure to test them in [disaster simulation](#disaster-simulation).</span></span> <span data-ttu-id="f80ec-515">Isso ajuda a revelar defeitos nos scripts ou processos.</span><span class="sxs-lookup"><span data-stu-id="f80ec-515">This helps uncover defects in the scripts or processes.</span></span>

<span data-ttu-id="f80ec-516">Uma prática recomendada da automação é criar um repositório de scripts do PowerShell ou scripts de CLI (interface de linha de comando) para recuperação de desastre do Azure.</span><span class="sxs-lookup"><span data-stu-id="f80ec-516">A best practice with automation is to create a repository of PowerShell scripts or command-line interface (CLI) scripts for Azure disaster recovery.</span></span> <span data-ttu-id="f80ec-517">Maque-os e categorize-os claramente para agilizar o acesso.</span><span class="sxs-lookup"><span data-stu-id="f80ec-517">Clearly mark and categorize them for quick access.</span></span> <span data-ttu-id="f80ec-518">Designe uma pessoa primária para gerenciar o repositório e controlar a versão dos scripts.</span><span class="sxs-lookup"><span data-stu-id="f80ec-518">Designate a primary person to manage the repository and versioning of the scripts.</span></span> <span data-ttu-id="f80ec-519">Documente-os bem, com explicações de parâmetros e exemplos de uso dos scripts.</span><span class="sxs-lookup"><span data-stu-id="f80ec-519">Document them well with explanations of parameters and examples of script use.</span></span> <span data-ttu-id="f80ec-520">Certifique-se também de manter esta documentação em sincronia com as implantações do Azure.</span><span class="sxs-lookup"><span data-stu-id="f80ec-520">Also ensure that you keep this documentation in sync with your Azure deployments.</span></span> <span data-ttu-id="f80ec-521">Isso destaca o propósito de ter uma pessoa primária responsável por todas as partes do repositório.</span><span class="sxs-lookup"><span data-stu-id="f80ec-521">This underscores the purpose of having a primary person in charge of all parts of the repository.</span></span>

## <a name="failure-detection"></a><span data-ttu-id="f80ec-522">detecção de falhas</span><span class="sxs-lookup"><span data-stu-id="f80ec-522">Failure detection</span></span>
<span data-ttu-id="f80ec-523">Para lidar corretamente com problemas de disponibilidade e recuperação de desastre, você precisa ser capaz de detectar e diagnosticar falhas.</span><span class="sxs-lookup"><span data-stu-id="f80ec-523">To correctly handle problems with availability and disaster recovery, you must be able to detect and diagnose failures.</span></span> <span data-ttu-id="f80ec-524">Execute monitoramento avançado do servidor e da implantação para reconhecer rapidamente quando um sistema ou seus componentes se tornam indisponíveis repentinamente.</span><span class="sxs-lookup"><span data-stu-id="f80ec-524">Perform advanced server and deployment monitoring to quickly recognize when a system or its components suddenly become unavailable.</span></span> <span data-ttu-id="f80ec-525">Ferramentas de monitoramento que avaliam a integridade geral do serviço de nuvem e suas dependências podem fazer parte desse trabalho.</span><span class="sxs-lookup"><span data-stu-id="f80ec-525">Monitoring tools that assess the overall health of the cloud service and its dependencies can perform part of this work.</span></span> <span data-ttu-id="f80ec-526">Uma ferramenta adequada da Microsoft é o [System Center 2016](https://www.microsoft.com/en-us/server-cloud/products/system-center-2016/).</span><span class="sxs-lookup"><span data-stu-id="f80ec-526">One suitable Microsoft tool is [System Center 2016](https://www.microsoft.com/en-us/server-cloud/products/system-center-2016/).</span></span> <span data-ttu-id="f80ec-527">Ferramentas de terceiros também podem fornecer recursos de monitoramento.</span><span class="sxs-lookup"><span data-stu-id="f80ec-527">Third-party tools can also provide monitoring capabilities.</span></span> <span data-ttu-id="f80ec-528">A maioria das soluções de monitoramento monitora os principais contadores de desempenho e a disponibilidade do serviço.</span><span class="sxs-lookup"><span data-stu-id="f80ec-528">Most monitoring solutions track key performance counters and service availability.</span></span>

<span data-ttu-id="f80ec-529">Embora essas ferramentas sejam vitais, você deve se planejar para a detecção de falhas e dos relatórios em um serviço de nuvem.</span><span class="sxs-lookup"><span data-stu-id="f80ec-529">Although these tools are vital, you must plan for fault detection and reporting within a cloud service.</span></span> <span data-ttu-id="f80ec-530">Você também deve se planejar para usar adequadamente o Diagnóstico do Azure.</span><span class="sxs-lookup"><span data-stu-id="f80ec-530">You must also plan to properly use Azure Diagnostics.</span></span> <span data-ttu-id="f80ec-531">Contadores de desempenho personalizados ou entradas de log de eventos também podem fazer parte da estratégia geral.</span><span class="sxs-lookup"><span data-stu-id="f80ec-531">Custom performance counters or event-log entries can also be part of the overall strategy.</span></span> <span data-ttu-id="f80ec-532">Isso fornece mais dados durante falhas para diagnosticar o problema rapidamente e restaurar todos os recursos.</span><span class="sxs-lookup"><span data-stu-id="f80ec-532">This provides more data during failures to quickly diagnose the problem and restore full capabilities.</span></span> <span data-ttu-id="f80ec-533">Esse recurso também fornece métricas adicionais que as ferramentas de monitoramento podem usar para determinar a integridade do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f80ec-533">It also provides additional metrics that the monitoring tools can use to determine application health.</span></span> <span data-ttu-id="f80ec-534">Para saber mais, confira [Habilitando o Diagnóstico do Azure nos Serviços de Nuvem do Azure](/azure/cloud-services/cloud-services-dotnet-diagnostics/).</span><span class="sxs-lookup"><span data-stu-id="f80ec-534">For more information, see [Enabling Azure Diagnostics in Azure Cloud Services](/azure/cloud-services/cloud-services-dotnet-diagnostics/).</span></span> <span data-ttu-id="f80ec-535">Para uma discussão sobre como planejar um "modelo de integridade" geral, confira [Failsafe: Guidance for Resilient Cloud Architectures](https://channel9.msdn.com/Series/FailSafe)(À prova de falhas: orientação para arquiteturas de nuvem resilientes).</span><span class="sxs-lookup"><span data-stu-id="f80ec-535">For a discussion of how to plan for an overall “health model,” see [Failsafe: Guidance for Resilient Cloud Architectures](https://channel9.msdn.com/Series/FailSafe).</span></span>

## <a name="disaster-simulation"></a><span data-ttu-id="f80ec-536">simulação de desastre</span><span class="sxs-lookup"><span data-stu-id="f80ec-536">Disaster simulation</span></span>
<span data-ttu-id="f80ec-537">Testes de simulação envolvem a criação de situações da vida real de pequeno porte no local de trabalho para observar como os membros da equipe reagem.</span><span class="sxs-lookup"><span data-stu-id="f80ec-537">Simulation testing involves creating small real-life situations on the work floor to observe how the team members react.</span></span> <span data-ttu-id="f80ec-538">As simulações também mostram o quanto as soluções do plano de recuperação são eficazes.</span><span class="sxs-lookup"><span data-stu-id="f80ec-538">Simulations also show how effective the solutions are in the recovery plan.</span></span> <span data-ttu-id="f80ec-539">Execute as simulações para que os cenários criados não afetem negócios reais, embora ainda pareçam situações reais.</span><span class="sxs-lookup"><span data-stu-id="f80ec-539">Execute simulations so that the created scenarios don't disrupt actual business, while still feeling like real situations.</span></span>

<span data-ttu-id="f80ec-540">Considere a possibilidade de criar um tipo de "meu de controle" no aplicativo para simular manualmente problemas de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="f80ec-540">Consider architecting a type of “switchboard” in the application to manually simulate availability issues.</span></span> <span data-ttu-id="f80ec-541">Por exemplo, por meio de um controle suave, dispare exceções de acesso ao banco de dados para um módulo de ordenamento fazendo com que ele não funcione corretamente.</span><span class="sxs-lookup"><span data-stu-id="f80ec-541">For instance, through a soft switch, trigger database access exceptions for an ordering module by causing it to malfunction.</span></span> <span data-ttu-id="f80ec-542">Você pode adotar abordagens semelhantes menos agressivas para outros módulos no nível de interface de rede.</span><span class="sxs-lookup"><span data-stu-id="f80ec-542">You can take similar lightweight approaches for other modules at the network interface level.</span></span>

<span data-ttu-id="f80ec-543">A simulação destaca todos os problemas que foram tratados incorretamente.</span><span class="sxs-lookup"><span data-stu-id="f80ec-543">The simulation highlights any issues that were inadequately addressed.</span></span> <span data-ttu-id="f80ec-544">Os cenários simulados devem ser completamente controláveis.</span><span class="sxs-lookup"><span data-stu-id="f80ec-544">The simulated scenarios must be completely controllable.</span></span> <span data-ttu-id="f80ec-545">Isso significa que, mesmo que o plano de recuperação pareça estar falhando, você pode restaurar a situação voltar ao normal sem danos significativos.</span><span class="sxs-lookup"><span data-stu-id="f80ec-545">This means that, even if the recovery plan seems to be failing, you can restore the situation back to normal without causing any significant damage.</span></span> <span data-ttu-id="f80ec-546">Também é importante que você informe o gerenciamento de nível superior sobre quando e como os exercícios de simulação serão executados.</span><span class="sxs-lookup"><span data-stu-id="f80ec-546">It’s also important that you inform higher-level management about when and how the simulation exercises will be executed.</span></span> <span data-ttu-id="f80ec-547">Esse plano deve detalhar o tempo ou os recursos afetados durante a simulação.</span><span class="sxs-lookup"><span data-stu-id="f80ec-547">This plan should detail the time or resources affected during the simulation.</span></span> <span data-ttu-id="f80ec-548">Também defina as medidas de sucesso ao testar seu plano de recuperação de desastres.</span><span class="sxs-lookup"><span data-stu-id="f80ec-548">Also define the measures of success when testing your disaster recovery plan.</span></span>

<span data-ttu-id="f80ec-549">Várias outras técnicas podem testar os planos de recuperação de desastres.</span><span class="sxs-lookup"><span data-stu-id="f80ec-549">Several other techniques can test disaster recovery plans.</span></span> <span data-ttu-id="f80ec-550">No entanto, a maioria deles são simplesmente variações dessas técnicas básicas.</span><span class="sxs-lookup"><span data-stu-id="f80ec-550">However, most of them are simply variations of these basic techniques.</span></span> <span data-ttu-id="f80ec-551">O objetivo desse teste é avaliar a viabilidade do plano de recuperação.</span><span class="sxs-lookup"><span data-stu-id="f80ec-551">The intent of this testing is to evaluate the feasibility of the recovery plan.</span></span> <span data-ttu-id="f80ec-552">Testes de recuperação de desastre se concentram em detalhes para descobrir lacunas no plano básico de recuperação.</span><span class="sxs-lookup"><span data-stu-id="f80ec-552">Disaster recovery testing focuses on the details to discover gaps in the basic recovery plan.</span></span>

## <a name="service-specific-guidance"></a><span data-ttu-id="f80ec-553">Diretriz específica do serviço</span><span class="sxs-lookup"><span data-stu-id="f80ec-553">Service-specific guidance</span></span>

<span data-ttu-id="f80ec-554">Os tópicos a seguir descrevem os serviços do Azure específicos de recuperação de desastres:</span><span class="sxs-lookup"><span data-stu-id="f80ec-554">The following topics describe disaster recovery specific Azure services:</span></span>

| <span data-ttu-id="f80ec-555">O Barramento de</span><span class="sxs-lookup"><span data-stu-id="f80ec-555">Service</span></span> | <span data-ttu-id="f80ec-556">Tópico</span><span class="sxs-lookup"><span data-stu-id="f80ec-556">Topic</span></span> |
|---------|-------|
| <span data-ttu-id="f80ec-557">Serviços de Nuvem</span><span class="sxs-lookup"><span data-stu-id="f80ec-557">Cloud Services</span></span> | [<span data-ttu-id="f80ec-558">O que fazer no caso de uma interrupção de serviço do Azure que afete os Serviços de Nuvem do Azure</span><span class="sxs-lookup"><span data-stu-id="f80ec-558">What to do in the event of an Azure service disruption that impacts Azure Cloud Services</span></span>](/azure/cloud-services/cloud-services-disaster-recovery-guidance) |
| <span data-ttu-id="f80ec-559">Cofre de Chaves</span><span class="sxs-lookup"><span data-stu-id="f80ec-559">Key Vault</span></span> | [<span data-ttu-id="f80ec-560">Redundância e disponibilidade de Azure Key Vault</span><span class="sxs-lookup"><span data-stu-id="f80ec-560">Azure Key Vault availability and redundancy</span></span>](/azure/key-vault/key-vault-disaster-recovery-guidance) |
|<span data-ttu-id="f80ec-561">Armazenamento</span><span class="sxs-lookup"><span data-stu-id="f80ec-561">Storage</span></span> | [<span data-ttu-id="f80ec-562">O que fazer se uma ocorrer interrupção no Armazenamento do Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="f80ec-562">What to do if an Azure Storage outage occurs</span></span>](/azure/storage/storage-disaster-recovery-guidance) |
| <span data-ttu-id="f80ec-563">Banco de dados SQL</span><span class="sxs-lookup"><span data-stu-id="f80ec-563">SQL Database</span></span> | [<span data-ttu-id="f80ec-564">Restaurar um Banco de Dados SQL ou fazer failover para um secundário</span><span class="sxs-lookup"><span data-stu-id="f80ec-564">Restore an Azure SQL Database or failover to a secondary</span></span>](/azure/sql-database/sql-database-disaster-recovery) |
| <span data-ttu-id="f80ec-565">Máquinas virtuais</span><span class="sxs-lookup"><span data-stu-id="f80ec-565">Virtual machines</span></span> | [<span data-ttu-id="f80ec-566">O que fazer caso uma interrupção de serviço do Azure afete as máquinas virtuais do Azure</span><span class="sxs-lookup"><span data-stu-id="f80ec-566">What to do in the event that an Azure service disruption impacts Azure virtual machines</span></span>](/azure/virtual-machines/virtual-machines-disaster-recovery-guidance) |
| <span data-ttu-id="f80ec-567">Redes virtuais</span><span class="sxs-lookup"><span data-stu-id="f80ec-567">Virtual networks</span></span> | [<span data-ttu-id="f80ec-568">Rede Virtual – Continuidade de Negócios</span><span class="sxs-lookup"><span data-stu-id="f80ec-568">Virtual Network – Business Continuity</span></span>](/azure/virtual-network/virtual-network-disaster-recovery-guidance) |


