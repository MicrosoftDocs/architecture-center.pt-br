---
title: Alta disponibilidade para os aplicativos do Azure
description: Visão geral técnica e informações detalhadas sobre como projetar e criar aplicativos para alta disponibilidade no Microsoft Azure.
author: adamglick
ms.date: 05/31/2017
ms.openlocfilehash: f116b9e64f1722b5141ae90239d5c8a8b4a89487
ms.sourcegitcommit: e67b751f230792bba917754d67789a20810dc76b
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/06/2018
ms.locfileid: "30848556"
---
[!INCLUDE [header](../_includes/header.md)]

# <a name="high-availability-for-applications-built-on-microsoft-azure"></a><span data-ttu-id="51e37-103">Alta disponibilidade para aplicativos baseados no Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="51e37-103">High availability for applications built on Microsoft Azure</span></span>
<span data-ttu-id="51e37-104">Um aplicativo altamente disponível absorve flutuações na disponibilidade, carga e falhas temporárias em serviços e hardware dependentes.</span><span class="sxs-lookup"><span data-stu-id="51e37-104">A highly available application absorbs fluctuations in availability, load, and temporary failures in dependent services and hardware.</span></span> <span data-ttu-id="51e37-105">O aplicativo continua funcionando de forma aceitável, conforme definido pelos requisitos de negócios ou SLAs (contratos de nível de serviço) do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="51e37-105">The application continues to perform acceptably, as defined by business requirements or application service-level agreements (SLAs).</span></span>

## <a name="azure-high-availability-features"></a><span data-ttu-id="51e37-106">Recursos de alta disponibilidade do Azure</span><span class="sxs-lookup"><span data-stu-id="51e37-106">Azure high-availability features</span></span>
<span data-ttu-id="51e37-107">O Azure tem muitos recursos internos da plataforma que oferecem suporte a aplicativos altamente disponíveis.</span><span class="sxs-lookup"><span data-stu-id="51e37-107">Azure has many built-in platform features that support highly available applications.</span></span> <span data-ttu-id="51e37-108">Esta seção descreve alguns desses recursos principais.</span><span class="sxs-lookup"><span data-stu-id="51e37-108">This section describes some of those key features.</span></span>

### <a name="fabric-controller"></a><span data-ttu-id="51e37-109">Controlador de malha</span><span class="sxs-lookup"><span data-stu-id="51e37-109">Fabric controller</span></span>
<span data-ttu-id="51e37-110">O controlador de malha do Azure provisiona e monitora a condição das instâncias de computação do Azure.</span><span class="sxs-lookup"><span data-stu-id="51e37-110">The Azure fabric controller provisions and monitors the condition of Azure compute instances.</span></span> <span data-ttu-id="51e37-111">O controlador de malha monitora o status do hardware e do software das instâncias do computador host e convidado.</span><span class="sxs-lookup"><span data-stu-id="51e37-111">The fabric controller monitors the status of the hardware and software of the host and guest machine instances.</span></span> <span data-ttu-id="51e37-112">Quando ele detecta uma falha, ele mantém os SLAs automaticamente realocando as instâncias da VM.</span><span class="sxs-lookup"><span data-stu-id="51e37-112">When it detects a failure, it maintains SLAs by automatically relocating the VM instances.</span></span> <span data-ttu-id="51e37-113">O conceito de domínios de falha e atualização dá ainda mais suporte ao SLA de computação.</span><span class="sxs-lookup"><span data-stu-id="51e37-113">The concept of fault and upgrade domains further supports the compute SLA.</span></span>

<span data-ttu-id="51e37-114">Quando várias instâncias de função do Serviço de Nuvem são implantadas, o Azure implanta essas instâncias em diferentes domínios de falha.</span><span class="sxs-lookup"><span data-stu-id="51e37-114">When multiple Cloud Service role instances are deployed, Azure deploys these instances to different fault domains.</span></span> <span data-ttu-id="51e37-115">Um limite de domínio de falha é basicamente um rack de hardware diferente na mesma região.</span><span class="sxs-lookup"><span data-stu-id="51e37-115">A fault domain boundary is essentially a different hardware rack in the same region.</span></span> <span data-ttu-id="51e37-116">Domínios de falha reduzem a probabilidade de que uma falha de hardware localizada interrompa o serviço de um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="51e37-116">Fault domains reduce the probability that a localized hardware failure interrupts the service of an application.</span></span> <span data-ttu-id="51e37-117">Não é possível gerenciar o número de domínios de falha das suas funções de trabalho ou Web.</span><span class="sxs-lookup"><span data-stu-id="51e37-117">You cannot manage the number of fault domains of your worker roles or web roles.</span></span> <span data-ttu-id="51e37-118">O controlador de malha usa os recursos dedicados que são separados dos aplicativos hospedados pelo Azure.</span><span class="sxs-lookup"><span data-stu-id="51e37-118">The fabric controller uses dedicated resources that are separate from Azure-hosted applications.</span></span> <span data-ttu-id="51e37-119">Ele requer 100% de tempo de atividade porque atua como núcleo do sistema do Azure.</span><span class="sxs-lookup"><span data-stu-id="51e37-119">It requires 100 percent uptime because it serves as the nucleus of the Azure system.</span></span> <span data-ttu-id="51e37-120">Ele monitora e gerencia instâncias da função em domínios de falha.</span><span class="sxs-lookup"><span data-stu-id="51e37-120">It monitors and manages role instances across fault domains.</span></span>

<span data-ttu-id="51e37-121">O diagrama a seguir mostra recursos compartilhados do Azure que o controlador de malha implanta e gerencia nos diferentes domínios de falha.</span><span class="sxs-lookup"><span data-stu-id="51e37-121">The following diagram shows Azure shared resources that the fabric controller deploys and manages across different fault domains.</span></span>

![Exibição simplificada de isolamento de domínio de falha](./images/high-availability-azure-applications/fault-domain-isolation.png)

<span data-ttu-id="51e37-123">Embora os domínios de falha sejam separações físicas para mitigar falhas, os domínios de atualização são unidades lógicas de separação da instância que determinam quais instâncias de um serviço serão atualizadas em um momento específico.</span><span class="sxs-lookup"><span data-stu-id="51e37-123">While fault domains are physical separations to mitigate failure, upgrade domains are logical units of instance separation that determine which instances of a service will be upgraded at a specific time.</span></span> <span data-ttu-id="51e37-124">Por padrão, cinco domínios de atualização são definidos na sua implantação de serviço hospedado.</span><span class="sxs-lookup"><span data-stu-id="51e37-124">By default, five upgrade domains are defined for your hosted service deployment.</span></span> <span data-ttu-id="51e37-125">No entanto, você pode alterar esse valor no arquivo de definição de serviço.</span><span class="sxs-lookup"><span data-stu-id="51e37-125">However, you can change that value in the service definition file.</span></span> <span data-ttu-id="51e37-126">Por exemplo, se você tiver oito instâncias da função Web, haverá duas instâncias em três domínios de atualização e duas instâncias em um domínio de atualização.</span><span class="sxs-lookup"><span data-stu-id="51e37-126">For example, if you have eight instances of your web role, there are two instances in three upgrade domains and two instances in one upgrade domain.</span></span> <span data-ttu-id="51e37-127">O Azure define a sequência de atualização com base no número de domínios de atualização.</span><span class="sxs-lookup"><span data-stu-id="51e37-127">Azure defines the update sequence based on the number of upgrade domains.</span></span> <span data-ttu-id="51e37-128">Para obter mais informações, consulte [Atualizar um serviço de nuvem](/azure/cloud-services/cloud-services-update-azure-service/).</span><span class="sxs-lookup"><span data-stu-id="51e37-128">For more information, see [Update a cloud service](/azure/cloud-services/cloud-services-update-azure-service/).</span></span>

### <a name="features-in-other-services"></a><span data-ttu-id="51e37-129">Recursos em outros serviços</span><span class="sxs-lookup"><span data-stu-id="51e37-129">Features in other services</span></span>
<span data-ttu-id="51e37-130">Além dos recursos de plataforma compatíveis com funcionalidades da computação de alta disponibilidade, o Azure insere recursos de alta disponibilidade em outros serviços.</span><span class="sxs-lookup"><span data-stu-id="51e37-130">In addition to the platform features that support high availability of compute resources, Azure embeds high-availability features in its other services.</span></span> <span data-ttu-id="51e37-131">Por exemplo, o Armazenamento do Azure mantém pelo menos três réplicas de todos os dados em sua conta de armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="51e37-131">For example, Azure Storage maintains at least three replicas of all data in your Azure storage account.</span></span> <span data-ttu-id="51e37-132">Ele também habilita a replicação geográfica para armazenar cópias de seus dados em uma região secundária.</span><span class="sxs-lookup"><span data-stu-id="51e37-132">It also enables geo-replication to store copies of your data in a secondary region.</span></span> <span data-ttu-id="51e37-133">A Rede de Distribuição de Conteúdo do Microsoft Azure permite que os blobs sejam armazenados em cache em todo o mundo para redundância, escalabilidade e menor latência.</span><span class="sxs-lookup"><span data-stu-id="51e37-133">The Azure Content Delivery Network allows blobs to be cached around the world for redundancy, scalability, and lower latency.</span></span> <span data-ttu-id="51e37-134">Banco de dados SQL do Azure mantém várias réplicas também.</span><span class="sxs-lookup"><span data-stu-id="51e37-134">Azure SQL Database maintains multiple replicas as well.</span></span>

<span data-ttu-id="51e37-135">Para ver uma discussão mais aprofundada sobre os recursos de disponibilidade da plataforma do Azure, consulte [Orientações técnicas de resiliência](index.md).</span><span class="sxs-lookup"><span data-stu-id="51e37-135">For a deeper discussion of Azure platform availability features, see [Resiliency technical guidance](index.md).</span></span> <span data-ttu-id="51e37-136">Veja também as [Práticas recomendadas para a criação de serviços em grande escala no Microsoft Azure](https://azure.microsoft.com/blog/best-practices-for-designing-large-scale-services-on-windows-azure/).</span><span class="sxs-lookup"><span data-stu-id="51e37-136">Also see [Best practices for designing large-scale services on Windows Azure](https://azure.microsoft.com/blog/best-practices-for-designing-large-scale-services-on-windows-azure/).</span></span>

<span data-ttu-id="51e37-137">Embora o Azure ofereça vários recursos compatíveis com a alta disponibilidade, é importante compreender suas limitações:</span><span class="sxs-lookup"><span data-stu-id="51e37-137">Although Azure provides multiple features that support high availability, it's important to understand their limitations:</span></span>

* <span data-ttu-id="51e37-138">Para computação, o Azure garante que as funções estejam disponíveis e em execução, mas ele não detecta se seu aplicativo está em execução ou sobrecarregado.</span><span class="sxs-lookup"><span data-stu-id="51e37-138">For compute, Azure guarantees that your roles are available and running, but it cannot detect whether your application is running or overloaded.</span></span>
* <span data-ttu-id="51e37-139">Para banco de dados SQL do Azure, os dados são replicados de forma síncrona dentro da região.</span><span class="sxs-lookup"><span data-stu-id="51e37-139">For Azure SQL Database, data is replicated synchronously within the region.</span></span> <span data-ttu-id="51e37-140">Você pode optar pela replicação geográfica ativa, que permite até quatro cópias adicionais de banco de dados na mesma região (ou em regiões diferentes).</span><span class="sxs-lookup"><span data-stu-id="51e37-140">You can choose active geo-replication, which allows up to four additional database copies in the same region (or different regions).</span></span> <span data-ttu-id="51e37-141">Embora essas réplicas de banco de dados não sejam backups pontuais, o Banco de Dados SQL fornecem recursos de backup pontual.</span><span class="sxs-lookup"><span data-stu-id="51e37-141">While these database replicas are not point-in-time backups, SQL Database does provide point-in-time backup capabilities.</span></span> <span data-ttu-id="51e37-142">Para obter mais informações, consulte [Recuperar um Banco de Dados SQL do Azure usando backups de dados automatizados: restauração pontual](/azure/sql-database/sql-database-recovery-using-backups#point-in-time-restore).</span><span class="sxs-lookup"><span data-stu-id="51e37-142">For more information, see [Recover an Azure SQL Database using automated data backups: Point-in-time restore](/azure/sql-database/sql-database-recovery-using-backups#point-in-time-restore).</span></span>
* <span data-ttu-id="51e37-143">Para o Armazenamento do Azure, dados de tabela e de blobs são replicados por padrão em uma região alternativa.</span><span class="sxs-lookup"><span data-stu-id="51e37-143">For Azure Storage, table data and blob data are replicated by default to an alternate region.</span></span> <span data-ttu-id="51e37-144">No entanto, você não pode acessar as réplicas até que o Microsoft decida efetuar failover para o site alternativo.</span><span class="sxs-lookup"><span data-stu-id="51e37-144">However, you cannot access the replicas until Microsoft chooses to fail over to the alternate site.</span></span> <span data-ttu-id="51e37-145">Um failover de região ocorre apenas durante uma interrupção prolongada do serviço de toda a região e não há nenhum SLA para tempo de failover geográfico.</span><span class="sxs-lookup"><span data-stu-id="51e37-145">A region failover occurs only during a prolonged region-wide service disruption, and there is no SLA for geo-failover time.</span></span> <span data-ttu-id="51e37-146">Também é importante observar que qualquer dado corrompido se espalha rapidamente nas réplicas.</span><span class="sxs-lookup"><span data-stu-id="51e37-146">It's also important to note that any data corruption quickly spreads to the replicas.</span></span> <span data-ttu-id="51e37-147">Por essas razões, é necessário complementar os recursos de disponibilidade da plataforma com recursos de disponibilidade específicos do aplicativo, incluindo o recurso de instantâneo de blobs para criar de backups pontuais dos dados de blobs.</span><span class="sxs-lookup"><span data-stu-id="51e37-147">For these reasons, you must supplement platform availability features with application-specific availability features, including the blob snapshot feature to create point-in-time backups of blob data.</span></span>

### <a name="availability-sets-for-azure-virtual-machines"></a><span data-ttu-id="51e37-148">Conjuntos de disponibilidade para Máquinas Virtuais do Azure</span><span class="sxs-lookup"><span data-stu-id="51e37-148">Availability sets for Azure Virtual Machines</span></span>
<span data-ttu-id="51e37-149">Esse documento se concentra primariamente em serviços de nuvem, que usam um modelo PaaS (plataforma como serviço).</span><span class="sxs-lookup"><span data-stu-id="51e37-149">This document primarily focuses on cloud services, which use a platform-as-a-service (PaaS) model.</span></span> <span data-ttu-id="51e37-150">No entanto, também há recursos de disponibilidade específicos para Máquinas Virtuais do Azure, que usam um modelo IaaS (infraestrutura como serviço).</span><span class="sxs-lookup"><span data-stu-id="51e37-150">There are also specific availability features for Azure Virtual Machines, which use an infrastructure-as-a-service (IaaS) model.</span></span> <span data-ttu-id="51e37-151">Para alcançar alta disponibilidade com Máquinas Virtuais, é necessário usar conjuntos de disponibilidade, que têm função semelhante aos domínios de falha e de atualização.</span><span class="sxs-lookup"><span data-stu-id="51e37-151">To achieve high availability with Virtual Machines, you must use availability sets, which serve a similar function to fault and upgrade domains.</span></span> <span data-ttu-id="51e37-152">Em um conjunto de disponibilidade, o Azure posiciona as máquinas virtuais de forma a impedir as falhas de hardware localizadas e que as atividades de manutenção desativem todos os computadores nesse grupo.</span><span class="sxs-lookup"><span data-stu-id="51e37-152">Within an availability set, Azure positions the virtual machines in a way that prevents localized hardware faults and maintenance activities from bringing down all the machines in that group.</span></span> <span data-ttu-id="51e37-153">Conjuntos de disponibilidade são necessários para obter o SLA do Azure para disponibilidade de máquinas virtuais.</span><span class="sxs-lookup"><span data-stu-id="51e37-153">Availability sets are required to achieve the Azure SLA for the availability of Virtual Machines.</span></span>

<span data-ttu-id="51e37-154">O diagrama a seguir mostra dois conjuntos de disponibilidade para Web e máquinas virtuais do SQL Server, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="51e37-154">The following diagram shows two availability sets for web and SQL Server virtual machines, respectively.</span></span>

![Conjuntos de disponibilidade para Máquinas Virtuais do Azure](./images/high-availability-azure-applications/availability-set-for-azure-virtual-machines.png)

> [!NOTE]
> <span data-ttu-id="51e37-156">No diagrama anterior, o SQL Server está instalado e em execução em máquinas virtuais.</span><span class="sxs-lookup"><span data-stu-id="51e37-156">In the preceding diagram, SQL Server is installed and running on virtual machines.</span></span> <span data-ttu-id="51e37-157">Isso é diferente do Banco de Dados SQL do Azure, que fornece um banco de dados como um serviço gerenciado.</span><span class="sxs-lookup"><span data-stu-id="51e37-157">This is different from Azure SQL Database, which provides a database as a managed service.</span></span>
> 
> 

## <a name="application-strategies-for-high-availability"></a><span data-ttu-id="51e37-158">Estratégias de aplicativo para alta disponibilidade</span><span class="sxs-lookup"><span data-stu-id="51e37-158">Application strategies for high availability</span></span>
<span data-ttu-id="51e37-159">A maioria das estratégias de aplicativo para alta disponibilidade envolve a redundância ou a remoção de dependências de hardware entre componentes de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="51e37-159">Most application strategies for high availability involve either redundancy or the removal of hard dependencies between application components.</span></span> <span data-ttu-id="51e37-160">O design do aplicativo deve dar suporte a tolerância a falhas durante tempo de inatividade esporádico do Azure ou serviços de terceiros.</span><span class="sxs-lookup"><span data-stu-id="51e37-160">Application design should support fault tolerance during sporadic downtime of Azure or third-party services.</span></span> <span data-ttu-id="51e37-161">As seções a seguir descrevem padrões de aplicativo para aumentar a disponibilidade dos serviços de nuvem.</span><span class="sxs-lookup"><span data-stu-id="51e37-161">The following sections describe application patterns for improving the availability of your cloud services.</span></span>

### <a name="asynchronous-communication-and-durable-queues"></a><span data-ttu-id="51e37-162">Comunicação assíncrona e filas duráveis</span><span class="sxs-lookup"><span data-stu-id="51e37-162">Asynchronous communication and durable queues</span></span>
<span data-ttu-id="51e37-163">Para aumentar a disponibilidade nos aplicativos do Azure, considere usar comunicação assíncrona entre serviços com acoplamento flexível.</span><span class="sxs-lookup"><span data-stu-id="51e37-163">To increase availability in Azure applications, consider asynchronous communication between loosely coupled services.</span></span> <span data-ttu-id="51e37-164">Nesse padrão, as mensagens são gravadas em filas de armazenamento ou em filas do Barramento de Serviço do Azure para processamento posterior.</span><span class="sxs-lookup"><span data-stu-id="51e37-164">In this pattern, messages are written to either storage queues or Azure Service Bus queues for later processing.</span></span> <span data-ttu-id="51e37-165">Quando uma mensagem é escrita na fila, o controle a retorna imediatamente para o remetente.</span><span class="sxs-lookup"><span data-stu-id="51e37-165">When a message is written to the queue, control immediately returns to the sender.</span></span> <span data-ttu-id="51e37-166">Outro serviço do aplicativo (geralmente implementado como uma função de trabalho) processa a mensagem.</span><span class="sxs-lookup"><span data-stu-id="51e37-166">Another service of the application (typically implemented as a worker role) processes the message.</span></span> <span data-ttu-id="51e37-167">Se o serviço de processamento parar de funcionar, as mensagens serão acumuladas na fila até que o serviço de processamento seja restaurado.</span><span class="sxs-lookup"><span data-stu-id="51e37-167">If the processing service stops working, the messages accumulate in the queue until the processing service is restored.</span></span> <span data-ttu-id="51e37-168">Não há nenhuma dependência direta entre o remetente de front-end e o processador de mensagens.</span><span class="sxs-lookup"><span data-stu-id="51e37-168">There is no direct dependency between the front-end sender and the message processor.</span></span> <span data-ttu-id="51e37-169">Isso elimina a necessidade de chamadas de serviço síncronas que podem causar gargalos em aplicativos distribuídos.</span><span class="sxs-lookup"><span data-stu-id="51e37-169">This eliminates synchronous service calls that can cause bottlenecks in distributed applications.</span></span>

<span data-ttu-id="51e37-170">Uma variação desse padrão armazena informações sobre chamadas de banco de dados com falha no Armazenamento do Azure (blobs, tabelas ou filas) ou filas do Barramento de Serviço.</span><span class="sxs-lookup"><span data-stu-id="51e37-170">A variation of this pattern stores information about failed database calls in Azure Storage (blobs, tables, or queues) or Service Bus queues.</span></span> <span data-ttu-id="51e37-171">Por exemplo, uma chamada síncrona de um aplicativo para outro serviço (como o banco de dados SQL do Azure) falha repetidamente.</span><span class="sxs-lookup"><span data-stu-id="51e37-171">For example, a synchronous call within an application to another service (such as Azure SQL Database) fails repeatedly.</span></span> <span data-ttu-id="51e37-172">Você pode serializar essa solicitação em armazenamento durável.</span><span class="sxs-lookup"><span data-stu-id="51e37-172">You might be able to serialize that request into durable storage.</span></span> <span data-ttu-id="51e37-173">Em algum momento posterior, quando o serviço ou o banco de dados estiver novamente online, o aplicativo poderá enviar novamente a solicitação do armazenamento.</span><span class="sxs-lookup"><span data-stu-id="51e37-173">At some later point when the service or database is back online, the application can resubmit the request from storage.</span></span> <span data-ttu-id="51e37-174">A diferença nesse modelo é que o local intermediário é usado somente durante falhas e não é uma parte regular do fluxo de trabalho do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="51e37-174">The difference in this model is that the intermediate location is used only during failures, not as a regular part of the application workflow.</span></span>

<span data-ttu-id="51e37-175">Em ambos os cenários, a comunicação assíncrona e o armazenamento intermediário impedem que um serviço de back-end inativo interrompa o aplicativo inteiro.</span><span class="sxs-lookup"><span data-stu-id="51e37-175">In both scenarios, asynchronous communication and intermediate storage prevent a downed back-end service from bringing down the entire application.</span></span> <span data-ttu-id="51e37-176">As filas servem como um intermediário lógico.</span><span class="sxs-lookup"><span data-stu-id="51e37-176">Queues serve as a logical intermediary.</span></span> <span data-ttu-id="51e37-177">Para saber mais sobre como escolher os serviços de enfileiramento, consulte [Filas do Azure e do Barramento de Serviço do Azure &mdash; comparações e contrastes](/azure/service-bus-messaging/service-bus-azure-and-service-bus-queues-compared-contrasted/).</span><span class="sxs-lookup"><span data-stu-id="51e37-177">For more information on choosing between queuing services, see [Azure queues and Azure Service Bus queues &mdash; compared and contrasted](/azure/service-bus-messaging/service-bus-azure-and-service-bus-queues-compared-contrasted/).</span></span>

### <a name="fault-detection-and-retry-logic"></a><span data-ttu-id="51e37-178">Lógica de detecção e repetição de falhas</span><span class="sxs-lookup"><span data-stu-id="51e37-178">Fault detection and retry logic</span></span>
<span data-ttu-id="51e37-179">Um aspecto principal do design de aplicativos altamente disponíveis é usar a lógica de repetição no código para tratar normalmente um serviço temporariamente indisponível.</span><span class="sxs-lookup"><span data-stu-id="51e37-179">A key aspect of the design of highly available applications is the use of retry logic within code to gracefully handle a service that is temporarily unavailable.</span></span> <span data-ttu-id="51e37-180">As versões recentes de SDKs para o Armazenamento do Azure e o Barramento de Serviço do Azure são nativamente compatíveis com repetições.</span><span class="sxs-lookup"><span data-stu-id="51e37-180">Recent versions of SDKs for both Azure Storage and Azure Service Bus natively support retries.</span></span> <span data-ttu-id="51e37-181">Para obter mais informações sobre como fornecer a lógica de repetição personalizada para seu aplicativo, consulte o [Padrão de repetição](../patterns/retry.md).</span><span class="sxs-lookup"><span data-stu-id="51e37-181">For more information on providing custom retry logic for your application, see the [Retry pattern](../patterns/retry.md).</span></span>

### <a name="reference-data-pattern-for-high-availability"></a><span data-ttu-id="51e37-182">Padrão de dados de referência para alta disponibilidade</span><span class="sxs-lookup"><span data-stu-id="51e37-182">Reference data pattern for high availability</span></span>
<span data-ttu-id="51e37-183">Dados de referência são os dados somente leitura de um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="51e37-183">Reference data is the read-only data of an application.</span></span> <span data-ttu-id="51e37-184">Esses dados fornecem o contexto de negócios dentro do qual o aplicativo gera dados transacionais durante uma operação de negócios.</span><span class="sxs-lookup"><span data-stu-id="51e37-184">This data provides the business context within which the application generates transactional data during a business operation.</span></span> <span data-ttu-id="51e37-185">A integridade dos dados transacionais depende do instantâneo dos dados de referência no momento de conclusão da transação.</span><span class="sxs-lookup"><span data-stu-id="51e37-185">The integrity of transactional data depends on a snapshot of the reference data at the time the transaction was completed.</span></span>

<span data-ttu-id="51e37-186">Dados de referência são necessários para a operação correta do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="51e37-186">Reference data is necessary for the proper operation of the application.</span></span> <span data-ttu-id="51e37-187">Diversos aplicativos criam e mantêm dados de referência; sistemas MDM (Gerenciamento de Dados Mestre) executam essa função com frequência.</span><span class="sxs-lookup"><span data-stu-id="51e37-187">Various applications create and maintain reference data; master data management (MDM) systems often perform this function.</span></span> <span data-ttu-id="51e37-188">Esses sistemas são responsáveis pelo ciclo de vida dos dados de referência.</span><span class="sxs-lookup"><span data-stu-id="51e37-188">These systems are responsible for the life cycle of the reference data.</span></span> <span data-ttu-id="51e37-189">Catálogo de produtos, mestre de funcionários, mestre de peças e mestre de equipamentos são exemplos de dados de referência.</span><span class="sxs-lookup"><span data-stu-id="51e37-189">Examples of reference data include product catalog, employee master, parts master, and equipment master.</span></span> <span data-ttu-id="51e37-190">Os dados de referência também podem se originar fora da organização, por exemplo, CEPs ou alíquota de imposto.</span><span class="sxs-lookup"><span data-stu-id="51e37-190">Reference data can also originate from outside the organization, for example, postal codes or tax rates.</span></span> <span data-ttu-id="51e37-191">Estratégias para aumentar a disponibilidade dos dados de referência normalmente são menos difíceis que para dados transacionais.</span><span class="sxs-lookup"><span data-stu-id="51e37-191">Strategies for increasing the availability of reference data are typically less difficult than those for transactional data.</span></span> <span data-ttu-id="51e37-192">Dados de referência têm a vantagem de ser, na maior parte, imutáveis.</span><span class="sxs-lookup"><span data-stu-id="51e37-192">Reference data has the advantage of being mostly immutable.</span></span>

<span data-ttu-id="51e37-193">Funções Web e de trabalho do Azure que consomem dados de referência podem ser transformadas em autônomas no tempo de execução implantando os dados de referência junto com o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="51e37-193">Azure web and worker roles that consume reference data can be made autonomous at runtime by deploying the reference data along with the application.</span></span> <span data-ttu-id="51e37-194">Essa abordagem é ideal se o tamanho do armazenamento local permitir essa implantação.</span><span class="sxs-lookup"><span data-stu-id="51e37-194">This approach is ideal if the size of the local storage allows such a deployment.</span></span> <span data-ttu-id="51e37-195">Bancos de dados SQL inseridos, bancos de dados NoSQL ou arquivos XML implantados localmente ajudam na autonomia de unidades de escala de computação do Azure.</span><span class="sxs-lookup"><span data-stu-id="51e37-195">Embedded SQL databases, NoSQL databases, or XML files deployed locally help with the autonomy of Azure compute scale units.</span></span> <span data-ttu-id="51e37-196">No entanto, você deve ter um mecanismo para atualizar os dados em cada função sem a necessidade de reimplantação.</span><span class="sxs-lookup"><span data-stu-id="51e37-196">However, you should have a mechanism to update the data in each role without requiring redeployment.</span></span> <span data-ttu-id="51e37-197">Para fazer isso, coloque as atualizações dos dados de referência em um ponto de extremidade de armazenamento de nuvem (por exemplo, o Armazenamento de Blobs do Azure ou o Banco de Dados SQL).</span><span class="sxs-lookup"><span data-stu-id="51e37-197">To do this, place any updates to the reference data at a cloud storage endpoint (for example, Azure Blob storage or SQL Database).</span></span> <span data-ttu-id="51e37-198">Adicione código a cada função que baixa as atualizações de dados em nós de computação na inicialização da função.</span><span class="sxs-lookup"><span data-stu-id="51e37-198">Add code to each role that downloads the data updates into the compute nodes at role startup.</span></span> <span data-ttu-id="51e37-199">Como alternativa, adicione o código que permite que um administrador execute um download forçado nas instâncias da função.</span><span class="sxs-lookup"><span data-stu-id="51e37-199">Alternatively, add code that allows an administrator to perform a forced download into the role instances.</span></span>

<span data-ttu-id="51e37-200">Para aumentar a disponibilidade, as funções também devem conter um conjunto de dados de referência caso o armazenamento esteja inativo.</span><span class="sxs-lookup"><span data-stu-id="51e37-200">To increase availability, the roles should also contain a set of reference data in case storage is down.</span></span> <span data-ttu-id="51e37-201">As funções podem começar com um conjunto básico de dados de referência até que os recursos de armazenamento estejam disponíveis para as atualizações.</span><span class="sxs-lookup"><span data-stu-id="51e37-201">Roles can start with a basic set of reference data until the storage resource becomes available for the updates.</span></span>

![Alta disponibilidade de aplicativo através de nós de computação autônomos](./images/high-availability-azure-applications/application-high-availability-through-autonomous-compute-nodes.png)

<span data-ttu-id="51e37-203">Com esse padrão, as novas implantações ou instâncias de função podem levar mais tempo para iniciar se você estiver implantando ou baixando grandes volumes de dados de referência.</span><span class="sxs-lookup"><span data-stu-id="51e37-203">With this pattern, new deployments or role instances may take longer to start if you are deploying or downloading large amounts of reference data.</span></span> <span data-ttu-id="51e37-204">Essa compensação pode ser aceitável para a autonomia de ter dados de referência imediatamente disponíveis em cada função em vez de depender de serviços de armazenamento externo.</span><span class="sxs-lookup"><span data-stu-id="51e37-204">This tradeoff might be acceptable for the autonomy of having the reference data immediately available on each role, rather than depending on external storage services.</span></span>

### <a name="transactional-data-pattern-for-high-availability"></a><span data-ttu-id="51e37-205">Padrão de dados transacionais para alta disponibilidade</span><span class="sxs-lookup"><span data-stu-id="51e37-205">Transactional data pattern for high availability</span></span>
<span data-ttu-id="51e37-206">Dados transacionais são os dados que o aplicativo gera em um contexto de negócios.</span><span class="sxs-lookup"><span data-stu-id="51e37-206">Transactional data is the data that the application generates in a business context.</span></span> <span data-ttu-id="51e37-207">Dados transacionais são uma combinação do conjunto de processos de negócios que o aplicativo implementa e dos dados de referência que permitem esses processos.</span><span class="sxs-lookup"><span data-stu-id="51e37-207">Transactional data is a combination of the set of business processes that the application implements and the reference data that supports these processes.</span></span> <span data-ttu-id="51e37-208">Exemplos de dados transacionais podem incluir pedidos, aviso de envio avançado, faturas e oportunidades de CRM (gerenciamento de relacionamento com o cliente).</span><span class="sxs-lookup"><span data-stu-id="51e37-208">Examples of transactional data can include orders, advanced shipping notices, invoices, and customer relationship management (CRM) opportunities.</span></span> <span data-ttu-id="51e37-209">Os dados transacionais são fornecidos para sistemas externos para manter um registro ou para processamento adicional.</span><span class="sxs-lookup"><span data-stu-id="51e37-209">Transactional data is supplied to external systems for record keeping or for further processing.</span></span>

<span data-ttu-id="51e37-210">Os dados de referência podem ser alterados nos sistemas que são responsáveis por esses dados.</span><span class="sxs-lookup"><span data-stu-id="51e37-210">Reference data can change within the systems that are responsible for that data.</span></span> <span data-ttu-id="51e37-211">Portanto, os dados transacionais devem salvar o contexto de dados de referência pontual para minimizar as dependências externas para consistência semântica.</span><span class="sxs-lookup"><span data-stu-id="51e37-211">Therefore, transactional data must save the point-in-time reference data context to minimize external dependencies for its semantic consistency.</span></span> <span data-ttu-id="51e37-212">Por exemplo, um produto pode ser removido do catálogo vários meses depois que um pedido é atendido.</span><span class="sxs-lookup"><span data-stu-id="51e37-212">For example, a product may be removed from the catalog several months after an order is fulfilled.</span></span> <span data-ttu-id="51e37-213">É recomendável armazenar o máximo de contexto de dados de referência possível com a transação.</span><span class="sxs-lookup"><span data-stu-id="51e37-213">Storing as much reference data context as possible with the transaction is recommended.</span></span> <span data-ttu-id="51e37-214">Essa abordagem preserva a semântica associada à transação, mesmo se os dados de referência forem alterados após a captura da transação.</span><span class="sxs-lookup"><span data-stu-id="51e37-214">This approach preserves the semantics associated with the transaction, even if the reference data changes after the transaction is captured.</span></span>

<span data-ttu-id="51e37-215">Conforme mencionado anteriormente, arquiteturas que usam acoplamento flexível e comunicação assíncrona podem fornecer níveis mais altos de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="51e37-215">As mentioned previously, architectures that use loose coupling and asynchronous communication can provide higher levels of availability.</span></span> <span data-ttu-id="51e37-216">Isso também é verdadeiro para dados transacionais, mas a implementação é mais complexa.</span><span class="sxs-lookup"><span data-stu-id="51e37-216">This is true for transactional data as well, but the implementation is more complex.</span></span> <span data-ttu-id="51e37-217">Os padrões transacionais tradicionais normalmente contam com o banco de dados para garantir a transação.</span><span class="sxs-lookup"><span data-stu-id="51e37-217">Traditional transactional patterns usually rely on the database for guaranteeing the transaction.</span></span> <span data-ttu-id="51e37-218">Quando você introduz camadas intermediárias, o código do aplicativo deve tratar corretamente os dados em várias camadas para garantir consistência e durabilidade suficientes.</span><span class="sxs-lookup"><span data-stu-id="51e37-218">When you introduce intermediate layers, the application code must correctly handle the data at various layers to ensure sufficient consistency and durability.</span></span>

<span data-ttu-id="51e37-219">A seguinte sequência descreve um fluxo de trabalho que separa a captura de dados transacionais de seu processamento:</span><span class="sxs-lookup"><span data-stu-id="51e37-219">The following sequence describes a workflow that separates the capture of transactional data from its processing:</span></span>

1. <span data-ttu-id="51e37-220">Nó de computação na Web: apresente dados de referência.</span><span class="sxs-lookup"><span data-stu-id="51e37-220">Web compute node: Present reference data.</span></span>
2. <span data-ttu-id="51e37-221">Armazenamento externo: salve dados transacionais intermediários.</span><span class="sxs-lookup"><span data-stu-id="51e37-221">External storage: Save intermediate transactional data.</span></span>
3. <span data-ttu-id="51e37-222">Nó de computação na Web: conclua a transação do usuário final.</span><span class="sxs-lookup"><span data-stu-id="51e37-222">Web compute node: Complete the end-user transaction.</span></span>
4. <span data-ttu-id="51e37-223">Nó de computação na Web: envie os dados transacionais concluídos com o contexto de dados de referência para um armazenamento durável temporário com garantia de oferecer uma resposta previsível.</span><span class="sxs-lookup"><span data-stu-id="51e37-223">Web compute node: Send the completed transactional data with its reference data context to temporary durable storage that is guaranteed to give a predictable response.</span></span>
5. <span data-ttu-id="51e37-224">Nó de computação na Web: informe ao usuário final a conclusão da transação.</span><span class="sxs-lookup"><span data-stu-id="51e37-224">Web compute node: Signal the end-user completion of the transaction.</span></span>
6. <span data-ttu-id="51e37-225">Nó de computação em segundo plano: extraia os dados transacionais, realize processamento adicional, se necessário e envie-os para o local de armazenamento final no sistema atual.</span><span class="sxs-lookup"><span data-stu-id="51e37-225">Background compute node: Extract the transactional data, process it further if necessary, and send it to its final storage location in the current system.</span></span>

<span data-ttu-id="51e37-226">O diagrama a seguir mostra uma possível implementação desse projeto em um serviço de nuvem hospedado pelo Azure.</span><span class="sxs-lookup"><span data-stu-id="51e37-226">The following diagram shows one possible implementation of this design in an Azure-hosted cloud service.</span></span>

![Alta disponibilidade através de acoplamento flexível](./images/disaster-recovery-high-availability-azure-applications/application-high-availability-through-loose-coupling.png)

<span data-ttu-id="51e37-228">As setas tracejadas no diagrama acima indicam processamento assíncrono.</span><span class="sxs-lookup"><span data-stu-id="51e37-228">The dashed arrows in the preceding diagram indicate asynchronous processing.</span></span> <span data-ttu-id="51e37-229">A função web front-end não está ciente desse processamento assíncrono.</span><span class="sxs-lookup"><span data-stu-id="51e37-229">The front-end web role is not aware of this asynchronous processing.</span></span> <span data-ttu-id="51e37-230">Isso resulta no armazenamento da transação no seu destino final com referência ao sistema atual.</span><span class="sxs-lookup"><span data-stu-id="51e37-230">This leads to the storage of the transaction at its final destination with reference to the current system.</span></span> <span data-ttu-id="51e37-231">Devido à latência apresentada neste modelo assíncrono, os dados transacionais não estão imediatamente disponíveis para consulta.</span><span class="sxs-lookup"><span data-stu-id="51e37-231">Due to the latency that this asynchronous model introduces, the transactional data is not immediately available for query.</span></span> <span data-ttu-id="51e37-232">Portanto, cada unidade de dados transacionais precisa ser salva em um cache ou uma sessão de usuário para atender às necessidades imediatas da interface do usuário.</span><span class="sxs-lookup"><span data-stu-id="51e37-232">Therefore, each unit of the transactional data needs to be saved in a cache or a user session to meet the immediate UI needs.</span></span>

<span data-ttu-id="51e37-233">A função web independe do restante da infraestrutura.</span><span class="sxs-lookup"><span data-stu-id="51e37-233">The web role is autonomous from the rest of the infrastructure.</span></span> <span data-ttu-id="51e37-234">O perfil de disponibilidade é uma combinação da função web e fila do Azure e não de toda a infraestrutura.</span><span class="sxs-lookup"><span data-stu-id="51e37-234">Its availability profile is a combination of the web role and the Azure queue and not the entire infrastructure.</span></span> <span data-ttu-id="51e37-235">Além de alta disponibilidade, essa abordagem permite que a função web seja escala horizontalmente, independentemente do armazenamento de back-end.</span><span class="sxs-lookup"><span data-stu-id="51e37-235">In addition to high availability, this approach allows the web role to scale horizontally, independent of the back-end storage.</span></span> <span data-ttu-id="51e37-236">Esse modelo de alta disponibilidade pode ter um impacto sobre a economia das operações.</span><span class="sxs-lookup"><span data-stu-id="51e37-236">This high-availability model can have an impact on the economics of operations.</span></span> <span data-ttu-id="51e37-237">Componentes adicionais, como filas do Azure e funções de trabalho, podem afetar os custos mensais com uso.</span><span class="sxs-lookup"><span data-stu-id="51e37-237">Additional components like Azure queues and worker roles can affect monthly usage costs.</span></span>

<span data-ttu-id="51e37-238">Observe que o diagrama anterior mostra uma implementação dessa abordagem desacoplada para dados transacionais.</span><span class="sxs-lookup"><span data-stu-id="51e37-238">The previous diagram shows one implementation of this decoupled approach to transactional data.</span></span> <span data-ttu-id="51e37-239">Há muitas outras implementações possíveis.</span><span class="sxs-lookup"><span data-stu-id="51e37-239">There are many other possible implementations.</span></span> <span data-ttu-id="51e37-240">A lista a seguir fornece algumas alternativas:</span><span class="sxs-lookup"><span data-stu-id="51e37-240">The following list provides some alternatives:</span></span>

* <span data-ttu-id="51e37-241">Uma função de trabalho deve ser colocada entre a função web e a fila de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="51e37-241">A worker role might be placed between the web role and the storage queue.</span></span>
* <span data-ttu-id="51e37-242">Uma fila do Barramento de Serviço pode ser usada em vez de uma fila de armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="51e37-242">A Service Bus queue can be used instead of an Azure Storage queue.</span></span>
* <span data-ttu-id="51e37-243">O destino final pode ser o armazenamento do Azure ou um provedor de banco de dados diferente.</span><span class="sxs-lookup"><span data-stu-id="51e37-243">The final destination might be Azure Storage or a different database provider.</span></span>
* <span data-ttu-id="51e37-244">O Cache do Azure pode ser usado na camada Web para fornecer os requisitos imediatos de cache após a transação.</span><span class="sxs-lookup"><span data-stu-id="51e37-244">Azure Cache can be used at the web layer to provide the immediate caching requirements after the transaction.</span></span>

### <a name="scalability-patterns"></a><span data-ttu-id="51e37-245">Padrões de escalabilidade</span><span class="sxs-lookup"><span data-stu-id="51e37-245">Scalability patterns</span></span>
<span data-ttu-id="51e37-246">É importante observar que a escalabilidade do serviço de nuvem afeta diretamente a disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="51e37-246">It's important to note that the scalability of a cloud service directly affects availability.</span></span> <span data-ttu-id="51e37-247">Se uma carga maior fizer com que o serviço não responda, a impressão do usuário será que o aplicativo está inativo.</span><span class="sxs-lookup"><span data-stu-id="51e37-247">If increased load causes your service to be unresponsive, the user perception is that the application is down.</span></span> <span data-ttu-id="51e37-248">Siga as práticas comprovadas para escalabilidade com base em sua carga esperada de aplicativo e em futuras expectativas.</span><span class="sxs-lookup"><span data-stu-id="51e37-248">Follow proven practices for scalability based on your expected application load and future expectations.</span></span> <span data-ttu-id="51e37-249">Maximizar a escala envolve várias considerações, como o uso de uma única conta ou de várias contas de armazenamento, compartilhando entre vários bancos de dados e estratégias de cache.</span><span class="sxs-lookup"><span data-stu-id="51e37-249">Maximizing scale involves many considerations, such as single versus multiple storage accounts, sharing across multiple databases, and caching strategies.</span></span> <span data-ttu-id="51e37-250">Para ver informações detalhadas sobre esses padrões, consulte [Práticas recomendadas para projetar serviços em grande escala no Microsoft Azure](https://azure.microsoft.com/blog/best-practices-for-designing-large-scale-services-on-windows-azure/).</span><span class="sxs-lookup"><span data-stu-id="51e37-250">For in-depth information about these patterns, see [Best practices for designing large-scale services on Microsoft Azure](https://azure.microsoft.com/blog/best-practices-for-designing-large-scale-services-on-windows-azure/).</span></span>

## <a name="next-steps"></a><span data-ttu-id="51e37-251">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="51e37-251">Next steps</span></span>
<span data-ttu-id="51e37-252">Essa série de documentos abrange a recuperação de desastres e alta disponibilidade para aplicativos criados no Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="51e37-252">This series of documents covers disaster recovery and high availability for applications built on Microsoft Azure.</span></span> <span data-ttu-id="51e37-253">O próximo artigo dessa série é [Recuperação de desastre para aplicativos criados no Microsoft Azure](disaster-recovery-azure-applications.md).</span><span class="sxs-lookup"><span data-stu-id="51e37-253">The next article in the series is [Disaster recovery for applications built on Microsoft Azure](disaster-recovery-azure-applications.md).</span></span>

