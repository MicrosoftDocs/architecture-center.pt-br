---
title: Desenvolvimento de aplicativos resilientes para o Azure
description: Como criar aplicativos resilientes no Azure, para alta disponibilidade e recuperação de desastres.
author: MikeWasson
ms.date: 07/29/2018
ms.custom: resiliency
ms.openlocfilehash: 73600650dc96fe85ad59e286079a3523ef25d055
ms.sourcegitcommit: 1b5411f07d74f0a0680b33c266227d24014ba4d1
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/26/2018
ms.locfileid: "52305954"
---
# <a name="designing-resilient-applications-for-azure"></a><span data-ttu-id="ecf57-103">Desenvolvimento de aplicativos resilientes para o Azure</span><span class="sxs-lookup"><span data-stu-id="ecf57-103">Designing resilient applications for Azure</span></span>

<span data-ttu-id="ecf57-104">Em um sistema distribuído, ocorrerão falhas.</span><span class="sxs-lookup"><span data-stu-id="ecf57-104">In a distributed system, failures will happen.</span></span> <span data-ttu-id="ecf57-105">O hardware pode falhar.</span><span class="sxs-lookup"><span data-stu-id="ecf57-105">Hardware can fail.</span></span> <span data-ttu-id="ecf57-106">A rede pode ter falhas transitórias.</span><span class="sxs-lookup"><span data-stu-id="ecf57-106">The network can have transient failures.</span></span> <span data-ttu-id="ecf57-107">Raramente, um serviço ou uma região inteira pode sofrer uma interrupção. Mesmo assim, devemos estar preparados para isso.</span><span class="sxs-lookup"><span data-stu-id="ecf57-107">Rarely, an entire service or region may experience a disruption, but even those must be planned for.</span></span> 

<span data-ttu-id="ecf57-108">Criar um aplicativo confiável na nuvem é diferente da criação de um aplicativo confiável em uma configuração empresarial.</span><span class="sxs-lookup"><span data-stu-id="ecf57-108">Building a reliable application in the cloud is different than building a reliable application in an enterprise setting.</span></span> <span data-ttu-id="ecf57-109">Embora historicamente você possa ter comprado um hardware superior para escalar verticalmente, em um ambiente de nuvem, é preciso escalar horizontalmente.</span><span class="sxs-lookup"><span data-stu-id="ecf57-109">While historically you may have purchased higher-end hardware to scale up, in a cloud environment you must scale out instead of scaling up.</span></span> <span data-ttu-id="ecf57-110">Os custos para ambientes em nuvem são mantidos baixos com o uso de hardware de mercadoria.</span><span class="sxs-lookup"><span data-stu-id="ecf57-110">Costs for cloud environments are kept low through the use of commodity hardware.</span></span> <span data-ttu-id="ecf57-111">Em vez de nos concentrarmos em evitar falhas e otimizar o "tempo médio entre falhas", neste novo ambiente, o foco muda para "tempo médio de restauração."</span><span class="sxs-lookup"><span data-stu-id="ecf57-111">Instead of focusing on preventing failures and optimizing "mean time between failures," in this new environment the focus shifts to "mean time to restore."</span></span> <span data-ttu-id="ecf57-112">O objetivo é minimizar o efeito de uma falha.</span><span class="sxs-lookup"><span data-stu-id="ecf57-112">The goal is to minimize the effect of a failure.</span></span>

<span data-ttu-id="ecf57-113">Este artigo fornece uma visão geral de como criar aplicativos resilientes no Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="ecf57-113">This article provides an overview of how to build resilient applications in Microsoft Azure.</span></span> <span data-ttu-id="ecf57-114">Ele começa com uma definição do termo *resiliência* e conceitos de relacionados.</span><span class="sxs-lookup"><span data-stu-id="ecf57-114">It starts with a definition of the term *resiliency* and related concepts.</span></span> <span data-ttu-id="ecf57-115">Em seguida, descreve um processo para a obtenção de resiliência, usando uma abordagem estruturada sobre o tempo de vida de um aplicativo, desde o design e a implementação até a implantação e as operações.</span><span class="sxs-lookup"><span data-stu-id="ecf57-115">Then it describes a process for achieving resiliency, using a structured approach over the lifetime of an application, from design and implementation to deployment and operations.</span></span>

## <a name="what-is-resiliency"></a><span data-ttu-id="ecf57-116">O que é resiliência?</span><span class="sxs-lookup"><span data-stu-id="ecf57-116">What is resiliency?</span></span>
<span data-ttu-id="ecf57-117">**Resiliência** é a capacidade de um sistema de se recuperar de falhas e continuar funcionando.</span><span class="sxs-lookup"><span data-stu-id="ecf57-117">**Resiliency** is the ability of a system to recover from failures and continue to function.</span></span> <span data-ttu-id="ecf57-118">Não se trata de *evitar* falhas, mas *responder* a elas de uma maneira que evite o tempo de inatividade ou a perda de dados.</span><span class="sxs-lookup"><span data-stu-id="ecf57-118">It's not about *avoiding* failures, but *responding* to failures in a way that avoids downtime or data loss.</span></span> <span data-ttu-id="ecf57-119">A meta de resiliência é retornar o aplicativo a um estado totalmente funcional após uma falha.</span><span class="sxs-lookup"><span data-stu-id="ecf57-119">The goal of resiliency is to return the application to a fully functioning state following a failure.</span></span>

<span data-ttu-id="ecf57-120">Dois aspectos importantes de resiliência são alta disponibilidade e recuperação de desastres.</span><span class="sxs-lookup"><span data-stu-id="ecf57-120">Two important aspects of resiliency are high availability and disaster recovery.</span></span>

* <span data-ttu-id="ecf57-121">**HA (Alta Disponibilidade)** é a capacidade do aplicativo de continuar em execução em um estado íntegro, sem tempo de inatividade significativo.</span><span class="sxs-lookup"><span data-stu-id="ecf57-121">**High availability** (HA) is the ability of the application to continue running in a healthy state, without significant downtime.</span></span> <span data-ttu-id="ecf57-122">Por “estado íntegro” queremos dizer o aplicativo está respondendo e os usuários podem se conectar ao aplicativo e interagir com ele.</span><span class="sxs-lookup"><span data-stu-id="ecf57-122">By "healthy state," we mean the application is responsive, and users can connect to the application and interact with it.</span></span>  
* <span data-ttu-id="ecf57-123">**DR (Recuperação de Desastre)** é a capacidade de recuperação de incidentes raros, mas sérios: falhas não transitórias em larga escala, como interrupções de serviço que afetam toda a região.</span><span class="sxs-lookup"><span data-stu-id="ecf57-123">**Disaster recovery** (DR) is the ability to recover from rare but major incidents: non-transient, wide-scale failures, such as service disruption that affects an entire region.</span></span> <span data-ttu-id="ecf57-124">A recuperação de desastre inclui backup e arquivamento de dados e pode incluir a intervenção manual, como a restauração um banco de dados com base em um backup.</span><span class="sxs-lookup"><span data-stu-id="ecf57-124">Disaster recovery includes data backup and archiving, and may include manual intervention, such as restoring a database from backup.</span></span>

<span data-ttu-id="ecf57-125">Uma das formas de diferenciar a HA da DR é que a última é iniciada quando o impacto de uma falha excede a capacidade do design da HA para tratá-la.</span><span class="sxs-lookup"><span data-stu-id="ecf57-125">One way to think about HA versus DR is that DR starts when the impact of a fault exceeds the ability of the HA design to handle it.</span></span>  

<span data-ttu-id="ecf57-126">Quando você projeta buscando resiliência, você deve entender seus requisitos de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="ecf57-126">When you design resiliency, you must understand your availability requirements.</span></span> <span data-ttu-id="ecf57-127">Quanto tempo de inatividade é aceitável?</span><span class="sxs-lookup"><span data-stu-id="ecf57-127">How much downtime is acceptable?</span></span> <span data-ttu-id="ecf57-128">Trata-se parcialmente de uma questão de custo.</span><span class="sxs-lookup"><span data-stu-id="ecf57-128">This is partly a function of cost.</span></span> <span data-ttu-id="ecf57-129">Quanto o tempo de inatividade em potencial custará para sua empresa?</span><span class="sxs-lookup"><span data-stu-id="ecf57-129">How much will potential downtime cost your business?</span></span> <span data-ttu-id="ecf57-130">Quanto você deve investir para tornar o aplicativo altamente disponível?</span><span class="sxs-lookup"><span data-stu-id="ecf57-130">How much should you invest in making the application highly available?</span></span> <span data-ttu-id="ecf57-131">Você também precisa definir o que significa para o aplicativo estar disponível.</span><span class="sxs-lookup"><span data-stu-id="ecf57-131">You also have to define what it means for the application to be available.</span></span> <span data-ttu-id="ecf57-132">Por exemplo, o aplicativo está "inativo" se um cliente puder enviar uma ordem, mas o sistema não puder processá-la dentro do prazo normal?</span><span class="sxs-lookup"><span data-stu-id="ecf57-132">For example, is the application "down" if a customer can submit an order but the system cannot process it within the normal timeframe?</span></span> <span data-ttu-id="ecf57-133">Considere também a probabilidade da ocorrência de um tipo específico de interrupção e se uma estratégia de redução é econômica.</span><span class="sxs-lookup"><span data-stu-id="ecf57-133">Also consider the probability of a particular type of outage occurring, and whether a mitigation strategy is cost-effective.</span></span>

<span data-ttu-id="ecf57-134">Outro termo comum é **Continuidade dos Negócios** (BC), que é a capacidade de executar funções de negócios essenciais durante e após condições adversas, como um desastre natural ou um serviço inoperante.</span><span class="sxs-lookup"><span data-stu-id="ecf57-134">Another common term is **business continuity** (BC), which is the ability to perform essential business functions during and after adverse conditions, such as a natural disaster or a downed service.</span></span> <span data-ttu-id="ecf57-135">A BC abrange toda a operação de negócios, incluindo instalações físicas, pessoas, comunicações, transporte e IT.</span><span class="sxs-lookup"><span data-stu-id="ecf57-135">BC covers the entire operation of the business, including physical facilities, people, communications, transportation, and IT.</span></span> <span data-ttu-id="ecf57-136">Este artigo se concentra em aplicativos em nuvem, mas o planejamento de resiliência deve ser feito considerando-se o contexto dos requisitos gerais da BC.</span><span class="sxs-lookup"><span data-stu-id="ecf57-136">This article focuses on cloud applications, but resilience planning must be done in the context of overall BC requirements.</span></span> 

<span data-ttu-id="ecf57-137">O **backup de dados** é uma parte fundamental da recuperação de desastre.</span><span class="sxs-lookup"><span data-stu-id="ecf57-137">**Data backup** is a critical part of DR.</span></span> <span data-ttu-id="ecf57-138">Se os componentes sem monitoração de estado de um aplicativo falharem, você sempre poderá reimplantá-los.</span><span class="sxs-lookup"><span data-stu-id="ecf57-138">If the stateless components of an application fail, you can always redeploy them.</span></span> <span data-ttu-id="ecf57-139">Mas se os dados forem perdidos, o sistema não poderá retornar a um estado estável.</span><span class="sxs-lookup"><span data-stu-id="ecf57-139">But if data is lost, the system can't return to a stable state.</span></span> <span data-ttu-id="ecf57-140">O backup dos dados deve ser feito, idealmente em uma região diferente para o caso de um desastre em toda a região.</span><span class="sxs-lookup"><span data-stu-id="ecf57-140">Data must be backed up, ideally in a different region in case of a region-wide disaster.</span></span> 

<span data-ttu-id="ecf57-141">Backup é diferente de **replicação de dados**.</span><span class="sxs-lookup"><span data-stu-id="ecf57-141">Backup is distinct from **data replication**.</span></span> <span data-ttu-id="ecf57-142">Replicação de dados envolve a cópia de dados quase em tempo real, para que o sistema possa realizar failover rapidamente para uma réplica.</span><span class="sxs-lookup"><span data-stu-id="ecf57-142">Data replication involves copying data in near-real-time, so that the system can fail over quickly to a replica.</span></span> <span data-ttu-id="ecf57-143">Muitos sistemas de bancos de dados são compatíveis com replicação; Por exemplo, o SQL Server é compatível com Grupos de Disponibilidade Always On do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="ecf57-143">Many databases systems support replication; for example, SQL Server supports SQL Server Always On Availability Groups.</span></span> <span data-ttu-id="ecf57-144">A replicação de dados pode reduzir o tempo necessário para recuperar-se de uma interrupção, garantindo que uma réplica dos dados esteja sempre disponível.</span><span class="sxs-lookup"><span data-stu-id="ecf57-144">Data replication can reduce how long it takes to recover from an outage, by ensuring that a replica of the data is always standing by.</span></span> <span data-ttu-id="ecf57-145">No entanto, a replicação de dados não protegerá contra erro humano.</span><span class="sxs-lookup"><span data-stu-id="ecf57-145">However, data replication won't protect against human error.</span></span> <span data-ttu-id="ecf57-146">Se os dados forem corrompidos devido a erro humano, eles serão apenas copiados para as réplicas.</span><span class="sxs-lookup"><span data-stu-id="ecf57-146">If data gets corrupted because of human error, the corrupted data just gets copied to the replicas.</span></span> <span data-ttu-id="ecf57-147">Portanto, você ainda precisa incluir o backup de longo prazo em sua estratégia de DR.</span><span class="sxs-lookup"><span data-stu-id="ecf57-147">Therefore, you still need to include long-term backup in your DR strategy.</span></span> 

## <a name="process-to-achieve-resiliency"></a><span data-ttu-id="ecf57-148">Processo para obter resiliência</span><span class="sxs-lookup"><span data-stu-id="ecf57-148">Process to achieve resiliency</span></span>
<span data-ttu-id="ecf57-149">Resiliência não é um complemento.</span><span class="sxs-lookup"><span data-stu-id="ecf57-149">Resiliency is not an add-on.</span></span> <span data-ttu-id="ecf57-150">Ela deve ser criada no sistema e colocada em prática operacional.</span><span class="sxs-lookup"><span data-stu-id="ecf57-150">It must be designed into the system and put into operational practice.</span></span> <span data-ttu-id="ecf57-151">Aqui está um modelo geral a seguir:</span><span class="sxs-lookup"><span data-stu-id="ecf57-151">Here is a general model to follow:</span></span>

1. <span data-ttu-id="ecf57-152">**Defina** seus requisitos de disponibilidade, com base nas necessidades de negócios.</span><span class="sxs-lookup"><span data-stu-id="ecf57-152">**Define** your availability requirements, based on business needs.</span></span>
2. <span data-ttu-id="ecf57-153">**Crie** o aplicativo para garantir a resiliência.</span><span class="sxs-lookup"><span data-stu-id="ecf57-153">**Design** the application for resiliency.</span></span> <span data-ttu-id="ecf57-154">Inicie com uma arquitetura que segue práticas comprovadas e, em seguida, identifique os pontos de falha possíveis na arquitetura.</span><span class="sxs-lookup"><span data-stu-id="ecf57-154">Start with an architecture that follows proven practices, and then identify the possible failure points in that architecture.</span></span>
3. <span data-ttu-id="ecf57-155">**Implemente** estratégias para detectar e recuperar de falhas.</span><span class="sxs-lookup"><span data-stu-id="ecf57-155">**Implement** strategies to detect and recover from failures.</span></span> 
4. <span data-ttu-id="ecf57-156">**Teste** a implementação simulando falhas e disparando failovers forçados.</span><span class="sxs-lookup"><span data-stu-id="ecf57-156">**Test** the implementation by simulating faults and triggering forced failovers.</span></span> 
5. <span data-ttu-id="ecf57-157">**Implante** o aplicativo em produção usando um processo confiável e reproduzível.</span><span class="sxs-lookup"><span data-stu-id="ecf57-157">**Deploy** the application into production using a reliable, repeatable process.</span></span> 
6. <span data-ttu-id="ecf57-158">**Monitore** o aplicativo para detectar falhas.</span><span class="sxs-lookup"><span data-stu-id="ecf57-158">**Monitor** the application to detect failures.</span></span> <span data-ttu-id="ecf57-159">Ao monitorar o sistema, você pode medir a integridade do aplicativo e responder a incidentes, se necessário.</span><span class="sxs-lookup"><span data-stu-id="ecf57-159">By monitoring the system, you can gauge the health of the application and respond to incidents if necessary.</span></span> 
7. <span data-ttu-id="ecf57-160">**Responda** se houver falha que requer intervenções manuais.</span><span class="sxs-lookup"><span data-stu-id="ecf57-160">**Respond** if there are failure that require manual interventions.</span></span>

<span data-ttu-id="ecf57-161">No restante deste artigo, vamos abordar cada uma dessas etapas mais detalhadamente.</span><span class="sxs-lookup"><span data-stu-id="ecf57-161">In the remainder of this article, we discuss each of these steps in more detail.</span></span>

## <a name="define-your-availability-requirements"></a><span data-ttu-id="ecf57-162">Definir requisitos de disponibilidade</span><span class="sxs-lookup"><span data-stu-id="ecf57-162">Define your availability requirements</span></span>
<span data-ttu-id="ecf57-163">O planejamento da resiliência começa com os requisitos de negócios.</span><span class="sxs-lookup"><span data-stu-id="ecf57-163">Resiliency planning starts with business requirements.</span></span> <span data-ttu-id="ecf57-164">A seguir estão algumas abordagens para pensarmos sobre resiliência sob esses aspectos.</span><span class="sxs-lookup"><span data-stu-id="ecf57-164">Here are some approaches for thinking about resiliency in those terms.</span></span>

### <a name="decompose-by-workload"></a><span data-ttu-id="ecf57-165">Decompor por carga de trabalho</span><span class="sxs-lookup"><span data-stu-id="ecf57-165">Decompose by workload</span></span>
<span data-ttu-id="ecf57-166">Muitas soluções de nuvem consistem em várias cargas de trabalho de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="ecf57-166">Many cloud solutions consist of multiple application workloads.</span></span> <span data-ttu-id="ecf57-167">O termo "carga de trabalho" neste contexto significa um recurso discreto ou uma tarefa de computação, que pode ser logicamente separada de outras tarefas, em termos de requisitos de armazenamento de dados e lógica de negócios.</span><span class="sxs-lookup"><span data-stu-id="ecf57-167">The term "workload" in this context means a discrete capability or computing task, which can be logically separated from other tasks, in terms of business logic and data storage requirements.</span></span> <span data-ttu-id="ecf57-168">Por exemplo, um aplicativo de comércio eletrônico pode incluir as cargas de trabalho a seguir:</span><span class="sxs-lookup"><span data-stu-id="ecf57-168">For example, an e-commerce app might include the following workloads:</span></span>

* <span data-ttu-id="ecf57-169">Procura e pesquisa em um catálogo de produtos.</span><span class="sxs-lookup"><span data-stu-id="ecf57-169">Browse and search a product catalog.</span></span>
* <span data-ttu-id="ecf57-170">Criação e controle de pedidos.</span><span class="sxs-lookup"><span data-stu-id="ecf57-170">Create and track orders.</span></span>
* <span data-ttu-id="ecf57-171">Exibição de recomendações.</span><span class="sxs-lookup"><span data-stu-id="ecf57-171">View recommendations.</span></span>

<span data-ttu-id="ecf57-172">Essas cargas de trabalho podem ter diferentes requisitos de disponibilidade, escalabilidade, consistência de dados, recuperação de desastres e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="ecf57-172">These workloads might have different requirements for availability, scalability, data consistency, disaster recovery, and so forth.</span></span> <span data-ttu-id="ecf57-173">Novamente, essas são decisões comerciais.</span><span class="sxs-lookup"><span data-stu-id="ecf57-173">Again, these are business decisions.</span></span>

<span data-ttu-id="ecf57-174">Considere também os padrões de uso.</span><span class="sxs-lookup"><span data-stu-id="ecf57-174">Also consider usage patterns.</span></span> <span data-ttu-id="ecf57-175">Há certos períodos críticos quando o sistema tem que estar disponível?</span><span class="sxs-lookup"><span data-stu-id="ecf57-175">Are there certain critical periods when the system must be available?</span></span> <span data-ttu-id="ecf57-176">Por exemplo, um serviço de arquivamento de imposto não pode ficar inativo antes do prazo de entrega, um serviço de streaming de vídeo tem que continuar durante um evento esportivo importante, e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="ecf57-176">For example, a tax-filing service can't go down right before the filing deadline, a video streaming service must stay up during a big sports event, and so on.</span></span> <span data-ttu-id="ecf57-177">Durante os períodos críticos, talvez sejam necessárias implantações redundantes em várias regiões, para que o aplicativo possa fazer failover se uma região falhar.</span><span class="sxs-lookup"><span data-stu-id="ecf57-177">During the critical periods, you might have redundant deployments across several regions, so the application could fail over if one region failed.</span></span> <span data-ttu-id="ecf57-178">No entanto, uma implantação em várias regiões é mais cara, portanto, durante horários menos críticos, você pode executar o aplicativo em uma única região.</span><span class="sxs-lookup"><span data-stu-id="ecf57-178">However, a multi-region deployment is more expensive, so during less critical times, you might run the application in a single region.</span></span>

### <a name="rto-and-rpo"></a><span data-ttu-id="ecf57-179">RTO e RPO</span><span class="sxs-lookup"><span data-stu-id="ecf57-179">RTO and RPO</span></span>
<span data-ttu-id="ecf57-180">Duas métricas importantes a considerar são o Objetivo do Tempo de Recuperação e o Objetivo do Ponto de Recuperação.</span><span class="sxs-lookup"><span data-stu-id="ecf57-180">Two important metrics to consider are the recovery time objective and recovery point objective.</span></span>

* <span data-ttu-id="ecf57-181">**Objetivo do Tempo de Recuperação** (RTO) é o tempo máximo aceitável que um aplicativo pode ficar indisponível após um incidente.</span><span class="sxs-lookup"><span data-stu-id="ecf57-181">**Recovery time objective** (RTO) is the maximum acceptable time that an application can be unavailable after an incident.</span></span> <span data-ttu-id="ecf57-182">Se o RTO for de 90 minutos, você deverá ser capaz de restaurar o aplicativo para um estado de execução dentro de 90 minutos a partir do início de um desastre.</span><span class="sxs-lookup"><span data-stu-id="ecf57-182">If your RTO is 90 minutes, you must be able to restore the application to a running state within 90 minutes from the start of a disaster.</span></span> <span data-ttu-id="ecf57-183">Se você tiver um RTO muito baixo, poderá manter uma segunda implantação continuamente em execução no modo de espera, para proteger-se contra uma interrupção regional.</span><span class="sxs-lookup"><span data-stu-id="ecf57-183">If you have a very low RTO, you might keep a second deployment continually running on standby, to protect against a regional outage.</span></span>

* <span data-ttu-id="ecf57-184">**Objetivo do Ponto de Recuperação** (RPO) é a duração máxima de perda de dados aceitável durante um desastre.</span><span class="sxs-lookup"><span data-stu-id="ecf57-184">**Recovery point objective** (RPO) is the maximum duration of data loss that is acceptable during a disaster.</span></span> <span data-ttu-id="ecf57-185">Por exemplo, se você armazena dados em um único banco de dados, com nenhuma replicação para outros bancos de dados, e executar backups a cada hora, poderá perder até uma hora de dados.</span><span class="sxs-lookup"><span data-stu-id="ecf57-185">For example, if you store data in a single database, with no replication to other databases, and perform hourly backups, you could lose up to an hour of data.</span></span> 

<span data-ttu-id="ecf57-186">RTO e RPO são os requisitos de negócios.</span><span class="sxs-lookup"><span data-stu-id="ecf57-186">RTO and RPO are business requirements.</span></span> <span data-ttu-id="ecf57-187">Realizar uma avaliação de risco pode ajudá-lo a definir o RTO e o RPO do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="ecf57-187">Conducting a risk assessment can help you define the application's RTO and RPO.</span></span> <span data-ttu-id="ecf57-188">Outra métrica comum é **Tempo Médio para Recuperar** (MTTR), que é o tempo médio necessário para restaurar o aplicativo após uma falha.</span><span class="sxs-lookup"><span data-stu-id="ecf57-188">Another common metric is **mean time to recover** (MTTR), which is the average time that it takes to restore the application after a failure.</span></span> <span data-ttu-id="ecf57-189">MTTR é um fato empírico sobre um sistema.</span><span class="sxs-lookup"><span data-stu-id="ecf57-189">MTTR is an empirical fact about a system.</span></span> <span data-ttu-id="ecf57-190">Se o MTTR exceder o RTO, uma falha no sistema causará uma interrupção do negócio inaceitável, porque não é possível restaurar o sistema dentro do RTO definido.</span><span class="sxs-lookup"><span data-stu-id="ecf57-190">If MTTR exceeds the RTO, then a failure in the system will cause an unacceptable business disruption, because it won't be possible to restore the system within the defined RTO.</span></span> 

### <a name="slas"></a><span data-ttu-id="ecf57-191">SLAs</span><span class="sxs-lookup"><span data-stu-id="ecf57-191">SLAs</span></span>
<span data-ttu-id="ecf57-192">O [SLA (Contrato de Nível de Serviço)][sla] descreve os compromissos da Microsoft com relação ao tempo de atividade e à conectividade.</span><span class="sxs-lookup"><span data-stu-id="ecf57-192">In Azure, the [Service Level Agreement][sla] (SLA) describes Microsoft’s commitments for uptime and connectivity.</span></span> <span data-ttu-id="ecf57-193">Se o SLA para um serviço específico for de 99,9%, isso significa que você deve esperar que o serviço esteja disponível 99,9% do tempo.</span><span class="sxs-lookup"><span data-stu-id="ecf57-193">If the SLA for a particular service is 99.9%, it means you should expect the service to be available 99.9% of the time.</span></span>

> [!NOTE]
> <span data-ttu-id="ecf57-194">O SLA do Azure também inclui provisões para se obter um crédito de serviço se o SLA não for atendido, além de definições específicas de "disponibilidade" para cada serviço.</span><span class="sxs-lookup"><span data-stu-id="ecf57-194">The Azure SLA also includes provisions for obtaining a service credit if the SLA is not met, along with specific definitions of "availability" for each service.</span></span> <span data-ttu-id="ecf57-195">Esse aspecto do SLA atua como uma política de imposição.</span><span class="sxs-lookup"><span data-stu-id="ecf57-195">That aspect of the SLA acts as an enforcement policy.</span></span> 
> 
> 

<span data-ttu-id="ecf57-196">Você deve definir seus próprios SLAs de destino para cada carga de trabalho em sua solução.</span><span class="sxs-lookup"><span data-stu-id="ecf57-196">You should define your own target SLAs for each workload in your solution.</span></span> <span data-ttu-id="ecf57-197">Um SLA possibilita avaliar se a arquitetura atende aos requisitos de negócios.</span><span class="sxs-lookup"><span data-stu-id="ecf57-197">An SLA makes it possible to evaluate whether the architecture meets the business requirements.</span></span> <span data-ttu-id="ecf57-198">Por exemplo, se uma carga de trabalho requer tempo de disponibilidade de 99,99%, mas depende de um serviço com um SLA de 99,9%, o serviço não poderá ser um ponto único de falha no sistema.</span><span class="sxs-lookup"><span data-stu-id="ecf57-198">For example, if a workload requires 99.99% uptime, but depends on a service with a 99.9% SLA, that service cannot be a single-point of failure in the system.</span></span> <span data-ttu-id="ecf57-199">Uma solução é ter um caminho de fallback no caso de falha do serviço ou tomar outras medidas para recuperar uma falha nesse serviço.</span><span class="sxs-lookup"><span data-stu-id="ecf57-199">One remedy is to have a fallback path in case the service fails, or take other measures to recover from a failure in that service.</span></span> 

<span data-ttu-id="ecf57-200">A tabela a seguir mostra o tempo de inatividade cumulativo em potencial para vários níveis de SLA.</span><span class="sxs-lookup"><span data-stu-id="ecf57-200">The following table shows the potential cumulative downtime for various SLA levels.</span></span> 

| <span data-ttu-id="ecf57-201">Contrato de Nível de Serviço</span><span class="sxs-lookup"><span data-stu-id="ecf57-201">SLA</span></span> | <span data-ttu-id="ecf57-202">Tempo de inatividade por semana</span><span class="sxs-lookup"><span data-stu-id="ecf57-202">Downtime per week</span></span> | <span data-ttu-id="ecf57-203">Tempo de inatividade por mês</span><span class="sxs-lookup"><span data-stu-id="ecf57-203">Downtime per month</span></span> | <span data-ttu-id="ecf57-204">Tempo de inatividade por ano</span><span class="sxs-lookup"><span data-stu-id="ecf57-204">Downtime per year</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="ecf57-205">99%</span><span class="sxs-lookup"><span data-stu-id="ecf57-205">99%</span></span> |<span data-ttu-id="ecf57-206">1,68 hora</span><span class="sxs-lookup"><span data-stu-id="ecf57-206">1.68 hours</span></span> |<span data-ttu-id="ecf57-207">7,2 horas</span><span class="sxs-lookup"><span data-stu-id="ecf57-207">7.2 hours</span></span> |<span data-ttu-id="ecf57-208">3,65 dias</span><span class="sxs-lookup"><span data-stu-id="ecf57-208">3.65 days</span></span> |
| <span data-ttu-id="ecf57-209">99,9%</span><span class="sxs-lookup"><span data-stu-id="ecf57-209">99.9%</span></span> |<span data-ttu-id="ecf57-210">10,1 minutos</span><span class="sxs-lookup"><span data-stu-id="ecf57-210">10.1 minutes</span></span> |<span data-ttu-id="ecf57-211">43,2 minutos</span><span class="sxs-lookup"><span data-stu-id="ecf57-211">43.2 minutes</span></span> |<span data-ttu-id="ecf57-212">8,76 horas</span><span class="sxs-lookup"><span data-stu-id="ecf57-212">8.76 hours</span></span> |
| <span data-ttu-id="ecf57-213">99,95%</span><span class="sxs-lookup"><span data-stu-id="ecf57-213">99.95%</span></span> |<span data-ttu-id="ecf57-214">5 minutos</span><span class="sxs-lookup"><span data-stu-id="ecf57-214">5 minutes</span></span> |<span data-ttu-id="ecf57-215">21,6 minutos</span><span class="sxs-lookup"><span data-stu-id="ecf57-215">21.6 minutes</span></span> |<span data-ttu-id="ecf57-216">4,38 horas</span><span class="sxs-lookup"><span data-stu-id="ecf57-216">4.38 hours</span></span> |
| <span data-ttu-id="ecf57-217">99,99%</span><span class="sxs-lookup"><span data-stu-id="ecf57-217">99.99%</span></span> |<span data-ttu-id="ecf57-218">1,01 minutos</span><span class="sxs-lookup"><span data-stu-id="ecf57-218">1.01 minutes</span></span> |<span data-ttu-id="ecf57-219">4,32 minutos</span><span class="sxs-lookup"><span data-stu-id="ecf57-219">4.32 minutes</span></span> |<span data-ttu-id="ecf57-220">52,56 minutos</span><span class="sxs-lookup"><span data-stu-id="ecf57-220">52.56 minutes</span></span> |
| <span data-ttu-id="ecf57-221">99,999%</span><span class="sxs-lookup"><span data-stu-id="ecf57-221">99.999%</span></span> |<span data-ttu-id="ecf57-222">6 segundos</span><span class="sxs-lookup"><span data-stu-id="ecf57-222">6 seconds</span></span> |<span data-ttu-id="ecf57-223">25,9 segundos</span><span class="sxs-lookup"><span data-stu-id="ecf57-223">25.9 seconds</span></span> |<span data-ttu-id="ecf57-224">5,26 minutos</span><span class="sxs-lookup"><span data-stu-id="ecf57-224">5.26 minutes</span></span> |

<span data-ttu-id="ecf57-225">Obviamente, a alta disponibilidade é melhor, no caso de tudo ser igual.</span><span class="sxs-lookup"><span data-stu-id="ecf57-225">Of course, higher availability is better, everything else being equal.</span></span> <span data-ttu-id="ecf57-226">Mas, quando você se esforça por mais 9s, o custo e a complexidade aumentam para atingir esse nível de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="ecf57-226">But as you strive for more 9s, the cost and complexity to achieve that level of availability grows.</span></span> <span data-ttu-id="ecf57-227">Um tempo de disponibilidade de 99,99% se traduz em cerca de 5 minutos de inatividade total por mês.</span><span class="sxs-lookup"><span data-stu-id="ecf57-227">An uptime of 99.99% translates to about 5 minutes of total downtime per month.</span></span> <span data-ttu-id="ecf57-228">A complexidade adicional e o custo compensam valem a pena para alcançar cinco 9s?</span><span class="sxs-lookup"><span data-stu-id="ecf57-228">Is it worth the additional complexity and cost to reach five 9s?</span></span> <span data-ttu-id="ecf57-229">A resposta depende dos requisitos de negócios.</span><span class="sxs-lookup"><span data-stu-id="ecf57-229">The answer depends on the business requirements.</span></span> 

<span data-ttu-id="ecf57-230">Aqui estão algumas outras considerações ao definir um SLA:</span><span class="sxs-lookup"><span data-stu-id="ecf57-230">Here are some other considerations when defining an SLA:</span></span>

* <span data-ttu-id="ecf57-231">Para obter quatro 9s (99,99%), você provavelmente não pode depender de intervenção manual para se recuperar de falhas.</span><span class="sxs-lookup"><span data-stu-id="ecf57-231">To achieve four 9's (99.99%), you probably can't rely on manual intervention to recover from failures.</span></span> <span data-ttu-id="ecf57-232">O aplicativo deve ser de autodiagnóstico e autorrecuperação.</span><span class="sxs-lookup"><span data-stu-id="ecf57-232">The application must be self-diagnosing and self-healing.</span></span> 
* <span data-ttu-id="ecf57-233">Além de quatro 9s, é difícil detectar problemas rápido o suficiente para atender ao SLA.</span><span class="sxs-lookup"><span data-stu-id="ecf57-233">Beyond four 9's, it is challenging to detect outages quickly enough to meet the SLA.</span></span>
* <span data-ttu-id="ecf57-234">Pense no intervalo de tempo ao qual a medição do seu SLA está relacionada.</span><span class="sxs-lookup"><span data-stu-id="ecf57-234">Think about the time window that your SLA is measured against.</span></span> <span data-ttu-id="ecf57-235">Quanto menor for o intervalo, menor será a tolerância.</span><span class="sxs-lookup"><span data-stu-id="ecf57-235">The smaller the window, the tighter the tolerances.</span></span> <span data-ttu-id="ecf57-236">Provavelmente não faz sentido definir seu SLA em termos de tempo de atividade por hora ou dia.</span><span class="sxs-lookup"><span data-stu-id="ecf57-236">It probably doesn't make sense to define your SLA in terms of hourly or daily uptime.</span></span> 

### <a name="composite-slas"></a><span data-ttu-id="ecf57-237">SLAs compostos</span><span class="sxs-lookup"><span data-stu-id="ecf57-237">Composite SLAs</span></span>
<span data-ttu-id="ecf57-238">Considere um aplicativo Web do Serviço de Aplicativo que grava no banco de dados do SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="ecf57-238">Consider an App Service web app that writes to Azure SQL Database.</span></span> <span data-ttu-id="ecf57-239">No momento da redação deste artigo, esses serviços do Azure têm os seguintes SLAs:</span><span class="sxs-lookup"><span data-stu-id="ecf57-239">At the time of this writing, these Azure services have the following SLAs:</span></span>

* <span data-ttu-id="ecf57-240">Aplicativos Web do Serviço de Aplicativo = 99,95%</span><span class="sxs-lookup"><span data-stu-id="ecf57-240">App Service Web Apps = 99.95%</span></span>
* <span data-ttu-id="ecf57-241">Banco de dados SQL = 99,99%</span><span class="sxs-lookup"><span data-stu-id="ecf57-241">SQL Database = 99.99%</span></span>

![SLA composto](./images/sla1.png)

<span data-ttu-id="ecf57-243">Qual é o tempo de inatividade máximo esperado para este aplicativo?</span><span class="sxs-lookup"><span data-stu-id="ecf57-243">What is the maximum downtime you would expect for this application?</span></span> <span data-ttu-id="ecf57-244">Se o serviço falhar, o aplicativo inteiro falhará.</span><span class="sxs-lookup"><span data-stu-id="ecf57-244">If either service fails, the whole application fails.</span></span> <span data-ttu-id="ecf57-245">Em geral, a probabilidade de cada serviço com falha é independente, portanto, o SLA composto para este aplicativo é de 99,95% &times; 99,99% = % 99,94%.</span><span class="sxs-lookup"><span data-stu-id="ecf57-245">In general, the probability of each service failing is independent, so the composite SLA for this application is 99.95% &times; 99.99% = 99.94%.</span></span> <span data-ttu-id="ecf57-246">Isso é menos do que os SLAs individuais, o que não é surpresa, porque um aplicativo que depende de vários serviços possui mais pontos de falha em potencial.</span><span class="sxs-lookup"><span data-stu-id="ecf57-246">That's lower than the individual SLAs, which isn't surprising, because an application that relies on multiple services has more potential failure points.</span></span> 

<span data-ttu-id="ecf57-247">Por outro lado, você pode melhorar o SLA composto criando caminhos de fallback independentes.</span><span class="sxs-lookup"><span data-stu-id="ecf57-247">On the other hand, you can improve the composite SLA by creating independent fallback paths.</span></span> <span data-ttu-id="ecf57-248">Por exemplo, se o banco de dados SQL não estiver disponível, coloque as transações em uma fila, para serem processadas posteriormente.</span><span class="sxs-lookup"><span data-stu-id="ecf57-248">For example, if SQL Database is unavailable, put transactions into a queue, to be processed later.</span></span>

![SLA composto](./images/sla2.png)

<span data-ttu-id="ecf57-250">Com esse design, o aplicativo ainda estará disponível mesmo se não puder se conectar ao banco de dados.</span><span class="sxs-lookup"><span data-stu-id="ecf57-250">With this design, the application is still available even if it can't connect to the database.</span></span> <span data-ttu-id="ecf57-251">No entanto, ele falhará se o banco de dados e a fila falharem ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="ecf57-251">However, it fails if the database and the queue both fail at the same time.</span></span> <span data-ttu-id="ecf57-252">A porcentagem esperada de tempo de uma falha simultânea é de 0,0001 &times; 0,001, portanto, o SLA composto para este caminho combinado é:</span><span class="sxs-lookup"><span data-stu-id="ecf57-252">The expected percentage of time for a simultaneous failure is 0.0001 &times; 0.001, so the composite SLA for this combined path is:</span></span>  

* <span data-ttu-id="ecf57-253">Banco de dados OU fila = 1,0 &minus; (0,0001 &times; 0,001) = 99,99999%</span><span class="sxs-lookup"><span data-stu-id="ecf57-253">Database OR queue = 1.0 &minus; (0.0001 &times; 0.001) = 99.99999%</span></span>

<span data-ttu-id="ecf57-254">O SLA composto total é:</span><span class="sxs-lookup"><span data-stu-id="ecf57-254">The total composite SLA is:</span></span>

* <span data-ttu-id="ecf57-255">Aplicativo Web E (banco de dados OU fila) = 99,95% &times; 99,99999% = ~99,95%</span><span class="sxs-lookup"><span data-stu-id="ecf57-255">Web app AND (database OR queue) = 99.95% &times; 99.99999% = ~99.95%</span></span>

<span data-ttu-id="ecf57-256">Mas existem compensações para essa abordagem.</span><span class="sxs-lookup"><span data-stu-id="ecf57-256">But there are tradeoffs to this approach.</span></span> <span data-ttu-id="ecf57-257">A lógica do aplicativo é mais complexa. Você está pagando pela fila e pode haver problemas de consistência de dados a serem considerados.</span><span class="sxs-lookup"><span data-stu-id="ecf57-257">The application logic is more complex, you are paying for the queue, and there may be data consistency issues to consider.</span></span>

<span data-ttu-id="ecf57-258">**SLA para implantações em várias regiões**.</span><span class="sxs-lookup"><span data-stu-id="ecf57-258">**SLA for multi-region deployments**.</span></span> <span data-ttu-id="ecf57-259">Outra técnica de HA é implantar o aplicativo em mais de uma região e usar o Gerenciador de Tráfego do Azure para fazer o failover se o aplicativo falhar em uma região.</span><span class="sxs-lookup"><span data-stu-id="ecf57-259">Another HA technique is to deploy the application in more than one region, and use Azure Traffic Manager to fail over if the application fails in one region.</span></span> <span data-ttu-id="ecf57-260">Para uma implantação de duas regiões, o SLA composto é calculado da maneira a seguir.</span><span class="sxs-lookup"><span data-stu-id="ecf57-260">For a two-region deployment, the composite SLA is calculated as follows.</span></span> 

<span data-ttu-id="ecf57-261">Permita que *N* seja o SLA composto para o aplicativo implantado em uma região.</span><span class="sxs-lookup"><span data-stu-id="ecf57-261">Let *N* be the composite SLA for the application deployed in one region.</span></span> <span data-ttu-id="ecf57-262">A possibilidade esperada de que o aplicativo falhará em ambas as regiões ao mesmo tempo será de (1 &minus; N) &times; (1 &minus; N).</span><span class="sxs-lookup"><span data-stu-id="ecf57-262">The expected chance that the application will fail in both regions at the same time is (1 &minus; N) &times; (1 &minus; N).</span></span> <span data-ttu-id="ecf57-263">Portanto:</span><span class="sxs-lookup"><span data-stu-id="ecf57-263">Therefore,</span></span>

* <span data-ttu-id="ecf57-264">SLA combinado para ambas as regiões = 1 &minus; (1 &minus; N)(1 &minus; N) = N + (1 &minus; N)N</span><span class="sxs-lookup"><span data-stu-id="ecf57-264">Combined SLA for both regions = 1 &minus; (1 &minus; N)(1 &minus; N) = N + (1 &minus; N)N</span></span>

<span data-ttu-id="ecf57-265">Por fim, você deve considerar o [SLA para o Gerenciador de Tráfego][tm-sla].</span><span class="sxs-lookup"><span data-stu-id="ecf57-265">Finally, you must factor in the [SLA for Traffic Manager][tm-sla].</span></span> <span data-ttu-id="ecf57-266">No momento da redação deste artigo, o SLA para o SLA do Gerenciador de Tráfego é de 99,99%.</span><span class="sxs-lookup"><span data-stu-id="ecf57-266">At the time of this writing, the SLA for Traffic Manager SLA is 99.99%.</span></span>

* <span data-ttu-id="ecf57-267">SLA composto = 99,99% &times; (SLA combinado para ambas as regiões)</span><span class="sxs-lookup"><span data-stu-id="ecf57-267">Composite SLA = 99.99% &times; (combined SLA for both regions)</span></span>

<span data-ttu-id="ecf57-268">Além disso, o failover não é instantâneo e pode resultar em algum tempo de inatividade durante um failover.</span><span class="sxs-lookup"><span data-stu-id="ecf57-268">Also, failing over is not instantaneous and can result in some downtime during a failover.</span></span> <span data-ttu-id="ecf57-269">Consulte [Monitoramento e failover de ponto de extremidade do Gerenciador de tráfego][tm-failover].</span><span class="sxs-lookup"><span data-stu-id="ecf57-269">See [Traffic Manager endpoint monitoring and failover][tm-failover].</span></span>

<span data-ttu-id="ecf57-270">O número calculado de SLA é uma linha de base útil, mas ela não informa a história toda sobre a disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="ecf57-270">The calculated SLA number is a useful baseline, but it doesn't tell the whole story about availability.</span></span> <span data-ttu-id="ecf57-271">Geralmente, um aplicativo pode degradar normalmente quando um caminho não crítico falha.</span><span class="sxs-lookup"><span data-stu-id="ecf57-271">Often, an application can degrade gracefully when a non-critical path fails.</span></span> <span data-ttu-id="ecf57-272">Considere um aplicativo que mostra um catálogo de livros.</span><span class="sxs-lookup"><span data-stu-id="ecf57-272">Consider an application that shows a catalog of books.</span></span> <span data-ttu-id="ecf57-273">Se o aplicativo não pode recuperar a imagem em miniatura da capa, poderá mostrar uma imagem de espaço reservado.</span><span class="sxs-lookup"><span data-stu-id="ecf57-273">If the application can't retrieve the thumbnail image for the cover, it might show a placeholder image.</span></span> <span data-ttu-id="ecf57-274">Nesse caso, a falha ao obter a imagem não reduz o tempo de atividade do aplicativo, embora afete a experiência do usuário.</span><span class="sxs-lookup"><span data-stu-id="ecf57-274">In that case, failing to get the image does not reduce the application's uptime, although it affects the user experience.</span></span>  

## <a name="design-for-resiliency"></a><span data-ttu-id="ecf57-275">Design para resiliência</span><span class="sxs-lookup"><span data-stu-id="ecf57-275">Design for resiliency</span></span>

<span data-ttu-id="ecf57-276">Durante a fase de design, você deve executar uma Análise do Modo de Falha (FMA).</span><span class="sxs-lookup"><span data-stu-id="ecf57-276">During the design phase, you should perform a failure mode analysis (FMA).</span></span> <span data-ttu-id="ecf57-277">O objetivo de uma FMA é identificar possíveis pontos de falha e definir como o aplicativo responde a essas falhas.</span><span class="sxs-lookup"><span data-stu-id="ecf57-277">The goal of an FMA is to identify possible points of failure, and define how the application will respond to those failures.</span></span>

* <span data-ttu-id="ecf57-278">Como o aplicativo detectará esse tipo de falha?</span><span class="sxs-lookup"><span data-stu-id="ecf57-278">How will the application detect this type of failure?</span></span>
* <span data-ttu-id="ecf57-279">Como o aplicativo responderá a esse tipo de falha?</span><span class="sxs-lookup"><span data-stu-id="ecf57-279">How will the application respond to this type of failure?</span></span>
* <span data-ttu-id="ecf57-280">Como você pode fazer logon e monitorar esse tipo de falha?</span><span class="sxs-lookup"><span data-stu-id="ecf57-280">How will you log and monitor this type of failure?</span></span> 

<span data-ttu-id="ecf57-281">Para obter mais informações sobre o processo FMA, com as recomendações específicas para o Azure, consulte [Orientação de resiliência do Azure: Análise de Falha de Modo][fma].</span><span class="sxs-lookup"><span data-stu-id="ecf57-281">For more information about the FMA process, with specific recommendations for Azure, see [Azure resiliency guidance: Failure mode analysis][fma].</span></span>

### <a name="example-of-identifying-failure-modes-and-detection-strategy"></a><span data-ttu-id="ecf57-282">Exemplo de identificação de modos de falha e estratégia de detecção</span><span class="sxs-lookup"><span data-stu-id="ecf57-282">Example of identifying failure modes and detection strategy</span></span>
<span data-ttu-id="ecf57-283">**Ponto de falha:** chamada para um serviço Web externo/API.</span><span class="sxs-lookup"><span data-stu-id="ecf57-283">**Failure point:** Call to an external web service / API.</span></span>

| <span data-ttu-id="ecf57-284">Modo de falha</span><span class="sxs-lookup"><span data-stu-id="ecf57-284">Failure mode</span></span> | <span data-ttu-id="ecf57-285">Estratégia de detecção</span><span class="sxs-lookup"><span data-stu-id="ecf57-285">Detection strategy</span></span> |
| --- | --- |
| <span data-ttu-id="ecf57-286">O serviço está indisponível</span><span class="sxs-lookup"><span data-stu-id="ecf57-286">Service is unavailable</span></span> |<span data-ttu-id="ecf57-287">HTTP 5xx</span><span class="sxs-lookup"><span data-stu-id="ecf57-287">HTTP 5xx</span></span> |
| <span data-ttu-id="ecf57-288">Limitação</span><span class="sxs-lookup"><span data-stu-id="ecf57-288">Throttling</span></span> |<span data-ttu-id="ecf57-289">HTTP 429 (Número Excessivo de Solicitações)</span><span class="sxs-lookup"><span data-stu-id="ecf57-289">HTTP 429 (Too Many Requests)</span></span> |
| <span data-ttu-id="ecf57-290">Autenticação</span><span class="sxs-lookup"><span data-stu-id="ecf57-290">Authentication</span></span> |<span data-ttu-id="ecf57-291">HTTP 401 (Não Autorizado)</span><span class="sxs-lookup"><span data-stu-id="ecf57-291">HTTP 401 (Unauthorized)</span></span> |
| <span data-ttu-id="ecf57-292">Resposta lenta</span><span class="sxs-lookup"><span data-stu-id="ecf57-292">Slow response</span></span> |<span data-ttu-id="ecf57-293">Tempo limite da solicitação atingido</span><span class="sxs-lookup"><span data-stu-id="ecf57-293">Request times out</span></span> |


### <a name="redundancy-and-designing-for-failure"></a><span data-ttu-id="ecf57-294">Redundância e a criação pensando em falha</span><span class="sxs-lookup"><span data-stu-id="ecf57-294">Redundancy and designing for failure</span></span>

<span data-ttu-id="ecf57-295">Falhas podem variar quanto ao escopo do seu impacto.</span><span class="sxs-lookup"><span data-stu-id="ecf57-295">Failures can vary in the scope of their impact.</span></span> <span data-ttu-id="ecf57-296">Algumas falhas de hardware, como um disco com falha, podem afetar um único computador host.</span><span class="sxs-lookup"><span data-stu-id="ecf57-296">Some hardware failures, such as a failed disk, may affect a single host machine.</span></span> <span data-ttu-id="ecf57-297">Um comutador de rede com falha pode afetar um rack de servidor inteiro.</span><span class="sxs-lookup"><span data-stu-id="ecf57-297">A failed network switch could affect a whole server rack.</span></span> <span data-ttu-id="ecf57-298">Menos comuns são falhas que interrompem um data center inteiro, tais como uma perda de energia em um data center.</span><span class="sxs-lookup"><span data-stu-id="ecf57-298">Less common are failures that disrupt a whole data center, such as loss of power in a data center.</span></span> <span data-ttu-id="ecf57-299">Raramente, toda uma região pode se tornar não disponível.</span><span class="sxs-lookup"><span data-stu-id="ecf57-299">Rarely, an entire region could become unavailable.</span></span>

<span data-ttu-id="ecf57-300">Uma das principais maneiras de se tornar um aplicativo resiliente é por meio de redundância.</span><span class="sxs-lookup"><span data-stu-id="ecf57-300">One of the main ways to make an application resilient is through redundancy.</span></span> <span data-ttu-id="ecf57-301">Mas você precisa planejar essa redundância ao projetar o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="ecf57-301">But you need to plan for this redundancy when you design the application.</span></span> <span data-ttu-id="ecf57-302">Além disso, o nível de redundância necessário depende de suas necessidades de negócios &mdash; nem todo aplicativo precisa de redundância entre regiões para se proteger contra uma interrupção regional.</span><span class="sxs-lookup"><span data-stu-id="ecf57-302">Also, the level of redundancy that you need depends on your business requirements &mdash; not every application needs redundancy across regions to guard against a regional outage.</span></span> <span data-ttu-id="ecf57-303">Em geral, há um equilíbrio entre mais redundância e confiabilidade em relação a maiores custo e complexidade.</span><span class="sxs-lookup"><span data-stu-id="ecf57-303">In general, there is a tradeoff between greater redundancy and reliability versus higher cost and complexity.</span></span>  

<span data-ttu-id="ecf57-304">O Azure tem um número de recursos para tornar um aplicativo redundante em cada nível de falha, desde uma VM individual até uma região inteira.</span><span class="sxs-lookup"><span data-stu-id="ecf57-304">Azure has a number of features to make an application redundant at every level of failure, from an individual VM to an entire region.</span></span> 

![](./images/redundancy.svg)

<span data-ttu-id="ecf57-305">**VM individual**.</span><span class="sxs-lookup"><span data-stu-id="ecf57-305">**Single VM**.</span></span> <span data-ttu-id="ecf57-306">O Azure fornece um SLA de tempo de atividade para VMs individuais.</span><span class="sxs-lookup"><span data-stu-id="ecf57-306">Azure provides an uptime SLA for single VMs.</span></span> <span data-ttu-id="ecf57-307">Embora você possa obter um SLA mais alto executando duas ou mais VMs, uma única VM pode ser suficientemente confiável para algumas cargas de trabalho.</span><span class="sxs-lookup"><span data-stu-id="ecf57-307">Although you can get a higher SLA by running two or more VMs, a single VM may be reliable enough for some workloads.</span></span> <span data-ttu-id="ecf57-308">Para cargas de trabalho de produção, é recomendável usar duas ou mais máquinas virtuais para redundância.</span><span class="sxs-lookup"><span data-stu-id="ecf57-308">For production workloads, we recommend using two or more VMs for redundancy.</span></span> 

<span data-ttu-id="ecf57-309">**Conjuntos de disponibilidade**.</span><span class="sxs-lookup"><span data-stu-id="ecf57-309">**Availability sets**.</span></span> <span data-ttu-id="ecf57-310">Para se proteger contra falhas de hardware localizadas, como falha em um comutador de rede ou de disco, implante duas ou mais VMs em um conjunto de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="ecf57-310">To protect against localized hardware failures, such as a disk or network switch failing, deploy two or more VMs in an availability set.</span></span> <span data-ttu-id="ecf57-311">Um conjunto de disponibilidade consiste em dois ou mais *domínios de falha* que compartilham um comutador de rede e uma fonte de energia comuns.</span><span class="sxs-lookup"><span data-stu-id="ecf57-311">An availability set consists of two or more *fault domains* that share a common power source and network switch.</span></span> <span data-ttu-id="ecf57-312">Máquinas virtuais em um conjunto de disponibilidade são distribuídas entre os domínios de falha, portanto, se uma falha de hardware afeta um domínio de falha, o tráfego de rede ainda poderá ser roteado para as VMs nos outros domínios de falha.</span><span class="sxs-lookup"><span data-stu-id="ecf57-312">VMs in an availability set are distributed across the fault domains, so if a hardware failure affects one fault domain, network traffic can still be routed the VMs in the other fault domains.</span></span> <span data-ttu-id="ecf57-313">Para obter mais informações sobre conjuntos de disponibilidade, consulte [Gerenciar a disponibilidade das máquinas virtuais do Windows no Azure](/azure/virtual-machines/windows/manage-availability).</span><span class="sxs-lookup"><span data-stu-id="ecf57-313">For more information about Availability Sets, see [Manage the availability of Windows virtual machines in Azure](/azure/virtual-machines/windows/manage-availability).</span></span>

<span data-ttu-id="ecf57-314">**Zonas de disponibilidades**.</span><span class="sxs-lookup"><span data-stu-id="ecf57-314">**Availability zones**.</span></span>  <span data-ttu-id="ecf57-315">Uma Zona de Disponibilidade é uma zona fisicamente separada em uma região do Azure.</span><span class="sxs-lookup"><span data-stu-id="ecf57-315">An Availability Zone is a physically separate zone within an Azure region.</span></span> <span data-ttu-id="ecf57-316">Cada zona de disponibilidade tem uma rede, resfriamento e fonte de energia distintos.</span><span class="sxs-lookup"><span data-stu-id="ecf57-316">Each Availability Zone has a distinct power source, network, and cooling.</span></span> <span data-ttu-id="ecf57-317">A implantação de VMs em zonas de disponibilidade ajuda a proteger um aplicativo contra falhas em todo o datacenter.</span><span class="sxs-lookup"><span data-stu-id="ecf57-317">Deploying VMs across availability zones helps to protect an application against datacenter-wide failures.</span></span>

<span data-ttu-id="ecf57-318">**Azure Site Recovery**.</span><span class="sxs-lookup"><span data-stu-id="ecf57-318">**Azure Site Recovery**.</span></span>  <span data-ttu-id="ecf57-319">Replica as máquinas virtuais do Azure para outra região do Azure para necessidades de continuidade dos negócios e de recuperação de desastres.</span><span class="sxs-lookup"><span data-stu-id="ecf57-319">Replicate Azure virtual machines to another Azure region for business continuity and disaster recovery needs.</span></span> <span data-ttu-id="ecf57-320">Você pode realizar análises periódicas de recuperação de desastres para garantir que atende às necessidades de conformidade.</span><span class="sxs-lookup"><span data-stu-id="ecf57-320">You can conduct periodic DR drills to ensure you meet the compliance needs.</span></span> <span data-ttu-id="ecf57-321">A máquina virtual será replicada com as configurações especificadas para a região selecionada para que você possa recuperar seus aplicativos em caso de interrupções na região de origem.</span><span class="sxs-lookup"><span data-stu-id="ecf57-321">The VM will be replicated with the specified settings to the selected region so that you can recover your applications in the event of outages in the source region.</span></span> <span data-ttu-id="ecf57-322">Para obter mais informações, confira [Replicar VMs do Azure usando o ASR][site-recovery].</span><span class="sxs-lookup"><span data-stu-id="ecf57-322">For more information, see [Replicate Azure VMs using ASR][site-recovery].</span></span>

<span data-ttu-id="ecf57-323">**Regiões emparelhadas**.</span><span class="sxs-lookup"><span data-stu-id="ecf57-323">**Paired regions**.</span></span> <span data-ttu-id="ecf57-324">Para proteger um aplicativo contra uma interrupção regional, você pode implantar o aplicativo em várias regiões, usando o Gerenciador de Tráfego do Azure para distribuir o tráfego de Internet para as diferentes regiões.</span><span class="sxs-lookup"><span data-stu-id="ecf57-324">To protect an application against a regional outage, you can deploy the application across multiple regions, using Azure Traffic Manager to distribute internet traffic to the different regions.</span></span> <span data-ttu-id="ecf57-325">Cada região do Azure é emparelhada com outra.</span><span class="sxs-lookup"><span data-stu-id="ecf57-325">Each Azure region is paired with another region.</span></span> <span data-ttu-id="ecf57-326">Juntas, elas formam um [par regional](/azure/best-practices-availability-paired-regions).</span><span class="sxs-lookup"><span data-stu-id="ecf57-326">Together, these form a [regional pair](/azure/best-practices-availability-paired-regions).</span></span> <span data-ttu-id="ecf57-327">Com a exceção do Sul do Brasil, pares regionais estão localizados na mesma região geográfica para atender aos requisitos de residência de dados para fins de jurisdição de imposição fiscal e legal.</span><span class="sxs-lookup"><span data-stu-id="ecf57-327">With the exception of Brazil South, regional pairs are located within the same geography in order to meet data residency requirements for tax and law enforcement jurisdiction purposes.</span></span>

<span data-ttu-id="ecf57-328">Quando você cria um aplicativo de várias regiões, leve em consideração que a latência de rede entre diferentes regiões é maior do que a obtida em uma região.</span><span class="sxs-lookup"><span data-stu-id="ecf57-328">When you design a multi-region application, take into account that network latency across regions is higher than within a region.</span></span> <span data-ttu-id="ecf57-329">Por exemplo, se você estiver replicando de um banco de dados para habilitar o failover, use a replicação síncrona de dados dentro de uma região, mas a replicação assíncrona de dados entre regiões.</span><span class="sxs-lookup"><span data-stu-id="ecf57-329">For example, if you are replicating a database to enable failover, use synchronous data replication within a region, but asynchronous data replication across regions.</span></span>

| &nbsp; | <span data-ttu-id="ecf57-330">Conjunto de disponibilidade</span><span class="sxs-lookup"><span data-stu-id="ecf57-330">Availability Set</span></span> | <span data-ttu-id="ecf57-331">Zona de disponibilidade</span><span class="sxs-lookup"><span data-stu-id="ecf57-331">Availability Zone</span></span> | <span data-ttu-id="ecf57-332">Região emparelhada</span><span class="sxs-lookup"><span data-stu-id="ecf57-332">Paired region</span></span> |
|--------|------------------|-------------------|---------------|
| <span data-ttu-id="ecf57-333">Escopo da falha</span><span class="sxs-lookup"><span data-stu-id="ecf57-333">Scope of failure</span></span> | <span data-ttu-id="ecf57-334">Rack</span><span class="sxs-lookup"><span data-stu-id="ecf57-334">Rack</span></span> | <span data-ttu-id="ecf57-335">Datacenter</span><span class="sxs-lookup"><span data-stu-id="ecf57-335">Datacenter</span></span> | <span data-ttu-id="ecf57-336">Região</span><span class="sxs-lookup"><span data-stu-id="ecf57-336">Region</span></span> |
| <span data-ttu-id="ecf57-337">Roteamento de solicitação</span><span class="sxs-lookup"><span data-stu-id="ecf57-337">Request routing</span></span> | <span data-ttu-id="ecf57-338">Load Balancer</span><span class="sxs-lookup"><span data-stu-id="ecf57-338">Load Balancer</span></span> | <span data-ttu-id="ecf57-339">Load Balancer entre zonas</span><span class="sxs-lookup"><span data-stu-id="ecf57-339">Cross-zone Load Balancer</span></span> | <span data-ttu-id="ecf57-340">Gerenciador de Tráfego</span><span class="sxs-lookup"><span data-stu-id="ecf57-340">Traffic Manager</span></span> |
| <span data-ttu-id="ecf57-341">Latência da rede</span><span class="sxs-lookup"><span data-stu-id="ecf57-341">Network latency</span></span> | <span data-ttu-id="ecf57-342">Muito baixa</span><span class="sxs-lookup"><span data-stu-id="ecf57-342">Very low</span></span> | <span data-ttu-id="ecf57-343">Baixo</span><span class="sxs-lookup"><span data-stu-id="ecf57-343">Low</span></span> | <span data-ttu-id="ecf57-344">Média a alta</span><span class="sxs-lookup"><span data-stu-id="ecf57-344">Mid to high</span></span> |
| <span data-ttu-id="ecf57-345">Rede virtual</span><span class="sxs-lookup"><span data-stu-id="ecf57-345">Virtual network</span></span>  | <span data-ttu-id="ecf57-346">VNET</span><span class="sxs-lookup"><span data-stu-id="ecf57-346">VNet</span></span> | <span data-ttu-id="ecf57-347">VNET</span><span class="sxs-lookup"><span data-stu-id="ecf57-347">VNet</span></span> | <span data-ttu-id="ecf57-348">Emparelhamento VNET entre regiões</span><span class="sxs-lookup"><span data-stu-id="ecf57-348">Cross-region VNet peering</span></span> |

## <a name="implement-resiliency-strategies"></a><span data-ttu-id="ecf57-349">Implementar estratégias de resiliência</span><span class="sxs-lookup"><span data-stu-id="ecf57-349">Implement resiliency strategies</span></span>
<span data-ttu-id="ecf57-350">Esta seção traz uma pesquisa de algumas estratégias comuns de resiliência.</span><span class="sxs-lookup"><span data-stu-id="ecf57-350">This section provides a survey of some common resiliency strategies.</span></span> <span data-ttu-id="ecf57-351">A maioria delas não se limita a uma tecnologia específica.</span><span class="sxs-lookup"><span data-stu-id="ecf57-351">Most of these are not limited to a particular technology.</span></span> <span data-ttu-id="ecf57-352">As descrições nesta seção resumem a ideia geral de cada técnica, com links para leituras adicionais.</span><span class="sxs-lookup"><span data-stu-id="ecf57-352">The descriptions in this section summarize the general idea behind each technique, with links to further reading.</span></span>

<span data-ttu-id="ecf57-353">**Repita as falhas temporárias**.</span><span class="sxs-lookup"><span data-stu-id="ecf57-353">**Retry transient failures**.</span></span> <span data-ttu-id="ecf57-354">As falhas transitórias podem ser causadas por perda momentânea de conectividade de rede, interrupção na conexão com o banco de dados ou tempo limite atingido quando um serviço está ocupado.</span><span class="sxs-lookup"><span data-stu-id="ecf57-354">Transient failures can be caused by momentary loss of network connectivity, a dropped database connection, or a timeout when a service is busy.</span></span> <span data-ttu-id="ecf57-355">Frequentemente, uma falha temporária pode ser resolvida repetindo-se a solicitação.</span><span class="sxs-lookup"><span data-stu-id="ecf57-355">Often, a transient failure can be resolved simply by retrying the request.</span></span> <span data-ttu-id="ecf57-356">Em muitos serviços do Azure, o SDK do cliente implementa tentativas automáticas de forma transparente para o chamador. Consulte [Orientação específica sobre repetição de serviço][retry-service-specific guidance].</span><span class="sxs-lookup"><span data-stu-id="ecf57-356">For many Azure services, the client SDK implements automatic retries, in a way that is transparent to the caller; see [Retry service specific guidance][retry-service-specific guidance].</span></span>

<span data-ttu-id="ecf57-357">Cada tentativa de repetição é adicionada à latência total.</span><span class="sxs-lookup"><span data-stu-id="ecf57-357">Each retry attempt adds to the total latency.</span></span> <span data-ttu-id="ecf57-358">Além disso, um número excessivo de solicitações com falha pode causar afunilamento, pois as solicitações pendentes se acumulam na fila.</span><span class="sxs-lookup"><span data-stu-id="ecf57-358">Also, too many failed requests can cause a bottleneck, as pending requests accumulate in the queue.</span></span> <span data-ttu-id="ecf57-359">Essas solicitações bloqueadas podem reter recursos críticos do sistema, como memória, threads, conexões de banco de dados e outros, e provocar falhas em cascata.</span><span class="sxs-lookup"><span data-stu-id="ecf57-359">These blocked requests might hold critical system resources such as memory, threads, database connections, and so on, which can cause cascading failures.</span></span> <span data-ttu-id="ecf57-360">Para evitar isso, aumente o atraso entre as tentativas de repetição e limite o número total de solicitações com falha.</span><span class="sxs-lookup"><span data-stu-id="ecf57-360">To avoid this, increase the delay between each retry attempt, and limit the total number of failed requests.</span></span> 

![](./images/retry.png)

<span data-ttu-id="ecf57-361">**Balanceie a carga entre as instâncias**.</span><span class="sxs-lookup"><span data-stu-id="ecf57-361">**Load balance across instances**.</span></span> <span data-ttu-id="ecf57-362">Para ter escalabilidade, um aplicativo em nuvem deve ser capaz de se expandir com a adição de mais instâncias.</span><span class="sxs-lookup"><span data-stu-id="ecf57-362">For scalability, a cloud application should be able to scale out by adding more instances.</span></span> <span data-ttu-id="ecf57-363">Essa abordagem também aumenta a resiliência, porque as instâncias não íntegras podem ser removidas da rotação.</span><span class="sxs-lookup"><span data-stu-id="ecf57-363">This approach also improves resiliency, because unhealthy instances can be removed from rotation.</span></span> <span data-ttu-id="ecf57-364">Por exemplo: </span><span class="sxs-lookup"><span data-stu-id="ecf57-364">For example:</span></span>

* <span data-ttu-id="ecf57-365">Coloque duas ou mais VMs por trás de um balanceador de carga.</span><span class="sxs-lookup"><span data-stu-id="ecf57-365">Put two or more VMs behind a load balancer.</span></span> <span data-ttu-id="ecf57-366">O balanceador de carga distribui o tráfego para todas as VMs.</span><span class="sxs-lookup"><span data-stu-id="ecf57-366">The load balancer distributes traffic to all the VMs.</span></span> <span data-ttu-id="ecf57-367">Consulte [Executar VMs com balanceamento de carga para escalabilidade e disponibilidade][ra-multi-vm].</span><span class="sxs-lookup"><span data-stu-id="ecf57-367">See [Run load-balanced VMs for scalability and availability][ra-multi-vm].</span></span>
* <span data-ttu-id="ecf57-368">Escale um aplicativo do Serviço de Aplicativo do Azure horizontalmente para várias instâncias.</span><span class="sxs-lookup"><span data-stu-id="ecf57-368">Scale out an Azure App Service app to multiple instances.</span></span> <span data-ttu-id="ecf57-369">O Serviço de Aplicativo equilibra automaticamente a carga entre as instâncias.</span><span class="sxs-lookup"><span data-stu-id="ecf57-369">App Service automatically balances load across instances.</span></span> <span data-ttu-id="ecf57-370">Consulte [Aplicativo Web básico][ra-basic-web].</span><span class="sxs-lookup"><span data-stu-id="ecf57-370">See [Basic web application][ra-basic-web].</span></span>
* <span data-ttu-id="ecf57-371">Use o [Gerenciador de Tráfego do Azure][tm] para distribuir o tráfego em um conjunto de pontos de extremidade.</span><span class="sxs-lookup"><span data-stu-id="ecf57-371">Use [Azure Traffic Manager][tm] to distribute traffic across a set of endpoints.</span></span>

<span data-ttu-id="ecf57-372">**Replique os dados**.</span><span class="sxs-lookup"><span data-stu-id="ecf57-372">**Replicate data**.</span></span> <span data-ttu-id="ecf57-373">A replicação de dados é uma estratégia geral para manipular falhas não transitórias em um armazenamento de dados.</span><span class="sxs-lookup"><span data-stu-id="ecf57-373">Replicating data is a general strategy for handling non-transient failures in a data store.</span></span> <span data-ttu-id="ecf57-374">Muitas tecnologias de armazenamento fornecem replicação interna, inclusive o Banco de Dados SQL do Azure, Cosmos DB e Apache Cassandra.</span><span class="sxs-lookup"><span data-stu-id="ecf57-374">Many storage technologies provide built-in replication, including Azure SQL Database, Cosmos DB, and Apache Cassandra.</span></span> <span data-ttu-id="ecf57-375">É importante considerar os caminhos de leitura e gravação.</span><span class="sxs-lookup"><span data-stu-id="ecf57-375">It's important to consider both the read and write paths.</span></span> <span data-ttu-id="ecf57-376">Dependendo da tecnologia de armazenamento, você pode ter várias réplicas graváveis, ou uma só réplica gravável e várias somente leitura.</span><span class="sxs-lookup"><span data-stu-id="ecf57-376">Depending on the storage technology, you might have multiple writable replicas, or a single writable replica and multiple read-only replicas.</span></span>

<span data-ttu-id="ecf57-377">Para maximizar a disponibilidade, as réplicas podem ser colocadas em várias regiões.</span><span class="sxs-lookup"><span data-stu-id="ecf57-377">To maximize availability, replicas can be placed in multiple regions.</span></span> <span data-ttu-id="ecf57-378">No entanto, isso aumenta a latência na replicação de dados.</span><span class="sxs-lookup"><span data-stu-id="ecf57-378">However, this increases the latency when replicating the data.</span></span> <span data-ttu-id="ecf57-379">Normalmente, a replicação entre regiões é feita de forma assíncrona, o que implica um modelo de consistência eventual e a possível perda de dados, se uma réplica falhar.</span><span class="sxs-lookup"><span data-stu-id="ecf57-379">Typically, replicating across regions is done asynchronously, which implies an eventual consistency model and potential data loss if a replica fails.</span></span>

<span data-ttu-id="ecf57-380">Você pode suar o [Azure Site Recovery][site-recovery] para replicar as máquinas virtuais do Azure de uma região para outra.</span><span class="sxs-lookup"><span data-stu-id="ecf57-380">You can use [Azure Site Recovery][site-recovery] to replicate Azure virtual machines from one region to another region.</span></span> <span data-ttu-id="ecf57-381">O Site Recovery replica os dados continuamente para a região de destino.</span><span class="sxs-lookup"><span data-stu-id="ecf57-381">Site Recovery replicates data continuously to the target region.</span></span> <span data-ttu-id="ecf57-382">Quando ocorre uma interrupção no seu site primário, você faz failover para o local secundário</span><span class="sxs-lookup"><span data-stu-id="ecf57-382">When an outage occurs at your primary site, you fail over to secondary location</span></span>

<span data-ttu-id="ecf57-383">**Degradar normalmente**.</span><span class="sxs-lookup"><span data-stu-id="ecf57-383">**Degrade gracefully**.</span></span> <span data-ttu-id="ecf57-384">Se um serviço falhar e não houver caminho de failover, o aplicativo pode conseguir degradar o serviço normalmente e continuar fornecendo uma experiência de usuário aceitável.</span><span class="sxs-lookup"><span data-stu-id="ecf57-384">If a service fails and there is no failover path, the application may be able to degrade gracefully while still providing an acceptable user experience.</span></span> <span data-ttu-id="ecf57-385">Por exemplo: </span><span class="sxs-lookup"><span data-stu-id="ecf57-385">For example:</span></span>

* <span data-ttu-id="ecf57-386">Colocar um item de trabalho em uma fila a ser tratada mais tarde.</span><span class="sxs-lookup"><span data-stu-id="ecf57-386">Put a work item on a queue, to be handled later.</span></span> 
* <span data-ttu-id="ecf57-387">Retornar um valor estimado.</span><span class="sxs-lookup"><span data-stu-id="ecf57-387">Return an estimated value.</span></span>
* <span data-ttu-id="ecf57-388">Usar dados armazenados em cache localmente.</span><span class="sxs-lookup"><span data-stu-id="ecf57-388">Use locally cached data.</span></span> 
* <span data-ttu-id="ecf57-389">Exibir uma mensagem de erro para o usuário.</span><span class="sxs-lookup"><span data-stu-id="ecf57-389">Show the user an error message.</span></span> <span data-ttu-id="ecf57-390">(Essa opção é melhor do que o aplicativo parar de responder às solicitações.)</span><span class="sxs-lookup"><span data-stu-id="ecf57-390">(This option is better than having the application stop responding to requests.)</span></span>

<span data-ttu-id="ecf57-391">**Limite os usuários de alto volume**.</span><span class="sxs-lookup"><span data-stu-id="ecf57-391">**Throttle high-volume users**.</span></span> <span data-ttu-id="ecf57-392">Às vezes, um pequeno número de usuários cria uma carga excessiva.</span><span class="sxs-lookup"><span data-stu-id="ecf57-392">Sometimes a small number of users create excessive load.</span></span> <span data-ttu-id="ecf57-393">Isso pode afetar os outros, reduzindo a disponibilidade geral do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="ecf57-393">That can have an impact on other users, reducing the overall availability of your application.</span></span>

<span data-ttu-id="ecf57-394">Quando um único cliente faz um número excessivo de solicitações, o aplicativo pode limitá-lo por um determinado período.</span><span class="sxs-lookup"><span data-stu-id="ecf57-394">When a single client makes an excessive number of requests, the application might throttle the client for a certain period of time.</span></span> <span data-ttu-id="ecf57-395">Durante o período de limitação, o aplicativo recusa algumas ou todas as solicitações desse cliente (dependendo da estratégia exata de limitação).</span><span class="sxs-lookup"><span data-stu-id="ecf57-395">During the throttling period, the application refuses some or all of the requests from that client (depending on the exact throttling strategy).</span></span> <span data-ttu-id="ecf57-396">A extensão da limitação pode depender da camada de serviço do cliente.</span><span class="sxs-lookup"><span data-stu-id="ecf57-396">The threshold for throttling might depend on the customer's service tier.</span></span> 

<span data-ttu-id="ecf57-397">A limitação não significa necessariamente que o cliente estava mal-intencionado, mas apenas que ele excedeu sua cota de serviço.</span><span class="sxs-lookup"><span data-stu-id="ecf57-397">Throttling does not imply the client was necessarily acting maliciously, only that it exceeded its service quota.</span></span> <span data-ttu-id="ecf57-398">Pode acontecer que o consumidor exceda sua cota frequentemente, ou que seu comportamento seja, de alguma forma, incorreto.</span><span class="sxs-lookup"><span data-stu-id="ecf57-398">In some cases, a consumer might consistently exceed their quota or otherwise behave badly.</span></span> <span data-ttu-id="ecf57-399">Nesse caso, você pode ser mais enérgico e bloquear esse usuário.</span><span class="sxs-lookup"><span data-stu-id="ecf57-399">In that case, you might go further and block the user.</span></span> <span data-ttu-id="ecf57-400">Normalmente, isso é feito bloqueando-se uma chave de API ou um intervalo de endereços IP.</span><span class="sxs-lookup"><span data-stu-id="ecf57-400">Typically, this is done by blocking an API key or an IP address range.</span></span> <span data-ttu-id="ecf57-401">Para obter mais informações, consulte [Padrão de limitação][throttling-pattern].</span><span class="sxs-lookup"><span data-stu-id="ecf57-401">For more information, see [Throttling Pattern][throttling-pattern].</span></span>

<span data-ttu-id="ecf57-402">**Use um disjuntor**.</span><span class="sxs-lookup"><span data-stu-id="ecf57-402">**Use a circuit breaker**.</span></span> <span data-ttu-id="ecf57-403">O padrão [Disjuntor][circuit-breaker-pattern] pode impedir que um aplicativo tente repetidamente uma operação com probabilidade de falha.</span><span class="sxs-lookup"><span data-stu-id="ecf57-403">The [Circuit Breaker][circuit-breaker-pattern] pattern can prevent an application from repeatedly trying an operation that is likely to fail.</span></span> <span data-ttu-id="ecf57-404">O disjuntor encapsula as chamadas em um serviço e controla o número de falhas recentes.</span><span class="sxs-lookup"><span data-stu-id="ecf57-404">The circuit breaker wraps calls to a service and tracks the number of recent failures.</span></span> <span data-ttu-id="ecf57-405">Se a contagem de falhas exceder um limite, o disjuntor será iniciado retornando um código de erro sem chamar o serviço.</span><span class="sxs-lookup"><span data-stu-id="ecf57-405">If the failure count exceeds a threshold, the circuit breaker starts returning an error code without calling the service.</span></span> <span data-ttu-id="ecf57-406">Isso fornece ao serviço um tempo de recuperação.</span><span class="sxs-lookup"><span data-stu-id="ecf57-406">This gives the service time to recover.</span></span> 

<span data-ttu-id="ecf57-407">**Use o nivelamento de carga para suavizar os picos no tráfego**.</span><span class="sxs-lookup"><span data-stu-id="ecf57-407">**Use load leveling to smooth out spikes in traffic**.</span></span> <span data-ttu-id="ecf57-408">Os aplicativos podem enfrentar picos repentinos no tráfego e sobrecarregar o serviços de back-end.</span><span class="sxs-lookup"><span data-stu-id="ecf57-408">Applications may experience sudden spikes in traffic, which can overwhelm services on the backend.</span></span> <span data-ttu-id="ecf57-409">Se um serviço de back-end não conseguir responder às solicitações rápido o suficiente, pode provocar um enfileiramento de solicitações (backup) ou fazer com que o serviço limite o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="ecf57-409">If a backend service cannot respond to requests quickly enough, it may cause requests to queue (back up), or cause the service to throttle the application.</span></span> <span data-ttu-id="ecf57-410">Para evitar isso, você pode usar uma fila como buffer.</span><span class="sxs-lookup"><span data-stu-id="ecf57-410">To avoid this, you can use a queue as a buffer.</span></span> <span data-ttu-id="ecf57-411">Quando há um novo item de trabalho, em vez de chamar o serviço de back-end imediatamente, o aplicativo enfileira um item de trabalho para que seja executado de forma assíncrona.</span><span class="sxs-lookup"><span data-stu-id="ecf57-411">When there is a new work item, instead of calling the backend service immediately, the application queues a work item to run asynchronously.</span></span> <span data-ttu-id="ecf57-412">A fila atua como buffer e diminui os picos na carga.</span><span class="sxs-lookup"><span data-stu-id="ecf57-412">The queue acts as a buffer that smooths out peaks in the load.</span></span> <span data-ttu-id="ecf57-413">Para obter mais informações, consulte [Padrão de nivelamento de carga baseado em fila][load-leveling-pattern].</span><span class="sxs-lookup"><span data-stu-id="ecf57-413">For more information, see [Queue-Based Load Leveling Pattern][load-leveling-pattern].</span></span>

<span data-ttu-id="ecf57-414">**Isole os recursos críticos**.</span><span class="sxs-lookup"><span data-stu-id="ecf57-414">**Isolate critical resources**.</span></span> <span data-ttu-id="ecf57-415">Às vezes, as falhas em um subsistema podem ocorrer em cascata, causando falhas em outras partes do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="ecf57-415">Failures in one subsystem can sometimes cascade, causing failures in other parts of the application.</span></span> <span data-ttu-id="ecf57-416">Isso pode acontecer se uma falha impedir que alguns recursos, como threads ou soquetes, sejam liberados em tempo hábil, exaurindo recursos.</span><span class="sxs-lookup"><span data-stu-id="ecf57-416">This can happen if a failure causes some resources, such as threads or sockets, not to get freed in a timely manner, leading to resource exhaustion.</span></span> 

<span data-ttu-id="ecf57-417">Para evitar isso, você pode particionar um sistema em grupos isolados, para que a falha de uma partição não paralise todo o sistema.</span><span class="sxs-lookup"><span data-stu-id="ecf57-417">To avoid this, you can partition a system into isolated groups, so that a failure in one partition does not bring down the entire system.</span></span> <span data-ttu-id="ecf57-418">Essa técnica também é conhecida como padrão de Bulkhead.</span><span class="sxs-lookup"><span data-stu-id="ecf57-418">This technique is sometimes called the Bulkhead pattern.</span></span>

<span data-ttu-id="ecf57-419">Exemplos:</span><span class="sxs-lookup"><span data-stu-id="ecf57-419">Examples:</span></span>

* <span data-ttu-id="ecf57-420">Particionar um banco de dados (por locatário, por exemplo) e atribuir um pool de instâncias de servidor Web a cada partição.</span><span class="sxs-lookup"><span data-stu-id="ecf57-420">Partition a database (for example, by tenant) and assign a separate pool of web server instances for each partition.</span></span>  
* <span data-ttu-id="ecf57-421">Usar pools de threads separados, para isolar as chamadas para diferentes serviços.</span><span class="sxs-lookup"><span data-stu-id="ecf57-421">Use separate thread pools to isolate calls to different services.</span></span> <span data-ttu-id="ecf57-422">Isso ajuda a evitar falhas em cascata, se houver falha em um dos serviços.</span><span class="sxs-lookup"><span data-stu-id="ecf57-422">This helps to prevent cascading failures if one of the services fails.</span></span> <span data-ttu-id="ecf57-423">Para ver um exemplo, consulte a [biblioteca Hystrix][hystrix] da Netflix.</span><span class="sxs-lookup"><span data-stu-id="ecf57-423">For an example, see the Netflix [Hystrix library][hystrix].</span></span>
* <span data-ttu-id="ecf57-424">Usar [contêineres][containers] para limitar os recursos disponíveis a um determinado subsistema.</span><span class="sxs-lookup"><span data-stu-id="ecf57-424">Use [containers][containers] to limit the resources available to a particular subsystem.</span></span> 

![](./images/bulkhead.png)

<span data-ttu-id="ecf57-425">**Aplique transações de compensação**.</span><span class="sxs-lookup"><span data-stu-id="ecf57-425">**Apply compensating transactions**.</span></span> <span data-ttu-id="ecf57-426">Um [transação de compensação][compensating-transaction-pattern] é uma transação que desfaz os efeitos de outra transação concluída.</span><span class="sxs-lookup"><span data-stu-id="ecf57-426">A [compensating transaction][compensating-transaction-pattern] is a transaction that undoes the effects of another completed transaction.</span></span> <span data-ttu-id="ecf57-427">Em um sistema distribuído, pode ser muito difícil obter uma consistência transacional sólida.</span><span class="sxs-lookup"><span data-stu-id="ecf57-427">In a distributed system, it can be very difficult to achieve strong transactional consistency.</span></span> <span data-ttu-id="ecf57-428">As transações de compensação são uma forma de obter consistência usando uma série de transações individuais menores, que podem ser desfeitas em cada etapa.</span><span class="sxs-lookup"><span data-stu-id="ecf57-428">Compensating transactions are a way to achieve consistency by using a series of smaller, individual transactions that can be undone at each step.</span></span>

<span data-ttu-id="ecf57-429">Por exemplo, para fazer uma viagem, um cliente pode precisar reservar um voo, acomodações de hotel e um carro.</span><span class="sxs-lookup"><span data-stu-id="ecf57-429">For example, to book a trip, a customer might reserve a car, a hotel room, and a flight.</span></span> <span data-ttu-id="ecf57-430">Se alguma dessas etapas falhar, toda a operação falhará.</span><span class="sxs-lookup"><span data-stu-id="ecf57-430">If any of these steps fails, the entire operation fails.</span></span> <span data-ttu-id="ecf57-431">Em vez de tentar usar uma única transação distribuída em toda a operação, você pode definir uma transação de compensação para cada etapa.</span><span class="sxs-lookup"><span data-stu-id="ecf57-431">Instead of trying to use a single distributed transaction for the entire operation, you can define a compensating transaction for each step.</span></span> <span data-ttu-id="ecf57-432">Por exemplo, para desfazer uma reserva de carro, cancelar essa reserva.</span><span class="sxs-lookup"><span data-stu-id="ecf57-432">For example, to undo a car reservation, you cancel the reservation.</span></span> <span data-ttu-id="ecf57-433">Para concluir toda a operação, um coordenador executa cada etapa.</span><span class="sxs-lookup"><span data-stu-id="ecf57-433">In order to complete the whole operation, a coordinator executes each step.</span></span> <span data-ttu-id="ecf57-434">Se alguma delas falhar, o coordenador aplica transações de compensação para desfazer todas as etapas concluídas.</span><span class="sxs-lookup"><span data-stu-id="ecf57-434">If any step fails, the coordinator applies compensating transactions to undo any steps that were completed.</span></span> 

## <a name="test-for-resiliency"></a><span data-ttu-id="ecf57-435">Testar resiliência</span><span class="sxs-lookup"><span data-stu-id="ecf57-435">Test for resiliency</span></span>
<span data-ttu-id="ecf57-436">Em geral, não se pode testar a resiliência da mesma maneira que a funcionalidade do aplicativo (executando testes unitários e outros).</span><span class="sxs-lookup"><span data-stu-id="ecf57-436">Generally, you can't test resiliency in the same way that you test application functionality (by running unit tests and so on).</span></span> <span data-ttu-id="ecf57-437">Em vez disso, deve-se testar a execução da carga de trabalho de ponta a ponta sob condições de falha intermitentes.</span><span class="sxs-lookup"><span data-stu-id="ecf57-437">Instead, you must test how the end-to-end workload performs under failure conditions which only occur intermittently.</span></span>

<span data-ttu-id="ecf57-438">O teste é um processo iterativo.</span><span class="sxs-lookup"><span data-stu-id="ecf57-438">Testing is an iterative process.</span></span> <span data-ttu-id="ecf57-439">Teste o aplicativo, avalie o resultado, analise e resolva as falhas resultantes, e repita o processo.</span><span class="sxs-lookup"><span data-stu-id="ecf57-439">Test the application, measure the outcome, analyze and address any failures that result, and repeat the process.</span></span>

<span data-ttu-id="ecf57-440">**Teste de injeção de falha**.</span><span class="sxs-lookup"><span data-stu-id="ecf57-440">**Fault injection testing**.</span></span> <span data-ttu-id="ecf57-441">Teste a resiliência do sistema durante falhas, seja disparando falhas reais ou fazendo simulações.</span><span class="sxs-lookup"><span data-stu-id="ecf57-441">Test the resiliency of the system during failures, either by triggering actual failures or by simulating them.</span></span> <span data-ttu-id="ecf57-442">Aqui estão alguns cenários comuns de falha para teste:</span><span class="sxs-lookup"><span data-stu-id="ecf57-442">Here are some common failure scenarios to test:</span></span>

* <span data-ttu-id="ecf57-443">desligamento de instâncias de VM</span><span class="sxs-lookup"><span data-stu-id="ecf57-443">Shut down VM instances.</span></span>
* <span data-ttu-id="ecf57-444">falha de processos</span><span class="sxs-lookup"><span data-stu-id="ecf57-444">Crash processes.</span></span>
* <span data-ttu-id="ecf57-445">expiração de certificados</span><span class="sxs-lookup"><span data-stu-id="ecf57-445">Expire certificates.</span></span>
* <span data-ttu-id="ecf57-446">mudança de chaves de acesso</span><span class="sxs-lookup"><span data-stu-id="ecf57-446">Change access keys.</span></span>
* <span data-ttu-id="ecf57-447">desligamento do serviço DNS em controladores de domínio</span><span class="sxs-lookup"><span data-stu-id="ecf57-447">Shut down the DNS service on domain controllers.</span></span>
* <span data-ttu-id="ecf57-448">limitação de recursos do sistema disponíveis, como RAM ou número de threads</span><span class="sxs-lookup"><span data-stu-id="ecf57-448">Limit available system resources, such as RAM or number of threads.</span></span>
* <span data-ttu-id="ecf57-449">desmontagem de discos</span><span class="sxs-lookup"><span data-stu-id="ecf57-449">Unmount disks.</span></span>
* <span data-ttu-id="ecf57-450">reimplantação de uma VM</span><span class="sxs-lookup"><span data-stu-id="ecf57-450">Redeploy a VM.</span></span>

<span data-ttu-id="ecf57-451">Meça o tempo de recuperação e verifique se os seus requisitos de negócios estão sendo cumpridos.</span><span class="sxs-lookup"><span data-stu-id="ecf57-451">Measure the recovery times and verify that your business requirements are met.</span></span> <span data-ttu-id="ecf57-452">Teste também combinações dos modos de falha.</span><span class="sxs-lookup"><span data-stu-id="ecf57-452">Test combinations of failure modes as well.</span></span> <span data-ttu-id="ecf57-453">Certifique-se de que as falhas não se propaguem em cascata e que sejam tratadas isoladamente.</span><span class="sxs-lookup"><span data-stu-id="ecf57-453">Make sure that failures don't cascade, and are handled in an isolated way.</span></span>

<span data-ttu-id="ecf57-454">Essa é outra razão pela qual é importante analisar possíveis pontos de falha durante a fase de design.</span><span class="sxs-lookup"><span data-stu-id="ecf57-454">This is another reason why it's important to analyze possible failure points during the design phase.</span></span> <span data-ttu-id="ecf57-455">Os resultados dessa análise devem funcionar como informações para o seu plano de teste.</span><span class="sxs-lookup"><span data-stu-id="ecf57-455">The results of that analysis should be inputs into your test plan.</span></span>

<span data-ttu-id="ecf57-456">**Teste de carga**.</span><span class="sxs-lookup"><span data-stu-id="ecf57-456">**Load testing**.</span></span> <span data-ttu-id="ecf57-457">O teste de carga é crucial para identificar falhas que só ocorrem sob condições de carga, como um banco de dados de back-end sobrecarregado ou limitações de serviço.</span><span class="sxs-lookup"><span data-stu-id="ecf57-457">Load testing is crucial for identifying failures that only happen under load, such as the backend database being overwhelmed or service throttling.</span></span> <span data-ttu-id="ecf57-458">Teste a carga de pico usando dados de produção ou sintéticos, desde que estes se aproximem o máximo possível dos dados de produção.</span><span class="sxs-lookup"><span data-stu-id="ecf57-458">Test for peak load, using production data or synthetic data that is as close to production data as possible.</span></span> <span data-ttu-id="ecf57-459">O objetivo é observar como o aplicativo se comporta sob condições do mundo real.</span><span class="sxs-lookup"><span data-stu-id="ecf57-459">The goal is to see how the application behaves under real-world conditions.</span></span>   

## <a name="deploy-using-reliable-processes"></a><span data-ttu-id="ecf57-460">Implantar usando processos confiáveis</span><span class="sxs-lookup"><span data-stu-id="ecf57-460">Deploy using reliable processes</span></span>
<span data-ttu-id="ecf57-461">Quando um aplicativo é implantado para produção, as atualizações são uma possível fonte de erros.</span><span class="sxs-lookup"><span data-stu-id="ecf57-461">Once an application is deployed to production, updates are a possible source of errors.</span></span> <span data-ttu-id="ecf57-462">Na pior das hipóteses, uma atualização corrompida pode causar inatividade.</span><span class="sxs-lookup"><span data-stu-id="ecf57-462">In the worst case, a bad update can cause downtime.</span></span> <span data-ttu-id="ecf57-463">Para evitar isso, o processo de implantação deve ser repetível e previsível.</span><span class="sxs-lookup"><span data-stu-id="ecf57-463">To avoid this, the deployment process must be predictable and repeatable.</span></span> <span data-ttu-id="ecf57-464">A implantação inclui etapas de provisionamento de recursos do Azure, implantação do código do aplicativo e aplicação de definições de configuração.</span><span class="sxs-lookup"><span data-stu-id="ecf57-464">Deployment includes provisioning Azure resources, deploying application code, and applying configuration settings.</span></span> <span data-ttu-id="ecf57-465">Uma atualização pode envolver todas ou parte dessas três.</span><span class="sxs-lookup"><span data-stu-id="ecf57-465">An update may involve all three, or a subset.</span></span> 

<span data-ttu-id="ecf57-466">O ponto fundamental é que implantações manuais são propensas a erro.</span><span class="sxs-lookup"><span data-stu-id="ecf57-466">The crucial point is that manual deployments are prone to error.</span></span> <span data-ttu-id="ecf57-467">Por isso, é recomendável um processo idempotente automatizado, que você pode executar sob demanda e, caso haja alguma falha, executar novamente.</span><span class="sxs-lookup"><span data-stu-id="ecf57-467">Therefore, it's recommended to have an automated, idempotent process that you can run on demand, and re-run if something fails.</span></span> 

* <span data-ttu-id="ecf57-468">Use modelos do Azure Resource Manager para automatizar o provisionamento de recursos do Azure.</span><span class="sxs-lookup"><span data-stu-id="ecf57-468">Use Azure Resource Manager templates to automate provisioning of Azure resources.</span></span>
* <span data-ttu-id="ecf57-469">Use o [Azure Automation Desired State Configuration][dsc] (DSC) para configurar VMs.</span><span class="sxs-lookup"><span data-stu-id="ecf57-469">Use [Azure Automation Desired State Configuration][dsc] (DSC) to configure VMs.</span></span>
* <span data-ttu-id="ecf57-470">Use um processo de implantação automática para o código do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="ecf57-470">Use an automated deployment process for application code.</span></span>

<span data-ttu-id="ecf57-471">Dois conceitos relacionados à implantação resiliente são: *infraestrutura como código* e *infraestrutura imutável*.</span><span class="sxs-lookup"><span data-stu-id="ecf57-471">Two concepts related to resilient deployment are *infrastructure as code* and *immutable infrastructure*.</span></span>

* <span data-ttu-id="ecf57-472">**Infraestrutura como código** é a prática de usar código para provisionar e configurar a infraestrutura.</span><span class="sxs-lookup"><span data-stu-id="ecf57-472">**Infrastructure as code** is the practice of using code to provision and configure infrastructure.</span></span> <span data-ttu-id="ecf57-473">A infraestrutura como código pode usar abordagem declarativa ou imperativa (ou mesmo uma combinação de ambas).</span><span class="sxs-lookup"><span data-stu-id="ecf57-473">Infrastructure as code may use a declarative approach or an imperative approach (or a combination of both).</span></span> <span data-ttu-id="ecf57-474">Os modelos do Resource Manager são um exemplo de abordagem declarativa.</span><span class="sxs-lookup"><span data-stu-id="ecf57-474">Resource Manager templates are an example of a declarative approach.</span></span> <span data-ttu-id="ecf57-475">Os scripts do PowerShell são um exemplo de abordagem imperativa.</span><span class="sxs-lookup"><span data-stu-id="ecf57-475">PowerShell scripts are an example of an imperative approach.</span></span>
* <span data-ttu-id="ecf57-476">**Infraestrutura imutável** é o princípio segundo o qual não se deve modificar a infraestrutura após sua implantação para produção.</span><span class="sxs-lookup"><span data-stu-id="ecf57-476">**Immutable infrastructure** is the principle that you shouldn’t modify infrastructure after it’s deployed to production.</span></span> <span data-ttu-id="ecf57-477">Caso contrário, você pode entrar em um estado em que foram aplicadas alterações ad hoc, no qual é difícil saber exatamente o que mudou e chegar a uma conclusão em relação ao sistema.</span><span class="sxs-lookup"><span data-stu-id="ecf57-477">Otherwise, you can get into a state where ad hoc changes have been applied, so it's hard to know exactly what changed, and hard to reason about the system.</span></span> 

<span data-ttu-id="ecf57-478">Outra questão é como lançar uma atualização do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="ecf57-478">Another question is how to roll out an application update.</span></span> <span data-ttu-id="ecf57-479">Recomendamos técnicas como as chamadas implantações “blue-green” e versões “canário”, que enviam atualizações de forma altamente controlada, visando a minimizar os possíveis impactos de uma implantação incorreta.</span><span class="sxs-lookup"><span data-stu-id="ecf57-479">We recommend techniques such as blue-green deployment or canary releases, which push updates in highly controlled way to minimize possible impacts from a bad deployment.</span></span>

* <span data-ttu-id="ecf57-480">A [Implantação “blue-green”][blue-green] é uma técnica em que a atualização é implantada em um ambiente de produção à parte do aplicativo ao vivo.</span><span class="sxs-lookup"><span data-stu-id="ecf57-480">[Blue-green deployment][blue-green] is a technique where an update is deployed into a production environment separate from the live application.</span></span> <span data-ttu-id="ecf57-481">Após validar a implantação, alterne o roteamento de tráfego para a versão atualizada.</span><span class="sxs-lookup"><span data-stu-id="ecf57-481">After you validate the deployment, switch the traffic routing to the updated version.</span></span> <span data-ttu-id="ecf57-482">Por exemplo, o recurso Aplicativos Web do Serviço de Aplicativo do Azure permite isso com slots de preparo.</span><span class="sxs-lookup"><span data-stu-id="ecf57-482">For example, Azure App Service Web Apps enables this with staging slots.</span></span>
* <span data-ttu-id="ecf57-483">As [versões “canário”][canary-release] são semelhantes às implantações “blue-green”.</span><span class="sxs-lookup"><span data-stu-id="ecf57-483">[Canary releases][canary-release] are similar to blue-green deployments.</span></span> <span data-ttu-id="ecf57-484">Em vez de alternar todo o tráfego para a versão atualizada, lança-se a atualização para uma pequena porcentagem de usuários encaminhando uma parte do tráfego para a nova implantação.</span><span class="sxs-lookup"><span data-stu-id="ecf57-484">Instead of switching all traffic to the updated version, you roll out the update to a small percentage of users, by routing a portion of the traffic to the new deployment.</span></span> <span data-ttu-id="ecf57-485">Se houver problemas, interrompe-se o processo volta-se à implantação anterior.</span><span class="sxs-lookup"><span data-stu-id="ecf57-485">If there is a problem, back off and revert to the old deployment.</span></span> <span data-ttu-id="ecf57-486">Se tudo correr bem, encaminha-se mais uma parte do tráfego para a nova versão, até atingir 100%.</span><span class="sxs-lookup"><span data-stu-id="ecf57-486">Otherwise, route more of the traffic to the new version, until it gets 100% of the traffic.</span></span>

<span data-ttu-id="ecf57-487">Qualquer que seja a abordagem, certifique-se de poder reverter para a última implantação íntegra, caso a nova versão não funcione.</span><span class="sxs-lookup"><span data-stu-id="ecf57-487">Whatever approach you take, make sure that you can roll back to the last-known-good deployment, in case the new version is not functioning.</span></span> <span data-ttu-id="ecf57-488">Além disso, se houver erros, os logs de aplicativo devem indicar a versão causadora do erro.</span><span class="sxs-lookup"><span data-stu-id="ecf57-488">Also, if errors occur, the application logs must indicate which version caused the error.</span></span> 

## <a name="monitor-to-detect-failures"></a><span data-ttu-id="ecf57-489">Monitorar para detectar falhas</span><span class="sxs-lookup"><span data-stu-id="ecf57-489">Monitor to detect failures</span></span>
<span data-ttu-id="ecf57-490">O monitoramento e o diagnóstico são cruciais para garantir a resiliência.</span><span class="sxs-lookup"><span data-stu-id="ecf57-490">Monitoring and diagnostics are crucial for resiliency.</span></span> <span data-ttu-id="ecf57-491">Se algo falhar, você precisa saber o que falhou, e também ter informações sobre a causa da falha.</span><span class="sxs-lookup"><span data-stu-id="ecf57-491">If something fails, you need to know that it failed, and you need insights into the cause of the failure.</span></span> 

<span data-ttu-id="ecf57-492">O monitoramento de um sistema distribuído em larga escala representa um desafio significativo.</span><span class="sxs-lookup"><span data-stu-id="ecf57-492">Monitoring a large-scale distributed system poses a significant challenge.</span></span> <span data-ttu-id="ecf57-493">Pense em um aplicativo executado em algumas dezenas de VMs; &mdash;não é prático fazer logon em cada uma delas e examinar seus arquivos de log para tentar solucionar um problema.</span><span class="sxs-lookup"><span data-stu-id="ecf57-493">Think about an application that runs on a few dozen VMs &mdash; it's not practical to log into each VM, one at a time, and look through log files, trying to troubleshoot a problem.</span></span> <span data-ttu-id="ecf57-494">Além disso, o número de instâncias de VM provavelmente não é estático.</span><span class="sxs-lookup"><span data-stu-id="ecf57-494">Moreover, the number of VM instances is probably not static.</span></span> <span data-ttu-id="ecf57-495">As VMs são adicionadas e removidas com a expansão e retração do aplicativo, e, ocasionalmente, uma instância pode falhar e precisar ser provisionada novamente.</span><span class="sxs-lookup"><span data-stu-id="ecf57-495">VMs get added and removed as the application scales in and out, and occasionally an instance may fail and need to be reprovisioned.</span></span> <span data-ttu-id="ecf57-496">Além disso, um aplicativo de nuvem típico pode usar vários armazenamentos de dados (armazenamento do Azure, Banco de Dados SQL, Cosmos DB, cache Redis) e uma única ação do usuário pode abranger vários subsistemas.</span><span class="sxs-lookup"><span data-stu-id="ecf57-496">In addition, a typical cloud application might use multiple data stores (Azure storage, SQL Database, Cosmos DB, Redis cache), and a single user action may span multiple subsystems.</span></span> 

<span data-ttu-id="ecf57-497">Pode-se considerar o processo de monitoramento e diagnóstico como um pipeline com várias etapas distintas:</span><span class="sxs-lookup"><span data-stu-id="ecf57-497">You can think of the monitoring and diagnostics process as a pipeline with several distinct stages:</span></span>

![SLA composto](./images/monitoring.png)

* <span data-ttu-id="ecf57-499">**Instrumentação**.</span><span class="sxs-lookup"><span data-stu-id="ecf57-499">**Instrumentation**.</span></span> <span data-ttu-id="ecf57-500">Os dados brutos para monitoramento e diagnóstico vêm de várias fontes, inclusive logs de aplicativo e de servidor Web, contadores de desempenho do sistema operacional, logs de banco de dados e diagnósticos incorporados à plataforma Azure.</span><span class="sxs-lookup"><span data-stu-id="ecf57-500">The raw data for monitoring and diagnostics comes from a variety of sources, including application logs, web server logs, OS performance counters, database logs, and diagnostics built into the Azure platform.</span></span> <span data-ttu-id="ecf57-501">A maioria dos serviços do Azure tem um recurso de diagnóstico que pode ser usado para determinar a causa dos problemas.</span><span class="sxs-lookup"><span data-stu-id="ecf57-501">Most Azure services have a diagnostics feature that you can use to determine the cause of problems.</span></span>
* <span data-ttu-id="ecf57-502">**Coleta e armazenamento**.</span><span class="sxs-lookup"><span data-stu-id="ecf57-502">**Collection and storage**.</span></span> <span data-ttu-id="ecf57-503">Dados de instrumentação brutos podem ser mantidos em vários locais e com vários formatos (por exemplo, logs de rastreamento de aplicativo e do IIS, contadores de desempenho).</span><span class="sxs-lookup"><span data-stu-id="ecf57-503">Raw instrumentation data can be held in various locations and with various formats (e.g., application trace logs, IIS logs, performance counters).</span></span> <span data-ttu-id="ecf57-504">Essas fontes diferentes são coletadas, consolidadas e colocadas em um armazenamento confiável.</span><span class="sxs-lookup"><span data-stu-id="ecf57-504">These disparate sources are collected, consolidated, and put into reliable storage.</span></span>
* <span data-ttu-id="ecf57-505">**Análise e diagnóstico**.</span><span class="sxs-lookup"><span data-stu-id="ecf57-505">**Analysis and diagnosis**.</span></span> <span data-ttu-id="ecf57-506">Após os dados serem consolidados, eles podem ser analisados para solucionar problemas e fornecer uma visão geral da integridade do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="ecf57-506">After the data is consolidated, it can be analyzed to troubleshoot issues and provide an overall view of application health.</span></span>
* <span data-ttu-id="ecf57-507">**Visualização e alertas**.</span><span class="sxs-lookup"><span data-stu-id="ecf57-507">**Visualization and alerts**.</span></span> <span data-ttu-id="ecf57-508">Neste estágio, os dados de telemetria são apresentados de forma que um operador pode notar rapidamente problemas ou tendências.</span><span class="sxs-lookup"><span data-stu-id="ecf57-508">In this stage, telemetry data is presented in such a way that an operator can quickly notice problems or trends.</span></span> <span data-ttu-id="ecf57-509">Exemplo: inclusão de painéis ou alertas por email.</span><span class="sxs-lookup"><span data-stu-id="ecf57-509">Example include dashboards or email alerts.</span></span>  

<span data-ttu-id="ecf57-510">Monitoramento não é o mesmo que detecção de falha.</span><span class="sxs-lookup"><span data-stu-id="ecf57-510">Monitoring is not the same as failure detection.</span></span> <span data-ttu-id="ecf57-511">Por exemplo, seu aplicativo pode detectar um erro transitório e tentar novamente, sem que haja qualquer inatividade.</span><span class="sxs-lookup"><span data-stu-id="ecf57-511">For example, your application might detect a transient error and retry, resulting in no downtime.</span></span> <span data-ttu-id="ecf57-512">Mas ele deve registrar essa operação de repetição, para que se possa monitorar a taxa de erros e ter uma visão geral da integridade do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="ecf57-512">But it should also log the retry operation, so that you can monitor the error rate, in order to get an overall picture of application health.</span></span> 

<span data-ttu-id="ecf57-513">Os logs de aplicativo são uma fonte importante de dados de diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="ecf57-513">Application logs are an important source of diagnostics data.</span></span> <span data-ttu-id="ecf57-514">Algumas práticas recomendadas para o log de aplicativo são:</span><span class="sxs-lookup"><span data-stu-id="ecf57-514">Best practices for application logging include:</span></span>

* <span data-ttu-id="ecf57-515">Obtenha logs na fase de produção.</span><span class="sxs-lookup"><span data-stu-id="ecf57-515">Log in production.</span></span> <span data-ttu-id="ecf57-516">Caso contrário, você perderá informações onde mais precisa.</span><span class="sxs-lookup"><span data-stu-id="ecf57-516">Otherwise, you lose insight where you need it most.</span></span>
* <span data-ttu-id="ecf57-517">Obtenha logs de eventos nos limites dos serviços.</span><span class="sxs-lookup"><span data-stu-id="ecf57-517">Log events at service boundaries.</span></span> <span data-ttu-id="ecf57-518">Inclua uma ID de correlação que flua nos limites dos serviços.</span><span class="sxs-lookup"><span data-stu-id="ecf57-518">Include a correlation ID that flows across service boundaries.</span></span> <span data-ttu-id="ecf57-519">Se uma transação fluir em vários serviços e houver uma falha, a ID de correlação ajudará a identificar o motivo da falha da transação.</span><span class="sxs-lookup"><span data-stu-id="ecf57-519">If a transaction flows through multiple services and one of them fails, the correlation ID will help you pinpoint why the transaction failed.</span></span>
* <span data-ttu-id="ecf57-520">Use o log semântico, também conhecido como registro em log estruturado.</span><span class="sxs-lookup"><span data-stu-id="ecf57-520">Use semantic logging, also known as structured logging.</span></span> <span data-ttu-id="ecf57-521">Os logs não estruturados dificultam a automatização do consumo e da análise dos dados do log, necessários em escala de nuvem.</span><span class="sxs-lookup"><span data-stu-id="ecf57-521">Unstructured logs make it hard to automate the consumption and analysis of the log data, which is needed at cloud scale.</span></span>
* <span data-ttu-id="ecf57-522">Use logs assíncronos.</span><span class="sxs-lookup"><span data-stu-id="ecf57-522">Use asynchronous logging.</span></span> <span data-ttu-id="ecf57-523">Caso contrário, o próprio sistema de registro em log pode provocar falha do aplicativo com solicitações de backup, pois ocorre bloqueio durante a espera para gravar um evento de log.</span><span class="sxs-lookup"><span data-stu-id="ecf57-523">Otherwise, the logging system itself can cause the application to fail by causing requests to back up, as they block while waiting to write a logging event.</span></span>
* <span data-ttu-id="ecf57-524">Log de aplicativo não é o mesmo que auditoria.</span><span class="sxs-lookup"><span data-stu-id="ecf57-524">Application logging is not the same as auditing.</span></span> <span data-ttu-id="ecf57-525">A auditoria pode ser feita por motivos regulatórios ou de conformidade.</span><span class="sxs-lookup"><span data-stu-id="ecf57-525">Auditing may be done for compliance or regulatory reasons.</span></span> <span data-ttu-id="ecf57-526">Sendo assim, os registros de auditoria devem ser concluídos, não sendo aceitável remover nenhum deles durante o processamento de transações.</span><span class="sxs-lookup"><span data-stu-id="ecf57-526">As such, audit records must be complete, and it's not acceptable to drop any while processing transactions.</span></span> <span data-ttu-id="ecf57-527">Se um aplicativo exigir auditoria, ela deve ser mantida à parte do log de diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="ecf57-527">If an application requires auditing, this should be kept separate from diagnostics logging.</span></span> 

<span data-ttu-id="ecf57-528">Para obter mais informações sobre monitoramento e diagnóstico, consulte [Diretrizes de monitoramento e diagnóstico][monitoring-guidance].</span><span class="sxs-lookup"><span data-stu-id="ecf57-528">For more information about monitoring and diagnostics, see [Monitoring and diagnostics guidance][monitoring-guidance].</span></span>

## <a name="respond-to-failures"></a><span data-ttu-id="ecf57-529">Responder a falhas</span><span class="sxs-lookup"><span data-stu-id="ecf57-529">Respond to failures</span></span>
<span data-ttu-id="ecf57-530">As seções anteriores se concentraram em estratégias de recuperação automatizada, que são essenciais para a alta disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="ecf57-530">Previous sections have focused on automated recovery strategies, which are critical for high availability.</span></span> <span data-ttu-id="ecf57-531">No entanto, às vezes, a intervenção manual, é necessária.</span><span class="sxs-lookup"><span data-stu-id="ecf57-531">However, sometimes manual intervention is needed.</span></span>

* <span data-ttu-id="ecf57-532">**Alertas**.</span><span class="sxs-lookup"><span data-stu-id="ecf57-532">**Alerts**.</span></span> <span data-ttu-id="ecf57-533">Monitore seu aplicativo, observando sinais de aviso que podem exigir intervenção proativa.</span><span class="sxs-lookup"><span data-stu-id="ecf57-533">Monitor your application for warning signs that may require proactive intervention.</span></span> <span data-ttu-id="ecf57-534">Por exemplo, se você vir que o Banco de Dados SQL ou o Cosmos DB limitam repetidamente o seu aplicativo, talvez seja preciso aumentar a capacidade do banco de dados ou otimizar suas consultas.</span><span class="sxs-lookup"><span data-stu-id="ecf57-534">For example, if you see that SQL Database or Cosmos DB consistently throttles your application, you might need to increase your database capacity or optimize your queries.</span></span> <span data-ttu-id="ecf57-535">Neste exemplo, mesmo que o aplicativo consiga manipular esses erros de limitação de forma transparente, sua telemetria deve gerar um alerta, para que você possa acompanhar.</span><span class="sxs-lookup"><span data-stu-id="ecf57-535">In this example, even though the application might handle the throttling errors transparently, your telemetry should still raise an alert so that you can follow up.</span></span>  
* <span data-ttu-id="ecf57-536">**Failover manual**.</span><span class="sxs-lookup"><span data-stu-id="ecf57-536">**Manual failover**.</span></span> <span data-ttu-id="ecf57-537">Alguns sistemas não conseguem executar failover automaticamente, e ele deve ser manual.</span><span class="sxs-lookup"><span data-stu-id="ecf57-537">Some systems cannot fail over automatically and require a manual failover.</span></span> 
* <span data-ttu-id="ecf57-538">**Testes de preparação operacional**.</span><span class="sxs-lookup"><span data-stu-id="ecf57-538">**Operational readiness testing**.</span></span> <span data-ttu-id="ecf57-539">Se o seu aplicativo executar failover para uma região secundária, você deve executar um teste de preparação operacional antes do failback para a região principal.</span><span class="sxs-lookup"><span data-stu-id="ecf57-539">If your application fails over to a secondary region, you should perform an operational readiness test before you fail back to the primary region.</span></span> <span data-ttu-id="ecf57-540">Esse teste deve verificar se a região principal está íntegra e pronta para receber o tráfego.</span><span class="sxs-lookup"><span data-stu-id="ecf57-540">The test should verify that the primary region is healthy and ready to receive traffic again.</span></span>
* <span data-ttu-id="ecf57-541">**Verificação de consistência de dados**.</span><span class="sxs-lookup"><span data-stu-id="ecf57-541">**Data consistency check**.</span></span> <span data-ttu-id="ecf57-542">Se houver falha em um armazenamento de dados, pode haver inconsistências de dados quando o armazenamento voltar a ser disponibilizado, especialmente se os dados tiverem sido replicados.</span><span class="sxs-lookup"><span data-stu-id="ecf57-542">If a failure happens in a data store, there may be data inconsistencies when the store becomes available again, especially if the data was replicated.</span></span> 
* <span data-ttu-id="ecf57-543">**Restauração com base em backup**.</span><span class="sxs-lookup"><span data-stu-id="ecf57-543">**Restoring from backup**.</span></span> <span data-ttu-id="ecf57-544">Por exemplo, se o Banco de Dados SQL sofrer uma interrupção regional, você pode fazer uma restauração geográfica do banco de dados com base no backup mais recente.</span><span class="sxs-lookup"><span data-stu-id="ecf57-544">For example, if SQL Database experiences a regional outage, you can geo-restore the database from the latest backup.</span></span>

<span data-ttu-id="ecf57-545">Documente e teste seu plano de recuperação de desastres.</span><span class="sxs-lookup"><span data-stu-id="ecf57-545">Document and test your disaster recovery plan.</span></span> <span data-ttu-id="ecf57-546">Avalie o impacto das falhas de aplicativos sobre os negócios.</span><span class="sxs-lookup"><span data-stu-id="ecf57-546">Evaluate the business impact of application failures.</span></span> <span data-ttu-id="ecf57-547">Automatize o processo tanto quanto possível, e documente todas as etapas manuais, como failover manual ou restauração de dados com base em backups.</span><span class="sxs-lookup"><span data-stu-id="ecf57-547">Automate the process as much as possible, and document any manual steps, such as manual failover or data restoration from backups.</span></span> <span data-ttu-id="ecf57-548">Teste regularmente seu processo de recuperação de desastres, para validar e aprimorar o plano.</span><span class="sxs-lookup"><span data-stu-id="ecf57-548">Regularly test your disaster recovery process to validate and improve the plan.</span></span> 

## <a name="summary"></a><span data-ttu-id="ecf57-549">Resumo</span><span class="sxs-lookup"><span data-stu-id="ecf57-549">Summary</span></span>
<span data-ttu-id="ecf57-550">Este artigo discutiu a resiliência sob uma perspectiva holística, enfatizando alguns dos desafios exclusivos da nuvem.</span><span class="sxs-lookup"><span data-stu-id="ecf57-550">This article discussed resiliency from a holistic perspective, emphasizing some of the unique challenges of the cloud.</span></span> <span data-ttu-id="ecf57-551">Eles incluem a natureza distribuída de computação em nuvem, o uso de hardware de mercadoria e a presença de falhas de rede temporárias.</span><span class="sxs-lookup"><span data-stu-id="ecf57-551">These include the distributed nature of cloud computing, the use of commodity hardware, and the presence of transient network faults.</span></span>

<span data-ttu-id="ecf57-552">Estes são os principais pontos a serem lembrados neste artigo:</span><span class="sxs-lookup"><span data-stu-id="ecf57-552">Here are the major points to take away from this article:</span></span>

* <span data-ttu-id="ecf57-553">A resiliência leva à maior disponibilidade e diminui o tempo médio de recuperação de falhas.</span><span class="sxs-lookup"><span data-stu-id="ecf57-553">Resiliency leads to higher availability, and lower mean time to recover from failures.</span></span> 
* <span data-ttu-id="ecf57-554">A resiliência na nuvem requer um conjunto de técnicas diferentes das soluções tradicionais locais.</span><span class="sxs-lookup"><span data-stu-id="ecf57-554">Achieving resiliency in the cloud requires a different set of techniques from traditional on-premises solutions.</span></span> 
* <span data-ttu-id="ecf57-555">A resiliência não é acidental.</span><span class="sxs-lookup"><span data-stu-id="ecf57-555">Resiliency does not happen by accident.</span></span> <span data-ttu-id="ecf57-556">Ela deve ser projetada e construída desde o início.</span><span class="sxs-lookup"><span data-stu-id="ecf57-556">It must be designed and built in from the start.</span></span>
* <span data-ttu-id="ecf57-557">Resiliência é algo que deve existir em todas as partes do ciclo de vida do aplicativo, do planejamento e da codificação às operações.</span><span class="sxs-lookup"><span data-stu-id="ecf57-557">Resiliency touches every part of the application lifecycle, from planning and coding to operations.</span></span>
* <span data-ttu-id="ecf57-558">Teste e monitore!</span><span class="sxs-lookup"><span data-stu-id="ecf57-558">Test and monitor!</span></span>


<!-- links -->

[blue-green]: https://martinfowler.com/bliki/BlueGreenDeployment.html
[canary-release]: https://martinfowler.com/bliki/CanaryRelease.html
[circuit-breaker-pattern]: https://msdn.microsoft.com/library/dn589784.aspx
[compensating-transaction-pattern]: https://msdn.microsoft.com/library/dn589804.aspx
[containers]: https://en.wikipedia.org/wiki/Operating-system-level_virtualization
[dsc]: /azure/automation/automation-dsc-overview
[contingency-planning-guide]: https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-34r1.pdf
[fma]: failure-mode-analysis.md
[hystrix]: https://medium.com/netflix-techblog/introducing-hystrix-for-resilience-engineering-13531c1ab362
[jmeter]: https://jmeter.apache.org/
[load-leveling-pattern]: ../patterns/queue-based-load-leveling.md
[monitoring-guidance]: ../best-practices/monitoring.md
[ra-basic-web]: ../reference-architectures/app-service-web-app/basic-web-app.md
[ra-multi-vm]: ../reference-architectures/virtual-machines-windows/multi-vm.md
[checklist]: ../checklist/resiliency.md
[retry-pattern]: ../patterns/retry.md
[retry-service-specific guidance]: ../best-practices/retry-service-specific.md
[sla]: https://azure.microsoft.com/support/legal/sla/
[throttling-pattern]: ../patterns/throttling.md
[tm]: https://azure.microsoft.com/services/traffic-manager/
[tm-failover]: /azure/traffic-manager/traffic-manager-monitoring
[tm-sla]: https://azure.microsoft.com/support/legal/sla/traffic-manager
[site-recovery]:/azure/site-recovery/azure-to-azure-quickstart/
