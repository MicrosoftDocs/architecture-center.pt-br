---
title: Padrão embaixador
description: Crie serviços auxiliares que enviam solicitações de rede em nome de um consumidor de serviço ou aplicativo.
author: dragon119
ms.date: 06/23/2017
ms.openlocfilehash: 6c545619aab6a5817e55854350e3769834df27cd
ms.sourcegitcommit: b0482d49aab0526be386837702e7724c61232c60
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/14/2017
---
# <a name="ambassador-pattern"></a><span data-ttu-id="170f0-103">Padrão embaixador</span><span class="sxs-lookup"><span data-stu-id="170f0-103">Ambassador pattern</span></span>

<span data-ttu-id="170f0-104">Crie serviços auxiliares que enviam solicitações de rede em nome de um consumidor de serviço ou aplicativo.</span><span class="sxs-lookup"><span data-stu-id="170f0-104">Create helper services that send network requests on behalf of a consumer service or application.</span></span> <span data-ttu-id="170f0-105">Um serviço Embaixador pode ser pensado como um proxy de fora do processo colocalizado com o cliente.</span><span class="sxs-lookup"><span data-stu-id="170f0-105">An ambassador service can be thought of as an out-of-process proxy that is co-located with the client.</span></span>

<span data-ttu-id="170f0-106">Esse padrão pode ser útil para descarregar tarefas comuns de conectividade do cliente, como monitoramento, registro em log, roteamento, segurança (como TLS) e [padrões de resiliência][resiliency-patterns] de maneira independente de linguagem.</span><span class="sxs-lookup"><span data-stu-id="170f0-106">This pattern can be useful for offloading common client connectivity tasks such as monitoring, logging, routing, security (such as TLS), and [resiliency patterns][resiliency-patterns] in a language agnostic way.</span></span> <span data-ttu-id="170f0-107">Ele geralmente é usado com aplicativos herdados ou outros aplicativos difíceis de modificar, para ampliar seus recursos de rede.</span><span class="sxs-lookup"><span data-stu-id="170f0-107">It is often used with legacy applications, or other applications that are difficult to modify, in order to extend their networking capabilities.</span></span> <span data-ttu-id="170f0-108">Também pode habilitar uma equipe especializada para implementar esses recursos.</span><span class="sxs-lookup"><span data-stu-id="170f0-108">It can also enable a specialized team to implement those features.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="170f0-109">Contexto e problema</span><span class="sxs-lookup"><span data-stu-id="170f0-109">Context and problem</span></span>

<span data-ttu-id="170f0-110">Aplicativos baseados em nuvem resilientes exigem recursos como [quebra circuito][circuit-breaker], roteamento, medição e monitoramento, além da capacidade de fazer atualizações de configuração relacionadas à rede.</span><span class="sxs-lookup"><span data-stu-id="170f0-110">Resilient cloud-based applications require features such as [circuit breaking][circuit-breaker], routing, metering and monitoring, and the ability to make network-related configuration updates.</span></span> <span data-ttu-id="170f0-111">Pode ser difícil ou impossível atualizar aplicativos herdados ou bibliotecas de código existente para adicionar esses recursos, pois o código não será mais mantido ou não poderá ser facilmente modificado pela equipe de desenvolvimento.</span><span class="sxs-lookup"><span data-stu-id="170f0-111">It may be difficult or impossible to update legacy applications or existing code libraries to add these features, because the code is no longer maintained or can't be easily modified by the development team.</span></span>

<span data-ttu-id="170f0-112">Chamadas de rede também podem exigir configuração significativa para conexão, autenticação e autorização.</span><span class="sxs-lookup"><span data-stu-id="170f0-112">Network calls may also require substantial configuration for connection, authentication, and authorization.</span></span> <span data-ttu-id="170f0-113">Se essas chamadas forem usadas em vários aplicativos, criados usando vários idiomas e estruturas, as chamadas deverão ser configuradas para cada uma dessas instâncias.</span><span class="sxs-lookup"><span data-stu-id="170f0-113">If these calls are used across multiple applications, built using multiple languages and frameworks, the calls must be configured for each of these instances.</span></span> <span data-ttu-id="170f0-114">Além disso, funcionalidade de segurança de rede poderá precisar ser gerenciada por uma equipe central na sua organização.</span><span class="sxs-lookup"><span data-stu-id="170f0-114">In addition, network and security functionality may need to be managed by a central team within your organization.</span></span> <span data-ttu-id="170f0-115">Com uma base de código grande, pode ser arriscado para essa equipe atualizar código de aplicativo com a qual não esteja familiarizada.</span><span class="sxs-lookup"><span data-stu-id="170f0-115">With a large code base, it can be risky for that team to update application code they aren't familiar with.</span></span>

## <a name="solution"></a><span data-ttu-id="170f0-116">Solução</span><span class="sxs-lookup"><span data-stu-id="170f0-116">Solution</span></span>

<span data-ttu-id="170f0-117">Coloque estruturas e bibliotecas de cliente em um processo externo que atue como proxy entre seus aplicativos e serviços externos.</span><span class="sxs-lookup"><span data-stu-id="170f0-117">Put client frameworks and libraries into an external process that acts as a proxy between your application and external services.</span></span> <span data-ttu-id="170f0-118">Implante o proxy no mesmo ambiente de host que seu aplicativo para permitir o controle sobre roteamento, resiliência e recursos de segurança, além de evitar quaisquer restrições de acesso relacionadas ao host.</span><span class="sxs-lookup"><span data-stu-id="170f0-118">Deploy the proxy on the same host environment as your application to allow control over routing, resiliency, security features, and to avoid any host-related access restrictions.</span></span> <span data-ttu-id="170f0-119">Você também pode usar o padrão de embaixador para padronizar e estender a instrumentação.</span><span class="sxs-lookup"><span data-stu-id="170f0-119">You can also use the ambassador pattern to standardize and extend instrumentation.</span></span> <span data-ttu-id="170f0-120">O proxy pode monitorar métricas de desempenho, como latência ou uso de recursos, e esse monitoramento acontece no mesmo ambiente de host que o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="170f0-120">The proxy can monitor performance metrics such as latency or resource usage, and this monitoring happens in the same host environment as the application.</span></span>

![](./_images/ambassador.png)

<span data-ttu-id="170f0-121">Os recursos que são descarregados para o embaixador podem ser gerenciados de maneira independente do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="170f0-121">Features that are offloaded to the ambassador can be managed independently of the application.</span></span> <span data-ttu-id="170f0-122">Você pode atualizar e modificar o embaixador sem afetar a funcionalidade herdada do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="170f0-122">You can update and modify the ambassador without disturbing the application's legacy functionality.</span></span> <span data-ttu-id="170f0-123">Ele também permite equipes especializadas separadas implementar e manter os recursos de segurança, rede ou autenticação movidos para o embaixador.</span><span class="sxs-lookup"><span data-stu-id="170f0-123">It also allows for separate, specialized teams to implement and maintain security, networking, or authentication features that have been moved to the ambassador.</span></span>

<span data-ttu-id="170f0-124">Os serviços do embaixador podem ser implantados como um [sidecar][sidecar] para acompanhar o ciclo de vida de um aplicativo ou serviço consumidor.</span><span class="sxs-lookup"><span data-stu-id="170f0-124">Ambassador services can be deployed as a [sidecar][sidecar] to accompany the lifecycle of a consuming application or service.</span></span> <span data-ttu-id="170f0-125">Como alternativa, se um embaixador for compartilhado por vários processos separados em um host em comum, ele poderá ser implantado como um daemon ou o serviço Windows.</span><span class="sxs-lookup"><span data-stu-id="170f0-125">Alternatively, if an ambassador is shared by multiple separate processes on a common host, it can be deployed as a daemon or Windows service.</span></span> <span data-ttu-id="170f0-126">Se o serviço consumidor estiver em contêineres, o embaixador deverá ser criado como um contêiner separado no mesmo host, com os links apropriados configurados para comunicação.</span><span class="sxs-lookup"><span data-stu-id="170f0-126">If the consuming service is containerized, the ambassador should be created as a separate container on the same host, with the appropriate links configured for communication.</span></span>

## <a name="issues-and-considerations"></a><span data-ttu-id="170f0-127">Problemas e considerações</span><span class="sxs-lookup"><span data-stu-id="170f0-127">Issues and considerations</span></span>

- <span data-ttu-id="170f0-128">O proxy adiciona alguma sobrecarga de latência.</span><span class="sxs-lookup"><span data-stu-id="170f0-128">The proxy adds some latency overhead.</span></span> <span data-ttu-id="170f0-129">Considere se uma biblioteca cliente, invocada diretamente pelo aplicativo, é uma abordagem melhor.</span><span class="sxs-lookup"><span data-stu-id="170f0-129">Consider whether a client library, invoked directly by the application, is a better approach.</span></span>
- <span data-ttu-id="170f0-130">Considere o possível impacto de incluir recursos generalizados no proxy.</span><span class="sxs-lookup"><span data-stu-id="170f0-130">Consider the possible impact of including generalized features in the proxy.</span></span> <span data-ttu-id="170f0-131">Por exemplo, o embaixador pode lidar com novas tentativas, mas isso pode não ser seguro, a menos que todas as operações sejam idempotentes.</span><span class="sxs-lookup"><span data-stu-id="170f0-131">For example, the ambassador could handle retries, but that might not be safe unless all operations are idempotent.</span></span>
- <span data-ttu-id="170f0-132">Considere um mecanismo para permitir que o cliente passe algum contexto para o proxy, bem como de volta ao cliente.</span><span class="sxs-lookup"><span data-stu-id="170f0-132">Consider a mechanism to allow the client to pass some context to the proxy, as well as back to the client.</span></span> <span data-ttu-id="170f0-133">Por exemplo, inclua cabeçalhos de solicitação HTTP para recusar a nova tentativa ou especificar o número máximo de tentativas.</span><span class="sxs-lookup"><span data-stu-id="170f0-133">For example, include HTTP request headers to opt out of retry or specify the maximum number of times to retry.</span></span>
- <span data-ttu-id="170f0-134">Considere como você vai empacotar e implantar o proxy.</span><span class="sxs-lookup"><span data-stu-id="170f0-134">Consider how you will package and deploy the proxy.</span></span>
- <span data-ttu-id="170f0-135">Considere se vai usar uma única instância compartilhada para todos os clientes ou uma instância para cada cliente.</span><span class="sxs-lookup"><span data-stu-id="170f0-135">Consider whether to use a single shared instance for all clients or an instance for each client.</span></span>

## <a name="when-to-use-this-pattern"></a><span data-ttu-id="170f0-136">Quando usar esse padrão</span><span class="sxs-lookup"><span data-stu-id="170f0-136">When to use this pattern</span></span>

<span data-ttu-id="170f0-137">Use este padrão quando:</span><span class="sxs-lookup"><span data-stu-id="170f0-137">Use this pattern when you:</span></span>

- <span data-ttu-id="170f0-138">For necessário criar um conjunto comum de recursos de conectividade do cliente para vários idiomas ou estruturas.</span><span class="sxs-lookup"><span data-stu-id="170f0-138">Need to build a common set of client connectivity features for multiple languages or frameworks.</span></span>
- <span data-ttu-id="170f0-139">For necessário descarregar preocupações de conectividade de cliente cross-cutting para os desenvolvedores de infraestrutura ou outras equipes mais especializadas.</span><span class="sxs-lookup"><span data-stu-id="170f0-139">Need to offload cross-cutting client connectivity concerns to infrastructure developers or other more specialized teams.</span></span>
- <span data-ttu-id="170f0-140">For necessário dar suporte a requisitos de conectividade em nuvem ou cluster em um aplicativo herdado ou em um aplicativo difícil de modificar.</span><span class="sxs-lookup"><span data-stu-id="170f0-140">Need to support cloud or cluster connectivity requirements in a legacy application or an application that is difficult to modify.</span></span>

<span data-ttu-id="170f0-141">Esse padrão pode não ser adequado:</span><span class="sxs-lookup"><span data-stu-id="170f0-141">This pattern may not be suitable:</span></span>

- <span data-ttu-id="170f0-142">Quando a latência de solicitação de rede for crítica.</span><span class="sxs-lookup"><span data-stu-id="170f0-142">When network request latency is critical.</span></span> <span data-ttu-id="170f0-143">Um proxy introduzirá alguma sobrecarga, embora mínima e, em alguns casos, isso poderá afetar o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="170f0-143">A proxy will introduce some overhead, although minimal, and in some cases this may affect the application.</span></span>
- <span data-ttu-id="170f0-144">Quando os recursos de conectividade de cliente forem consumidos por uma única linguagem.</span><span class="sxs-lookup"><span data-stu-id="170f0-144">When client connectivity features are consumed by a single language.</span></span> <span data-ttu-id="170f0-145">Nesse caso, a melhor opção pode ser uma biblioteca cliente distribuída para as equipes de desenvolvimento como um pacote.</span><span class="sxs-lookup"><span data-stu-id="170f0-145">In that case, a better option might be a client library that is distributed to the development teams as a package.</span></span>
- <span data-ttu-id="170f0-146">Quando os recursos de conectividade não podem ser generalizados e exigem uma integração mais profunda com o aplicativo cliente.</span><span class="sxs-lookup"><span data-stu-id="170f0-146">When connectivity features cannot be generalized and require deeper integration with the client application.</span></span>

## <a name="example"></a><span data-ttu-id="170f0-147">Exemplo</span><span class="sxs-lookup"><span data-stu-id="170f0-147">Example</span></span>

<span data-ttu-id="170f0-148">O diagrama a seguir mostra um aplicativo fazendo uma solicitação para um serviço remoto por meio de um proxy embaixador.</span><span class="sxs-lookup"><span data-stu-id="170f0-148">The following diagram shows an application making a request to a remote service via an ambassador proxy.</span></span> <span data-ttu-id="170f0-149">O embaixador possibilita roteamento, interrupção de circuito e registro em log.</span><span class="sxs-lookup"><span data-stu-id="170f0-149">The ambassador provides routing, circuit breaking, and logging.</span></span> <span data-ttu-id="170f0-150">Ele chama o serviço remoto e, em seguida, retorna a resposta ao aplicativo cliente:</span><span class="sxs-lookup"><span data-stu-id="170f0-150">It calls the remote service and then returns the response to the client application:</span></span>

![](./_images/ambassador-example.png) 

## <a name="related-guidance"></a><span data-ttu-id="170f0-151">Diretrizes relacionadas</span><span class="sxs-lookup"><span data-stu-id="170f0-151">Related guidance</span></span>

- [<span data-ttu-id="170f0-152">Padrão sidecar</span><span class="sxs-lookup"><span data-stu-id="170f0-152">Sidecar pattern</span></span>](./sidecar.md)

<!-- links -->

[circuit-breaker]: ./circuit-breaker.md
[resiliency-patterns]: ./category/resiliency.md
[sidecar]: ./sidecar.md
