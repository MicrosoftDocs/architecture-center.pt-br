---
title: Padrão de gatekeeper
titleSuffix: Cloud Design Patterns
description: Proteger aplicativos e serviços usando uma instância de host dedicado que atua como intermediário entre clientes e o aplicativo ou serviço, valida e corrige solicitações e passa solicitações e dados entre eles.
keywords: padrão de design
author: dragon119
ms.date: 06/23/2017
ms.custom: seodec18
ms.openlocfilehash: a45ace8ea05e4a7dd1d8a48653e94a5fe5bfb0f6
ms.sourcegitcommit: 680c9cef945dff6fee5e66b38e24f07804510fa9
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/04/2019
ms.locfileid: "54009688"
---
# <a name="gatekeeper-pattern"></a><span data-ttu-id="81313-104">Padrão de gatekeeper</span><span class="sxs-lookup"><span data-stu-id="81313-104">Gatekeeper pattern</span></span>

[!INCLUDE [header](../_includes/header.md)]

<span data-ttu-id="81313-105">Proteger aplicativos e serviços usando uma instância de host dedicado que atua como intermediário entre clientes e o aplicativo ou serviço, valida e corrige solicitações e passa solicitações e dados entre eles.</span><span class="sxs-lookup"><span data-stu-id="81313-105">Protect applications and services by using a dedicated host instance that acts as a broker between clients and the application or service, validates and sanitizes requests, and passes requests and data between them.</span></span> <span data-ttu-id="81313-106">Isso pode fornecer uma camada adicional de segurança e limitar a superfície de ataque do sistema.</span><span class="sxs-lookup"><span data-stu-id="81313-106">This can provide an additional layer of security, and limit the attack surface of the system.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="81313-107">Contexto e problema</span><span class="sxs-lookup"><span data-stu-id="81313-107">Context and problem</span></span>

<span data-ttu-id="81313-108">Aplicativos expõem suas funcionalidades a clientes ao aceitar e processar solicitações.</span><span class="sxs-lookup"><span data-stu-id="81313-108">Applications expose their functionality to clients by accepting and processing requests.</span></span> <span data-ttu-id="81313-109">Em cenários hospedados na nuvem, aplicativos expõem pontos de extremidade aos quais os clientes se conectam e normalmente incluem o código para manipular as solicitações de clientes.</span><span class="sxs-lookup"><span data-stu-id="81313-109">In cloud-hosted scenarios, applications expose endpoints clients connect to, and typically include the code to handle the requests from clients.</span></span> <span data-ttu-id="81313-110">Esse código executa autenticação e validação, processamento de algumas ou todas as solicitações e provavelmente acessa o armazenamento e outros serviços em nome do cliente.</span><span class="sxs-lookup"><span data-stu-id="81313-110">This code performs authentication and validation, some or all request processing, and is likely to accesses storage and other services on behalf of the client.</span></span>

<span data-ttu-id="81313-111">Se um usuário mal-intencionado conseguir comprometer o sistema e obter acesso ao ambiente de hospedagem do aplicativo, os mecanismos de segurança usados por ele, como credenciais e chaves de armazenamento, e os serviços e os dados acessados por ele serão expostos.</span><span class="sxs-lookup"><span data-stu-id="81313-111">If a malicious user is able to compromise the system and gain access to the application’s hosting environment, the security mechanisms it uses such as credentials and storage keys, and the services and data it accesses, are exposed.</span></span> <span data-ttu-id="81313-112">Como resultado, o usuário mal-intencionado pode obter acesso irrestrito a informações e outros serviços confidenciais.</span><span class="sxs-lookup"><span data-stu-id="81313-112">As a result, the malicious user can gain unrestrained access to sensitive information and other services.</span></span>

## <a name="solution"></a><span data-ttu-id="81313-113">Solução</span><span class="sxs-lookup"><span data-stu-id="81313-113">Solution</span></span>

<span data-ttu-id="81313-114">Para minimizar o risco de clientes obterem acesso a informações e serviços confidenciais, desacoplar hosts ou tarefas que exponham pontos de extremidade públicos do código que processa solicitações e acessa o armazenamento.</span><span class="sxs-lookup"><span data-stu-id="81313-114">To minimize the risk of clients gaining access to sensitive information and services, decouple hosts or tasks that expose public endpoints from the code that processes requests and accesses storage.</span></span> <span data-ttu-id="81313-115">Você pode fazer isso usando uma fachada ou uma tarefa dedicada que interage com os clientes e, em seguida, transmite a solicitação &mdash; talvez por meio de uma interface desacoplada &mdash; aos hosts ou às tarefas que manipularão a solicitação.</span><span class="sxs-lookup"><span data-stu-id="81313-115">You can achieve this by using a façade or a dedicated task that interacts with clients and then hands off the request&mdash;perhaps through a decoupled interface&mdash;to the hosts or tasks that'll handle the request.</span></span> <span data-ttu-id="81313-116">A figura fornece uma visão geral de alto nível desse padrão.</span><span class="sxs-lookup"><span data-stu-id="81313-116">The figure provides a high-level overview of this pattern.</span></span>

![Visão geral de alto nível desse padrão](./_images/gatekeeper-diagram.png)

<span data-ttu-id="81313-118">O padrão de gatekeeper pode ser usado para simplesmente proteger o armazenamento ou pode ser usado como fachada mais abrangente para proteger todas as funções do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="81313-118">The gatekeeper pattern can be used to simply protect storage, or it can be used as a more comprehensive façade to protect all of the functions of the application.</span></span> <span data-ttu-id="81313-119">Os fatores importantes são:</span><span class="sxs-lookup"><span data-stu-id="81313-119">The important factors are:</span></span>

- <span data-ttu-id="81313-120">**Validação controlada**.</span><span class="sxs-lookup"><span data-stu-id="81313-120">**Controlled validation**.</span></span> <span data-ttu-id="81313-121">O gatekeeper valida todas as solicitações e rejeita as que não atendem aos requisitos de validação.</span><span class="sxs-lookup"><span data-stu-id="81313-121">The gatekeeper validates all requests, and rejects those that don't meet validation requirements.</span></span>
- <span data-ttu-id="81313-122">**Risco e exposição limitados**.</span><span class="sxs-lookup"><span data-stu-id="81313-122">**Limited risk and exposure**.</span></span> <span data-ttu-id="81313-123">O gatekeeper não tem acesso às credenciais ou às chaves usadas pelo host confiável para acessar o armazenamento e serviços.</span><span class="sxs-lookup"><span data-stu-id="81313-123">The gatekeeper doesn't have access to the credentials or keys used by the trusted host to access storage and services.</span></span> <span data-ttu-id="81313-124">Se o gatekeeper estiver comprometido, o invasor não obterá acesso a essas credenciais ou chaves.</span><span class="sxs-lookup"><span data-stu-id="81313-124">If the gatekeeper is compromised, the attacker doesn't get access to these credentials or keys.</span></span>
- <span data-ttu-id="81313-125">**Segurança adequada**.</span><span class="sxs-lookup"><span data-stu-id="81313-125">**Appropriate security**.</span></span> <span data-ttu-id="81313-126">O gatekeeper é executado em modo de privilégio limitado, enquanto o restante do aplicativo é executado no modo de confiança total necessário para acessar o armazenamento e os serviços.</span><span class="sxs-lookup"><span data-stu-id="81313-126">The gatekeeper runs in a limited privilege mode, while the rest of the application runs in the full trust mode required to access storage and services.</span></span> <span data-ttu-id="81313-127">Se o gatekeeper estiver comprometido, ele não poderá acessar diretamente os serviços ou dados do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="81313-127">If the gatekeeper is compromised, it can't directly access the application services or data.</span></span>

<span data-ttu-id="81313-128">Esse padrão funciona como firewall em uma topografia de rede típica.</span><span class="sxs-lookup"><span data-stu-id="81313-128">This pattern acts like a firewall in a typical network topography.</span></span> <span data-ttu-id="81313-129">Ele permite que o gatekeeper examine as solicitações e tome uma decisão sobre se deve passar a solicitação para o host confiável (às vezes chamado de keymaster) que executa as tarefas necessárias.</span><span class="sxs-lookup"><span data-stu-id="81313-129">It allows the gatekeeper to examine requests and make a decision about whether to pass the request on to the trusted host (sometimes called the keymaster) that performs the required tasks.</span></span> <span data-ttu-id="81313-130">Essa decisão normalmente requer que gatekeeper valide e limpe o conteúdo da solicitação antes de passá-la para o host confiável.</span><span class="sxs-lookup"><span data-stu-id="81313-130">This decision typically requires the gatekeeper to validate and sanitize the request content before passing it on to the trusted host.</span></span>

## <a name="issues-and-considerations"></a><span data-ttu-id="81313-131">Problemas e considerações</span><span class="sxs-lookup"><span data-stu-id="81313-131">Issues and considerations</span></span>

<span data-ttu-id="81313-132">Considere os seguintes pontos ao decidir como implementar esse padrão:</span><span class="sxs-lookup"><span data-stu-id="81313-132">Consider the following points when deciding how to implement this pattern:</span></span>

- <span data-ttu-id="81313-133">Certifique-se de que os hosts confiáveis aos quais o gatekeeper passa as solicitações exponham apenas pontos de extremidade internos ou protegidos e conectem-se somente ao gatekeeper.</span><span class="sxs-lookup"><span data-stu-id="81313-133">Ensure that the trusted hosts the gatekeeper passes requests to expose only internal or protected endpoints, and connect only to the gatekeeper.</span></span> <span data-ttu-id="81313-134">Os hosts confiáveis não devem expor nenhum ponto de extremidade externo ou interface.</span><span class="sxs-lookup"><span data-stu-id="81313-134">The trusted hosts shouldn't expose any external endpoints or interfaces.</span></span>
- <span data-ttu-id="81313-135">O gatekeeper deve ser executado em modo de privilégio limitado.</span><span class="sxs-lookup"><span data-stu-id="81313-135">The gatekeeper must run in a limited privilege mode.</span></span> <span data-ttu-id="81313-136">Normalmente, isso significa executar o gatekeeper e o host confiável em serviços hospedados ou máquinas virtuais separadas.</span><span class="sxs-lookup"><span data-stu-id="81313-136">Typically this means running the gatekeeper and the trusted host in separate hosted services or virtual machines.</span></span>
- <span data-ttu-id="81313-137">O gatekeeper não deve executar nenhum processamento relacionado ao aplicativo ou a serviços nem acessar dados.</span><span class="sxs-lookup"><span data-stu-id="81313-137">The gatekeeper shouldn't perform any processing related to the application or services, or access any data.</span></span> <span data-ttu-id="81313-138">Sua função é puramente validar e corrigir solicitações.</span><span class="sxs-lookup"><span data-stu-id="81313-138">Its function is purely to validate and sanitize requests.</span></span> <span data-ttu-id="81313-139">Os hosts confiáveis talvez precisem executar uma validação adicional das solicitações, mas a validação do núcleo deve ser executada pelo gatekeeper.</span><span class="sxs-lookup"><span data-stu-id="81313-139">The trusted hosts might need to perform additional validation of requests, but the core validation should be performed by the gatekeeper.</span></span>
- <span data-ttu-id="81313-140">Use um canal de comunicação seguro (HTTPS, SSL ou TLS) entre o gatekeeper e os hosts confiáveis ou tarefas quando for possível.</span><span class="sxs-lookup"><span data-stu-id="81313-140">Use a secure communication channel (HTTPS, SSL, or TLS) between the gatekeeper and the trusted hosts or tasks where this is possible.</span></span> <span data-ttu-id="81313-141">No entanto, alguns ambientes de hospedagem não oferecem suporte a HTTPS em pontos de extremidade internos.</span><span class="sxs-lookup"><span data-stu-id="81313-141">However, some hosting environments don't support HTTPS on internal endpoints.</span></span>
- <span data-ttu-id="81313-142">Adicionar a camada extra ao aplicativo para implementar o padrão do gatekeeper provavelmente terá um impacto no desempenho devido ao processamento adicional e na comunicação de rede exigida por ele.</span><span class="sxs-lookup"><span data-stu-id="81313-142">Adding the extra layer to the application to implement the gatekeeper pattern is likely to have some impact on performance due to the additional processing and network communication it requires.</span></span>
- <span data-ttu-id="81313-143">A instância do gatekeeper pode ser um ponto único de falha.</span><span class="sxs-lookup"><span data-stu-id="81313-143">The gatekeeper instance could be a single point of failure.</span></span> <span data-ttu-id="81313-144">Para minimizar o impacto de uma falha, considere implantar instâncias adicionais e usar um mecanismo de dimensionamento automático para garantir a capacidade de manter a disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="81313-144">To minimize the impact of a failure, consider deploying additional instances and using an autoscaling mechanism to ensure capacity to maintain availability.</span></span>

## <a name="when-to-use-this-pattern"></a><span data-ttu-id="81313-145">Quando usar esse padrão</span><span class="sxs-lookup"><span data-stu-id="81313-145">When to use this pattern</span></span>

<span data-ttu-id="81313-146">Esse padrão é útil para:</span><span class="sxs-lookup"><span data-stu-id="81313-146">This pattern is useful for:</span></span>

- <span data-ttu-id="81313-147">Aplicativos que lidem com informações confidenciais, exponham serviços que devem ter um alto grau de proteção contra ataques mal-intencionados ou executem operações essenciais que não devem ser interrompidas.</span><span class="sxs-lookup"><span data-stu-id="81313-147">Applications that handle sensitive information, expose services that must have a high degree of protection from malicious attacks, or perform mission-critical operations that shouldn't be disrupted.</span></span>
- <span data-ttu-id="81313-148">Aplicativos distribuídos nos quais é necessário executar a validação de solicitação separadamente das principais tarefas ou centralizar essa validação para simplificar a manutenção e administração.</span><span class="sxs-lookup"><span data-stu-id="81313-148">Distributed applications where it's necessary to perform request validation separately from the main tasks, or to centralize this validation to simplify maintenance and administration.</span></span>

## <a name="example"></a><span data-ttu-id="81313-149">Exemplo</span><span class="sxs-lookup"><span data-stu-id="81313-149">Example</span></span>

<span data-ttu-id="81313-150">Quando hospedado em nuvem, esse padrão pode ser implementado ao desacoplar a função do gatekeeper ou da máquina virtual das funções confiáveis e serviços em um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="81313-150">In a cloud-hosted scenario, this pattern can be implemented by decoupling the gatekeeper role or virtual machine from the trusted roles and services in an application.</span></span> <span data-ttu-id="81313-151">Faça isso usando um ponto de extremidade, fila ou armazenamento interno como mecanismo de comunicação intermediário.</span><span class="sxs-lookup"><span data-stu-id="81313-151">Do this by using an internal endpoint, a queue, or storage as an intermediate communication mechanism.</span></span> <span data-ttu-id="81313-152">A figura ilustra o uso de um ponto de extremidade interno.</span><span class="sxs-lookup"><span data-stu-id="81313-152">The figure illustrates using an internal endpoint.</span></span>

![Um exemplo do padrão usando as funções de trabalho e da web de Serviços de Nuvem](./_images/gatekeeper-endpoint.png)

## <a name="related-patterns"></a><span data-ttu-id="81313-154">Padrões relacionados</span><span class="sxs-lookup"><span data-stu-id="81313-154">Related patterns</span></span>

<span data-ttu-id="81313-155">O [padrão de chave de manobrista](./valet-key.md) também pode ser relevante ao implementar o padrão do Gatekeeper.</span><span class="sxs-lookup"><span data-stu-id="81313-155">The [Valet Key pattern](./valet-key.md) might also be relevant when implementing the Gatekeeper pattern.</span></span> <span data-ttu-id="81313-156">Na comunicação entre o Gatekeeper e as funções confiáveis, é recomendável aumentar a segurança usando chaves ou tokens que limitem as permissões de acesso aos recursos.</span><span class="sxs-lookup"><span data-stu-id="81313-156">When communicating between the Gatekeeper and trusted roles it's good practice to enhance security by using keys or tokens that limit permissions for accessing resources.</span></span> <span data-ttu-id="81313-157">Descreve como usar um token ou chave que forneça aos clientes acesso direto e restrito a um determinado recurso ou serviço.</span><span class="sxs-lookup"><span data-stu-id="81313-157">Describes how to use a token or key that provides clients with restricted direct access to a specific resource or service.</span></span>
