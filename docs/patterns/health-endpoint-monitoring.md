---
title: Padrão de monitoramento do ponto de extremidade de integridade
titleSuffix: Cloud Design Patterns
description: Implemente verificações funcionais dentro de um aplicativo cujas ferramentas externas podem acessar por meio de pontos de extremidade expostos em intervalos regulares.
keywords: padrão de design
author: dragon119
ms.date: 06/23/2017
ms.custom: seodec18
ms.openlocfilehash: 85a1355ff47e6fce80d9b2ed114024651eb994db
ms.sourcegitcommit: 1f4cdb08fe73b1956e164ad692f792f9f635b409
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2019
ms.locfileid: "54114242"
---
# <a name="health-endpoint-monitoring-pattern"></a><span data-ttu-id="1bc5a-104">Padrão de monitoramento do ponto de extremidade de integridade</span><span class="sxs-lookup"><span data-stu-id="1bc5a-104">Health Endpoint Monitoring pattern</span></span>

[!INCLUDE [header](../_includes/header.md)]

<span data-ttu-id="1bc5a-105">Implemente verificações funcionais dentro de um aplicativo cujas ferramentas externas podem acessar por meio de pontos de extremidade expostos em intervalos regulares.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-105">Implement functional checks in an application that external tools can access through exposed endpoints at regular intervals.</span></span> <span data-ttu-id="1bc5a-106">Isso pode ajudar a verificar se os aplicativos e serviços estão funcionando corretamente.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-106">This can help to verify that applications and services are performing correctly.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="1bc5a-107">Contexto e problema</span><span class="sxs-lookup"><span data-stu-id="1bc5a-107">Context and problem</span></span>

<span data-ttu-id="1bc5a-108">É uma boa prática e geralmente um requisito de negócios para monitorar serviços back-end e aplicativos Web e garantir que eles estejam disponíveis e funcionando corretamente.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-108">It's a good practice, and often a business requirement, to monitor web applications and back-end services, to ensure they're available and performing correctly.</span></span> <span data-ttu-id="1bc5a-109">No entanto, é mais difícil monitorar serviços em execução na nuvem do que monitorar serviços locais.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-109">However, it's more difficult to monitor services running in the cloud than it is to monitor on-premises services.</span></span> <span data-ttu-id="1bc5a-110">Por exemplo, você não possui o controle total do ambiente de hospedagem e os serviços geralmente dependem de outros serviços fornecidos por fornecedores de plataformas e outros.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-110">For example, you don't have full control of the hosting environment, and the services typically depend on other services provided by platform vendors and others.</span></span>

<span data-ttu-id="1bc5a-111">Existem muitos fatores que afetam aplicativos hospedados na nuvem, como a latência da rede, o desempenho e a disponibilidade dos sistemas de armazenamento e computação subjacente e a largura de banda da rede entre eles.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-111">There are many factors that affect cloud-hosted applications such as network latency, the performance and availability of the underlying compute and storage systems, and the network bandwidth between them.</span></span> <span data-ttu-id="1bc5a-112">O serviço pode falhar total ou parcialmente devido a qualquer desses fatores.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-112">The service can fail entirely or partially due to any of these factors.</span></span> <span data-ttu-id="1bc5a-113">Portanto, você deve verificar em intervalos regulares se o serviço está executando corretamente para garantir o nível de disponibilidade necessário, que pode ser parte do seu SLA (Contrato de Nível de Serviço).</span><span class="sxs-lookup"><span data-stu-id="1bc5a-113">Therefore, you must verify at regular intervals that the service is performing correctly to ensure the required level of availability, which might be part of your service level agreement (SLA).</span></span>

## <a name="solution"></a><span data-ttu-id="1bc5a-114">Solução</span><span class="sxs-lookup"><span data-stu-id="1bc5a-114">Solution</span></span>

<span data-ttu-id="1bc5a-115">Implementar monitoramento de integridade, enviando solicitações para um ponto de extremidade no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-115">Implement health monitoring by sending requests to an endpoint on the application.</span></span> <span data-ttu-id="1bc5a-116">O aplicativo deve realizar as verificações necessárias e retornar uma indicação de seu status.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-116">The application should perform the necessary checks, and return an indication of its status.</span></span>

<span data-ttu-id="1bc5a-117">Uma verificação de monitoramento de integridade geralmente combina dois fatores:</span><span class="sxs-lookup"><span data-stu-id="1bc5a-117">A health monitoring check typically combines two factors:</span></span>

- <span data-ttu-id="1bc5a-118">As verificações (se houver) realizadas pelo aplicativo ou serviço em resposta à solicitação para o ponto de extremidade de verificação de integridade.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-118">The checks (if any) performed by the application or service in response to the request to the health verification endpoint.</span></span>
- <span data-ttu-id="1bc5a-119">Análise dos resultados pela ferramenta ou estrutura que executa a verificação de integridade.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-119">Analysis of the results by the tool or framework that performs the health verification check.</span></span>

<span data-ttu-id="1bc5a-120">O código de resposta indica o status do aplicativo e, opcionalmente, quaisquer componentes ou serviços utilizados por ele.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-120">The response code indicates the status of the application and, optionally, any components or services it uses.</span></span> <span data-ttu-id="1bc5a-121">A verificação de tempo resposta ou latência é realizada pela estrutura ou ferramenta de monitoramento.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-121">The latency or response time check is performed by the monitoring tool or framework.</span></span> <span data-ttu-id="1bc5a-122">A figura fornece uma visão geral do padrão.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-122">The figure provides an overview of the pattern.</span></span>

![Visão geral do padrão](./_images/health-endpoint-monitoring-pattern.png)

<span data-ttu-id="1bc5a-124">Outras verificações que podem ser realizadas pelo código de monitoramento de integridade no aplicativo incluem:</span><span class="sxs-lookup"><span data-stu-id="1bc5a-124">Other checks that might be carried out by the health monitoring code in the application include:</span></span>

- <span data-ttu-id="1bc5a-125">Verificação do armazenamento em nuvem ou um banco de dados para disponibilidade e tempo de resposta.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-125">Checking cloud storage or a database for availability and response time.</span></span>
- <span data-ttu-id="1bc5a-126">Verificação de outros serviços ou recursos localizados no aplicativo, ou situados em outros locais, mas utilizados pelo aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-126">Checking other resources or services located in the application, or located elsewhere but used by the application.</span></span>

<span data-ttu-id="1bc5a-127">Existem serviços e ferramentas que monitoram aplicativos Web, enviando uma solicitação para um conjunto de pontos de extremidade configurável e avaliando os resultados em relação a um conjunto de regras configuráveis.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-127">Services and tools are available that monitor web applications by submitting a request to a configurable set of endpoints, and evaluating the results against a set of configurable rules.</span></span> <span data-ttu-id="1bc5a-128">É relativamente fácil criar um ponto de extremidade de serviço cujo único propósito é realizar alguns testes funcionais no sistema.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-128">It's relatively easy to create a service endpoint whose sole purpose is to perform some functional tests on the system.</span></span>

<span data-ttu-id="1bc5a-129">As verificações típicas que podem ser realizadas pelas ferramentas de monitoramento incluem:</span><span class="sxs-lookup"><span data-stu-id="1bc5a-129">Typical checks that can be performed by the monitoring tools include:</span></span>

- <span data-ttu-id="1bc5a-130">Validando o código de resposta.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-130">Validating the response code.</span></span> <span data-ttu-id="1bc5a-131">Por exemplo, uma resposta HTTP de 200 (OK) indica que o aplicativo respondeu sem erro.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-131">For example, an HTTP response of 200 (OK) indicates that the application responded without error.</span></span> <span data-ttu-id="1bc5a-132">O sistema de monitoramento também pode verificar se há outros códigos de resposta para obter resultados mais abrangentes.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-132">The monitoring system might also check for other response codes to give more comprehensive results.</span></span>
- <span data-ttu-id="1bc5a-133">Verificação do conteúdo da resposta para detectar erros, mesmo quando um código de status de 200 (OK) é retornado.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-133">Checking the content of the response to detect errors, even when a 200 (OK) status code is returned.</span></span> <span data-ttu-id="1bc5a-134">Isso pode detectar erros que afetam apenas uma seção da página da Web retornada ou resposta do serviço.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-134">This can detect errors that affect only a section of the returned web page or service response.</span></span> <span data-ttu-id="1bc5a-135">Por exemplo, verificar o título de uma página ou procurar uma frase específica que indique que a página correta foi retornada.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-135">For example, checking the title of a page or looking for a specific phrase that indicates the correct page was returned.</span></span>
- <span data-ttu-id="1bc5a-136">Medindo o tempo de resposta, que indica uma combinação da latência da rede e o tempo que o aplicativo demorou para executar a solicitação.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-136">Measuring the response time, which indicates a combination of the network latency and the time that the application took to execute the request.</span></span> <span data-ttu-id="1bc5a-137">Um valor crescente pode indicar um problema emergente com o aplicativo ou a rede.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-137">An increasing value can indicate an emerging problem with the application or network.</span></span>
- <span data-ttu-id="1bc5a-138">Verificação dos recursos ou serviços localizados fora do aplicativo, como uma rede de distribuição de conteúdo utilizada pelo aplicativo para distribuir conteúdo de caches globais.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-138">Checking resources or services located outside the application, such as a content delivery network used by the application to deliver content from global caches.</span></span>
- <span data-ttu-id="1bc5a-139">Verificação da expiração de certificados SSL.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-139">Checking for expiration of SSL certificates.</span></span>
- <span data-ttu-id="1bc5a-140">Medindo o tempo de resposta de uma pesquisa de DNS para a URL do aplicativo para medir a latência de DNS e falhas de DNS.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-140">Measuring the response time of a DNS lookup for the URL of the application to measure DNS latency and DNS failures.</span></span>
- <span data-ttu-id="1bc5a-141">Validação da URL retornada pela pesquisa de DNS para garantir entradas corretas.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-141">Validating the URL returned by the DNS lookup to ensure correct entries.</span></span> <span data-ttu-id="1bc5a-142">Isso pode ajudar a evitar o redirecionamento de solicitação mal-intencionada através de um ataque bem-sucedido no servidor DNS.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-142">This can help to avoid malicious request redirection through a successful attack on the DNS server.</span></span>

<span data-ttu-id="1bc5a-143">Também é útil, sempre que possível, executar essas verificações em diferentes locais ou locais hospedados para medir e comparar os tempos de resposta.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-143">It's also useful, where possible, to run these checks from different on-premises or hosted locations to measure and compare response times.</span></span> <span data-ttu-id="1bc5a-144">O ideal é você monitorar aplicativos de locais próximos aos clientes para obter uma exibição precisa do desempenho de cada local.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-144">Ideally you should monitor applications from locations that are close to customers to get an accurate view of the performance from each location.</span></span> <span data-ttu-id="1bc5a-145">Além de fornecer um mecanismo de verificação mais robusto, os resultados podem ajudá-lo a decidir o local de implantação para o aplicativo&mdash;e se deverá implantá-lo em mais de um datacenter.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-145">In addition to providing a more robust checking mechanism, the results can help you decide on the deployment location for the application&mdash;and whether to deploy it in more than one datacenter.</span></span>

<span data-ttu-id="1bc5a-146">Os testes também devem ser executados em todas as instâncias de serviço que os clientes utilizam para garantir que o aplicativo esteja funcionando corretamente para todos os clientes.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-146">Tests should also be run against all the service instances that customers use to ensure the application is working correctly for all customers.</span></span> <span data-ttu-id="1bc5a-147">Por exemplo, se o armazenamento do cliente se espalhar por mais de uma conta de armazenamento, o processo de monitoramento deverá verificar tudo isso.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-147">For example, if customer storage is spread across more than one storage account, the monitoring process should check all of these.</span></span>

## <a name="issues-and-considerations"></a><span data-ttu-id="1bc5a-148">Problemas e considerações</span><span class="sxs-lookup"><span data-stu-id="1bc5a-148">Issues and considerations</span></span>

<span data-ttu-id="1bc5a-149">Considere os seguintes pontos ao decidir como implementar esse padrão:</span><span class="sxs-lookup"><span data-stu-id="1bc5a-149">Consider the following points when deciding how to implement this pattern:</span></span>

<span data-ttu-id="1bc5a-150">Como validar a resposta.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-150">How to validate the response.</span></span> <span data-ttu-id="1bc5a-151">Por exemplo, somente um código de status de 200 (OK) único é suficiente para verificar se o aplicativo está funcionando corretamente?</span><span class="sxs-lookup"><span data-stu-id="1bc5a-151">For example, is just a single 200 (OK) status code sufficient to verify the application is working correctly?</span></span> <span data-ttu-id="1bc5a-152">Embora isso forneça a medida mais básica de disponibilidade do aplicativo, e é a implementação mínima desse padrão, fornece pouca informação sobre as operações, tendências e possíveis problemas futuros no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-152">While this provides the most basic measure of application availability, and is the minimum implementation of this pattern, it provides little information about the operations, trends, and possible upcoming issues in the application.</span></span>

   > <span data-ttu-id="1bc5a-153">Verifique se o aplicativo retorna um 200 (OK) corretamente somente quando o recurso de destino é encontrado e processado.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-153">Make sure that the application correctly returns a 200 (OK) only when the target resource is found and processed.</span></span> <span data-ttu-id="1bc5a-154">Em alguns cenários, como quando ao utilizar uma página mestre para hospedar a página da Web de destino, o servidor envia um código de status de 200 (OK) ao invés de um código 404 (Não Encontrado), mesmo quando a página de conteúdo de destino não foi encontrada.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-154">In some scenarios, such as when using a master page to host the target web page, the server sends back a 200 (OK) status code instead of a 404 (Not Found) code, even when the target content page was not found.</span></span>

<span data-ttu-id="1bc5a-155">O número de pontos de extremidade para expor um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-155">The number of endpoints to expose for an application.</span></span> <span data-ttu-id="1bc5a-156">Uma abordagem é expor ao menos um ponto de extremidade para os principais serviços que o aplicativo utiliza e um outro para os serviços de menor prioridade, permitindo que diferentes níveis de importância sejam atribuídos a cada resultado de monitoramento.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-156">One approach is to expose at least one endpoint for the core services that the application uses and another for lower priority services, allowing different levels of importance to be assigned to each monitoring result.</span></span> <span data-ttu-id="1bc5a-157">Considere também expor mais pontos de extremidade, como um para cada serviço principal, para granularidade de monitoramento adicional.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-157">Also consider exposing more endpoints, such as one for each core service, for additional monitoring granularity.</span></span> <span data-ttu-id="1bc5a-158">Por exemplo, uma verificação de integridade pode verificar o banco de dados, o armazenamento e um serviço de geocodificação externo que um aplicativo utiliza, cada um exigindo um nível diferente de tempo de atividade e tempo de resposta.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-158">For example, a health verification check might check the database, storage, and an external geocoding service that an application uses, with each requiring a different level of uptime and response time.</span></span> <span data-ttu-id="1bc5a-159">O aplicativo ainda poderá ser íntegro se o serviço de geocodificação, ou alguma outra tarefa em segundo plano, não estiver disponível por alguns minutos.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-159">The application could still be healthy if the geocoding service, or some other background task, is unavailable for a few minutes.</span></span>

<span data-ttu-id="1bc5a-160">Seja para usar o mesmo ponto de extremidade para o monitoramento, como é utilizado para acesso geral, mas para um caminho específico projetado para verificações de integridade, por exemplo, /HealthCheck/{GUID}/ no ponto de extremidade de acesso geral.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-160">Whether to use the same endpoint for monitoring as is used for general access, but to a specific path designed for health verification checks, for example, /HealthCheck/{GUID}/ on the general access endpoint.</span></span> <span data-ttu-id="1bc5a-161">Isso permite que alguns testes funcionais no aplicativo sejam executados pelas ferramentas de monitoramento, como adicionar um novo registro de usuário, conectar e colocar uma ordem de teste, além de verificar se o ponto de extremidade de acesso geral está disponível.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-161">This allows some functional tests in the application to be run by the monitoring tools, such as adding a new user registration, signing in, and placing a test order, while also verifying that the general access endpoint is available.</span></span>

<span data-ttu-id="1bc5a-162">O tipo de informação a ser coletada no serviço em resposta às solicitações de monitoramento e como retornar essas informações.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-162">The type of information to collect in the service in response to monitoring requests, and how to return this information.</span></span> <span data-ttu-id="1bc5a-163">A maioria das ferramentas e estruturas existentes pesquisa apenas o código de status HTTP que o ponto de extremidade retorna.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-163">Most existing tools and frameworks look only at the HTTP status code that the endpoint returns.</span></span> <span data-ttu-id="1bc5a-164">Para retornar e validar informações adicionais, talvez seja necessário criar um serviço ou utilitário de monitoramento personalizado.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-164">To return and validate additional information, you might have to create a custom monitoring utility or service.</span></span>

<span data-ttu-id="1bc5a-165">Quanta informação coletar.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-165">How much information to collect.</span></span> <span data-ttu-id="1bc5a-166">Executar um processamento excessivo durante a verificação pode sobrecarregar o aplicativo e afetar outros usuários.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-166">Performing excessive processing during the check can overload the application and impact other users.</span></span> <span data-ttu-id="1bc5a-167">O tempo que demora pode exceder o tempo limite do sistema de monitoramento para que o aplicativo não esteja disponível.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-167">The time it takes might exceed the timeout of the monitoring system so it marks the application as unavailable.</span></span> <span data-ttu-id="1bc5a-168">A maioria dos aplicativos inclui instrumentação, como manipuladores de erro e contadores de desempenho que registram desempenho e informações de erro detalhadas, isso pode ser suficiente em vez de retornar informações adicionais de uma verificação de integridade.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-168">Most applications include instrumentation such as error handlers and performance counters that log performance and detailed error information, this might be sufficient instead of returning additional information from a health verification check.</span></span>

<span data-ttu-id="1bc5a-169">Armazenando em cache o status do ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-169">Caching the endpoint status.</span></span> <span data-ttu-id="1bc5a-170">Pode custar caro executar a verificação de integridade com muita frequência.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-170">It could be expensive to run the health check too frequently.</span></span> <span data-ttu-id="1bc5a-171">Se o estado de integridade for relatado através de um painel, por exemplo, você não deseja que cada solicitação do painel apresente uma verificação de integridade.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-171">If the health status is reported through a dashboard, for example, you don't want every request from the dashboard to trigger a health check.</span></span> <span data-ttu-id="1bc5a-172">Em vez disso, verifique periodicamente a integridade do sistema e armazene em cache o status.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-172">Instead, periodically check the system health and cache the status.</span></span> <span data-ttu-id="1bc5a-173">Exponha um ponto de extremidade que retorna o status em cache.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-173">Expose an endpoint that returns the cached status.</span></span>

<span data-ttu-id="1bc5a-174">Como configurar a segurança para os pontos de extremidade de monitoramento para protegê-los do acesso público, o que pode expor o aplicativo a ataques mal-intencionados, arriscar a exposição de informações confidenciais ou atrair ataques de DoS (negação de serviço).</span><span class="sxs-lookup"><span data-stu-id="1bc5a-174">How to configure security for the monitoring endpoints to protect them from public access, which might expose the application to malicious attacks, risk the exposure of sensitive information, or attract denial of service (DoS) attacks.</span></span> <span data-ttu-id="1bc5a-175">Normalmente, isso deve ser feito na configuração do aplicativo para que ele possa ser atualizado facilmente sem reiniciar o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-175">Typically this should be done in the application configuration so that it can be updated easily without restarting the application.</span></span> <span data-ttu-id="1bc5a-176">Considere usar uma ou mais das seguintes técnicas:</span><span class="sxs-lookup"><span data-stu-id="1bc5a-176">Consider using one or more of the following techniques:</span></span>

- <span data-ttu-id="1bc5a-177">Proteger o ponto de extremidade exigindo autenticação.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-177">Secure the endpoint by requiring authentication.</span></span> <span data-ttu-id="1bc5a-178">É possível fazer isso, utilizando uma chave de segurança de autenticação no cabeçalho da solicitação ou passando as credenciais com a solicitação, desde que o serviço de monitoramento ou a ferramenta forneça suporte à autenticação.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-178">You can do this by using an authentication security key in the request header or by passing credentials with the request, provided that the monitoring service or tool supports authentication.</span></span>

  - <span data-ttu-id="1bc5a-179">Utilizar um ponto de extremidade oculto ou obscuro.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-179">Use an obscure or hidden endpoint.</span></span> <span data-ttu-id="1bc5a-180">Por exemplo, exponha o ponto de extremidade em um endereço IP diferente ao utilizado pela URL do aplicativo padrão, configure o ponto de extremidade em uma porta HTTP não padronizada e/ou utilize um caminho complexo para a página de teste.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-180">For example, expose the endpoint on a different IP address to that used by the default application URL, configure the endpoint on a nonstandard HTTP port, and/or use a complex path to the test page.</span></span> <span data-ttu-id="1bc5a-181">Normalmente, você pode especificar portas e endereços de ponto de extremidade adicionais na configuração do aplicativo e adicionar entradas para esses pontos de extremidade ao servidor DNS, se necessário para evitar ter que especificar o endereço IP diretamente.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-181">You can usually specify additional endpoint addresses and ports in the application configuration, and add entries for these endpoints to the DNS server if required to avoid having to specify the IP address directly.</span></span>

  - <span data-ttu-id="1bc5a-182">Expor um método em um ponto de extremidade que aceite um parâmetro, como um valor de chave ou um valor de modo de operação.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-182">Expose a method on an endpoint that accepts a parameter such as a key value or an operation mode value.</span></span> <span data-ttu-id="1bc5a-183">Dependendo do valor fornecido para esse parâmetro, quando uma solicitação é recebida, o código pode executar um teste específico ou conjunto de testes, ou retornar um erro 404 (Não Encontrado) se o valor do parâmetro não for reconhecido.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-183">Depending on the value supplied for this parameter, when a request is received the code can perform a specific test or set of tests, or return a 404 (Not Found) error if the parameter value isn't recognized.</span></span> <span data-ttu-id="1bc5a-184">Os valores de parâmetros reconhecidos podem ser configurados na configuração do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-184">The recognized parameter values could be set in the application configuration.</span></span>

     >  <span data-ttu-id="1bc5a-185">Os ataques de negação de serviço provavelmente terão menos impacto em um ponto de extremidade separado que executa testes funcionais básicos sem comprometer a operação do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-185">DoS attacks are likely to have less impact on a separate endpoint that performs basic functional tests without compromising the operation of the application.</span></span> <span data-ttu-id="1bc5a-186">O ideal é evitar usar um teste que possa expor informações confidenciais.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-186">Ideally, avoid using a test that might expose sensitive information.</span></span> <span data-ttu-id="1bc5a-187">Se for necessário retornar informações que possam ser úteis a um invasor, considere como irá proteger o ponto de extremidade e os dados contra acesso não autorizado.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-187">If you must return information that might be useful to an attacker, consider how you'll protect the endpoint and the data from unauthorized access.</span></span> <span data-ttu-id="1bc5a-188">Neste caso, apenas confiar na obscuridade não é suficiente.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-188">In this case just relying on obscurity isn't enough.</span></span> <span data-ttu-id="1bc5a-189">Também será necessário considerar usar uma conexão HTTPS e criptografar quaisquer dados confidenciais, embora isso aumente a carga no servidor.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-189">You should also consider using an HTTPS connection and encrypting any sensitive data, although this will increase the load on the server.</span></span>

- <span data-ttu-id="1bc5a-190">Como acessar um ponto de extremidade protegido utilizando a autenticação.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-190">How to access an endpoint that's secured using authentication.</span></span> <span data-ttu-id="1bc5a-191">Nem todas as ferramentas e estruturas podem ser configuradas para incluir credenciais com a solicitação de verificação de integridade.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-191">Not all tools and frameworks can be configured to include credentials with the health verification request.</span></span> <span data-ttu-id="1bc5a-192">Por exemplo, os recursos de verificação de integridade internos do Microsoft Azure não podem fornecer credenciais de autenticação.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-192">For example, Microsoft Azure built-in health verification features can't provide authentication credentials.</span></span> <span data-ttu-id="1bc5a-193">Algumas alternativas de terceiros são [Pingdom](https://www.pingdom.com/), [Panopta](https://www.panopta.com/), [NewRelic](https://newrelic.com/) e [Statuscake](https://www.statuscake.com/).</span><span class="sxs-lookup"><span data-stu-id="1bc5a-193">Some third-party alternatives are [Pingdom](https://www.pingdom.com/), [Panopta](https://www.panopta.com/), [NewRelic](https://newrelic.com/), and [Statuscake](https://www.statuscake.com/).</span></span>

- <span data-ttu-id="1bc5a-194">Como garantir que o agente de monitoramento esteja sendo executado corretamente.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-194">How to ensure that the monitoring agent is performing correctly.</span></span> <span data-ttu-id="1bc5a-195">Uma abordagem é expor um ponto de extremidade que simplesmente retorne um valor a partir da configuração do aplicativo ou um valor aleatório que pode ser utilizado para testar o agente.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-195">One approach is to expose an endpoint that simply returns a value from the application configuration or a random value that can be used to test the agent.</span></span>

   >  <span data-ttu-id="1bc5a-196">Certifique-se também de que o sistema de monitoramento realize verificações em si, como uma autoteste e um teste interno, para evitar que ele emita resultados falsos positivos.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-196">Also ensure that the monitoring system performs checks on itself, such as a self-test and built-in test, to avoid it issuing false positive results.</span></span>

## <a name="when-to-use-this-pattern"></a><span data-ttu-id="1bc5a-197">Quando usar esse padrão</span><span class="sxs-lookup"><span data-stu-id="1bc5a-197">When to use this pattern</span></span>

<span data-ttu-id="1bc5a-198">Esse padrão é útil para:</span><span class="sxs-lookup"><span data-stu-id="1bc5a-198">This pattern is useful for:</span></span>

- <span data-ttu-id="1bc5a-199">Monitorar sites e aplicativos Web para verificar a disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-199">Monitoring websites and web applications to verify availability.</span></span>
- <span data-ttu-id="1bc5a-200">Monitorar sites e aplicativos Web para verificar a operação correta.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-200">Monitoring websites and web applications to check for correct operation.</span></span>
- <span data-ttu-id="1bc5a-201">Monitorar serviços compartilhados ou camada intermediária para detectar e isolar uma falha que poderia interromper outros aplicativos.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-201">Monitoring middle-tier or shared services to detect and isolate a failure that could disrupt other applications.</span></span>
- <span data-ttu-id="1bc5a-202">Complementar a instrumentação existente no aplicativo, como contadores de desempenho e manipuladores de erro.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-202">Complementing existing instrumentation in the application, such as performance counters and error handlers.</span></span> <span data-ttu-id="1bc5a-203">A verificação de integridade não substitui o requisito para registro em log e auditoria no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-203">Health verification checking doesn't replace the requirement for logging and auditing in the application.</span></span> <span data-ttu-id="1bc5a-204">A instrumentação pode fornecer informações valiosas para uma estrutura existente que monitora contadores e logs de erros para detectar falhas ou outros problemas.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-204">Instrumentation can provide valuable information for an existing framework that monitors counters and error logs to detect failures or other issues.</span></span> <span data-ttu-id="1bc5a-205">No entanto, ele não pode fornecer informações se o aplicativo não estiver disponível.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-205">However, it can't provide information if the application is unavailable.</span></span>

## <a name="example"></a><span data-ttu-id="1bc5a-206">Exemplo</span><span class="sxs-lookup"><span data-stu-id="1bc5a-206">Example</span></span>

<span data-ttu-id="1bc5a-207">Os seguintes exemplos de código, tirados da classe `HealthCheckController` (uma amostra que demonstra esse padrão está disponível no [GitHub](https://github.com/mspnp/cloud-design-patterns/tree/master/health-endpoint-monitoring)), demonstra expor um ponto de extremidade para executar um intervalo de verificações de integridade.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-207">The following code examples, taken from the `HealthCheckController` class (a sample that demonstrates this pattern is available on [GitHub](https://github.com/mspnp/cloud-design-patterns/tree/master/health-endpoint-monitoring)), demonstrates exposing an endpoint for performing a range of health checks.</span></span>

<span data-ttu-id="1bc5a-208">O método `CoreServices` mostrado abaixo em C#, realiza uma série de verificações nos serviços utilizados no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-208">The `CoreServices` method, shown below in C#, performs a series of checks on services used in the application.</span></span> <span data-ttu-id="1bc5a-209">Se todos os testes forem executados sem erro, o método retornará um código de status de 200 (OK).</span><span class="sxs-lookup"><span data-stu-id="1bc5a-209">If all of the tests run without error, the method returns a 200 (OK) status code.</span></span> <span data-ttu-id="1bc5a-210">Se algum dos testes aumentar uma exceção, o método retornará um código de status de 500 (Erro Interno).</span><span class="sxs-lookup"><span data-stu-id="1bc5a-210">If any of the tests raises an exception, the method returns a 500 (Internal Error) status code.</span></span> <span data-ttu-id="1bc5a-211">O método poderá, opcionalmente, retornar informações adicionais quando ocorrer um erro, se a ferramenta de monitoramento ou a estrutura for capaz de usá-la.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-211">The method could optionally return additional information when an error occurs, if the monitoring tool or framework is able to make use of it.</span></span>

```csharp
public ActionResult CoreServices()
{
  try
  {
    // Run a simple check to ensure the database is available.
    DataStore.Instance.CoreHealthCheck();

    // Run a simple check on our external service.
    MyExternalService.Instance.CoreHealthCheck();
  }
  catch (Exception ex)
  {
    Trace.TraceError("Exception in basic health check: {0}", ex.Message);

    // This can optionally return different status codes based on the exception.
    // Optionally it could return more details about the exception.
    // The additional information could be used by administrators who access the
    // endpoint with a browser, or using a ping utility that can display the
    // additional information.
    return new HttpStatusCodeResult((int)HttpStatusCode.InternalServerError);
  }
  return new HttpStatusCodeResult((int)HttpStatusCode.OK);
}
```

<span data-ttu-id="1bc5a-212">O método `ObscurePath` mostra como você pode ler um caminho da configuração do aplicativo e usá-lo como ponto de extremidade para testes.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-212">The `ObscurePath` method shows how you can read a path from the application configuration and use it as the endpoint for tests.</span></span> <span data-ttu-id="1bc5a-213">Este exemplo, em C#, também mostra como você pode aceitar uma ID como um parâmetro e utilizá-la para verificar solicitações válidas.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-213">This example, in C#, also shows how you can accept an ID as a parameter and use it to check for valid requests.</span></span>

```csharp
public ActionResult ObscurePath(string id)
{
  // The id could be used as a simple way to obscure or hide the endpoint.
  // The id to match could be retrieved from configuration and, if matched,
  // perform a specific set of tests and return the result. If not matched it
  // could return a 404 (Not Found) status.

  // The obscure path can be set through configuration to hide the endpoint.
  var hiddenPathKey = CloudConfigurationManager.GetSetting("Test.ObscurePath");

  // If the value passed does not match that in configuration, return 404 (Not Found).
  if (!string.Equals(id, hiddenPathKey))
  {
    return new HttpStatusCodeResult((int)HttpStatusCode.NotFound);
  }

  // Else continue and run the tests...
  // Return results from the core services test.
  return this.CoreServices();
}
```

<span data-ttu-id="1bc5a-214">O método `TestResponseFromConfig` mostra como você pode expor um ponto de extremidade que executa uma verificação para um valor de configuração especificado.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-214">The `TestResponseFromConfig` method shows how you can expose an endpoint that performs a check for a specified configuration setting value.</span></span>

```csharp
public ActionResult TestResponseFromConfig()
{
  // Health check that returns a response code set in configuration for testing.
  var returnStatusCodeSetting = CloudConfigurationManager.GetSetting(
                                                          "Test.ReturnStatusCode");

  int returnStatusCode;

  if (!int.TryParse(returnStatusCodeSetting, out returnStatusCode))
  {
    returnStatusCode = (int)HttpStatusCode.OK;
  }

  return new HttpStatusCodeResult(returnStatusCode);
}
```

## <a name="monitoring-endpoints-in-azure-hosted-applications"></a><span data-ttu-id="1bc5a-215">Monitorar pontos de extremidade em aplicativos hospedados no Azure</span><span class="sxs-lookup"><span data-stu-id="1bc5a-215">Monitoring endpoints in Azure hosted applications</span></span>

<span data-ttu-id="1bc5a-216">Algumas opções para monitorar pontos de extremidades em aplicativos do Azure são:</span><span class="sxs-lookup"><span data-stu-id="1bc5a-216">Some options for monitoring endpoints in Azure applications are:</span></span>

- <span data-ttu-id="1bc5a-217">Utilizar os recursos de monitoramento internos do Azure.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-217">Use the built-in monitoring features of Azure.</span></span>

- <span data-ttu-id="1bc5a-218">Utilizar uma estrutura ou serviço de terceiros como o Microsoft System Center Operations Manager.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-218">Use a third-party service or a framework such as Microsoft System Center Operations Manager.</span></span>

- <span data-ttu-id="1bc5a-219">Criar um serviço ou utilitário personalizado que seja executado de maneira autônoma ou em um servidor hospedado.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-219">Create a custom utility or a service that runs on your own or on a hosted server.</span></span>

   >  <span data-ttu-id="1bc5a-220">Embora o Azure forneça um conjunto de opções de monitoramento razoavelmente abrangente, é possível utilizar serviços e ferramentas adicionais para fornecer informações adicionais.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-220">Even though Azure provides a reasonably comprehensive set of monitoring options, you can use additional services and tools to provide extra information.</span></span> <span data-ttu-id="1bc5a-221">Os Serviços de Gerenciamento do Azure fornecem um mecanismo de monitoramento interno para regras de alerta.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-221">Azure Management Services provides a built-in monitoring mechanism for alert rules.</span></span> <span data-ttu-id="1bc5a-222">A seção de alertas da página de serviços de gerenciamento no Portal do Azure permite que você configure até dez regras de alerta por assinatura para seus serviços.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-222">The alerts section of the management services page in the Azure portal allows you to configure up to ten alert rules per subscription for your services.</span></span> <span data-ttu-id="1bc5a-223">Essas regras especificam uma condição e um limite para um serviço, como carga de CPU, ou o número de solicitações ou erros por segundo, e o serviço pode enviar automaticamente notificações por email para os endereços definidos em cada regra.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-223">These rules specify a condition and a threshold value for a service such as CPU load, or the number of requests or errors per second, and the service can automatically send email notifications to addresses you define in each rule.</span></span>

<span data-ttu-id="1bc5a-224">As condições que você pode monitorar variam de acordo com o mecanismo de hospedagem escolhido para seu aplicativo (como Sites, Serviços de Nuvem, Máquinas Virtuais ou Serviços Móveis), mas todos eles incluem a capacidade de criar uma regra de alerta que utilize um ponto de extremidade da web que você especifica nas configurações do seu serviço.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-224">The conditions you can monitor vary depending on the hosting mechanism you choose for your application (such as Web Sites, Cloud Services, Virtual Machines, or Mobile Services), but all of these include the ability to create an alert rule that uses a web endpoint you specify in the settings for your service.</span></span> <span data-ttu-id="1bc5a-225">Este ponto de extremidade deve responder em tempo hábil para que o sistema de alerta possa detectar que o aplicativo está executando corretamente.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-225">This endpoint should respond in a timely way so that the alert system can detect that the application is operating correctly.</span></span>

> <span data-ttu-id="1bc5a-226">Leia mais informações sobre [criar notificações de alerta ][portal-alerts].</span><span class="sxs-lookup"><span data-stu-id="1bc5a-226">Read more information about [creating alert notifications][portal-alerts].</span></span>

<span data-ttu-id="1bc5a-227">Se você hospedar seu aplicativo nas funções de trabalho e web nos Serviços de Nuvem do Azure ou Máquinas Virtuais, será possível tirar proveito de um dos serviços internos no Azure, chamado Gerenciador de Tráfego.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-227">If you host your application in Azure Cloud Services web and worker roles or Virtual Machines, you can take advantage of one of the built-in services in Azure called Traffic Manager.</span></span> <span data-ttu-id="1bc5a-228">O Gerenciador de Tráfego é um serviço de balanceamento de carga e roteamento que pode distribuir solicitações para instâncias específicas do seu aplicativo hospedado nos Serviços de Nuvem baseado em uma variedade de regras e configurações.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-228">Traffic Manager is a routing and load-balancing service that can distribute requests to specific instances of your Cloud Services hosted application based on a range of rules and settings.</span></span>

<span data-ttu-id="1bc5a-229">Além das solicitações de roteamento, o Gerenciador de Tráfego exibe uma URL, porta e caminho relativo especificados regularmente para determinar quais instâncias do aplicativo definido em suas regras estão ativas e estão respondendo as solicitações.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-229">In addition to routing requests, Traffic Manager pings a URL, port, and relative path that you specify on a regular basis to determine which instances of the application defined in its rules are active and are responding to requests.</span></span> <span data-ttu-id="1bc5a-230">Se detectar um código de status 200 (OK), ele marcará o aplicativo como disponível.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-230">If it detects a status code 200 (OK), it marks the application as available.</span></span> <span data-ttu-id="1bc5a-231">Qualquer outro código de status faz com que o Gerenciador de Tráfego marque o aplicativo como offline.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-231">Any other status code causes Traffic Manager to mark the application as offline.</span></span> <span data-ttu-id="1bc5a-232">É possível exibir o status no console do Gerenciador de Tráfego e configurar a regra para reencaminhar solicitações para outras instâncias do aplicativo que estão respondendo.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-232">You can view the status in the Traffic Manager console, and configure the rule to reroute requests to other instances of the application that are responding.</span></span>

<span data-ttu-id="1bc5a-233">No entanto, o Gerenciador de Tráfego aguardará apenas dez segundos para receber uma resposta da URL de monitoramento.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-233">However, Traffic Manager will only wait ten seconds to receive a response from the monitoring URL.</span></span> <span data-ttu-id="1bc5a-234">Portanto, você deverá garantir que seu código de verificação de integridade execute nesse tempo, permitindo a latência da rede para viagem de ida e volta do Gerenciador de Tráfego para o seu aplicativo e novamente.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-234">Therefore, you should ensure that your health verification code executes in this time, allowing for network latency for the round trip from Traffic Manager to your application and back again.</span></span>

> <span data-ttu-id="1bc5a-235">Leia mais informações sobre o uso do [Gerenciador de Tráfego para monitorar seus aplicativos](/azure/traffic-manager/).</span><span class="sxs-lookup"><span data-stu-id="1bc5a-235">Read more information about using [Traffic Manager to monitor your applications](/azure/traffic-manager/).</span></span> <span data-ttu-id="1bc5a-236">O Gerenciador de Tráfego também é discutido nas [Diretrizes de Implantação de Datacenter Múltiplo](https://msdn.microsoft.com/library/dn589779.aspx).</span><span class="sxs-lookup"><span data-stu-id="1bc5a-236">Traffic Manager is also discussed in [Multiple Datacenter Deployment Guidance](https://msdn.microsoft.com/library/dn589779.aspx).</span></span>

## <a name="related-guidance"></a><span data-ttu-id="1bc5a-237">Diretrizes relacionadas</span><span class="sxs-lookup"><span data-stu-id="1bc5a-237">Related guidance</span></span>

<span data-ttu-id="1bc5a-238">As diretrizes a seguir podem ser úteis ao implementar esse padrão:</span><span class="sxs-lookup"><span data-stu-id="1bc5a-238">The following guidance can be useful when implementing this pattern:</span></span>

- <span data-ttu-id="1bc5a-239">[Diretrizes sobre Instrumentação e Telemetria](https://msdn.microsoft.com/library/dn589775.aspx).</span><span class="sxs-lookup"><span data-stu-id="1bc5a-239">[Instrumentation and Telemetry Guidance](https://msdn.microsoft.com/library/dn589775.aspx).</span></span> <span data-ttu-id="1bc5a-240">A verificação da integridade dos serviços e componentes geralmente é feita por investigação, mas também é útil ter informações no local para monitorar o desempenho do aplicativo e detectar eventos que ocorrem em tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-240">Checking the health of services and components is typically done by probing, but it's also useful to have information in place to monitor application performance and detect events that occur at runtime.</span></span> <span data-ttu-id="1bc5a-241">Esses dados podem ser transmitidos de volta às ferramentas de monitoramento como informações adicionais para o monitoramento de integridade.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-241">This data can be transmitted back to monitoring tools as additional information for health monitoring.</span></span> <span data-ttu-id="1bc5a-242">As Diretrizes de Telemetria e Instrumentação obtêm informações de diagnóstico remoto coletadas por instrumentação em aplicativos.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-242">Instrumentation and Telemetry Guidance explores gathering remote diagnostics information that's collected by instrumentation in applications.</span></span>
- <span data-ttu-id="1bc5a-243">[Receber notificações de alerta][portal-alerts].</span><span class="sxs-lookup"><span data-stu-id="1bc5a-243">[Receiving alert notifications][portal-alerts].</span></span>
- <span data-ttu-id="1bc5a-244">Esse padrão inclui um [aplicativo de exemplo](https://github.com/mspnp/cloud-design-patterns/tree/master/health-endpoint-monitoring) para fazer o download.</span><span class="sxs-lookup"><span data-stu-id="1bc5a-244">This pattern includes a downloadable [sample application](https://github.com/mspnp/cloud-design-patterns/tree/master/health-endpoint-monitoring).</span></span>

[portal-alerts]: /azure/azure-monitor/platform/alerts-metric
